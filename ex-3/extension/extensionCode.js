var _compressJSON={
  _version:"BZ-0.001",
  _CHAR:"",
  _string:"",
  // _isBZCompressedData:function(o){
  //   if(_compressJSON._chkDataType(o,String)){
  //     return o.indexOf(this._version)==0;
  //   }
  //   return false;
  // },
  // _newKey:function(){
  //   var c="";
  //   for(var i=0;i<this._len;i++){
  //     c+=this._CHAR[this._idx[i]];
  //     if (i+1==this._len) { 
  //       this._idx[i]++;
  //     }
  //   }
  //   for(var i=this._len-1;i>=0;i--){
  //     if (this._idx[i]>=this._CHAR.length) {
  //       this._idx[i]=0;
  //       if (i==0) {
  //         this._idx.push(0);
  //         this._len++;
  //       }else{
  //         this._idx[i-1]++;
  //       }
  //     }else{
  //       break;
  //     }
  //   }
  //   return c;
  // },
  _unConvert:function(o){
    if(!o){
      return o;
    }
    var t=JSON.stringify(o);
    var rs=t.match(/&#[0-9]+;/g);
    if (rs) {
      for(var i=0;i<rs.length;i++){
        t=t.replace(rs[i],String.fromCharCode(parseInt(rs[i].substring(2))));
      }
      try{
        eval("t="+t);
      }catch(e){
        console.log(t)
      }
      return t;
    }else{
      return o;
    }
  },
  _convertToEntities:function(tstr) {
    if(!tstr||tstr.constructor!=String){
      return tstr;
    }
    var bstr = "";
    for(i = 0; i < tstr.length; ++i){
      if(tstr.charCodeAt(i) > 127){
        bstr += "&#" + tstr.charCodeAt(i) + ";";
      }else{
        bstr += tstr.charAt(i);
      }
    }
    return bstr;
  },
  // _init:function(o){
  //   var _CHAR="0123456789ABCDEFGHIJKLMNOPQRSTUVWXZYabcdefghijklmnopqrstuvwxzy-_";
  //   var _MARK="`~!@#$%^&*()|;<>?/ +";
  //   //var _MARK="";
  //   this._string=_compressJSON._convertToEntities(JSON.stringify(o));
  //   for(var i=0;i<_MARK.length;i++){
  //     var v=_MARK[i];
  //     if (this._string.indexOf(v)>=0) {
  //       _MARK=_MARK.replace(v,"")
  //       i--;
  //     }
  //   }
  //   this._words=this._getWords(o);
  //   this._CHAR=_CHAR+_MARK;

  //   this._WS_REGEXP=new RegExp("[^a-zA-Z0-9-_"+_MARK+"]+");
  //   this._MS_REGEXP=new RegExp("[a-zA-Z0-9-_"+_MARK+"]+");
  //   this._idx=[0];
  //   this._len=1;
  // },
  // _getWords:function(o){
  //   var ws=[];
  //   if(_compressJSON._chkDataType(o,Object)){
  //     for(var k in o){
  //       ws.push(k);
  //       var nws=this._getWords(o[k]);
  //       for(var i=0;i<nws.length;i++){
  //         ws.push(nws[i]);
  //       }
  //     }
  //   }else if(_compressJSON._chkDataType(o,Array)){
  //     for(var n=0;n<o.length;n++){
  //       var nws=this._getWords(o[n]);
  //       for(var i=0;i<nws.length;i++){
  //         ws.push(nws[i]);
  //       }
  //     }
  //   }else{
  //     if(o){
  //       o=o.toString();
  //       return o.split(/[^a-zA-Z0-9-_]+/);
  //     }else if(o==false){
  //       return ["false"];
  //     }
  //     return ["null"];
  //   }
  //   return ws;
  // },
  // _pareparyCompressKeys:function(){
  //   var _keys={};
  //   var vs=this._words;
  //   for(var i=0;i<vs.length;i++){
  //     var v=vs[i];
  //     if (!_keys[v]) {
  //       _keys[v]=0;
  //     }
  //     if (v!="null") {
  //       _keys[v]++;
  //     }
  //   }
  //   var ks=[];
  //   for(var k in _keys){
  //     var i=k.length;
  //     var n=_keys[k];
  //     var v=n*i-1-i-n-1;
  //     if(v>0){
  //       ks.push({k:k,v:v,n:n});
  //     }
  //   }

  //   ks.sort(function(a,b){
  //     if(a.v<b.v){
  //       return 1;
  //     }else{
  //       return -1;
  //     }
  //   });
  //   for(var l=0;l<ks.length;l++){
  //     var k=ks[l];
  //     while (true) {
  //       var c=this._newKey();
  //       if (!_keys[c]) {
  //         k.nk=c;
  //         break;
  //       }
  //     }
  //     var m=k.nk.length;
  //     var i=k.k.length;
  //     var n=k.n;
  //     var v=n*i-m-i-n*m-1;
      
  //     if (v<0) {
  //       ks.splice(l);
  //       break;
  //     }
  //     k.v=v;
  //   }
  //   this._keys={};
  //   var v="";
  //   var l=1;
  //   for(var i=0;i<ks.length;i++){
  //     var k=ks[i];
  //     this._keys[k.k]=k.nk;
  //     if (k.nk.length>l) {
  //       l=k.nk.length;
  //       v+=":";
  //     }
  //     v+=k.nk+k.k+",";
  //   }
  //   this._keyString=v.substring(0,v.length-1);
  // },
  // _buildString:function(o,_bKey){
  //   var _string="";
  //   if (_compressJSON._chkDataType(o,Array)) {
  //     _string+="["
  //     for(var i=0;i<o.length;i++){
  //       var v=o[i];
  //       if(v!==undefined){
  //         _string+=this._buildString(v);
  //         if (i+1<o.length) {
  //           _string+=",";
  //         }
  //       }
  //     }
  //     _string+="]";
  //   }else if (_compressJSON._chkDataType(o,Object)) {
  //     _string+="{"
  //     for(var k in o){
  //       var v=o[k];
  //       if(v!==undefined){
  //         _string+=this._buildString(k,true);
  //         v=this._buildString(v);
  //         if (v[0]!="{" && v[0]!="[") {
  //           _string+=":";
  //         }
  //         _string+=v+",";
  //       }
  //     }
  //     if(_string[_string.length-1]==","){
  //       _string=_string.substring(0,_string.length-1);
  //     }
  //     _string+="}";
  //   }else if (o=="null" && !_bKey) {
  //     _string= "'null'";
  //   }else if (JSON.stringify(o)=="null") {
  //     _string= "null";
  //   }else if (JSON.stringify(o)=="\"\"") {
  //     _string= "''";
  //   }else if (JSON.stringify(o)=="0") {
  //     _string=0;
  //   }else if (o=="''") {
  //     _string= "\\'\\'";
  //   }else if (o=="\\'\\'") {
  //     _string= "\\\\'\\\\'";
  //   }else if(typeof o=="string" || (o=="object" && JSON.stringify(o)[0]=='"')){
  //     if (o=="object" && JSON.stringify(o)[0]=='"') {
  //       o=JSON.stringify(o);
  //     }
  //     o=_compressJSON._convertToEntities(o);
  //     var ws=o.split(this._WS_REGEXP);
  //     var ms=null;
  //     if (_bKey) {
  //       ms=o.match(/[^\.\[\]a-zA-Z0-9_\u4E00-\u9FCC]+/);
  //       // if (ms){
  //         // ms=o.match(/(\&\#[0-9]+\;)+/g)
  //         // if(!ms||ms[0]!=o){
  //           // throw new Error(_bzMessage._system._error._keyFormat);
  //         // }
  //       // }
  //       ms=[];
  //     }else{
  //       ms=o.split(this._MS_REGEXP);
  //     }
  //     for(var i=0;i<ws.length;i++){
  //       var w=this._keys[ws[i]];
  //       if (w) {
  //         ws[i]=w;
  //       }
  //     }
  //     for(var i=0;i<ms.length;i++){
  //       var w=ms[i];
  //       var ww="";
  //       if (w) {
  //         for(var n=0;n<w.length;n++){
  //           if ("\\{}[],".indexOf(w[n])>=0) {
  //             ww+="\\";
  //           }
  //           ww+=w[n];
  //         }
  //         ms[i]=ww;
  //       }
  //     }
  //     var s1=ws;
  //     var s2=ms;
  //     if (s2.length>s1.length) {
  //       s1=ms;
  //       s2=ws;
  //     }else if (s2.length==s1.length && !s2[0]) {
  //       s1=ms;
  //       s2=ws;
  //     }
  //     for(var i=0;i<s1.length;i++){
  //       _string+=s1[i];
  //       if (s2.length>i) {
  //         _string+=s2[i];
  //       }
  //     }

  //     if (!_bKey) {
  //       if (parseFloat(o)+""==o) {
  //         _string="'"+_string+"'";
  //       }else if (o=="true" || o=="false") {
  //         _string="'"+_string+"'";
  //       }else if (Date.parse(o)) {
  //         if(JSON.stringify(new Date(o)).indexOf(o)>=0){
  //           _string="'"+_string+"'";
  //         }
  //       }
  //     }
  //   }else if(_compressJSON._isNumber(o)){
  //     o=JSON.stringify(o);
      
  //     var w=this._buildString(o);
  //     o=w.replace(/'/g,"");
  //     _string= o;
  //   }else if(_compressJSON._chkDataType(o,Date)){
  //     eval("o="+JSON.stringify(o));
  //     var w=this._buildString(o);
  //     o=w.replace(/'/g,"");
  //     _string= o;
  //   }else if(_compressJSON._chkDataType(o,Boolean)){
  //     _string=o.toString();
  //   }
  //   return _string;
  // },
  _chkDataType:function(o,t){
    return o!==undefined&&o!=null&&o.constructor==t
  },
  // _isNumber:function(o){
  //   return o!==undefined&&o!=null&&(o.constructor==Number||(o.constructor==String&&o.match(/^[-0-9\.]+$/)))
  // },
  // _isStringOnlyObject:function(o){
  //   for(var k in o){
  //     var v=o[k];
  //     if(_compressJSON._chkDataType(o,Object) || _compressJSON._chkDataType(o,Array)){
  //       if(!this._isStringOnlyObject(v)){
  //         return false;
  //       }
  //     }else if(!_compressJSON._chkDataType(o,String)){
  //       return false;
  //     }
  //   }
  //   return true;
  // },
  _compress:function(o){
    return JSON.stringify(o)
//     var t=Date.now();
//     if (!_compressJSON._chkDataType(o,Object) && !_compressJSON._chkDataType(o,Array)) {
//       if(this._isBZCompressedData(o)){
//         return o;
//       }
//       return JSON.stringify(o);
//     }

//     this._init(o);
//     this._pareparyCompressKeys();
//     var v=this._keyString;
    
//     try{
//       v=this._version+":"+v+this._buildString(o);
//       if(this._string.length<v.length){
//         return this._string;
//       }
//       var t1=Date.now();
//       var no=this._unCompress(v);
//       /* debug *
// //      console.log("Compress time: "+(t1-t));
// //      console.log("UnCompress time: "+(Date.now()-t1));
// //      console.log("Result: "+(this._string==_compressJSON._convertToEntities(JSON.stringify(no))));
// //      console.log("old length: "+this._string.length);
// //      console.log("new length: "+v.length);
// //      console.log("%: "+(this._string.length-v.length)/this._string.length);
// //      console.log(v);
// //      console.log(this._keys);
//       /**/
//       if(this._string!=_compressJSON._convertToEntities(JSON.stringify(no))){
//         return this._string;
//       }
//       return v;
//     }catch(e){
//       _Util._alertMessage(e.message,e);
//     }
  },
  _pareparyUnCompressKeys:function(ks){
    ks=ks.split(":");
    this._keys={};
    var _MARK="";
    for(var i=0;i<ks.length;i++){
      var k=ks[i];
      var ii=i+1;
      var ws=k.split(",");
      for(var n=0;n<ws.length;n++){
        var w=ws[n];
        this._keys[w.substring(0,ii)]=w.substring(ii);
        if(ii==1 && w.substring(0,ii).match(/[^a-zA-Z0-9-_]/)){
          _MARK+=w.substring(0,ii);
        }
      }
    }
    this._WS_REGEXP=new RegExp("[^a-zA-Z0-9-_"+_MARK+"]+");
    this._MS_REGEXP=new RegExp("[a-zA-Z0-9-_"+_MARK+"]+");
  },
  _handleObjValue:function(v){
    if(v){
      if(v.constructor==Object && v.constructor==Array){
        for(var k in v){
          v[k]=this._handleObjValue(v[k]);
        }
      }else{
        return _compressJSON._unConvert(v);
      }
    }
    return v;
  },
  _unCompress:function(v){
    if(!v || _compressJSON._chkDataType(v,Object)|| _compressJSON._chkDataType(v,Array)){
      return v;
    }
    var o=null;
    if(v.indexOf(this._version)==0){
      v=v.substring(this._version.length+1);
    }else{
      try{
        var _toTranslate=v.includes("&#");
        eval("v="+v);
        if(_toTranslate){
          v=this._handleObjValue(v);
        }
        return v;
      }catch(e){
        if(_Util && _Util._alertMessage){
          _Util._alertMessage(_bzMessage._system._error._dataFormat);
        }
        return;
      }
    }
    if (v && v[0]=='"') {
      eval("o="+v);
      return o;
    }else{
      var i=v.indexOf("{");
      var ii=v.indexOf("[");
      if ((i>ii && ii>=0) || i==-1) {
        i=ii;
      }
      this._pareparyUnCompressKeys(v.substring(0,i));
      var ws=v.substring(i);
      o=this._buildObj(ws);
      return o;
    }
  },
  _getOldWord:function(k){
    var v=this._keys[k];
    if (v) {
      return v;
    }else{
      return k;
    }
  },
  _insertNewObj:function(_objs,_key,o){
    var _obj=_objs[0];
    if (!_obj) {
      _objs.unshift(o);
    }else if (_key+"") {
      _key=this._getOldWord(_key);
      _obj[_key]=o;
      _objs.unshift(_obj[_key]);
    }else{
      _obj.push(o);
      _objs.unshift(o);
    }
  },
  _handleValue:function(v){
    if (v=="'null'") {
      return "null";
    }else if (v=="null") {
      return null;
    }else if (v=="''") {
      return ""
    }else if (v=="\\'\\'") {
      return "''";
    }else if (v=="\\\\'\\\\'") {
      return "\\'\\'";
    }else{
      var ws=v.split(this._WS_REGEXP);
      var ms=v.split(this._MS_REGEXP);
      v="";
      for(var i=0;i<ws.length;i++){
        ws[i]=this._getOldWord(ws[i]);
      }
      var s1=ws;
      var s2=ms;
      
      if (s2.length>s1.length) {
        s1=ms;
        s2=ws;
      }else if (s2.length==s1.length && !s2[0]) {
        s1=ms;
        s2=ws;
      }
      
      for(var i=0;i<s1.length;i++){
        v+=s1[i];
        if (s2.length>i) {
          v+=s2[i];
        }
      }

      if (v[0]=="'") {
        try{
          var w="";
          eval("w="+v);
          v=w;
        }catch(e){}
      }else if (parseFloat(v)+""==v) {
        return parseFloat(v);
      }else if (v=="true") {
        return true;
      }else if (v=="false") {
        return false;
      }else if(Date.parse(v)){
        if(JSON.stringify(new Date(v)).indexOf(v)>=0){
          return new Date(v);
        }
      }
    }
    v=_compressJSON._unConvert(v);
    return v;
  },
  _buildObj:function(ws){
    var _lastObj=null;
    var _objs=[];
    var _key="";
    var _value=undefined;
    var _braces=[];
    var _brackets=[];
    var _afterBack=false;
    var _inKey=false;
    for(var i=0;i<ws.length;i++){
      var w=ws[i];
      if (w=="\\") {
        _afterBack=!_afterBack;
        if (_afterBack) {
          continue;
        }
      }else if (w=="{") {
        if (!_afterBack) {
          this._insertNewObj(_objs,_key,{});
          _key="";
          _value=undefined;
          _inKey=true;
          continue;
        }
      }else if (w=="[") {
        if (!_afterBack) {
          this._insertNewObj(_objs,_key,[]);
          _key="";
          _value=undefined;
          _inKey=false;
          continue;
        }
      }else if (w==":") {
        if (_inKey) {
          _inKey=false;
          _value=undefined;
          continue;
        }
      }else if (w=="}") {
        if (!_afterBack) {
          if (_key && _value!==undefined) {
            _key=this._getOldWord(_key);
            _objs[0][_key]=this._handleValue(_value);
          }
          _lastObj=_objs.shift();
          _key="";
          _value=undefined;
          if (_compressJSON._chkDataType(_objs[0],Array)) {
            _inKey=false;
          }else{
            _inKey=true;
          }
          continue;
        }
      }else if (w=="]") {
        if (!_afterBack) {
          if (_value!=undefined) {
            _objs[0].push(this._handleValue(_value));
            _value=undefined;
          }
          _lastObj=_objs.shift();
          if (_compressJSON._chkDataType(_objs[0],Array)) {
            _inKey=false;
          }else{
            _inKey=true;
          }
          continue;
        }
      }else if (w==",") {
        if (!_afterBack) {
          if (_value&&_compressJSON._chkDataType(_objs[0],Array)) {
            if (_value!=undefined) {
              _objs[0].push(this._handleValue(_value));
            }
          }else if(_key && _value!==undefined){
            _key=this._getOldWord(_key);
            _objs[0][_key]=this._handleValue(_value);
            _inKey=true;
          }
          _key="";
          _value=undefined;
          continue;
        }
      }
      if (_inKey) {
        _key+=w;
      }else if(_value!=undefined){
        _value+=w;
      }else{
        _value=w;
      }
      if (_afterBack) {
        _afterBack=false;
      }
    }
    return _lastObj;
  }
}

try{
  exports._compress =_compressJSON;
}catch(e){};/*jQuery*/
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=a.document,e=c.slice,f=c.concat,g=c.push,h=c.indexOf,i={},j=i.toString,k=i.hasOwnProperty,l={},m="1.12.4",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return e.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:e.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a){return n.each(this,a)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(e.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(n.isPlainObject(c)||(b=n.isArray(c)))?(b?(b=!1,f=a&&n.isArray(a)?a:[]):f=a&&n.isPlainObject(a)?a:{},g[d]=n.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray||function(a){return"array"===n.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){var b=a&&a.toString();return!n.isArray(a)&&b-parseFloat(b)+1>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==n.type(a)||a.nodeType||n.isWindow(a))return!1;try{if(a.constructor&&!k.call(a,"constructor")&&!k.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(!l.ownFirst)for(b in a)return k.call(a,b);for(b in a);return void 0===b||k.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?i[j.call(a)]||"object":typeof a},globalEval:function(b){b&&n.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,d=0;if(s(a)){for(c=a.length;c>d;d++)if(b.call(a[d],d,a[d])===!1)break}else for(d in a)if(b.call(a[d],d,a[d])===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):g.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(h)return h.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,g=0,h=[];if(s(a))for(d=a.length;d>g;g++)e=b(a[g],g,c),null!=e&&h.push(e);else for(g in a)e=b(a[g],g,c),null!=e&&h.push(e);return f.apply([],h)},guid:1,proxy:function(a,b){var c,d,f;return"string"==typeof b&&(f=a[b],b=a,a=f),n.isFunction(a)?(c=e.call(arguments,2),d=function(){return a.apply(b||this,c.concat(e.call(arguments)))},d.guid=a.guid=a.guid||n.guid++,d):void 0},now:function(){return+new Date},support:l}),"function"==typeof Symbol&&(n.fn[Symbol.iterator]=c[Symbol.iterator]),n.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){i["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=!!a&&"length"in a&&a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ga(),z=ga(),A=ga(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+M+"))|)"+L+"*\\]",O=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+N+")*)|.*)\\)|)",P=new RegExp(L+"+","g"),Q=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),R=new RegExp("^"+L+"*,"+L+"*"),S=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),T=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),U=new RegExp(O),V=new RegExp("^"+M+"$"),W={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M+"|[*])"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},X=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,_=/[+~]/,aa=/'|\\/g,ba=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),ca=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},da=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(ea){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function fa(a,b,d,e){var f,h,j,k,l,o,r,s,w=b&&b.ownerDocument,x=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==x&&9!==x&&11!==x)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==x&&(o=$.exec(a)))if(f=o[1]){if(9===x){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(w&&(j=w.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(o[2])return H.apply(d,b.getElementsByTagName(a)),d;if((f=o[3])&&c.getElementsByClassName&&b.getElementsByClassName)return H.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==x)w=b,s=a;else if("object"!==b.nodeName.toLowerCase()){(k=b.getAttribute("id"))?k=k.replace(aa,"\\$&"):b.setAttribute("id",k=u),r=g(a),h=r.length,l=V.test(k)?"#"+k:"[id='"+k+"']";while(h--)r[h]=l+" "+qa(r[h]);s=r.join(","),w=_.test(a)&&oa(b.parentNode)||b}if(s)try{return H.apply(d,w.querySelectorAll(s)),d}catch(y){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(Q,"$1"),b,d,e)}function ga(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ha(a){return a[u]=!0,a}function ia(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ja(a,b){var c=a.split("|"),e=c.length;while(e--)d.attrHandle[c[e]]=b}function ka(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function la(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function na(a){return ha(function(b){return b=+b,ha(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function oa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=fa.support={},f=fa.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=fa.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=n.documentElement,p=!f(n),(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ia(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ia(function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Z.test(n.getElementsByClassName),c.getById=ia(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return"undefined"!=typeof b.getElementsByClassName&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=Z.test(n.querySelectorAll))&&(ia(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ia(function(a){var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=Z.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ia(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",O)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Z.test(o.compareDocumentPosition),t=b||Z.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return ka(a,b);c=a;while(c=c.parentNode)g.unshift(c);c=b;while(c=c.parentNode)h.unshift(c);while(g[d]===h[d])d++;return d?ka(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},fa.matches=function(a,b){return fa(a,null,null,b)},fa.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(T,"='$1']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fa(b,n,null,[a]).length>0},fa.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fa.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fa.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fa.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=fa.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=fa.selectors={cacheLength:50,createPseudo:ha,match:W,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ba,ca),a[3]=(a[3]||a[4]||a[5]||"").replace(ba,ca),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fa.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fa.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return W.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&U.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ba,ca).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fa.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(P," ")+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){while(p){m=b;while(m=m[p])if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){m=q,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n&&j[2],m=n&&q.childNodes[n];while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(m=b,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n),t===!1)while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if((h?m.nodeName.toLowerCase()===r:1===m.nodeType)&&++t&&(s&&(l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[w,t]),m===b))break;return t-=e,t===d||t%d===0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fa.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ha(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ha(function(a){var b=[],c=[],d=h(a.replace(Q,"$1"));return d[u]?ha(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ha(function(a){return function(b){return fa(a,b).length>0}}),contains:ha(function(a){return a=a.replace(ba,ca),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ha(function(a){return V.test(a||"")||fa.error("unsupported lang: "+a),a=a.replace(ba,ca).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Y.test(a.nodeName)},input:function(a){return X.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:na(function(){return[0]}),last:na(function(a,b){return[b-1]}),eq:na(function(a,b,c){return[0>c?c+b:c]}),even:na(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:na(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:na(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:na(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=la(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=ma(b);function pa(){}pa.prototype=d.filters=d.pseudos,d.setFilters=new pa,g=fa.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){c&&!(e=R.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=S.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(Q," ")}),h=h.slice(c.length));for(g in d.filter)!(e=W[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fa.error(a):z(a,i).slice(0)};function qa(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function ra(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(j=b[u]||(b[u]={}),i=j[b.uniqueID]||(j[b.uniqueID]={}),(h=i[d])&&h[0]===w&&h[1]===f)return k[2]=h[2];if(i[d]=k,k[2]=a(b,c,g))return!0}}}function sa(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ta(a,b,c){for(var d=0,e=b.length;e>d;d++)fa(a,b[d],c);return c}function ua(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function va(a,b,c,d,e,f){return d&&!d[u]&&(d=va(d)),e&&!e[u]&&(e=va(e,f)),ha(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ta(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ua(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=ua(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ua(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function wa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ra(function(a){return a===b},h,!0),l=ra(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[ra(sa(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return va(i>1&&sa(m),i>1&&qa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(Q,"$1"),c,e>i&&wa(a.slice(i,e)),f>e&&wa(a=a.slice(e)),f>e&&qa(a))}m.push(c)}return sa(m)}function xa(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){o=0,g||l.ownerDocument===n||(m(l),h=!p);while(q=a[o++])if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){o=0;while(q=b[o++])q(t,u,g,h);if(f){if(r>0)while(s--)t[s]||u[s]||(u[s]=F.call(i));u=ua(u)}H.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&fa.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ha(f):f}return h=fa.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=wa(b[c]),f[u]?d.push(f):e.push(f);f=A(a,xa(e,d)),f.selector=a}return f},i=fa.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(ba,ca),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=W.needsContext.test(a)?0:j.length;
jQuery._inHidden=0;
j.sort((a,b)=>{
  if(a.type==b.type){
    if(a.type=="PSEUDO"){
      if(a.matches[0]=="hidden"){
        jQuery._inHidden=1;
        return -1
      }else if(b.matches[0]=="hidden"){
        jQuery._inHidden=1;
        return 1
      }
      if(a.matches[0]=="attr"){
        return -1
      }else if(b.matches[0]=="attr"){
        return 1
      }
    }
  }else if(a.type=="PSEUDO"){
    return 1
  }else if(b.type=="PSEUDO"){
    return -1
  }
  return 0
});
while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(ba,ca),_.test(j[0].type)&&oa(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&qa(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,!b||_.test(a)&&oa(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ia(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ia(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ja("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ia(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ja("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ia(function(a){return null==a.getAttribute("disabled")})||ja(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fa}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.uniqueSort=n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},v=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},w=n.expr.match.needsContext,x=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,y=/^.[^:#\[\.,]*$/;function z(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(y.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return n.inArray(a,b)>-1!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a,_panel){jQuery.tmpPanel=_panel;var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;e>b;b++)if(n.contains(d[b],this))return!0}));for(b=0;e>b;b++)n.find(a,d[b],c);return c=this.pushStack(e>1?n.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(z(this,a||[],!1))},not:function(a){return this.pushStack(z(this,a||[],!0))},is:function(a){return!!z(this,"string"==typeof a&&w.test(a)?n(a):a||[],!1).length}});var A,B=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=n.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||A,"string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:B.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),x.test(e[1])&&n.isPlainObject(b))for(e in b)n.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}if(f=d.getElementById(e[2]),f&&f.parentNode){if(f.id!==e[2])return A.find(a);this.length=1,this[0]=f}return this.context=d,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof c.ready?c.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};C.prototype=n.fn,A=n(d);var D=/^(?:parents|prev(?:Until|All))/,E={children:!0,contents:!0,next:!0,prev:!0};n.fn.extend({has:function(a){var b,c=n(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(n.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=w.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?n.inArray(this[0],n(a)):n.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.uniqueSort(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function F(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return u(a,"parentNode")},parentsUntil:function(a,b,c){return u(a,"parentNode",c)},next:function(a){return F(a,"nextSibling")},prev:function(a){return F(a,"previousSibling")},nextAll:function(a){return u(a,"nextSibling")},prevAll:function(a){return u(a,"previousSibling")},nextUntil:function(a,b,c){return u(a,"nextSibling",c)},prevUntil:function(a,b,c){return u(a,"previousSibling",c)},siblings:function(a){return v((a.parentNode||{}).firstChild,a)},children:function(a){return v(a.firstChild)},contents:function(a){return n.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(E[a]||(e=n.uniqueSort(e)),D.test(a)&&(e=e.reverse())),this.pushStack(e)}});var G=/\S+/g;function H(a){var b={};return n.each(a.match(G)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?H(a):n.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=a.once,d=b=!0;g.length;h=-1){c=g.shift();while(++h<f.length)f[h].apply(c[0],c[1])===!1&&a.stopOnFalse&&(h=f.length,c=!1)}a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){n.each(b,function(b,c){n.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==n.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return n.each(arguments,function(a,b){var c;while((c=n.inArray(b,f,c))>-1)f.splice(c,1),h>=c&&h--}),this},has:function(a){return a?n.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=!0,c||j.disable(),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().progress(c.notify).done(c.resolve).fail(c.reject):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=e.call(arguments),d=c.length,f=1!==d||a&&n.isFunction(a.promise)?d:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?e.call(arguments):d,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(d>1)for(i=new Array(d),j=new Array(d),k=new Array(d);d>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().progress(h(b,j,i)).done(h(b,k,c)).fail(g.reject):--f;return f||g.resolveWith(k,c),g.promise()}});var I;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(I.resolveWith(d,[n]),n.fn.triggerHandler&&(n(d).triggerHandler("ready"),n(d).off("ready"))))}});function J(){d.addEventListener?(d.removeEventListener("DOMContentLoaded",K),a.removeEventListener("load",K)):(d.detachEvent("onreadystatechange",K),a.detachEvent("onload",K))}function K(){(d.addEventListener||"load"===a.event.type||"complete"===d.readyState)&&(J(),n.ready())}n.ready.promise=function(b){if(!I)if(I=n.Deferred(),"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll)a.setTimeout(n.ready);else if(d.addEventListener)d.addEventListener("DOMContentLoaded",K),a.addEventListener("load",K);else{d.attachEvent("onreadystatechange",K),a.attachEvent("onload",K);var c=!1;try{c=null==a.frameElement&&d.documentElement}catch(e){}c&&c.doScroll&&!function f(){if(!n.isReady){try{c.doScroll("left")}catch(b){return a.setTimeout(f,50)}J(),n.ready()}}()}return I.promise(b)},n.ready.promise();var L;for(L in n(l))break;l.ownFirst="0"===L,l.inlineBlockNeedsLayout=!1,n(function(){var a,b,c,e;c=d.getElementsByTagName("body")[0],c&&c.style&&(b=d.createElement("div"),e=d.createElement("div"),e.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(e).appendChild(b),"undefined"!=typeof b.style.zoom&&(b.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",l.inlineBlockNeedsLayout=a=3===b.offsetWidth,a&&(c.style.zoom=1)),c.removeChild(e))}),function(){var a=d.createElement("div");l.deleteExpando=!0;try{delete a.test}catch(b){l.deleteExpando=!1}a=null}();var M=function(a){var b=n.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b},N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(O,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}n.data(a,b,c)}else c=void 0;
}return c}function Q(a){var b;for(b in a)if(("data"!==b||!n.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function R(a,b,d,e){if(M(a)){var f,g,h=n.expando,i=a.nodeType,j=i?n.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||n.guid++:h),j[k]||(j[k]=i?{}:{toJSON:n.noop}),"object"!=typeof b&&"function"!=typeof b||(e?j[k]=n.extend(j[k],b):j[k].data=n.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[n.camelCase(b)]=d),"string"==typeof b?(f=g[b],null==f&&(f=g[n.camelCase(b)])):f=g,f}}function S(a,b,c){if(M(a)){var d,e,f=a.nodeType,g=f?n.cache:a,h=f?a[n.expando]:n.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){n.isArray(b)?b=b.concat(n.map(b,n.camelCase)):b in d?b=[b]:(b=n.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;while(e--)delete d[b[e]];if(c?!Q(d):!n.isEmptyObject(d))return}(c||(delete g[h].data,Q(g[h])))&&(f?n.cleanData([a],!0):l.deleteExpando||g!=g.window?delete g[h]:g[h]=void 0)}}}n.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?n.cache[a[n.expando]]:a[n.expando],!!a&&!Q(a)},data:function(a,b,c){return R(a,b,c)},removeData:function(a,b){return S(a,b)},_data:function(a,b,c){return R(a,b,c,!0)},_removeData:function(a,b){return S(a,b,!0)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=n.data(f),1===f.nodeType&&!n._data(f,"parsedAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d])));n._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){n.data(this,a)}):arguments.length>1?this.each(function(){n.data(this,a,b)}):f?P(f,a,n.data(f,a)):void 0},removeData:function(a){return this.each(function(){n.removeData(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=n._data(a,b),c&&(!d||n.isArray(c)?d=n._data(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return n._data(a,c)||n._data(a,c,{empty:n.Callbacks("once memory").add(function(){n._removeData(a,b+"queue"),n._removeData(a,c)})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=n._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}}),function(){var a;l.shrinkWrapBlocks=function(){if(null!=a)return a;a=!1;var b,c,e;return c=d.getElementsByTagName("body")[0],c&&c.style?(b=d.createElement("div"),e=d.createElement("div"),e.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(e).appendChild(b),"undefined"!=typeof b.style.zoom&&(b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",b.appendChild(d.createElement("div")).style.width="5px",a=3!==b.offsetWidth),c.removeChild(e),a):void 0}}();var T=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,U=new RegExp("^(?:([+-])=|)("+T+")([a-z%]*)$","i"),V=["Top","Right","Bottom","Left"],W=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)};function X(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return n.css(a,b,"")},i=h(),j=c&&c[3]||(n.cssNumber[b]?"":"px"),k=(n.cssNumber[b]||"px"!==j&&+i)&&U.exec(n.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||".5",k/=f,n.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var Y=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)Y(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},Z=/^(?:checkbox|radio)$/i,$=/<([\w:-]+)/,_=/^$|\/(?:java|ecma)script/i,aa=/^\s+/,ba="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video";function ca(a){var b=ba.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}!function(){var a=d.createElement("div"),b=d.createDocumentFragment(),c=d.createElement("input");a.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",l.leadingWhitespace=3===a.firstChild.nodeType,l.tbody=!a.getElementsByTagName("tbody").length,l.htmlSerialize=!!a.getElementsByTagName("link").length,l.html5Clone="<:nav></:nav>"!==d.createElement("nav").cloneNode(!0).outerHTML,c.type="checkbox",c.checked=!0,b.appendChild(c),l.appendChecked=c.checked,a.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!a.cloneNode(!0).lastChild.defaultValue,b.appendChild(a),c=d.createElement("input"),c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),a.appendChild(c),l.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,l.noCloneEvent=!!a.addEventListener,a[n.expando]=1,l.attributes=!a.getAttribute(n.expando)}();var da={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:l.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};da.optgroup=da.option,da.tbody=da.tfoot=da.colgroup=da.caption=da.thead,da.th=da.td;function ea(a,b){var c,d,e=0,f="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||n.nodeName(d,b)?f.push(d):n.merge(f,ea(d,b));return void 0===b||b&&n.nodeName(a,b)?n.merge([a],f):f}function fa(a,b){for(var c,d=0;null!=(c=a[d]);d++)n._data(c,"globalEval",!b||n._data(b[d],"globalEval"))}var ga=/<|&#?\w+;/,ha=/<tbody/i;function ia(a){Z.test(a.type)&&(a.defaultChecked=a.checked)}function ja(a,b,c,d,e){for(var f,g,h,i,j,k,m,o=a.length,p=ca(b),q=[],r=0;o>r;r++)if(g=a[r],g||0===g)if("object"===n.type(g))n.merge(q,g.nodeType?[g]:g);else if(ga.test(g)){i=i||p.appendChild(b.createElement("div")),j=($.exec(g)||["",""])[1].toLowerCase(),m=da[j]||da._default,i.innerHTML=m[1]+n.htmlPrefilter(g)+m[2],f=m[0];while(f--)i=i.lastChild;if(!l.leadingWhitespace&&aa.test(g)&&q.push(b.createTextNode(aa.exec(g)[0])),!l.tbody){g="table"!==j||ha.test(g)?"<table>"!==m[1]||ha.test(g)?0:i:i.firstChild,f=g&&g.childNodes.length;while(f--)n.nodeName(k=g.childNodes[f],"tbody")&&!k.childNodes.length&&g.removeChild(k)}n.merge(q,i.childNodes),i.textContent="";while(i.firstChild)i.removeChild(i.firstChild);i=p.lastChild}else q.push(b.createTextNode(g));i&&p.removeChild(i),l.appendChecked||n.grep(ea(q,"input"),ia),r=0;while(g=q[r++])if(d&&n.inArray(g,d)>-1)e&&e.push(g);else if(h=n.contains(g.ownerDocument,g),i=ea(p.appendChild(g),"script"),h&&fa(i),c){f=0;while(g=i[f++])_.test(g.type||"")&&c.push(g)}return i=null,p}!function(){var b,c,e=d.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(l[b]=c in a)||(e.setAttribute(c,"t"),l[b]=e.attributes[c].expando===!1);e=null}();var ka=/^(?:input|select|textarea)$/i,la=/^key/,ma=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,na=/^(?:focusinfocus|focusoutblur)$/,oa=/^([^.]*)(?:\.(.+)|)/;function pa(){return!0}function qa(){return!1}function ra(){try{return d.activeElement}catch(a){}}function sa(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)sa(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),e===!1)e=qa;else if(!e)return a;return 1===f&&(g=e,e=function(a){return n().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=n.guid++)),a.each(function(){n.event.add(this,b,e,d,c)})}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n._data(a);if(r){c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=n.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return"undefined"==typeof n||a&&n.event.triggered===a.type?void 0:n.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(G)||[""],h=b.length;while(h--)f=oa.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=n.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=n.event.special[o]||{},l=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},i),(m=g[o])||(m=g[o]=[],m.delegateCount=0,j.setup&&j.setup.call(a,d,p,k)!==!1||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,l):m.push(l),n.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n.hasData(a)&&n._data(a);if(r&&(k=r.events)){b=(b||"").match(G)||[""],j=b.length;while(j--)if(h=oa.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=k[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;while(f--)g=m[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(k)&&(delete r.handle,n._removeData(a,"events"))}},trigger:function(b,c,e,f){var g,h,i,j,l,m,o,p=[e||d],q=k.call(b,"type")?b.type:b,r=k.call(b,"namespace")?b.namespace.split("."):[];if(i=m=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!na.test(q+n.event.triggered)&&(q.indexOf(".")>-1&&(r=q.split("."),q=r.shift(),r.sort()),h=q.indexOf(":")<0&&"on"+q,b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b),b.isTrigger=f?2:3,b.namespace=r.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:n.makeArray(c,[b]),l=n.event.special[q]||{},f||!l.trigger||l.trigger.apply(e,c)!==!1)){if(!f&&!l.noBubble&&!n.isWindow(e)){for(j=l.delegateType||q,na.test(j+q)||(i=i.parentNode);i;i=i.parentNode)p.push(i),m=i;m===(e.ownerDocument||d)&&p.push(m.defaultView||m.parentWindow||a)}o=0;while((i=p[o++])&&!b.isPropagationStopped())b.type=o>1?j:l.bindType||q,g=(n._data(i,"events")||{})[b.type]&&n._data(i,"handle"),g&&g.apply(i,c),g=h&&i[h],g&&g.apply&&M(i)&&(b.result=g.apply(i,c),b.result===!1&&b.preventDefault());if(b.type=q,!f&&!b.isDefaultPrevented()&&(!l._default||l._default.apply(p.pop(),c)===!1)&&M(e)&&h&&e[q]&&!n.isWindow(e)){m=e[h],m&&(e[h]=null),n.event.triggered=q;try{e[q]()}catch(s){}n.event.triggered=void 0,m&&(e[h]=m)}return b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,d,f,g,h=[],i=e.call(arguments),j=(n._data(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())a.rnamespace&&!a.rnamespace.test(g.namespace)||(a.handleObj=g,a.data=g.data,d=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&("click"!==a.type||isNaN(a.button)||a.button<1))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>-1:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[n.expando])return a;var b,c,e,f=a.type,g=a,h=this.fixHooks[f];h||(this.fixHooks[f]=h=ma.test(f)?this.mouseHooks:la.test(f)?this.keyHooks:{}),e=h.props?this.props.concat(h.props):this.props,a=new n.Event(g),b=e.length;while(b--)c=e[b],a[c]=g[c];return a.target||(a.target=g.srcElement||d),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,h.filter?h.filter(a,g):a},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,e,f,g=b.button,h=b.fromElement;return null==a.pageX&&null!=b.clientX&&(e=a.target.ownerDocument||d,f=e.documentElement,c=e.body,a.pageX=b.clientX+(f&&f.scrollLeft||c&&c.scrollLeft||0)-(f&&f.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(f&&f.scrollTop||c&&c.scrollTop||0)-(f&&f.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?b.toElement:h),a.which||void 0===g||(a.which=1&g?1:2&g?3:4&g?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ra()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===ra()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return n.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c){var d=n.extend(new n.Event,c,{type:a,isSimulated:!0});n.event.trigger(d,null,b),d.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=d.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)}:function(a,b,c){var d="on"+b;a.detachEvent&&("undefined"==typeof a[d]&&(a[d]=null),a.detachEvent(d,c))},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?pa:qa):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={constructor:n.Event,isDefaultPrevented:qa,isPropagationStopped:qa,isImmediatePropagationStopped:qa,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=pa,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=pa,a&&!this.isSimulated&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=pa,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||n.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),l.submit||(n.event.special.submit={setup:function(){return n.nodeName(this,"form")?!1:void n.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=n.nodeName(b,"input")||n.nodeName(b,"button")?n.prop(b,"form"):void 0;c&&!n._data(c,"submit")&&(n.event.add(c,"submit._submit",function(a){a._submitBubble=!0}),n._data(c,"submit",!0))})},postDispatch:function(a){a._submitBubble&&(delete a._submitBubble,this.parentNode&&!a.isTrigger&&n.event.simulate("submit",this.parentNode,a))},teardown:function(){return n.nodeName(this,"form")?!1:void n.event.remove(this,"._submit")}}),l.change||(n.event.special.change={setup:function(){return ka.test(this.nodeName)?("checkbox"!==this.type&&"radio"!==this.type||(n.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._justChanged=!0)}),n.event.add(this,"click._change",function(a){this._justChanged&&!a.isTrigger&&(this._justChanged=!1),n.event.simulate("change",this,a)})),!1):void n.event.add(this,"beforeactivate._change",function(a){var b=a.target;ka.test(b.nodeName)&&!n._data(b,"change")&&(n.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||n.event.simulate("change",this.parentNode,a)}),n._data(b,"change",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return n.event.remove(this,"._change"),!ka.test(this.nodeName)}}),l.focusin||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a))};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=n._data(d,b);e||d.addEventListener(a,c,!0),n._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=n._data(d,b)-1;e?n._data(d,b,e):(d.removeEventListener(a,c,!0),n._removeData(d,b))}}}),n.fn.extend({on:function(a,b,c,d){return sa(this,a,b,c,d)},one:function(a,b,c,d){return sa(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return b!==!1&&"function"!=typeof b||(c=b,b=void 0),c===!1&&(c=qa),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});var ta=/ jQuery\d+="(?:null|\d+)"/g,ua=new RegExp("<(?:"+ba+")[\\s/>]","i"),va=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,wa=/<script|<style|<link/i,xa=/checked\s*(?:[^=]|=\s*.checked.)/i,ya=/^true\/(.*)/,za=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Aa=ca(d),Ba=Aa.appendChild(d.createElement("div"));function Ca(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function Da(a){return a.type=(null!==n.find.attr(a,"type"))+"/"+a.type,a}function Ea(a){var b=ya.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Fa(a,b){if(1===b.nodeType&&n.hasData(a)){var c,d,e,f=n._data(a),g=n._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)n.event.add(b,c,h[c][d])}g.data&&(g.data=n.extend({},g.data))}}function Ga(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!l.noCloneEvent&&b[n.expando]){e=n._data(b);for(d in e.events)n.removeEvent(b,d,e.handle);b.removeAttribute(n.expando)}"script"===c&&b.text!==a.text?(Da(b).text=a.text,Ea(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),l.html5Clone&&a.innerHTML&&!n.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&Z.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}}function Ha(a,b,c,d){b=f.apply([],b);var e,g,h,i,j,k,m=0,o=a.length,p=o-1,q=b[0],r=n.isFunction(q);if(r||o>1&&"string"==typeof q&&!l.checkClone&&xa.test(q))return a.each(function(e){var f=a.eq(e);r&&(b[0]=q.call(this,e,f.html())),Ha(f,b,c,d)});if(o&&(k=ja(b,a[0].ownerDocument,!1,a,d),e=k.firstChild,1===k.childNodes.length&&(k=e),e||d)){for(i=n.map(ea(k,"script"),Da),h=i.length;o>m;m++)g=k,m!==p&&(g=n.clone(g,!0,!0),h&&n.merge(i,ea(g,"script"))),c.call(a[m],g,m);if(h)for(j=i[i.length-1].ownerDocument,n.map(i,Ea),m=0;h>m;m++)g=i[m],_.test(g.type||"")&&!n._data(g,"globalEval")&&n.contains(j,g)&&(g.src?n._evalUrl&&n._evalUrl(g.src):n.globalEval((g.text||g.textContent||g.innerHTML||"").replace(za,"")));k=e=null}return a}function Ia(a,b,c){for(var d,e=b?n.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||n.cleanData(ea(d)),d.parentNode&&(c&&n.contains(d.ownerDocument,d)&&fa(ea(d,"script")),d.parentNode.removeChild(d));return a}n.extend({htmlPrefilter:function(a){return a.replace(va,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h,i=n.contains(a.ownerDocument,a);if(l.html5Clone||n.isXMLDoc(a)||!ua.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(Ba.innerHTML=a.outerHTML,Ba.removeChild(f=Ba.firstChild)),!(l.noCloneEvent&&l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(d=ea(f),h=ea(a),g=0;null!=(e=h[g]);++g)d[g]&&Ga(e,d[g]);if(b)if(c)for(h=h||ea(a),d=d||ea(f),g=0;null!=(e=h[g]);g++)Fa(e,d[g]);else Fa(a,f);return d=ea(f,"script"),d.length>0&&fa(d,!i&&ea(a,"script")),d=h=e=null,f},cleanData:function(a,b){for(var d,e,f,g,h=0,i=n.expando,j=n.cache,k=l.attributes,m=n.event.special;null!=(d=a[h]);h++)if((b||M(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)m[e]?n.event.remove(d,e):n.removeEvent(d,e,g.handle);j[f]&&(delete j[f],k||"undefined"==typeof d.removeAttribute?d[i]=void 0:d.removeAttribute(i),c.push(f))}}}),n.fn.extend({domManip:Ha,detach:function(a){return Ia(this,a,!0)},remove:function(a){return Ia(this,a)},text:function(a){return Y(this,function(a){return void 0===a?n.text(this):this.empty().append((this[0]&&this[0].ownerDocument||d).createTextNode(a))},null,a,arguments.length)},append:function(){return Ha(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ca(this,a);b.appendChild(a)}})},prepend:function(){return Ha(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ca(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return Ha(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return Ha(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){1===a.nodeType&&n.cleanData(ea(a,!1));while(a.firstChild)a.removeChild(a.firstChild);a.options&&n.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return Y(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(ta,""):void 0;if("string"==typeof a&&!wa.test(a)&&(l.htmlSerialize||!ua.test(a))&&(l.leadingWhitespace||!aa.test(a))&&!da[($.exec(a)||["",""])[1].toLowerCase()]){a=n.htmlPrefilter(a);try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(ea(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return Ha(this,arguments,function(b){var c=this.parentNode;n.inArray(this,a)<0&&(n.cleanData(ea(this)),c&&c.replaceChild(b,this))},a)}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=0,e=[],f=n(a),h=f.length-1;h>=d;d++)c=d===h?this:this.clone(!0),n(f[d])[b](c),g.apply(e,c.get());return this.pushStack(e)}});var Ja,Ka={HTML:"block",BODY:"block"};function La(a,b){var c=n(b.createElement(a)).appendTo(b.body),d=n.css(c[0],"display");return c.detach(),d}function Ma(a){var b=d,c=Ka[a];return c||(c=La(a,b),"none"!==c&&c||(Ja=(Ja||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(Ja[0].contentWindow||Ja[0].contentDocument).document,b.write(),b.close(),c=La(a,b),Ja.detach()),Ka[a]=c),c}var Na=/^margin/,Oa=new RegExp("^("+T+")(?!px)[a-z%]+$","i"),Pa=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e},Qa=d.documentElement;!function(){var b,c,e,f,g,h,i=d.createElement("div"),j=d.createElement("div");if(j.style){j.style.cssText="float:left;opacity:.5",l.opacity="0.5"===j.style.opacity,l.cssFloat=!!j.style.cssFloat,j.style.backgroundClip="content-box",j.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===j.style.backgroundClip,i=d.createElement("div"),i.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",j.innerHTML="",i.appendChild(j),l.boxSizing=""===j.style.boxSizing||""===j.style.MozBoxSizing||""===j.style.WebkitBoxSizing,n.extend(l,{reliableHiddenOffsets:function(){return null==b&&k(),f},boxSizingReliable:function(){return null==b&&k(),e},pixelMarginRight:function(){return null==b&&k(),c},pixelPosition:function(){return null==b&&k(),b},reliableMarginRight:function(){return null==b&&k(),g},reliableMarginLeft:function(){return null==b&&k(),h}});function k(){var k,l,m=d.documentElement;m.appendChild(i),j.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",b=e=h=!1,c=g=!0,a.getComputedStyle&&(l=a.getComputedStyle(j),b="1%"!==(l||{}).top,h="2px"===(l||{}).marginLeft,e="4px"===(l||{width:"4px"}).width,j.style.marginRight="50%",c="4px"===(l||{marginRight:"4px"}).marginRight,k=j.appendChild(d.createElement("div")),k.style.cssText=j.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",k.style.marginRight=k.style.width="0",j.style.width="1px",g=!parseFloat((a.getComputedStyle(k)||{}).marginRight),j.removeChild(k)),j.style.display="none",f=0===j.getClientRects().length,f&&(j.style.display="",j.innerHTML="<table><tr><td></td><td>t</td></tr></table>",j.childNodes[0].style.borderCollapse="separate",k=j.getElementsByTagName("td"),k[0].style.cssText="margin:0;border:0;padding:0;display:none",f=0===k[0].offsetHeight,f&&(k[0].style.display="",k[1].style.display="none",f=0===k[0].offsetHeight)),m.removeChild(i)}}}();var Ra,Sa,Ta=/^(top|right|bottom|left)$/;a.getComputedStyle?(Ra=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)},Sa=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ra(a),g=c?c.getPropertyValue(b)||c[b]:void 0,""!==g&&void 0!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),c&&!l.pixelMarginRight()&&Oa.test(g)&&Na.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f),void 0===g?g:g+""}):Qa.currentStyle&&(Ra=function(a){return a.currentStyle},Sa=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ra(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),Oa.test(g)&&!Ta.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});function Ua(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}var Va=/alpha\([^)]*\)/i,Wa=/opacity\s*=\s*([^)]*)/i,Xa=/^(none|table(?!-c[ea]).+)/,Ya=new RegExp("^("+T+")(.*)$","i"),Za={position:"absolute",visibility:"hidden",display:"block"},$a={letterSpacing:"0",fontWeight:"400"},_a=["Webkit","O","Moz","ms"],ab=d.createElement("div").style;function bb(a){if(a in ab)return a;var b=a.charAt(0).toUpperCase()+a.slice(1),c=_a.length;while(c--)if(a=_a[c]+b,a in ab)return a}function cb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=n._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&W(d)&&(f[g]=n._data(d,"olddisplay",Ma(d.nodeName)))):(e=W(d),(c&&"none"!==c||!e)&&n._data(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function db(a,b,c){var d=Ya.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function eb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+V[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+V[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+V[f]+"Width",!0,e))):(g+=n.css(a,"padding"+V[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+V[f]+"Width",!0,e)));return g}function fb(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ra(a),g=l.boxSizing&&"border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Sa(a,b,f),(0>e||null==e)&&(e=a.style[b]),Oa.test(e))return e;d=g&&(l.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+eb(a,b,c||(g?"border":"content"),d,f)+"px"}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Sa(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":l.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;if(b=n.cssProps[h]||(n.cssProps[h]=bb(h)||h),g=n.cssHooks[b]||n.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=U.exec(c))&&e[1]&&(c=X(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(n.cssNumber[h]?"":"px")),l.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=bb(h)||h),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Sa(a,b,d)),"normal"===f&&b in $a&&(f=$a[b]),""===c||c?(e=parseFloat(f),c===!0||isFinite(e)?e||0:f):f}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?Xa.test(n.css(a,"display"))&&0===a.offsetWidth?Pa(a,Za,function(){return fb(a,b,d)}):fb(a,b,d):void 0},set:function(a,c,d){var e=d&&Ra(a);return db(a,c,d?eb(a,b,d,l.boxSizing&&"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),l.opacity||(n.cssHooks.opacity={get:function(a,b){return Wa.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=n.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===n.trim(f.replace(Va,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Va.test(f)?f.replace(Va,e):f+" "+e)}}),n.cssHooks.marginRight=Ua(l.reliableMarginRight,function(a,b){return b?Pa(a,{display:"inline-block"},Sa,[a,"marginRight"]):void 0}),n.cssHooks.marginLeft=Ua(l.reliableMarginLeft,function(a,b){return b?(parseFloat(Sa(a,"marginLeft"))||(n.contains(a.ownerDocument,a)?a.getBoundingClientRect().left-Pa(a,{
marginLeft:0},function(){return a.getBoundingClientRect().left}):0))+"px":void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+V[d]+b]=f[d]||f[d-2]||f[0];return e}},Na.test(a)||(n.cssHooks[a+b].set=db)}),n.fn.extend({css:function(a,b){return Y(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=Ra(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return cb(this,!0)},hide:function(){return cb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){W(this)?n(this).show():n(this).hide()})}});function gb(a,b,c,d,e){return new gb.prototype.init(a,b,c,d,e)}n.Tween=gb,gb.prototype={constructor:gb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||n.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=gb.propHooks[this.prop];return a&&a.get?a.get(this):gb.propHooks._default.get(this)},run:function(a){var b,c=gb.propHooks[this.prop];return this.options.duration?this.pos=b=n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):gb.propHooks._default.set(this),this}},gb.prototype.init.prototype=gb.prototype,gb.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[n.cssProps[a.prop]]&&!n.cssHooks[a.prop]?a.elem[a.prop]=a.now:n.style(a.elem,a.prop,a.now+a.unit)}}},gb.propHooks.scrollTop=gb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},n.fx=gb.prototype.init,n.fx.step={};var hb,ib,jb=/^(?:toggle|show|hide)$/,kb=/queueHooks$/;function lb(){return a.setTimeout(function(){hb=void 0}),hb=n.now()}function mb(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=V[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function nb(a,b,c){for(var d,e=(qb.tweeners[b]||[]).concat(qb.tweeners["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function ob(a,b,c){var d,e,f,g,h,i,j,k,m=this,o={},p=a.style,q=a.nodeType&&W(a),r=n._data(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,m.always(function(){m.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],j=n.css(a,"display"),k="none"===j?n._data(a,"olddisplay")||Ma(a.nodeName):j,"inline"===k&&"none"===n.css(a,"float")&&(l.inlineBlockNeedsLayout&&"inline"!==Ma(a.nodeName)?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",l.shrinkWrapBlocks()||m.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],jb.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(o))"inline"===("none"===j?Ma(a.nodeName):j)&&(p.display=j);else{r?"hidden"in r&&(q=r.hidden):r=n._data(a,"fxshow",{}),f&&(r.hidden=!q),q?n(a).show():m.done(function(){n(a).hide()}),m.done(function(){var b;n._removeData(a,"fxshow");for(b in o)n.style(a,b,o[b])});for(d in o)g=nb(q?r[d]:0,d,m),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function pb(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function qb(a,b,c){var d,e,f=0,g=qb.prefilters.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=hb||lb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{},easing:n.easing._default},c),originalProperties:b,originalOptions:c,startTime:hb||lb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(pb(k,j.opts.specialEasing);g>f;f++)if(d=qb.prefilters[f].call(j,a,k,j.opts))return n.isFunction(d.stop)&&(n._queueHooks(j.elem,j.opts.queue).stop=n.proxy(d.stop,d)),d;return n.map(k,nb,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(qb,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return X(c.elem,a,U.exec(b),c),c}]},tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.match(G);for(var c,d=0,e=a.length;e>d;d++)c=a[d],qb.tweeners[c]=qb.tweeners[c]||[],qb.tweeners[c].unshift(b)},prefilters:[ob],prefilter:function(a,b){b?qb.prefilters.unshift(a):qb.prefilters.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,null!=d.queue&&d.queue!==!0||(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(W).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=qb(this,n.extend({},a),f);(e||n._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=n._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&kb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=n._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(mb(b,!0),a,d,e)}}),n.each({slideDown:mb("show"),slideUp:mb("hide"),slideToggle:mb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=n.timers,c=0;for(hb=n.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||n.fx.stop(),hb=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){ib||(ib=a.setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){a.clearInterval(ib),ib=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(b,c){return b=n.fx?n.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a,b=d.createElement("input"),c=d.createElement("div"),e=d.createElement("select"),f=e.appendChild(d.createElement("option"));c=d.createElement("div"),c.setAttribute("className","t"),c.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=c.getElementsByTagName("a")[0],b.setAttribute("type","checkbox"),c.appendChild(b),a=c.getElementsByTagName("a")[0],a.style.cssText="top:1px",l.getSetAttribute="t"!==c.className,l.style=/top/.test(a.getAttribute("style")),l.hrefNormalized="/a"===a.getAttribute("href"),l.checkOn=!!b.value,l.optSelected=f.selected,l.enctype=!!d.createElement("form").enctype,e.disabled=!0,l.optDisabled=!f.disabled,b=d.createElement("input"),b.setAttribute("value",""),l.input=""===b.getAttribute("value"),b.value="t",b.setAttribute("type","radio"),l.radioValue="t"===b.value}();var rb=/\r/g,sb=/[\x20\t\r\n\f]+/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(rb,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a)).replace(sb," ")}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],(c.selected||i===e)&&(l.optDisabled?!c.disabled:null===c.getAttribute("disabled"))&&(!c.parentNode.disabled||!n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)if(d=e[g],n.inArray(n.valHooks.option.get(d),f)>-1)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>-1:void 0}},l.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var tb,ub,vb=n.expr.attrHandle,wb=/^(?:checked|selected)$/i,xb=l.getSetAttribute,yb=l.input;n.fn.extend({attr:function(a,b){return Y(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof a.getAttribute?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),e=n.attrHooks[b]||(n.expr.match.bool.test(b)?ub:tb)),void 0!==c?null===c?void n.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=n.find.attr(a,b),null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(G);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)?yb&&xb||!wb.test(c)?a[d]=!1:a[n.camelCase("default-"+c)]=a[d]=!1:n.attr(a,c,""),a.removeAttribute(xb?c:d)}}),ub={set:function(a,b,c){return b===!1?n.removeAttr(a,c):yb&&xb||!wb.test(c)?a.setAttribute(!xb&&n.propFix[c]||c,c):a[n.camelCase("default-"+c)]=a[c]=!0,c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=vb[b]||n.find.attr;yb&&xb||!wb.test(b)?vb[b]=function(a,b,d){var e,f;return d||(f=vb[b],vb[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,vb[b]=f),e}:vb[b]=function(a,b,c){return c?void 0:a[n.camelCase("default-"+b)]?b.toLowerCase():null}}),yb&&xb||(n.attrHooks.value={set:function(a,b,c){return n.nodeName(a,"input")?void(a.defaultValue=b):tb&&tb.set(a,b,c)}}),xb||(tb={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},vb.id=vb.name=vb.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},n.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:tb.set},n.attrHooks.contenteditable={set:function(a,b,c){tb.set(a,""===b?!1:b,c)}},n.each(["width","height"],function(a,b){n.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),l.style||(n.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var zb=/^(?:input|select|textarea|button|object)$/i,Ab=/^(?:a|area)$/i;n.fn.extend({prop:function(a,b){return Y(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return a=n.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),n.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&n.isXMLDoc(a)||(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=n.find.attr(a,"tabindex");return b?parseInt(b,10):zb.test(a.nodeName)||Ab.test(a.nodeName)&&a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),l.hrefNormalized||n.each(["href","src"],function(a,b){n.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),l.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this}),l.enctype||(n.propFix.enctype="encoding");var Bb=/[\t\r\n\f]/g;function Cb(a){return n.attr(a,"class")||""}n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,Cb(this)))});if("string"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=Cb(c),d=1===c.nodeType&&(" "+e+" ").replace(Bb," ")){g=0;while(f=b[g++])d.indexOf(" "+f+" ")<0&&(d+=f+" ");h=n.trim(d),e!==h&&n.attr(c,"class",h)}}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,Cb(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=Cb(c),d=1===c.nodeType&&(" "+e+" ").replace(Bb," ")){g=0;while(f=b[g++])while(d.indexOf(" "+f+" ")>-1)d=d.replace(" "+f+" "," ");h=n.trim(d),e!==h&&n.attr(c,"class",h)}}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):n.isFunction(a)?this.each(function(c){n(this).toggleClass(a.call(this,c,Cb(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c){d=0,e=n(this),f=a.match(G)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else void 0!==a&&"boolean"!==c||(b=Cb(this),b&&n._data(this,"__className__",b),n.attr(this,"class",b||a===!1?"":n._data(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;b=" "+a+" ";while(c=this[d++])if(1===c.nodeType&&(" "+Cb(c)+" ").replace(Bb," ").indexOf(b)>-1)return!0;return!1}}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var Db=a.location,Eb=n.now(),Fb=/\?/,Gb=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;n.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=n.trim(b+"");return e&&!n.trim(e.replace(Gb,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():n.error("Invalid JSON: "+b)},n.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new a.DOMParser,c=d.parseFromString(b,"text/xml")):(c=new a.ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||n.error("Invalid XML: "+b),c};var Hb=/#.*$/,Ib=/([?&])_=[^&]*/,Jb=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Kb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Lb=/^(?:GET|HEAD)$/,Mb=/^\/\//,Nb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Ob={},Pb={},Qb="*/".concat("*"),Rb=Db.href,Sb=Nb.exec(Rb.toLowerCase())||[];function Tb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(G)||[];if(n.isFunction(c))while(d=f[e++])"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Ub(a,b,c,d){var e={},f=a===Pb;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Vb(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&n.extend(!0,a,c),a}function Wb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Xb(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Rb,type:"GET",isLocal:Kb.test(Sb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Qb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Vb(Vb(a,n.ajaxSettings),b):Vb(n.ajaxSettings,a)},ajaxPrefilter:Tb(Ob),ajaxTransport:Tb(Pb),ajax:function(b,c){"object"==typeof b&&(c=b,b=void 0),c=c||{};var d,e,f,g,h,i,j,k,l=n.ajaxSetup({},c),m=l.context||l,o=l.context&&(m.nodeType||m.jquery)?n(m):n.event,p=n.Deferred(),q=n.Callbacks("once memory"),r=l.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,getResponseHeader:function(a){var b;if(2===u){if(!k){k={};while(b=Jb.exec(g))k[b[1].toLowerCase()]=b[2]}b=k[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===u?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return u||(a=t[c]=t[c]||a,s[a]=b),this},overrideMimeType:function(a){return u||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>u)for(b in a)r[b]=[r[b],a[b]];else w.always(a[w.status]);return this},abort:function(a){var b=a||v;return j&&j.abort(b),y(0,b),this}};if(p.promise(w).complete=q.add,w.success=w.done,w.error=w.fail,l.url=((b||l.url||Rb)+"").replace(Hb,"").replace(Mb,Sb[1]+"//"),l.type=c.method||c.type||l.method||l.type,l.dataTypes=n.trim(l.dataType||"*").toLowerCase().match(G)||[""],null==l.crossDomain&&(d=Nb.exec(l.url.toLowerCase()),l.crossDomain=!(!d||d[1]===Sb[1]&&d[2]===Sb[2]&&(d[3]||("http:"===d[1]?"80":"443"))===(Sb[3]||("http:"===Sb[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=n.param(l.data,l.traditional)),Ub(Ob,l,c,w),2===u)return w;i=n.event&&l.global,i&&0===n.active++&&n.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!Lb.test(l.type),f=l.url,l.hasContent||(l.data&&(f=l.url+=(Fb.test(f)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=Ib.test(f)?f.replace(Ib,"$1_="+Eb++):f+(Fb.test(f)?"&":"?")+"_="+Eb++)),l.ifModified&&(n.lastModified[f]&&w.setRequestHeader("If-Modified-Since",n.lastModified[f]),n.etag[f]&&w.setRequestHeader("If-None-Match",n.etag[f])),(l.data&&l.hasContent&&l.contentType!==!1||c.contentType)&&w.setRequestHeader("Content-Type",l.contentType),w.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+Qb+"; q=0.01":""):l.accepts["*"]);for(e in l.headers)w.setRequestHeader(e,l.headers[e]);if(l.beforeSend&&(l.beforeSend.call(m,w,l)===!1||2===u))return w.abort();v="abort";for(e in{success:1,error:1,complete:1})w[e](l[e]);if(j=Ub(Pb,l,c,w)){if(w.readyState=1,i&&o.trigger("ajaxSend",[w,l]),2===u)return w;l.async&&l.timeout>0&&(h=a.setTimeout(function(){w.abort("timeout")},l.timeout));try{u=1,j.send(s,y)}catch(x){if(!(2>u))throw x;y(-1,x)}}else y(-1,"No Transport");function y(b,c,d,e){var k,s,t,v,x,y=c;2!==u&&(u=2,h&&a.clearTimeout(h),j=void 0,g=e||"",w.readyState=b>0?4:0,k=b>=200&&300>b||304===b,d&&(v=Wb(l,w,d)),v=Xb(l,v,w,k),k?(l.ifModified&&(x=w.getResponseHeader("Last-Modified"),x&&(n.lastModified[f]=x),x=w.getResponseHeader("etag"),x&&(n.etag[f]=x)),204===b||"HEAD"===l.type?y="nocontent":304===b?y="notmodified":(y=v.state,s=v.data,t=v.error,k=!t)):(t=y,!b&&y||(y="error",0>b&&(b=0))),w.status=b,w.statusText=(c||y)+"",k?p.resolveWith(m,[s,y,w]):p.rejectWith(m,[w,y,t]),w.statusCode(r),r=void 0,i&&o.trigger(k?"ajaxSuccess":"ajaxError",[w,l,k?s:t]),q.fireWith(m,[w,y]),i&&(o.trigger("ajaxComplete",[w,l]),--n.active||n.event.trigger("ajaxStop")))}return w},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax(n.extend({url:a,type:b,dataType:e,data:c,success:d},n.isPlainObject(a)&&a))}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){if(n.isFunction(a))return this.each(function(b){n(this).wrapAll(a.call(this,b))});if(this[0]){var b=n(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&1===a.firstChild.nodeType)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return n.isFunction(a)?this.each(function(b){n(this).wrapInner(a.call(this,b))}):this.each(function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}});function Yb(a){return a.style&&a.style.display||n.css(a,"display")}function Zb(a){if(!n.contains(a.ownerDocument||d,a))return!0;while(a&&1===a.nodeType){if("none"===Yb(a)||"hidden"===a.type)return!0;a=a.parentNode}return!1}n.expr.filters.hidden=function(a){return l.reliableHiddenOffsets()?a.offsetWidth<=0&&a.offsetHeight<=0&&!a.getClientRects().length:Zb(a)},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var $b=/%20/g,_b=/\[\]$/,ac=/\r?\n/g,bc=/^(?:submit|button|image|reset|file)$/i,cc=/^(?:input|select|textarea|keygen)/i;function dc(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||_b.test(a)?d(a,e):dc(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)dc(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)dc(c,a[c],b,e);return d.join("&").replace($b,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&cc.test(this.nodeName)&&!bc.test(a)&&(this.checked||!Z.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(ac,"\r\n")}}):{name:b.name,value:c.replace(ac,"\r\n")}}).get()}}),n.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return this.isLocal?ic():d.documentMode>8?hc():/^(get|post|head|put|delete|options)$/i.test(this.type)&&hc()||ic()}:hc;var ec=0,fc={},gc=n.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in fc)fc[a](void 0,!0)}),l.cors=!!gc&&"withCredentials"in gc,gc=l.ajax=!!gc,gc&&n.ajaxTransport(function(b){if(!b.crossDomain||l.cors){var c;return{send:function(d,e){var f,g=b.xhr(),h=++ec;if(g.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(f in b.xhrFields)g[f]=b.xhrFields[f];b.mimeType&&g.overrideMimeType&&g.overrideMimeType(b.mimeType),b.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");for(f in d)void 0!==d[f]&&g.setRequestHeader(f,d[f]+"");g.send(b.hasContent&&b.data||null),c=function(a,d){var f,i,j;if(c&&(d||4===g.readyState))if(delete fc[h],c=void 0,g.onreadystatechange=n.noop,d)4!==g.readyState&&g.abort();else{j={},f=g.status,"string"==typeof g.responseText&&(j.text=g.responseText);try{i=g.statusText}catch(k){i=""}f||!b.isLocal||b.crossDomain?1223===f&&(f=204):f=j.text?200:404}j&&e(f,i,j,g.getAllResponseHeaders())},b.async?4===g.readyState?a.setTimeout(c):g.onreadystatechange=fc[h]=c:c()},abort:function(){c&&c(void 0,!0)}}}});function hc(){try{return new a.XMLHttpRequest}catch(b){}}function ic(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=d.head||n("head")[0]||d.documentElement;return{send:function(e,f){b=d.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||f(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var jc=[],kc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=jc.pop()||n.expando+"_"+Eb++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(kc.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&kc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(kc,"$1"+e):b.jsonp!==!1&&(b.url+=(Fb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?n(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,jc.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||d;var e=x.exec(a),f=!c&&[];return e?[b.createElement(e[1])]:(e=ja([a],b,f),f&&f.length&&n(f).remove(),n.merge([],e.childNodes))};var lc=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&lc)return lc.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=n.trim(a.slice(h,a.length)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};function mc(a){return n.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&n.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,n.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;if(f)return b=f.documentElement,n.contains(b,e)?("undefined"!=typeof e.getBoundingClientRect&&(d=e.getBoundingClientRect()),c=mc(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===n.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(c=a.offset()),c.top+=n.css(a[0],"borderTopWidth",!0),c.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-n.css(d,"marginTop",!0),left:b.left-c.left-n.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position"))a=a.offsetParent;return a||Qa})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);n.fn[a]=function(d){return Y(this,function(a,d,e){var f=mc(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?n(f).scrollLeft():e,c?e:n(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=Ua(l.pixelPosition,function(a,c){return c?(c=Sa(a,b),Oa.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({
padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return Y(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var nc=a.jQuery,oc=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=oc),b&&a.jQuery===n&&(a.jQuery=nc),n},b||(a.jQuery=a.$=n),n});
var hex_chr = "0123456789abcdef";function rhex(num){str = "";for(j = 0; j <= 3; j++){str += hex_chr.charAt((num >> (j * 8 + 4)) & 0x0F) + hex_chr.charAt((num >> (j * 8)) & 0x0F);}return str;}function str2blks_MD5(str){nblk = ((str.length + 8) >> 6) + 1;blks = new Array(nblk * 16);for(i = 0; i < nblk * 16; i++) blks[i] = 0;for(i = 0; i < str.length; i++){blks[i >> 2] |= str.charCodeAt(i) << ((i % 4) * 8);}blks[i >> 2] |= 0x80 << ((i % 4) * 8);blks[nblk * 16 - 2] = str.length * 8;return blks;}function add(x, y){var lsw = (x & 0xFFFF) + (y & 0xFFFF);var msw = (x >> 16) + (y >> 16) + (lsw >> 16);return (msw << 16) | (lsw & 0xFFFF);}function rol(num, cnt){return (num << cnt) | (num >>> (32 - cnt));}function cmn(q, a, b, x, s, t){return add(rol(add(add(a, q), add(x, t)), s), b);}function ff(a, b, c, d, x, s, t){return cmn((b & c) | ((~b) & d), a, b, x, s, t);}function gg(a, b, c, d, x, s, t){return cmn((b & d) | (c & (~d)), a, b, x, s, t);}function hh(a, b, c, d, x, s, t){return cmn(b ^ c ^ d, a, b, x, s, t);}function ii(a, b, c, d, x, s, t){return cmn(c ^ (b | (~d)), a, b, x, s, t);}function _calcMD5(str){str=str===0?"0":str?str+"":"";x = str2blks_MD5(str);a =  1732584193;b = -271733879;c = -1732584194;d =  271733878;for(i = 0; i < x.length; i += 16){olda = a;oldb = b;oldc = c;oldd = d;a = ff(a, b, c, d, x[i+ 0], 7 , -680876936);d = ff(d, a, b, c, x[i+ 1], 12, -389564586);c = ff(c, d, a, b, x[i+ 2], 17,  606105819);b = ff(b, c, d, a, x[i+ 3], 22, -1044525330);a = ff(a, b, c, d, x[i+ 4], 7 , -176418897);d = ff(d, a, b, c, x[i+ 5], 12,  1200080426);c = ff(c, d, a, b, x[i+ 6], 17, -1473231341);b = ff(b, c, d, a, x[i+ 7], 22, -45705983);a = ff(a, b, c, d, x[i+ 8], 7 ,  1770035416);d = ff(d, a, b, c, x[i+ 9], 12, -1958414417);c = ff(c, d, a, b, x[i+10], 17, -42063);b = ff(b, c, d, a, x[i+11], 22, -1990404162);a = ff(a, b, c, d, x[i+12], 7 ,  1804603682);d = ff(d, a, b, c, x[i+13], 12, -40341101);c = ff(c, d, a, b, x[i+14], 17, -1502002290);b = ff(b, c, d, a, x[i+15], 22,  1236535329);a = gg(a, b, c, d, x[i+ 1], 5 , -165796510);d = gg(d, a, b, c, x[i+ 6], 9 , -1069501632);c = gg(c, d, a, b, x[i+11], 14,  643717713);b = gg(b, c, d, a, x[i+ 0], 20, -373897302);a = gg(a, b, c, d, x[i+ 5], 5 , -701558691);d = gg(d, a, b, c, x[i+10], 9 ,  38016083);c = gg(c, d, a, b, x[i+15], 14, -660478335);b = gg(b, c, d, a, x[i+ 4], 20, -405537848);a = gg(a, b, c, d, x[i+ 9], 5 ,  568446438);d = gg(d, a, b, c, x[i+14], 9 , -1019803690);c = gg(c, d, a, b, x[i+ 3], 14, -187363961);b = gg(b, c, d, a, x[i+ 8], 20,  1163531501);a = gg(a, b, c, d, x[i+13], 5 , -1444681467);d = gg(d, a, b, c, x[i+ 2], 9 , -51403784);c = gg(c, d, a, b, x[i+ 7], 14,  1735328473);b = gg(b, c, d, a, x[i+12], 20, -1926607734);a = hh(a, b, c, d, x[i+ 5], 4 , -378558);d = hh(d, a, b, c, x[i+ 8], 11, -2022574463);c = hh(c, d, a, b, x[i+11], 16,  1839030562);b = hh(b, c, d, a, x[i+14], 23, -35309556);a = hh(a, b, c, d, x[i+ 1], 4 , -1530992060);d = hh(d, a, b, c, x[i+ 4], 11,  1272893353);c = hh(c, d, a, b, x[i+ 7], 16, -155497632);b = hh(b, c, d, a, x[i+10], 23, -1094730640);a = hh(a, b, c, d, x[i+13], 4 ,  681279174);d = hh(d, a, b, c, x[i+ 0], 11, -358537222);c = hh(c, d, a, b, x[i+ 3], 16, -722521979);b = hh(b, c, d, a, x[i+ 6], 23,  76029189);a = hh(a, b, c, d, x[i+ 9], 4 , -640364487);d = hh(d, a, b, c, x[i+12], 11, -421815835);c = hh(c, d, a, b, x[i+15], 16,  530742520);b = hh(b, c, d, a, x[i+ 2], 23, -995338651);a = ii(a, b, c, d, x[i+ 0], 6 , -198630844);d = ii(d, a, b, c, x[i+ 7], 10,  1126891415);c = ii(c, d, a, b, x[i+14], 15, -1416354905);b = ii(b, c, d, a, x[i+ 5], 21, -57434055);a = ii(a, b, c, d, x[i+12], 6 ,  1700485571);d = ii(d, a, b, c, x[i+ 3], 10, -1894986606);c = ii(c, d, a, b, x[i+10], 15, -1051523);b = ii(b, c, d, a, x[i+ 1], 21, -2054922799);a = ii(a, b, c, d, x[i+ 8], 6 ,  1873313359);d = ii(d, a, b, c, x[i+15], 10, -30611744);c = ii(c, d, a, b, x[i+ 6], 15, -1560198380);b = ii(b, c, d, a, x[i+13], 21,  1309151649);a = ii(a, b, c, d, x[i+ 4], 6 , -145523070);d = ii(d, a, b, c, x[i+11], 10, -1120210379);c = ii(c, d, a, b, x[i+ 2], 15,  718787259);b = ii(b, c, d, a, x[i+ 9], 21, -343485551);a = add(a, olda);b = add(b, oldb);c = add(c, oldc);d = add(d, oldd);}return rhex(a) + rhex(b) + rhex(c) + rhex(d);}try{exports.md5 =_calcMD5;}catch(e){};/*!
 * html2canvas 1.0.0-rc.5 <https://html2canvas.hertzen.com>
 * Copyright (c) 2019 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 */
!function(A,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(A=A||self).html2canvas=e()}(this,function(){"use strict";var r=function(A,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,e){A.__proto__=e}||function(A,e){for(var t in e)e.hasOwnProperty(t)&&(A[t]=e[t])})(A,e)};function A(A,e){function t(){this.constructor=A}r(A,e),A.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var K=function(){return(K=Object.assign||function(A){for(var e,t=1,r=arguments.length;t<r;t++)for(var n in e=arguments[t])Object.prototype.hasOwnProperty.call(e,n)&&(A[n]=e[n]);return A}).apply(this,arguments)};function a(B,s,o,i){return new(o||(o=Promise))(function(A,e){function t(A){try{n(i.next(A))}catch(A){e(A)}}function r(A){try{n(i.throw(A))}catch(A){e(A)}}function n(e){e.done?A(e.value):new o(function(A){A(e.value)}).then(t,r)}n((i=i.apply(B,s||[])).next())})}function S(t,r){var n,B,s,A,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return A={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(A[Symbol.iterator]=function(){return this}),A;function e(e){return function(A){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,B&&(s=2&e[0]?B.return:e[0]?B.throw||((s=B.return)&&s.call(B),0):B.next)&&!(s=s.call(B,e[1])).done)return s;switch(B=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return o.label++,{value:e[1],done:!1};case 5:o.label++,B=e[1],e=[0];continue;case 7:e=o.ops.pop(),o.trys.pop();continue;default:if(!(s=0<(s=o.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){o=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){o.label=e[1];break}if(6===e[0]&&o.label<s[1]){o.label=s[1],s=e;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(e);break}s[2]&&o.ops.pop(),o.trys.pop();continue}e=r.call(t,o)}catch(A){e=[6,A],B=0}finally{n=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,A])}}}var I=(n.prototype.add=function(A,e,t,r){return new n(this.left+A,this.top+e,this.width+t,this.height+r)},n.fromClientRect=function(A){return new n(A.left,A.top,A.width,A.height)},n);function n(A,e,t,r){this.left=A,this.top=e,this.width=t,this.height=r}for(var T=function(A){return I.fromClientRect(A.getBoundingClientRect())},c=function(A){for(var e=[],t=0,r=A.length;t<r;){var n=A.charCodeAt(t++);if(55296<=n&&n<=56319&&t<r){var B=A.charCodeAt(t++);56320==(64512&B)?e.push(((1023&n)<<10)+(1023&B)+65536):(e.push(n),t--)}else e.push(n)}return e},l=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,A);var t=A.length;if(!t)return"";for(var r=[],n=-1,B="";++n<t;){var s=A[n];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(n+1===t||16384<r.length)&&(B+=String.fromCharCode.apply(String,r),r.length=0)}return B},e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Q="undefined"==typeof Uint8Array?[]:new Uint8Array(256),t=0;t<e.length;t++)Q[e.charCodeAt(t)]=t;function B(A,e,t){return A.slice?A.slice(e,t):new Uint16Array(Array.prototype.slice.call(A,e,t))}var s=(o.prototype.get=function(A){var e;if(0<=A){if(A<55296||56319<A&&A<=65535)return e=((e=this.index[A>>5])<<2)+(31&A),this.data[e];if(A<=65535)return e=((e=this.index[2048+(A-55296>>5)])<<2)+(31&A),this.data[e];if(A<this.highStart)return e=2080+(A>>11),e=this.index[e],e+=A>>5&63,e=((e=this.index[e])<<2)+(31&A),this.data[e];if(A<=1114111)return this.data[this.highValueIndex]}return this.errorValue},o);function o(A,e,t,r,n,B){this.initialValue=A,this.errorValue=e,this.highStart=t,this.highValueIndex=r,this.index=n,this.data=B}function C(A,e,t,r){var n=r[t];if(Array.isArray(A)?-1!==A.indexOf(n):A===n)for(var B=t;B<=r.length;){if((i=r[++B])===e)return!0;if(i!==H)break}if(n===H)for(B=t;0<B;){var s=r[--B];if(Array.isArray(A)?-1!==A.indexOf(s):A===s)for(var o=t;o<=r.length;){var i;if((i=r[++o])===e)return!0;if(i!==H)break}if(s!==H)break}return!1}function g(A,e){for(var t=A;0<=t;){var r=e[t];if(r!==H)return r;t--}return 0}function w(A,e,t,r,n){if(0===t[r])return Y;var B=r-1;if(Array.isArray(n)&&!0===n[B])return Y;var s=B-1,o=1+B,i=e[B],a=0<=s?e[s]:0,c=e[o];if(2===i&&3===c)return Y;if(-1!==j.indexOf(i))return"!";if(-1!==j.indexOf(c))return Y;if(-1!==$.indexOf(c))return Y;if(8===g(B,e))return"÷";if(11===q.get(A[B])&&(c===X||c===P||c===x))return Y;if(7===i||7===c)return Y;if(9===i)return Y;if(-1===[H,d,f].indexOf(i)&&9===c)return Y;if(-1!==[p,N,m,O,y].indexOf(c))return Y;if(g(B,e)===v)return Y;if(C(23,v,B,e))return Y;if(C([p,N],L,B,e))return Y;if(C(12,12,B,e))return Y;if(i===H)return"÷";if(23===i||23===c)return Y;if(16===c||16===i)return"÷";if(-1!==[d,f,L].indexOf(c)||14===i)return Y;if(36===a&&-1!==rA.indexOf(i))return Y;if(i===y&&36===c)return Y;if(c===R&&-1!==Z.concat(R,m,D,X,P,x).indexOf(i))return Y;if(-1!==Z.indexOf(c)&&i===D||-1!==Z.indexOf(i)&&c===D)return Y;if(i===M&&-1!==[X,P,x].indexOf(c)||-1!==[X,P,x].indexOf(i)&&c===b)return Y;if(-1!==Z.indexOf(i)&&-1!==AA.indexOf(c)||-1!==AA.indexOf(i)&&-1!==Z.indexOf(c))return Y;if(-1!==[M,b].indexOf(i)&&(c===D||-1!==[v,f].indexOf(c)&&e[1+o]===D)||-1!==[v,f].indexOf(i)&&c===D||i===D&&-1!==[D,y,O].indexOf(c))return Y;if(-1!==[D,y,O,p,N].indexOf(c))for(var Q=B;0<=Q;){if((w=e[Q])===D)return Y;if(-1===[y,O].indexOf(w))break;Q--}if(-1!==[M,b].indexOf(c))for(Q=-1!==[p,N].indexOf(i)?s:B;0<=Q;){var w;if((w=e[Q])===D)return Y;if(-1===[y,O].indexOf(w))break;Q--}if(J===i&&-1!==[J,G,V,z].indexOf(c)||-1!==[G,V].indexOf(i)&&-1!==[G,k].indexOf(c)||-1!==[k,z].indexOf(i)&&c===k)return Y;if(-1!==tA.indexOf(i)&&-1!==[R,b].indexOf(c)||-1!==tA.indexOf(c)&&i===M)return Y;if(-1!==Z.indexOf(i)&&-1!==Z.indexOf(c))return Y;if(i===O&&-1!==Z.indexOf(c))return Y;if(-1!==Z.concat(D).indexOf(i)&&c===v||-1!==Z.concat(D).indexOf(c)&&i===N)return Y;if(41===i&&41===c){for(var u=t[B],U=1;0<u&&41===e[--u];)U++;if(U%2!=0)return Y}return i===P&&c===x?Y:"÷"}function u(t,A){A||(A={lineBreak:"normal",wordBreak:"normal"});var e=function(A,n){void 0===n&&(n="strict");var B=[],s=[],o=[];return A.forEach(function(A,e){var t=q.get(A);if(50<t?(o.push(!0),t-=50):o.push(!1),-1!==["normal","auto","loose"].indexOf(n)&&-1!==[8208,8211,12316,12448].indexOf(A))return s.push(e),B.push(16);if(4!==t&&11!==t)return s.push(e),31===t?B.push("strict"===n?L:X):t===W?B.push(_):29===t?B.push(_):43===t?131072<=A&&A<=196605||196608<=A&&A<=262141?B.push(X):B.push(_):void B.push(t);if(0===e)return s.push(e),B.push(_);var r=B[e-1];return-1===eA.indexOf(r)?(s.push(s[e-1]),B.push(r)):(s.push(e),B.push(_))}),[s,B,o]}(t,A.lineBreak),r=e[0],n=e[1],B=e[2];return"break-all"!==A.wordBreak&&"break-word"!==A.wordBreak||(n=n.map(function(A){return-1!==[D,_,W].indexOf(A)?X:A})),[r,n,"keep-all"===A.wordBreak?B.map(function(A,e){return A&&19968<=t[e]&&t[e]<=40959}):void 0]}var i,U,E,F,h,H=10,d=13,f=15,p=17,N=18,m=19,R=20,L=21,v=22,O=24,D=25,b=26,M=27,y=28,_=30,P=32,x=33,V=34,z=35,X=37,J=38,G=39,k=40,W=42,Y="×",q=(i=function(A){var e,t,r,n,B,s=.75*A.length,o=A.length,i=0;"="===A[A.length-1]&&(s--,"="===A[A.length-2]&&s--);var a="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(s):new Array(s),c=Array.isArray(a)?a:new Uint8Array(a);for(e=0;e<o;e+=4)t=Q[A.charCodeAt(e)],r=Q[A.charCodeAt(e+1)],n=Q[A.charCodeAt(e+2)],B=Q[A.charCodeAt(e+3)],c[i++]=t<<2|r>>4,c[i++]=(15&r)<<4|n>>2,c[i++]=(3&n)<<6|63&B;return a}("KwAAAAAAAAAACA4AIDoAAPAfAAACAAAAAAAIABAAGABAAEgAUABYAF4AZgBeAGYAYABoAHAAeABeAGYAfACEAIAAiACQAJgAoACoAK0AtQC9AMUAXgBmAF4AZgBeAGYAzQDVAF4AZgDRANkA3gDmAOwA9AD8AAQBDAEUARoBIgGAAIgAJwEvATcBPwFFAU0BTAFUAVwBZAFsAXMBewGDATAAiwGTAZsBogGkAawBtAG8AcIBygHSAdoB4AHoAfAB+AH+AQYCDgIWAv4BHgImAi4CNgI+AkUCTQJTAlsCYwJrAnECeQKBAk0CiQKRApkCoQKoArACuALAAsQCzAIwANQC3ALkAjAA7AL0AvwCAQMJAxADGAMwACADJgMuAzYDPgOAAEYDSgNSA1IDUgNaA1oDYANiA2IDgACAAGoDgAByA3YDfgOAAIQDgACKA5IDmgOAAIAAogOqA4AAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAK8DtwOAAIAAvwPHA88D1wPfAyAD5wPsA/QD/AOAAIAABAQMBBIEgAAWBB4EJgQuBDMEIAM7BEEEXgBJBCADUQRZBGEEaQQwADAAcQQ+AXkEgQSJBJEEgACYBIAAoASoBK8EtwQwAL8ExQSAAIAAgACAAIAAgACgAM0EXgBeAF4AXgBeAF4AXgBeANUEXgDZBOEEXgDpBPEE+QQBBQkFEQUZBSEFKQUxBTUFPQVFBUwFVAVcBV4AYwVeAGsFcwV7BYMFiwWSBV4AmgWgBacFXgBeAF4AXgBeAKsFXgCyBbEFugW7BcIFwgXIBcIFwgXQBdQF3AXkBesF8wX7BQMGCwYTBhsGIwYrBjMGOwZeAD8GRwZNBl4AVAZbBl4AXgBeAF4AXgBeAF4AXgBeAF4AXgBeAGMGXgBqBnEGXgBeAF4AXgBeAF4AXgBeAF4AXgB5BoAG4wSGBo4GkwaAAIADHgR5AF4AXgBeAJsGgABGA4AAowarBrMGswagALsGwwbLBjAA0wbaBtoG3QbaBtoG2gbaBtoG2gblBusG8wb7BgMHCwcTBxsHCwcjBysHMAc1BzUHOgdCB9oGSgdSB1oHYAfaBloHaAfaBlIH2gbaBtoG2gbaBtoG2gbaBjUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHbQdeAF4ANQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQd1B30HNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B4MH2gaKB68EgACAAIAAgACAAIAAgACAAI8HlwdeAJ8HpweAAIAArwe3B14AXgC/B8UHygcwANAH2AfgB4AA6AfwBz4B+AcACFwBCAgPCBcIogEYAR8IJwiAAC8INwg/CCADRwhPCFcIXwhnCEoDGgSAAIAAgABvCHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIfQh3CHgIeQh6CHsIfAh9CHcIeAh5CHoIewh8CH0Idwh4CHkIegh7CHwIhAiLCI4IMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAANQc1BzUHNQc1BzUHNQc1BzUHNQc1B54INQc1B6II2gaqCLIIugiAAIAAvgjGCIAAgACAAIAAgACAAIAAgACAAIAAywiHAYAA0wiAANkI3QjlCO0I9Aj8CIAAgACAAAIJCgkSCRoJIgknCTYHLwk3CZYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiWCJYIlgiAAIAAAAFAAXgBeAGAAcABeAHwAQACQAKAArQC9AJ4AXgBeAE0A3gBRAN4A7AD8AMwBGgEAAKcBNwEFAUwBXAF4QkhCmEKnArcCgAHHAsABz4LAAcABwAHAAd+C6ABoAG+C/4LAAcABwAHAAc+DF4MAAcAB54M3gweDV4Nng3eDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEeDqABVg6WDqABoQ6gAaABoAHXDvcONw/3DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DvcO9w73DncPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB7cPPwlGCU4JMACAAIAAgABWCV4JYQmAAGkJcAl4CXwJgAkwADAAMAAwAIgJgACLCZMJgACZCZ8JowmrCYAAswkwAF4AXgB8AIAAuwkABMMJyQmAAM4JgADVCTAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAqwYWBNkIMAAwADAAMADdCeAJ6AnuCR4E9gkwAP4JBQoNCjAAMACAABUK0wiAAB0KJAosCjQKgAAwADwKQwqAAEsKvQmdCVMKWwowADAAgACAALcEMACAAGMKgABrCjAAMAAwADAAMAAwADAAMAAwADAAMAAeBDAAMAAwADAAMAAwADAAMAAwADAAMAAwAIkEPQFzCnoKiQSCCooKkAqJBJgKoAqkCokEGAGsCrQKvArBCjAAMADJCtEKFQHZCuEK/gHpCvEKMAAwADAAMACAAIwE+QowAIAAPwEBCzAAMAAwADAAMACAAAkLEQswAIAAPwEZCyELgAAOCCkLMAAxCzkLMAAwADAAMAAwADAAXgBeAEELMAAwADAAMAAwADAAMAAwAEkLTQtVC4AAXAtkC4AAiQkwADAAMAAwADAAMAAwADAAbAtxC3kLgAuFC4sLMAAwAJMLlwufCzAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAApwswADAAMACAAIAAgACvC4AAgACAAIAAgACAALcLMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAvwuAAMcLgACAAIAAgACAAIAAyguAAIAAgACAAIAA0QswADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAANkLgACAAIAA4AswADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACJCR4E6AswADAAhwHwC4AA+AsADAgMEAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMACAAIAAGAwdDCUMMAAwAC0MNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQw1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHPQwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADUHNQc1BzUHNQc1BzUHNQc2BzAAMAA5DDUHNQc1BzUHNQc1BzUHNQc1BzUHNQdFDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAgACAAIAATQxSDFoMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAF4AXgBeAF4AXgBeAF4AYgxeAGoMXgBxDHkMfwxeAIUMXgBeAI0MMAAwADAAMAAwAF4AXgCVDJ0MMAAwADAAMABeAF4ApQxeAKsMswy7DF4Awgy9DMoMXgBeAF4AXgBeAF4AXgBeAF4AXgDRDNkMeQBqCeAM3Ax8AOYM7Az0DPgMXgBeAF4AXgBeAF4AXgBeAF4AXgBeAF4AXgBeAF4AXgCgAAANoAAHDQ4NFg0wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAeDSYNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIAAgACAAIAAgACAAC4NMABeAF4ANg0wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAD4NRg1ODVYNXg1mDTAAbQ0wADAAMAAwADAAMAAwADAA2gbaBtoG2gbaBtoG2gbaBnUNeg3CBYANwgWFDdoGjA3aBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gaUDZwNpA2oDdoG2gawDbcNvw3HDdoG2gbPDdYN3A3fDeYN2gbsDfMN2gbaBvoN/g3aBgYODg7aBl4AXgBeABYOXgBeACUG2gYeDl4AJA5eACwO2w3aBtoGMQ45DtoG2gbaBtoGQQ7aBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gZJDjUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B1EO2gY1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQdZDjUHNQc1BzUHNQc1B2EONQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHaA41BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B3AO2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gY1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1BzUHNQc1B2EO2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gZJDtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBtoG2gbaBkkOeA6gAKAAoAAwADAAMAAwAKAAoACgAKAAoACgAKAAgA4wADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAD//wQABAAEAAQABAAEAAQABAAEAA0AAwABAAEAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAKABMAFwAeABsAGgAeABcAFgASAB4AGwAYAA8AGAAcAEsASwBLAEsASwBLAEsASwBLAEsAGAAYAB4AHgAeABMAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAFgAbABIAHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYADQARAB4ABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkAFgAaABsAGwAbAB4AHQAdAB4ATwAXAB4ADQAeAB4AGgAbAE8ATwAOAFAAHQAdAB0ATwBPABcATwBPAE8AFgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwArAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAAQABAANAA0ASwBLAEsASwBLAEsASwBLAEsASwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUAArACsABABQAAQABAAEAAQABAAEAAQAKwArAAQABAArACsABAAEAAQAUAArACsAKwArACsAKwArACsABAArACsAKwArAFAAUAArAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAGgAaAFAAUABQAFAAUABMAB4AGwBQAB4AKwArACsABAAEAAQAKwBQAFAAUABQAFAAUAArACsAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUAArAFAAUAArACsABAArAAQABAAEAAQABAArACsAKwArAAQABAArACsABAAEAAQAKwArACsABAArACsAKwArACsAKwArAFAAUABQAFAAKwBQACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwAEAAQAUABQAFAABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUAArACsABABQAAQABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQAKwArAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwAeABsAKwArACsAKwArACsAKwBQAAQABAAEAAQABAAEACsABAAEAAQAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwArAAQABAArACsABAAEAAQAKwArACsAKwArACsAKwArAAQABAArACsAKwArAFAAUAArAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwAeAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwAEAFAAKwBQAFAAUABQAFAAUAArACsAKwBQAFAAUAArAFAAUABQAFAAKwArACsAUABQACsAUAArAFAAUAArACsAKwBQAFAAKwArACsAUABQAFAAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQAKwArACsABAAEAAQAKwAEAAQABAAEACsAKwBQACsAKwArACsAKwArAAQAKwArACsAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAB4AHgAeAB4AHgAeABsAHgArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABAArACsAKwArACsAKwArAAQABAArAFAAUABQACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAB4AUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABAArACsAKwArACsAKwArAAQABAArACsAKwArACsAKwArAFAAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwArAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAKwBcAFwAKwBcACsAKwBcACsAKwArACsAKwArAFwAXABcAFwAKwBcAFwAXABcAFwAXABcACsAXABcAFwAKwBcACsAXAArACsAXABcACsAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgArACoAKgBcACsAKwBcAFwAXABcAFwAKwBcACsAKgAqACoAKgAqACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAFwAXABcAFwAUAAOAA4ADgAOAB4ADgAOAAkADgAOAA0ACQATABMAEwATABMACQAeABMAHgAeAB4ABAAEAB4AHgAeAB4AHgAeAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUAANAAQAHgAEAB4ABAAWABEAFgARAAQABABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAAQABAAEAAQABAANAAQABABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsADQANAB4AHgAeAB4AHgAeAAQAHgAeAB4AHgAeAB4AKwAeAB4ADgAOAA0ADgAeAB4AHgAeAB4ACQAJACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgAeAB4AHgBcAFwAXABcAFwAXAAqACoAKgAqAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAKgAqACoAKgAqACoAKgBcAFwAXAAqACoAKgAqAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAXAAqAEsASwBLAEsASwBLAEsASwBLAEsAKgAqACoAKgAqACoAUABQAFAAUABQAFAAKwBQACsAKwArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQACsAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwAEAAQABAAeAA0AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAEQArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAADQANAA0AUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAA0ADQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQACsABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoADQANABUAXAANAB4ADQAbAFwAKgArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAB4AHgATABMADQANAA4AHgATABMAHgAEAAQABAAJACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAUABQAFAAUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwAeACsAKwArABMAEwBLAEsASwBLAEsASwBLAEsASwBLAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwBcAFwAXABcAFwAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcACsAKwArACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwAeAB4AXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgArACsABABLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKgAqACoAKgAqACoAKgBcACoAKgAqACoAKgAqACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAUABQAFAAUABQAFAAUAArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4ADQANAA0ADQAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAHgAeAB4AHgBQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwANAA0ADQANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwBQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsABAAEAAQAHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAABABQAFAAUABQAAQABAAEAFAAUAAEAAQABAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAKwBQACsAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAKwArAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAKwAeAB4AHgAeAB4AHgAeAA4AHgArAA0ADQANAA0ADQANAA0ACQANAA0ADQAIAAQACwAEAAQADQAJAA0ADQAMAB0AHQAeABcAFwAWABcAFwAXABYAFwAdAB0AHgAeABQAFAAUAA0AAQABAAQABAAEAAQABAAJABoAGgAaABoAGgAaABoAGgAeABcAFwAdABUAFQAeAB4AHgAeAB4AHgAYABYAEQAVABUAFQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgANAB4ADQANAA0ADQAeAA0ADQANAAcAHgAeAB4AHgArAAQABAAEAAQABAAEAAQABAAEAAQAUABQACsAKwBPAFAAUABQAFAAUAAeAB4AHgAWABEATwBQAE8ATwBPAE8AUABQAFAAUABQAB4AHgAeABYAEQArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAGwAbABsAGwAbABsAGwAaABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAaABsAGwAbABsAGgAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgBQABoAHgAdAB4AUAAeABoAHgAeAB4AHgAeAB4AHgAeAB4ATwAeAFAAGwAeAB4AUABQAFAAUABQAB4AHgAeAB0AHQAeAFAAHgBQAB4AUAAeAFAATwBQAFAAHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AUABQAFAAUABPAE8AUABQAFAAUABQAE8AUABQAE8AUABPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAE8ATwBPAE8ATwBPAE8ATwBPAE8AUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAATwAeAB4AKwArACsAKwAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB0AHQAeAB4AHgAdAB0AHgAeAB0AHgAeAB4AHQAeAB0AGwAbAB4AHQAeAB4AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB0AHgAdAB4AHQAdAB0AHQAdAB0AHgAdAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAdAB0AHQAdAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAlACUAHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBQAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAeAB4AHgAeAB0AHQAeAB4AHgAeAB0AHQAdAB4AHgAdAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB0AHQAeAB4AHQAeAB4AHgAeAB0AHQAeAB4AHgAeACUAJQAdAB0AJQAeACUAJQAlACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAHgAeAB4AHgAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHQAdAB0AHgAdACUAHQAdAB4AHQAdAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHQAdAB0AHQAlAB4AJQAlACUAHQAlACUAHQAdAB0AJQAlAB0AHQAlAB0AHQAlACUAJQAeAB0AHgAeAB4AHgAdAB0AJQAdAB0AHQAdAB0AHQAlACUAJQAlACUAHQAlACUAIAAlAB0AHQAlACUAJQAlACUAJQAlACUAHgAeAB4AJQAlACAAIAAgACAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeABcAFwAXABcAFwAXAB4AEwATACUAHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwArACUAJQBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAKwArACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAE8ATwBPAE8ATwBPAE8ATwAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeACsAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUAArACsAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQBQAFAAUABQACsAKwArACsAUABQAFAAUABQAFAAUABQAA0AUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQACsAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgBQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAABAAEAAQAKwAEAAQAKwArACsAKwArAAQABAAEAAQAUABQAFAAUAArAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsABAAEAAQAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsADQANAA0ADQANAA0ADQANAB4AKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AUABQAFAAUABQAFAAUABQAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAUABQAFAAUABQAA0ADQANAA0ADQANABQAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwANAA0ADQANAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAeAAQABAAEAB4AKwArAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLACsADQArAB4AKwArAAQABAAEAAQAUABQAB4AUAArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwAEAAQABAAEAAQABAAEAAQABAAOAA0ADQATABMAHgAeAB4ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0AUABQAFAAUAAEAAQAKwArAAQADQANAB4AUAArACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXABcAA0ADQANACoASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUAArACsAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANACsADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEcARwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQACsAKwAeAAQABAANAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAEAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUAArACsAUAArACsAUABQACsAKwBQAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AKwArAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAeAB4ADQANAA0ADQAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAArAAQABAArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAEAAQABAAEAAQABAAEACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAFgAWAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAKwBQACsAKwArACsAKwArAFAAKwArACsAKwBQACsAUAArAFAAKwBQAFAAUAArAFAAUAArAFAAKwArAFAAKwBQACsAUAArAFAAKwBQACsAUABQACsAUAArACsAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAUABQAFAAUAArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUAArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAlACUAJQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeACUAJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeACUAJQAlACUAJQAeACUAJQAlACUAJQAgACAAIAAlACUAIAAlACUAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIQAhACEAIQAhACUAJQAgACAAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACAAIAAlACUAJQAlACAAJQAgACAAIAAgACAAIAAgACAAIAAlACUAJQAgACUAJQAlACUAIAAgACAAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeACUAHgAlAB4AJQAlACUAJQAlACAAJQAlACUAJQAeACUAHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAIAAgACAAJQAlACUAIAAgACAAIAAgAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFwAXABcAFQAVABUAHgAeAB4AHgAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAIAAgACAAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAlACAAIAAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsA"),U=Array.isArray(i)?function(A){for(var e=A.length,t=[],r=0;r<e;r+=4)t.push(A[r+3]<<24|A[r+2]<<16|A[r+1]<<8|A[r]);return t}(i):new Uint32Array(i),E=Array.isArray(i)?function(A){for(var e=A.length,t=[],r=0;r<e;r+=2)t.push(A[r+1]<<8|A[r]);return t}(i):new Uint16Array(i),F=B(E,12,U[4]/2),h=2===U[5]?B(E,(24+U[4])/2):function(A,e,t){return A.slice?A.slice(e,t):new Uint32Array(Array.prototype.slice.call(A,e,t))}(U,Math.ceil((24+U[4])/4)),new s(U[0],U[1],U[2],U[3],F,h)),Z=[_,36],j=[1,2,3,5],$=[H,8],AA=[M,b],eA=j.concat($),tA=[J,G,k,V,z],rA=[f,d],nA=(BA.prototype.slice=function(){return l.apply(void 0,this.codePoints.slice(this.start,this.end))},BA);function BA(A,e,t,r){this.codePoints=A,this.required="!"===e,this.start=t,this.end=r}var sA,oA;(oA=sA||(sA={}))[oA.STRING_TOKEN=0]="STRING_TOKEN",oA[oA.BAD_STRING_TOKEN=1]="BAD_STRING_TOKEN",oA[oA.LEFT_PARENTHESIS_TOKEN=2]="LEFT_PARENTHESIS_TOKEN",oA[oA.RIGHT_PARENTHESIS_TOKEN=3]="RIGHT_PARENTHESIS_TOKEN",oA[oA.COMMA_TOKEN=4]="COMMA_TOKEN",oA[oA.HASH_TOKEN=5]="HASH_TOKEN",oA[oA.DELIM_TOKEN=6]="DELIM_TOKEN",oA[oA.AT_KEYWORD_TOKEN=7]="AT_KEYWORD_TOKEN",oA[oA.PREFIX_MATCH_TOKEN=8]="PREFIX_MATCH_TOKEN",oA[oA.DASH_MATCH_TOKEN=9]="DASH_MATCH_TOKEN",oA[oA.INCLUDE_MATCH_TOKEN=10]="INCLUDE_MATCH_TOKEN",oA[oA.LEFT_CURLY_BRACKET_TOKEN=11]="LEFT_CURLY_BRACKET_TOKEN",oA[oA.RIGHT_CURLY_BRACKET_TOKEN=12]="RIGHT_CURLY_BRACKET_TOKEN",oA[oA.SUFFIX_MATCH_TOKEN=13]="SUFFIX_MATCH_TOKEN",oA[oA.SUBSTRING_MATCH_TOKEN=14]="SUBSTRING_MATCH_TOKEN",oA[oA.DIMENSION_TOKEN=15]="DIMENSION_TOKEN",oA[oA.PERCENTAGE_TOKEN=16]="PERCENTAGE_TOKEN",oA[oA.NUMBER_TOKEN=17]="NUMBER_TOKEN",oA[oA.FUNCTION=18]="FUNCTION",oA[oA.FUNCTION_TOKEN=19]="FUNCTION_TOKEN",oA[oA.IDENT_TOKEN=20]="IDENT_TOKEN",oA[oA.COLUMN_TOKEN=21]="COLUMN_TOKEN",oA[oA.URL_TOKEN=22]="URL_TOKEN",oA[oA.BAD_URL_TOKEN=23]="BAD_URL_TOKEN",oA[oA.CDC_TOKEN=24]="CDC_TOKEN",oA[oA.CDO_TOKEN=25]="CDO_TOKEN",oA[oA.COLON_TOKEN=26]="COLON_TOKEN",oA[oA.SEMICOLON_TOKEN=27]="SEMICOLON_TOKEN",oA[oA.LEFT_SQUARE_BRACKET_TOKEN=28]="LEFT_SQUARE_BRACKET_TOKEN",oA[oA.RIGHT_SQUARE_BRACKET_TOKEN=29]="RIGHT_SQUARE_BRACKET_TOKEN",oA[oA.UNICODE_RANGE_TOKEN=30]="UNICODE_RANGE_TOKEN",oA[oA.WHITESPACE_TOKEN=31]="WHITESPACE_TOKEN",oA[oA.EOF_TOKEN=32]="EOF_TOKEN";function iA(A){return 48<=A&&A<=57}function aA(A){return iA(A)||65<=A&&A<=70||97<=A&&A<=102}function cA(A){return 10===A||9===A||32===A}function QA(A){return function(A){return function(A){return 97<=A&&A<=122}(A)||function(A){return 65<=A&&A<=90}(A)}(A)||function(A){return 128<=A}(A)||95===A}function wA(A){return QA(A)||iA(A)||45===A}function uA(A,e){return 92===A&&10!==e}function UA(A,e,t){return 45===A?QA(e)||uA(e,t):!!QA(A)||!(92!==A||!uA(A,e))}function lA(A,e,t){return 43===A||45===A?!!iA(e)||46===e&&iA(t):iA(46===A?e:A)}var CA={type:sA.LEFT_PARENTHESIS_TOKEN},gA={type:sA.RIGHT_PARENTHESIS_TOKEN},EA={type:sA.COMMA_TOKEN},FA={type:sA.SUFFIX_MATCH_TOKEN},hA={type:sA.PREFIX_MATCH_TOKEN},HA={type:sA.COLUMN_TOKEN},dA={type:sA.DASH_MATCH_TOKEN},fA={type:sA.INCLUDE_MATCH_TOKEN},pA={type:sA.LEFT_CURLY_BRACKET_TOKEN},NA={type:sA.RIGHT_CURLY_BRACKET_TOKEN},KA={type:sA.SUBSTRING_MATCH_TOKEN},IA={type:sA.BAD_URL_TOKEN},TA={type:sA.BAD_STRING_TOKEN},mA={type:sA.CDO_TOKEN},RA={type:sA.CDC_TOKEN},LA={type:sA.COLON_TOKEN},vA={type:sA.SEMICOLON_TOKEN},OA={type:sA.LEFT_SQUARE_BRACKET_TOKEN},DA={type:sA.RIGHT_SQUARE_BRACKET_TOKEN},bA={type:sA.WHITESPACE_TOKEN},SA={type:sA.EOF_TOKEN},MA=(yA.prototype.write=function(A){this._value=this._value.concat(c(A))},yA.prototype.read=function(){for(var A=[],e=this.consumeToken();e!==SA;)A.push(e),e=this.consumeToken();return A},yA.prototype.consumeToken=function(){var A=this.consumeCodePoint();switch(A){case 34:return this.consumeStringToken(34);case 35:var e=this.peekCodePoint(0),t=this.peekCodePoint(1),r=this.peekCodePoint(2);if(wA(e)||uA(t,r)){var n=UA(e,t,r)?2:1,B=this.consumeName();return{type:sA.HASH_TOKEN,value:B,flags:n}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),FA;break;case 39:return this.consumeStringToken(39);case 40:return CA;case 41:return gA;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),KA;break;case 43:if(lA(A,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(A),this.consumeNumericToken();break;case 44:return EA;case 45:var s=A,o=this.peekCodePoint(0),i=this.peekCodePoint(1);if(lA(s,o,i))return this.reconsumeCodePoint(A),this.consumeNumericToken();if(UA(s,o,i))return this.reconsumeCodePoint(A),this.consumeIdentLikeToken();if(45===o&&62===i)return this.consumeCodePoint(),this.consumeCodePoint(),RA;break;case 46:if(lA(A,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(A),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var a=this.consumeCodePoint();if(42===a&&47===(a=this.consumeCodePoint()))return this.consumeToken();if(-1===a)return this.consumeToken()}break;case 58:return LA;case 59:return vA;case 60:if(33===this.peekCodePoint(0)&&45===this.peekCodePoint(1)&&45===this.peekCodePoint(2))return this.consumeCodePoint(),this.consumeCodePoint(),mA;break;case 64:var c=this.peekCodePoint(0),Q=this.peekCodePoint(1),w=this.peekCodePoint(2);if(UA(c,Q,w))return B=this.consumeName(),{type:sA.AT_KEYWORD_TOKEN,value:B};break;case 91:return OA;case 92:if(uA(A,this.peekCodePoint(0)))return this.reconsumeCodePoint(A),this.consumeIdentLikeToken();break;case 93:return DA;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),hA;break;case 123:return pA;case 125:return NA;case 117:case 85:var u=this.peekCodePoint(0),U=this.peekCodePoint(1);return 43!==u||!aA(U)&&63!==U||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(A),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),dA;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),HA;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),fA;break;case-1:return SA}return cA(A)?(this.consumeWhiteSpace(),bA):iA(A)?(this.reconsumeCodePoint(A),this.consumeNumericToken()):QA(A)?(this.reconsumeCodePoint(A),this.consumeIdentLikeToken()):{type:sA.DELIM_TOKEN,value:l(A)}},yA.prototype.consumeCodePoint=function(){var A=this._value.shift();return void 0===A?-1:A},yA.prototype.reconsumeCodePoint=function(A){this._value.unshift(A)},yA.prototype.peekCodePoint=function(A){return A>=this._value.length?-1:this._value[A]},yA.prototype.consumeUnicodeRangeToken=function(){for(var A=[],e=this.consumeCodePoint();aA(e)&&A.length<6;)A.push(e),e=this.consumeCodePoint();for(var t=!1;63===e&&A.length<6;)A.push(e),e=this.consumeCodePoint(),t=!0;if(t){var r=parseInt(l.apply(void 0,A.map(function(A){return 63===A?48:A})),16),n=parseInt(l.apply(void 0,A.map(function(A){return 63===A?70:A})),16);return{type:sA.UNICODE_RANGE_TOKEN,start:r,end:n}}var B=parseInt(l.apply(void 0,A),16);if(45===this.peekCodePoint(0)&&aA(this.peekCodePoint(1))){this.consumeCodePoint(),e=this.consumeCodePoint();for(var s=[];aA(e)&&s.length<6;)s.push(e),e=this.consumeCodePoint();return n=parseInt(l.apply(void 0,s),16),{type:sA.UNICODE_RANGE_TOKEN,start:B,end:n}}return{type:sA.UNICODE_RANGE_TOKEN,start:B,end:B}},yA.prototype.consumeIdentLikeToken=function(){var A=this.consumeName();return"url"===A.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:sA.FUNCTION_TOKEN,value:A}):{type:sA.IDENT_TOKEN,value:A}},yA.prototype.consumeUrlToken=function(){var A=[];if(this.consumeWhiteSpace(),-1===this.peekCodePoint(0))return{type:sA.URL_TOKEN,value:""};var e,t=this.peekCodePoint(0);if(39===t||34===t){var r=this.consumeStringToken(this.consumeCodePoint());return r.type===sA.STRING_TOKEN&&(this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:sA.URL_TOKEN,value:r.value}):(this.consumeBadUrlRemnants(),IA)}for(;;){var n=this.consumeCodePoint();if(-1===n||41===n)return{type:sA.URL_TOKEN,value:l.apply(void 0,A)};if(cA(n))return this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:sA.URL_TOKEN,value:l.apply(void 0,A)}):(this.consumeBadUrlRemnants(),IA);if(34===n||39===n||40===n||0<=(e=n)&&e<=8||11===e||14<=e&&e<=31||127===e)return this.consumeBadUrlRemnants(),IA;if(92===n){if(!uA(n,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),IA;A.push(this.consumeEscapedCodePoint())}else A.push(n)}},yA.prototype.consumeWhiteSpace=function(){for(;cA(this.peekCodePoint(0));)this.consumeCodePoint()},yA.prototype.consumeBadUrlRemnants=function(){for(;;){var A=this.consumeCodePoint();if(41===A||-1===A)return;uA(A,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},yA.prototype.consumeStringSlice=function(A){for(var e="";0<A;){var t=Math.min(6e4,A);e+=l.apply(void 0,this._value.splice(0,t)),A-=t}return this._value.shift(),e},yA.prototype.consumeStringToken=function(A){for(var e="",t=0;;){var r=this._value[t];if(-1===r||void 0===r||r===A)return e+=this.consumeStringSlice(t),{type:sA.STRING_TOKEN,value:e};if(10===r)return this._value.splice(0,t),TA;if(92===r){var n=this._value[t+1];-1!==n&&void 0!==n&&(10===n?(e+=this.consumeStringSlice(t),t=-1,this._value.shift()):uA(r,n)&&(e+=this.consumeStringSlice(t),e+=l(this.consumeEscapedCodePoint()),t=-1))}t++}},yA.prototype.consumeNumber=function(){var A=[],e=4,t=this.peekCodePoint(0);for(43!==t&&45!==t||A.push(this.consumeCodePoint());iA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());t=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(46===t&&iA(r))for(A.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;iA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());t=this.peekCodePoint(0),r=this.peekCodePoint(1);var n=this.peekCodePoint(2);if((69===t||101===t)&&((43===r||45===r)&&iA(n)||iA(r)))for(A.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;iA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());return[function(A){var e=0,t=1;43!==A[e]&&45!==A[e]||(45===A[e]&&(t=-1),e++);for(var r=[];iA(A[e]);)r.push(A[e++]);var n=r.length?parseInt(l.apply(void 0,r),10):0;46===A[e]&&e++;for(var B=[];iA(A[e]);)B.push(A[e++]);var s=B.length,o=s?parseInt(l.apply(void 0,B),10):0;69!==A[e]&&101!==A[e]||e++;var i=1;43!==A[e]&&45!==A[e]||(45===A[e]&&(i=-1),e++);for(var a=[];iA(A[e]);)a.push(A[e++]);var c=a.length?parseInt(l.apply(void 0,a),10):0;return t*(n+o*Math.pow(10,-s))*Math.pow(10,i*c)}(A),e]},yA.prototype.consumeNumericToken=function(){var A=this.consumeNumber(),e=A[0],t=A[1],r=this.peekCodePoint(0),n=this.peekCodePoint(1),B=this.peekCodePoint(2);if(UA(r,n,B)){var s=this.consumeName();return{type:sA.DIMENSION_TOKEN,number:e,flags:t,unit:s}}return 37===r?(this.consumeCodePoint(),{type:sA.PERCENTAGE_TOKEN,number:e,flags:t}):{type:sA.NUMBER_TOKEN,number:e,flags:t}},yA.prototype.consumeEscapedCodePoint=function(){var A=this.consumeCodePoint();if(aA(A)){for(var e=l(A);aA(this.peekCodePoint(0))&&e.length<6;)e+=l(this.consumeCodePoint());cA(this.peekCodePoint(0))&&this.consumeCodePoint();var t=parseInt(e,16);return 0===t||function(A){return 55296<=A&&A<=57343}(t)||1114111<t?65533:t}return-1===A?65533:A},yA.prototype.consumeName=function(){for(var A="";;){var e=this.consumeCodePoint();if(wA(e))A+=l(e);else{if(!uA(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),A;A+=l(this.consumeEscapedCodePoint())}}},yA);function yA(){this._value=[]}var _A=(PA.create=function(A){var e=new MA;return e.write(A),new PA(e.read())},PA.parseValue=function(A){return PA.create(A).parseComponentValue()},PA.parseValues=function(A){return PA.create(A).parseComponentValues()},PA.prototype.parseComponentValue=function(){for(var A=this.consumeToken();A.type===sA.WHITESPACE_TOKEN;)A=this.consumeToken();if(A.type===sA.EOF_TOKEN)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(A);for(var e=this.consumeComponentValue();(A=this.consumeToken()).type===sA.WHITESPACE_TOKEN;);if(A.type===sA.EOF_TOKEN)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},PA.prototype.parseComponentValues=function(){for(var A=[];;){var e=this.consumeComponentValue();if(e.type===sA.EOF_TOKEN)return A;A.push(e),A.push()}},PA.prototype.consumeComponentValue=function(){var A=this.consumeToken();switch(A.type){case sA.LEFT_CURLY_BRACKET_TOKEN:case sA.LEFT_SQUARE_BRACKET_TOKEN:case sA.LEFT_PARENTHESIS_TOKEN:return this.consumeSimpleBlock(A.type);case sA.FUNCTION_TOKEN:return this.consumeFunction(A)}return A},PA.prototype.consumeSimpleBlock=function(A){for(var e={type:A,values:[]},t=this.consumeToken();;){if(t.type===sA.EOF_TOKEN||Be(t,A))return e;this.reconsumeToken(t),e.values.push(this.consumeComponentValue()),t=this.consumeToken()}},PA.prototype.consumeFunction=function(A){for(var e={name:A.value,values:[],type:sA.FUNCTION};;){var t=this.consumeToken();if(t.type===sA.EOF_TOKEN||t.type===sA.RIGHT_PARENTHESIS_TOKEN)return e;this.reconsumeToken(t),e.values.push(this.consumeComponentValue())}},PA.prototype.consumeToken=function(){var A=this._tokens.shift();return void 0===A?SA:A},PA.prototype.reconsumeToken=function(A){this._tokens.unshift(A)},PA);function PA(A){this._tokens=A}function xA(A){return A.type===sA.DIMENSION_TOKEN}function VA(A){return A.type===sA.NUMBER_TOKEN}function zA(A){return A.type===sA.IDENT_TOKEN}function XA(A){return A.type===sA.STRING_TOKEN}function JA(A,e){return zA(A)&&A.value===e}function GA(A){return A.type!==sA.WHITESPACE_TOKEN}function kA(A){return A.type!==sA.WHITESPACE_TOKEN&&A.type!==sA.COMMA_TOKEN}function WA(A){var e=[],t=[];return A.forEach(function(A){if(A.type===sA.COMMA_TOKEN){if(0===t.length)throw new Error("Error parsing function args, zero tokens for arg");return e.push(t),void(t=[])}A.type!==sA.WHITESPACE_TOKEN&&t.push(A)}),t.length&&e.push(t),e}function YA(A){return A.type===sA.NUMBER_TOKEN||A.type===sA.DIMENSION_TOKEN}function qA(A){return A.type===sA.PERCENTAGE_TOKEN||YA(A)}function ZA(A){return 1<A.length?[A[0],A[1]]:[A[0]]}function jA(A,e,t){var r=A[0],n=A[1];return[ae(r,e),ae(void 0!==n?n:r,t)]}function $A(A){return A.type===sA.DIMENSION_TOKEN&&("deg"===A.unit||"grad"===A.unit||"rad"===A.unit||"turn"===A.unit)}function Ae(A){switch(A.filter(zA).map(function(A){return A.value}).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[se,se];case"to top":case"bottom":return Qe(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[se,ie];case"to right":case"left":return Qe(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[ie,ie];case"to bottom":case"top":return Qe(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[ie,se];case"to left":case"right":return Qe(270)}return 0}function ee(A){return 0==(255&A)}function te(A){var e=255&A,t=255&A>>8,r=255&A>>16,n=255&A>>24;return e<255?"rgba("+n+","+r+","+t+","+e/255+")":"rgb("+n+","+r+","+t+")"}function re(A,e){if(A.type===sA.NUMBER_TOKEN)return A.number;if(A.type!==sA.PERCENTAGE_TOKEN)return 0;var t=3===e?1:255;return 3===e?A.number/100*t:Math.round(A.number/100*t)}function ne(A){var e=A.filter(kA);if(3===e.length){var t=e.map(re),r=t[0],n=t[1],B=t[2];return ue(r,n,B,1)}if(4!==e.length)return 0;var s=e.map(re),o=(r=s[0],n=s[1],B=s[2],s[3]);return ue(r,n,B,o)}var Be=function(A,e){return e===sA.LEFT_CURLY_BRACKET_TOKEN&&A.type===sA.RIGHT_CURLY_BRACKET_TOKEN||(e===sA.LEFT_SQUARE_BRACKET_TOKEN&&A.type===sA.RIGHT_SQUARE_BRACKET_TOKEN||e===sA.LEFT_PARENTHESIS_TOKEN&&A.type===sA.RIGHT_PARENTHESIS_TOKEN)},se={type:sA.NUMBER_TOKEN,number:0,flags:4},oe={type:sA.PERCENTAGE_TOKEN,number:50,flags:4},ie={type:sA.PERCENTAGE_TOKEN,number:100,flags:4},ae=function(A,e){if(A.type===sA.PERCENTAGE_TOKEN)return A.number/100*e;if(xA(A))switch(A.unit){case"rem":case"em":return 16*A.number;case"px":default:return A.number}return A.number},ce=function(A){if(A.type===sA.DIMENSION_TOKEN)switch(A.unit){case"deg":return Math.PI*A.number/180;case"grad":return Math.PI/200*A.number;case"rad":return A.number;case"turn":return 2*Math.PI*A.number}throw new Error("Unsupported angle type")},Qe=function(A){return Math.PI*A/180},we=function(A){if(A.type===sA.FUNCTION){var e=he[A.name];if(void 0===e)throw new Error('Attempting to parse an unsupported color function "'+A.name+'"');return e(A.values)}if(A.type===sA.HASH_TOKEN){if(3===A.value.length){var t=A.value.substring(0,1),r=A.value.substring(1,2),n=A.value.substring(2,3);return ue(parseInt(t+t,16),parseInt(r+r,16),parseInt(n+n,16),1)}if(4===A.value.length){t=A.value.substring(0,1),r=A.value.substring(1,2),n=A.value.substring(2,3);var B=A.value.substring(3,4);return ue(parseInt(t+t,16),parseInt(r+r,16),parseInt(n+n,16),parseInt(B+B,16)/255)}if(6===A.value.length){t=A.value.substring(0,2),r=A.value.substring(2,4),n=A.value.substring(4,6);return ue(parseInt(t,16),parseInt(r,16),parseInt(n,16),1)}if(8===A.value.length){t=A.value.substring(0,2),r=A.value.substring(2,4),n=A.value.substring(4,6),B=A.value.substring(6,8);return ue(parseInt(t,16),parseInt(r,16),parseInt(n,16),parseInt(B,16)/255)}}if(A.type===sA.IDENT_TOKEN){var s=He[A.value.toUpperCase()];if(void 0!==s)return s}return He.TRANSPARENT},ue=function(A,e,t,r){return(A<<24|e<<16|t<<8|Math.round(255*r)<<0)>>>0};function Ue(A,e,t){return t<0&&(t+=1),1<=t&&(t-=1),t<1/6?(e-A)*t*6+A:t<.5?e:t<2/3?6*(e-A)*(2/3-t)+A:A}function le(A){var e=A.filter(kA),t=e[0],r=e[1],n=e[2],B=e[3],s=(t.type===sA.NUMBER_TOKEN?Qe(t.number):ce(t))/(2*Math.PI),o=qA(r)?r.number/100:0,i=qA(n)?n.number/100:0,a=void 0!==B&&qA(B)?ae(B,1):1;if(0==o)return ue(255*i,255*i,255*i,1);var c=i<=.5?i*(1+o):i+o-i*o,Q=2*i-c,w=Ue(Q,c,s+1/3),u=Ue(Q,c,s),U=Ue(Q,c,s-1/3);return ue(255*w,255*u,255*U,a)}var Ce,ge,Ee,Fe,he={hsl:le,hsla:le,rgb:ne,rgba:ne},He={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199};(ge=Ce||(Ce={}))[ge.VALUE=0]="VALUE",ge[ge.LIST=1]="LIST",ge[ge.IDENT_VALUE=2]="IDENT_VALUE",ge[ge.TYPE_VALUE=3]="TYPE_VALUE",ge[ge.TOKEN_VALUE=4]="TOKEN_VALUE",(Fe=Ee||(Ee={}))[Fe.BORDER_BOX=0]="BORDER_BOX",Fe[Fe.PADDING_BOX=1]="PADDING_BOX";function de(A){var e=we(A[0]),t=A[1];return t&&qA(t)?{color:e,stop:t}:{color:e,stop:null}}function fe(A,t){var e=A[0],r=A[A.length-1];null===e.stop&&(e.stop=se),null===r.stop&&(r.stop=ie);for(var n=[],B=0,s=0;s<A.length;s++){var o=A[s].stop;if(null!==o){var i=ae(o,t);B<i?n.push(i):n.push(B),B=i}else n.push(null)}var a=null;for(s=0;s<n.length;s++){var c=n[s];if(null===c)null===a&&(a=s);else if(null!==a){for(var Q=s-a,w=(c-n[a-1])/(1+Q),u=1;u<=Q;u++)n[a+u-1]=w*u;a=null}}return A.map(function(A,e){return{color:A.color,stop:Math.max(Math.min(1,n[e]/t),0)}})}function pe(A,e,t){var r="number"==typeof A?A:function(A,e,t){var r=e/2,n=t/2,B=ae(A[0],e)-r,s=n-ae(A[1],t);return(Math.atan2(s,B)+2*Math.PI)%(2*Math.PI)}(A,e,t),n=Math.abs(e*Math.sin(r))+Math.abs(t*Math.cos(r)),B=e/2,s=t/2,o=n/2,i=Math.sin(r-Math.PI/2)*o,a=Math.cos(r-Math.PI/2)*o;return[n,B-a,B+a,s-i,s+i]}function Ne(A,e){return Math.sqrt(A*A+e*e)}function Ke(A,e,B,s,o){return[[0,0],[0,e],[A,0],[A,e]].reduce(function(A,e){var t=e[0],r=e[1],n=Ne(B-t,s-r);return(o?n<A.optimumDistance:n>A.optimumDistance)?{optimumCorner:e,optimumDistance:n}:A},{optimumDistance:o?1/0:-1/0,optimumCorner:null}).optimumCorner}function Ie(A){var n=Qe(180),B=[];return WA(A).forEach(function(A,e){if(0===e){var t=A[0];if(t.type===sA.IDENT_TOKEN&&-1!==["top","left","right","bottom"].indexOf(t.value))return void(n=Ae(A));if($A(t))return void(n=(ce(t)+Qe(270))%Qe(360))}var r=de(A);B.push(r)}),{angle:n,stops:B,type:xe.LINEAR_GRADIENT}}function Te(A){return 0===A[0]&&255===A[1]&&0===A[2]&&255===A[3]}var me={name:"background-clip",initialValue:"border-box",prefix:!(Fe[Fe.CONTENT_BOX=2]="CONTENT_BOX"),type:Ce.LIST,parse:function(A){return A.map(function(A){if(zA(A))switch(A.value){case"padding-box":return Ee.PADDING_BOX;case"content-box":return Ee.CONTENT_BOX}return Ee.BORDER_BOX})}},Re={name:"background-color",initialValue:"transparent",prefix:!1,type:Ce.TYPE_VALUE,format:"color"},Le=function(A,e,t,r,n){var B="http://www.w3.org/2000/svg",s=document.createElementNS(B,"svg"),o=document.createElementNS(B,"foreignObject");return s.setAttributeNS(null,"width",A.toString()),s.setAttributeNS(null,"height",e.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",t.toString()),o.setAttributeNS(null,"y",r.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),s.appendChild(o),o.appendChild(n),s},ve=function(r){return new Promise(function(A,e){var t=new Image;t.onload=function(){return A(t)},t.onerror=e,t.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(r))})},Oe={get SUPPORT_RANGE_BOUNDS(){var A=function(A){if(A.createRange){var e=A.createRange();if(e.getBoundingClientRect){var t=A.createElement("boundtest");t.style.height="123px",t.style.display="block",A.body.appendChild(t),e.selectNode(t);var r=e.getBoundingClientRect(),n=Math.round(r.height);if(A.body.removeChild(t),123===n)return!0}}return!1}(document);return Object.defineProperty(Oe,"SUPPORT_RANGE_BOUNDS",{value:A}),A},get SUPPORT_SVG_DRAWING(){var A=function(A){var e=new Image,t=A.createElement("canvas"),r=t.getContext("2d");if(!r)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(e,0,0),t.toDataURL()}catch(A){return!1}return!0}(document);return Object.defineProperty(Oe,"SUPPORT_SVG_DRAWING",{value:A}),A},get SUPPORT_FOREIGNOBJECT_DRAWING(){var A="function"==typeof Array.from&&"function"==typeof window.fetch?function(r){var A=r.createElement("canvas"),n=100;A.width=n,A.height=n;var B=A.getContext("2d");if(!B)return Promise.reject(!1);B.fillStyle="rgb(0, 255, 0)",B.fillRect(0,0,n,n);var e=new Image,s=A.toDataURL();e.src=s;var t=Le(n,n,0,0,e);return B.fillStyle="red",B.fillRect(0,0,n,n),ve(t).then(function(A){B.drawImage(A,0,0);var e=B.getImageData(0,0,n,n).data;B.fillStyle="red",B.fillRect(0,0,n,n);var t=r.createElement("div");return t.style.backgroundImage="url("+s+")",t.style.height="100px",Te(e)?ve(Le(n,n,0,0,t)):Promise.reject(!1)}).then(function(A){return B.drawImage(A,0,0),Te(B.getImageData(0,0,n,n).data)}).catch(function(){return!1})}(document):Promise.resolve(!1);return Object.defineProperty(Oe,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:A}),A},get SUPPORT_CORS_IMAGES(){var A=void 0!==(new Image).crossOrigin;return Object.defineProperty(Oe,"SUPPORT_CORS_IMAGES",{value:A}),A},get SUPPORT_RESPONSE_TYPE(){var A="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(Oe,"SUPPORT_RESPONSE_TYPE",{value:A}),A},get SUPPORT_CORS_XHR(){var A="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Oe,"SUPPORT_CORS_XHR",{value:A}),A}},De=(be.prototype.debug=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,[this.id,this.getTime()+"ms"].concat(A)):this.info.apply(this,A))},be.prototype.getTime=function(){return Date.now()-this.start},be.create=function(A){be.instances[A.id]=new be(A)},be.destroy=function(A){delete be.instances[A]},be.getInstance=function(A){var e=be.instances[A];if(void 0===e)throw new Error("No logger instance found with id "+A);return e},be.prototype.info=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,[this.id,this.getTime()+"ms"].concat(A))},be.prototype.error=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,[this.id,this.getTime()+"ms"].concat(A)):this.info.apply(this,A))},be.instances={},be);function be(A){var e=A.id,t=A.enabled;this.id=e,this.enabled=t,this.start=Date.now()}var Se=(Me.create=function(A,e){return Me._caches[A]=new ye(A,e)},Me.destroy=function(A){delete Me._caches[A]},Me.open=function(A){var e=Me._caches[A];if(void 0!==e)return e;throw new Error('Cache with key "'+A+'" not found')},Me.getOrigin=function(A){var e=Me._link;return e?(e.href=A,e.href=e.href,e.protocol+e.hostname+e.port):"about:blank"},Me.isSameOrigin=function(A){return Me.getOrigin(A)===Me._origin},Me.setContext=function(A){Me._link=A.document.createElement("a"),Me._origin=Me.getOrigin(A.location.href)},Me.getInstance=function(){var A=Me._current;if(null===A)throw new Error("No cache instance attached");return A},Me.attachInstance=function(A){Me._current=A},Me.detachInstance=function(){Me._current=null},Me._caches={},Me._origin="about:blank",Me._current=null,Me);function Me(){}var ye=(_e.prototype.addImage=function(A){var e=Promise.resolve();return this.has(A)||(Ye(A)||Ge(A))&&(this._cache[A]=this.loadImage(A)),e},_e.prototype.match=function(A){return this._cache[A]},_e.prototype.loadImage=function(s){return a(this,void 0,void 0,function(){var e,r,t,n,B=this;return S(this,function(A){switch(A.label){case 0:return e=Se.isSameOrigin(s),r=!ke(s)&&!0===this._options.useCORS&&Oe.SUPPORT_CORS_IMAGES&&!e,t=!ke(s)&&!e&&"string"==typeof this._options.proxy&&Oe.SUPPORT_CORS_XHR&&!r,e||!1!==this._options.allowTaint||ke(s)||t||r?(n=s,t?[4,this.proxy(n)]:[3,2]):[2];case 1:n=A.sent(),A.label=2;case 2:return De.getInstance(this.id).debug("Added image "+s.substring(0,256)),[4,new Promise(function(A,e){var t=new Image;t.onload=function(){return A(t)},t.onerror=e,(We(n)||r)&&(t.crossOrigin="anonymous"),t.src=n,!0===t.complete&&setTimeout(function(){return A(t)},500),0<B._options.imageTimeout&&setTimeout(function(){return e("Timed out ("+B._options.imageTimeout+"ms) loading image")},B._options.imageTimeout)})];case 3:return[2,A.sent()]}})})},_e.prototype.has=function(A){return void 0!==this._cache[A]},_e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},_e.prototype.proxy=function(B){var s=this,o=this._options.proxy;if(!o)throw new Error("No proxy defined");var i=B.substring(0,256);return new Promise(function(e,t){var r=Oe.SUPPORT_RESPONSE_TYPE?"blob":"text",n=new XMLHttpRequest;if(n.onload=function(){if(200===n.status)if("text"==r)e(n.response);else{var A=new FileReader;A.addEventListener("load",function(){return e(A.result)},!1),A.addEventListener("error",function(A){return t(A)},!1),A.readAsDataURL(n.response)}else t("Failed to proxy resource "+i+" with status code "+n.status)},n.onerror=t,n.open("GET",o+"?url="+encodeURIComponent(B)+"&responseType="+r),"text"!=r&&n instanceof XMLHttpRequest&&(n.responseType=r),s._options.imageTimeout){var A=s._options.imageTimeout;n.timeout=A,n.ontimeout=function(){return t("Timed out ("+A+"ms) proxying "+i)}}n.send()})},_e);function _e(A,e){this.id=A,this._options=e,this._cache={}}function Pe(A){var n=rt.CIRCLE,B=Bt.FARTHEST_CORNER,s=[],o=[];return WA(A).forEach(function(A,e){var t=!0;if(0===e?t=A.reduce(function(A,e){if(zA(e))switch(e.value){case"center":return o.push(oe),!1;case"top":case"left":return o.push(se),!1;case"right":case"bottom":return o.push(ie),!1}else if(qA(e)||YA(e))return o.push(e),!1;return A},t):1===e&&(t=A.reduce(function(A,e){if(zA(e))switch(e.value){case"circle":return n=rt.CIRCLE,!1;case et:return n=rt.ELLIPSE,!1;case tt:case Ze:return B=Bt.CLOSEST_SIDE,!1;case je:return B=Bt.FARTHEST_SIDE,!1;case $e:return B=Bt.CLOSEST_CORNER,!1;case"cover":case At:return B=Bt.FARTHEST_CORNER,!1}else if(YA(e)||qA(e))return Array.isArray(B)||(B=[]),B.push(e),!1;return A},t)),t){var r=de(A);s.push(r)}}),{size:B,shape:n,stops:s,position:o,type:xe.RADIAL_GRADIENT}}var xe,Ve,ze=/^data:image\/svg\+xml/i,Xe=/^data:image\/.*;base64,/i,Je=/^data:image\/.*/i,Ge=function(A){return Oe.SUPPORT_SVG_DRAWING||!qe(A)},ke=function(A){return Je.test(A)},We=function(A){return Xe.test(A)},Ye=function(A){return"blob"===A.substr(0,4)},qe=function(A){return"svg"===A.substr(-3).toLowerCase()||ze.test(A)},Ze="closest-side",je="farthest-side",$e="closest-corner",At="farthest-corner",et="ellipse",tt="contain";(Ve=xe||(xe={}))[Ve.URL=0]="URL",Ve[Ve.LINEAR_GRADIENT=1]="LINEAR_GRADIENT",Ve[Ve.RADIAL_GRADIENT=2]="RADIAL_GRADIENT";var rt,nt,Bt,st;(nt=rt||(rt={}))[nt.CIRCLE=0]="CIRCLE",nt[nt.ELLIPSE=1]="ELLIPSE",(st=Bt||(Bt={}))[st.CLOSEST_SIDE=0]="CLOSEST_SIDE",st[st.FARTHEST_SIDE=1]="FARTHEST_SIDE",st[st.CLOSEST_CORNER=2]="CLOSEST_CORNER",st[st.FARTHEST_CORNER=3]="FARTHEST_CORNER";var ot=function(A){if(A.type===sA.URL_TOKEN){var e={url:A.value,type:xe.URL};return Se.getInstance().addImage(A.value),e}if(A.type!==sA.FUNCTION)throw new Error("Unsupported image type");var t=ct[A.name];if(void 0===t)throw new Error('Attempting to parse an unsupported image function "'+A.name+'"');return t(A.values)};var it,at,ct={"linear-gradient":function(A){var n=Qe(180),B=[];return WA(A).forEach(function(A,e){if(0===e){var t=A[0];if(t.type===sA.IDENT_TOKEN&&"to"===t.value)return void(n=Ae(A));if($A(t))return void(n=ce(t))}var r=de(A);B.push(r)}),{angle:n,stops:B,type:xe.LINEAR_GRADIENT}},"-moz-linear-gradient":Ie,"-ms-linear-gradient":Ie,"-o-linear-gradient":Ie,"-webkit-linear-gradient":Ie,"radial-gradient":function(A){var B=rt.CIRCLE,s=Bt.FARTHEST_CORNER,o=[],i=[];return WA(A).forEach(function(A,e){var t=!0;if(0===e){var r=!1;t=A.reduce(function(A,e){if(r)if(zA(e))switch(e.value){case"center":return i.push(oe),A;case"top":case"left":return i.push(se),A;case"right":case"bottom":return i.push(ie),A}else(qA(e)||YA(e))&&i.push(e);else if(zA(e))switch(e.value){case"circle":return B=rt.CIRCLE,!1;case et:return B=rt.ELLIPSE,!1;case"at":return!(r=!0);case Ze:return s=Bt.CLOSEST_SIDE,!1;case"cover":case je:return s=Bt.FARTHEST_SIDE,!1;case tt:case $e:return s=Bt.CLOSEST_CORNER,!1;case At:return s=Bt.FARTHEST_CORNER,!1}else if(YA(e)||qA(e))return Array.isArray(s)||(s=[]),s.push(e),!1;return A},t)}if(t){var n=de(A);o.push(n)}}),{size:s,shape:B,stops:o,position:i,type:xe.RADIAL_GRADIENT}},"-moz-radial-gradient":Pe,"-ms-radial-gradient":Pe,"-o-radial-gradient":Pe,"-webkit-radial-gradient":Pe,"-webkit-gradient":function(A){var e=Qe(180),s=[],o=xe.LINEAR_GRADIENT,t=rt.CIRCLE,r=Bt.FARTHEST_CORNER;return WA(A).forEach(function(A,e){var t=A[0];if(0===e){if(zA(t)&&"linear"===t.value)return void(o=xe.LINEAR_GRADIENT);if(zA(t)&&"radial"===t.value)return void(o=xe.RADIAL_GRADIENT)}if(t.type===sA.FUNCTION)if("from"===t.name){var r=we(t.values[0]);s.push({stop:se,color:r})}else if("to"===t.name)r=we(t.values[0]),s.push({stop:ie,color:r});else if("color-stop"===t.name){var n=t.values.filter(kA);if(2===n.length){r=we(n[1]);var B=n[0];VA(B)&&s.push({stop:{type:sA.PERCENTAGE_TOKEN,number:100*B.number,flags:B.flags},color:r})}}}),o===xe.LINEAR_GRADIENT?{angle:(e+Qe(180))%Qe(360),stops:s,type:o}:{size:r,shape:t,stops:s,position:[],type:o}}},Qt={name:"background-image",initialValue:"none",type:Ce.LIST,prefix:!1,parse:function(A){if(0===A.length)return[];var e=A[0];return e.type===sA.IDENT_TOKEN&&"none"===e.value?[]:A.filter(function(A){return kA(A)&&function(A){return A.type!==sA.FUNCTION||ct[A.name]}(A)}).map(ot)}},wt={name:"background-origin",initialValue:"border-box",prefix:!1,type:Ce.LIST,parse:function(A){return A.map(function(A){if(zA(A))switch(A.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},ut={name:"background-position",initialValue:"0% 0%",type:Ce.LIST,prefix:!1,parse:function(A){return WA(A).map(function(A){return A.filter(qA)}).map(ZA)}};(at=it||(it={}))[at.REPEAT=0]="REPEAT",at[at.NO_REPEAT=1]="NO_REPEAT",at[at.REPEAT_X=2]="REPEAT_X";var Ut,lt,Ct={name:"background-repeat",initialValue:"repeat",prefix:!(at[at.REPEAT_Y=3]="REPEAT_Y"),type:Ce.LIST,parse:function(A){return WA(A).map(function(A){return A.filter(zA).map(function(A){return A.value}).join(" ")}).map(gt)}},gt=function(A){switch(A){case"no-repeat":return it.NO_REPEAT;case"repeat-x":case"repeat no-repeat":return it.REPEAT_X;case"repeat-y":case"no-repeat repeat":return it.REPEAT_Y;case"repeat":default:return it.REPEAT}};(lt=Ut||(Ut={})).AUTO="auto",lt.CONTAIN="contain";function Et(A){return{name:"border-"+A+"-color",initialValue:"transparent",prefix:!1,type:Ce.TYPE_VALUE,format:"color"}}function Ft(A){return{name:"border-radius-"+A,initialValue:"0 0",prefix:!1,type:Ce.LIST,parse:function(A){return ZA(A.filter(qA))}}}var ht,Ht,dt={name:"background-size",initialValue:"0",prefix:!(lt.COVER="cover"),type:Ce.LIST,parse:function(A){return WA(A).map(function(A){return A.filter(ft)})}},ft=function(A){return zA(A)||qA(A)},pt=Et("top"),Nt=Et("right"),Kt=Et("bottom"),It=Et("left"),Tt=Ft("top-left"),mt=Ft("top-right"),Rt=Ft("bottom-right"),Lt=Ft("bottom-left");(Ht=ht||(ht={}))[Ht.NONE=0]="NONE",Ht[Ht.SOLID=1]="SOLID";function vt(A){return{name:"border-"+A+"-style",initialValue:"solid",prefix:!1,type:Ce.IDENT_VALUE,parse:function(A){switch(A){case"none":return ht.NONE}return ht.SOLID}}}function Ot(A){return{name:"border-"+A+"-width",initialValue:"0",type:Ce.VALUE,prefix:!1,parse:function(A){return xA(A)?A.number:0}}}var Dt,bt,St=vt("top"),Mt=vt("right"),yt=vt("bottom"),_t=vt("left"),Pt=Ot("top"),xt=Ot("right"),Vt=Ot("bottom"),zt=Ot("left"),Xt={name:"color",initialValue:"transparent",prefix:!1,type:Ce.TYPE_VALUE,format:"color"},Jt={name:"display",initialValue:"inline-block",prefix:!1,type:Ce.LIST,parse:function(A){return A.filter(zA).reduce(function(A,e){return A|Gt(e.value)},0)}},Gt=function(A){switch(A){case"block":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0};(bt=Dt||(Dt={}))[bt.NONE=0]="NONE",bt[bt.LEFT=1]="LEFT",bt[bt.RIGHT=2]="RIGHT",bt[bt.INLINE_START=3]="INLINE_START";var kt,Wt,Yt,qt,Zt={name:"float",initialValue:"none",prefix:!(bt[bt.INLINE_END=4]="INLINE_END"),type:Ce.IDENT_VALUE,parse:function(A){switch(A){case"left":return Dt.LEFT;case"right":return Dt.RIGHT;case"inline-start":return Dt.INLINE_START;case"inline-end":return Dt.INLINE_END}return Dt.NONE}},jt={name:"letter-spacing",initialValue:"0",prefix:!1,type:Ce.VALUE,parse:function(A){return A.type===sA.IDENT_TOKEN&&"normal"===A.value?0:A.type===sA.NUMBER_TOKEN?A.number:A.type===sA.DIMENSION_TOKEN?A.number:0}},$t={name:"line-break",initialValue:(Wt=kt||(kt={})).NORMAL="normal",prefix:!(Wt.STRICT="strict"),type:Ce.IDENT_VALUE,parse:function(A){switch(A){case"strict":return kt.STRICT;case"normal":default:return kt.NORMAL}}},Ar={name:"line-height",initialValue:"normal",prefix:!1,type:Ce.TOKEN_VALUE},er={name:"list-style-image",initialValue:"none",type:Ce.VALUE,prefix:!1,parse:function(A){return A.type===sA.IDENT_TOKEN&&"none"===A.value?null:ot(A)}};(qt=Yt||(Yt={}))[qt.INSIDE=0]="INSIDE";var tr,rr,nr={name:"list-style-position",initialValue:"outside",prefix:!(qt[qt.OUTSIDE=1]="OUTSIDE"),type:Ce.IDENT_VALUE,parse:function(A){switch(A){case"inside":return Yt.INSIDE;case"outside":default:return Yt.OUTSIDE}}};(rr=tr||(tr={}))[rr.NONE=-1]="NONE",rr[rr.DISC=0]="DISC",rr[rr.CIRCLE=1]="CIRCLE",rr[rr.SQUARE=2]="SQUARE",rr[rr.DECIMAL=3]="DECIMAL",rr[rr.CJK_DECIMAL=4]="CJK_DECIMAL",rr[rr.DECIMAL_LEADING_ZERO=5]="DECIMAL_LEADING_ZERO",rr[rr.LOWER_ROMAN=6]="LOWER_ROMAN",rr[rr.UPPER_ROMAN=7]="UPPER_ROMAN",rr[rr.LOWER_GREEK=8]="LOWER_GREEK",rr[rr.LOWER_ALPHA=9]="LOWER_ALPHA",rr[rr.UPPER_ALPHA=10]="UPPER_ALPHA",rr[rr.ARABIC_INDIC=11]="ARABIC_INDIC",rr[rr.ARMENIAN=12]="ARMENIAN",rr[rr.BENGALI=13]="BENGALI",rr[rr.CAMBODIAN=14]="CAMBODIAN",rr[rr.CJK_EARTHLY_BRANCH=15]="CJK_EARTHLY_BRANCH",rr[rr.CJK_HEAVENLY_STEM=16]="CJK_HEAVENLY_STEM",rr[rr.CJK_IDEOGRAPHIC=17]="CJK_IDEOGRAPHIC",rr[rr.DEVANAGARI=18]="DEVANAGARI",rr[rr.ETHIOPIC_NUMERIC=19]="ETHIOPIC_NUMERIC",rr[rr.GEORGIAN=20]="GEORGIAN",rr[rr.GUJARATI=21]="GUJARATI",rr[rr.GURMUKHI=22]="GURMUKHI",rr[rr.HEBREW=22]="HEBREW",rr[rr.HIRAGANA=23]="HIRAGANA",rr[rr.HIRAGANA_IROHA=24]="HIRAGANA_IROHA",rr[rr.JAPANESE_FORMAL=25]="JAPANESE_FORMAL",rr[rr.JAPANESE_INFORMAL=26]="JAPANESE_INFORMAL",rr[rr.KANNADA=27]="KANNADA",rr[rr.KATAKANA=28]="KATAKANA",rr[rr.KATAKANA_IROHA=29]="KATAKANA_IROHA",rr[rr.KHMER=30]="KHMER",rr[rr.KOREAN_HANGUL_FORMAL=31]="KOREAN_HANGUL_FORMAL",rr[rr.KOREAN_HANJA_FORMAL=32]="KOREAN_HANJA_FORMAL",rr[rr.KOREAN_HANJA_INFORMAL=33]="KOREAN_HANJA_INFORMAL",rr[rr.LAO=34]="LAO",rr[rr.LOWER_ARMENIAN=35]="LOWER_ARMENIAN",rr[rr.MALAYALAM=36]="MALAYALAM",rr[rr.MONGOLIAN=37]="MONGOLIAN",rr[rr.MYANMAR=38]="MYANMAR",rr[rr.ORIYA=39]="ORIYA",rr[rr.PERSIAN=40]="PERSIAN",rr[rr.SIMP_CHINESE_FORMAL=41]="SIMP_CHINESE_FORMAL",rr[rr.SIMP_CHINESE_INFORMAL=42]="SIMP_CHINESE_INFORMAL",rr[rr.TAMIL=43]="TAMIL",rr[rr.TELUGU=44]="TELUGU",rr[rr.THAI=45]="THAI",rr[rr.TIBETAN=46]="TIBETAN",rr[rr.TRAD_CHINESE_FORMAL=47]="TRAD_CHINESE_FORMAL",rr[rr.TRAD_CHINESE_INFORMAL=48]="TRAD_CHINESE_INFORMAL",rr[rr.UPPER_ARMENIAN=49]="UPPER_ARMENIAN",rr[rr.DISCLOSURE_OPEN=50]="DISCLOSURE_OPEN";function Br(A){return{name:"margin-"+A,initialValue:"0",prefix:!1,type:Ce.TOKEN_VALUE}}var sr,or,ir={name:"list-style-type",initialValue:"none",prefix:!(rr[rr.DISCLOSURE_CLOSED=51]="DISCLOSURE_CLOSED"),type:Ce.IDENT_VALUE,parse:function(A){switch(A){case"disc":return tr.DISC;case"circle":return tr.CIRCLE;case"square":return tr.SQUARE;case"decimal":return tr.DECIMAL;case"cjk-decimal":return tr.CJK_DECIMAL;case"decimal-leading-zero":return tr.DECIMAL_LEADING_ZERO;case"lower-roman":return tr.LOWER_ROMAN;case"upper-roman":return tr.UPPER_ROMAN;case"lower-greek":return tr.LOWER_GREEK;case"lower-alpha":return tr.LOWER_ALPHA;case"upper-alpha":return tr.UPPER_ALPHA;case"arabic-indic":return tr.ARABIC_INDIC;case"armenian":return tr.ARMENIAN;case"bengali":return tr.BENGALI;case"cambodian":return tr.CAMBODIAN;case"cjk-earthly-branch":return tr.CJK_EARTHLY_BRANCH;case"cjk-heavenly-stem":return tr.CJK_HEAVENLY_STEM;case"cjk-ideographic":return tr.CJK_IDEOGRAPHIC;case"devanagari":return tr.DEVANAGARI;case"ethiopic-numeric":return tr.ETHIOPIC_NUMERIC;case"georgian":return tr.GEORGIAN;case"gujarati":return tr.GUJARATI;case"gurmukhi":return tr.GURMUKHI;case"hebrew":return tr.HEBREW;case"hiragana":return tr.HIRAGANA;case"hiragana-iroha":return tr.HIRAGANA_IROHA;case"japanese-formal":return tr.JAPANESE_FORMAL;case"japanese-informal":return tr.JAPANESE_INFORMAL;case"kannada":return tr.KANNADA;case"katakana":return tr.KATAKANA;case"katakana-iroha":return tr.KATAKANA_IROHA;case"khmer":return tr.KHMER;case"korean-hangul-formal":return tr.KOREAN_HANGUL_FORMAL;case"korean-hanja-formal":return tr.KOREAN_HANJA_FORMAL;case"korean-hanja-informal":return tr.KOREAN_HANJA_INFORMAL;case"lao":return tr.LAO;case"lower-armenian":return tr.LOWER_ARMENIAN;case"malayalam":return tr.MALAYALAM;case"mongolian":return tr.MONGOLIAN;case"myanmar":return tr.MYANMAR;case"oriya":return tr.ORIYA;case"persian":return tr.PERSIAN;case"simp-chinese-formal":return tr.SIMP_CHINESE_FORMAL;case"simp-chinese-informal":return tr.SIMP_CHINESE_INFORMAL;case"tamil":return tr.TAMIL;case"telugu":return tr.TELUGU;case"thai":return tr.THAI;case"tibetan":return tr.TIBETAN;case"trad-chinese-formal":return tr.TRAD_CHINESE_FORMAL;case"trad-chinese-informal":return tr.TRAD_CHINESE_INFORMAL;case"upper-armenian":return tr.UPPER_ARMENIAN;case"disclosure-open":return tr.DISCLOSURE_OPEN;case"disclosure-closed":return tr.DISCLOSURE_CLOSED;case"none":default:return tr.NONE}}},ar=Br("top"),cr=Br("right"),Qr=Br("bottom"),wr=Br("left");(or=sr||(sr={}))[or.VISIBLE=0]="VISIBLE",or[or.HIDDEN=1]="HIDDEN",or[or.SCROLL=2]="SCROLL";function ur(A){return{name:"padding-"+A,initialValue:"0",prefix:!1,type:Ce.TYPE_VALUE,format:"length-percentage"}}var Ur,lr,Cr,gr,Er={name:"overflow",initialValue:"visible",prefix:!(or[or.AUTO=3]="AUTO"),type:Ce.LIST,parse:function(A){return A.filter(zA).map(function(A){switch(A.value){case"hidden":return sr.HIDDEN;case"scroll":return sr.SCROLL;case"auto":return sr.AUTO;case"visible":default:return sr.VISIBLE}})}},Fr={name:"overflow-wrap",initialValue:(lr=Ur||(Ur={})).NORMAL="normal",prefix:!(lr.BREAK_WORD="break-word"),type:Ce.IDENT_VALUE,parse:function(A){switch(A){case"break-word":return Ur.BREAK_WORD;case"normal":default:return Ur.NORMAL}}},hr=ur("top"),Hr=ur("right"),dr=ur("bottom"),fr=ur("left");(gr=Cr||(Cr={}))[gr.LEFT=0]="LEFT",gr[gr.CENTER=1]="CENTER";var pr,Nr,Kr={name:"text-align",initialValue:"left",prefix:!(gr[gr.RIGHT=2]="RIGHT"),type:Ce.IDENT_VALUE,parse:function(A){switch(A){case"right":return Cr.RIGHT;case"center":case"justify":return Cr.CENTER;case"left":default:return Cr.LEFT}}};(Nr=pr||(pr={}))[Nr.STATIC=0]="STATIC",Nr[Nr.RELATIVE=1]="RELATIVE",Nr[Nr.ABSOLUTE=2]="ABSOLUTE",Nr[Nr.FIXED=3]="FIXED";var Ir,Tr,mr={name:"position",initialValue:"static",prefix:!(Nr[Nr.STICKY=4]="STICKY"),type:Ce.IDENT_VALUE,parse:function(A){switch(A){case"relative":return pr.RELATIVE;case"absolute":return pr.ABSOLUTE;case"fixed":return pr.FIXED;case"sticky":return pr.STICKY}return pr.STATIC}},Rr={name:"text-shadow",initialValue:"none",type:Ce.LIST,prefix:!1,parse:function(A){return 1===A.length&&JA(A[0],"none")?[]:WA(A).map(function(A){for(var e={color:He.TRANSPARENT,offsetX:se,offsetY:se,blur:se},t=0,r=0;r<A.length;r++){var n=A[r];YA(n)?(0===t?e.offsetX=n:1===t?e.offsetY=n:e.blur=n,t++):e.color=we(n)}return e})}};(Tr=Ir||(Ir={}))[Tr.NONE=0]="NONE",Tr[Tr.LOWERCASE=1]="LOWERCASE",Tr[Tr.UPPERCASE=2]="UPPERCASE";var Lr,vr,Or={name:"text-transform",initialValue:"none",prefix:!(Tr[Tr.CAPITALIZE=3]="CAPITALIZE"),type:Ce.IDENT_VALUE,parse:function(A){switch(A){case"uppercase":return Ir.UPPERCASE;case"lowercase":return Ir.LOWERCASE;case"capitalize":return Ir.CAPITALIZE}return Ir.NONE}},Dr={name:"transform",initialValue:"none",prefix:!0,type:Ce.VALUE,parse:function(A){if(A.type===sA.IDENT_TOKEN&&"none"===A.value)return null;if(A.type!==sA.FUNCTION)return null;var e=br[A.name];if(void 0===e)throw new Error('Attempting to parse an unsupported transform function "'+A.name+'"');return e(A.values)}},br={matrix:function(A){var e=A.filter(function(A){return A.type===sA.NUMBER_TOKEN}).map(function(A){return A.number});return 6===e.length?e:null},matrix3d:function(A){var e=A.filter(function(A){return A.type===sA.NUMBER_TOKEN}).map(function(A){return A.number}),t=e[0],r=e[1],n=(e[2],e[3],e[4]),B=e[5],s=(e[6],e[7],e[8],e[9],e[10],e[11],e[12]),o=e[13];e[14],e[15];return 16===e.length?[t,r,n,B,s,o]:null}},Sr={type:sA.PERCENTAGE_TOKEN,number:50,flags:4},Mr=[Sr,Sr],yr={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:Ce.LIST,parse:function(A){var e=A.filter(qA);return 2!==e.length?Mr:[e[0],e[1]]}};(vr=Lr||(Lr={}))[vr.VISIBLE=0]="VISIBLE",vr[vr.HIDDEN=1]="HIDDEN";var _r,Pr,xr={name:"visible",initialValue:"none",prefix:!(vr[vr.COLLAPSE=2]="COLLAPSE"),type:Ce.IDENT_VALUE,parse:function(A){switch(A){case"hidden":return Lr.HIDDEN;case"collapse":return Lr.COLLAPSE;case"visible":default:return Lr.VISIBLE}}};(Pr=_r||(_r={})).NORMAL="normal",Pr.BREAK_ALL="break-all";var Vr,zr,Xr={name:"word-break",initialValue:"normal",prefix:!(Pr.KEEP_ALL="keep-all"),type:Ce.IDENT_VALUE,parse:function(A){switch(A){case"break-all":return _r.BREAK_ALL;case"keep-all":return _r.KEEP_ALL;case"normal":default:return _r.NORMAL}}},Jr={name:"z-index",initialValue:"auto",prefix:!1,type:Ce.VALUE,parse:function(A){if(A.type===sA.IDENT_TOKEN)return{auto:!0,order:0};if(VA(A))return{auto:!1,order:A.number};throw new Error("Invalid z-index number parsed")}},Gr={name:"opacity",initialValue:"1",type:Ce.VALUE,prefix:!1,parse:function(A){return VA(A)?A.number:1}},kr={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:Ce.TYPE_VALUE,format:"color"},Wr={name:"text-decoration-line",initialValue:"none",prefix:!1,type:Ce.LIST,parse:function(A){return A.filter(zA).map(function(A){switch(A.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(A){return 0!==A})}},Yr={name:"font-family",initialValue:"",prefix:!1,type:Ce.LIST,parse:function(A){return A.filter(qr).map(function(A){return A.value})}},qr=function(A){return A.type===sA.STRING_TOKEN||A.type===sA.IDENT_TOKEN},Zr={name:"font-size",initialValue:"0",prefix:!1,type:Ce.TYPE_VALUE,format:"length"},jr={name:"font-weight",initialValue:"normal",type:Ce.VALUE,prefix:!1,parse:function(A){if(VA(A))return A.number;if(zA(A))switch(A.value){case"bold":return 700;case"normal":default:return 400}return 400}},$r={name:"font-variant",initialValue:"none",type:Ce.LIST,prefix:!1,parse:function(A){return A.filter(zA).map(function(A){return A.value})}};(zr=Vr||(Vr={})).NORMAL="normal",zr.ITALIC="italic";function An(A,e){return 0!=(A&e)}function en(A,e,t){if(!A)return"";var r=A[Math.min(e,A.length-1)];return r?t?r.open:r.close:""}var tn={name:"font-style",initialValue:"normal",prefix:!(zr.OBLIQUE="oblique"),type:Ce.IDENT_VALUE,parse:function(A){switch(A){case"oblique":return Vr.OBLIQUE;case"italic":return Vr.ITALIC;case"normal":default:return Vr.NORMAL}}},rn={name:"content",initialValue:"none",type:Ce.LIST,prefix:!1,parse:function(A){if(0===A.length)return[];var e=A[0];return e.type===sA.IDENT_TOKEN&&"none"===e.value?[]:A}},nn={name:"counter-increment",initialValue:"none",prefix:!0,type:Ce.LIST,parse:function(A){if(0===A.length)return null;var e=A[0];if(e.type===sA.IDENT_TOKEN&&"none"===e.value)return null;for(var t=[],r=A.filter(GA),n=0;n<r.length;n++){var B=r[n],s=r[n+1];if(B.type===sA.IDENT_TOKEN){var o=s&&VA(s)?s.number:1;t.push({counter:B.value,increment:o})}}return t}},Bn={name:"counter-reset",initialValue:"none",prefix:!0,type:Ce.LIST,parse:function(A){if(0===A.length)return[];for(var e=[],t=A.filter(GA),r=0;r<t.length;r++){var n=t[r],B=t[r+1];if(zA(n)&&"none"!==n.value){var s=B&&VA(B)?B.number:0;e.push({counter:n.value,reset:s})}}return e}},sn={name:"quotes",initialValue:"none",prefix:!0,type:Ce.LIST,parse:function(A){if(0===A.length)return null;var e=A[0];if(e.type===sA.IDENT_TOKEN&&"none"===e.value)return null;var t=[],r=A.filter(XA);if(r.length%2!=0)return null;for(var n=0;n<r.length;n+=2){var B=r[n].value,s=r[n+1].value;t.push({open:B,close:s})}return t}},on={name:"box-shadow",initialValue:"none",type:Ce.LIST,prefix:!1,parse:function(A){return 1===A.length&&JA(A[0],"none")?[]:WA(A).map(function(A){for(var e={color:255,offsetX:se,offsetY:se,blur:se,spread:se,inset:!1},t=0,r=0;r<A.length;r++){var n=A[r];JA(n,"inset")?e.inset=!0:YA(n)?(0===t?e.offsetX=n:1===t?e.offsetY=n:2===t?e.blur=n:e.spread=n,t++):e.color=we(n)}return e})}},an=(cn.prototype.isVisible=function(){return 0<this.display&&0<this.opacity&&this.visibility===Lr.VISIBLE},cn.prototype.isTransparent=function(){return ee(this.backgroundColor)},cn.prototype.isTransformed=function(){return null!==this.transform},cn.prototype.isPositioned=function(){return this.position!==pr.STATIC},cn.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},cn.prototype.isFloating=function(){return this.float!==Dt.NONE},cn.prototype.isInlineLevel=function(){return An(this.display,4)||An(this.display,33554432)||An(this.display,268435456)||An(this.display,536870912)||An(this.display,67108864)||An(this.display,134217728)},cn);function cn(A){this.backgroundClip=Un(me,A.backgroundClip),this.backgroundColor=Un(Re,A.backgroundColor),this.backgroundImage=Un(Qt,A.backgroundImage),this.backgroundOrigin=Un(wt,A.backgroundOrigin),this.backgroundPosition=Un(ut,A.backgroundPosition),this.backgroundRepeat=Un(Ct,A.backgroundRepeat),this.backgroundSize=Un(dt,A.backgroundSize),this.borderTopColor=Un(pt,A.borderTopColor),this.borderRightColor=Un(Nt,A.borderRightColor),this.borderBottomColor=Un(Kt,A.borderBottomColor),this.borderLeftColor=Un(It,A.borderLeftColor),this.borderTopLeftRadius=Un(Tt,A.borderTopLeftRadius),this.borderTopRightRadius=Un(mt,A.borderTopRightRadius),this.borderBottomRightRadius=Un(Rt,A.borderBottomRightRadius),this.borderBottomLeftRadius=Un(Lt,A.borderBottomLeftRadius),this.borderTopStyle=Un(St,A.borderTopStyle),this.borderRightStyle=Un(Mt,A.borderRightStyle),this.borderBottomStyle=Un(yt,A.borderBottomStyle),this.borderLeftStyle=Un(_t,A.borderLeftStyle),this.borderTopWidth=Un(Pt,A.borderTopWidth),this.borderRightWidth=Un(xt,A.borderRightWidth),this.borderBottomWidth=Un(Vt,A.borderBottomWidth),this.borderLeftWidth=Un(zt,A.borderLeftWidth),this.boxShadow=Un(on,A.boxShadow),this.color=Un(Xt,A.color),this.display=Un(Jt,A.display),this.float=Un(Zt,A.cssFloat),this.fontFamily=Un(Yr,A.fontFamily),this.fontSize=Un(Zr,A.fontSize),this.fontStyle=Un(tn,A.fontStyle),this.fontVariant=Un($r,A.fontVariant),this.fontWeight=Un(jr,A.fontWeight),this.letterSpacing=Un(jt,A.letterSpacing),this.lineBreak=Un($t,A.lineBreak),this.lineHeight=Un(Ar,A.lineHeight),this.listStyleImage=Un(er,A.listStyleImage),this.listStylePosition=Un(nr,A.listStylePosition),this.listStyleType=Un(ir,A.listStyleType),this.marginTop=Un(ar,A.marginTop),this.marginRight=Un(cr,A.marginRight),this.marginBottom=Un(Qr,A.marginBottom),this.marginLeft=Un(wr,A.marginLeft),this.opacity=Un(Gr,A.opacity);var e=Un(Er,A.overflow);this.overflowX=e[0],this.overflowY=e[1<e.length?1:0],this.overflowWrap=Un(Fr,A.overflowWrap),this.paddingTop=Un(hr,A.paddingTop),this.paddingRight=Un(Hr,A.paddingRight),this.paddingBottom=Un(dr,A.paddingBottom),this.paddingLeft=Un(fr,A.paddingLeft),this.position=Un(mr,A.position),this.textAlign=Un(Kr,A.textAlign),this.textDecorationColor=Un(kr,A.textDecorationColor||A.color),this.textDecorationLine=Un(Wr,A.textDecorationLine),this.textShadow=Un(Rr,A.textShadow),this.textTransform=Un(Or,A.textTransform),this.transform=Un(Dr,A.transform),this.transformOrigin=Un(yr,A.transformOrigin),this.visibility=Un(xr,A.visibility),this.wordBreak=Un(Xr,A.wordBreak),this.zIndex=Un(Jr,A.zIndex)}var Qn,wn=function(A){this.content=Un(rn,A.content),this.quotes=Un(sn,A.quotes)},un=function(A){this.counterIncrement=Un(nn,A.counterIncrement),this.counterReset=Un(Bn,A.counterReset)},Un=function(A,e){var t=new MA,r=null!=e?e.toString():A.initialValue;t.write(r);var n=new _A(t.read());switch(A.type){case Ce.IDENT_VALUE:var B=n.parseComponentValue();return A.parse(zA(B)?B.value:A.initialValue);case Ce.VALUE:return A.parse(n.parseComponentValue());case Ce.LIST:return A.parse(n.parseComponentValues());case Ce.TOKEN_VALUE:return n.parseComponentValue();case Ce.TYPE_VALUE:switch(A.format){case"angle":return ce(n.parseComponentValue());case"color":return we(n.parseComponentValue());case"image":return ot(n.parseComponentValue());case"length":var s=n.parseComponentValue();return YA(s)?s:se;case"length-percentage":var o=n.parseComponentValue();return qA(o)?o:se}}throw new Error("Attempting to parse unsupported css format type "+A.format)},ln=function(A){this.styles=new an(window.getComputedStyle(A,null)),this.textNodes=[],this.elements=[],null!==this.styles.transform&&uB(A)&&(A.style.transform="none"),this.bounds=T(A),this.flags=0},Cn=function(A,e){this.text=A,this.bounds=e},gn=function(A){var e=A.ownerDocument;if(e){var t=e.createElement("html2canvaswrapper");t.appendChild(A.cloneNode(!0));var r=A.parentNode;if(r){r.replaceChild(t,A);var n=T(t);return t.firstChild&&r.replaceChild(t.firstChild,t),n}}return new I(0,0,0,0)},En=function(A,e,t){var r=A.ownerDocument;if(!r)throw new Error("Node has no owner document");var n=r.createRange();return n.setStart(A,e),n.setEnd(A,e+t),I.fromClientRect(n.getBoundingClientRect())},Fn=function(A,e){return 0!==e.letterSpacing?c(A).map(function(A){return l(A)}):hn(A,e)},hn=function(A,e){for(var t,r=function(A,e){var t=c(A),r=u(t,e),n=r[0],B=r[1],s=r[2],o=t.length,i=0,a=0;return{next:function(){if(o<=a)return{done:!0,value:null};for(var A=Y;a<o&&(A=w(t,B,n,++a,s))===Y;);if(A===Y&&a!==o)return{done:!0,value:null};var e=new nA(t,A,i,a);return i=a,{value:e,done:!1}}}}(A,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap===Ur.BREAK_WORD?"break-word":e.wordBreak}),n=[];!(t=r.next()).done;)t.value&&n.push(t.value.slice());return n},Hn=function(A,e){this.text=dn(A.data,e.textTransform),this.textBounds=function(A,t,r){var e=Fn(A,t),n=[],B=0;return e.forEach(function(A){if(t.textDecorationLine.length||0<A.trim().length)if(Oe.SUPPORT_RANGE_BOUNDS)n.push(new Cn(A,En(r,B,A.length)));else{var e=r.splitText(A.length);n.push(new Cn(A,gn(r))),r=e}else Oe.SUPPORT_RANGE_BOUNDS||(r=r.splitText(A.length));B+=A.length}),n}(this.text,e,A)},dn=function(A,e){switch(e){case Ir.LOWERCASE:return A.toLowerCase();case Ir.CAPITALIZE:return A.replace(fn,pn);case Ir.UPPERCASE:return A.toUpperCase();default:return A}},fn=/(^|\s|:|-|\(|\))([a-z])/g,pn=function(A,e,t){return 0<A.length?e+t.toUpperCase():A},Nn=(A(Kn,Qn=ln),Kn);function Kn(A){var e=Qn.call(this,A)||this;return e.src=A.currentSrc||A.src,e.intrinsicWidth=A.naturalWidth,e.intrinsicHeight=A.naturalHeight,Se.getInstance().addImage(e.src),e}var In,Tn=(A(mn,In=ln),mn);function mn(A){var e=In.call(this,A)||this;return e.canvas=A,e.intrinsicWidth=A.width,e.intrinsicHeight=A.height,e}var Rn,Ln=(A(vn,Rn=ln),vn);function vn(A){var e=Rn.call(this,A)||this,t=new XMLSerializer;return e.svg="data:image/svg+xml,"+encodeURIComponent(t.serializeToString(A)),e.intrinsicWidth=A.width.baseVal.value,e.intrinsicHeight=A.height.baseVal.value,Se.getInstance().addImage(e.svg),e}var On,Dn=(A(bn,On=ln),bn);function bn(A){var e=On.call(this,A)||this;return e.value=A.value,e}var Sn,Mn=(A(yn,Sn=ln),yn);function yn(A){var e=Sn.call(this,A)||this;return e.start=A.start,e.reversed="boolean"==typeof A.reversed&&!0===A.reversed,e}var _n,Pn=[{type:sA.DIMENSION_TOKEN,flags:0,unit:"px",number:3}],xn=[{type:sA.PERCENTAGE_TOKEN,flags:0,number:50}],Vn="checkbox",zn="radio",Xn="password",Jn=707406591,Gn=(A(kn,_n=ln),kn);function kn(A){var e=_n.call(this,A)||this;switch(e.type=A.type.toLowerCase(),e.checked=A.checked,e.value=function(A){var e=A.type===Xn?new Array(A.value.length+1).join("•"):A.value;return 0===e.length?A.placeholder||"":e}(A),e.type!==Vn&&e.type!==zn||(e.styles.backgroundColor=3739148031,e.styles.borderTopColor=e.styles.borderRightColor=e.styles.borderBottomColor=e.styles.borderLeftColor=2779096575,e.styles.borderTopWidth=e.styles.borderRightWidth=e.styles.borderBottomWidth=e.styles.borderLeftWidth=1,e.styles.borderTopStyle=e.styles.borderRightStyle=e.styles.borderBottomStyle=e.styles.borderLeftStyle=ht.SOLID,e.styles.backgroundClip=[Ee.BORDER_BOX],e.styles.backgroundOrigin=[0],e.bounds=function(A){return A.width>A.height?new I(A.left+(A.width-A.height)/2,A.top,A.height,A.height):A.width<A.height?new I(A.left,A.top+(A.height-A.width)/2,A.width,A.width):A}(e.bounds)),e.type){case Vn:e.styles.borderTopRightRadius=e.styles.borderTopLeftRadius=e.styles.borderBottomRightRadius=e.styles.borderBottomLeftRadius=Pn;break;case zn:e.styles.borderTopRightRadius=e.styles.borderTopLeftRadius=e.styles.borderBottomRightRadius=e.styles.borderBottomLeftRadius=xn}return e}var Wn,Yn=(A(qn,Wn=ln),qn);function qn(A){var e=Wn.call(this,A)||this,t=A.options[A.selectedIndex||0];return e.value=t&&t.text||"",e}var Zn,jn=(A($n,Zn=ln),$n);function $n(A){var e=Zn.call(this,A)||this;return e.value=A.value,e}function AB(A){return we(_A.create(A).parseComponentValue())}var eB,tB=(A(rB,eB=ln),rB);function rB(A){var e=eB.call(this,A)||this;e.src=A.src,e.width=parseInt(A.width,10)||0,e.height=parseInt(A.height,10)||0,e.backgroundColor=e.styles.backgroundColor;try{if(A.contentWindow&&A.contentWindow.document&&A.contentWindow.document.documentElement){e.tree=iB(A.contentWindow.document.documentElement);var t=A.contentWindow.document.documentElement?AB(getComputedStyle(A.contentWindow.document.documentElement).backgroundColor):He.TRANSPARENT,r=A.contentWindow.document.body?AB(getComputedStyle(A.contentWindow.document.body).backgroundColor):He.TRANSPARENT;e.backgroundColor=ee(t)?ee(r)?e.styles.backgroundColor:r:t}}catch(A){}return e}function nB(A){return"STYLE"===A.tagName}var BB=["OL","UL","MENU"],sB=function(A,e,t){for(var r=A.firstChild,n=void 0;r;r=n)if(n=r.nextSibling,QB(r)&&0<r.data.trim().length)e.textNodes.push(new Hn(r,e.styles));else if(wB(r)){var B=oB(r);B.styles.isVisible()&&(aB(r,B,t)?B.flags|=4:cB(B.styles)&&(B.flags|=2),-1!==BB.indexOf(r.tagName)&&(B.flags|=8),e.elements.push(B),dB(r)||gB(r)||fB(r)||sB(r,B,t))}},oB=function(A){return hB(A)?new Nn(A):FB(A)?new Tn(A):gB(A)?new Ln(A):UB(A)?new Dn(A):lB(A)?new Mn(A):CB(A)?new Gn(A):fB(A)?new Yn(A):dB(A)?new jn(A):HB(A)?new tB(A):new ln(A)},iB=function(A){var e=oB(A);return e.flags|=4,sB(A,e,e),e},aB=function(A,e,t){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||EB(A)&&t.styles.isTransparent()},cB=function(A){return A.isPositioned()||A.isFloating()},QB=function(A){return A.nodeType===Node.TEXT_NODE},wB=function(A){return A.nodeType===Node.ELEMENT_NODE},uB=function(A){return void 0!==A.style},UB=function(A){return"LI"===A.tagName},lB=function(A){return"OL"===A.tagName},CB=function(A){return"INPUT"===A.tagName},gB=function(A){return"svg"===A.tagName},EB=function(A){return"BODY"===A.tagName},FB=function(A){return"CANVAS"===A.tagName},hB=function(A){return"IMG"===A.tagName},HB=function(A){return"IFRAME"===A.tagName},dB=function(A){return"TEXTAREA"===A.tagName},fB=function(A){return"SELECT"===A.tagName},pB=(NB.prototype.getCounterValue=function(A){var e=this.counters[A];return e&&e.length?e[e.length-1]:1},NB.prototype.getCounterValues=function(A){var e=this.counters[A];return e||[]},NB.prototype.pop=function(A){var e=this;A.forEach(function(A){return e.counters[A].pop()})},NB.prototype.parse=function(A){var t=this,e=A.counterIncrement,r=A.counterReset,n=!0;null!==e&&e.forEach(function(A){var e=t.counters[A.counter];e&&0!==A.increment&&(n=!1,e[Math.max(0,e.length-1)]+=A.increment)});var B=[];return n&&r.forEach(function(A){var e=t.counters[A.counter];B.push(A.counter),e||(e=t.counters[A.counter]=[]),e.push(A.reset)}),B},NB);function NB(){this.counters={}}function KB(r,A,e,n,t,B){return r<A||e<r?yB(r,t,0<B.length):n.integers.reduce(function(A,e,t){for(;e<=r;)r-=e,A+=n.values[t];return A},"")+B}function IB(A,e,t,r){for(var n="";t||A--,n=r(A)+n,e<=(A/=e)*e;);return n}function TB(A,e,t,r,n){var B=t-e+1;return(A<0?"-":"")+(IB(Math.abs(A),B,r,function(A){return l(Math.floor(A%B)+e)})+n)}function mB(A,e,t){void 0===t&&(t=". ");var r=e.length;return IB(Math.abs(A),r,!1,function(A){return e[Math.floor(A%r)]})+t}function RB(A,e,t,r,n,B){if(A<-9999||9999<A)return yB(A,tr.CJK_DECIMAL,0<n.length);var s=Math.abs(A),o=n;if(0===s)return e[0]+o;for(var i=0;0<s&&i<=4;i++){var a=s%10;0==a&&An(B,1)&&""!==o?o=e[a]+o:1<a||1==a&&0===i||1==a&&1===i&&An(B,2)||1==a&&1===i&&An(B,4)&&100<A||1==a&&1<i&&An(B,8)?o=e[a]+(0<i?t[i-1]:"")+o:1==a&&0<i&&(o=t[i-1]+o),s=Math.floor(s/10)}return(A<0?r:"")+o}var LB,vB,OB={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},DB={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},bB={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},SB={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},MB="마이너스",yB=function(A,e,t){var r=t?". ":"",n=t?"、":"",B=t?", ":"",s=t?" ":"";switch(e){case tr.DISC:return"•"+s;case tr.CIRCLE:return"◦"+s;case tr.SQUARE:return"◾"+s;case tr.DECIMAL_LEADING_ZERO:var o=TB(A,48,57,!0,r);return o.length<4?"0"+o:o;case tr.CJK_DECIMAL:return mB(A,"〇一二三四五六七八九",n);case tr.LOWER_ROMAN:return KB(A,1,3999,OB,tr.DECIMAL,r).toLowerCase();case tr.UPPER_ROMAN:return KB(A,1,3999,OB,tr.DECIMAL,r);case tr.LOWER_GREEK:return TB(A,945,969,!1,r);case tr.LOWER_ALPHA:return TB(A,97,122,!1,r);case tr.UPPER_ALPHA:return TB(A,65,90,!1,r);case tr.ARABIC_INDIC:return TB(A,1632,1641,!0,r);case tr.ARMENIAN:case tr.UPPER_ARMENIAN:return KB(A,1,9999,DB,tr.DECIMAL,r);case tr.LOWER_ARMENIAN:return KB(A,1,9999,DB,tr.DECIMAL,r).toLowerCase();case tr.BENGALI:return TB(A,2534,2543,!0,r);case tr.CAMBODIAN:case tr.KHMER:return TB(A,6112,6121,!0,r);case tr.CJK_EARTHLY_BRANCH:return mB(A,"子丑寅卯辰巳午未申酉戌亥",n);case tr.CJK_HEAVENLY_STEM:return mB(A,"甲乙丙丁戊己庚辛壬癸",n);case tr.CJK_IDEOGRAPHIC:case tr.TRAD_CHINESE_INFORMAL:return RB(A,"零一二三四五六七八九","十百千萬","負",n,14);case tr.TRAD_CHINESE_FORMAL:return RB(A,"零壹貳參肆伍陸柒捌玖","拾佰仟萬","負",n,15);case tr.SIMP_CHINESE_INFORMAL:return RB(A,"零一二三四五六七八九","十百千萬","负",n,14);case tr.SIMP_CHINESE_FORMAL:return RB(A,"零壹贰叁肆伍陆柒捌玖","拾佰仟萬","负",n,15);case tr.JAPANESE_INFORMAL:return RB(A,"〇一二三四五六七八九","十百千万","マイナス",n,0);case tr.JAPANESE_FORMAL:return RB(A,"零壱弐参四伍六七八九","拾百千万","マイナス",n,7);case tr.KOREAN_HANGUL_FORMAL:return RB(A,"영일이삼사오육칠팔구","십백천만",MB,B,7);case tr.KOREAN_HANJA_INFORMAL:return RB(A,"零一二三四五六七八九","十百千萬",MB,B,0);case tr.KOREAN_HANJA_FORMAL:return RB(A,"零壹貳參四五六七八九","拾百千",MB,B,7);case tr.DEVANAGARI:return TB(A,2406,2415,!0,r);case tr.GEORGIAN:return KB(A,1,19999,SB,tr.DECIMAL,r);case tr.GUJARATI:return TB(A,2790,2799,!0,r);case tr.GURMUKHI:return TB(A,2662,2671,!0,r);case tr.HEBREW:return KB(A,1,10999,bB,tr.DECIMAL,r);case tr.HIRAGANA:return mB(A,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case tr.HIRAGANA_IROHA:return mB(A,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case tr.KANNADA:return TB(A,3302,3311,!0,r);case tr.KATAKANA:return mB(A,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",n);case tr.KATAKANA_IROHA:return mB(A,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",n);case tr.LAO:return TB(A,3792,3801,!0,r);case tr.MONGOLIAN:return TB(A,6160,6169,!0,r);case tr.MYANMAR:return TB(A,4160,4169,!0,r);case tr.ORIYA:return TB(A,2918,2927,!0,r);case tr.PERSIAN:return TB(A,1776,1785,!0,r);case tr.TAMIL:return TB(A,3046,3055,!0,r);case tr.TELUGU:return TB(A,3174,3183,!0,r);case tr.THAI:return TB(A,3664,3673,!0,r);case tr.TIBETAN:return TB(A,3872,3881,!0,r);case tr.DECIMAL:default:return TB(A,48,57,!0,r)}},_B="data-html2canvas-ignore",PB=(xB.prototype.toIFrame=function(A,t){var e=this,r=XB(A,t);if(!r.contentWindow)return Promise.reject("Unable to find iframe window");var n=A.defaultView.pageXOffset,B=A.defaultView.pageYOffset,s=r.contentWindow,o=s.document,i=JB(r).then(function(){return a(e,void 0,void 0,function(){var e;return S(this,function(A){switch(A.label){case 0:return this.scrolledElements.forEach(YB),s&&(s.scrollTo(t.left,t.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||s.scrollY===t.top&&s.scrollX===t.left||(o.documentElement.style.top=-t.top+"px",o.documentElement.style.left=-t.left+"px",o.documentElement.style.position="absolute")),e=this.options.onclone,void 0===this.clonedReferenceElement?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:o.fonts&&o.fonts.ready?[4,o.fonts.ready]:[3,2];case 1:A.sent(),A.label=2;case 2:return"function"==typeof e?[2,Promise.resolve().then(function(){return e(o)}).then(function(){return r})]:[2,r]}})})});return o.open(),o.write(kB(document.doctype)+"<html></html>"),WB(this.referenceElement.ownerDocument,n,B),o.replaceChild(o.adoptNode(this.documentElement),o.documentElement),o.close(),i},xB.prototype.createElementClone=function(A){return FB(A)?this.createCanvasClone(A):nB(A)?this.createStyleClone(A):A.cloneNode(!1)},xB.prototype.createStyleClone=function(A){try{var e=A.sheet;if(e&&e.cssRules){var t=[].slice.call(e.cssRules,0).reduce(function(A,e){return e&&"string"==typeof e.cssText?A+e.cssText:A},""),r=A.cloneNode(!1);return r.textContent=t,r}}catch(A){if(De.getInstance(this.options.id).error("Unable to access cssRules property",A),"SecurityError"!==A.name)throw A}return A.cloneNode(!1)},xB.prototype.createCanvasClone=function(A){if(this.options.inlineImages&&A.ownerDocument){var e=A.ownerDocument.createElement("img");try{return e.src=A.toDataURL(),e}catch(A){De.getInstance(this.options.id).info("Unable to clone canvas contents, canvas is tainted")}}var t=A.cloneNode(!1);try{t.width=A.width,t.height=A.height;var r=A.getContext("2d"),n=t.getContext("2d");return n&&(r?n.putImageData(r.getImageData(0,0,A.width,A.height),0,0):n.drawImage(A,0,0)),t}catch(A){}return t},xB.prototype.cloneNode=function(A){if(QB(A))return document.createTextNode(A.data);if(!A.ownerDocument)return A.cloneNode(!1);var e=A.ownerDocument.defaultView;if(uB(A)&&e){var t=this.createElementClone(A),r=e.getComputedStyle(A),n=e.getComputedStyle(A,":before"),B=e.getComputedStyle(A,":after");this.referenceElement===A&&(this.clonedReferenceElement=t),EB(t)&&$B(t);for(var s=this.counters.parse(new un(r)),o=this.resolvePseudoContent(A,t,n,LB.BEFORE),i=A.firstChild;i;i=i.nextSibling)wB(i)&&("SCRIPT"===i.tagName||i.hasAttribute(_B)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(i))||this.options.copyStyles&&wB(i)&&nB(i)||t.appendChild(this.cloneNode(i));o&&t.insertBefore(o,t.firstChild);var a=this.resolvePseudoContent(A,t,B,LB.AFTER);return a&&t.appendChild(a),this.counters.pop(s),r&&this.options.copyStyles&&!HB(A)&&GB(r,t),0===A.scrollTop&&0===A.scrollLeft||this.scrolledElements.push([t,A.scrollLeft,A.scrollTop]),(dB(A)||fB(A))&&(dB(t)||fB(t))&&(t.value=A.value),t}return A.cloneNode(!1)},xB.prototype.resolvePseudoContent=function(U,A,e,t){var l=this;if(e){var r=e.content,C=A.ownerDocument;if(C&&r&&"none"!==r&&"-moz-alt-content"!==r&&"none"!==e.display){this.counters.parse(new un(e));var g=new wn(e),E=C.createElement("html2canvaspseudoelement");GB(e,E),g.content.forEach(function(A){if(A.type===sA.STRING_TOKEN)E.appendChild(C.createTextNode(A.value));else if(A.type===sA.URL_TOKEN){var e=C.createElement("img");e.src=A.value,e.style.opacity="1",E.appendChild(e)}else if(A.type===sA.FUNCTION){if("attr"===A.name){var t=A.values.filter(zA);t.length&&E.appendChild(C.createTextNode(U.getAttribute(t[0].value)||""))}else if("counter"===A.name){var r=A.values.filter(kA),n=r[0],B=r[1];if(n&&zA(n)){var s=l.counters.getCounterValue(n.value),o=B&&zA(B)?ir.parse(B.value):tr.DECIMAL;E.appendChild(C.createTextNode(yB(s,o,!1)))}}else if("counters"===A.name){var i=A.values.filter(kA),a=(n=i[0],i[1]);if(B=i[2],n&&zA(n)){var c=l.counters.getCounterValues(n.value),Q=B&&zA(B)?ir.parse(B.value):tr.DECIMAL,w=a&&a.type===sA.STRING_TOKEN?a.value:"",u=c.map(function(A){return yB(A,Q,!1)}).join(w);E.appendChild(C.createTextNode(u))}}}else if(A.type===sA.IDENT_TOKEN)switch(A.value){case"open-quote":E.appendChild(C.createTextNode(en(g.quotes,l.quoteDepth++,!0)));break;case"close-quote":E.appendChild(C.createTextNode(en(g.quotes,--l.quoteDepth,!1)));break;default:E.appendChild(C.createTextNode(A.value))}}),E.className=qB+" "+ZB;var n=t===LB.BEFORE?" "+qB:" "+ZB;return function(A){return"object"==typeof A.className}(A)?A.className.baseValue+=n:A.className+=n,E}}},xB.destroy=function(A){return!!A.parentNode&&(A.parentNode.removeChild(A),!0)},xB);function xB(A,e){if(this.options=e,this.scrolledElements=[],this.referenceElement=A,this.counters=new pB,this.quoteDepth=0,!A.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(A.ownerDocument.documentElement)}(vB=LB||(LB={}))[vB.BEFORE=0]="BEFORE",vB[vB.AFTER=1]="AFTER";var VB,zB,XB=function(A,e){var t=A.createElement("iframe");return t.className="html2canvas-container",t.style.visibility="hidden",t.style.position="fixed",t.style.left="-10000px",t.style.top="0px",t.style.border="0",t.width=e.width.toString(),t.height=e.height.toString(),t.scrolling="no",t.setAttribute(_B,"true"),A.body.appendChild(t),t},JB=function(n){return new Promise(function(e,A){var t=n.contentWindow;if(!t)return A("No window assigned for iframe");var r=t.document;t.onload=n.onload=r.onreadystatechange=function(){t.onload=n.onload=r.onreadystatechange=null;var A=setInterval(function(){0<r.body.childNodes.length&&"complete"===r.readyState&&(clearInterval(A),e(n))},50)}})},GB=function(A,e){for(var t=A.length-1;0<=t;t--){var r=A.item(t);"content"!==r&&e.style.setProperty(r,A.getPropertyValue(r))}return e},kB=function(A){var e="";return A&&(e+="<!DOCTYPE ",A.name&&(e+=A.name),A.internalSubset&&(e+=A.internalSubset),A.publicId&&(e+='"'+A.publicId+'"'),A.systemId&&(e+='"'+A.systemId+'"'),e+=">"),e},WB=function(A,e,t){A&&A.defaultView&&(e!==A.defaultView.pageXOffset||t!==A.defaultView.pageYOffset)&&A.defaultView.scrollTo(e,t)},YB=function(A){var e=A[0],t=A[1],r=A[2];e.scrollLeft=t,e.scrollTop=r},qB="___html2canvas___pseudoelement_before",ZB="___html2canvas___pseudoelement_after",jB='{\n    content: "" !important;\n    display: none !important;\n}',$B=function(A){As(A,"."+qB+":before"+jB+"\n         ."+ZB+":after"+jB)},As=function(A,e){var t=A.ownerDocument;if(t){var r=t.createElement("style");r.textContent=e,A.appendChild(r)}};(zB=VB||(VB={}))[zB.VECTOR=0]="VECTOR",zB[zB.BEZIER_CURVE=1]="BEZIER_CURVE";function es(A,t){return A.length===t.length&&A.some(function(A,e){return A===t[e]})}var ts=(rs.prototype.add=function(A,e){return new rs(this.x+A,this.y+e)},rs);function rs(A,e){this.type=VB.VECTOR,this.x=A,this.y=e}function ns(A,e,t){return new ts(A.x+(e.x-A.x)*t,A.y+(e.y-A.y)*t)}var Bs=(ss.prototype.subdivide=function(A,e){var t=ns(this.start,this.startControl,A),r=ns(this.startControl,this.endControl,A),n=ns(this.endControl,this.end,A),B=ns(t,r,A),s=ns(r,n,A),o=ns(B,s,A);return e?new ss(this.start,t,B,o):new ss(o,s,n,this.end)},ss.prototype.add=function(A,e){return new ss(this.start.add(A,e),this.startControl.add(A,e),this.endControl.add(A,e),this.end.add(A,e))},ss.prototype.reverse=function(){return new ss(this.end,this.endControl,this.startControl,this.start)},ss);function ss(A,e,t,r){this.type=VB.BEZIER_CURVE,this.start=A,this.startControl=e,this.endControl=t,this.end=r}function os(A){return A.type===VB.BEZIER_CURVE}var is,as,cs=function(A){var e=A.styles,t=A.bounds,r=jA(e.borderTopLeftRadius,t.width,t.height),n=r[0],B=r[1],s=jA(e.borderTopRightRadius,t.width,t.height),o=s[0],i=s[1],a=jA(e.borderBottomRightRadius,t.width,t.height),c=a[0],Q=a[1],w=jA(e.borderBottomLeftRadius,t.width,t.height),u=w[0],U=w[1],l=[];l.push((n+o)/t.width),l.push((u+c)/t.width),l.push((B+U)/t.height),l.push((i+Q)/t.height);var C=Math.max.apply(Math,l);1<C&&(n/=C,B/=C,o/=C,i/=C,c/=C,Q/=C,u/=C,U/=C);var g=t.width-o,E=t.height-Q,F=t.width-c,h=t.height-U,H=e.borderTopWidth,d=e.borderRightWidth,f=e.borderBottomWidth,p=e.borderLeftWidth,N=ae(e.paddingTop,A.bounds.width),K=ae(e.paddingRight,A.bounds.width),I=ae(e.paddingBottom,A.bounds.width),T=ae(e.paddingLeft,A.bounds.width);this.topLeftBorderBox=0<n||0<B?us(t.left,t.top,n,B,is.TOP_LEFT):new ts(t.left,t.top),this.topRightBorderBox=0<o||0<i?us(t.left+g,t.top,o,i,is.TOP_RIGHT):new ts(t.left+t.width,t.top),this.bottomRightBorderBox=0<c||0<Q?us(t.left+F,t.top+E,c,Q,is.BOTTOM_RIGHT):new ts(t.left+t.width,t.top+t.height),this.bottomLeftBorderBox=0<u||0<U?us(t.left,t.top+h,u,U,is.BOTTOM_LEFT):new ts(t.left,t.top+t.height),this.topLeftPaddingBox=0<n||0<B?us(t.left+p,t.top+H,Math.max(0,n-p),Math.max(0,B-H),is.TOP_LEFT):new ts(t.left+p,t.top+H),this.topRightPaddingBox=0<o||0<i?us(t.left+Math.min(g,t.width+p),t.top+H,g>t.width+p?0:o-p,i-H,is.TOP_RIGHT):new ts(t.left+t.width-d,t.top+H),this.bottomRightPaddingBox=0<c||0<Q?us(t.left+Math.min(F,t.width-p),t.top+Math.min(E,t.height+H),Math.max(0,c-d),Q-f,is.BOTTOM_RIGHT):new ts(t.left+t.width-d,t.top+t.height-f),this.bottomLeftPaddingBox=0<u||0<U?us(t.left+p,t.top+h,Math.max(0,u-p),U-f,is.BOTTOM_LEFT):new ts(t.left+p,t.top+t.height-f),this.topLeftContentBox=0<n||0<B?us(t.left+p+T,t.top+H+N,Math.max(0,n-(p+T)),Math.max(0,B-(H+N)),is.TOP_LEFT):new ts(t.left+p+T,t.top+H+N),this.topRightContentBox=0<o||0<i?us(t.left+Math.min(g,t.width+p+T),t.top+H+N,g>t.width+p+T?0:o-p+T,i-(H+N),is.TOP_RIGHT):new ts(t.left+t.width-(d+K),t.top+H+N),this.bottomRightContentBox=0<c||0<Q?us(t.left+Math.min(F,t.width-(p+T)),t.top+Math.min(E,t.height+H+N),Math.max(0,c-(d+K)),Q-(f+I),is.BOTTOM_RIGHT):new ts(t.left+t.width-(d+K),t.top+t.height-(f+I)),this.bottomLeftContentBox=0<u||0<U?us(t.left+p+T,t.top+h,Math.max(0,u-(p+T)),U-(f+I),is.BOTTOM_LEFT):new ts(t.left+p+T,t.top+t.height-(f+I))};(as=is||(is={}))[as.TOP_LEFT=0]="TOP_LEFT",as[as.TOP_RIGHT=1]="TOP_RIGHT",as[as.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",as[as.BOTTOM_LEFT=3]="BOTTOM_LEFT";function Qs(A){return[A.topLeftBorderBox,A.topRightBorderBox,A.bottomRightBorderBox,A.bottomLeftBorderBox]}function ws(A){return[A.topLeftPaddingBox,A.topRightPaddingBox,A.bottomRightPaddingBox,A.bottomLeftPaddingBox]}var us=function(A,e,t,r,n){var B=(Math.sqrt(2)-1)/3*4,s=t*B,o=r*B,i=A+t,a=e+r;switch(n){case is.TOP_LEFT:return new Bs(new ts(A,a),new ts(A,a-o),new ts(i-s,e),new ts(i,e));case is.TOP_RIGHT:return new Bs(new ts(A,e),new ts(A+s,e),new ts(i,a-o),new ts(i,a));case is.BOTTOM_RIGHT:return new Bs(new ts(i,e),new ts(i,e+o),new ts(A+s,a),new ts(A,a));case is.BOTTOM_LEFT:default:return new Bs(new ts(i,a),new ts(i-s,a),new ts(A,e+o),new ts(A,e))}},Us=function(A,e,t){this.type=0,this.offsetX=A,this.offsetY=e,this.matrix=t,this.target=6},ls=function(A,e){this.type=1,this.target=e,this.path=A},Cs=function(A){this.element=A,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},gs=(Es.prototype.getParentEffects=function(){var A=this.effects.slice(0);if(this.container.styles.overflowX!==sr.VISIBLE){var e=Qs(this.curves),t=ws(this.curves);es(e,t)||A.push(new ls(t,6))}return A},Es);function Es(A,e){if(this.container=A,this.effects=e.slice(0),this.curves=new cs(A),null!==A.styles.transform){var t=A.bounds.left+A.styles.transformOrigin[0].number,r=A.bounds.top+A.styles.transformOrigin[1].number,n=A.styles.transform;this.effects.push(new Us(t,r,n))}if(A.styles.overflowX!==sr.VISIBLE){var B=Qs(this.curves),s=ws(this.curves);es(B,s)?this.effects.push(new ls(B,6)):(this.effects.push(new ls(B,2)),this.effects.push(new ls(s,4)))}}function Fs(A){var e=A.bounds,t=A.styles;return e.add(t.borderLeftWidth,t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth),-(t.borderTopWidth+t.borderBottomWidth))}function hs(A){var e=A.styles,t=A.bounds,r=ae(e.paddingLeft,t.width),n=ae(e.paddingRight,t.width),B=ae(e.paddingTop,t.width),s=ae(e.paddingBottom,t.width);return t.add(r+e.borderLeftWidth,B+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+r+n),-(e.borderTopWidth+e.borderBottomWidth+B+s))}function Hs(A,e,t){var r=function(A,e){return 0===A?e.bounds:2===A?hs(e):Fs(e)}(Ts(A.styles.backgroundOrigin,e),A),n=function(A,e){return A===Ee.BORDER_BOX?e.bounds:A===Ee.CONTENT_BOX?hs(e):Fs(e)}(Ts(A.styles.backgroundClip,e),A),B=Is(Ts(A.styles.backgroundSize,e),t,r),s=B[0],o=B[1],i=jA(Ts(A.styles.backgroundPosition,e),r.width-s,r.height-o);return[ms(Ts(A.styles.backgroundRepeat,e),i,B,r,n),Math.round(r.left+i[0]),Math.round(r.top+i[1]),s,o]}function ds(A){return zA(A)&&A.value===Ut.AUTO}function fs(A){return"number"==typeof A}var ps=function(c,Q,w,u){c.container.elements.forEach(function(A){var e=An(A.flags,4),t=An(A.flags,2),r=new gs(A,c.getParentEffects());An(A.styles.display,2048)&&u.push(r);var n=An(A.flags,8)?[]:u;if(e||t){var B=e||A.styles.isPositioned()?w:Q,s=new Cs(r);if(A.styles.isPositioned()||A.styles.opacity<1||A.styles.isTransformed()){var o=A.styles.zIndex.order;if(o<0){var i=0;B.negativeZIndex.some(function(A,e){return o>A.element.container.styles.zIndex.order?(i=e,!1):0<i}),B.negativeZIndex.splice(i,0,s)}else if(0<o){var a=0;B.positiveZIndex.some(function(A,e){return o>A.element.container.styles.zIndex.order?(a=e+1,!1):0<a}),B.positiveZIndex.splice(a,0,s)}else B.zeroOrAutoZIndexOrTransformedOrOpacity.push(s)}else A.styles.isFloating()?B.nonPositionedFloats.push(s):B.nonPositionedInlineLevel.push(s);ps(r,s,e?s:w,n)}else A.styles.isInlineLevel()?Q.inlineLevel.push(r):Q.nonInlineLevel.push(r),ps(r,Q,w,n);An(A.flags,8)&&Ns(A,n)})},Ns=function(A,e){for(var t=A instanceof Mn?A.start:1,r=A instanceof Mn&&A.reversed,n=0;n<e.length;n++){var B=e[n];B.container instanceof Dn&&"number"==typeof B.container.value&&0!==B.container.value&&(t=B.container.value),B.listValue=yB(t,B.container.styles.listStyleType,!0),t+=r?-1:1}},Ks=function(A,e,t,r){var n=[];return os(A)?n.push(A.subdivide(.5,!1)):n.push(A),os(t)?n.push(t.subdivide(.5,!0)):n.push(t),os(r)?n.push(r.subdivide(.5,!0).reverse()):n.push(r),os(e)?n.push(e.subdivide(.5,!1).reverse()):n.push(e),n},Is=function(A,e,t){var r=e[0],n=e[1],B=e[2],s=A[0],o=A[1];if(qA(s)&&o&&qA(o))return[ae(s,t.width),ae(o,t.height)];var i=fs(B);if(zA(s)&&(s.value===Ut.CONTAIN||s.value===Ut.COVER))return fs(B)?t.width/t.height<B!=(s.value===Ut.COVER)?[t.width,t.width/B]:[t.height*B,t.height]:[t.width,t.height];var a=fs(r),c=fs(n),Q=a||c;if(ds(s)&&(!o||ds(o)))return a&&c?[r,n]:i||Q?Q&&i?[a?r:n*B,c?n:r/B]:[a?r:t.width,c?n:t.height]:[t.width,t.height];if(i){var w=0,u=0;return qA(s)?w=ae(s,t.width):qA(o)&&(u=ae(o,t.height)),ds(s)?w=u*B:o&&!ds(o)||(u=w/B),[w,u]}var U=null,l=null;if(qA(s)?U=ae(s,t.width):o&&qA(o)&&(l=ae(o,t.height)),null===U||o&&!ds(o)||(l=a&&c?U/r*n:t.height),null!==l&&ds(s)&&(U=a&&c?l/n*r:t.width),null!==U&&null!==l)return[U,l];throw new Error("Unable to calculate background-size for element")},Ts=function(A,e){var t=A[e];return void 0===t?A[0]:t},ms=function(A,e,t,r,n){var B=e[0],s=e[1],o=t[0],i=t[1];switch(A){case it.REPEAT_X:return[new ts(Math.round(r.left),Math.round(r.top+s)),new ts(Math.round(r.left+r.width),Math.round(r.top+s)),new ts(Math.round(r.left+r.width),Math.round(i+r.top+s)),new ts(Math.round(r.left),Math.round(i+r.top+s))];case it.REPEAT_Y:return[new ts(Math.round(r.left+B),Math.round(r.top)),new ts(Math.round(r.left+B+o),Math.round(r.top)),new ts(Math.round(r.left+B+o),Math.round(r.height+r.top)),new ts(Math.round(r.left+B),Math.round(r.height+r.top))];case it.NO_REPEAT:return[new ts(Math.round(r.left+B),Math.round(r.top+s)),new ts(Math.round(r.left+B+o),Math.round(r.top+s)),new ts(Math.round(r.left+B+o),Math.round(r.top+s+i)),new ts(Math.round(r.left+B),Math.round(r.top+s+i))];default:return[new ts(Math.round(n.left),Math.round(n.top)),new ts(Math.round(n.left+n.width),Math.round(n.top)),new ts(Math.round(n.left+n.width),Math.round(n.height+n.top)),new ts(Math.round(n.left),Math.round(n.height+n.top))]}},Rs="Hidden Text",Ls=(vs.prototype.parseMetrics=function(A,e){var t=this._document.createElement("div"),r=this._document.createElement("img"),n=this._document.createElement("span"),B=this._document.body;t.style.visibility="hidden",t.style.fontFamily=A,t.style.fontSize=e,t.style.margin="0",t.style.padding="0",B.appendChild(t),r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",n.style.fontFamily=A,n.style.fontSize=e,n.style.margin="0",n.style.padding="0",n.appendChild(this._document.createTextNode(Rs)),t.appendChild(n),t.appendChild(r);var s=r.offsetTop-n.offsetTop+2;t.removeChild(n),t.appendChild(this._document.createTextNode(Rs)),t.style.lineHeight="normal",r.style.verticalAlign="super";var o=r.offsetTop-t.offsetTop+2;return B.removeChild(t),{baseline:s,middle:o}},vs.prototype.getMetrics=function(A,e){var t=A+" "+e;return void 0===this._data[t]&&(this._data[t]=this.parseMetrics(A,e)),this._data[t]},vs);function vs(A){this._data={},this._document=A}var Os=(Ds.prototype.applyEffects=function(A,e){for(var t=this;this._activeEffects.length;)this.popEffect();A.filter(function(A){return An(A.target,e)}).forEach(function(A){return t.applyEffect(A)})},Ds.prototype.applyEffect=function(A){this.ctx.save(),function(A){return 0===A.type}(A)&&(this.ctx.translate(A.offsetX,A.offsetY),this.ctx.transform(A.matrix[0],A.matrix[1],A.matrix[2],A.matrix[3],A.matrix[4],A.matrix[5]),this.ctx.translate(-A.offsetX,-A.offsetY)),function(A){return 1===A.type}(A)&&(this.path(A.path),this.ctx.clip()),this._activeEffects.push(A)},Ds.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},Ds.prototype.renderStack=function(t){return a(this,void 0,void 0,function(){var e;return S(this,function(A){switch(A.label){case 0:return(e=t.element.container.styles).isVisible()?(this.ctx.globalAlpha=e.opacity,[4,this.renderStackContent(t)]):[3,2];case 1:A.sent(),A.label=2;case 2:return[2]}})})},Ds.prototype.renderNode=function(e){return a(this,void 0,void 0,function(){return S(this,function(A){switch(A.label){case 0:return e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return A.sent(),[4,this.renderNodeContent(e)];case 2:A.sent(),A.label=3;case 3:return[2]}})})},Ds.prototype.renderTextWithLetterSpacing=function(t,A){var r=this;0===A?this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+t.bounds.height):c(t.text).map(function(A){return l(A)}).reduce(function(A,e){return r.ctx.fillText(e,A,t.bounds.top+t.bounds.height),A+r.ctx.measureText(e).width},t.bounds.left)},Ds.prototype.createFontStyle=function(A){var e=A.fontVariant.filter(function(A){return"normal"===A||"small-caps"===A}).join(""),t=A.fontFamily.join(", "),r=xA(A.fontSize)?""+A.fontSize.number+A.fontSize.unit:A.fontSize.number+"px";return[[A.fontStyle,e,A.fontWeight,r,t].join(" "),t,r]},Ds.prototype.renderTextNode=function(r,o){return a(this,void 0,void 0,function(){var e,t,n,B,s=this;return S(this,function(A){return e=this.createFontStyle(o),t=e[0],n=e[1],B=e[2],this.ctx.font=t,r.textBounds.forEach(function(r){s.ctx.fillStyle=te(o.color),s.renderTextWithLetterSpacing(r,o.letterSpacing);var A=o.textShadow;A.length&&r.text.trim().length&&(A.slice(0).reverse().forEach(function(A){s.ctx.shadowColor=te(A.color),s.ctx.shadowOffsetX=A.offsetX.number*s.options.scale,s.ctx.shadowOffsetY=A.offsetY.number*s.options.scale,s.ctx.shadowBlur=A.blur.number,s.ctx.fillText(r.text,r.bounds.left,r.bounds.top+r.bounds.height)}),s.ctx.shadowColor="",s.ctx.shadowOffsetX=0,s.ctx.shadowOffsetY=0,s.ctx.shadowBlur=0),o.textDecorationLine.length&&(s.ctx.fillStyle=te(o.textDecorationColor||o.color),o.textDecorationLine.forEach(function(A){switch(A){case 1:var e=s.fontMetrics.getMetrics(n,B).baseline;s.ctx.fillRect(r.bounds.left,Math.round(r.bounds.top+e),r.bounds.width,1);break;case 2:s.ctx.fillRect(r.bounds.left,Math.round(r.bounds.top),r.bounds.width,1);break;case 3:var t=s.fontMetrics.getMetrics(n,B).middle;s.ctx.fillRect(r.bounds.left,Math.ceil(r.bounds.top+t),r.bounds.width,1)}}))}),[2]})})},Ds.prototype.renderReplacedElement=function(A,e,t){if(t&&0<A.intrinsicWidth&&0<A.intrinsicHeight){var r=hs(A),n=ws(e);this.path(n),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(t,0,0,A.intrinsicWidth,A.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore()}},Ds.prototype.renderNodeContent=function(l){return a(this,void 0,void 0,function(){var e,t,r,n,B,s,o,i,a,c,Q,w,u,U;return S(this,function(A){switch(A.label){case 0:this.applyEffects(l.effects,4),e=l.container,t=l.curves,r=e.styles,n=0,B=e.textNodes,A.label=1;case 1:return n<B.length?(s=B[n],[4,this.renderTextNode(s,r)]):[3,4];case 2:A.sent(),A.label=3;case 3:return n++,[3,1];case 4:if(!(e instanceof Nn))return[3,8];A.label=5;case 5:return A.trys.push([5,7,,8]),[4,this.options.cache.match(e.src)];case 6:return w=A.sent(),this.renderReplacedElement(e,t,w),[3,8];case 7:return A.sent(),De.getInstance(this.options.id).error("Error loading image "+e.src),[3,8];case 8:if(e instanceof Tn&&this.renderReplacedElement(e,t,e.canvas),!(e instanceof Ln))return[3,12];A.label=9;case 9:return A.trys.push([9,11,,12]),[4,this.options.cache.match(e.svg)];case 10:return w=A.sent(),this.renderReplacedElement(e,t,w),[3,12];case 11:return A.sent(),De.getInstance(this.options.id).error("Error loading svg "+e.svg.substring(0,255)),[3,12];case 12:return e instanceof tB&&e.tree?[4,new Ds({id:this.options.id,scale:this.options.scale,backgroundColor:e.backgroundColor,x:0,y:0,scrollX:0,scrollY:0,width:e.width,height:e.height,cache:this.options.cache,windowWidth:e.width,windowHeight:e.height}).render(e.tree)]:[3,14];case 13:o=A.sent(),e.width&&e.height&&this.ctx.drawImage(o,0,0,e.width,e.height,e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height),A.label=14;case 14:if(e instanceof Gn&&(i=Math.min(e.bounds.width,e.bounds.height),e.type===Vn?e.checked&&(this.ctx.save(),this.path([new ts(e.bounds.left+.39363*i,e.bounds.top+.79*i),new ts(e.bounds.left+.16*i,e.bounds.top+.5549*i),new ts(e.bounds.left+.27347*i,e.bounds.top+.44071*i),new ts(e.bounds.left+.39694*i,e.bounds.top+.5649*i),new ts(e.bounds.left+.72983*i,e.bounds.top+.23*i),new ts(e.bounds.left+.84*i,e.bounds.top+.34085*i),new ts(e.bounds.left+.39363*i,e.bounds.top+.79*i)]),this.ctx.fillStyle=te(Jn),this.ctx.fill(),this.ctx.restore()):e.type===zn&&e.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e.bounds.left+i/2,e.bounds.top+i/2,i/4,0,2*Math.PI,!0),this.ctx.fillStyle=te(Jn),this.ctx.fill(),this.ctx.restore())),bs(e)&&e.value.length){switch(this.ctx.font=this.createFontStyle(r)[0],this.ctx.fillStyle=te(r.color),this.ctx.textBaseline="middle",this.ctx.textAlign=Ms(e.styles.textAlign),U=hs(e),a=0,e.styles.textAlign){case Cr.CENTER:a+=U.width/2;break;case Cr.RIGHT:a+=U.width}c=U.add(a,0,0,-U.height/2+1),this.ctx.save(),this.path([new ts(U.left,U.top),new ts(U.left+U.width,U.top),new ts(U.left+U.width,U.top+U.height),new ts(U.left,U.top+U.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Cn(e.value,c),r.letterSpacing),this.ctx.restore(),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"}if(!An(e.styles.display,2048))return[3,20];if(null===e.styles.listStyleImage)return[3,19];if((Q=e.styles.listStyleImage).type!==xe.URL)return[3,18];w=void 0,u=Q.url,A.label=15;case 15:return A.trys.push([15,17,,18]),[4,this.options.cache.match(u)];case 16:return w=A.sent(),this.ctx.drawImage(w,e.bounds.left-(w.width+10),e.bounds.top),[3,18];case 17:return A.sent(),De.getInstance(this.options.id).error("Error loading list-style-image "+u),[3,18];case 18:return[3,20];case 19:l.listValue&&e.styles.listStyleType!==tr.NONE&&(this.ctx.font=this.createFontStyle(r)[0],this.ctx.fillStyle=te(r.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",U=new I(e.bounds.left,e.bounds.top+ae(e.styles.paddingTop,e.bounds.width),e.bounds.width,function(A,e){return zA(A)&&"normal"===A.value?1.2*e:A.type===sA.NUMBER_TOKEN?e*A.number:qA(A)?ae(A,e):e}(r.lineHeight,r.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Cn(l.listValue,U),r.letterSpacing),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),A.label=20;case 20:return[2]}})})},Ds.prototype.renderStackContent=function(C){return a(this,void 0,void 0,function(){var e,t,r,n,B,s,o,i,a,c,Q,w,u,U,l;return S(this,function(A){switch(A.label){case 0:return[4,this.renderNodeBackgroundAndBorders(C.element)];case 1:A.sent(),e=0,t=C.negativeZIndex,A.label=2;case 2:return e<t.length?(l=t[e],[4,this.renderStack(l)]):[3,5];case 3:A.sent(),A.label=4;case 4:return e++,[3,2];case 5:return[4,this.renderNodeContent(C.element)];case 6:A.sent(),r=0,n=C.nonInlineLevel,A.label=7;case 7:return r<n.length?(l=n[r],[4,this.renderNode(l)]):[3,10];case 8:A.sent(),A.label=9;case 9:return r++,[3,7];case 10:B=0,s=C.nonPositionedFloats,A.label=11;case 11:return B<s.length?(l=s[B],[4,this.renderStack(l)]):[3,14];case 12:A.sent(),A.label=13;case 13:return B++,[3,11];case 14:o=0,i=C.nonPositionedInlineLevel,A.label=15;case 15:return o<i.length?(l=i[o],[4,this.renderStack(l)]):[3,18];case 16:A.sent(),A.label=17;case 17:return o++,[3,15];case 18:a=0,c=C.inlineLevel,A.label=19;case 19:return a<c.length?(l=c[a],[4,this.renderNode(l)]):[3,22];case 20:A.sent(),A.label=21;case 21:return a++,[3,19];case 22:Q=0,w=C.zeroOrAutoZIndexOrTransformedOrOpacity,A.label=23;case 23:return Q<w.length?(l=w[Q],[4,this.renderStack(l)]):[3,26];case 24:A.sent(),A.label=25;case 25:return Q++,[3,23];case 26:u=0,U=C.positiveZIndex,A.label=27;case 27:return u<U.length?(l=U[u],[4,this.renderStack(l)]):[3,30];case 28:A.sent(),A.label=29;case 29:return u++,[3,27];case 30:return[2]}})})},Ds.prototype.mask=function(A){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(A.slice(0).reverse()),this.ctx.closePath()},Ds.prototype.path=function(A){this.ctx.beginPath(),this.formatPath(A),this.ctx.closePath()},Ds.prototype.formatPath=function(A){var r=this;A.forEach(function(A,e){var t=os(A)?A.start:A;0===e?r.ctx.moveTo(t.x,t.y):r.ctx.lineTo(t.x,t.y),os(A)&&r.ctx.bezierCurveTo(A.startControl.x,A.startControl.y,A.endControl.x,A.endControl.y,A.end.x,A.end.y)})},Ds.prototype.renderRepeat=function(A,e,t,r){this.path(A),this.ctx.fillStyle=e,this.ctx.translate(t,r),this.ctx.fill(),this.ctx.translate(-t,-r)},Ds.prototype.resizeImage=function(A,e,t){if(A.width===e&&A.height===t)return A;var r=this.canvas.ownerDocument.createElement("canvas");return r.width=e,r.height=t,r.getContext("2d").drawImage(A,0,0,A.width,A.height,0,0,e,t),r},Ds.prototype.renderBackgroundImage=function(b){return a(this,void 0,void 0,function(){var O,e,D,t,r,n;return S(this,function(A){switch(A.label){case 0:O=b.styles.backgroundImage.length-1,e=function(e){var t,r,n,B,s,o,i,a,c,Q,w,u,U,l,C,g,E,F,h,H,d,f,p,N,K,I,T,m,R,L,v;return S(this,function(A){switch(A.label){case 0:if(e.type!==xe.URL)return[3,5];t=void 0,r=e.url,A.label=1;case 1:return A.trys.push([1,3,,4]),[4,D.options.cache.match(r)];case 2:return t=A.sent(),[3,4];case 3:return A.sent(),De.getInstance(D.options.id).error("Error loading background-image "+r),[3,4];case 4:return t&&(n=Hs(b,O,[t.width,t.height,t.width/t.height]),g=n[0],f=n[1],p=n[2],h=n[3],H=n[4],l=D.ctx.createPattern(D.resizeImage(t,h,H),"repeat"),D.renderRepeat(g,l,f,p)),[3,6];case 5:!function(A){return A.type===xe.LINEAR_GRADIENT}(e)?function(A){return A.type===xe.RADIAL_GRADIENT}(e)&&(C=Hs(b,O,[null,null,null]),g=C[0],E=C[1],F=C[2],h=C[3],H=C[4],d=0===e.position.length?[oe]:e.position,f=ae(d[0],h),p=ae(d[d.length-1],H),N=function(A,e,t,r,n){var B=0,s=0;switch(A.size){case Bt.CLOSEST_SIDE:A.shape===rt.CIRCLE?B=s=Math.min(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-n)):A.shape===rt.ELLIPSE&&(B=Math.min(Math.abs(e),Math.abs(e-r)),s=Math.min(Math.abs(t),Math.abs(t-n)));break;case Bt.CLOSEST_CORNER:if(A.shape===rt.CIRCLE)B=s=Math.min(Ne(e,t),Ne(e,t-n),Ne(e-r,t),Ne(e-r,t-n));else if(A.shape===rt.ELLIPSE){var o=Math.min(Math.abs(t),Math.abs(t-n))/Math.min(Math.abs(e),Math.abs(e-r)),i=Ke(r,n,e,t,!0),a=i[0],c=i[1];s=o*(B=Ne(a-e,(c-t)/o))}break;case Bt.FARTHEST_SIDE:A.shape===rt.CIRCLE?B=s=Math.max(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-n)):A.shape===rt.ELLIPSE&&(B=Math.max(Math.abs(e),Math.abs(e-r)),s=Math.max(Math.abs(t),Math.abs(t-n)));break;case Bt.FARTHEST_CORNER:if(A.shape===rt.CIRCLE)B=s=Math.max(Ne(e,t),Ne(e,t-n),Ne(e-r,t),Ne(e-r,t-n));else if(A.shape===rt.ELLIPSE){o=Math.max(Math.abs(t),Math.abs(t-n))/Math.max(Math.abs(e),Math.abs(e-r));var Q=Ke(r,n,e,t,!1);a=Q[0],c=Q[1],s=o*(B=Ne(a-e,(c-t)/o))}}return Array.isArray(A.size)&&(B=ae(A.size[0],r),s=2===A.size.length?ae(A.size[1],n):B),[B,s]}(e,f,p,h,H),K=N[0],I=N[1],0<K&&0<K&&(T=D.ctx.createRadialGradient(E+f,F+p,0,E+f,F+p,K),fe(e.stops,2*K).forEach(function(A){return T.addColorStop(A.stop,te(A.color))}),D.path(g),D.ctx.fillStyle=T,K!==I?(m=b.bounds.left+.5*b.bounds.width,R=b.bounds.top+.5*b.bounds.height,v=1/(L=I/K),D.ctx.save(),D.ctx.translate(m,R),D.ctx.transform(1,0,0,L,0,0),D.ctx.translate(-m,-R),D.ctx.fillRect(E,v*(F-R)+R,h,H*v),D.ctx.restore()):D.ctx.fill())):(B=Hs(b,O,[null,null,null]),g=B[0],f=B[1],p=B[2],h=B[3],H=B[4],s=pe(e.angle,h,H),o=s[0],i=s[1],a=s[2],c=s[3],Q=s[4],(w=document.createElement("canvas")).width=h,w.height=H,u=w.getContext("2d"),U=u.createLinearGradient(i,c,a,Q),fe(e.stops,o).forEach(function(A){return U.addColorStop(A.stop,te(A.color))}),u.fillStyle=U,u.fillRect(0,0,h,H),0<h&&0<H&&(l=D.ctx.createPattern(w,"repeat"),D.renderRepeat(g,l,f,p))),A.label=6;case 6:return O--,[2]}})},D=this,t=0,r=b.styles.backgroundImage.slice(0).reverse(),A.label=1;case 1:return t<r.length?(n=r[t],[5,e(n)]):[3,4];case 2:A.sent(),A.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},Ds.prototype.renderBorder=function(e,t,r){return a(this,void 0,void 0,function(){return S(this,function(A){return this.path(function(A,e){switch(e){case 0:return Ks(A.topLeftBorderBox,A.topLeftPaddingBox,A.topRightBorderBox,A.topRightPaddingBox);case 1:return Ks(A.topRightBorderBox,A.topRightPaddingBox,A.bottomRightBorderBox,A.bottomRightPaddingBox);case 2:return Ks(A.bottomRightBorderBox,A.bottomRightPaddingBox,A.bottomLeftBorderBox,A.bottomLeftPaddingBox);case 3:default:return Ks(A.bottomLeftBorderBox,A.bottomLeftPaddingBox,A.topLeftBorderBox,A.topLeftPaddingBox)}}(r,t)),this.ctx.fillStyle=te(e),this.ctx.fill(),[2]})})},Ds.prototype.renderNodeBackgroundAndBorders=function(c){return a(this,void 0,void 0,function(){var e,t,r,n,B,s,o,i,a=this;return S(this,function(A){switch(A.label){case 0:return this.applyEffects(c.effects,2),e=c.container.styles,t=!ee(e.backgroundColor)||e.backgroundImage.length,r=[{style:e.borderTopStyle,color:e.borderTopColor},{style:e.borderRightStyle,color:e.borderRightColor},{style:e.borderBottomStyle,color:e.borderBottomColor},{style:e.borderLeftStyle,color:e.borderLeftColor}],n=Ss(Ts(e.backgroundClip,0),c.curves),t||e.boxShadow.length?(this.ctx.save(),this.path(n),this.ctx.clip(),ee(e.backgroundColor)||(this.ctx.fillStyle=te(e.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(c.container)]):[3,2];case 1:A.sent(),this.ctx.restore(),e.boxShadow.slice(0).reverse().forEach(function(A){a.ctx.save();var e=Qs(c.curves),t=A.inset?0:1e4,r=function(A,t,r,n,B){return A.map(function(A,e){switch(e){case 0:return A.add(t,r);case 1:return A.add(t+n,r);case 2:return A.add(t+n,r+B);case 3:return A.add(t,r+B)}return A})}(e,-t+(A.inset?1:-1)*A.spread.number,(A.inset?1:-1)*A.spread.number,A.spread.number*(A.inset?-2:2),A.spread.number*(A.inset?-2:2));A.inset?(a.path(e),a.ctx.clip(),a.mask(r)):(a.mask(e),a.ctx.clip(),a.path(r)),a.ctx.shadowOffsetX=A.offsetX.number+t,a.ctx.shadowOffsetY=A.offsetY.number,a.ctx.shadowColor=te(A.color),a.ctx.shadowBlur=A.blur.number,a.ctx.fillStyle=A.inset?te(A.color):"rgba(0,0,0,1)",a.ctx.fill(),a.ctx.restore()}),A.label=2;case 2:s=B=0,o=r,A.label=3;case 3:return s<o.length?(i=o[s]).style===ht.NONE||ee(i.color)?[3,5]:[4,this.renderBorder(i.color,B,c.curves)]:[3,7];case 4:A.sent(),A.label=5;case 5:B++,A.label=6;case 6:return s++,[3,3];case 7:return[2]}})})},Ds.prototype.render=function(t){return a(this,void 0,void 0,function(){var e;return S(this,function(A){switch(A.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=te(this.options.backgroundColor),this.ctx.fillRect(this.options.x-this.options.scrollX,this.options.y-this.options.scrollY,this.options.width,this.options.height)),e=function(A){var e=new gs(A,[]),t=new Cs(e),r=[];return ps(e,t,t,r),Ns(e.container,r),t}(t),[4,this.renderStack(e)];case 1:return A.sent(),this.applyEffects([],2),[2,this.canvas]}})})},Ds);function Ds(A){this._activeEffects=[],this.canvas=A.canvas?A.canvas:document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),(this.options=A).canvas||(this.canvas.width=Math.floor(A.width*A.scale),this.canvas.height=Math.floor(A.height*A.scale),this.canvas.style.width=A.width+"px",this.canvas.style.height=A.height+"px"),this.fontMetrics=new Ls(document),this.ctx.scale(this.options.scale,this.options.scale),this.ctx.translate(-A.x+A.scrollX,-A.y+A.scrollY),this.ctx.textBaseline="bottom",this._activeEffects=[],De.getInstance(A.id).debug("Canvas renderer initialized ("+A.width+"x"+A.height+" at "+A.x+","+A.y+") with scale "+A.scale)}var bs=function(A){return A instanceof jn||(A instanceof Yn||A instanceof Gn&&A.type!==zn&&A.type!==Vn)},Ss=function(A,e){switch(A){case Ee.BORDER_BOX:return Qs(e);case Ee.CONTENT_BOX:return function(A){return[A.topLeftContentBox,A.topRightContentBox,A.bottomRightContentBox,A.bottomLeftContentBox]}(e);case Ee.PADDING_BOX:default:return ws(e)}},Ms=function(A){switch(A){case Cr.CENTER:return"center";case Cr.RIGHT:return"right";case Cr.LEFT:default:return"left"}},ys=(_s.prototype.render=function(r){return a(this,void 0,void 0,function(){var e,t;return S(this,function(A){switch(A.label){case 0:return e=Le(Math.max(this.options.windowWidth,this.options.width)*this.options.scale,Math.max(this.options.windowHeight,this.options.height)*this.options.scale,this.options.scrollX*this.options.scale,this.options.scrollY*this.options.scale,r),[4,xs(e)];case 1:return t=A.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=te(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(t,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},_s);function _s(A){this.canvas=A.canvas?A.canvas:document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.options=A,this.canvas.width=Math.floor(A.width*A.scale),this.canvas.height=Math.floor(A.height*A.scale),this.canvas.style.width=A.width+"px",this.canvas.style.height=A.height+"px",this.ctx.scale(this.options.scale,this.options.scale),this.ctx.translate(-A.x+A.scrollX,-A.y+A.scrollY),De.getInstance(A.id).debug("EXPERIMENTAL ForeignObject renderer initialized ("+A.width+"x"+A.height+" at "+A.x+","+A.y+") with scale "+A.scale)}function Ps(A){return we(_A.create(A).parseComponentValue())}var xs=function(r){return new Promise(function(A,e){var t=new Image;t.onload=function(){A(t)},t.onerror=e,t.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(r))})};"undefined"!=typeof window&&Se.setContext(window);var Vs=function(p,N){return a(void 0,void 0,void 0,function(){var e,t,r,n,B,s,o,i,a,c,Q,w,u,U,l,C,g,E,F,h,H,d,f;return S(this,function(A){switch(A.label){case 0:if(!(e=p.ownerDocument))throw new Error("Element is not attached to a Document");if(!(t=e.defaultView))throw new Error("Document is not attached to a Window");return r=(Math.round(1e3*Math.random())+Date.now()).toString(16),n=EB(p)||function(A){return"HTML"===A.tagName}(p)?function(A){var e=A.body,t=A.documentElement;if(!e||!t)throw new Error("Unable to get document size");var r=Math.max(Math.max(e.scrollWidth,t.scrollWidth),Math.max(e.offsetWidth,t.offsetWidth),Math.max(e.clientWidth,t.clientWidth)),n=Math.max(Math.max(e.scrollHeight,t.scrollHeight),Math.max(e.offsetHeight,t.offsetHeight),Math.max(e.clientHeight,t.clientHeight));return new I(0,0,r,n)}(e):T(p),B=n.width,s=n.height,o=n.left,i=n.top,a=K({},{allowTaint:!1,imageTimeout:15e3,proxy:void 0,useCORS:!1},N),c={backgroundColor:"#ffffff",cache:N.cache?N.cache:Se.create(r,a),logging:!0,removeContainer:!0,foreignObjectRendering:!1,scale:t.devicePixelRatio||1,windowWidth:t.innerWidth,windowHeight:t.innerHeight,scrollX:t.pageXOffset,scrollY:t.pageYOffset,x:o,y:i,width:Math.ceil(B),height:Math.ceil(s),id:r},Q=K({},c,a,N),w=new I(Q.scrollX,Q.scrollY,Q.windowWidth,Q.windowHeight),De.create({id:r,enabled:Q.logging}),De.getInstance(r).debug("Starting document clone"),u=new PB(p,{id:r,onclone:Q.onclone,ignoreElements:Q.ignoreElements,inlineImages:Q.foreignObjectRendering,copyStyles:Q.foreignObjectRendering}),(U=u.clonedReferenceElement)?[4,u.toIFrame(e,w)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return l=A.sent(),C=e.documentElement?Ps(getComputedStyle(e.documentElement).backgroundColor):He.TRANSPARENT,g=e.body?Ps(getComputedStyle(e.body).backgroundColor):He.TRANSPARENT,E=N.backgroundColor,F="string"==typeof E?Ps(E):null===E?He.TRANSPARENT:4294967295,h=p===e.documentElement?ee(C)?ee(g)?F:g:C:F,H={id:r,cache:Q.cache,canvas:Q.canvas,backgroundColor:h,scale:Q.scale,x:Q.x,y:Q.y,scrollX:Q.scrollX,scrollY:Q.scrollY,width:Q.width,height:Q.height,windowWidth:Q.windowWidth,windowHeight:Q.windowHeight},Q.foreignObjectRendering?(De.getInstance(r).debug("Document cloned, using foreign object rendering"),[4,new ys(H).render(U)]):[3,3];case 2:return d=A.sent(),[3,5];case 3:return De.getInstance(r).debug("Document cloned, using computed rendering"),Se.attachInstance(Q.cache),De.getInstance(r).debug("Starting DOM parsing"),f=iB(U),Se.detachInstance(),h===f.styles.backgroundColor&&(f.styles.backgroundColor=He.TRANSPARENT),De.getInstance(r).debug("Starting renderer"),[4,new Os(H).render(f)];case 4:d=A.sent(),A.label=5;case 5:return!0===Q.removeContainer&&(PB.destroy(l)||De.getInstance(r).error("Cannot detach cloned iframe as it is not in the DOM anymore")),De.getInstance(r).debug("Finished rendering"),De.destroy(r),Se.destroy(r),[2,d]}})})};return function(A,e){return void 0===e&&(e={}),Vs(A,e)}});!function(){var e=function(){return function e(t,n,r){function o(s,i){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!i&&u)return u(s,!0);if(a)return a(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var h=n[s]={exports:{}};t[s][0].call(h.exports,function(e){var n=t[s][1][e];return o(n||e)},h,h.exports,e,t,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){function r(e){return e+(97<=e&&e<=122?-32:65<=e&&e<=90?32:0)}function o(){return!this.randInt(0,1)}function a(e){return e instanceof h?e.index(this.randInt(0,e.length-1)):e[this.randInt(0,e.length-1)]}function s(e){if(e.type===p.types.CHAR)return new h(e.value);if(e.type===p.types.RANGE)return new h(e.from,e.to);for(var t=new h,n=0;n<e.set.length;n++){var o=s.call(this,e.set[n]);if(t.add(o),this.ignoreCase)for(var a=0;a<o.length;a++){var i=o.index(a),u=r(i);i!==u&&t.add(u)}}return e.not?this.defaultRange.clone().subtract(t):t}function i(e,t){"number"==typeof t.max&&(e.max=t.max),t.defaultRange instanceof h&&(e.defaultRange=t.defaultRange),"function"==typeof t.randInt&&(e.randInt=t.randInt)}function u(e,t){var n,i,p,h,c;switch(e.type){case l.ROOT:case l.GROUP:if(e.followedBy||e.notFollowedBy)return"";for(e.remember&&void 0===e.groupNumber&&(e.groupNumber=t.push(null)-1),i="",h=0,c=(n=e.options?a.call(this,e.options):e.stack).length;h<c;h++)i+=u.call(this,n[h],t);return e.remember&&(t[e.groupNumber]=i),i;case l.POSITION:return"";case l.SET:var f=s.call(this,e);return f.length?String.fromCharCode(a.call(this,f)):"";case l.REPETITION:for(p=this.randInt(e.min,e.max===1/0?e.min+this.max:e.max),i="",h=0;h<p;h++)i+=u.call(this,e.value,t);return i;case l.REFERENCE:return t[e.value-1]||"";case l.CHAR:var g=this.ignoreCase&&o.call(this)?r(e.value):e.value;return String.fromCharCode(g)}}var p=e("ret"),h=e("discontinuous-range"),l=p.types,c=t.exports=function(e,t){if(this.defaultRange=this.defaultRange.clone(),e instanceof RegExp)this.ignoreCase=e.ignoreCase,this.multiline=e.multiline,i(this,e),e=e.source;else{if("string"!=typeof e)throw new Error("Expected a regexp or string");this.ignoreCase=t&&-1!==t.indexOf("i"),this.multiline=t&&-1!==t.indexOf("m")}this.tokens=p(e)};c.prototype.max=20,c.prototype.gen=function(){return u.call(this,this.tokens,[])},c.randexp=function(e,t){var n;return void 0===e._randexp?(n=new c(e,t),e._randexp=n):n=e._randexp,i(n,e),n.gen()},c.sugar=function(){RegExp.prototype.gen=function(){return c.randexp(this)}},c.prototype.defaultRange=new h(32,126),c.prototype.randInt=function(e,t){return e+Math.floor(Math.random()*(1+t-e))}},{"discontinuous-range":2,ret:3}],2:[function(e,t,n){function r(e,t){this.low=e,this.high=t,this.length=1+t-e}function o(e,t){if(!(this instanceof o))return new o(e,t);this.ranges=[],this.length=0,void 0!==e&&this.add(e,t)}function a(e){e.length=e.ranges.reduce(function(e,t){return e+t.length},0)}r.prototype.overlaps=function(e){return!(this.high<e.low||this.low>e.high)},r.prototype.touches=function(e){return!(this.high+1<e.low||this.low-1>e.high)},r.prototype.add=function(e){return this.touches(e)&&new r(Math.min(this.low,e.low),Math.max(this.high,e.high))},r.prototype.subtract=function(e){return!!this.overlaps(e)&&(e.low<=this.low&&e.high>=this.high?[]:e.low>this.low&&e.high<this.high?[new r(this.low,e.low-1),new r(e.high+1,this.high)]:e.low<=this.low?[new r(e.high+1,this.high)]:[new r(this.low,e.low-1)])},r.prototype.toString=function(){return this.low==this.high?this.low.toString():this.low+"-"+this.high},r.prototype.clone=function(){return new r(this.low,this.high)},o.prototype.add=function(e,t){function n(e){for(var t=[],n=0;n<s.ranges.length&&!e.touches(s.ranges[n]);)t.push(s.ranges[n].clone()),n++;for(;n<s.ranges.length&&e.touches(s.ranges[n]);)e=e.add(s.ranges[n]),n++;for(t.push(e);n<s.ranges.length;)t.push(s.ranges[n].clone()),n++;s.ranges=t,a(s)}var s=this;return e instanceof o?e.ranges.forEach(n):e instanceof r?n(e):(void 0===t&&(t=e),n(new r(e,t))),this},o.prototype.subtract=function(e,t){function n(e){for(var t=[],n=0;n<s.ranges.length&&!e.overlaps(s.ranges[n]);)t.push(s.ranges[n].clone()),n++;for(;n<s.ranges.length&&e.overlaps(s.ranges[n]);)t=t.concat(s.ranges[n].subtract(e)),n++;for(;n<s.ranges.length;)t.push(s.ranges[n].clone()),n++;s.ranges=t,a(s)}var s=this;return e instanceof o?e.ranges.forEach(n):e instanceof r?n(e):(void 0===t&&(t=e),n(new r(e,t))),this},o.prototype.index=function(e){for(var t=0;t<this.ranges.length&&this.ranges[t].length<=e;)e-=this.ranges[t].length,t++;return t>=this.ranges.length?null:this.ranges[t].low+e},o.prototype.toString=function(){return"[ "+this.ranges.join(", ")+" ]"},o.prototype.clone=function(){return new o(this)},t.exports=o},{}],3:[function(e,t,n){var r=e("./util"),o=e("./types"),a=e("./sets"),s=e("./positions");t.exports=function(e){var t,n,i=0,u={type:o.ROOT,stack:[]},p=u,h=u.stack,l=[],c=function(t){r.error(e,"Nothing to repeat at column "+(t-1))},f=r.strToChars(e);for(t=f.length;i<t;)switch(n=f[i++]){case"\\":switch(n=f[i++]){case"b":h.push(s.wordBoundary());break;case"B":h.push(s.nonWordBoundary());break;case"w":h.push(a.words());break;case"W":h.push(a.notWords());break;case"d":h.push(a.ints());break;case"D":h.push(a.notInts());break;case"s":h.push(a.whitespace());break;case"S":h.push(a.notWhitespace());break;default:/\d/.test(n)?h.push({type:o.REFERENCE,value:parseInt(n,10)}):h.push({type:o.CHAR,value:n.charCodeAt(0)})}break;case"^":h.push(s.begin());break;case"$":h.push(s.end());break;case"[":var g;"^"===f[i]?(g=!0,i++):g=!1;var y=r.tokenizeClass(f.slice(i),e);i+=y[1],h.push({type:o.SET,set:y[0],not:g});break;case".":h.push(a.anyChar());break;case"(":var d={type:o.GROUP,stack:[],remember:!0};"?"===(n=f[i])&&(n=f[i+1],i+=2,"="===n?d.followedBy=!0:"!"===n?d.notFollowedBy=!0:":"!==n&&r.error(e,"Invalid group, character '"+n+"' after '?' at column "+(i-1)),d.remember=!1),h.push(d),l.push(p),p=d,h=d.stack;break;case")":0===l.length&&r.error(e,"Unmatched ) at column "+(i-1)),h=(p=l.pop()).options?p.options[p.options.length-1]:p.stack;break;case"|":p.options||(p.options=[p.stack],delete p.stack);var v=[];p.options.push(v),h=v;break;case"{":var R,C,w=/^(\d+)(,(\d+)?)?\}/.exec(f.slice(i));null!==w?(0===h.length&&c(i),R=parseInt(w[1],10),C=w[2]?w[3]?parseInt(w[3],10):1/0:R,i+=w[0].length,h.push({type:o.REPETITION,min:R,max:C,value:h.pop()})):h.push({type:o.CHAR,value:123});break;case"?":0===h.length&&c(i),h.push({type:o.REPETITION,min:0,max:1,value:h.pop()});break;case"+":0===h.length&&c(i),h.push({type:o.REPETITION,min:1,max:1/0,value:h.pop()});break;case"*":0===h.length&&c(i),h.push({type:o.REPETITION,min:0,max:1/0,value:h.pop()});break;default:h.push({type:o.CHAR,value:n.charCodeAt(0)})}return 0!==l.length&&r.error(e,"Unterminated group"),u},t.exports.types=o},{"./positions":4,"./sets":5,"./types":6,"./util":7}],4:[function(e,t,n){var r=e("./types");n.wordBoundary=function(){return{type:r.POSITION,value:"b"}},n.nonWordBoundary=function(){return{type:r.POSITION,value:"B"}},n.begin=function(){return{type:r.POSITION,value:"^"}},n.end=function(){return{type:r.POSITION,value:"$"}}},{"./types":6}],5:[function(e,t,n){var r=e("./types"),o=function(){return[{type:r.RANGE,from:48,to:57}]},a=function(){return[{type:r.CHAR,value:95},{type:r.RANGE,from:97,to:122},{type:r.RANGE,from:65,to:90}].concat(o())},s=function(){return[{type:r.CHAR,value:9},{type:r.CHAR,value:10},{type:r.CHAR,value:11},{type:r.CHAR,value:12},{type:r.CHAR,value:13},{type:r.CHAR,value:32},{type:r.CHAR,value:160},{type:r.CHAR,value:5760},{type:r.CHAR,value:6158},{type:r.CHAR,value:8192},{type:r.CHAR,value:8193},{type:r.CHAR,value:8194},{type:r.CHAR,value:8195},{type:r.CHAR,value:8196},{type:r.CHAR,value:8197},{type:r.CHAR,value:8198},{type:r.CHAR,value:8199},{type:r.CHAR,value:8200},{type:r.CHAR,value:8201},{type:r.CHAR,value:8202},{type:r.CHAR,value:8232},{type:r.CHAR,value:8233},{type:r.CHAR,value:8239},{type:r.CHAR,value:8287},{type:r.CHAR,value:12288},{type:r.CHAR,value:65279}]},i=function(){return[{type:r.CHAR,value:10},{type:r.CHAR,value:13},{type:r.CHAR,value:8232},{type:r.CHAR,value:8233}]};n.words=function(){return{type:r.SET,set:a(),not:!1}},n.notWords=function(){return{type:r.SET,set:a(),not:!0}},n.ints=function(){return{type:r.SET,set:o(),not:!1}},n.notInts=function(){return{type:r.SET,set:o(),not:!0}},n.whitespace=function(){return{type:r.SET,set:s(),not:!1}},n.notWhitespace=function(){return{type:r.SET,set:s(),not:!0}},n.anyChar=function(){return{type:r.SET,set:i(),not:!0}}},{"./types":6}],6:[function(e,t,n){t.exports={ROOT:0,GROUP:1,POSITION:2,SET:3,RANGE:4,REPETITION:5,REFERENCE:6,CHAR:7}},{}],7:[function(e,t,n){var r=e("./types"),o=e("./sets"),a={0:0,t:9,n:10,v:11,f:12,r:13};n.strToChars=function(e){var t=/(\[\\b\])|(\\)?\\(?:u([A-F0-9]{4})|x([A-F0-9]{2})|(0?[0-7]{2})|c([@A-Z\[\\\]\^?])|([0tnvfr]))/g;return e=e.replace(t,function(e,t,n,r,o,s,i,u){if(n)return e;var p=t?8:r?parseInt(r,16):o?parseInt(o,16):s?parseInt(s,8):i?"@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^ ?".indexOf(i):a[u],h=String.fromCharCode(p);return/[\[\]{}\^$.|?*+()]/.test(h)&&(h="\\"+h),h})},n.tokenizeClass=function(e,t){for(var a,s,i=[],u=/\\(?:(w)|(d)|(s)|(W)|(D)|(S))|((?:(?:\\)(.)|([^\]\\]))-(?:\\)?([^\]]))|(\])|(?:\\)?(.)/g;null!=(a=u.exec(e));)if(a[1])i.push(o.words());else if(a[2])i.push(o.ints());else if(a[3])i.push(o.whitespace());else if(a[4])i.push(o.notWords());else if(a[5])i.push(o.notInts());else if(a[6])i.push(o.notWhitespace());else if(a[7])i.push({type:r.RANGE,from:(a[8]||a[9]).charCodeAt(0),to:a[10].charCodeAt(0)});else{if(!(s=a[12]))return[i,u.lastIndex];i.push({type:r.CHAR,value:s.charCodeAt(0)})}n.error(t,"Unterminated character class")},n.error=function(e,t){throw new SyntaxError("Invalid regular expression: /"+e+"/: "+t)}},{"./sets":5,"./types":6}]},{},[1])}()(1);"function"==typeof define&&"object"==typeof define.amd?define("RandExp",function(){return e}):"undefined"!=typeof window&&(window.RandExp=e)}();
var _bzMessage={
  _language:{
    en:"English",
    cn:"中文"
  },
  _common:{
    _notAvailable:"Not available",
    _flag:"Switch Flag",
    _copyComment:"This is copy data, you can use it in: 1. select all content (ctrl + a), 2. copy (ctrl + c). 3. switch to IDE and paste (ctrl + v)",
    _andMessage:"{0} and {1}",
    _shortcutList:"Bookmark List",
    _recentList:"Recent visited List",
    _moduleTest:"Module / Test",
    _pauseList:"Pause List",
    _ready:"Ready",
    _template:"Template",
    _protect:"Protect",
    _percentage:"Percentage",
    _other:"Other",
    _setting:"Settings",
    _delay:"Delay {0} to execution",
    _timeout:"Waiting target element appear (timeout in {0})",
    _item:"Item",
    _list:"List",
    _size:"Size",
    _format:"Format",
    _branch:"Branch",
    _debugData:"Debug Data",
    _result:"Result",
    _wordSign:"W",
    _createTime:"Create Time",
    _updateTime:"Update Time",
    _property:"Property",
    _totalTests:"Total {0} Test case(s)",
    _fileSize:"File Size",
    _language:"Language",
    _created:"Created!",
    _enter:"Enter",
    _initial:"INIT",
    _hour:"h ",
    _minute:"m ",
    _second:"s ",
    _newModule:"[New Module]",
    on:"on",
    off:"off",
    or:"or",
    _bookmark:"Bookmark",
    _mapping:"Mapping",
    _deleted:"Deleted",
    _orWord:"or",
    _homePage:"Home page",
    _about:"About",
    _loading:"Loading ...",
    _legend:"Hidden tests",
    _note:"Note",
    _failedOn:"Failed on: ",
    _fields:"Fields",
    _details:"Details",
    _general:"general",
    _loopData:"For Loop Data",
    _select:"[select ...]",
    _solution:"Solution",
    _operations:"Operations",
    _required:"Required",
    _option:"Option",
    _parameterSetting:"Parameter Setting",
    _newValue:"New Value",
    _contents:"Contents",
    _main:"Main",
    _app:"APP",
    _copyOf:"Copy of ",
    _fromDesc:"From: {0}",
    _targetDesc:"Target：{0}",
    _from:"From",
    _toData:"To",
    _private:"Private",
    _dockSide:"Dock side: ",
    "dock-left":"Dock to left",
    "dock-right":"Dock to right",
    "undock":"Un-dock into separate window",
    _suite:"Test suites",
    _authentication:"Authentication",
    _default:"Default",
    _requirement:"Requirement",
    _requirementDesc:"Map test to requirement",
    _complete:"Complete",
    _rootUrl:"URL",
    _label:"Label",
    _req:"External file/Data",
    _home:"Home",
    include:"Include",
    exclude:"Exclude",
    _screenshot:"Screenshot",
    _create:"Created",
    _fun:"Fun",
    _file:"File",
    _root:"Root",
    _enableDisable:"Enabled (Uncheck to skip)",
    _openIDE:"Click to Open IDE",
    _adv:"Adv.",
    _advanced:"Advanced",
    _options:"Options",
    _name:"Name",
    _group:"Group",
    _alias:"Alias",
    _aliasDesc:"Split by semicolon(;) for multiple alias. like: XXX; YYY",
    _tag:"Tags",
    _features:"Features",
    _scenarios:"Scenarios",
    _ais:"AI Models",
    _com:"Components",
    _path:"Path",
    _projectId:"Project ID",
    _function:"Function",
    _request:"Request",
    _response:"Response",
    _exist:"Exist",
    _and:"and",
    _orMark:"or",
    _iLocked:"The item was checked out by you",
    _othLocked:"The item was locked by other team member. you can release it by click.",
    _update:"Updated",
    _duration:"Last run: ",
    _dataBind:"Data Bind",
    _url:"URL",
    _method:"Method",
    _property:"Property",
    _objectOrArray:"Object or Array ({} / [])",
    _object:"Object",
    _array:"Array",
    _mixed:"Mixed",
    _csv:"CSV",
    _matrix:"Matrix",
    _edit:"Edit",
    _user:"User",
    _new:"New",
    _old:"Old",
    _regex:"Regex format",
    _item:"item",
    _items:"items",
    _noItem:"No items",
    _ok:"OK",
    _done:"Done",
    _search:"Search Modules & Tests by code, tag or name ...",
    _inSearch:"In search result: {0} test cases",
    _close:"Close",
    _view:"View",
    _code:"Branch",
    _key:"Key",
    _script:"Script",
    _element:"Element",
    _aiElement:"Main step element",
    _panelElement:"Panel element",
    _formElement:"Form element",
    _tableElement:"Table element",
    _attribute:"Attribute",
    _panel:"Panel",
    _comment:"Description",
    _save:"Save",
    _class:"Class",
    _style:"Style",
    _event:"Event",
    _hideMore:"Hide options",
    _more:"More options",
    _moreItems:"More items",
    disabled:"disabled",
    _timeUnit:"Millisecond",
    _timeUnitDesc:"MilliSeconds",
    _running:"Running",
    _success:"Success",
    _stopped:"Stopped",
    _warning:"Warning",
    _error:"Error",
    _failed:"Failed",
    _skipped:"Skipped",
    _expectedFailed:"Expected Fail",
    _crash:"Critical",
    _index:"Index",
    _value:"Value",
    _title:"Title",
    _description:"Description",
    _scope:"Scope",
    _date:"Date",
    _data:"Data",
    _variable:"Variable",
    _parameter:"Parameter",
    _link:"Link",
    _status:"Status",
    _step:"Step",
    _type:"Type",
    _subType:"Sub-Type",
    _refTest:"Reference Test cases",
    _version:"Branch",
    _versions:"Branches",
    _milestone:"Milestone",
    _aiModule:"AI Model",
    _module:"Module",
    _field:"Field",
    _actionInfo:"Action Info",
    _moduleExe:"Module Executed",
    _modules:"Modules",
    _test:"Test",
    _tests:"Test cases",
    _project:"Project",
    _projects:"Projects",
    _action:"Action",
    _actions:"actions",
    _noActions:"No actions",
    _content:"Content",
    _message:"Message",
    _variableDefinition:"Variable Definition",
    _fileType:"File Type",
    _confirm:"Confirm",
    _merge:"Merge",
    _info:"Information",
    _all: "All"
  },
  _system:{
    _operation:{
      _recording:"Recording",
      _inAutoValidation:"Recording (with auto-validation)",
      _playing:"Playing",
      _pausing:"Pausing",
      _selectElement:"Select an element in the page to complete the action",
      _selectForm:"Select a form or input(select, textarea) to build a set of event actions"
    },
    _error:{
      _missingPage:"Missing APP window",
      _missingScript:"Missing script",
      _missingRequest:"Missing request",
      _missingTokenSetting:"Missing token setting",
      _cannotDelete:"Can't delete the item",
      _notApproved:"Not be approved yet.",
      _errProtectedBranch:"Not allow to delete a protected branch",
      _notAllowReviewSelf:"You cannot approve your own commit.\n\nYou can enable self-approval in branch protection view.",
      _notAllowChangeDirectly:"The current branch is protected. You cannot change the data on it directly.\n\nYou'll need to do the update on another branch and merge into the current branch.", 
      _parseParameterError:"Parse parameter error",
      _missingSettingInEnv:"Missing application URL setting in environment:",
      _tooManyResult:"Search found {0} records, only show top 500. You can add more conditions to find the target result.",
      _blockOuterExtension:"Found that you are using the Chrome extension '{0}'. \n\nIt may cause performance issues during the test. \n\nPlease temporarily disable this product",
      _pathSettingError:"Path setting error",
      _missingModuleInExpression:"The expression is incorrect! Missing module: {0}",
      _missKeyInExpressError:"The expression is incorrect! Data keyword not specified： {0}",
      _unExistVersion:"Version:{0} not exist!",
      _lostApp:"Lost app window!!",
      _lostElement:"Lost element",
      _formatError:"Format error: ",
      _formatDataIssue:"Data format issue on:\n\n",
      _importFileError:"Error importing file： {0}",
      _scriptError:"Script Data Error",
      _noSolution:"Cannot find test case to build the specified data ({0})",
      _undefinedValue:"undefined error on: ",
      _noAIModuleError:"The current Module ([{0}] {1}) is not a AI model!",
      _noRoom:"The data retention limit has been reached. If you want to store current data, please delete the previous useless data before saving.",
      _loopDependence:"The below modules have loop-dependency relationship。\n\n{0}",
      _requireAll:"All fields are required!",
      _existError:"Element exist issue!",
      _unSupportOldData:"Data format not supported",
      _ajaxFailed:"Please check the url, headers, query and body.\n\nMessage:{5}\n\nStatus: {0}\nURL: {1}\nHeaders:{2}\nQuery:{3}\nBody:{4}",
      _longTimeNoResponse:"Response taking too long!",
      _noImplement:"NOT IMPLEMENTED!",
      _envErr:"Environment number ({0}) is not right",
      _noSpecifyData:"There is not the specified data '{1}' in '{0}' module.",
      _duplicateAccountShutdown:"Account already in use (token:{0} [{1}]). Change user account or worker number. Shutting down.",
      _duplicateAccount:"Someone has logged in using your account. \n\nIf this was unexpected, please change your password and login again. Thanks\n\n<b>(The current window is going to be closed in 5s)</b>",
      _tokenAccount:"Your account has been logged in using access token. For security reason, you have therefore lost all write permissions                                                                                                                                                                                                                                                     . \nIf you want to revert to your normal permissions, you have to re-login.",
      _networkIssue:"The network connection is broken. \nPlease check your network device.",
      _poorPerformance:"Slow",
      _unexistTest:"The test case ({0}) does not exist",
      _dataUnExist:"This data no longer exists",
      _disableElement:"Cannot trigger event on a disabled element",
      _deleteAITest:"The AI generated test case ({0}) cannot be deleted!",
      _notDefinitionObj:"'{0}' is not in ai definition object",
      _loadPageFailedInFrameset:"Load page failed {0}. Maybe the reason is the application doesn't work in Dock-mode. Do you want to switch to Undock mode?",
      _requestFormatError:"The request link ({0}) is not correct. The protocol must be ({1})",
      _requestFailed:"Load file failed ({0})",
      _dataFormatError:"Data format error!",
      _failedAsDownload:"Failed as a download action! Error Info: \n\n",
      _nameFormat:"Module/Test name cannot have '.'",
      _loadPageErr:"Error when loading page: \n\n  ",
      _loadPageFailed:"Failed on page load. Error: {0}\n\n",
      _loadFileErr:"Error when loading file: \n\n  ",
      _loadResourceErr:"Error when loading resource: \n\n  ",
      _loadFileFailed:"Failed when loading file. Error: {0}\n\n  ",
      _downloadErr:"Error when downloading file: \n\n  ",
      _downloadFailed:"Failed when downloading file. Error: {0}\n\n  ",
      _missHost:"Please set APP URL",
      _errList:"Get below error:\n\n",
      _missTestWindow:"There is no testing page, or you have lost control of it. Please use BZ to open your testing page.",
      _testError:"Element is not found or syntax error exists in the code",
      _refError:"❌The target test does not exist",
      _duplicateName:"The Name, '{0}', exists or is a system key word! Please change to another name.",
      _switchCsvToObjError:"Cannot translate sub-object to CSV. Duplicate key words on {0}",
      _existKey:"The key exists already or is a system key word! Please change to another key.",
      _emptyKey:"Key/Name must not be empty!",
      _noResource:"The resource does not exist!",
      _keyFormat:"The data format is not right. Key can only include letters in upper case or lower case, numbers and underscores",
      _dataFormat:"There is a data format error!",
      _errorData:"There is an error data: ",
      _missData:"Missing data: ",
      _popWinBlocked:"Open Pop window failed! \n\nPlease make sure the browser doesn't block pop windows from the current host.\n\n<img src='{0}/img/check-pop-{1}.png'/>\n\n\n\n",
      _defaultSettingIssue:"Project default data issue: ",
      _personalSettingIssue:"Project private data issue: ",
      _missElement:"Didn't find the required element",
      _deleteCompletedData:"Unable to delete data with status Completed",
      _NoPermission:"No permission for the operation",
      _NoResource:"Your requested resource doesn't exist",
      _missingEnterPointSetting:"There is no a default APP URL setting.",
      _requiredField:"The {0} is required!",
      _replaceValue:"Replace {0} to a properly value",
      _fieldFormat:"The format of {0} is not correct!",
      _keyError:"The Key is required and it cannot be duplicate.",
      _dataUpdateByOtherError:"The data was updated/locked by other team member. \n\nPlease refresh your browser to load the current data.",
      _moveToChildError:"Cannot move parent module to child module",
      existName:"The name already exists!",
      _moveModuleOnLock:"Cannot move module {0}. It is locked by other team member.",
      _missingLoopData:"Missing test case loop data binding",
      _funDataFormatErr:"This is not a function. As function data, the format must match 'function(){......}'",
      _funDataLimitOnBZ:"As a function data, the content is not allowed including 'BZ.'",
      _funDataLimitOnUnderline:"As a function data, the content is not allowed including '_'",
      _wrongUrl:"You can only test on the current host: ",
      _saveDataError:"Store data error",
      _dataPathFormat:"Data format error. Data format can be: $test.xxx, or $test.xxx.xxx",
      _variableFormat:"WARNING! Found {0}. Please be sure it is not a variable. If it is a variable, the format should be {{{1}}}",
      _fileSizeIssue:"You can only attach files of maximum 5K file size to your project. Please select a smaller file or use request data. \n\n Note: Request data allows large files to be fetched from your application or file sharing service, like: https:/"+"/www.dropbox.com"
    },
    _info:{
      _readyRequest:"✔ In the current merge request",
      _readyCommit:"✔ In commit list",
      _missingInCommit:"⚠ In commit list, but not be selected",
      _cancelUpdate:"Do you want to cancel the update?",
      _cancelUpdateOnTemplate:"Do you want to cancel the template update?",
      _sameData:"Same data, no update.",
      _noRoomReminder:"The data retention limit has been reached",
      _confirmUpdate:"Get different data. Do you want to update?",
      _batchRefresh:"There is a batch update. Do you want to refresh IDE now?",
      _oldData:"Old Data",
      _newData:"New Data",
      _playInToken:"Running with read-only permissions",
      _secondAgo:"{0} second{1} ago",
      _minuteAgo:"{0} minute{1} ago",
      _hourAgo:"{0} hour{1} ago",
      _dayAgo:"{0} day{1} ago",
      _weekAgo:"{0} week{1} ago",
      _monthAgo:"{0} month{1} ago",
      _yearAgo:"{0} year{1} ago",
      _noOption:"There is no option",
      _updateList:"The below test cases were updated:\n\n",
      _updating:"Updating ...",
      _errorPossiblePosition:"The issue maybe at:",
      _missingToken:"Warning: Missing token",
      _noMoreAsk: "Don't ask again",
      _confirmDelete:"Are you sure you want to delete selected item(s)?",
      _upgradeRequired:"This patch requires a data upgrade.\n\nPlease click 'Start' to begin.",
      _launchApp:"After you setup application host, <br/>the testing application will launch in this window.",
      // _performanceRequest:"The below resource is taking long to respond. \nTo speed up test execution, you can add it to Settings -> Content Policy -> Ignore Request (URL).",
      _setMonitor:"After you enter monitor mode, your IDE will display the actions done by the monitored server. \n\nWhenever you want to exit the monitor mode, you just need to reload the browser. \n\nDo you want to enable monitor mode?",
      _confirmDeleteAllBookmark:"Do you want to remove all bookmarks?",
      _questionInfo:"Activating help mode. Click on highlighted or underlined functions to learn how the function works. \n\n To deactivate help mode, click the question mark icon once again.",
      _noReport:"There is no testing report. ",
      _alertSaveData:"The current data hasn't been saved yet. \n\nDo you want to save it to cloud now?",
      _inBZIDEIssue:"The feature is not supported in Boozang IDE testing",
      _requestContact:"For better support, please tell us about your contact information (name, email or phone number). Thanks!",
      _requireTitle:"Title is required",
      _demoInfo:"<div style='font-weight:bold'>Welcome to Boozang Demo Project</div><p>In this demo project, you can create modules and record test cases. You'll have access to most of the Boozang features, except to store your work on the Cloud server. \n\nIf you want to setup your own project with full features, you just need to <a href='http:/"+"/{0}/#security/signup'>sign up</a> for free. Thanks!\n\n\nEnjoy:)</p>",
      _demoLimitField:"Demo project doesn't support the feature.",
      _demoLimitData:"Your tests has been saved in your local browser storage. This demo project will allow you to create tests, but not to Save them to the Cloud server. \n\nPlease <a href='http:/"+"/{0}/#security/signup'>sign up</a> to create your own project.",
      _loadPageSuccess:"Load page success: ",
      _downloadSuccess:"Download file success: ",
      _missUpdateRef:"The below test case references were not updated:\n\n",
      _foundRef:"<span style='color:red'>NOTE</span>: Found references from the below test cases:\n\n",
      _confirmCutTest:"The operation may cause a reference update on other test cases. \nMake sure all the related test cases are not locked by other team members. \n\nIf update reference fails, you can always goto <a href='#{0}tools'>Tools</a> to do a batch update. \n\nDo you want to continue?",
      _moveModule:"{0} moved Module, {1}",
      _confirmSignOut:"Do you want to sign out?",
      _confirmReplaceAndMerge:"Do you want to replace the current value or you want to merge with current value?",
      _confirmReleaseLock:"Another member ({0}) is working on the record. \n\nDo you want to continue to release the record?",
      _workingRecordBeReleased:"Your current working record was released by other member ({0}).",
      _deleteItem:"Do you want to delete the selected item?",
      _confirmDeleteItem:"Do you want to delete item, '{0}'?",
      _confirmExit:"Do you want to revert the test case discarding local changes?",
      _dataLocked:"The data ({0}) was locked by the team member, {1}. Thanks",
      _manualLockFirst:"The data was locked by other member",
      _lockBy:"Locked by: ",
      _myself:"Myself",
      _overwriteSuccess:"The expectation value was replaced with the value from the page. Please review the test case and save it to Cloud server.",
      _outDomainWarning:"The link will open page in different domain ("+location.host+"), Boozang will lose control of the window. Do you still want to open it?",
      _confirmLeaveSrcWithoutKeep:"You have updated the source data. Do you want to keep the update in memory?",
      _missingOption:"Please select at least one option before continue",
      _missingCheckData:"There is data you haven't confirmed. Please confirm first",
      _confirmReloadPage:"The page will automatically reload after saving. \n\nDo you want to continue?",
      _fragmentRequire:"In {0}, you need use fragment to record and execute your test case. \n\nPlease see instructions in <a href='{1}'>management</a> page.",
      _installIDERequest:"The operation need you to install the Boozang AI Chrome Extension! \n\nPlease <a target='_blank' href='https:/"+"/chrome.google.com/webstore/detail/boozang-ai/bnaebcjlolajbgllgjlmlfobobdemmki'>download</a> it!",
//      _installIDERequest:"For full functionality you need to install the Boozang AI Chrome Extension! \n\nPlease <a href='javascript:BZ._installExtension()'>download</a> it!",
      _updateData:"Found data {0}. Do you want to update the data?",
      _loadDataNote:"(Note: Please be sure there is no 'ACCESS-CONTROL-ALLOW-ORIGIN' issue on the specific resource)"
    }
  },
  _method:{
    _addAction:"Add Action",
    _addPreField:"Add Pre-Field value",
    _addValidationField:"Batch add validation field",
    _addValidationItem:"Add Validation item",
    _passReview:"Approve",
    _editData:"Edit Data",
    _filterTag:"Filter by Tag",
    _checkScreenshot:"View Action Screenshot",
    _checkNewScreenshot:"View New Screenshot",
    _autoSave:"Auto Save",
    _keepLastData:"Keep last data",
    _via:"Via {0}",
    _reject:"Reject",
    _selectActionType:"Select Action Type",
    _set:"Set",
    _get:"Get",
    _viewReport:"View Report",
    _approveAndMerge:"Approve and Merge",
    _reMerge:"Re-Merge",
    _mergeInto:"Merge into '{0}'",
    _switchVersionToBranch:"Switch to branch '{0}' to Approve",
    _appReview:"Application review",
    _addNote:"Add Note",
    _done:"Done",
    // _checkConflict:"Check conflict",
    _updateConflictItem:"Update conflict item",
    _confirmDelete:"Confirm Delete",
    _setIgnoreRenderElement:"Set Ignore Element",
    _setIgnoreRequest:"Set Ignore Request",
    go:"Go",
    _commit:"Commit",
    _revert:"Revert",
    _clean:"Clean",
    _stash:"Stash",
    _stashPop:"Stash Pop",
    _loadMore:"Load More ...",
    // _stashApply:"Stash Apply",
    _stashDrop:"Stash Drop",
    _filterTest:"Filter Test/Scenario",
    _showBackup:"Show Auto-backup ...",
    _copiedText:"Copied to clipboard",
    _newTemplate:"New Template",
    _editTemplate:"Edit Template",
    _cloneTemplate:"Clone Template",
    _ref:"Ref.",
    _addItem:"Add {0}",
    _generateTemplateBaseOnThis:"Generate {1} based on current item ({0})",
    _fuzzySearch:"Fuzzy search",
    _searchReplace:"Search / Replace",
    _mail:"Send notification / bug report",
    _addField:"Add field",
    _popEditor:"Pop-up Editor",
    _setAlwaysSuccess:"Set to always success",
    _setToIfCondition:"Set as if group condition",
    _batchAddModels:"Batch add Models",
    _cleanFlag:"Remove all data-bz from APP",
    _import:"Import",
    _viewSource:"View in JSON",
    _viewForm:"View Form",
    _addScope:"Add Scope",
    _editScope:"Update Scope",
    _addGroup:"Add Group",
    _editGroup:"Update Group",
    _tryIt:"Try it",
    _play:"Play",
    _deleteTemplate:"Delete Template",
    _removeApply:"Remove the apply on the template",
    _mappingTo:"Map to",
    _mappingApiHost:"API Host Mapping",
    _rightClickToCancel:"Right click to cancel pick",
    _clickToPlay:"Click to play the action",
    _addCustomize:"Add customize input or dropdown list(css)",
    _load10:"Load +10",
    _addFlagFilter:"+ Add BZ-Attr Filter",
    _addFreeFilter:"+ Add Free Filter",
    _editRequestPreScript:"Edit Pre-Script of Request",
    _loadAll:"Load All",
    _scan:"Scan",
    _setNewName:"Set new name",
    _setNoteTodo:"Set note / todo",
    _defineParameter:"Define parameter of test case",
    _executeAll:"Execute All Cases",
    _executeRandom:"Execute a random",
    _filterResult:"Filter Result Script",
    _reviewMergeHistory:"Review merge history",
    _showAttribute:"Show BZ Attribute setting",
    _copyByClick:"To copy content by click",
    _copyElementPathByClick:"To copy element path by click",
    _newDataType:"New Module Data Type",
    _identifyScript:"Identify Status Script",
    _newModuleStatus:"New Module Status",
    _filterReq:"Filter API requests",
    _demoFillForm:"Demo fill form",
    _createField:"Create new Field",
    _mappingAlias:"Mapping name and alias",
    _saveData:"Sava data",
    _setValue:"Set value",
    _alwaysYes:"Always Yes",
    _alwaysNo:"Always No",
    _refreshText:"Automatically reset text based on positioning text method",
    _refreshTextMethod:"Automatically reset positioning text method based on text",
    _closeTaskList:"Close task result list",
    _mapElement:"Mapping Element",
    _pickAndCopyElementPath:"Pick and Copy element path",
    _addElement:"Add Element",
    _addModel:"Add Model",
    _addTest:"Add Test",
    _addSubModule:"Add Sub-Module",
    _addScenario:"Add Scenario",
    _moveDown:"Move Down",
    _moveUp:"Move Up",
    _complete:"Complete",
    _finish:"Finish",
    _insertOpr:"Insert Operation",
    _createOpr:"Create Operation",
    _autoBuild:"Auto Build",
    _insertDep:"Insert Dependent Module",
    _createDep:"Create Dependent Module",
    _addGiven:"Add Given Item",
    _addWhen:"Add When Item",
    _addThen:"Add Then Item",
    _addStatus:"Add Workflow Step",
    _addColumn:"Add Data Column",
    _addBusinessLogicDataInFlow:"Add business logic data",
    _addFlow:"Add Data Flow",
    _editFlow:"Edit Data Flow",
    _deleteFlow:"Delete Data Flow",
    _newRootCause:"New Root Cause",
    _updateRootCause:"Edit Root Cause",
    _addIgnorePath:"Ignore the Request",
    _reGenerateData:"Re-generate Module Data",
    _newGroupScope:"New Group or Scope",
    _newLanguage:"New Language",
    _analyze:"Check test cases",
    _recordRequest:"Record API",
    _stopRequest:"Stop Record API",
    _clearRequest:"Clear Requests",
    _autoMap:"Auto Map",
    _closeAll:"Close All",
    _openAll:"Open All",
    _addTicket:"Post ticket to Boozang",
    _next:"Next",
    _pre:"Prev",
    _launchAPP:"Launch APP Window",
    _showMissingItems:"Show Missing Sync Items",
    _showUpdateItems:"Show Sync Updated Items",
    _toTestCase:"Pop-up Test Case Details Page",
    _playFrom:"Play from the action",
    _newToken:"Create Token Test",
    _newAppLanguage:"New APP Language",
    _showAdvanced:"Show Advanced ...",
    _hideAdvanced:"Hide Advanced",
    // _hideSetting:"Hide Setting",
    _mapCustomizeCss:"Map Customize Component",
    _newRevision:"New Revision",
    _addDebugData:"Add data",
    _exeWithDebugData:"Execute test case with current debug data",
    _exeActionWithDebugData:"Execute from action {0} with current debug data",
    _exeCurActionWithDebugData:"Execute current action with current debug data",
    _exeRequestWithDebugData:"Use debug data to test the API",
    _lock:"Lock test-case",
    _legend:"Hide test",
    _addExtract:"Add Extract data action",
    _addRef:"Add Plug-in test",
    _addExAction:"Add Ex-Action",
    _addScript:"Add Script Action",
    _showScreenshot:"Show Screenshot",
    _hideScreenshot:"Hide Screenshot",
    _takeScreenshot:"Take a Screenshot",
    _break:"Break",
    _continue:"Continue",
    _wait:"Wait",
    _export:"Export Project",
    _importExport:"Export / Import",
    _putInClipboard:"Copy to Clipboard",
    _copyCodeInClipboard:"Copy code",
    _sort:"Sort",
    _popOutApp:"Open App Window",
    _preview:"Preview",
    _click:"Click",
    _hover:"Hover",
    _apply:"Apply",
    _defined:"Defined",
    _buildAPIActions:"Generate API",
    _ignorePath:"Ignore URL",
    _attachAPITest:"Attach",
    _replaceAPITest:"Overwrite",
    _generateValidate:"Generate API Validate action",
    _generateExtract:"Generate API Extract action",
    _clone:"Clone",
    _cloneAndAdd:"Clone and Add",
    _importAPI:"Import API",
    _importProject:"Import Project",
    _cleanUp:"Clean up",
    _batchEdit:"Batch Edit",
    _batchDelete:"Batch Delete",
    _back:"Back",
    _removeFromWorkSpace:"Remove from workspace",
    _addToWorkspace:"Add to workspace",
    _toExist:"Change To Exist",
    _check:"Check",
    _autoExe:"Auto-Merge",
    _showDiff:"Show conflict cases only",
    _overwriteAll:"Overwrite all",
    _remove:"Remove",
    _overwrite:"Overwrite",
    _init:"Initial",
    _merge:"Merge",
    _removeBranch:"Remove Branch '{0}'",
    _resolveConflict:"Resolve Conflict",
    _mergeHistory:"Merge version history",
    _updateDel:"Update version history of deleted item",
    _outputDoc:"Output Relationship Map",
    _collection:"Collection",
    _load:"Load",
    _speak:"Speak recording action",
    _noAsk:"Not Ask again",
    _retry:"Re-try",
    _toRef:"Show upstream tests",
    _analysisTest:"Check Test Case",
    _matchLink:"Match Link-Test",
    _revertHistory:"Revert to previous version",
    _continueWait:"Continue waiting",
    _addIgnoreRequest:"Set as ignore request",
    _continueTest:"Do next",
    _newForm:"[Mapping to New Form ...]",
    _addPanel:"New Panel",
    _addWorkflow:"New Workflow",
    _loading:"Loading ...",
    GET:"Retrieving ...",
    POST:"Posting ...",
    PUT:"Posting ...",
    DELETE:"Deleting ...",
    _locking:"Locking ...",
    // _resetToDefault:"Reset to standard Action Description",
    _close:"Close",
    _closeByClick:"Close by click",
    _tryPath:"Try element path",
    _tryClick:"Try click",
    _tryFillValue:"Try fill value",
    _tryFillForm:"Try fill form",
    _newWorkflow:"New Workflow",
    _editWorkflow:"Edit Workflow",
    _pickElement:"Pick element",
    _disabled:"Disable",
    _pickNameFromPath:"Pick target name from page",
    _batchCreateModule:"Batch Create Modules",
    _share:"Share",
    _switchProtocol:"Switch protocol",
    _clickEdit:"Click to enable edit",
    _dblclickRun:"Double click to load/reload testing page",
    _create:"Create {0}",
    _closePop:"Close (ESC)",
    _staticPin:"Pin on",
    _popIn:"Show in tab",
    _pinOnDetails:"Pin-on details panel",
    _pinOffDetails:"Pin-off details panel",
    _bottomDetails:"Move details panel to bottom",
    _testDetails:"Advanced test settings",
    _topDetails:"Move details panel to top",
    _hide:"Hide",
    _newAttr:"New Attribute",
    _newErgodic:"New Ergodic data",
    _saveAndGenerate:"Save & Generate Test case",
    _overWriteData:"Overwrite default data",
    _newAlias:"New Alias",
    _newTagFilter:"New Tag Filter",
    _monitor:"Monitor",
    _clearPageData:"Empty page data",
    _clearItems:"Clear Items",
    _optimize:"Optimize",
    _pick:"Pick",
    _rePick:"Re-pick",
    _generate:"Generate '{0}'",
    _newRole:"New Role (Unique Key)",
    _switchToGUI:"GUI view",
    _switchToJS:"JS view",
    _switchToDesc:"Description view",
    _switchToTable:"Table view",
    _switchToCard:"Card view",
    _switchToModel:"Model view",
    _switchToTree:"Reference Tree view",
    _deleteActions:"Delete Actions",
    _rebuild:"Re-generate",
    _fold:"Fold",
    _unfold:"Unfold",
    _removeLink:"Remove plug-in test",
    _insertTest:"Insert Test Case into {0}",
    _viewRunningAction:"View Running Action >>>",
    _autoZoom:"Auto Zoom (Ctrl/Cmd + 1)",
    _fullScreen:"Full Screen (F11)",
    _printer:"Printer",
    _zoomIn:"Zoom In (Ctrl/Cmd + Plus)",
    _zoomOut:"Zoom Out (Ctrl/Cmd + Minus)",
    _giveUp:"Ignore",
    _skip:"Skip",
    _upgrade:"Upgrade",
    _newSuite:"New Suite",
    _plugNewTest:"Plug New Test",
    _plugNewSuite:"Plug New Suite",
    _plugNewLinkTest:"Plug New Link Test",
    _plugNewScenario:"Plug New Scenario",
    _plugLinkTest:"Plug Link Test",
    _plugLinkScenario:"Plug Scenario",
    _newSubscription:"Subscribe to test report",
    _newHost:"New HOST",
    _repair:"Repair",
    _continue:"Continue",
    _applyToAll:"Apply to all",
    _continueNextAction:"Continue on Next Action",
    _disbandGroup:"Disband Group",
    _newGroup:"Add Actions to Group",
    _newGroupTest:"Generate Test case from Actions",
    _fromStepToAction:"Steps => Actions",
    _fromActionToStep:"Actions => Steps",
    _addMore:"Add More",
    _undo:"Undo (Ctrl/Cmd + Z)",
    _redo:"Redo (Ctrl/Cmd + Y)",
    _redo2:"Redo",
    _deleteParameter:"Delete Parameter",
    _execute:"Execute",
    _yesAll:"Yes on All",
    _yesAllAndCreate:"Yes on All and Create All New Data",
    _yesAndCreate:"Yes and Create New Data",
    _notAll:"No on All",
    _addHost:"Add APP",
    _deleteHost:"Remove APP",
    _deleteEnvironment:"Delete Environment",
    _editEnvironment:"Edit Environment",
    _newEnvironment:"New Environment",
    _start:"Start",
    _end:"End",
    _gotoRefTest:"Go to plug test case",
    _pass:"Pass",
    _fail:"Fail",
    _shortcut:"Make Bookmark",
    _shortcutOff:"Remove Bookmark",
    _refresh:"Refresh Data",
    _newWord:"New Word",
    _newField:"New Field",
    _deleteTest:"Delete Test Case",
    _deleteAll:"Delete All",
    _deleteSelectItems:"Delete selected items",
    _deleteCurItem:"Delete current item",
    _deleteAllActions:"Delete All Actions",
    _newElementDefinition:"New Element Definition",
    _newMember:"New Team Member",
    _newSubModule:"Create new Sub-module",
    _newElement:"Define UI Object",
    _insert:"Insert",
    _replaceInTest:"Replace In Test",
    _replaceInValue:"Replace In Value",
    _deleteEntity:"Delete Entity",
    _deleteValue:"Delete Value",
    _option:"Options",
    _new:"New",
    _add:"Add",
    _edit:"Edit",
    _updateTo:"Update to",
    _keep:"Keep",
    _keepDelete:"Keep delete status",
    _newVersion:"New Branch / Milestone",
    _newModule:"Create Module",
    _newAIModule:"Create AI Model",
    _newFeature:"Create Feature",
    _newTest:"Create Test",
    _newCom:"Create Component",
    _newAPI:"Create API Test",
    _newScenario:"Create Scenario",
    _importFeature:"Import Features",
    _exportFeature:"Export Feature",
    _newBug:"Create Bug",
    _newAction:"Append Action here",
    _newData:"Create Data",
    _yes:"Yes",
    _not:"No",
    _save:"Save",
    _saveAll:"Save All",
    _saveTmpData:"Save Temporary data",
    _publish:"Save",
    _unSave:"Save later",
    _unlock:"Unlock",
    _update:"Update",
    _delete:"Delete",
    _deleteSubItems:"Clean sub-items",
    _copy:"Copy (Ctrl / CMD + C)",
    _copy2:"Copy",
    _clickToCopy:"Click item to copy to Clipboard",
    _paste:"Paste (Ctrl / CMD + V)",
    _pasteToNext:"Paste to next row",
    _cut:"Cut (Ctrl / CMD + X)",
    _domPicker:"Dom Picker",
    _gotoManagement:"Boozang Management",
    _downloadValidationData:"Download Validation Data",
    _record:"Record",
    _pause:"Pause",
    _breakpoint:"Add breakpoint",
    _stop:"Stop",
    _cancel:"Cancel",
    _cancelSelect:"Cancel Select",
    _submit:"Submit",
    _logout:"Sign out",
    _navigate:"Navigate project tree",
    _selectAll:"Select All",
    _keep:"Keep",
    _download:"Download",
    _downloadFeature:"Download Feature",
    _keepInMemory:"Keep In Memory",
    _notKeep:"Do Not keep",
    _reset:"Revert",
    _confirmReleaseAll:"Yes, release all",
    _validate:"Validation",
    _comment:"Comment",
    _exit:"Exit",
    _filter:"Filter",
    _searchElement:"Search Elements ...",
    _search:"Search",
    _replace:"Replace",
    _replaceAll:"Replace All",
    _deleteAllValue:"Delete All Values",
    _move:"Move",
    _setEnv:"Set Environment",
    _enableLoop:"Loop over data",
    _setParameter:"(set)",
    _editParameter:"(edit)",
    _loadUrl: "URL: "
  },
  _data:{
    _mapAuth:"Mapping to Authorization setting",
    _loopData:"Loop data ($loop)",
    _testData:"Test case ($test)",
    _moduleData:"Module ($module)",
    _projectData:"Project ($project)",
    _personalData:"Personal (Overwrite shared data)",
    _filterMsg:"Filter data type: ",
    _newKey:"New Key",
    _setLoopData:"Do you want to enable loop data on current test case?",
    _deleteFile:"Will delete the upload file at the same time.",
    _nameMap:{
      element:"Element",
      event:"Event",
      expectation:"Expectation",
      content:"Content",
      script:"Script",
      description:"Description",
      type:"Type",
      name:"Name",
      tag:"Tag",
      hostId:"Host Num.",
      defParameter:"Default Parameter",
      dataMap:"Data",
      comment:"Comment",
      defaultHostId:"Default Host Num.",
      loopData:"For Loop Data"
    }
  },
  _root:{
    _exOperations:{
      _cleanUp:"Clean un-used link test cases.",
      _branchManagement:"In Branch management, you can create and delete branches. For example: create a branch based on the current branch. Similar to git, branches must be merged back from the active branch, not vice-versa.",
      _merge:"Merges another branch into current active branch. Similar to git, the active branch is only affected.",
      _outputDoc:"Output object map in different file type: HTML, PDF, WORD and MARKDOWN.",
      _importExport:"",
      _analyze:"Analyze and check all test cases data, and report issues.",
      _importOptions:{
        _export:"Export the current version/branch data to an external file. Use this for backup and new project import.",
        _importProject:"Import exported data into current project version/branch.",
        _importFeature:"Import features. It could be using text input, via file, or synchronizing from external system (Like: GitLab, GitHub, Jira, BitBucket and Azure). Set up system integration in Settings ==> Integrations.",
        _importAPI:"Automatically generate corresponding modules and API test cases by importing API file. This will also generate scenario test cases on import all APIs of the system. Support formats are: Open-API, Postman, Curl and HTTP."
      }
    },
    _dashboard:{
      _title:"Info",
      _teamOwner:"Team Owner",
      _license:"License",
      _users:"Active Users",
      _createTime:"Last Update on",
      _lastUpdateTime:"Last Update on",
      _lastUpdateUser:"Last update by",
      _member:"Member",
      _test:"Test Cases",
      _action:"Action",
      _month:"Month",
      _week:"Week",
      _lastDay:"Last Day",
      _today:"Today",
      _usageReport:"Usage Report",
      _executed:"Executed: Actions / Tests",
    },
    _modules:{
      _title:"Modules",
      _testCount:"Tests"
    },
    _features:{
      _title:"Features"
    },
    _defaultData:{
      _title:"Default Data",
      _description:"Defines project default data. \n\nThe value will be set to window.$project"
    },
    _personalData:{
      _title:"Private Data",
      _description:"Defines project user-private data. \n\nThe value will be merged and overridden window.$project."
    },
    _tools:{
      _title:"Tools",
      _description:"Import/export the current branch, search and batch operation.",
      _missImportData:"Please choose what import data is.",
      _advSearch:"Advance Search & Batch Operation",
      _team:"Team",
      _insertIntoVersion:"Insert data into current version: ",
      _insertIntoModule:"Insert data into a module: ",
      _insertIntoTest:"Insert data into a test case: ",
      _successInfo:"Success! \n\nPlease refresh page to review import data.",
      _allData:"All items",
      _fileRequested:"Please select an import file first!",
      _find:"Find what",
      _replaceWith:"Replace with",
      _scope:"Scope",
      _dataScope:"Data Scope",
      _dataName:"Data Name",
      _searchResult:"Search Result",
      _retrieveData:"Search & Retrieve data",
      _batch:"Batch",
      _importFile:"Import File",
      _case:"Match case",
      _full:"Match whole word only",
      _regex:"Regular expression",
      _match:"Match",
      _dirtyData:"Unsaved Data",
      _lockedData:"Locked Data",
      _buildTests:"Generate Test Cases",
      _confirmClearModules:"Please clear all the modules from the selected version, \notherwise, there might be a Reference Test Case issue.\n\nAre you sure you want to continue?"
    },
    _dictionary:{
      _title:"Dictionary",
      _description:"This setting identifies the user application content dictionary element. There are three kinds of elements: operations, modules, and attributes. Users can customize words.\n\t\tthe keyword cannot be duplicated and can not be the same as syntax keywords. ",
      _duplicateKey:"There are some duplicate keywords in the Dictionary setting! Please modify.",
      _similarElement:"Found similar definition in dictionary",
      _ignore:"Ignore Words",
      _options:{
        ignore:{
          _title:"Ignore words"
        },
        operation:{
          _title:"Operation",
          add:"add",
          edit:"edit",
          delete:"delete",
          view:"view details",
          enter:"Enter",
          validate:"Validate",
          preview:"preview",
          "submit":"submit",
          "execute":"execute",
          report:"report",
          cancel:"cancel",
          reset:"reset",
          search:"search",
          filter:"filter",
          next:"next",
          previous:"previous"
        },
        fun:{
          _title:"Function",
          home:"Home",
          "sign-out":"sign out",
          "sign-in":"sign in",
          "sign-up":"sign up",
          "forgot-password":"forgot password",
          "change-password":"change password",
          upload:"upload",
          download:"download",
          "export":"export",
          "import":"import"
        },
        info:{
          _title:"Information",
          success:"success",
          fail:"fail",
          error:"error",
          "confirm":"confirm",
          info:"information",
          warning:"warning"
        },
        attribute:{
          _title:"Attribute name",
          id:"id|key",
          name:"name",
          username:"user name",
          password:"password",
          "confirm-password":"confirm password",
          "old-password":"old password",
          "new-password":"new password",
          "number":"number",
          price:"price",
          value:"value",
          text:"text",
          email:"email",
          phone:"phone",
          address:"address",
          postcode:"postcode",
          role:"role",
          permission:"permission",
          common:"common",
          file:"file",
          link:"link"
        }
      }
    },
    _attributeMap:{
      _title:"Regular expressions for data generation and validation",
      _fieldMap:"Field mapping",
      _regex:"Regex",
      _usage:"Usage",
      _example:"Example"
    },
    _ergodicMap:{
      _title:"Ergodic data for fill-form action"
    },
    _dateFormat:{
      _title:"Date format",
      _outputFormat:"Output date format",
      _dateParser:"Date Parser",
      _monthShortcut:"Month shortcut (MMM)",
      _monthFullName:"Month full name (MMMM)",
      _parseOptions:{
        ymd:"Y, M and D (2020-01-31)",
        mdy:"M, D and Y (01/31/2020)",
        dmy:"D, M and Y (31/1/2020)"
      }
    },
    _bug:{
      _title:"Bugs"
    },
    _aliasManagement:{
      _title:"Test-case aliases"
    },
    _tagFilterManagement:{
      _title:"Tag Filter"
    },
  },
  _ticket:{
    subject:"Subject",
    description:"Description",
    expectedResult:"Expected Result",
    actualResult:"Actual Result",
    reproduce:"How to reproduce",
    reproduceSuggest:"Maybe you just need paste which test case I should play from to reproduce the issue.",
    issuePoint:"The location of the problem"
  },
  _aiFlag:{
    _selectScope:"Select Update Scope",
    _complete:"<h3>Completed! ({0})</h3>\nNote:No new modeling elements are found on the page. \n\nIf you know that a page is missing, you can manually browse the page and click the Continue button.",
    _handleUrl:"Parse Url Script",
    _scanApp:"Scan APP",
    _error:{
      _handleElementErr:"An error occurred while manipulating element ({0}).",
      _buildHandleUrlFunError:"Parse Url Function error",
      _handleUrlError:"Parse Url error",
      _missFlag:"Wrong use of BZ attribute, or non-existent BZ attribute.",
      _dataFormatError:"Data Format Error",
      _missImplement:"Property not implemented",
      _missKey:"Object Key is not set",
      _missModuleInPage:"The parent module setting is missing in the page",
      _missSupModule:"The parent module is not set",
      _missModule:"The current module is not set",
      _fieldError:"Field error (no appropriate field name was found)",
      _missPanel:"Panel is not set",
      _missForm:"Form not set",
      _missStepIndex:"Step number is not set",
      _missStepKey:"Step identifier is not set",
      _unExistModule:"A module that does not exist",
      _unExistOprType:"Operation type that does not exist",
      _unExistOpr:"Non-existent operation",
      _missOpr:"Operation not set",
      _missingUserName:"Missing username setting"
    },
    _tabs:{
      _new:"New Module",
      _update:"Update Module",
      _warnings:"Issues",
      _script:"Insert data-bz script",
      _setting:"Settings"
    }
  },
  _model:{
    _defStatusScript:{
      _assign:"Default script of set data status",
      _attach:"Default script of attach data status"
    },
    _validType:{
      exist:"Exist",
      unexist:"Unexist",
      disable:"Disabled",
      enable:"Enabled",
      checked:"Checked",
      unchecked:"Unchecked",
      equalInnerText:"Equals Text",
      includeInnerText:"Includes Text",
      equalValue:"Equals Input Value",
      includeValue:"Includes Input Value",
      hasCss:"Has CSS",
    },
    _validDesc:"When {0} = {1}, the element, {2}, is {3}{4}.",
    _validDesc1:"The element, {0}, is {1}{2}.",
    _errorToSetDemoValue:"Setting demo data error (No field found to set demo data).",
    _actionList:"Action List",
    _setupDemoValue:"Setup Demo Value",
    _tryAction:"1. Click to highlight the element. \n2. Double click to execute the action.",
    _tryFromHere:"Try to execute from here and below actions",
    _assignStatusScript:"Assign/Attach data status script",
    _selectUpdateFields:"Update fields",
    _statusDesc:"Note: Going through a specific process does not necessarily mean that the data status will change. After the completion of each process, the data status can be altered using a data status script.",
    _missInitModel:"Missing initial model! The model must be initialized before it can be mapped.",
    _initModel:"Initialize AI-Model",
    _neverUsed:"Never used",
    _usedBy:"Used by {0}",
    _neverUsedBy:"Never used by {0}",
    _used:"Used",
    _validItems:"Validations",
    _preSetActions:"Pre-Steps of Set value",
    _preValidActions:"Pre-Steps of Validation",
    _validationActions:"Validation Actions",
    _cssContent:"Element id, class, attributes ...",
    _pathOption:{
      _title:"Path scheme",
      _form:{
        "":"Type element path",
        view:"Data display element path",
        cur:"The element in the current panel"
      },
      _view:{
        "":"Batch validation",
        input:"Type element path",
        view:"Data display element path",
        cur:"The element in the current panel"
      }
    },
    _template:{
      _definition:"Template Definition",
      _templateContent:"Template Content",
      _underTemplate:"From template: {0}",
      _applied:"Applied",
      field:"Field",
      button:"Button",
      _templateList:"Template List",
      _refreshData:"Updates the template with the current item ({0}).",
      _applyList:"Item list of apply template({0})",
      _templateType:{
        field:"Field Template",
        button:"Button/Link Template",
      },
      _noUsedTemplate:"Unable to modify unused template.",
      _curApplyTemplate:"The template currently being used is:",
    },
    _scanForm:"Scan form",
    _openPage:"Open page",
    _openForm:"Open form",
    _enterSetting:"Enter setting",
    _applyTemplate:"Apply Template",
    _confirmReplaceToEmpty:"Are you sure you want to clear the value of {0} from selected items?",
    _outerItem:"Outer element of current panel",
    _templateDesc:"Specify an AI model as template to build models",
    _requiredMark:"Identify required field mark(css)",
    _customizeInput:"Identify customize input, dropdown list(css)",
    _formTab:"Identify form tab",
    _requiredMarkDesc:"Set the required field mark for identification to help better complete the form identification task",
    _customizeDesc: "This tool will automatically recognize custom input boxes and drop-down menus. For those that cannot be identified correctly, you can use this setting to help with form identification tasks. Users can try intelligent automatic scan first, then add omissions and scan again.",
    _formTabDesc:"Style the form tabs to help scan fields in the tabs.",
    _batchType:"Batch add model type",
    _askCreateStdModels:"Do you want to create the below models?",
    _selectModule:"Select an exist Module",
    _confirmApplyDefinitionSrc:"Do you want to overwrite the current model setting?",
    _dependenceTitle:"Dependency conditions",
    _moduleRef:"Reference",
    _autoDependence:"Auto insert dependencies",
    _advanceSrc:"Advance Setting",
    _advanceDesc:"Advance Setting in JSON format",
    _aiIdentifySetting:"AI modeling recognition settings",
    _panelName:"{0} {1}",
    _confirmScan:"A re-scan removes the existing field buttons in the form. \nAdding individual fields can be solved by adding them manually. \n\nPlease confirm whether to continue scanning.",
    _supportVE:"Validate values on the panel/form",
    _supportValidateFillForm:"Test form fill logic",
    _aiBuilderDesc:"This function requires the user application to label elements in accordance with the data-bz rule. If the labeling is correct and complete, this function will automatically complete the establishment of a series of test modules and test cases.",
    _aiBuilderScriptDesc:"If it is not convenient to use data-bz directly on the page, you can dynamically insert the corresponding data-bz value on the page through a script. And choose not to use the data-bz value to identify the element.",
    _flowFilterTitle:"Filter flow",
    _validationTest:"Validation Test Case",
    _synaModel:"Sync Module",
    _formModel:"Form Module",
    _submitTxt:"Submit|Save|Confirm|Yes|OK",
    _initData:"Initial Data",
    _dataFlow:"DataFlow",
    _baseData:"Module Data Template",
    _baseDataDesc:"The template data is useful on merging with other attribute set to build a property entity data.",
    _initDataDesc:"If current module data already exists, and it will be used, define it here",
    _dynamicData:"Dynamic Data",
    _comboFun:"  /"+"/Parameter: data is the variable of current module data. \n  /"+"/You should set the combo attribute value on it.",
    _noExit:"[No Exist!!!]",
    _result:"Result",
    _specifyElementByCss:"Specify element by CSS",
    _readonly:"Readonly in the form",
    _gotoRefModule:"Go to ref-module",
    _enterDetailsName:"{0} enter",
    _confirmDelete:"Do you want to delete the selected item(s) and the related item(s)?",
    _confirmClear:"Do you want to clear all items from the selected panel?",
    _confirmDeleteButton:"The {0} button is empty now, do you want to delete it?",
    _deleteFlowFromList:"Please select the process from which the '{0}' status needs to be removed",
    _updateRefData:"Found below modules using the data. Do you want to update all of them \n\n(from {0} to {1})?",
    _stdStatus:{
      start:"Start",
      created:"Create",
      deleted:"Delete"
    },
    _operation:{
      add:"Create {0}",
      edit:"Update {0}",
      delete:"Delete {0}"
    },
    _tabType:{
      _workflow:"Workflow",
      _summary:"Summary",
      _panel:"Panel/Page"
    },
    _panelType:{
      home:"Home Page",
      _mainModulePanel:"Main Module Panel",
      modulePanel:"Module Panel",
      dataPanel:"Data Panel",
      list:"Data List",
      table:"Data Table",
      form:"Form"
    },
    _enter:{
      _title:"Enter Point",
      _options:{
        enterModule:"Module Entry",
        enterDetails:"Details Entry"
      }
    },
    _table:{
      _title:"Table",
      _options:{
        table:"Data Table",
        list:"Data List"
      }
    },
    _panel:{
      _title:"Panel",
      _options:{
        innerPanel:"Inner Panel",
        curPanel:"Current Panel",
        table:"Data Table",
        list:"Data List",
        form:"Form"
      },
      _setting:"Panel Setting"
    },
    _button:{
      _title:"Button",
      _buttonSetting:"Button Setting",
      _launchForm:"Launch Form",
      _gotoPanel:"Final panel"
    },
    _module:{
      _title:"Module",
      _options:{
        modulesub:"Sub-Module",
        module:"Related Module",
        parentModule:"Parent Module",
        beRefModule:"Referenced by Module",
      }
    },
    _page:{
      _title:"Link",
      _options:{
        page:"Web Page",
        download:"Download"
      }
    },
    _field:{
      _title:"Field",
      _options:{
        viewData:"View data",
        outerField:"Foreign Field",
        dataType:"Module Data Type" 
      }
    },
    _subField:"Sub-Field",
    _trigger:{
      _title:"Trigger Form",
      _options:{
        submit:"Submit",
        next:"Next",
        close:"Close/Cancel",
        confirm:"Confirm",
        outopr:"Outer Module Operation",
        insert:"Add a new row button to data table",
        "ex-insert":"Add form data to data-table button (non-save)",
        "form-tab":"Form Tab"
      }
    },
    _wordType:{
      data:"Data(Current Module)",
      // relatedData:"Data(Related Module)",
      app:"APP Text"
    },
    _dependenceValueOptions:{
      "":"empty/false/null",
      "on":"true/not null",
      "undefined":"undefined"
    },
    _api:{
      name:"Name",
      method:"Method",
      contentType:"Content Type",
      url:"Url",
      headers:"Headers",
      query:"Query",
      data:"Body",
      responseScript:"Response Script",
      auth:"Authorization",
      asStdFun:{
        _title:"As a standard operation on module data",
        GET:"Initial data function",
        POST:"Standard add function",
        DELETE:"Standard delete function"
      }
    }
  },
  _module:{
    _general:{
      _title:"General",
      _missingRootURL:"Please set the module APP URL!",
      _defaultHost:"App root url",
      _startPanel:"Start method",
      _defaultAuth:"Default Role",
      _moduleLink:"Module Link",
      _linkageModule:"Auth Link module",
      _refKeys:"Reference setting",
      _pickElementDesc:"Pick element from App page and add the elements into the current panel/page."
    },
    _modules:{
      _title:"Modules",
      _testCount:"Tests",
      _newModuleDesc:"The project modules should reflect the logical entities of the application under test, to help you keep an object-oriented test approach.\n\nFor a project management application, you'll find modules like \"Authentication\", \"Projects\", and \"Tasks\".",
      _newFeatureDesc:"Features are containers that contain one or many Cucumber scenarios. A feature in Boozang simply plugs a number of scenarios, not unlike a test suite.\n\nFeature examples: \"Manage Projects\", \"Manage Tasks\", or \"Authentication\".",
    },
    _moduleAndTest:{
      _title:"Tests & Sub-modules"
    },
    _moduleGUI:{
      _title:"Module Flow Diagram"
    },
    _tests:{
      _title:"Test case list",
      _actionCount:"Actions",
      _bugDesc:"Bugs represent visual bugs. Usually they are comprised by a series of clicks and comments (in-browser annotations).",
      _comDesc:"Components could be reference from any test case, the difference with other test case type is it not report details in test report. And, it could be execute as one action.",
      _testDesc:"Tests are a collection of actions that fulfills a certain task. A test can reference any number of other tests. For re-use, it's better to combine small tests with specific purposes, than having a single long test.\n\nExamples of tests: CRUD tests, like \"Create project\" or \"Delete project\", or validation tests, like \"Validate project data\".",
      _ctrlDesc:"The control test case automatically invokes the corresponding test case according to the specified data attributes, and prepares the preliminary conditions for the execution purpose of the test case.",
      _validDesc:"The verification test case is used to verify the result of a certain test.",
      _apiDesc:"API test includes a set of api actions. It can be a standard API Test, or can work with UI actions to complete some complex tasks. \n\nFor example: user can use UI sign-in and retrieve authorization token from one request, and use the token in following API tests.",
      _suiteDesc:"A test suite defines a group of test cases to be run in a certain order.\n\nExamples \"Smoke Tests\" or \"Customer Onboarding A\".",
      _workflowDesc:"The business requirement in Gherkin syntax consists of three parts.\nGiven(pre-conditions), When (do something) and Then (validations/post-conditions).\n\nScenario outline example:\n\nGiven An empty cart. \nWhen a <product> is added to cart. \nThen The cart total should be <price>\n\nExamples:\n\n  | product | price |\n  | banana | 1.50 |"
    },
    _data:{
      _title:"Module Data"
    },
    _field:{
      _title:"Fields"
    },
    _type:{
      "":{
        _text:"Blank Module",
        _desc:"On Blank Module, user control everything, and missing some AI features"
      },
      auth:{
        _text:"Authorization",
        _desc:"If the application requires login, a wizard will be launched to create the authorization module. It will include standard sign-in and sign-out test cases. \nThis will allow for automated user switching for test steps that needs to be executed as a certain user role. "
      },
      data:{
        _text:"AI Model",
        _desc:"The AI Model allows a user to map out the module data using a page mapper. The user typically maps out CRUD operations, such as create, delete and update. After doing this, the user can construct tests using the workflow engine. \nThe AI model can have relationships with other modules."
      },
      account:{
        _text:"My Account Module",
        _desc:"My account Module handles the current sign-in user personal info"
      },
      setting:{
        _text:"Setting Module",
        _desc:"Setting Module handles the APP global parameter setting"
      },
      tools:{
        _text:"Tools Module",
        _desc:"Tools Module supports batch operation"
      },
      summary:{
        _text:"Control Module",
        _name:"Summary",
        _desc:"The Control Module will auto-generate a test suite that will trigger all scenarios in each AI Model"
      }
    },
    _sortby:{
      codeA:"ID (ascending)",
      codeZ:"ID (descending)",
      nameA:"Name (a-z)",
      nameZ:"Name (z-a)",
      updateStampA:"Last Updated (oldest first)",
      updateStampZ:"Last Updated (newest first)",
      sizeA:"Size (ascending)",
      sizeZ:"Size (descending)"
      // createStampA:"Created (newest first)",
      // createStampZ:"Created (oldest first)",
      // performanceA:"Execute time (ascend)",
      // performanceZ:"Execute time (descend)"
    },
    _contentElement:"Content Element",
    _webPage:"Web page link",
    _relatedModules:"Related Modules",
    _words:"Words",
    _parent:"Parent Module",
    _moduleLink:"Module Path",
    _batchAddPrefixModuleName:"Do you want to add prefix name, {0}, on the below modules name",
    _batchRemovePrefixModuleName:"Do you want to remove prefix name, {0}, from the below modules name",
    _newModuleName:"New Module Name",
    _newModuleAlias:"New Module Alias",
    _newModuleAliasDesc:"Alias is for data-bind",
    _newModuleFields:"New Module Fields",
    _newModuleFieldsDesc:"The first is the key field, separated by commas. For example: id,name",
    _modulesArea:"Please select Modules Area from APP page",
    _batchCreateDesc:"Create multiple Modules",
    _whatType:"Please click which Module type to you want to create",
    _batchUpdateTestName:"Do you want to base on new module name to update the name of all test cases at below?",
    _subModule:"Sub-modules",
    _curModule:"Current Module",
    _addTag:"Add tags",
    _noTag:"No tags set",
    _existData:"Edit module data",
    _noExistData:"Add module data",
    _setComment:"Add description",
    _workflow:{
      _title:"Workflow",
      _list:"Flow List",
      _type:{
        role:"Role",
        test:"Test Case"
      },
      _switchRole:"Switch to role: ",
      _runTest:"Execute： ",
      _runTestWithParameter:"Execute {0} with parameter",
      _runTestWithValue:"Execute {0} (Parameter: {1})",
    }
  },
  _setting:{
    _title:"Settings",
    _defaultSettings:"Default Settings",
    _changeBehaviorInTestSetting:"You can change the method in test case setting",
    _userTmpData:"Use temporary data",
    _asCIVersion:"Executable CI version",
    _changeProjectLanguage:"This change changes how items are recognized and resets content generation settings. \n\nAre you sure you want to make this change?",
    _useTmpDataOptions:{
      "":"Ask to use temporary",
      yes:"Auto-use temporary data",
      no:"Not use temporary data"
    },
    _tableStyle:{
      _title:"Module/Test List style",
      _options:{
        large:"Standard rows",
        middle:"Compressed rows",
        small:"Minimum rows"
      }
    },
    _actionStyle:{
      _title:"Action list style",
      _options:{
        icontext:"Show action type using text and icon",
        icon:"Show action type using icon only",
        text:"Show action type using text",
      }
    },
    _contentPolice:{
      _title:"Content Policy",
      _description:"Advanced content policy settings. Use this to customize Boozang for your specific application needs.",
      _ignore:"Ignore Classes for element selection",
      _ignorePopValidation:"Ignore validation on pop window",
      _contentAttribute:"Text Attribute",
      _appDictionary:"APP Dictionary",
      _clickableElements:"Clickable Elements",
      _loadingElement:"Identify loading status",
      _hideDataName:"Hidden data name",
      _priorityElementItems:"Priority classes for element selection",
      _monitorRequest:"Monitor Request (URL)",
      _whiteRequests:"White List",
      _blackRequests:"Black List",
      _defFailResponse:"Default Response on Action Failed",
      _filters:"Filter Policy",
      _contentId:"Data",
      _contentDate:"Date",
      _contentTime:"Time",
      _hiddenAsUnExist:"Treat hidden elements as not existing by default",
      _disableAutoOneAction:"Disable batch action execution (increases test execution time)",
      _aiControlAction:"Wait on API requests to complete for each action",
      _aiControlActionRetry:"Smart retry of missing element",
      _completeActionOnRender:"Action waits until page render is completed",
      _ignoreRenderElement:"Ignore Render Element",
      _ignoreRenderElementDesc:"The purpose of setting \"Ignored Render Elements\" is to ignore detecting certain elements that undergo continuous changes over time, thus avoiding slowing down the test or preventing the test from completing.",
    },
    _contentPoliceHelp:{
      _monitorRequest:"The purpose of specifying ignore requests is \nto avoid certain non-core data requests \nthat cause long waits during testing.",
      _ignoreRenderElement:"The purpose of setting \"Ignored Render Elements\" is \nto ignore detecting certain elements \nthat undergo continuous changes over time, \nthus avoiding slowing down the test or preventing the test from completing.",
      _ignore:"List of classes that should be ignored in the element selection. \n\nWildcard character (*) is supported.",
      _priorityElementItems:"List of classes that should be prioritized when selecting elements. \n\nWildcard character (*) is supported.",
      _contentAttribute:"Attributes used for text representation, \nused in a similar fashion to title. ",
      _clickableElements:"To specify what's kind of element is clickable. \n\nThe default is: A, Button",
      _loadingElement:"Identify that the page is still loading using element CSS or scripts. \n\nIf a loading element is matched, \nBoozang will automatically wait for it to disappear.\n\nIdeal to set if the application has a loading spinner.",
    },
    _contentGeneration:{
      _title:"Content Generation",
      _description:"You can define regular expressions in the content generation settings to generate data and set the Cucumber syntax for auto-generated tests.",
      _help:{
        _ergodic:"Ergodic data is used to automate form fill tests.",
        _attributeContent:"A list of regular expressions used for data matching and data generation.\n\n Use /BZ-RegexpName/ to generate data based on the expression,\n and use /"+"/BZ-RegexpName/"+"/ for validations.",
        _sentences:"Used to auto-generate readable Cucumber tests \ninside the AI model.",
        _dateFormat:"Date format for date generation and identification."
      },
    },
    _environment:{
      _title:"Environment",
      _name:"APP",
      _solution:"Environment",
      _curEnvironment:"Current Environment",
      _enableAuthSetting:"Enable AI authorization",
      _mappingAIFlag:"Build AI Modeling",
      _authSetting:"Authorization Settings",
      _enableAuth:"Enable AI Authorization (Sign-in / Sign-out)",
      _benefitAuth:"Note: After enabling AI Authorization, you will get the below benefits:\n\n"
                  +"1. The tool will assist in generating a set of Authorization test cases. Like: Sign-in, Sign-in API, Sign-out, Sign-out API, Retrieve API Token and Check all test cases suite. \n"
                  +"2. Auto generate 'Sign-in status to ' test case, which switches role based on the parameter sent\n"
                  +"3. Through Retrieve API Token test case, the tool can retrieve realtime token for api test request, and merge the token data into API Request headers automatically.",
      _missingHostError:"Each App URL is required",
      _missingNameError:"Each App name is required",
      _dataURL:"API Root",
      _auth:"Authentication",
      _host:"Domain",
      _shareOptions:"Share Options in different hosts",
      _defaultRoot:"Domain",
      _noHostError:"Domain is required!",
      _minSolutionLimitation:"At least one environment is needed",
      _name:"Name (ex. development, qa, staging)",
      _appUrl:"Application URL",
      _openMethod:"Open/Refresh Method",
      _open:"Load window",
      _href:"Set URL",
      _appName:"APP Name",
      _addUrl:"Add additional application URLs",
      _description:"Boozang supports multiple environments (ex: default, staging and production) and different application interfaces (ex: mgmt, storefront).",
      _errHostFormat:"One APP URL format is not correct. The correct format is: http:/"+"/xxx or https:/"+"/xxx"
    },
    _preferences:{
      _title:"Preferences",
      _reportDetails:"Output all actions report",
      //_timeMode:"Timing mode",
      _completeTime:"Complete time",
      _waitTime:"Waiting time",
      _ignorePoorPerformance:"Ignore performance issue",
      _asFailOnPerformance:"Report slow actions as fail",
      _asWarningOnPerformance:"Report slow actions as warning",
      _popWindowStyle:"Pop Window Style",
      _autoSize:"Adaptive window size",
      _popSizeOptions:"Popup App window size options",
      _sizeFormat:"Format: %, width, width x height",
      _customizeSize:"Customize size",
      _performanceReminder:"Report slow action threshold (ms)",
      _maxRequestTime:"Max wait for pending requests",
      _loadPageTime:"Max wait for loading page",
      _apiProxy:"API Proxy",
      _apiProxyDesc:"It is for the testing api doesn't support cross-domain",
      _expectReactionTime:"Default action timeout (ms)",
      _stepDelay:"Default interval time between steps (ms) (ms)",
      _description:"User preferences. Environment-specific settings can be found under the environment tab.<br/>Settings will only apply to your user. Other users will be unaffected by this change.",
      // _autoAIValidation:"Auto insert AI Validation",
      // _ignoreAIValidateArea:"Ignore Area in AI Validation",
      _autoDataBind:"Auto data bind",
      _disableShadowRootRecording:"Disable recording on shadow-root element",
      _autoMergeToSetValue:"Auto-merge dropdown click actions to single set action",
      _ignoreAlertLoadFileError:"Disable alerts for Load File Errors",
      _noAlertAIRepire:"Disable alerts for AI Repair (on test execution error)",
      _noAutoFocus:"Disable auto focus (NOTE: Some input action need auto focus to avoid execution fail)",
      _acceptMonitor:"Accept to be monitored",
      _debugOneAction:"Click to disable rapid action execution on playback",
      _switchToOneAction: "Click to enable rapid action execution on playback",
      _speakOnRecording:"Audio-assisted recording",
      _infoRunningTest:"Display action info on running or recording",
      _outputActionReport:"Display action details in report",
      _cooperator:"As Cooperation Server",
      _reqCooperator:"Require cooperation test",
      _defaultRole:"Default Role",
      _defaultRoleDesc:"Personal setting for debugging"
    },
    _record:{
      _title:"Recording Events",
      _listenEvents:"Events",
      _moveStep:"Mousemove step",
      _description:"Set which browser events should be captured when using recording function. <br/><br/>Settings will only apply to your user. Other users will be unaffected by this change.",
    },
    _domFinder:{
      _title:"Dom Strategy",
      _description:"The Dom Strategy decides how html document elements are captured in the DOM tree when recording. This setting will affect how a test is represented and therefore if a test can be uniquely replayed.<br/><br/>Settings will only apply to your user. Other users will be unaffected by this change.",
      _catchId:"Id",
      _catchFirstId:"First",
      _catchMutilId:"Multi",
      _ignoreIdFormat:"Ignore Id format in regex. (e.g. [0-9])",
      _catchClass:"Class",
      _catchLastLevelClass:"Catch last Level Class",
      _catch:"Catch",
      _ignoreClasses:"Set Ignoring Classes. (e.g. ng-untouched, ng-valid, ng-dirty, ng-valid-parse)",
      _catchAttr:"Attribute",
      _catchFirstAttr:"First",
      _catchMutilAttr:"Multi",
      _catchContains:"Contains text",
      _autoValidationArea:"Dom",
      _catchParentClass:"Parent Class",
      _catchFirstClass:"First",
      _catchMutilClass:"Multi",
    },
    _validationIgnore:{
      _title:"Validation Ignore",
      _description:"This is the default setting of which elements should be ignored when creating a new validation for the BZ format. Any changes in the action view for each test will override this value. <br/><br/>Settings will only apply to your user. Other users will be unaffected by this change."
    },
    _subscription:{
      _title:"Notifications",
      _server:"Server host",
      _options:"Content of Report",
      _option:"Email {0} report to {1}"
    },
    _monitorLog:{
      _title:"Monitor Cucumber Report Content",
      _filterDesc:"Filter key words and support Regex (Format: /xxxxx/)",
      _emailContent:"Email content",
      _attachScreenshot:"Attach screenshot"
    },
    // _identificationTask:{
      // _title:"Task Info"
    // },
    _objectLib:{
      _title:"Element Definition",
      _routes:"Routes",
      _selectRoute:"There are multiple Routes. Please select which one is you want.",
      _description:"This setting identifies user application object elements. There are five types of elements: element, component, operation, status, and business. A user can customize an element keyword or add a new element. \nNote: \n\t\tKey words are case-insensitive. \n\t\tthe keyword cannot be duplicated and can not be the same as syntax keywords. ",
      _similarElement:"Found similar match in Element Definition",
      _identifyCss:"Identify CSS for {0}",
      _duplicateKey:"There are some duplicate keywords in the Object Lib setting! Please modify.",
      _options:{
        element:{
          _title:"Element",
          button:"button",
          link:"link",
          input:"input",
          dropdownList:"dropdown list",
          textarea:"textarea",
          checkbox:"checkbox",
          radio:"radio",
          file:"file",
          mainHeading:"main heading",
          subHeading:"sub-heading",
          panel:"panel"
        },
        message:{
          _title:"Message",
          missData:"miss required data",
          dataType:"wrong data type",
          tooLong:"data size too long",
          tooShort:"data size too short",
          dataFormat:"wrong data format",
          dataLocked:"data locked",
          noResponse:"no response from server"
        },
        component:{
          _title:"Component",
          rangeSlider:"Range Slider",
          dropdownInput:"Dropdown input",
          dragInput:"Drag input",
          checkbox:"Checkbox",
          radio:"Radio"
        },
        operation:{
          _title:"Operation",
          add:"create",
          edit:"modify",
          "delete":"delete",
          attach:"attach",
          archive:"archive",
          view:"view/details",
          enter:"enter",
          preview:"preview",
          "submit":"submit",
          execute:"execute",
          report:"report",
          "confirm":"confirm",
          close:"close",
          cancel:"cancel",
          reset:"reset",
          search:"search",
          next:"next",
          previous:"previous"
        },
        fun:{
          _title:"Function",
          home:"Home",
          "sign-out":"sign out/logout",
          "sign-in":"sign in/login",
          "sign-up":"sign up/register",
          "forgot-password":"forgot password",
          "change-password":"change password",
          download:"download",
          "export":"export",
          "import":"import"
        },
        status:{
          _title:"Status",
          active:"active",
          highlight:"highlight",
          required:"required",
          error:"error",
          warning:"warning",
          success:"success",
          waiting:"waiting"
        },
        business:{
          _title:"Business Logic Object"
        }
      },
      _data:"Data",
      _relatedFields:"Fields",
      _dependence:"Dependencies",
      _moduleDataType:"Module Data Type",
      _dependenceType:{
        operation:"Operation",
        data:"Data"
      },
      _validFillFormOptions:{
        _reopenForm:"Reopen form from action",
        _fillRequired:"Fill required fields",
        _setupPreFields:"Set field value",
      },
      _valueTab:"Value",
      _reference:"Reference",
      _errType:"Error Type",
      preSteps:"Pre-Steps",
      endSteps:"End-Steps",
      entrySteps:"Entry-Steps",
      mainStep:"Main-Step",
      othSteps:"Other-Steps",
      _validFillform:"Fill Form Validations",
      _script:"Script",
      _validScript:"Validation Script",
      _preScript:"Pre script",
      _loopScript:"Repeat script",
      _endScript:"Result script",
      _handleParameter:"Parameter handler ($parameter)",
      _handleData:"Final data handler",
      _auth:"Authentication",
      _validation:"Validation",
      _action:"Actions",
      _option:"Options",
      _searchFieldMap:"Search Fields",
      _batchUpdate:"Batch update",
      disable:"Disable",
      path:"Element path",
      action:"Action",
      option:"Option",
      fakeElement:"Fake Element",
      _field:{
        _title:"Field",
        _setting:"Field Setting",
        name:"Name",
        alias:"Alias",
        data:"Bind Data",
        subtype:"Sub-type",
        ergodic:"Ergodic checking",
        defValue:"Default Value of the form",
        demoValue:"Demo Value",
        type:"Type",
        inputFormat:"Input Format",
        outputFormat:"Output Format",
        combFormat:"Comb format",
        displayFormat:"Display Format",
        dependencies:"Dependencies",
        key:"Key",
        label:"UI Value",
        unique:"Unique",
        required:"Required",
        _inputFormatDesc:"Set input format, like: /[a-z]+/",
        _outputFormatDesc:"1. This is for validation, if output is the same as input, not need to set it.\n2. base on $parameter to get data",
        _combFormat:"Comb with multiple fields",
        _valueTypeTitle:"Value Type",
        _valueType:{
          0:"Empty (false/null/uncheck)",
          1:"Not empty (on/true/not null/check)",
          "==":"=",
          ">":">",
          "<":"<",
          ">=":">=",
          "<=":"<=",
          "!=":"!=",
          "regex":"match(Regex)",
          script:"Script"
        },
        _targetType:{
          "[false]":"Empty/Null/False",
          "[true]":"No empty/No null/True",
          "[enable]":"Editable/Enable"
        },
        moduleRelationship:"Relationship Type",
        _relationships:{
          ref:"Reference",
          include:"Include",
          dependency:"Dependencies"
        }
      },
      _page:{
        _title:"Page",
        name:"Name",
        alias:"Alias",
        type:"Type",
        page:"Page",
        path:"Path",
        scope:"Scope",
        level:"Level",
        word:"Word",
        form:"Form",
        url:"Page link",
        preFilter:"Pre-filter",
        preFilterArea:"Pre-filter area/element",
        selector:"Multiple Selector",
        afterSearch:"After Search enter details page",
        _confirmMsg:"Validate confirm message",
      },
      _pageType:{
        home:"Home page",
        module:"Module home page",
        exModule:"Module Ex-page",
        parent:"Parent Module home page",
        parentDetails:"Parent Module Details",
        parentExDetails:"Parent Module Ex-Details",
        parentAddForm:"Parent Add Form",
        parentEditForm:"Parent Edit Form",
        details:"Details page",
        exDetails:"Extra Details",
        any:"Any page"
      },
      _relatedModuleSetting:"Related Module Setting",
      _switchToOperation:"Switch to operation",
      _switchToWebLink:"Switch to Module/Web page",
      _switchToTrigger:"Switch to Trigger event button",
      _askSwitchToOperation:"Do you want to switch <b>{0}</b> to operation?",
      _askSwitchToWebLink:"Do you want to switch <b>{0}</b> to web link?",
      _askSwitchToTrigger:"Do you want to switch <b>{0}</b> to trigger event button?",
      _form:{
        _title:"Form",
        add:"Create form",
        edit:"Edit form",
        search:"Search form",
        exe:"Process form"
      },
      _operation:{
        _setting:"Operation Setting",
        _title:"Operation",
        page:"Page type",
        _area:"Area",
        _level:{
          module:"Module",
          data:"Handle Single Data",
          multiple:"Handle Multiple Data"
        },
        _confirmPlaceholder:"Format: message or in regex"
      },
      _content:{
        _setting:"Content setting",
        _cleanSteps:"Do you want to clean the current steps?"
      },
      _missPath:"Missing element path",
      _dependenceDesc:"Specify dependent data, like:\nXXXX.checked",
      _toggle:"Toggle",
      _panel:"Main Panel",
      _clear:"Clear button",
      _value:"Retrieve value",
      _objTitle:"Title",
      _header:"Header",
      _ctrlPanel:"Control Panel",
      _row:"Row",
      _col:"Col",
      _paging:"Paging",
      _item:"Item(s)",
      _missPanel:"Please set the component panel first.",
      _missFormat:"Please set the component value format first. (Ex.: $1, $1-$2)",
      _selectMark:"Please select the best css to specify the target element",
      _recordSteps:"Record Steps",
      _supportMSCooperationTest:"Need to perform tandem test tasks",
      _supportMSCooperationTestDesc:"If certain functions need to be executed on a specific server, \nyou need to enable this function.",
      _customizeInputs:"Customize Input Component",
      _missCloser:"Didn't find clean button",
      _valueFormat:"Value Format",
      _valueFormatDesc:"Ex. 100 -> $1, 10:30 -> $1:$2, 2019-03-21 -> $1-$2-$3",
      _name:"Name",
      _type:"Type",
      _path:"Element Path",
      _showSource:"Show Source Data",
      _showDefUI:"Show form UI",
      _fields:"Fields",
      _element:"Element",
      _selectors:"Selectors",
      _operationType:"Operation Type",
      _wordSetting:"Word Setting",
      _confirmElementWord:"Words definition",
      _confirmElement:"Elements definition",
      _moduleData:{
        // noData:"No Data",
        dataSize:"Data size",
        // onlyOne:"Only one piece of data",
        // least2:"At least 2 pieces of data",
        // noRef:"No reference to current module data",
        // hasRef:"Reference to current module data",
        specialData:"Specific field value"
      },
      _dataType:{
        string:"String",
        text:"Text",
        boolean:"Boolean",
        enum:"Enum",
        array:"Array",
        date:"Date",
        number:"Number",
        decimal:"Float",
        module:"Module",
        viewData:"View data",
        combo:"Combo data",
        object:"Object (data structure)",
        file:"File",
        fake:"Fake"
      }
    },
    _integration:{
      _title:"Integrations",
      _description:"The integration tab includes alias, notifications and feature file synchronization. "
                  +"\nThe alias allows you to create a shortcut to any test.",
      _help:{
        _alias:"Use alias to create short-cuts to tests. \n\nAll aliases are URL accessible.",
        _notifications:"Set up email notifications.\n\nTest reports will be emailed to you.",
        _monitor:"Monitor test reports for certain keywords (via email).\n\nSupports regular expressions.",
        _feature:"Load your Cucumber feature files into Boozang. \n\n Xray, GitHub, GitLab, and BitBucket\nare supported integrations.",
        _upload:"Integration for outgoing reports.\n\nContact Boozang support to activate.",
        _tagFilter:"Set up tag filters to specify which test cases to execute in the test suite."
      }
    },
    _alias:{
      _title:"Aliases",
    },
    _businessType:{
      module:["","Settings","Account","Tools","Data","Group"],
      test:["Add","Attach","Edit","Delete","Archive","Execute","Other"]
    },
    _service:{
      _title:"Service",
      _description:"Boozang supports user to take screenshots, email and TR Report system.",
      _trService:"TR Report",
      _emailService:"Email Service",
      _screenshotService:"Screenshot Service",
      _testService:"Testing Report Service",
      _server:"Server host",
      _note:{
        _trService:"Note: Boozang supports customers to automatically generate Trouble Reports. If you want to have this feature activated contact  Boozang support.",
        _screenshotService:"Note: If you want the screenshot service feature contact Boozang support.",
        _testService:"Note: If you want this feature contact Boozang support. ",
        _emailService:"Note: If you want the feature contact Boozang support.",
      }
    },
    _fragment:{
      _title:"Fragment"
    }
  },
  _templates:{
    _title:"Templates",
  },
  _commits:{
    _title:"Commit",
    _message:"Comment",
    _chkVersionOnly:"View only content at commit time",
    _chkDiff:"Compare to current content",
    _deletedFromProject:"The data has been deleted from the current branch or has not been merged yet.",
    _noPreCommit:"There are no longer commit comparison updates",
    _searchTest:"Search test case and related test case",
    _completePostRequest:"Merge request sent for review as target branch is protected.\n\nPlease approve it from merge request list.",
    _status:{
      completed:"Completed",
      approved:"Approved",
      waiting:"Waiting",
      rejected:"Rejected",
      deleted:"Deleted",
      conflict:"Conflict"
    },
    _notes:"Notes",
    _contentList:"Content List",
    _conflictInfo:{
      _deletedItem:"Deleted",
      _existItem:"Exist",
      _updateItem:"Updated",
      _message:"There are items that were updated after the merge request was created. Please reject and merge the conflicting items in the source branch."
    },
    _withoutCommit:"Without commit",
    _mergeOn:"Merge on branch: {0}",
    _compareAndMerge:"Compare / Merge Data",
    _backRoot:"Back to root",
    _inWaiting:"In a merge request",
    _currentBranch:"Current branch",
    _scope:{
      current:"Current branch",
      all:"All branches"
    }
  },
  _ciSetting:{
    _title:"CI",
    _parameterOf:"Parameter ({0})",
    _localized:"Enable Localized Server",
    _localizedDesc:"Control socket center IP",
    _singleWorker:"Single worker",
    _multipleWorker:"Multiple workers (parallel tests, start worker index at: 1)",
    _numberOfWorkers:"Number of workers",
    _generateCIUrl:"Generate CI Link",
    _generateSchedule:"Generate Schedule",
    _generate:"Generate",
    _listTitle:"Execution worker list",
    _refreshCoopTime:"Auto refresh info in",
    _worker:"Worker",
    _workerScope:"In test scope workers",
    _schedule:"Schedule",
    _outputFormat:"Output format",
    _exServer:{
      "":"CI links",
      jenkins:"Get Jenkins config",
      docker:"Docker standalone",
      gitlab:"GitLab CI config",
      node:"Node / NPM config",
      github:"GitHub actions config",
      microsoft:"Microsoft Azure",
      circle:"Other CI servers"
    }
  },
  _log:{
    _title:"Reports",
    _exeSingleActionGroup:"Action (in Single action group)",
    _screenshotOnFail:"On fail",
    _curReport:{
      _title:"Test Report",
      _titleWithProjectName:"{0} test report",
      _time:"Test time: {0}-{1}-{2} {3}:{4}:{5}",
      _account:"Test account: {0}",
      _testedApp:"Tested APP: {0}",
      _index:"Index",
      _type:"Test type",
      _content:"Test Content",
      _count:"Test case count",
      _typeOptions:{
        _fun:"Functional Automation Test",
        _performance:"Performance Test",
        _form:"Form field Validation Test"
      },
      _scope:{
        _title:"1. Test Scope",
        _desc:"The test scope includes： {0}.",
        _detailRef:"The test content details："
      },
      _result:{
        _title:"Test result",
        _type:"Success / Failed",
        _total:"Total",
        _funFail:"Functional Automation Tests, {0}. Failed, {1}, They are: {2}. Reference the details on attachment-1.",
        _funSuccess:"Functional Automation Tests, {0}. All passed. Reference the details on attachment-1.",
        _performanceFail:"Performance Tests, {0}. Failed, {1}, They are: {2}. Reference the details on attachment-2.",
        _performanceSuccess:"Performance Tests, {0}. All passed. Reference the details on attachment-2.",
        _formFail:"Form field data validations: {0}. Failed, {1}, They are: {2}. Reference the details on attachment-3.",
        _formSuccess:"Form field data validations: {0}. All passed. Reference the details on attachment-3.",
      },
      _conclusion:{
        _title:"Test conclusion",
        _desc:"After the {0} of {1}, the test result is:",
        _funSuccess:"1, The functions were implements as the same as the requirement.",
        _funFail:"1, There are some functions were not the same as requirement.",
        _performanceSuccess:"2, The performances are all less than {0}s. All the response are in normal.",
        _performanceFail:"2, There are some response time is longer than {0}",
        _formSuccess:"3, The validated form fields are all in expectation",
        _formFail:"3, There are some form fields validation are not normal",
      },
      _attachment:{
        _requestList:"Requests",
        _index:"Index",
        _funName:"Name",
        _failedStep:"Failed step",
        _step:"Steps",
        _exe:"Exe/Un-exe",
        _pass:"Passed/Failed",
        _performanceName:"Name",
        _dataCount:"Data count",
        _formName:"Name",
        _issueData:"Exception data",
        _logic:"Violation of the verification rules",
        _responseTime:"Response Time",
        _spendTime:"Spend Time",
        _funTitle:"Attachment-1: Functional Automation Test",
        _funDesc:"Execute functional automation test results:",
        _funFailSteps:"Cause failed steps are:",
        _performanceTitle:"Attachment-2: Performance Test",
        _performanceDesc:"Performance Test results:",
        _performanceFailDetails:"Longer than {0} seconds responses are:",
        _formTitle:"Attachment-3: Validation of form fields Test",
        _formDesc:"Validated form fields are：",
        _formFailDetails:"Unexpected form fields are："
      }
    },
    _keptReport:{
      _title:"Saved Report"
    },
    _search:{
      user:"Operator",
      from:"From",
      to:"To"
    },
    _report:{
      _failedAt:"Failed at: ",
      _dataIdx:"Data Index",
      _dataIdxDesc:"Note: the index start from 0",
      _title:"Test Reports",
      _start:"Send request time",
      _searchRequestLog:"Search Request Log",
      _actions:"Actions",
      _tests:"Tests",
      _forms:"Forms",
      _requestTime:"Request Time",
      _exeActions:"Executed Actions",
      _refreshScreenshot:"Before refresh",
      _orgImg:"Original",
      _failedAction:"Failed action",
      _failedActions:"Failed Actions",
      _performances:"Request Actions",
      _failedPerformances:"Slow request actions",
      _lastResult:"Last Result",
      _form:"Form Data",
      _failedForm:"Failed Form Data",
      _time:"Time",
      _operation:"Operation",
      _operator:"Operator",
      _viewTreads:"Check result trends",
      _info:"Info",
      _requests:"requests",
      _requestBlockingIssue:"There is request blocking testing issue:\n\n",
      _longRequestIssue:"Long waiting request:\n",
      _newRequestIssue:"New request:\n",
      _diff:"Diff",
      _defTitle:"Test Result",
      _period:"Time",
      _check:"View",
      _result:"Result",
      _exeTime:"Execution Time",
      _repTime:"Response Time",
      _extraInfo:"Extra Info",
      _viewAction:"View Running Action",
      _callSelf:"{0} (Call self)",
      _inLoop:"{0} (Loop: {1})",
      _loadFrom:"Be loaded from",
      _performance:"Slow Actions",
      _unExpect:"Unexpected",
    //  _autoDownload:"Auto-download Reports",
      _autoSave:"Auto-save Test result",
      _requestDetails:"Requests",
      _stateCode:"State code",
      _showRequestDetails:"Record requests details and enable performance report",
      _failedOnAction:"Failed on Action: ",
      _searchType:"Search content",
      _trends:{
        _performance:"Total Performance",
        _dataPerformance:"Iteration performance",
        _iterationTrends:"Iteration Trends",
        _summary:"Aggregate Results",
        _average:"Average (iteration)",
        _average1:"Average",
        _startTime:"Start time",
        _runUnit:"Test Run",
        _iterationUnit:"Test iterations",
        _time:"Time",
        _idx:"Index",
        _last:"Last Result",
        _lastTime:"Last usage time",
        _module:"Module / feature",
        _test:"Test / Scenario",
        _result:"Result",
        _executeTime:"Execution Time",
        _percentile:" Percentile",
        _mean:"Mean",
        _max:"Max"
      },
      _options:{
        history:"Test Result Record",
        request:"Request history",
        trends:"Trends",
        operation:"Operation Log",
        fd:"Function Details Log",
        fs:"Function Summary Log",
        pfd:"Performance Details Log",
        lt:"Load Testing Summary",
        rup:"Ramp-Up",
        report:"Summary Report"
      },
      _shortReportName:{
        fd:"Function",
        pfd:"Performance",
        lt:"Load Testing",
        rup:"Ramp-Up",
        report:"Summary"
      },
      _postData:{
        _title:"Upload Report Data to specific Server",
        _format:"Data Format",
        _options:{
          jk:"Cucumber Report",
          as:"Request Action Execute List",
          rs:"General Result Data"
        },
        _target:{
          server:"Sent data to Server",
          console:"Console output"
        },
        _text:"{0} for {1}"
      },
      _loadTesting:{
        _times:"Times",
        _totalRequests:"Total Requests",
        _totalDuration:"Total Duration(ms)",
        _accumulatedTime:"Accumulated Request Time(ms)",
        _concurrentTime:"Concurrent Request Time(ms)",
        _maxDuration:"Max Duration(ms)",
        _minDuration:"Min Duration(ms)",
        _evenDuration:"Avg. Duration(ms)",
        _url:"URL",
        _method:"Method",
        _detailsInfo:"Settings: {0} Times, {1}, Launch period: {2}",
        _immediately:"Immediately",
        _every:"Time/{0}",
        s:"s",
        m:"min"
      }
    },
    _info:{
      _title:"Events & Messages",
      _lockedProjectData:"{0} locked project data.",
      _releasedProjectData:"{0} released lock from project data.",
      _updateProjectData:"{0} updated project setting data",
      _lockedModule:"{0} locked module, {1}",
      _releasedModule:"{0} released lock from module, {1}",
      _newModule:"{0} added new module, {1}",
      _updateModule:"{0} updated module, {1}",
      _deleteModule:"{0} deleted module, {1}",
      _lockedTest:"{0} locked test case, {1}",
      _releasedTest:"{0} released lock from test case, {1}",
      _newTest:"{0} added new test case, {1}",
      _newCom:"{0} added new component, {1}",
      _updateTest:"{0} updated test case, {1}",
      _deleteTest:"{0} deleted test case, {1}",
      _login:"{0} login",
      _logout:"{0} logout",
      _trReport:"{0} reported a new TR",
      _trComment:"Comment success",
      _coopStatus:"Coop-Status",
      _stopByContainer:"stopped by container",
      _getVideo:"Received video request",
      _saveVideo:"Saved video file",
      _longTimeNoResponse:"Long time no response. Stop task",
      _clearTask:"clear task at beginning",
      _retrieveToken:"Retrieve token",
      _noResponseFromAPP:"Warning! No response from app window. Going to reset APP window.",
      _newData:"New Data",
      _endNewData:"End New Data",
      _hasErrOnAction:"Has problem on action",
      _noCucumber:"Cucumber report was not generated as no scenarios were run!",
      _completeTopLevelTest:"Completed top-level test case",
      _coopWorker:"Coop-Worker",
      _addCoop:"Join worker",
      _removeCoop:"Remove worker",
      _failedTest:"failed test",
      _nextTask:"Next schedule at",
      _logTimeoutInMs:"timeout in ms",
      _remoteEnd:"Remote",
      _loadItem:"Loading",
      _end:"End",
      _sentEmail:"Sending out email notifications",
      _initFailed:"Initial data failed",
      _chkErrPage:"Check error page",
      _stopOnCrashAction:"Stopped Test Task",
      _noMoreAction:"No more action, task complete!",
      _stoppedByBZStop:"stopped by bz-stop flag",
      _loadErr:"Load page error",
      _loadingApp:"Loading App window ...",
      _downloadingFile:"Downloading file ...",
      _errPageOnApp:"Error info on APP: ",
      _checkingPopup:"Checking popup (alert/confirm/prompt/onbeforeunload) ...",
      _loadingRequest:"Running loading request: ",
      _loadToken:"Retrieve token ...",
      _waitingAppRequest:"Waiting APP API request ...",
      _retryLastAction:"Retry last action ...",
      _waitingElement:"Waiting the target element appear ..."
    },
    _operation:{
      _type:{
        add:"add",
        update:"update",
        delete:"delete",
        signin:"signin",
        signout:"signout",
        exe:"exe",
        auto:"auto",
        revert:"revert",
        stash:"stash",
        stashPop:"stash Pop",
        stashDrop:"stash Drop"
      },
      _scope:{
        project:"project",
        version:"version",
        module:"module",
        test:"test",
        config:"config"
      },
      _result:{
        success:"success",
        failed:"failed"
      }
    }
  },
  _account:{
    _title:"Account",
    _profile:{
      _title:"Profile",
      _description:"Edit your account information.",
      name:"Name",
      phone:"Phone",
      fax:"Fax",
      cell:"Cell",
      email:"Email",
      address1:"Address 1",
      address2:"Address 2",
      city:"City",
      state:"State / province",
      country:"Country",
      postCode:"Post Code / Zip",
      language:"Language",
      role:"Role",
      _permissions:"Permissions"
    },
    _usage:{
      _title:"Data Usage",
      _description:"Check your data usage",
      _versions:"Branches",
      _modules:"Modules",
      _tests:"Tests",
      _dataSize:"Data Size",
      _remaining:"Remaining",
      _exeAction:"Total actions executed"
    },
    _billing:{
      _title:"Billing",
      _plan:"Plan",
      _promoCode:"Promo Code"
    },
    _permissionActions:{
      _readEntity:"View Details",
      _readList:"View List",
      _add:"Add",
      _update:"Modify",
      _delete:"Delete",
      _sysManage:"System Management",
      _selfCtrl:"Self Control"
    },
    _permissionModules:[
      "Users",
      "Companies",
      "Departments",
      "Projects",
      "Versions",
      "Modules",
      "Test cases",
      "TRs",
      "System",
      "Requirements"
    ],
    _roleOptions:{
      qa:"QA",
      developer:"Developer",
      ci:"CI",
      viewer:"Viewer",
      admin:"Administrator",
      manager:"Manager",
      teamLeader: "Team Leader",
      architect:"Architect",
      owner:"Owner"
    }
  },
  _test:{
    _filterTagTitle:"Define the tags filter",
    _defineFilterTag:"Note: Define tags filter to specify the test cases to execute in test suite. Example:\n"
    +"Run only project module tests: #project\n"
    +"Run create and update tests for project module and all tests for user module: #project create, #project update, #user\n"
    +"Run only form validations: fillform\n"
    +"Run only functional tests skipping form validations: -fillform",
    _tryScript:"Try Execute Script",
    _tryScriptDone:"Done! Please check script output in IDE browser console.",
    _hostExample:"Example: https:/"+"/google.com",
    _showDirectRef:"Show direct reference only",
    _undoMergeToSet:"Undo to mouse actions",
    _upstreamExplorer:"Explore upstream tests",
    _beRefList:"Target test case list:",
    _refList:"{0} is used by:",
    _missUrl:"Please set a correct url",
    _minDock:"Minimize",
    _dockTop:"Dock top",
    _dockBottom:"Dock bottom",
    _uiTabs:{
      console:"Console",
      debuggerData:"Debugger",
      network:"Network",
      data:"Data",
      details:"Test",
      config:"Action"
    },
    _testDetails:"Test info",
    _moduleDetails:"Module info",
    _typeDesc:{
      unit:"Tests are the atomic units that test your application. Each test consists of a mixture of UI actions, API calls, validations, and Javascript. Keep tests short, data-driven, and focused.",
      api:"API tests are comprised of API and script actions. Use this test type to test your application APIs or quickly generate test data. To create mixed tests (UI and API), use Functional tests, which support UI and API actions.",
      link:"Link tests binds Cucumber/Gherkin scenario test steps to test cases.",
      scenario:"Scenarios are test conditions written in Gherkin language. They are composed of Given, When and Then conditions.",
      bug:"Bugs represent visual bugs. Usually they are comprised by a series of clicks and comments (in-browser annotations).",
      com:"Components could be reference from any test case, the difference with other test case type is it not report details in test report. And, it could be execute as one action.",
      int:"Test suites drive test execution. Create an ordered list of test cases using the plug test-case action. They are also used to model Cucumber features.",
      subModule:"Sub-modules are modules within modules, useful for further breaking down your test tree into functional units.",
      module:"Modules represent a functional part of the application under test, and acts as a container for test cases.",
      feature:"Features are a set of Cucumber scenarios, referenced using the plug-test case action."
    },
    _general:{
      _title:"Editor",
      _url:"Page",
      follow:"Load page only if window closed",
      followCheck:"Reload page on host mismatch",
      newpage:"Always reload page",
      followSameURL:"Reload page on URL mismatch",
      _enterPointType:"Reload policy",
      _enterPointTypeDesc:"Load test page method",
      _loopData:"Loop Data",
      _startIdx:"Start",
      _endIdx:"End",
      _startDesc:"Start from 0",
      _endDesc:"Keep empty as end",
      _exitLoopOnError:"Exit on error in loop",
      _toActions:"To Actions",
      _toDescription:"To Description",
//      _nonMatchDesc:"The Test case Instructions is not the same as actions!",
      _testTitle:"Test Case Setting",
      _suiteTitle:"Test Suite Setting",
      _bugTitle:"Bug Setting",
      _host:"Domain",
      _tokenTest:"Retrieve Token Test Case",
      _apiHost:"API Host",
      _pageLink:"Page"
    },
    _askToAddHost:"Do you want to add the APP URL ({0}) into the environment server host list?",
    _existData:"Edit test data",
    _noExistData:"Add test data",
    _noSimilarParameter:"There is no similar parameter mapping to, do you want to create a new one?",
    _batchUpdateTest:"Do you want to update all '{0}' refer test case\n\nfrom: '{1}' \nto: '{2}'",
    _batchNewTest:"Do you want to update all '{0}' refer test case: '{1}'",
    _jsToAction:"Convert to action via $script API",
    _textToAction:"Converting descriptions into action",
    _scriptGeneratedActions:"Generated below actions",
    _scriptGeneratedActionList:"Script generated action list",
    _askPasteActions:"Do you want to insert actions or replace all actions?",
    _actions:{
      _title:"Record",
      _insert:"Insert new action"
    },
    _testGUI:{
      _title:"Test Flow Diagram"
    },
    _trReport:{
      _title:"Bug Report",
      _location:"Location",
      _assignTo:"Assign To",
      _newComment:"New Comment",
      _comments:"Comments"
    },
    _data:{
      _title:"Test data"
    },
    _type:{
      //cell:"Atomic",
      unit:"Test",
      api:"API Test",
      "int":"Suite",
      bug:"Bug",
      com:"Component",
      scenario:"Scenario",
      feature:"Feature",
      module:"Module",
      subModule:"Sub-Module",
      "ai-model":"AI Model"
    },
    _moduleTab:{
      unit:"Test",
      api:"API",
      scenario:"Scenario",
      "int":"Suite",
      module:"Sub-Module"
    },
    _modelTab:{
      // _base:"Base Setting",
      page:"UI mapping",
      api:"API mapping",
      flow:"Data Flow"
    },
    _testTab:{
      ctrl:"Controller",
      operation:"Operation",
      validation:"Validation",
      api:"API",
      scenario:"Scenario",
      "int":"Test Suite"
    },
    _common:{
      _fieldsetName:"Common",
      _name:"Name",
      _comment:"Comment",
      _breakPoint:"Break Point for Debugging",
    },
    _action:{
      _fieldsetName:"Actions",
      _name:"Name",
      _typeLabel:"Type",
      _type:[
        {
          _name:"Validation",
          _desc:"Creates an assertion condition in the page"
        },
        {
          _name:"Trigger Event",
          _desc:"Trigger a web page event such as: click, change, dblclick"
        },
        {
          _name:"Extract Data",
          _desc:"BZ supports 3 kinds of extract data methods. \n1. Extract web page element content as data. \n2. Extract JavaScript object as data. \n3. Extract data from database (by BZ tester supported data checker page)."
        },
        {
          _name:"JavaScript Code",
          _desc:"Executes JavaScript code"
        },
        {
          _name:"Plug Test Case",
          _desc:"Makes a call to a test case"
        },
        {
          _name:"Comment",
          _desc:"Add a comment on page element. Useful to highlight bugs and errors."
        },
        {
          _name:"Refresh window/Load Page",
          _desc:"Refresh current testing window."
        },
        {
          _name:"Group",
          _desc:"Group Actions (general block group, if, else, else if, for, while)"
        },
        // {
        //   _name:"Visit Links",
        //   _desc:"Visit Links"
        // },
        // {
        //   _name:"Validate Form Fields",
        //   _desc:"Auto-validate Form fields (Support JSON or dat reference, like: $test.data)"
        // }
      ],
      _appOpenned:"App window was openned",
      _event:"Event",
      _data:"Data",
      _value:"Value",
      _showDetails:"Show Details"
    },
    _error:{
      _format:{
        _test:"Data Format Error: Test case format is not correct. It must be in JSON format",
        _actions:"Data Format Error: actions format is not correct. It must be in Array([]) format",
        _dataMap:"Data Format Error: dataMap format is not correct. It must be in Object({}) format"
      },
      _emptyName:"Test Name cannot be empty!",
      _missPop:"Miss {0}. Expected Message: {1}",
      _unexpectedPop:"Unexpected {0}. Message: {1}",
      _unMatchPop:"No Match {0}. Expected Message: {1}, Actual Message: {2}",
    },
    _play:{
      _play:"Play Test Case",
      // _playgood:"Play upstream test",
      _remote:"Remote play",
      _stepByStep:"Step forward",
      _debugging:"Play in repair mode from selected action",
      _demo:"Play in demo mode",
      _auto:"Automation Play",
      _api:"Generate API",
      _camera:"Generate action screenshot",
      _repair:"Play & Repair",
      _action:"Execute current action (Double click)",
      _fromAction:"Play from current action"
    },
    _tab:{
      success:"On Success",
      failed:"On Failed",
      error:"On Error",
      condition:"Condition",
      auth:"Authentication",
      adv:"Advanced",
      dependency:"Pre-dependency",
      pop:"Pop Handler",
      script:"Script",
      resultscript:"Result script",
      preScript:"Pre script",
      endScript:"Result script",
      loopScript:"Repeat script",
      validScript:"Validation script",
      loopData:"Repeat script",
      resultScript:"Result script",
      responseScript:"Response script",
      option:"Options",
      note:"Note / Todo",
      description:"Description",
      parameter:"Parameter",
      info:"Basic info"
    },
    _conditionSetting:{
      _code:"Exit",
      _action:"Action",
      _report:"Report",
      _goto:"Goto",
      _set:"Set"
    },
    _defParameter:{
      _json:"JSON Editor",
      _form:"Key-Value Editor",
      _text:"Text Editor",
      _map:"Map Parameter"
    },
    _advOperation:"Advanced Operations",
    _mergeOpr:{
      _title:"Merge from other branch",
      _desc:"Merges another branch. Changes are only applied to your current branch."
    },
    _analyze:{
      _title:"Check Test case",
      _desc:"Analyze and check test cases data, and report issues."
    },
    _shareOpr:{
      _title:"Generate tokenized URL",
      _desc:"Generates a URL with a personalized user access token. This can be used for CI integration."
    },
    _outputDoc:{
      _title:"Output Relationship Map",
      _desc:"Output object map in different file type: HTML, PDF, WORD and MARKDOWN"
    },
    _noTime:"Info from last run missing",
    _textView:"T",
    _subType:{
      ctrl:"Condition Controller",
      operation:"Operation",
      validation:"Validation"
    },
    _targetParameter:"Target Parameter",
    _passParameter:"Pass Parameter",
    _foundIssues:"Found below issues",
    _buildParameter:"Build Parameters",
    _refreshParameterDefinition:"Generate parameters based on data in actions.",
    _noIssue:"Very good! No problems were found.",
    enter:"Enter",
    _beRef:"Be Plug-in",
    _tryFix:"Try to fix",
    _noAIFix:"Requires manual fix",
    _issueOptions:{
      _missExpectation:"Missing expectation setting",
      _missValue:"Input action has empty value",
      _missScript:"Empty script action",
      _errorData:"Data error: {0}",
      _missDesc:"Missing description setting",
      _missElement:"Missing element in action",
      _plugInError:"Plug test case target is missing",
      _missTarget:"Missing target setting",
      _missData:"Missing data setting",
      _missFinalSuccess:"Missing success message",
      _missDataDefine:"Missing data definition: {0}",
      _missScenarioPart:"Missing scenario keyword: {0}",
      _messScenarioOrder:"The order of the scenario keywords is not correct. Should be: Given, When, Then",
      _noBeRef:"Un-referenced test cases",
      // _wrongInsertDataStyle:"Data insert format warnings. ({0})\n\nThe correct format of data bind on Value, Expectation, Element, Plug Test case and Load page URL is: {{....}}. \n\nFor example: {{{1}}}",
      // _wrongScriptFormat:"Script format warnings. ({0})\n\nThe correct of reference a data in Script is not need to use {{....}}.",
      // _wrongDataFormatInParameter:"Data format in parameter. ({0})\n\nWhen using different data scopes in parameter, don't use {{....}}, and \"....\" or '....'.",
      _notBest:"Non-unique element selector",
      _missPlugIn:"Missing plug test case",
      _missApiHost:"Missing API host",
      _missRequest:"Missing request",
      _suggestNeverLaunchMethod:"Launch page issue. There are no element actions found. Use 'never reload' on the test case to speed up execution."
    },
    _askToApplyUpdate:"Do you want to apply the update?",
    _removeActionDesc:"Going to remove {0} action.",
    _repairAlert:{
      _missPlugIn:"the missing plug-in",
      _plugInError:"the wrong plug-in",
      _missValue:"the missing value",
      _missExpectation:"the missing expectation",
      _missDesc:"the missing description",
      _missElement:"the missing element",
      // _wrongInsertDataStyle:"Going to update {0} to {1}",
      // _wrongDataFormatInParameter:"Do you want to apply the update?",
      _missScript:"the missing script",
      // _wrongScriptFormat:"Do you want to apply the update?",
      _suggestNeverLaunchMethod:"Going to change the launch method to never reload"
    },
    _issueTab:{
      _summary:"Summary",
      _list:"Issue list"
    },
    _issueScope:"The issues in {0}",
    _issues:"Test case setting issues",
    _confirmToRevision:"The operation will restore a previous test revision. Current test version will be lost. \n\nDo you want to continue?",
    _deleteScreenshotDesc:"Do you want to delete the action screenshot or delete all screenshots of the test case?",
    _saveScreenshotDesc:"Do you want to save the action screenshot or save all screenshots of the test case?",
    _increaseTime:"Execute time increase: ",
    _decreaseTime:"Execute time decrease: ",
    _lastTimeSuccess:"Last time success",
    _lastTimeFailed:"Last time failed",
    _reloadData:"Reload data",
    _validateVariable:"Validate variable value",
    _validateStatus:"Validate request status",
    _insertRefresh:"Insert Refresh Action",
    _testParameter:"Test Parameter",
    _aiVariable:"[Auto Generate Variable]",
    _testId:"Test Id",
    _noRefAction:"There is no reference to other test case.",
    _doValidation:"Do Validation",
    _defVariable:"Default Variable",
    _deleteList:"Deleted the below test cases:",
    _orgDefValue:"Default Parameter Value",
    _deleteNone:"No test cases deleted",
    _staticValue:"Static Value",
    _newValue:"To be assigned",
    _reAssignParameter:"Do you want to re-assign parameter for each actions?",
    _noPerfect:"There is no perfect solution to test the current test case",
    _perfectList:"Please select the test case to play",
    _refOf:"References of{0}",
    _addTimeout:"Look like there are {0} ms delay, do you want to set a timeout on the action?",
    _suggestDelay:"The problem maybe was caused by executed previous action too early. \n\nSuggestion: Add a delay on some previous action (click)",
    _historyList:"Test case history list",
    _noHistory:"No history data",
    _toDisableAction:"Do you want to repair the test by disabling the failed action?",
    _ignoreLoad:"Ignore load page",
    _loadPage:"Loaded page",
    _confirmMove:"Are you sure you want to move the current test case into {0}",
    _viewLastTest:"Click to go back test case",
    _viewNextTest:"Click to go forward test case",
    _curTest:"Current Test case",
    _details:"Test Details",
    _finalLink:"Final Link",
    _confirmDeleteTestOrActions:"Do you want to delete all actions or the current test case?",
    _confirmRebuildActions:"Do you want to rebuild all actions?",
    _synActionDesc:"Synchronize Actions on save Test Case",
    _asCtrlItem:"Mark as test suite that calls other tests",
    _missingElementInUpgrade:"Didn't find element by original element path.",
    _findSimilar:"\n\nFound a similar element. \n\nIf it is not correct, please select target element from tested page, and click 'Continue' ",
    _noFindSimilar:"Please select target element from tested page, and click 'Continue'",
    _pickTargetElement:"Please pick target element from tested page first.",
    _selectTests:"Select Test Cases:",
    _moduleTests:"Module Test Cases:",
    _suiteTests:"Selected Test Cases:",
    _shareTestLink:"Test case link",
    _shareToken:"Token execute link",
    _cooperationToken:"Fill password to retrieve token",
    _autoCopied:"Auto copied the link",
    _upgradeStrategy:"Upgrade Strategy",
    _askByRequests:"Catch the below API requests, please click which operation you want.",
    _apiOprDesc:"Note:\nCreate: Create a new API Test\nAttach: Attach to an exist API Test\nOverwrite: Overwrite an exist API Test.",
    _attachToAPITest:"Attach to test",
    _overWriteAPITest:"Overwrite test",
    _missNewElement:"Please select the purpose element before continue"
  },
  _picker:{
    _hiddenElement:"Note: element is hidden.",
    _resetIdx:"Re-set element path index ...",
    _slowReminder:"Estimated time to find element",
    _showFullPath:"Show path",
    _hideFullPath:"Class path",
    _autoRefresh:"Auto check",
    _chkPath:"Check path",
    _children:"Children Elements",
    _sibling:"Sibling Elements",
    _parent:"Parent Element",
    _name:"Dom Picker",
    _header:"Header",
    _text:"Text",
    _label:"Label",
    _index:"Index",
    _okBtnPass:"Select",
    _showSibling:"Show sibling ...",
    _showSubItems:"Show hidden sub items ...",
    _generatePath:"Generate smart path",
    _okBtnWarning:"Select (The path is not well-defined)",
    _testFailed:"No element match",
    _noExpectedType:"Expected type element missing: {0}",
    _reminderManualEdit:"Tip: Click on each part to manually edit element path",
    _selectPath:"Select element path",
    _textOptions:{
      "":"",
      ":text":":text (default for mouse action)",
      ":input":":input (default for set action)",
      ":panel":":panel",
      ":RowCol":":RowCol (use for table, case insensitive)",
      ":rowcol":":rowcol (use for table, case sensitive)",
      ":after":":after (after matching text)",
      ":afterEqual":":afterEqual (after equal text)",
      ":before":":before (before matching text)",
      ":contains":":contains (case sensitive)",
      ":Contains":":Contains (case insensitive)",
      ":equal":":equal (match text exactly, case insensitive)",
      ":endEqual":":endEqual",
      ":endContains":":endContains",
      ":near":":near",
      ":data":":data"
    },
    _editPath:"Edit element path",
    _noElement:"No element selected",
    _labelSettingError:"The label was not found on page",
    _headerSettingError:"The header was not found on page",
    _applyFailed:"Apply the specific text failed. Please try other words or manually select",
    _reminder:"Please select target element from APP page"
  },
  _git:{
    _commitMessage:"Commit Message",
    _commitList:"Commit List",
    _updateContent:"Check update content",
    _preResult:"Pre-Result",
    _from:"From: {0}",
    _toCurrent:"To: {0} (current)",
    _curResult:"Result",
    _deleteItems:"Delete List",
    _current:"{0} (current)",
    _diff:"Compare",
    _pick:"Cherry Pick",
    new:"create",
    update:"update",
    _nothingToDo:"Nothing to do!",
    _scope:{
      _branch:"Branch management",
      _merge:"Merge tool",
      _mergeRequest:"Merge request",
      _commit:"Commit history",
      _change:"Change list",
      _stash:"Stash list",
      // _delete:"Delete list",
    },
    _compareWith:{
      _title:"Compare with object",
      cur:"Current data",
      pre:"Previous data"
    },
    _noSelToCommit:"No items selected for commit",
    _confirmStashDrop:"Are you sure you want to drop the selected stash item(s)?",
    _revertConfirm:"Are you sure you want to revert the below item(s)?",
    _revertNote:"Note: Revert doesn't work on the New/Untracked item(s)",
    _stashConfirm:"Are you sure you want to stash the below item(s)?",
    _stashNote:"Note: Stash doesn't work on the deleted item(s)",
    _stashPopConfirm:"This operation will {0} the below item(s):",
    _stashPopNote:"Note: Some items with version conflicts needs to be merged manually",
    _confirmSwitchBranch:"Do you want to switch to branch: <b>{0}</b>? \n\nNote: This operation need to reload the page.",
  },
  _task:{
    _initData:"Re-initialize data",
    _applyData:"Use stored data",
    _setTestData:"Set up test data",
    _storeTmpData:"Store temporary data",
    _askStoreData:"Note: Do you want to save the generated data for the next test run?",
    _storedData:"Note: Stored below new data",
    _lastData:"The last execution data",
    _solutionTest:"Real-time Solution",
    _runSubTest:"Executing this test case directly may fail as it relies on upstream data. It is recommended to execute scenario test cases. Do you want to continue the execution?",
    _stopped:"Stopped",
    _expectedFailed:"Expected error",
    _logDetails:"Log Details",
    _exeNextInDemo:"Click browser to execute next step: {0}",
    _retrieveTokenFailed:"Failed to retrieve token",
    _curTest:"Current Test",
    _setting:"Execution environment and options setting",
    _taskQueueSize:"Task queue ({0})",
    _allActions:"Result list",
    _failedActions:"Failed Actions ({0})",
    _loopData:"Loop data",
    _executing:"Executing ...",
    _startTime:"Start time: ",
    _endTime:"End time: ",
    _currentData:"Current Data",
    _selectLoopData:"Specify the data to be executed",
    _waitRequests:"Waiting for {0} requests to complete:\n\n{1}",
    _debuggerError:"Debugger not supported here! \nPlease put your code in a function, and set the debugger inside.\n\nThe debugging code:\n\n",
    _logAgain:"    Ditto ...",
    _retryOnMissingElement:"Retry on missing element",
    _retryOnElementExist:"Retry on element is still here.",
    _showLog:"Show Log",
    _tooLongToRefresh:"In processing, there is a refresh on {1}, since a long waiting without response ({0}) issue.",
    _continueTest:"The last task was stopped manually. Do you want to run test using current data context.",
    _missBeginningRepElementError:"Missing Response Element at beginning",
    _repElementAppearBeforeExeError:"Response Element appears before execute action",
    _repElementAppearFailed:"Response element didn't appear as expected",
    _repElementDisappearFailed:"Response element didn't disappear as expected",
    _pageException:"The page is abnormal： {0}",
    _tried:"Tried",
    _callAtEnd:"Note: Remember to Call the function at the end",
    _insertDataListInElement:"This could be a data issue. Please review the data below:",
    _stopAction:"Stop Action ",
    _extractEmptyData:"Got empty data by API request.",
    _autoCloseWindow:"Task completed! The window will be closed in 30s.\n\nYou can click cancel button the keep the window.",
    _playDemoNote:"Please click on browser or key Right/Down/Ctrl to execute script step by step. \n\nNext step: {0}",
    _analyzing:"Analyzing page ......",
    _validatingPage:"Validating filled form ......",
    _fillingForm:"Filling form ......",
    _crashInfo:"Page '{0}' not available. Stopped test case.",
    _windowNotReady:"Test window not found. Please execute a test case to open it.",
    _bzStop:"Stopped test task by bz-stop",
    _bzSkip:"Skipped current action by bz-skip",
    _bzSkipGroup:"Skipped current action group by bz-skip-group",
    _bzStopInfo:"(The test case is bz-stop on action {0})",
    _bzSkipInfo:"Skipped by bz-skip at {0}",
    _skipValidData:"Ignore on validating data, {0}.",
    _skipByElement:"Skipped by skip action element",
    _bzSkipGroupInfo:"(bz-skip-group)",
    _parameterRequired:"The current test need to assign a parameter. Please set it. <br/>The format can be in String, Object ({...}) or Array ([...])",
    _unComplete:"The current Task is not complete!",
    _replaceExpectation:"Expected value was replaced.",
    UnMatch:"The actual result does not match the expected result.",
    _askToDebug:"The target element was not found. ",
    _helpOnMissingElement:"\n\nIf the element was slow to load and has appeared, click 'Re-try'.\n\nIf the element has changed and need to be re-selected, click 'Pick'. \n\nTo stop test execution, click 'Stop'. To ignore the error and continue execution, click 'Continue'.",
    _askDownloadAssign:"No file was downloaded! Change validation to non-download action?",
    _stack:"Stack trace",
    _demo:{
      _validation:"Validating content {0} ...",
      _triggerEvent:"Triggering event {0} here ",
      _extractData:"Extracting data from {0} ...",
      _script:"Running script: {0}",
      _ref:"Invoking test case: {0}",
      _comment:"Showing comment ...",
      _refresh:"Reloading current page ...",
      _group:"Action Group",
      _pageResult:"Page result",
      _jsResult:"Script result",
      _apiResult:"REST API result"
    },
    _nextSchedule:"Next schedule at: ",
    _confirmDebugging:"Playing in debug mode will start from the selected action. \nIf you want to start from the beginning of the test case, click cancel and select the test case from the navigator. \n\nDo you want to continue?"
  },
  _diff:{
    _title:"Difference",
    _expectation:"Expectation",
    _actual:"Actual",
    _OverWrite:"Overwrite",
  },
  _login:{
    _userName:"User Name",
    _password:"Password",
    _extra:"Extra",
    _failed:"Login failed! <br/> Please check your username and password."
  },
  _action:{
    _details:"Action Details",
    _replaceIfGroupConditionConfirm:"The current action is a conditional controller. Do you want to replace it or insert under it?",
    _asClick:"Set value by click",
    _multipleActionAsIfGroupConditionError:"Multiple actions cannot be used as conditional controllers",
    _asIfGroupConditionError:"'{0}' action cannot be used as a conditional controller",
    _assignToPath:"Use",
    _selectUploadFile:"Select upload file",
    _missRepeatData:"Missing 'Repeat Script'",
    _missConditionAction:"Missing condition action",
    _rightClick:"Right click",
    _reselect:"Re-select",
    _attrList:"Attribute List",
    _moveToPos:"Move to position",
    _preScript:"Pre-Script ({0})",
    _defTimeout:"Default timeout 60000ms",
    _dynamicOneAction:"Auto-one-action-group, from {0} to {1}",
    _tryTmpData:"Test action using temporary values",
    _bindAction:"Combo action",
    _refOfTestFormat:"ModuleCode.TestCode (Ex. m1.t1)",
    _comboIssue:"Combo data input format setting issue",
    _supportReadonlySet:"Support set value on readonly",
    _cfgSubTabs:{
      main:"Overview",
      condition:"Condition",
      script:"Script",
      option:"Options"
    },
    _apiSubTabs:{
      details:"API Setting",
      condition:"Condition",
      option:"Options"
    },
    _batchApiSubTabs:{
      batch:"Load Testing"
    },
    _elementSetting:{
      _policy:"Policy",
      _clickEvent:"Click Action",
      _setEvent:"Set Action"
    },
    _refFrom:"Reference from action",
    _noLightAction:"Non-rapid action",
    _useComboAction:"Use combo action",
    _triggerPopup:"Trigger browser alert/confirm/prompt",
    _chkDetailsInOverview:"(Check details in Overview)",
    _pickOrComponent:"Pick element from APP page or Select a component in the dropdown list",
    _ifUploadFile:"You are doing an uploading file action. There are the following options for uploading files:",
    _uploadInStdFiles:"Use simple files provided by Boozang.",
    _existFileData:"Exist file data",
    _uploadInUrlFile:"Use URL to specify file",
    _uploadFromDesk:"Upload file from desktop",
    _missingUploadFile:"No upload file specified",
    _confirmUploadFileToServer:"This file (Max 2M) can be uploaded to the server (up to ten files can be stored) and mapped to a project-level data ($project) to facilitate sharing and use among different environments and team members. \n\nIs this operation allowed?",
    _reviewByDownload:"Review by download",
    _tooLargeInScript:"The file is too large to be stored in the script. Please try another smaller file or choose to store it on the server.",
    token:"Token",
    _origin:"Origin",
    _originOptions:{
      mc:"Middle center",
      lt:"Upper left corner",
      t:"Top center",
      rt:"Upper right corner",
      r:"Right center",
      rb:"Bottom right",
      b:"Bottom center",
      lb:"Bottom left",
      l:"Left center"
    },
    _asOffsetAction:"Apply an offset element",
    _asOffsetTargetElement:"Apply an offset on target element",
    _setTime:"Set custom delay / timeout",
    _noteDesc:"Any important info about the action, for example: make a note on todo checked",
    _actionScriptDesc:"Pre script will be executed first, then action will be repeated according to the setting in repeat script (default: 1). \nThe result will then be processed according to result script.\n\n"
                  +"- Pre script: Any Javascript function to initiate action.\n"              
                  +"- Repeat script: Any loop-able data (number, an array, or a CSV, including data and functions).\n"
                  +"- Result script: A Javascript response wrapper function (can alter action status programmatically).\n\n"              
                  +"Access iteration data using handles: $action or $group.\n\n"
                  +"Examples:\n\n"
                  +"- Pre script=$parameter.i++: Increase counter $parameter.i before executing action\n"
                  +"- Repeat script=n: Loops action n times (n=0 skips action).\n"
                  +"- Repeat script=[1,3,5]. Executes three times assigning $action to 1, 3, 5. \n"
                  +"- Repeat script=CSV data: Row headings contain attribute names, split by tabs.\n"
                  +"- Repeat script=JavaScript function: ex. (function(){ return [1,2,3]})();\n"
                  +"- Result script=(function(){ return $result.status }): default behavior\n"
                  +"- Result script=(function(){ return n }): override status (n=0: success, n=1: fail, n=2: error)\n\n"
                  +"Script Format： \n(function(){\n  /"+"/Tip: Use double brackets to insert standard code\n})();\n\n"
                  +"Note： Supports data generated by Regex",
    _repeatScriptDesc:"For the 'For Loop' group, users need to set a 'Repeat Script'. \nWithin the script, users can directly use: \n\nnumbers, arrays, referenced data, and executable scripts.",
    _loopDataDesc:"'For group' need set Repeat  executed first, then action will be repeated \naccording to the setting in repeat value (default: 1). \nThe result will then be processed according to result script.\n\n"
                  + "Repeat Value should be a number, array, or CSV.\n\n"
                  +"Access iteration data using handles: $action or $group. \n\n"
                  +"1. Number: Loops n times. A value of 0 skips action.\n"
                  +"2. Array: ex. [1,3,5]. Executes three times assigning $action to 1, 3, 5. \n"
                  +"3. CSV: Row headings contain attribute names, split by tabs.\n"
                  +"4. JavaScript: ex. (function(){ return [1,2,3]})();\n"
                  +"5. Data: ex. $parameter.data\n\n"
                  +"6. Use other data, like: $parameter.data\n\n"
                  +"Note： Support generate data by Regex",
    _resultScriptDesc:"Pre-script will be executed first, then action will be repeated \n\naccording to the setting in repeat value (default: 1). \nThe result will then be processed according to result script.\n\n"
                  +"User can control process flow by updating result status in script.\n\nScript Format： \n(function(){\n  /"+"/Tip: Use double brackets to insert standard code\n})();\n\n$result data structure: \n$result.status: execute result (success,failed,error)\n$result.failedAction: failed action\n$result.failedAction.idx=failed action index\n$result.failedAction.description=action description\n$result.failedAction.test=The failed action test case code。",
    _chkDataInJson:"Check data in JSON",
    _exeFunctionFailed:"The data is defined as a function. The current execute failed. ",
    _identityFunction:"The data is defined as a function, The current execution result is:\n\n{0}",
    _notLoopDataFormat:"The data format is not correct. The result should be a array or a number. The current data is: \n\n{0}",
    _deleteScreenshot:"Delete Screenshot",
    _missRefTests:"Please select which test case need to insert.",
    _missRefModule:"Please select which module need to insert.",
    _cleanBySignOut:"Clean Token",
    _changeResultOnSuccess:"Change Result on success",
    _changeResultOnFail:"Change Result on fail",
    _changeResultOnError:"Change Result on error",
    _mouseEvent:"Mouse event",
    _ref:{
      _success:"On Success",
      _successParameter:"Parameter of success",
      _fail:"On Fail",
      _failParameter:"Parameter of fail",
      _error:"On Error",
      _errorParameter:"Parameter of error",
      _toFail:"To fail",
      _toWarning:"To warning",
      _toError:"To error",
      _toSuccess:"To success",
      _none:"None"
    },
    _tokenTest:"Retrieve Token",
    _enableTokenAction:"Enable retrieve token",
    _tokenValue:"Current Token value",
    _noTokenTest:"No token test case for the test case host",
    _noTokenValue:"No token value now!",
    _mapTestParameter:"Mapping target test case defined parameter",
    _mapGotoTest:"Mapping goto test case",
    _monitorToken:"Monitor Token",
    _hostToken:"Token host",
    _tokenKey:"Token key",
    _tokenErrMsgDesc:"The information flag obtained by the API \nwhen there is no token or the token data is incorrect.\n\nNote: This setting prepares data for the self-retrieving token function.",
    _tokenErrMsg:"The information flag on token error",
    // _apiReplaceEvent:"Execute API ",
    _else:"else",
    _loop:"loop",
    _event:"event",
    _clickDownloadImage:"Click to download the current action camera image.",
    _dblclickDownloadImages:"Double click to download all camera images of the current test case.",
    _toCompare:"Compare",
    _autoDelay:"Auto wait until last data request complete",
    _retryable:"Retry execution when the target element for the next action is not present",
    _timeLong:"Time long",
    _actionPath:"Group (action)",
    _requestLink:"Request URL",
    _setValueFailed:"Failed on setting value ({0})",
    _exeScriptBrowser:"Play on",
    _noBestPath:"Note: Non-unique element path found!",
    _confirmUpdateExpectation:"The actual value is not the same as the expectation. \n\nActual: {0}</div><div class='bz-box'>Expectation: {1}\n\nDo you want to replace it?",
    _submitDataInfo:"Note: The submit data will be keep on $test.curFillFormData. Can be useful on clearing data as a parameter to call a delete data test case.",
    _msgNotMatch:"Alert info is not match.\nData = {{0}：'{1}'}\nExpectation：{2}\nActual：{3}",
    _lostTargetElement:"Lost target element",
    _successMsg:"Success Message",
    _missSuccessMsg:"Missing success flag",
    _aiReset:"Reset to default AI Setting",
    _notFoundElement:"The element: {0}\n\nCannot be found on current page.",
    _updateFillFormData:"Do you want to update data?",
    _missData:{
      _script:"Script missing",
      _element:"Element missing",
      _warn:"Element path can be improved",
      _ref:"NOT IMPLEMENTED!",
      _url:"URL missing",
      _expectation:"Expectation value missing",
      _data:"Missing fill-form values",
      _requests:"Missing API Requests",
      _description:"Missing description"
    },
    _reloadOptions:{
      _page:"Load Page",
      _data:"Refresh / Initialize data"
    },
    _refreshType:"Refresh Type",
    _specifyRefreshData:"Specify refresh data",
    _addDataHandler:"+ Reference Data",
    _stdApiResponseScript:"Reset to standard API response script",
    _addBaseFun:"+ Function",
    _noData:"No data to fill!",
    _actionOperations:"Operations on Current Action",
    _notExeAlone:"Doesn't support execute the action alone, you must execute the test case",
    _setFlag:"Set Switch flag",
    _setTimer:"Set action timeout or delay",
    _setPop:"Set browser popup box: alert, confirm and prompt",
    _setCondition:"Set condition",
    _validationType:"Validation Type",
    _noInsert:"Not Insert",
    _asGroup:"As {0} group",
    _loopOptions:{
      _title:"Loop Options",
      _noLoop:"No Loop",
      "for":"For Loop",
      "while":"While Loop",
    },
    _groupOptions:{
      "if":"As an if group, the first action within the group can be of any type, but it needs to have conditions set to enter or exit the action group based on the action's outcome.",
      "else":"An Else-Group needs to follow an If-group. If the group is broken, the flow will instead enter the Else-Group.",
      "switch":"A switch group is used for multiple choices or to skip code. Any previous action can directly goto the group using exit conditions or by script, like: $util.gotoFlag('xxx'). Make sure it's run in IDE",
      "for":"A for loop group accepts number or array. The value can be filled directly, assigned by data or generated by a script. If the value is 0 or empty array, the group actions will be skipped.",
      "while":"A loop-group repeats its inner actions unlimited times, until a bz-skip-group value or break-group condition."
    },
    _speed:"Speed",
    _unique:"Unique",
    _noUnique:"Not unique",
    _skipPosition:{
      _value:"Set value",
      _element:"Element path",
      _expectation:"Expectation value",
      _url:"Request URL",
      _headers:"Request Headers",
      _httpData:"Post Data",
      _action:"$action",
      _group:"$group",
      _ref:"Call test case"
    },
    elseGroup:"As else group",
    loopGroup:"As loop group (unlimited times)",
    forGroup:"As for loop group (specify loop times in repeat script)",
    asOneAction:"Execute as single action in App window",
    // singleAction:"As Single Action",
    // singleActionDesc:"As a single action group, all inner actions will be hidden, and all actions result as one action result.",
    _batRef:"Plug Test Case (Batch)",
    _passErrData:"Passed on an error data!",
    _failedOnSuccessData:"Failed on submit a normal data",
    _typeTitle:"Event Type",
    _popType:"Pop Type",
    _contentType:"Operation",
    _asRunningData:"As initial data for playing from the action",
    _plugActions:"Plug ...",
    _autoClick:"Auto click ",
    _handleMsg:"Auto Check message",
    _handleMsgOptions:{
      _none:"[none]",
      _realtime:"Check after each input",
      _submit:"Check after each paging and submit",
      _both:"Check after each input, paging and submit"
    },
    _successSelector:"Success Message",
    _successMark:"Success Mark",
    _errMark:"Error Mark",
    _summaryMsg:"Summary Message",
    _lineMsg:"Each field Message",
    _errMapDesc:"Mapping on error data. like:\n\n{name:{error:['',1,'#@$']}}",
    _successMapDesc:"Mapping on success data. like:\n{name:{success:'boozang'}}, \n\nor \n\n{name:{success:['boozang']}}\n\nIf want to set a normal without success message, should be:{name:'Boozang'}",
    _infoMapDesc:"March general info. Like：\n\n{name:{info:['some special name']}}",
    _fillFormDesc:"Support JSON, the format is:"+`
{    
  name：{
    error:[
      {
        value:"",
        message:"Please fill a value for it"
      },
      {
        value:"333",
        message:"Data format is not correct. Only letters are supported."
      }
    ],
    success:"Some one"
  },
  company:"XXX" //Set a success value without a validation,
  contact:{
    error:"111", //Data format is not correct. 
    success:"Some one"
  }
}

Support reference data, like:

$test.data
    `,
    _type:{
      _validation:"Validate Result",
      _triggerEvent:"Trigger Event",
      _extractData:"Extract Data",
      _script:"JavaScript & Function",
      _ref:"Plug Test Case",
      _comment:"Comment",
      _refresh:"Refresh (Window/Data)",
      _group:"Group",
      // _visit:"Visit Links",
      // _fillForm:"Validate Form Fields",
      _load:"Load Test"
    },
    _content:{
      _BZFormat:"BZ Format",
      _subLength:"Sub Dom Count",
      _parentLevel:"Parent Level",
      _exist:"Exist",
      _unExist:"Not exist",
      _dnExist:"Dynamic Exist",
      _value:"Input Value",
      _enable:"Is Enabled",
      _disable:"Is Disabled",
      _checked:"Is Checked",
      _unchecked:"Is Unchecked",
      _hasCss:"Has CSS",
    },
    _markErrorOnHidden:"Treat hidden elements as not found",
    _allowExeOnHiddenElement:"Allow to execute on hidden element",
    _asDblClick:"As double-click action",
    _switchToSetValue:"Switch to set value",
    _loadURL:"Load Page",
    _method:"Method",
    _reqRep:"Request/Response (API)",
    _coordinate:"Coordinate deviation",
    _panel:"Panel",
    _requireToggle:"Toggle Required",
    _panelToggle:"Panel Toggle",
    _targetToggle:"Target Toggle",
    _plugin:"Plug-in",
    _left:"Left",
    _right:"Right",
    _top:"Top",
    _bottom:"Bottom",
    _redo:"Re-do",
    _jsonContent:"In JSON Content",
    _ignoreOptions:"Ignore options",
    _aipSetting:"API Setting",
    _httpMethod:"HTTP Method",
    _httpData:"HTTP Data",
    _element:"Element",
    _target:"Target Element",
    _monitorUrlValue:"[Set target link characteristics at here]",
    _skipMark:"Skip mark",
    _failMark:"Fail mark",
    _failElement:"Fail action element",
    // _auxiliaryRecognition:"Auxiliary recognition",
    _enableMonitorUrl:"Enable monitor Url function",
    _offset:"Offset",
    _monitorUrl:"Monitor APP URL",
    _monitorUrlError:"Monitor URL function error: ",
    _initMonitorUrlError:"Enable Monitor URL function error: ",
    _skipActionElement:"Skip action element",
    // _finalElement:"Element script",
    _skipActionDesc:"When the specified target element appears on the page, this action is not performed.",
    _failElementDesc:"When the specified target element appears on the page, the execution of this action fails.",
    // _finalElementDesc:"After the action element is found, execute this script to assign the target element to a dynamic element to complete the entire action operation. You can refer to the action element with $element.",
    // _auxiliaryRecognitionDesc:"This setting is to help the testing tool complete the identification and operation of the custom drop-down box control.\n\nPanel style: Used to identify the scope of custom controls.\nValue style: used to identify the sub-items of the drop-down menu.\nSelected style: used to identify the current selection.",
    _monitorUrlDesc:"When some system dialog boxes are called on APP loading a dynamic page, (such as: Windows security authentication dialog box), it will cause the APP window to lose control. In order to avoid this situation, it is often necessary to change the dynamic link address. After using the monitoring script, the script will receive the data request link appearing on the APP in real time. Users can find the target link according to business rules, return true, and stop monitoring.",
    _offsetDesc:"The offset setting is used when the target point is not on the action element. \nGenerally used to test and click controls developed based on canvas.",
    _customizeInputTitle:"Identify custom control auxiliary settings",
    _customizeInputDesc:"Help identify and assign user-defined controls in the product",
    _repElement:"Combo action element",
    _interval:"Interval",
    _repElementMethod:"Response Element Method",
    _repElementOptions:{
      a:"Retry until element appears",
      1:"Validate element appears",
      2:"Validate element appears and disappears",
      3:"Validate element appears and click on it",
      4:"Validate element appears and double click on it",
      5:"Validate element disappears",
      6:"Validate element disappears and appears again",
      7:"Validate element disappears and appears again and click on it",
      8:"Validate element disappears and appears again and double click on it",
    },
    _location:"Location",
    _expectation:"Expectation",
    _elementMissingPolicy:"Re-try policy",
    //_failedReactionDefault:"Re-try on element missing",
    _failedReaction:"Never re-try on element missing",
    _disableAISet:"Disable AI Set",
    _markMultipleElement:"Multiple Elements",
    _failedReactionRetry:"Re-try if content mismatch",
    _showOptions:"Show options",
    _compare:"Comparison",
    _preFormat:"Match (RegExp)",
    _replace:"Replacement String",
    _dataSizeWarning:"Note: If the expectation data size is more than 5K, the cloud server will only keep the MD5 value, not the original data",
    _refOfSuccess:"On Success",
    _refOfFailed:"On Fail: Validation False",
    _refOfFailedLoadPage:"On Fail: Load Page",
    _refOfFailedDownload:"On Fail: Download File",
    _refOfErrorLoadPage:"Error: Load Page",
    _refOfError:"Error: Element Not Found",
    _returnValue:"Return",
    _script:"Script",
    _extractData:"Extract Data",
    _showCommentJudge:"Show selection for Pass/Fail",
    _inGroup:"In Group",
    _todo:"TODO",
    _header:"HTTP Headers",
    _downloadAsFile:"Download as a file object",
    _jsonFormat:"JSON Format",
    _delay:"Delay Time",
    _delayType:"Delay Mode",
    _general:"General",
    min:"Delay Time",
    max:"Timeout",
    defaultMin:"Default Delay: {0}",
    defaultMax:"Default Timeout: {0}",
    _okData:"The action is complete.",
    _warningData:"The action complete, but the element path is not well-defined. Please check it.",
    _popFollow:"Validate in next action",
    _nullValue:"Null Value",
    _emptyValue:"Empty Value",
    _jsonKey:"Keys",
    _jsonValue:"Value",
    _ignore:"Ignores",
    _allAttrs:"All attributes (Except input value)",
    _keyGroup:"Group (down, press and up)",
    _mouseGroup:"Group (down, up and click)",
    _otherAttr:"Other attributes",
    _otherElement:"Other elements",
    _numberAttr:"Number in Attribute (Except input value)",
    _left:"Left",
    _middle:"Middle",
    _right:"Right",
    _groupType:"Group type",
    _confirmInsertRefUnits:"Do you want to try a BZ AI fill the test suite?",
    _reTryOnError:"Re-try on error",
    _fromPanel:"Panel Style (CSS)",
    _valueStyle:"Item Style (CSS)",
    _selectStyle:"Selected item Style (CSS)",
    _groupKeys:"A group keys",
    _clearCookie:"Clear Cookie",
    _clearLocalStorage:"Clear LocalStorage",
    _batchInsert:"Batch add validate data",
    _extractDataScriptInfo:"The extract element {0} is: '{1}'.\n\n It is set to a temporary variable, $test.tmpValue. You can manually change the variable name, or take other element attribute.",
    _defComment:"There is a note",
    _actionMenuOptions:{
      _validation:"Validation Action",
      _mouse:"Mouse Action",
      _keyboard:"Keyboard Event",
      _com:"Set value component",
      _extract:"Extract Action",
      _script:"Script Action",
      _plugin:"Plug-in Test",
      _add:"Other Actions ...",
      _break:"Add break",
      _playAction:"Play the action (Dblclick)",
      _record:"Record from here",
      _group:"Group",
      _api:"API Action",
      _load:"Load test",
      _validScript:"Script Validation"
    },
    _description:{
      _validateContent:"Validate {0}: {1} ",
      _validateResponse:"Validate response: {0} {1} ",
      _extractResponse:"Extract response: {0} {1}",
      _extractData:"Extract: ",
      _trigger:{
        _change:"set {0}",
        _check:"check {0}",
        _uncheck:"uncheck {0}",
        _typing:"typing",
        _click:"click {0}",
        _dblclick:"double click {0}",
        _rightClick:"right click {0}",
        _hover:"hover {0}",
        _drag:"drag {0}",
        _dragDrop:"drag and drop {0}"
      },
      _comment:"comment: {0} found issue ({1})",
      _refresh:"Load page: {0}",
      _refreshData:"Re-Initialize data: {0}",
      _ref:"Call: ",
      _exeScript:"Script: ",
      _group:"Group: ",
      _visit:"Visit Links from: ",
      _fillForm:"Fill form: {0}",
      _load:"Execute {0} API"
    },
    _methodDesc:{
      _validateContent:"Validate",
      _validateResponse:"API-Validate",
      _validateJS:"JS-Validate",
      _extractResponse:"API-Extract",
      _extractData:"Extract",
      _trigger:{
        _change:"Set",
        _check:"Check",
        _uncheck:"Uncheck",
        _typing:"Typing",
        _click:"Click",
        _dblclick:"Double click",
        _rightClick:"Right click",
        _dragDrop:"Drag and drop",
        _drag:"Drag",
        _hover:"Hover"
      },
      _comment:"Comment",
      _refresh:"Load page",
      _refreshData:"Re-Initialize data",
      _ref:"Call",
      _group:"Group",
      // _visit:"Visit Links",
      // _fillForm:"Fill form",
      _script:"Script",
      _load:"Load Test"
    },
    _insertRecording:"Record Action from here",
    _insertAction:"Insert {0}",
    _searchTest:"Search test case to add",
    _missRef:"Error: test case doesn't exist",
    _missElement:"Element not found on page!",
    _functions:{
      _loadPage:"Load page",
      _retrieveUrl:"Retrieve URL",
      _browserBack:"Browser Back",
      _browserForward:"Browser Forward",
      _scrollTop:"Scroll to Top",
      _scrollBottom:"Scroll to Bottom",
      _scrollPageDown:"Scroll one page down and right",
      _scrollPageUp:"Scroll one page up and left",
      _gotoFlag:"Goto Flag",
      // _takeScreenshot:"Take Screenshot",
      _asyncFun:"Async Function"
    },
    _selectFun:"[Select Function ...]",
    _insertFunction:"Insert function",
    _enterLines:"Ctrl + Enter to insert multiple lines",
    _downloadAction:"As a download action",
    Timer:"Delay Timer",
    Success:"Execute extra action on Success",
    Failed:"Execute extra action on Failed",
    Error:"Execute extra action on Error"
  },
  _ref:{
    _none:"None",
    ".":"Continue To Next Action",
    "..":"Break Current Test",
    "...":"Break Group",
    "....":"Stop All Tests",
    _refOfSuccess:"Continue To Next Action",
    _refOfFailed:"Continue To Next Action",
    _refOfError:"Break Test Case",
    _refPath:"Test",
    _exit:"Exit Options",
    _report:"Report Result",
    _gotoFlag:"Goto flag",
    _refreshWindow:"Refresh page",
    _limitLoop:"Limit loop",
    _maxTimes:"Max {0} times",
    _times:"Time(s)"
  },
  _domRootDefinition:{
    _title:"Defined Root Dom",
    _update:"Update all actions",
    _notUpdate:"Update item only",
    _confirmUpdate:"Do you want to base on the new path to update all the action elements under the module? \n\nIf yes, you need to make sure that all test cases in question haven't been locked by other team members.",
  },
  _innerWin:{
    _addScript:"Add Script ...",
    _darkModel:"Dark mode",
    _lostFocus:"Lost focus",
    _skip:"Skip",
    _launchBtn:"Launch Toolbar",
    _moduleName:"Module Name",
    _testName:"Test Case Name",
    _scope:"Use data scope",
    _bindData:"Build Data bind",
    _dataPath:"Data path",
    _form:"Pick value from Form",
    _domPath:"Element Path:",
    _tools:{
      _title:"Options",
      _recordInsert:"Record (Insert into selected Test Case)",
      _recordAdd:"Record (Create new Test Case into selected Module)",
      _addAfterAction:" (new actions are inserted after selected action)",
      _addAtTop:" (new actions are inserted at the top of the test case)",
      _dataBind:"Bind Data",
      _dataBindInRecording:"Bind Data",
      _autoValidationInRecording:"Auto Validation (In Recording)",
      _checker:"Checker",
      _invalidPath:"The path is not valid!",
      _invalidChecker:"The checker is required!",
      _checkerParameters:"Parameters: name and value",
      _showIDE:"Show tool window"
    },
    _save:"Save",
    _error:{
      _noItemInDom:"Didn't find input-box for data binding in the selected area (input, select or textarea)."
    }
  },
  _tools:{
    _title:"Tools",
    _ideSize:"IDE window size ({0})",
    _appSize:"APP window size",
    _autoAppSize:"Auto control APP window size",
    _ideKey:"IDE Keyword",
    _jsKey:"JS Keyword",
    dark:"Dark mode",
    light:"Light mode",
    system:"System mode",
    _BZPublicCode:"Use handles: \n\n"
                  +"Data scopes: $project, $module, $test\n"
                  +"Loop iteration data: $loop, $group, $action\n"
                  +"Current element: $element\n"
                  +"Execute result: $result ($result.status: success, failed)\n"
                  +"Invoke util functions: $util.xxxxxx",
    _insertCodeDescription:"Use: {{ ... }} to insert data/script",
    _currentVersionOnly:"Current branch only ({0})",
    _suggestJsCodeFormat:"Supports Javascript with syntax highlighting\n\n",
    _jsonWithData:'Support JSON format with test data. The format like:\n\n{\n  "id":"xxxxxx",\n  "name" : $parameter.name,\n  value : $project.value\n}',
    _suggestValidationJsCodeFormat:"Validation JS Code style:\n(function(){\n  ......\n  return true/false;\n  /"+"/Tip: Use double brackets to insert standard code\n})()\n\n",
    _bindDataJsCodeFormat:"Validation Data code style:\nxxx.xxx\nxxxx.xxxx",
    _suggestJsDataFormat:"There are 2 style for Script data: \n Simply way: \nxxxx; (ex. Date.now()). The function code will be executed once only, the value not change. \n or \nfunction way:\nfunction(){\n  ......\n  return xxx\n}\nThe function code will be executed every time it be called. The reture value can be different every time.",
    _jsonPlainFormat:"Supports JSON and plain text format",
    _cvsFormat:"Supports plain text, and interval by TAB. Exp.\n\nfirstName\tlastName\tuserName\nTom\tBush\tuser1\nFlora\tLi\tfl",
    _matrixFormat:"Supports plain text, must have key column(_"+"key), and interval by TAB. Exp.\n\n_"+"key\tfirstName\tlastName\tuserName\nadmin\tTom\tBush\tuser1\nmanager\tFlora\tLi\tfl",
    _regexFormat:"Format: Regular Expression",
    _regexFormat2:"Format: Regular Expression (/....../g)\n\nSupports multiple rows",
    _file:"Upload sharing file",
    _advData:"Advanced Data",
    _selectDownloadVersions:"Please select download versions:",
    _insertRegex:"Regex - Generate Data",
    // _insertValRegex:"Regex - Match Data",
    _insertCondition:"Condition",
    _insertOrgRegex:"Insert Original Regex definition",
    _elementFilter:"Element Filter",
    _filter:"Filter",
    _style:"Style",
    _styleOptions:"Style options",
    _layoutIDEAPP:"Re-layout the size and position of the IDE and APP windows.",
    _ignoreReqDesc:"Set ignore request path",
    _newIgnorePath:"New Ignore URL",
    _notChangeHeader:"Update field name not supported here.",
    _existIgnoreList:"Ignore Requests List",
    _showFilterElement:"Show",
    _removeFilterElement:"Hide",
    _csvTab:{
      _table:"Table",
      _txt:"Text"
    },
    _setting:"Settings",
    _uploadData:"Upload data setting",
    _filterDesc:"Filter format\n\ntag: xxx, like: button\nclass: .xxx, like: .btn\nid: #xxx, like: #item\n attribute: [xxx], like: [data-qa], note: support * on filter by attribute. like: [data-bz-*]"
  },
  _console:{
    _title:"Console",
    _monitorData:"Monitor Data",
    _clear:"Clear Console [Ctrl/Cmd + L] \n(cmd: $console.clear())"
  },
  _help:{
    _title:"Help",
    _learn:"Show help",
    _hideLearn:"Hide help",
    _syntax:"Boozang Syntax",
    _video:"Video Tutorials",
    _doc:"Documentation",
    _sbsVideo:"Video helper",
    _sbs:"Step by step",
    _missElement:"Element cannot be found. Step-by-Step is broken. Please be sure you have at lease one Module, one test case and your application page is launched as well. And try again."
  },
  _syntax:{
    test:{
      loopData:"loop/$loop/batch",
      tag:"tag",
      link:"always reloads/load/url/page",
      follow:"never reloads",
      followCheck:"host mismatch",
      followSameURL:"URL mismatch",
      host:"root url/host"
    },
    action:{
      validate:"validate/validation",
      extract:"extract/get/take/pick",
      plug:"call/ref/plug/reference/run/execute",
      refresh:"refresh",
      comment:"comment",
      js:"script/js/javascript",
      validateResponse:"validate response",
      extractResponse:"extract response",
      group:"group",
      visit:"visit"
    },
    advance:{
      refOfError:"error",
      refOfSuccess:"success",
      refOfFailed:"fail",
    },
    event:{
      click:"click",
      mousedown:"mousedown",
      mouseup:"mouseup",
      mousemove:"mousemove",
      mouseover:"mouseover",
      mouseout:"mouseout",
      hover:"hover",
      dblclick:"double click/dblclick",
      rightclick:"right click",
      keypress:"keypress",
      keyup:"keyup",
      keydown:"keydown",
      keygroup:"key/keygroup",
      typing:"typing",
      set:"set/put/input/change",
      check:"check/select",
      uncheck:"uncheck",
      dragdrop:"dragdrop",
      drag:"drag",
      retrieve:"retrieve",
      fillform:"fillform",
      alert:"alert",
      call:"ref/reference/call",
      group:"group"
    },
  },
  _syntaxExtra:{
    compare:{
      "==":"equal/==/=",
      "!=":"not equal/!=",
      include:"include/includes",
      exclude:"exclude/excludes",
      ">":"greater than/>",
      ">=":"greater than or equal to/>=",
      "<":"less than/<",
      "<=":"less than or equal to/<=",
      regex:"regex",
      "bz-compare-issue":"found issue",
      "bz-compare-error":"found error",
    }
  },
  _script:{
    _askDescToAction:"Convert text to Actions?",
    _parseTxtFailed:"Failed on parse text to action: {0}\n\nMessage: {1}",
    _options:{
      _alwaysSuccess:'always success',
      _timeout:'timeout',
      _delay:'delay',
      _flag:'flag',
      _successGotoFlag:'on success goto',
      _failedGotoFlag:'on failed goto',
      _errorGotoFlag:'on error goto',
      _successGotoTest:'on success test|play|execute',
      _failedGotoTest:'on failed test|play|execute',
      _errorGotoTest:'on error test|play|execute'
    },
    _matchDesc:{
      kwk1:/^(validate|drag)[:： ]*({w}) +(is exist|is unexist|is enable|is disable|from (\[[xy= 0-9,，]+\]) to (\[[xy= 0-9,，]+\])) *([\(](.+)[\)])?$/i,
      kwk2:/^(extract|get)( data of| value of|[:：]) *([^(]+) *([\(](.+)[\)])?$/i,
      kwkw1:/^(validate|set|typing)[:： ]*(.+) *([=><!]+) *([^\(]+) *([\(](.+)[\)])?$/i,
      kwkw2:/^(dragdrop)[:： ]*(".+"|'.+'|`.+`|.+) +to +([^\(]) *([\(](.+)[\)])?$/i,
      kw:/^(validate script|validate form|validate form fields?|click|right click|double click|mousedown|mouseup|mousemove|mouseout|mouseover|check|uncheck|alert|open link|open url|go ?to link|go ?to url|reset data|script|play|call|test|reference|ref\.|check links?|fillform|fill form)[:： ]*([^\(]+) *([\(](.+)[\)])?$/i
    },
    _actionMap:{
      "validate script":{type:0,method:1},
      validate:{type:0,method:0,content:{}},
      click:{type:1,event:{action:"click",type:"mouse"}},
      hover:{type:1,event:{action:"hover",type:"mouse"}},
      mousedown:{type:1,event:{action:"mousedown",type:"mouse"}},
      mouseup:{type:1,event:{action:"mouseup",type:"mouse"}},
      mousemove:{type:1,event:{action:"mousemove",type:"mouse"}},
      mouseout:{type:1,event:{action:"mouseout",type:"mouse"}},
      mouseover:{type:1,event:{action:"mouseover",type:"mouse"}},
      "right click":{type:1,event:{action:"rightclick",type:"mouse",button:2}},
      "double click":{type:1,event:{action:"dblclick",type:"mouse"}},
      dragdrop:{type:1,event:{action:"dragdrop",type:"mouse"}},
      drag:{type:1,event:{action:"drag",type:"mouse"}},
      set:{type:1,event:{type:"change",autoBlur:1}},
      typing:{type:1,event:{type:"key",action:"group"}},
      check:{type:1,event:{type:"change",autoBlur:1,value:true}},
      uncheck:{type:1,event:{type:"change",autoBlur:1,value:false}},
      extract:{type:2,method:0},get:{type:2,method:0},
      script:{type:3},
      play:{type:4},call:{type:4},test:{type:4},reference:{type:4},ref:{type:4},trigger:{type:4},execute:{type:4},
      alert:{type:5},
      "open link":{type:6},"open url":{type:6},
      "reset data":{type:6,refreshType:"data"},
      group:{type:7},
      "check links":{type:8},
      "validate form":{type:9},"validate form fields":{type:9},"validate form field":{type:9},
      fillform:"","fill form":""
    },
    _templates:{
      0:{//_validate
        exist:'Validate: "{0}" is exist',
        unexist:'Validate: "{0}" is not exist',
        screenshot:'Validate: "{0}" md5 is "{1}"',
        data:'Validate: "{1}" in "{0}"',
        text:'Validate: "{0}" = "{1}"',
        value:'Validate: "{0}" = "{1}"',
        enable:'Validate: "{0}" is enable',
        disable:'Validate: "{0}" is disable',
        script:'Validate script: "{0}"'
      },
      1:{//_event
        click:'Click "{0}"',
        rightClick:'Right click "{0}"',
        dblclick:'Double click "{0}"',
        dragdrop:'Dragdrop "{0}" to "{1}"',
        drag:'Drag "{0}" from [{1}] to [{2}]',
        change:'Set "{0}" = "{1}"',
        key:'Typing "{0}" = "{1}"',
        check:'Check "{0}"',
        uncheck:'Uncheck "{0}"',
      },
      2:'Get data of "{0}"',  //extract
      3:'Script "{0}"', //script
      4:'Call "{0}"', //callTest
      5:'Alert "{0}"',  //alert
      6:{
        "":'Open link: "{0}"',  //gotoUrl
        "data":'Reset data: "{0}"',  //refreshData
      },
      7:'"{0}" group', //Group
      8:'Check links on "{0}"',
      9:'Form validation on "{0}"'
    }
  },
  _syntaxOption:{
    process:{
      _refresh:"refresh",
      _break:"break",
      _breakGroup:"break group",
      _continue:"continue",
      _stop:"stop/end"
    },
    result:{
      _success:"report success",
      _warning:"report warning",
      _failed:"report failed",
      _error:"report error",
      _crash:"report crash"
    },
    response:{
      httpMethod:"method",
      httpURL:"link/url",
      httpHeaders:"header/headers",
      httpData:"data",
      type:"type",
      ignore:"ignore",
      nullValue:"null",
      emptyValue:"empty",
      status:"status",
      data:"data",
      jsonKey:"ignore key",
      jsonValue:"ignore value",
      downloadAsFile:"download as file"
    },
    format:{
      exist:"exist",
      screenshot:"screenshot",
      innerText:"innertext",
      innerHTML:"innerhtml",
      outerHTML:"outerhtml",
      data:"data"
    },
    mouse:{
      x:"x",
      y:"y",
      key:"key",
      download:"download/download action/as download action",
      dragdrop:"{0} to {1}"
    },
    key:{
      ctrl:"ctrl",
      alt:"alt",
      shift:"shift"
    },
    loop:{
      loopStart:"start",
      loopEnd:"end",
      exitLoop:"exit/exit loop on error"
    },
    refresh:{
      cookie:"cookie",
      locationStorage:"localstorage"
    }
  },
  _aiHandler:{
    _note:"Note: Ctrl/Cmd + Click on key word to add or update object definition (use CMD key for Mac)",
    _noPaste:"Unfortunately, cannot execute paste operation from menu. Type 'Ctrl + V' from your keyboard.",
    _selectOptionMsg:"Please select one option first, and start.",
    _emptyActionToDescIssue:"There is no action!",
    _emptyDescIssueToAction:"There is no description!",
    _toActionsMsg : "<label class='modal-option1'><input type='radio' name='_updateWay' value='_action'/> Generate <u>actions</u> from <u>test case description</u></label>\n"
                  + "<label class='modal-suboption'><input type='radio' name='_toActionOption' value='1' disabled/> Override the current test case only</label>\n"
                  + "<label class='modal-suboption'><input type='radio' name='_toActionOption' value='2' disabled/> Override all passing test cases</label>\n"
                  + "<label class='modal-suboption'><input type='radio' name='_toActionOption' value='3' disabled/> For empty test cases only</label>\n\n\n"
                  + "<label class='modal-option2'><input type='radio' name='_updateWay' value='_desc'/> Generate <u>test case description</u> from <u>actions</u></label>\n\n\n"
                  + "<label class='modal-option2'><input type='radio' name='_updateWay' value='_update'/> Re-generate action element path (for migration)</label>\n"
  },
  _nav:{
    _currentTest:"Working Test Case",
    _explorers:{
      workspace:"Workspace",
      module:"Module Explorer",
      feature:"Feature Explorer",
      "ai-model":"Model Explorer",
      com:"Component Explorer",
      search:"Search",
      git:"Source Control",
      logs:"Reports",
      "root-cause":"Known Issues"
    },
    _searchDesc:"Search in modules / tests / actions ...",
    _filterMenu:"Filter on module/feature/test id and name",
    _filterCommit:"Filter on commit message",
    _filterBranch:"Filter on branch name",
    _searchInAction:"Search action"
  },
  _bug:{
    _title:"Bugs",
    _missEmail:"Missing email! Please fill an email.",
    _mailContent:"Hello,\n\n\nPlease check the test case. Thanks\n\nBest regard,\n\n"
  },
  _com:{
    _title:"Component",
    _asOneAction:"Execute as single action in App window",
    _identifyElementCss:"Identify element (CSS)",
    _identifyElementCssDesc:"Set identify element to help IDE find component element\nand set proper element path on recording and scanning",
    _oneWordNameError:"Only A-Z, a-z, 0-9 can be used to name component.",
    _conflictNameError:"This name conflicts with the system method name! Please consider other name."
  },
  _team:{
    _title:"Team",
  },
  _chat:{
    _title:"Chat & Message",
    _clear:"Clear chat",
    _postMethod:"Ctrl / Meta + Enter to submit message",
    _showPopInfo:"Show pop Info"
  },
  _sync:{
    _title:"Synchronize"
  },
  _importantInfo:{
    _record:"WE ARE NOW RECORDING. ALL BROWSER INTERACTIONS WILL BE CAPTURED. \n Use toolbar to add validations and comments, and to stop recording.",
    _success:"Success!",
    _failed:"Failed!",
    _stop:"Stop!",
    _loadingData:"Loading data ...",
    _timer:"Waiting {0}"
  },
  plugInfo:{
    record:"Recording",
    play:"Playing",
    ctrl:"Controlling"
  },
  _dataBind:{
    _jsonTransfer:"JSON Transfer",
    _requireMatrixKey:"As a Matrix data, the first column name must be '_"+"key'",
    _fillExistDataOnly:"Do you want Boozang to auto-generate form content where it cannot find matching data?\n\nBy clicking 'Yes', Boozang will auto-generate dummy data based all fields. Otherwise only fields with matching data will be filled.",
    _confirmFillField:"Adjust pre-filled data and click 'continue' on Boozang toolbar to finalize data bind.",
    _keyExist:"The key ({0}) exists, and it is in different format. Please use other key.",
    // _autoClose:"Keep mouseover on the close icon, \nthe data-bind menu will auto-close in 3 seconds.",
    _overWrite:"Overwrite: ",
    _noOverWriteOption:"There is no default data to overwrite.",
    _selectOverWriteData:"Select which data you want to overwrite：",
    csv:"CSV/Matrix (comma-separated or tab-separated values)",
    file:"File",
    json:"JSON",
    _bindFailed:"Bind data failed! Please try it manually.",
    _bindDataInfo:"Bind on: {0}",
    _hasData:"The item contains data",
    _defParameter:"Default Parameter",
    _doData:"Copy to Data",
    _refData:"Load Data",
    _dataNameIssue:"Data name is not correct. Data name cannot includes space, dot(.) and other mark letters.",
    _overrideDataIssue:"The same data name already exist, but it is in different data type. You cannot override it.",
    _parameterToData:"Default Parameter to Data",
    _parameterToValue:"Set default parameter to: {0}",
    _dataFormatIssue:"Format issue: {0}",
    _askBuildData:"The data, {0} does not exist. Would you like to create the data?",
    _noExistModuleInAlias:"No module with alias {0} was found",
    // _autoFill:"Do you want to auto bind-data?",
    _loadDataFailed:"Load data ({0}) failed! {1}",
    _noData:"There is no data to bind.",
    _autoFill:"Autofill Forms",
    _funErr:"Function Data setting error: ",
    _funNameErr:"The function data should not include a function name. The correct format should be: \n\nfunction(){\n  ...\n  return ...\n}",
    _empty:"[Empty]",
    _objData:"Object Data",
    _replaceKeyByParameter:"Replace key by $parameter",
    "bz-skip-group":"In testing, if use bz-skip as a value on an action \n(to set element, typing value or reference other test case), \nthe current action group will be skipped to next.",
    "bz-skip":"In testing, if use bz-skip as a value on an action \n(to set element, typing value or reference other test case), \nthe action will be skipped to next.",
    "bz-stop":"In testing, if use bz-stop as a value on an action \n(to set element, typing value or reference other test case), \nthe current test case will be stopped",
    _asParameter:"Make $parameter = '{0}'",
    _setNewValue:"Update data <b>{0}</b> value, from: <b>{1}</b> to <b>{2}</b>",
    _errorFrom:"(Error from: {0})",
    _options:{
      _email:"Email",
      _phoneNumber:"Phone Number",
      _address:"Address",
      _postCode:"Post Code",
      _name:"Name",
      _number:"Number",
      _decimal:"Decimal",
      _string:"String",
      _url:"Link"
    },
    _typeDesc:{
      _property:"Properties are for name-value pairs. This is a good way to store strings and numbers.",
      _file:"Files are used to upload example data. Keep the file size below 5 Kb.",
      _csv:"Used to handle spreadsheet data. It can be used to drive data loops. ",
      _object:"JSON objects are used to group data together. Ideal to handle a set of name-value pairs, such as form data.",
      _array:"Arrays are used to handle data sequences. Can be used to drive data loops.",
      _mixed:"Mixed data is generalized JSON data. User can use any structure as long as it complies with the JSON format.",
      _req:"Request data is used to fetch external data. CSV, file and object type are supported. ",
      js:"Javascript data allows you to construct functions in Javascript code to generate dynamic data.",
      _matrix:"Matrix data is a complex data type used to drive tests. Similar to CSV, except that each row has to have a key, so it can be fetched by name."
    }
  },
  _auth:{
    _checkAll:"Check All",
    _editDefTests:"Edit default authorization item setting",
    _roleSetting:"Role data setting",
    _skipAuthData:"Skip Authorization Data setting (not recommended)",
    _noCatchRequest:"Didn't catch any API requests.\n\n1. Stop the process by click 'Close' button, and try again. \n2. Ask the developer of the application, and fill the API test case manually.",
    _missHeaders:"Please select a token request and specify the token",
    _missSelectRequest:"Please specify a API request",
    _toAIApi:"Create AI Modules",
    _missHost:"The host ({0}) hasn't been defined. Do you want to add it to the environment setting now?",
    _notFromHost:"The request is not defined. Please add the host into environment setting.",
    _tokenRequest:"Request base on token",
    _title:"Authorization Setting - ",
    _generateWizard:"Generate Test Case",
    _module:"Auth-Module Name",
    _moduleName:"Authorization",
    _linkToModule:"Select module",
    _linkToTest:"Select test case",
    _linkToData:"Select user data",
    _chkSignIn:"Check sign-in status",
    _generalTests:"Sign-in / Sign-out",
    _apiTests:"API-Sign-in / API-Sign-out",
    _tokenTest:"Retrieve API Token",
    _loginValidateGroupDesc:"Pre-validation for sign-in status",
    _role:"Role (Unique)",
    _username:"Username",
    _password:"Password",
    _validation:"User Identifier",
    _validationDesc:"Ex. first / last name",
    _other:"Other",
    _othAttr:"Other login attributes",
    _authStaticSetting:"Static Authorization Setting",
    _storePersonal:"Select it to store the data as Personal Data",
    _generateTests:"Do you want our AI to generate the below test case for you?",
    _checkTest:"Check all accounts",
    _checkApi:"Check all API",
    _curAuthValue:"Current Token",
    _login:"Log in",
    _logout:"Log out",
    _desc:{
      _role:"User role, \nsupport for single user to have multiple roles,\nand support for multiple users to have the same role",
      _identifier:"Recognized characters of the user on the interface",
      id:"ID of user data in the database (mostly used for API testing)"
    },
    _testDesc:{
      _clickTriggerRequest:"Click a link to trigger a request with Authorization token",
      _verifyTokenExist:"Verify retrieved token on host",
      _todoToken:"Please be clicked element and be sure it will trigger a API request (with target token).",
      _setSignStatus:"Base on real time sign-in status and required sign-in user to get properly sign-in flow (test case)",
      _chkSignIn:"Check if you are already signed in",
      _todoChkSignIn:"Please be sure the identifier element path is correct. \n\nNote: the action is required. DO NOT REMOVE!",
      _todoUsername:"Please be sure the username input element path is correct. \n\nAnd you can insert steps before or after if necessary.\n\nNote: the action is required. DO NOT REMOVE!",
      _todoPassword:"Please be sure the password input element path is correct.\n\nNote: the action is required. DO NOT REMOVE!",
      _todoLogin:"Please be sure the login button element path is correct.\n\nNote: the action is required. DO NOT REMOVE!",
      _todoSignInApi:"Please correct the sign-in api request setting\n\nNote: the action is required. DO NOT REMOVE!",
      _todoSignOutApi:"Please correct the sign-out api request setting\n\nNote: the action is required. DO NOT REMOVE!",
      _todoChkSignInOption:"Please be sure the identifier element path is correct. \n\nNote: the action is optional. It can be removed",
      _chkSignOut:"Check if signed out",
      _todoSignOut:"Please be sure the sign-out button element path is correct. \n\nNote: the action is required. DO NOT REMOVE!",
      _chkSignInSuccess:"Check if signed in successfully.",
      _confirmSignOut:"Click Confirm sign-out",
      _todoConfirmSignOut:"Please be sure the confirm button element path is correct. \n\nIf the button is unexist, you should remove the action",
      _chkSignOutSuccess:"Check if signed out successfully.",
      _todoRefresh:"Refresh page to prepare for next validate step\n\nNote: the action is optional, can be removed",
      _todoSignOutSuccessOption:"Please correct the sign-in identifier element path. \n\nNote: the action is optional, can be removed",
      _todoSignInStatus:"Please correct the element path, which should appear on any page after sign-in. \n\nNote: the action is required. DO NOT REMOVE!"
    },
    _authType:{
      "":"No Auth",
      api:"API Key",
      basic:"Basic Auth",
      bearer:"Bearer Token",
      digest:"Digest Auth",
      oauth1:"Oauth 1.0",
      oauth2:"Oauth 2.0",
      hawk:"Hawk Authentication",
      aws:"AWS Signature",
      ntlm:"NTLM Authentication",
      akamai:"Akamai EdgeGrid"
    },
    _new:{
      _module:"Required field. Create new module as Authentication module",
      _tests:{
        signIn:"Sign in",
        signOut:"Sign out",
        signInApi:"API Sign in",
        signOutApi:"API Sign out",
        hasSign:"Check sign-in status",
        token:"Retrieve API Token",
      },
      _data:"Required field. Create new data as Authentication user data"
    },
    _tokenSetting:"Token Setting",
    _noteUseToken:"Note: If the token is a dynamic, and can be retrieved from a page request, the best solution is to create a Retrieve Token Test case. After that, the tool can trigger it to get a realtime token when needed, and add it to the request headers.",
    _assignDefAuth:"Precondition - login as user",
    _missDataErrMsg:"Missing Login Data! \n\nDo you want to ignore the issue and continue?",
    _missFieldErrMsg:"Missing some required fields!",
    _dataMapping:"Mapping Data",
    _dataScope:"Some Username/Password data are personal data",
    _personalDataInfo:"Note: Please Point out which sign-in data is personal data in the table. The personal data will be stored in project Custom data, and non-personal data will be store in project Default Data. "
  },
  _aiTask:{
    _browsePages:"Browsing pages ...",
    _generateTest:"Generate test case： {0}",
    _updateTest:"Update test case： {0}",
    _generateModule:"Generate module: {0}",
    _updateModule:"Update module: {0}",
    _complete:"Completed!",
    _afterBrowse:"Completed browsing the application, but didn't find all required elements to complete the generating task!",
    _findElement:"Found element: {0}",
    _completeTest:"Complete test case: {0}",
    _confirmCancelWizard:"You haven't completed all steps! \n\nAre you sure you want to exit current wizard please?",
    _cancelTask:"Canceled wizard of {0}",
    _optimizeTest:"Finalize the test case",
    _validateStep:"Click the selector button to pick an element that confirms sign-in successful",
    _validateComplete:"Validation action of {0} completed",
    _reqSignOut:"Handle require sign-out",
    _getAuthFlowByRole:"Base on real time sign-in status and required sign-in user to get properly sign-in flow (test case)",
    _signIn:{
      _key:"sign-in",
      _confirmPage:["Navigate to the login page"],
      _record:["Click record button to record the sign in","Recording","Record Sign in completed"],
      _signInTip:["Tip: You should see a data-bind menu under the input box. If there is a browser auto-complete cover it, you can type 'ESC' key to close the menu."],
      _pickRequests:["Select request(s) for generate Sign in API"],
      _validateBefSignIn:"before sign in",
      _validateAftSignIn:"after sign in",
      _validateFormTip:["Tip: The selected element should only occur when signed out"],
      _validateStatusTip:["Tip: The selected element should indicate that you are signed in as the current role."],
      _recordTip:["Tip: If the username/password is pre-filled, you should remove them before starting to record."]
    },
    _signOut:{
      _key:"sign-out",
      _confirmPage:["Confirm that you are signed in."],
      _record:["Click record button to record the sign-out procedure.","Recording","Sign out procedure completed"],
      _validateBefSignOut:"before sign out",
      _pickRequests:["Select request(s) for generate Sign in API"],
      _validateTip:["Tip: The selected element should always occur when signed in as any role"]
    },
    token:{
      _confirmPage:["Confirm that you are signed in"],
      _record:["Click record button to record a process","Recording","Trigger Request completed"],
      _tip:["Tip: The process should trigger a request with token"],
      _list:["Request list:"],
      _pickToken:["Specify token name from retrieved request list"]
    },
    _module:{},
    _modules:{},
    _add:{},
    _edit:{},
    _delete:{},
    _workflow:{}
  },
  _gui:{
    refOfError:"On error",
    refOfSuccess:"On success",
    refOfFailed:"On fail",
    refOfTimer:"Set delay",
    _verticalView:"View in Vertical Style (Ctrl/Cmd + V)",
    _horizontalView:"View in Horizontal Style (Ctrl/Cmd + H)",
    _linearView:"View in Linear style",
    _stablePageOnPlaying:"Stable page on playing",
    _testItem:{
      width:"Test case item Width",
      height:"Test case item Height",
      spaceX:"Test case X-Separation",
      spaceY:"Test case Y-Separation"
    },
    _actionItem:{
      width:"Action item Width",
      height:"Action item Height",
      spaceX:"Action X-Separation",
      spaceY:"Action Y-Separation"
    },
    zoom:"View Scale",
    _details:"Details",
    _data:"Scenario Data",
    to:"Downstream",
    from:"Upstream",
    _resetDef:"Reset default",
//    shadow:"Show Shadow",
    // desc:"Show Special Trigger Description",
    _end:"End"
  },
  _monitor:{
    _end:"Remote server playing end!",
    _followMonitor:"The monitor is playing, do you want to switch to monitor it right now?"
  },
  _cooperation:{
    _title:"Cooperation Service",
    _listTabs:{
      "":"All",
      _success:"Success",
      _failed:"Failed",
      _testing:"Testing",
      _waiting:"Waiting"
    },
    _realtimeWorkerList:"Realtime worker list",
    _filterInWorker:"Filter by worker",
    _filterInModule:"Filter by module",
    _taskList:"Task List",
    _completedIn:" Completed in ",
    _newTask:"Launch new Task",
    _unExistInCurVersion:"Not exist in the current branch!!!",
    _saveReport:"Store test report",
    _splitTask:"Split task({0}): {1}",
    _splitSuite:"Split suite({0}): {1}",
    _noteTask:"Note: You can check the result in the report",
    _initTest:"Initial Test case",
    _waitingTask:"Waiting on {0}, declared by {1}, {2}",
    // _exeInTmpVersion:"Execute in a temporary clone version (On stand alone only)",
    _alwaysRestart:"Always execute initial test case after reload IDE",
    _asCenter:"Responsible for collecting test results",
    _funScope:"As a designated function server",
    _missCenter:"No server found to accept the task",
    _notCoopServer:"I am not a cooperation server",
    _notSupport:"You don't have permission to post task on the server",
    _generateLink:"Generate My account Cooperation Server Link",
    _specifyNo:"Server key must fill in letter and number, cannot be empty",
    _specifyGroup:"Group No. must fill in letter and number, cannot be empty",
    _specifyScope:"Server Scope/Tag must fill in letter and number, but can be empty",
    _selfOnly:"Service to myself ({0}) only",
    _aloneService:"Stand alone service",
    _autoService:"Free combination of services",
    _alertSelectExeGroup:"Please select a scope to execute your test case",
    _specifyRole:"Specify application role",
    _serverNo:"Server key",
    _workers:"Workers",
    _passData:"Pass data",
    _responseData:"Response data",
    _specifyFun:"Specify function Service Scope",
    _bzUpdateInfo:"Boozang updated! Please refresh your browser to get the latest version.\n\n\nClick to <a onclick='location.reload()'>Refresh (F5)</a>",
    _specifyAppRole:"Specify AI Authorization Role to execute",
    _scope:"Scope",
    _group:"Group No.",
    _emptyList:"No cooperation server",
    _remoteExe:"Execute on remote server",
    _missingScopeSetting:"As a cooperation server, a Scope Service is required! \n\nPlease setup a Scope Service in:\n\n project setting → Integration → Cooperation Service",
    _afterRemoteExe:{
      _waitResult:"Wait for the result to continue",
      _noWaitResult:"Do not wait for the result, immediately execute the next action"
    },
    _statusDesc:"{2}, {3}, Root {0}, Completed in {1}.",
    _initDesc:"Executing initial test case {0}, complete in {1}",
    _confirmRemote:"Do you want to execute the test case in a remote cooperation server?\n\nYou can specify a server or group the list below, \nor let us pick the best one for you.",
    _specifyServer:"Specify server by server scope/tag",
    _cooperatorDesc:"A cooperator server remote commands to execute test cases. User can through this feature command multiple servers to complete a complex test job (like: Validate realtime socket synchronized data), or command different servers to complete test jobs from different modules at the same time. ",
    _service:"Support Service",
    _appRole:"Testing Application Role scope",
    _ideRole:"Accessible team roles",
    _allRoles:"Support to test on any role",
    _allUsers:"Support service for any team member",
    _host:"App & Host",
    _exclusive:"Require Exclusive Service",
    _noWait:"No-wait test result",
    _optionUnderCooperation:"Note: The options only are available for cooperation test service",
    _server:"Server",
    _acceptRoles:"Allow access roles",
    _allowAll:"All roles",
    _status:"Status",
    _statusType:{
      idling:"Idling",
      testing:"Testing",
      waiting:"Waiting",
      initializing:"Initializing",
      suspense:"Suspend",
      declare:"Declare",
      report:"Submit Report"
    },
    _operation:{
      _report:"Report status",
      _shutdown:"Shut down",
      _reboot:"Reboot",
      _clean:"Clear tasks",
      _stop:"Stop current task",
      _setting:"Setting ...",
      _suspense:"Suspend Tasks",
      _restart:"Restart Tasks",
      _join:"Join Testing",
      _screenshot:"Take Screenshot",
    },
    _tasks:"Tasks",
    _unknown:"Unknown",
    _onlineList:"On-line servers: ",
    _scopeList:"Server Scopes: ",
    _tester:"Tester",
    _list:"Waiting List",
    _noRoleCase:"[Unspecified Role Test Case]",
    _noServer:"Your selected servers are not in service. Try using another cooperator server. ",
    _noService:"There is no cooperation service from the server({0}). Please contact the server administrator.",
    _notInService:"You are not in the service list of the server ({0}). Please contact the server administrator."
  },
  _aiDefinition:{
    _error:{
      _missValidField:"Missing field setting",
      _missValidations:"Missing validations setting",
      _missValidItem:"Validation missing",
      _missValidType:"Validation type missing",
      _missReopenPoint:"Missing re-open point",
      _missingCloseButton:"Missing close/cancel button on form (to trigger re-open form)"
    },
    _key:"_"+"key",
    _timer:"Timer Setting",
    _skipLogin:"Ignore identify Authorization",
    _aiSetting:"AI Setting",
    _validForm:"{0} form",
    _oprName:"{0} {1}",
    _startUrl:"Start URL",
    _forDelete:"Validate deleted",
    _flowSetting:"Data flow setting",
    _fromStatus:"From Status",
    _toStatus:"End Status",
    _scriptDesc:"To use $parameter reference the attributes of the form\n\nAnd base on condition set suitable value on $parameter",
    _confirmToBuildDataTypeByEnum:"Do you want to build the below data type in the current module?\n\n{0}",
    _forField:"For field: ",
    _fakeElement:"No main element",
    _noSetFakeElement:"No allow to set element on a Fake element",
    _triggerByData:"Trigger by data",
    _toGenerateDataByOuterOperation:"Generate data '{2}' through the '{1}' operation in the '{0}' module",
    _missingOprSetting:"[Process operation is not set]",
    _oprListOfStatusUpdate:"Operations of '{0}' to '{1}'",
    _missLabelField:"Missing Label field setting",
    _preStepsForm:"Pre-steps of fill form",
    _skipOnParentCtrl:"Skip on controllable parent case(inner form)",
    _parentCtrl:"Submit data with the parent form",
    _requiredOperation:"Required Operation",
    _parentDependenceNode:"Parent node dependencies:",
    _missInitData:"The initial data setting on the module is missing, or the initial data field does not match: {0}",
    _isDataWord:"Is '{0}' a data?",
    _missStartPanel:"Miss set {0} module 'Start Style'",
    _missingDemoValue:"Missing required demo value on field '{0}'",
    _unExistField:"Un-exist field '{0}'",
    _alwaysExe:"Always executed (even if the current field data is bz-skip)",
    _maybeNoExist:"Maybe not exist or disabled element",
    _colName:"Column Name",
    _applyFlowDataType:"Module data type suitable for the flow",
    _applyFlowAuth:"Roles suitable for the flow",
    _scenarioName:{
      add:"Add {0} scenario",
      add2:"Add {0} ({1}) scenario",
      edit:"Update {0} from {1} to {2} scenario",
      delete:"Delete {1} {0} scenario"
    },
    _authOptions:{
      "*":"* (Any case)",
      "sign-in":"Sign-in with any role",
      "sign-out":"Sign-out"
    },
    _templateOptions:{
      "":"Blank",
      _default:"Default template (CRUD)",
      _clone:"Clone other module",
    },
    _dataTypeCase:"Data type cases",
    _authCase:"Auth cases",
    _generateScenario:"Generate Scenario",
    _mainTestType:"Main testing type",
    _aliasDesc:"As variable name in Script",
    _targetField:"Target value",
    _curUser:"$curtAppLoginUser",
    _newParameter:"new",
    _missingDefRoleDefine:"Missing setup default role. Please set in <a href='javascript:_Util._gotoPageFromModelWindow(\"settingEnvironment\",this)'>Environment</a> setting",
    _new:"$new",
    $status:"{0}_"+"status",
    _oprDataType:"Operation Data Type",
    _businessData:"Business Logic Data",
    _exColumns:"Extra Columns",
    _duplicateDynamicAuthIssue:"Doesn't support multiple dynamic sign-in",
    _assignVariableTo:"Assign to object name $project.",
    _alwaysCreate:"Always create new data",
    _oprObjName:"Operate object name $project.",
    _takeVariable:"Take variable: $project.",
    _defScript:"/"+"/Pre-condition:\n{0}\n/"+"/Current operation data:\n$parameter",
    _asUserModule:"As User module (The data are the same as Authorization module)",
    _missSettingInField:"Missing setting in field: {0}",
    _curAccount:"Current Account(#account)",
    _inDisable:"{0} is in disabled",
    _loopOnRegex:"When the parameter is Regex, delete data in loop",
    _mainSuite:"Main Suite",
    _mainAccess:"Check access permission",
    _dependenceCauseDisable:"Dependency settings are causing some fields to be disabled",
    _tmpTestCase:"System Driving",
    _viewTest:"View Related Test cases",
    _noFieldInValidation:"Disable: {0}!!! There is no validation content (no fields setting in the panel)",
    _countChecker:"Count Checker",
    _clickConfirmButton:"Click confirm button",
    _setCurItemData:"Register the current data in system control data map",
    _dataNotReady:"The feature is base the the below setting (one or many)：\n\n{0}",
    _enterDetailLoopError:"The details enter should not in the details page.",
    _testDependence:"Call: {0}, to test '{1}' dependencies",
    _noTestForField:"There is no operation handle field: {0}",
    _noTryInRecording:"Not allow to try on recording. Do you want to stop recording now?",
    _staticPage:"Static pages",
    _mapField:"Mapping Field",
    _foundDisabledField:"The setting limits the below fields. Please consider the setting.\n\n{0}",
    _dependLoopError:"There is a dependency loop setting issue! Please reset\n\n{0}",
    _dependConflictData:"There is dependency value conflict issue!  Please reset:\n\n{0}",
    _curModule:"Current Module ($module)",
    _cleanData:"Clean Test Data",
    _permission:"Permission",
    _validTag:"Validation",
    _setIn:"Set value of '{0}'",
    _pickFromPanel:"Pick value from '{0}'",
    _validationName:"Valid: {0}",
    _fillFormLogic:"Fill {0} logic",
    _testFillForm:"Test - {0}",
    _validUnExist:"Valid un-exist in {0}",
    _refValidateExistDesc:"Validate data in {0}",
    _refValidateUnExistDesc:"Validate data not exist in {0}",
    _updateForm:"Update form",
    _doSubmit:"Do submit",
    _updateData:"Set attribute test",
    _fillFormScenario:"Fill form scenario",
    _statusScript:"Data State Control Script",
    _alwayCreateItem:"Always create a new {0}",
    _prepareDataNote:"Test cases that can be used to modify attributes to match required data.",
    _role:"Role",
    _identify:"Identify",
    _fullHyApp:"Fully hyperlink driving project (URL Analyzable)",
    _setTmpFlag:"Assign data-bz",
    _showTmpFlagScript:"Use temporary insert data-bz script",
    _avoidBzFlagElement:"Not use data-bz on element path",
    _statusSettingError:"Missing data status setting on module, {0}",
    _dependence:"Dependency",
    _operation:"Operations",
    _dataType:"Type",
    _inArray:"Submit data is in Array",
    _scenario:"Scenario",
    _tryLimit:"Doesn't support playing from here. Please try it in definition of module general",
    _missingOperationSetting:"There is missing {0} operation setting in module '{1}'",
    _missingWordSetting:"There is a missing on word: {0}",
    _noElementSetting:"There is not an Element Setting.",
    _createForUnExist:"Create {0} if current data is un-exist",
    _has:"There is one {0} (#status)",//For unit test case
    _hasNew:"There is one new {0} (#status)",//For unit test case
    _hasApi:"There is one {0}",
    _tmp:"Temporary test case (for debugging)",
    _nohas:"There is no any {0}",
    _setHas:"There is a setting of {0}",
    _mapTest:"Mapping Test Case",
    _selectPattern:"Select Pattern",
    _expectedResult:" (Expected result is {0})",
    _completeModel:"Completed create all \"{0}\" modules for all hosts",
    _selectHost:"Select building \"{0}\" on which server:",
    _depData:"Data",
    _oprParameter:"Parameter",
    _givenSetting:"Given item setting",
    _whenSetting:"When item setting",
    _thenSetting:"Then item setting",
    _scenarioRoleSetting:"Operation Role Setting",
    _oprParameterSetting:"Business Logic Parameter Setting",
    _oprRole:"Role",
    _dataDesc:"Column: {0}\nItems: {1}",
    _roleSetting:"Role Setting",
    _tmpTest:"Temporary test: to generate data '{0}' {1}",
    _accessTest:"Temporary test: to test access '{0}' of '{1}'",
    _actionDesc:{
      _getMatchData:"Found a usable data and assigned to variable: {0}"
    },
    _endStepsMethod:{
      set:"Set value",
      script:"Script set value",
      pick:"Pick value from panel"
    },
    _setting:{
      _details:"Details",
      _status:"Workflow Step",
      _fields:"Fields",
      _relatedModules:"Related Modules",
      _data:"Data",
      // _preScope:"Pre script",
      // _endScope:"Result script",
      _console:"Console",
      _src:"Model Source",
      _glossary:"Glossary"
    },
    _statusMap:{
      add:"Create",
      edit:"Modify",
      delete:"Delete"
    },
    _glossaryItems:{
      _refData:{
        _title:"Reference data key words",
        _options:{
          $project:"Used to reference project-level data. It can be accessed in any test case",
          $module:"Used to refer to the current module data.",
          $test:"Used to reference the current test case data.",
          $loop:"Used to refer to the loop data configured in the current test case.",
          $parameter:"The parameters passed when the current test case is called.",
          $group:"Used to reference group action data, all actions in this group can be accessed. This data must be an array or number. Used to generate cyclic execution of actions in the group. If the data is an empty array or 0, this set of actions will be skipped.",
          $action:"Used to refer to the action data, this data must be an array or number. Used for cyclic execution of this action. If the data is an empty array or 0, this action will be skipped.",
          $curtXXXX:"Used to refer to the current object data in the current module. In the test script generated by AI, this variable name will be generated based on the module alias and placed in $project. During the execution process, a test case will be automatically invoked according to the data situation, and the test efficiency will be improved.",
          $curtAppLoginUser:"Used to refer to the current user data. This data is placed in $project. Automatic role changes based on login/logout and permission settings of test cases.",
          $status:"AI model data status attribute value. Set in the AI model data status configuration. Ref. example： $project.$curtXXXX.$status"
        }
      },
      _setData:{
        _title:"Set data key words",
        _options:{
          "#any-exist":"Used to reference any existing data. Generally used to reference a related module in the form.",
          "#try-exist":"When the data of a certain module needs to be applied in the form, if the module has data, any data is quoted, if not, a data is created first, and then the form is quoted.",
          "#try-other":"Reference to the existing data in the form of a module data. Now if there are other data, it should be replaced by other data.",
          "#curtAppLoginUser":"Used to refer to the current app login user data, the final user attribute used is the attribute mapped in the field.",
          "bz-skip":"During the execution, if the referenced value is bz-skip, then skip this action",
          "regex":"Support the use of regular expressions to assign random data. Format： /..../ Ex.： /[0-9]*[a-z]+/",
          "/BZ-XXXX/":"Generate random data using a specific attribute format. The user can define the attribute data format in Settings> Content Rules> Data Format. Common attributes defined by the system include: name, number, email, phone number, etc.Format: /BZ-xxxxxx/, ex.: /BZ-name/",
          "/{random}/":"Used to assign random values to drop-down boxes (including custom drop-down boxes).",
          "/{date:xxxxxx}/":"Generate the date in the specified format. Format： /{date:xxxxx|[date format]}/ Ex.： /{date:today|yyyy-MM-dd hh:mm:ss}/"
        }
      },
      _aiModuleSetting:{
        _title:"AI model attributes",
        _options:{
          "Syan Module":"One attribute in AI model settings. Specify when this module data is related to a certain module data.",
          "Initial Data":"One attribute in AI model settings. Specify module initialization data. It is used for the data that existed at the beginning of the test, or the sub-module data of a certain value is generated at the same time when the data of a certain module is created.",
        }
      },
    },
    _scenarios:{
      add:{
        _name:"Simple process for {0}",
        _when:"{0} <{0}>"
      },
      edit:{
        _name:"Simple process for {0}",
        _when:"{0}<{0}> to <newData>"
      },
      delete:{
        _name:"Simple process for {0}",
        _when:"{0} <{0}>"
      },
      execute:{
        _name:"Simple process for {0}",
        //execute {send email} <{form}> in <{project}>
        _when:"Execute {1} <formData> in <{0}>",
        _whenModule:"Execute {1} <formData> in {0}"
      },
      chkCondition:{
        _name:"Simple process for check condition {0}",
        _when:""
      },
      _roleRef:"<role>",
      _validExist:"validate <{0}> in {1}",
      _validUnExist:"validate <{0}> not exist in {1}",
      _linkHas:"Has one {0}<{1}>", //for link test case
      _linkNoHas:"Un-exist {0}<{1}>", //for link test case
      _scenarioData:"Scenario Data",
      _role:"role",
      _data:"data",
      _result:"result",
      _parameterName:"Parameter"
    },
    _comment:{
      _conflictData:"Conflict data at: {0}",
      _solutionComment:"Execute '{0}' test case to make sure condition: {1}",
      _makeSureModuleDataSize:"module, '{0}' data size is {1}",
      _aboutCurData:"/"+"/Note: In modify/delete/execute test case, the data, $project.{0}, should be assigned in previous action",
      _makeSureModuleNoData:"module, '{0}' not has data",
      _makeSureModuleData:"module '{0}' has data",
      _exeTestByParameter:"Execute test case: $parameter.code",
      _signInForTest:"Sign-in with the appropriate role for the target test case",
      _stopOnKey:"If parameter is key word, leave the test case",
      _continueExe:"If parameter is not a key word, continue executing the test case",
      _methodOnItem:"{0} {0}",
      _noParameterTakeCurData:"/"+"/Take cur-data when doesn't specify parameter\n",
      _takeDataInParameterKey:"/"+"/Take data by parameter as a key\n",
      _findDataByParameterInAttributes:"/"+"/Find data by parameter as an object (attributes)\n",
      _successCondition:"/"+"/Condition success when {0} is not empty\n",
      _notInMemory:"/"+"/If the data is not in memory, the data does not exist\n",
      _getExeTests:"/"+"/Base on required attributes to get a set of suitable test cases to create test data\n",
      _exeTests:"Generate solution to get specify object data",
      _accessTest:"Generate solution to get specify target element",
      _triggerRemove:"/"+"/Call delete data test case\n",
      _triggerUpdate:"/"+"/Call Update entity test case if there is an entity in the module\n",
    }
  },
  _scenario:{
    _title:"Scenario",
    _specifyAttr:"[Specify parameter]",
    _updateList:"Updating Items",
    _sentence:"Test step",
    _stdSuiteName:"{0} suite",
    _emptySentenceIssue:"Sentence cannot be empty",
    _existSentence:"This sentence pattern already exists, do you want to continue?",
    client_id:"Client ID",
    client_secret:"Client Secret",
    _reviewScenarioSentence:"Review the test case mapping of scenario",
    _onlyGroupAndRefAction:"An unsupported action type is included in the assigned action. \n\nNote: Only reference actions (plug-test case) are supported in scenarios.",
    _group:{
      given:"Given",
      when:"When",
      then:"Then"
    },
    _map:{
      given:"given",
      when:"when",
      then:"then",
      and:"and",but:"and",
      example:"ignore",data:"ignore",
      "|":"data"
    },
    given:["Given"],
    when:["When"],
    then:["Then"],
    and:["And"],
    _tabType:{
      _form:"Form",
      _word:"Cucumber Text"
    },
    auth:["Authorization"],
    _featureMap:{
      _feature:"Feature",
      _scenario:"Scenario",
      _scenarioOutline:"Scenario outline"
    },
    _sentenceSetting:"Standard Scenario sentence pattern",
    _sentenceExample:{
      "#module":"product",
      "#test-name":"Create",
      "#test-description":"Add a product",
      "#parameter-list":["name","description","price"]
    },
    reverse:"On reverse",
    _zipFile:"In Zip",
    _importByText:"By Text",
    _importByFile:"By File",
    _importByServer:"Sync from server",
    _link:"Link Test Case",
    _target:"Target Test Case",
    Jira:"Jira / Xray",
    _feature:"Feature",
    _toTxtEditor:"Switch to text editor",
    _toTableEditor:"Switch to table editor",
    _manualParameter:"Manual Parameter",
    _missContent:"Didn't find available content in '{0}'. Please check the format of the file.",
    _mapLink:"[Mapping Link-test ...]",
    _targetTest:"Target Test case",
    _refDesc:"Reference Description",
    _matchServer:"Load features from VCS",
    _scenarioServer:"Feature file server",
    _fileList:"File List Url",
    token:"Token",
    _parameterType:{
      any:"Exist data or create new item by '{0}'",
      new:"New Data by '{0}'",
      attr:"Specify attributes"
    },
    _fileMatch:"Match File",
    _testMapTitle:"Test relationship maps",
    _tableContent:"Table of Contents",
    _confirmNewMap:"Update the link test case mapping, it will effect other test cases which refer the link test case. Please confirm the update",
    _missFeatureName:"Feature name missing.",
    _getFileList:"Get feature file list"
  },
  _rootCause:{
    _title:"Known issues",
    _fields:{
      errHash:"Error Hash",
      errDesc:"Name",
      type:"Issue Type",
      scope:"Scope",
      assignTo:"Assign to",
      status:"Status",
      desc:"Description",
      url:"Ext. URL",
      key:"Ext. Key"
    },
    _actions:"Actions",
    _status:{
      created:"New",
      pending:"In Progress",
      fixed:"Fixed",
    },
    _typeOptions:{
      unknow:"Unknown",
      auto:"Automation",
      app:"Application"
    },
    _extInfo:"Ext info",
    _supportRegex:"Note: support regex match. like: / ... /"
  },
  _tmpDataBase:{
    _title:"Temporary Database",
    _size:"Exist data",
    _addModuleData:"Add module data",
    _unset:"Unset",
    _dynamicValue:"Dynamic Value",
    _deleteOptions:{
      _all:"Delete all",
      _old:"Delete old data",
    }
  },
  _api:{
    _skipRoot:"Ignore root module",
    _existHost:"Exist App host",
    _mapHostDesc:"Do you want to add the below host or map them to exist host?",
    _setting:"API Parameter, Response and headers setting",
    _preName:"Prefix name",
    _triggerTokenTestFrom:"AI retrieve token by specific test case",
    _prepareParameter:"  /"+"/Insert script at here for preparing $parameter data",
    _batchRequestEndScriptDesc:"  /"+"/The script is for storing response data ($result) to $parameter.$result[$result.idx]. \n  /"+"/It could be used in next api (variable name: $result)",
    _testTmpData:"Test Temporary Data",
    _apiList:"API List",
    _proxyWarning:"Proxy in {0}",
    _uiToApiTool:"Capture API data request tool in UI operation",
    _missRefModule:"Missing reference Module for: {0}!",
    _importScope:{
      _action:"Selected action",
      _test:"Current test",
      _module:"Current module"
    },
    _confirmDeleteHost:"Deleting this API host will also cancel the import of related APIs. \n\nDo you want to delete?",
    _import:"Import by Text",
    _importOption:"Import method",
    _importAndOverwrite:"Import and overwrite current api",
    _importFile:"Import by File",
    _modulePreview:"Module API preview",
    _rootPath:"Root path",
    _foreignKeyMapping:"Foreign Key Mapping",
    _lastTransaction:"Last batch of data requests",
    _lastUnsaveData:"Last unsaved data",
    _noField:"Field {0} doesn't exist!",
    _defValue:"Set Default Parameter value",
    _reviewInitParameterMapping:"Review module initial parameter mapping",
    _identifyDataList:"The following {0} sets of data are identified. \n\nWhether to execute all data, or execute a set of random data?",
    _gotoJoinAPI:"Goto '{0}' definition",
    _joinAction:"Join test case: {0}",
    _dataList:"Data List",
    _tryJoinTogether:"Test Join cases at the same time",
    _redoOnTokenExpair:"The last token was expires! Obtained a new token automatically and performed the operation again",
    _initParameterSetting:"Initial Function Parameter setting",
    _missKeyFieldInModule:"Miss key field setting in module {0}",
    _missStdInitFun:"Missing standard initial data api function in module, {0}",
    _missStdNewFun:"Missing standard add data api function in module, {0}",
    _getDataSize:"Received {0} {1} data records and keep {2} new records in the temporary database",
    _querySetting:"Query '{0}' Setting",
    _defScript:"Set Default Script",
    _filterScriptDesc:"For filter result data. \nIt will be used to replace response script on the api, \nto get specific initial data.",
    _keyField:"Data key",
    _empty:"Empty",
    _export:"Export",
    _uiValue:"Display Value",
    _setInitParameter:"Set init parameters",
    _tmpDataSize:"Tmp db size",
    _refPath:"Data path",
    _mappingModule:"Mapping Module",
    _mappingKey:"Key / Value",
    _syncField:"Sync field settings",
    _exFilterDesc:"When the application data is a specific field value is set",
    _currentValue:"Current value",
    _candidateData:"Select Candidate Data",
    _timeout:"Timeout",
    _fKeyDesc:"Filter attributes can be specified in the input format. Such as: \n    /{exist:{0}:type=xxx|type=yyy}/ \n\nYou can also use regular expressions, such as: \n    /{exist:{0}:type=/xxx|yyy/}/",
    _showResponseType:{
      _data:"Return value",
      _header:"Headers"
    },
    _postKeyWarning:"Warning! It is not normal to post key field.",
    _missingKeyFieldInModule:"Missing Key field in module ({0})",
    _deleteKeyInPOST:"Do you want to remove key fields from all POST requests or only selected parts?",
    _enable:"Enable temporary API Debug",
    _queryNote:"If the query value is bz-skip, it will not be added to the request URL. Debug mode allows you to <b>TEMPORARILY</b> turn query parameters on and off.",
    _responseSetting:"Response Script ($result)",
    _responseData:"Execute API to Retrieve Response Data",
    _scriptDesc:"1. As a extract action: \n\tYou can set the $result.data to a variable. like: \n\n$test.name=$result.data.name\n\n2. As a validate action. you must defined an anonymous  function, and return true or false in the inner code, and remember to execute it as well. like:\n(function(){\n\t...\n\t...\n\treturn true; \n  /"+"/Tip: Double textarea to insert standard code\n})()\n\nNote: return true or undefined is validate success. return false is validate failed",
    _headerSetting:"Headers Setting",
    _targetMethod:"Target Method",
    _missForeignKey:"List of unmapped foreign keys",
    _monitor:"Watch variable",
    _scope:"Variable Scope",
    _responseSize:"Response size",
    _responseText:"Response text",
    _variableName:"Variable Name",
    _targetModule:"Target Module",
    _try:"Try",
    _authOptions:{
      _existAuthModule:"Exist Auth Module",
      _importAuthModule:"Import Auth Module",
      _noAuthModule:"No auth"
    },
    _parameters:"Parameters",
    _requestBody:"Request body",
    _responses:"Responses",
    _authModule:"Authorization Module",
    _baseToken:"Authorization base on Token",
    _keyFormat:"Suffix of Key field: ",
    _fKeyFormat:"Suffix of foreign key: ",
    _exKeyFormat:"Ex.: {0}",
    _testScenario:"Test: {0}",
    _exFKeyFormat:"Ex.: {0}",
    _preLabelPattern:"Identify pattern of module name from description",
    _confirmStopRecording:"Do you want to stop API recording?",
    _oneAction:"Merge All requests in one action",
    _auth:"Auth",
    _authDesc:"Authentication settings： \n\nSupports the usual authentication setting methods, and can also specify test cases to obtain tokens. \nAfter setting, the token acquisition test case will be automatically executed during execution.",
    _backList:"Close API form and Back to Action List",
    _noAPIRequest:"Non-API Request",
    _responseDataName:"Assign response data to variable",
    _mapRequestDetails:"Mapping request data",
    _noCatchResponse:"Return data not captured",
    _missResponse:"Tip: The response data can be captured through the recording API to better generate API actions.",
    // _reqToOneAction:"Put all requests in one action",
    _asParameter:"Mapping to test case parameter",
    _header:"Headers",
    _body:"Body",
    _path:"Path",
    _query:"Query",
    _join:"Join API",
    _joinDesc:"To implement multiple API data requests in one transaction.",
    _responseScriptDesc:"This script is executed after the API request is completed. \n\nThe execution result return data can be accessed through $result.",
    _repeat:"Repeat",
    _preScript:"Pre script",
    _loopScript:"Repeat script",
    _responseScript:"Result script",
    _loadTesting:{
      _repeat:"Simply Repeat",
      _ramp:"Ramp-Up"
    },
    _keyType:{
      _key:"Current Module Key",
      _fKey:"Foreign Key"
    },
    _updateSameField:"Set the same setting on all the same name fields",
    _updateOnModule:"Set the same role setting on all requests in the module",
    _curRequestOnly:"Update the selected request only",
    _updateOnProject:"Set the same role setting on all modules",
    _generateModelPageMapping:"Generate Modeling Page(UI) Mapping",
    _allInAPIModule:"Add API prefix to modules",
    _generateScenario:"Generate Scenarios",
    _generateFeature:"Generate Features",
    _users:"Users",
    _totalTime:"Total Time (sec)",
    _upTime:"Ramp-Up Time (sec)",
    _script:"Script",
    _start:"Start Time",
    _end:"End Time",
    _spendTime:"Spend Time(ms)",
    _requestGroups:"Request Groups",
    _totalRequests:"Total Requests",
    _gPeriod:"View Period",
    _result:"Request Result",
    _successRequest:"Success Requests",
    _failedRequest:"Failed Requests",
    _averageRequest:"Average Response Time",
    _exeResult:"Execution",
    _status:"Status",
    _repeatTimes:"Execute Times",
    _exeMethod:"Execute Method",
    _disableLoadTest:"Disable Load Testing",
    _handleScriptForEnableLoadTest:"After Enable load testing, the script need to be updated to support Concurrency Requests. \nDo you want to the tool update for you?",
    _handleScriptForDisableLoadTest:"After Disable load testing, the support Concurrency requests script could be removed. \nDo you want to the tool update for you?",
    _sync:"Synchronous",
    _asyn:"Asynchronous",
    _period:"Launch Period (ms)",
    _validateResult:"/"+"/To get validation result",
    _ignoreOtherValues:"/"+"/Ignore the other {0} attributes value",
    _insertValidateCode:"/"+"/Insert other validation code. like\n  /"+"/vr=vr&&v.name==' .... ';\n",
    _insertAssignVariable:"/"+"/Insert assign variable code. like\n  /"+"/$test.tmpData=v.name;\n",
    _scriptMissTrigger:"Look like you defined a function without a trigger for it. "
  },
  _merge:{
    _title:"Merge branches",
    _duplicateNameIssue:"Duplicate names found. Please rename the item from one branch and merge again.",
    _noMergeItem:"There is nothing to merge",
    _noMoreConflict:"There is no conflicting data pending. Do you want to commit?",
    _branchSetting:"[Branch setting]",
    _mergeFrom:"Merge from",
    _mergeFromTo:"Merge from {0} to {1}",
    _mergeTarget:"Merge target",
    _commitType:"Data option",
    _partialMerge:"Partial Merge (for: {0})",
    _newModule:"Creates a new module",
    _mergeSameBranch:"There is no point comparing identical branches. Please choose a different branch.",
    _notReadyData:"The merge is not complete on: {0}",
    _noCommitToMerge:"Uncommitted data can be merged",
    _deletedFromLocal:"Deleted in the current branch but not yet committed",
    _deletedFromProjectNewLocal:"Deleted and committed, but there is new update in current branch. Please decide to delete or keep.",
    _deletedFromProjectNewFrom:"Deleted and committed, but there is new update in merge branch. Please decide to re-add or keep deleting.",
    _cloneMsg:"The operation will delete current branch data. Are you sure you want to continue?",
    _ttRelation:{
      _new:"New Test Case",
      _late:"This was updated in the current branch. You can click 'View' to see the differences, or click 'Overwrite' to change back to original branch.",
      _same:"Identical data found. Nothing to do.",
      _overwrite:"This was updated in the merge-from branch. You can click 'View' to see the differences, or click 'Overwrite' to accept the update in current branch.",
      _conflict:"Conflicts found. \n\nThis was updated in both branches. Click 'Merge' button to manually merge changes (cherry-picking).\nOr click 'Overwrite' button to overwrite conflicts in current branch."
    },
    _mergeTargetNote:"Note: This operation only merges the data committed in branch {0}, excluding uncommitted data",
    _type:{
      _conflict:"Conflict",
      _overwrite:"Update",
      _new:"New",
      _del:"Delete"
    },
    _updateInfo:"Last Update Info",
    _createInfo:"Create Info",
    _deleteInfo:"Delete Info",
    _commits:"Commit history List",
    _branchManagement:"Branch Management",
    _mergeRequest:"Merge request and Merge tool",
    _viewTeam:"View updates from team",
    _readyList:"Commit List",
    _disableChkDetails:"After a manual update, it is not possible to check the differences in details between the two versions.",
    _alertMissTest:"There are some missing test cases ({0}) in plug-in action. \n\nPlease remember to merge from root level or module level.",
    _updateRef:"Update all references to the data",
    _confirmOverwriteNewVersion:"Are you sure you want to overwrite all data of current branch (Includes conflict data and newer data of current branch)?",
    _createTestCase:"Import Test Case",
    _createModule:"Import Module",
    _keepRemote:"Import Remote",
    _noUpdate:"No Update",
    _noConflict:"No conflict data",
    _readyForNext:"There is no conflict in the current data and the next piece of data can be merged.",
    _keepLocal:"Keep Local",
    _noRelated:"There is no related data in the specific version",
    _versionSetting:"Settings",
    _manualMerge:"Manual Merge",
    _baseData:"Baseline",
    _showBaseline:"Show baseline",
    _rootKey:"Data Path",
    _noBaseVersion:"There is no shared base version.",
    _dataNotReady:"There is a conflict that needs to be merged manually.",
    _autoMergeSuccess:"Auto-merge successful. Stored in database."
  },
  _debug:{
    _dataSnapshot:"View data snapshot on action",
    _inDebugData:"Use data from debugger",
    _definedData:"Use pre-defined data",
    _demoData:"Use demo data",
    _condition:"Set condition",
    _conditionNote:"Note: put a condition to help you debugging, but you should not put set value inside.",
    _missConsoleOpen:"To debug Javascript breakpoints, \nyou need to open the browser console. \n\nOpen the console by pressing 'F12', \nand then click the'<b>Continue</b>' button to execute the test task"
  },
  _version:{
    _code:"Branch",
    _list:"Branch List",
    _switchBranch:"Switch Branch",
    _deleteCurrentVersion:"The current branch was deleted!",
    _changeDirectly:"Allow change module/test case directly (commit without review)",
    _autoMerge:"Auto-merge merge requests on approval",
    _freezedVersion:"The branch is freeze (Readonly).",
    _createMilestone:"Build milestone from current branch",
    _completeBuildMilestone:"Successfully added milestone： {0}",
    _noOtherVersionToMerge:"There is no other branch to merge",
    _baseVersion:"Copy from branch",
    _emptyBranch:"Without base branch",
    _preLoadDesc:"Loads the full project into localstorage and display audit info (not implemented will be shown in red)",
    _cleanupDesc:"Removes all link tests that are not referenced by a feature",
    _newModuleDesc:"Creates a new project module. \nModules are containers \nfor multiple tests.",
    _newAIModuleDesc:"Creates a new AI modeling module. \nAfter modeling, the relative tests \nwill be auto generated.",
    _newFeatureDesc:"Creates a new Cucumber feature. \nFeatures are containers for scenarios.",
    _warningImport:"All current data will be removed after import. \n\nDo you want to continue?",
    _importDesc:"Imports Cucumber features from an external system.",
    _batchDesc:"1. Click <b style='font-size:15px;' class='bz-shield on'></b> to set the protection branch. Protection branch is merge requested and cannot be delete.\n2. Select multiple branches and click the Delete button.",
    _protectionBranch:"Branch Protection",
    _enableProtection:"Enable Protection",
    _reviewMerge:"Members with permission to approve merge requests",
    _reviewSelf:"Allow user to approve own merge request",
    _reviewors:"Reviewers"
  },
  _appWords:{
    _title:"App Multiple Language Words",
    _items:"{0} Items",
    _appLanguage:"App Language",
    _splitWords:"Split words",
    _sameAsDef:"Same as default value",
    _autoTran:"Auto translate",
    _overWrite:"Over write",
    _retrieveWords:"Retrieve Words from Actions",
    _updateActions:"The word, ({0}), is in the below actions. Do you want to update the actions?"
  },
  _schedule:{
    _setScheduleTitle:"Set schedule",
    _executeScheduleTask:"Test the CI link",
    _executeScheduleTaskDesc:"To execute the link on the browser will auto logout IDE, \n\ndo you want to continue?",
    _task:"Task",
    _time:"Execute Time",
    _day:"Day",
    _date:"Date",
    _month:"Month",
    _repeat:"Repeat",
    _noRepeat:"No Repeat",
    _next:"The next execution will be: {0}",
    _type:"Execute",
    _options:{
      asap:"As soon as possible",
      schedule:"In schedule"
    },
    _dayMap:{
      0:"Mon",
      1:"Tues",
      2:"Wed",
      3:"Thur",
      4:"Fri",
      5:"Sat",
      6:"Sun"
    },
    _monthMap:{
      0:"Jan",
      1:"Feb",
      2:"Mar",
      3:"Apr",
      4:"May",
      5:"Jun",
      6:"Jul",
      7:"Aug",
      8:"Sep",
      9:"Oct",
      10:"Nov",
      11:"Dec"
    },
    _fullMonthMap:{
      0:"January",
      1:"February",
      2:"March",
      3:"April",
      4:"May",
      5:"June",
      6:"July",
      7:"August",
      8:"September",
      9:"October",
      10:"November",
      11:"December"
    },
    _everyDay:"{0} everyday",
    _every:"every {0}",
    _timeMessage:"At {0}",
    _dateMessage:"on day-of-month {0}",
    _dateUnit:"{0}",
    _timeDateMessage:"{0} {1}",
    _dayMessage:"on {0}",
    _monthMessage:"{0} in {1}"
  },
  _extractData:{
    _definition:"Format Definition",
    _orgData:"Data",
    _result:{
      v:"Validate Result",
      e:"Extract Result"
    },
    _title:"Validate Data / Extract Data",
    _extractData:"Extract Data"
  }
};
window._bzEval={
  _leftKeys:{"{":"}","[":"]","(":")"},
  bd:{"{":"}","[":"]","(":")","'":"'",'"':'"','`':'`'},
  db:{"}":"{","]":"[",")":"(","'":"'",'"':'"','`':'`'},
  _tmpNum:1,
  exeGroupCode:function(d){
    if(!d||![String,Array].includes(d.constructor)){
      return d
    }
    if(d.constructor==String){
      return _bzEval._exeCode(d)
    }else if(d)
    d.forEach(x=>{
      if(x.f){
        x.ps=x.ps||[]
        let xx=_bzEval._exeCode(x.f,0,0,1)
        if(xx.n){
          xx.d[xx.n](...x.ps)
        }else{
          xx.v(...x.ps)
        }
      }else if(x.k){
        let xx=_bzEval._exeCode(x.k,0,0,1)
        if(xx.n){
          xx.d[xx.n]=x.v
        }else{
          window[xx.k]=x.v
        }
      }else{
        _bzEval._exeCode(x.c)
      }
    })
  },
  _getTmpDataName:function(){
    return "f"+(this._tmpNum++)
  },
  _throwErr:function(s){
    alert(_bzMessage._system._error._syntaxError+s)
  },
  _exeFun:function(f,p,_outMap,_inMap){
    _outMap=_bzEval._initOutMap(_outMap),_inMap=_inMap||{};
    p=(p||[]).map(x=>_bzEval._getFinalValue(x))
    if(f.constructor!=Function){
      if(_bzEval._isFun(f)){
        f={v:f}
      }
      if(f.v.constructor==Function){
        if(f.n){
          p=_buildTF(p)
          return f.d[f.n](...p)
        }else{
          f=f.v
        }
      }else if(f.v&&(f.v.k=="function"||f.v.k=="=>")){
        return _exe(f.v,f.d,p)
      }else{
        _bzEval._throwErr()
      }
    }
    p=_buildTF(p)
    p= f(...p)
    return p

    function _buildTF(p){
      p=p.map(x=>{
        if(x&&x._bzFun=="_bzFun"){
          return function(){
            return _exe(x,window,[...arguments])
          }
        }
        return x
      })
      return p
    }

    function _exe(f,d,p){
      let _map=_bzEval._buildScopeDataMap(_outMap,_inMap),
      _tmpMap={}
      f.e.forEach((x,i)=>{
        if(x.ps){
          _tmpMap[x.ps[0]]=p[i]
        }else{
          _tmpMap[x]=p[i]
        }
      })
      _tmpMap.arguments=[...p]
      _tmpMap.this=d
      f=_bzEval._exeCode(f.c,_map,_tmpMap)
      _bzEval._mergedataMap(_outMap,_inMap,_map)
      if(f&&f._throw=="_return"){
        f=_bzEval._getFinalValue(f)
        return f
      }
    }
  },
  _exeIfElse:function(v,vs,_map,_tmpMap){
    let r;
    if(v.k!="else"){
      r=_bzEval._exeCode(v.e,_map,_tmpMap)
    }
    if(v.k=="else"||r){
      r=_bzEval._exeCode(v.c,_map,_tmpMap)
      
      while(vs[0]&&["else","else if"].includes(vs[0].k)){
        vs.shift()
      }

    }
    return r
  },
  _exeLoop:function(v,_map,_tmpMap){
    let _first=1,r,rr;
    while(1){
      if(v.k=="for"&&_first){
        _bzEval._exeCode(v.e[0],_map,_tmpMap)
      }
      if(v.k=="for"){
        rr=_bzEval._exeCode(v.e[1],_map,_tmpMap)
      }else if(v.k!=="do"||!_first){
        rr=_bzEval._exeCode(v.e,_map,_tmpMap)
      }
      if((v.k=="do"&&_first)||rr){
        _first=0
        r=_bzEval._exeCode(v.c,_map,_tmpMap)
        if(r&&r._throw){
          if(r._throw!="_continue"){
            if(r._throw=="_break"){
              r=undefined
            }
            break
          }
          r._throw=0
        }
        if(v.k=="for"){
          _bzEval._exeCode(v.e[2],_map,_tmpMap)
        }
      }else{
        break
      }
    }
    return r
  },
  _exeTry:function(v,_map,_tmpMap){
    let r;
    try{
      r=_bzEval._exeCode(v.c,_map,_tmpMap)
      return r
    }catch(e){
      _tmpMap={}
      _tmpMap[v.e[0]]=e
      r=_bzEval._exeCode(v.ec,_map,_tmpMap)
      return r
    }finally{
      if(v.f){
        _tmpMap={}
        r=_bzEval._exeCode(v.f,_map,_tmpMap)
      }
      return r
    }
  },
  _exeSwitch:function(v,_map,_tmpMap){
    let vv=_bzEval._exeCode(v.e,_map,_tmpMap),_continue,r
    v.c.find(x=>{
      if(_continue||x.k=="default"||vv==_bzEval._getFinalValue(_bzEval._exeCode(x.v,_map,_tmpMap))){
        r=_bzEval._exeCode(x.cs,_map,_tmpMap)
        if(r&&_bzEval._isBzData(r)&&r._throw){
          if(r._throw!="_continue"){
            if(r._throw=="_break"){
              r._throw=0
            }
            return 1
          }
          _bzEval._throwErr()
        }
        _continue=1
      }
    })
    return r
  },
  _initOutMap:function(_outMap){
    _outMap=_outMap||{
      $parameter:window.$parameter,
      $module:window.$module,
      $project:window.$project,
      $test:window.$test,
      $loop:window.$loop,
      $result:window.$result,
      $element:window.$element
    }
    return _outMap
  },
  _exe:function(c,m,t,tn,tv){
    if(t=="set"){
      return _bzEval._setValue(tn,m,0,0,tv)
    }else if(t=="get"){
      return _bzEval._getValue(tn,m,0)
    }
    return _bzEval._exeCode(c,m)
  },
  _exeCode:function(vs,_outMap,_inMap,_inBzData){
    _outMap=_bzEval._initOutMap(_outMap),_inMap=_inMap||{};
    if(vs.constructor==String){
      vs=_bzEval._parseCode(vs)
    }else if(vs.constructor!=Array){
      vs=[vs]
    }
    let vvs=[],r,d,rs=[],_tmpFun
    vs.forEach(x=>{
      if(x.k=="function"||x.k=="=>"){
        if(x.n){
          _outMap[x.n]=x
        }else{
          _tmpFun=x
        }
        x._bzFun="_bzFun"
      }else{
        vvs.push(x)
      }
    })
    if(!vvs.length&&_tmpFun){
      return _tmpFun
    }
    while(vvs.length){
      let v=vvs.shift()
      if(["let","const","var","=","+=","-=","*=","/=","^=","%=","&=","|=","&&=","||="].includes(v.k)){
        rs=[]
        v.c=v.c||[]
        v.c=v.c.constructor==Array?v.c.map(y=>y.constructor==Array?y[0]:y):v.c;
        let vr=_bzEval._exeCode(v.c,_outMap,_inMap)
        if(v.k=="var"){
          _bzEval._setValue(v.n,_outMap,_inMap,_outMap,vr)
        }else if(["let","const"].includes(v.k)){
          _bzEval._setValue(v.n,_inMap,_inMap,_inMap,vr)
        }else{
          rs=[_bzEval._setValue(v.n,_outMap,_inMap,0,vr,v.k)]
        }
      }else if(["if","else if","else","for","while","do","try","switch"].includes(v.k)){
        rs=[]
        let _map=_bzEval._buildScopeDataMap(_outMap,_inMap),
            _tmpMap={}
        if(["if","else if","else"].includes(v.k)){
          r=_bzEval._exeIfElse(v,vvs,_map,_tmpMap)
        }else if(["for","while","do"].includes(v.k)){
          r=_bzEval._exeLoop(v,_map,_tmpMap)
        }else if(v.k=="try"){
          r=_bzEval._exeTry(v,_map,_tmpMap)
        }else{
          r=_bzEval._exeSwitch(v,_map,_tmpMap)
        }
        _bzEval._mergedataMap(_outMap,_inMap,_map)
        if(r&&_bzEval._isBzData(r)&&r._throw){
          return r
        }
        if(r){
          rs.push(r)
        }
      }else if(v.k=="..."){
        r=_bzEval._getFinalValue(_bzEval._exeCode(v.c,_outMap,_inMap))
        rs.push([...r])
      }else if(v.k=="return"){
        r=_bzEval._buildBzData(_bzEval._exeCode(v.c,_outMap,_inMap))
        r._throw="_return"
        return r
      }else if(v.k=="break"){
        r= _bzEval._buildBzData()
        r._throw="_break"
        return r
      }else if(v.k=="continue"){
        r= _bzEval._buildBzData()
        r._throw="_continue"
        return r
      }else if(v.k=="throw"){
        r=_bzEval._exeCode(v.c,_outMap,_inMap)
        throw r
      }else if(v.k=="delete"){
        r=_bzEval._exeCode(v.c,_outMap,_inMap,1)
        delete r.d[r.n]
        rs.push(true)
      }else if(v.k=="new"){
        let x=v.c[0],rrs=[...x.cs]
        r=rrs.shift().ps.map(y=>_bzEval._exeCode(y,_outMap,_inMap))
        
        if(x.dd.match(/[.\[\]]/)){
          let dd=x.dd.split(/[.\[\]"']+/).filter(x=>x)
          let rr=window[dd.shift()]
          while(dd.length>1){
            rr=rr[dd.shift()]
          }
          r=new rr[dd[0]](...r)
        }else{
          r=new window[x.dd](...r)
        }

        while(rrs.length){
          let rr=rrs.shift()
          rr=rr.substring(1)
          if(rrs.length){
            let pp=rrs.shift().ps.map(y=>_bzEval._exeCode(y,_outMap,_inMap))
            
            r=r[rr](...pp)
          }else{
            r-r[rr]
          }
        }
        rs.push(r)
      }else if(v.k=="typeof"){
        r=_bzEval._exeCode(v.c,_outMap,_inMap,1)
        r=typeof _bzEval._getFinalValue(r)

        rs.push(r)
      }else if(v.dd){
        let on=v.dd,nn;
        if(v.dd[0]=="."){
          r=_bzEval._getFinalValue(rs.pop())
          nn=_bzEval._getTmpDataName()
          _outMap[nn]=r
          v.dd=nn+v.dd
        }
        rs.push(_bzEval._getRefData(v,_outMap,_inMap))
        if(nn){
          v.dd=on
        }
      }else{
        if(v.k=="["){
          r=[];
          v.ps.forEach(x=>{
            x=x.constructor==Array?x.map(y=>y.constructor==Array?y[0]:y):x;
            let y=_bzEval._exeCode(x,_outMap,_inMap)
            if(x.k=="..."){
              r.push(...y)
            }else{
              r.push(y)
            }
          })
          if(rs.length){
            let rr=rs[rs.length-1]
            if(!_bzEval._isSign(rr)){
              r=r.pop()
              if(_bzEval._isBzData(rr)){
                if(rr.d&&r.n){
                  rr.d=rr.v
                  rr.n=r
                  rr.v=rr.d[rr.n]
                }else{
                  rr.v=rr.v[r]
                }
              }else{
                rr=rr[r]
                rs[rs.length-1]=rr
              }
              continue
            }
          }
          rs.push(_bzEval._buildBzData(r))
        }else if(v.k=="{"){
          r={}
          v.ps.forEach(x=>{
            Object.keys(x).forEach(y=>r[y]=_bzEval._exeCode(x[y],_outMap,_inMap))
          })
          rs.push(_bzEval._buildBzData(r))
        }else if(v.k=="("){
          if(rs.length){
            let rr=rs[rs.length-1]
            let fr=_bzEval._getFinalValue(rr)
            if(_bzEval._isFun(fr)){
              r=v.ps.map(x=>_bzEval._exeCode(x,_outMap,_inMap));
              rs[rs.length-1]=_bzEval._exeFun(rr,r,_outMap,_inMap)
              continue
            }
          }
          r=_bzEval._exeCode(v.ps,_outMap,_inMap)
          rs.push(_bzEval._buildBzData(r))
        }else if(v.constructor==Array){
          rs=[_bzEval._exeCode(v,_outMap,_inMap,1)]
        }else if("'\"\`".includes(v[0])){
          rs.push(_bzEval._buildBzData(v.substring(1,v.length-1)))
        }else if(v[0]=="/"&&v.length>1){
          let _idx=v.lastIndexOf("/"),op=v.substring(_idx+1)
          r=new RegExp(v.substring(1,_idx),op)
          rs.push(r)
        }else if(_bzEval._isNumeric(v)){
          rs.push(JSON.parse(v))
        }else if(_bzEval._isSign(v[0])){
          rs.push(v)
        }else if(v=="undefined"){
          rs.push(_bzEval._buildBzData(undefined))
        }else if(v=="null"){
          rs.push(_bzEval._buildBzData(null))
        }else if(v=="true"){
          rs.push(_bzEval._buildBzData(true))
        }else if(v=="false"){
          rs.push(_bzEval._buildBzData(false))
        }else if(v[0]=="."){
          v=v.split(/[.\[\]"']+/).filter(x=>x)
          r=rs[rs.length-1]
          v.forEach(x=>{
            r.d=_bzEval._getFinalValue(r.v)
            r.n=x
            r.v=r.d[x]
          })
        }else{
          if(_bzEval._isBzData(v)){
            rs.push(v)
          }else{
            rs.push(_bzEval._getValue(v,_outMap,_inMap))
          }
        }
      }
    }
    if(rs.find(x=>_bzEval._isSign(x))){
      r=_bzEval._countItems(rs)
    }else{
      r=rs.pop()
    }
    if(_bzEval._isBzData(r)&&r._throw){
      return r
    }else if(_bzEval._isFun(r)){
      return r
    }
    return _inBzData?_bzEval._buildBzData(r):_bzEval._getFinalValue(r)

  },
  _isFun:function(fr){
    return fr&&(fr.constructor==Function||fr._bzFun=="_bzFun")
  },
  _getRefData:function(v,_outMap,_inMap){
    let r=_bzEval._getValue(v.dd,_outMap,_inMap)
    v.cs.forEach(x=>{
      if(x.k){
        let d=x.ps.find(y=>_bzEval._isSign(y)||y[0]==".")?_bzEval._exeCode(x.ps,_outMap,_inMap):x.ps.map(y=>{
          if(y&&y.constructor==Array){
            y=y.map(z=>z&&z.constructor==Array?_bzEval._exeCode(z,_outMap,_inMap,1):z)
          }
          return _bzEval._exeCode(y,_outMap,_inMap)
        })
        if(x.k=="("){
          if(!d||d.constructor!=Array){
            d=[d]
          }
          if(r.n){
            r.v=_bzEval._exeFun(r,d,_outMap,_inMap)
            r.n=r.d=0
          }else{
            r.v=_bzEval._exeFun(r,d,_outMap,_inMap)
          }
        }else{
          if(d&&d.constructor==Array){
            d=d.pop()
          }
          r.d=r.v
          r.n=d
          r.v=r.d[d]
        }
      }else{
        x=x.split(/[.\[\]"']+/).filter(x=>x)
        x.forEach(y=>{
          r.d=r.v
          r.n=y
          r.v=r.d[y]
        })
      }
    })
    return r
  },
  _countItems:function(ps,c){
    let vs=[],r,s,prs,ss;
    ps.find((x,q)=>{
      if(x=="?"){
        vs=_bzEval._getFinalValue(_countGroup(vs))
        let qs=_bzEval._findKeyOuterBlock(ps,":",q+1,{"?":":"})
        if(vs){
          r=_bzEval._countItems(qs.p)
        }else{
          r=_bzEval._countItems(qs.e)
        }
        return 1
      }
      if(!["&&","||",">","<",">=","<=","==","===","!=","!==","^","&","|"].includes(x)){
        if(ss){
          if(_bzEval._isBzData(x)&&x.n){
            if(ss=="++"){
              vs.push(x)
              x.v+=1
              x.d[x.n]=x.v            
            }else if(ss=="--"){
              vs.push(x)
              x.v-=1
              x.d[x.n]=x.v            
            }else if(ss=="!"){
              vs.push(!x.v)
            }else if(ss=="!!"){
              vs.push(!!x.v)
            }else{
              vs.push(~x.v)
            }
            ss=0
          }else{
            if(ss=="!"){
              vs.push(!x)
              ss=0
            }else if(ss=="!!"){
              vs.push(!!x)
              ss=0
            }else if(ss=="~"){
              vs.push(~x)
              ss=0
            }else{
              _bzEval._throwErr()
            }
          }
          return
        }
        if(x=="*"||x=="/"||x=="%"){
            s=x
        }else if(s){
          vs[vs.length-1]=_bzEval._count(vs[vs.length-1],s,x)
          s=""
        }else if(x=="++"||x=="--"||x=="!"||x=="~"||x=="!!"){
          if(s||!vs.length||_bzEval._isSign(vs[vs.length-1])){
            ss=x
          }else{
            let rv=vs[vs.length-1]
            if(x=="++"){
              rv.d[rv.n]+=1
            }else{
              rv.d[rv.n]-=1
            }
          }
        }else{
          vs.push(x)
        }
      }else{
        vs=_bzEval._getFinalValue(_countGroup(vs))
        if(x=="&&"){
          if(!vs){
            r=_bzEval._buildBzData(vs)
            return 1
          }
        }else if(x=="||"){
          if(vs){
            r=_bzEval._buildBzData(vs)
            return 1
          }
        }else{
          prs={v:vs,c:x}
        }
        vs=[]
      }
    })
    if(!r){
      if(vs.length){
        r=_countGroup(vs)
      }
    }
    return _bzEval._getFinalValue(r)
    function _countGroup(vs){
      [["+","-"],[">>","<<"]].forEach(x=>vs=_countPs(vs,x))
      vs=vs[0]
      if(prs){
        vs=_bzEval._count(prs.v,prs.c,vs)
        prs=0
      }
      return vs
    }
    function _countPs(vs,c){
      let rs=[],s;
      for(let i=0;i<vs.length;i++){
        let v=vs[i]
        if(c.includes(v)){
          if(!i){
            if("+-".includes(v)){
              rs=[0]
              s=v
            }else if(_bzEval._isSign(v)){
              _bzEval._throwErr()
            }
          }else{
            if(s){
              _bzEval._throwErr()
            }
            s=v
          }
        }else if(s){
          let v1=_bzEval._getFinalValue(rs[rs.length-1])
          v=_bzEval._getFinalValue(v)
          rs[rs.length-1]=_bzEval._count(v1,s,v)
          s=""
        }else{
          rs.push(v)
        }
      }
      return rs
    }
  },
  _buildBzData:function(v,d,n){
    if(_bzEval._isBzData(v)){
      return v
    }
    return {
      _bzData:"_bzData",
      v:v,
      d:d,
      n:n
    }
  },
  _isBzData:function(v){
    return v&&v._bzData=="_bzData"
  },
  _getFinalValue:function(r){
    if(_bzEval._isBzData(r)){
      return r.v
    }
    return r
  },
  _isSign:function(c){
    return c&&"~!=><+-*/%^&|?:".includes(c[0])
  },
  _count:function(d1,c,d2){
    d1=_bzEval._getFinalValue(d1)
    d2=_bzEval._getFinalValue(d2)
    switch(c){
      case "+": return d1+d2
      case "-": return d1-d2
      case "*": return d1*d2
      case "/": return d1/d2
      case "==": return d1==d2
      case "===": return d1===d2
      case ">": return d1>d2
      case "<": return d1<d2
      case ">>": return d1>>d2
      case "<<": return d1<<d2
      case ">=": return d1>=d2
      case "<=": return d1<=d2
      case "!=": return d1!=d2
      case "!==": return d1!==d2
      case "&": return d1&d2
      case "|": return d1|d2
      case "&&": return d1&&d2
      case "||": return d1||d2
      case "%": return d1%d2
      case "^": return d1^d2
    }
  },
  _mergedataMap:function(_outMap,_inMap,_map){
    Object.keys(_map).forEach(k=>{
      if(Object.keys(_inMap).includes(k)){
        _inMap[k]=_map[k]
      }else{
        _outMap[k]=_map[k]
      }
    })
  },
  _isNumeric:function(a){
    var b = a && a.toString();
    return (!a||a.constructor!=Array) && b - parseFloat(b) + 1 >= 0
  },
  _getValue:function(n,_outMap,_inMap){
    let ns=n.split(/[.\[\]"']+/).filter(x=>x),_map;
    n=ns.shift()
    if(n=="eval"){
      return _bzEval._buildBzData(_bzEval._exeCode,_bzEval,"_exeCode");
    }else if(_bzEval._isNumeric(n)||n.match(/^['"`].*[`"']$/)){
      let nn=_bzEval._getTmpDataName()
      _outMap[nn]=_bzEval._exeCode(n)
      n=nn
    }
    if(Object.keys(_inMap).includes(n)){
      _map=_inMap
    }else if(Object.keys(_outMap).includes(n)){
      _map=_outMap
    }else{
      _map=window
    }
    while(ns.length){
      _map=_map[n]
      n=ns.shift()
    }

    return {
      d:_map,
      n:n,
      v:_map[n],
      _bzData:"_bzData"
    }
  },
  _setValue:function(n,_outMap,_inMap,_defMap,v,_sign){
    let _map,ns;
    if(n.constructor==String){
      ns=n.split(/[.\[\]"']+/).filter(x=>x)
      n=ns.shift()
  
      _map=_bzEval._getDataMap(n,_outMap,_inMap,_defMap)
    }else{
      _map=_bzEval._getRefData(n,_outMap,_inMap)
    }
    if(n.constructor!=String||!_defMap||_map==_defMap){
      if(n.constructor==String){
        while(ns.length){
          _map=_map[n]
          n=ns.shift()
        }
      }else{
        n=_map.n
        _map=_map.d
      }
      switch(_sign){
        case "+=":return _map[n]+=v;
        case "-=":return _map[n]-=v;
        case "*=":return _map[n]*=v;
        case "/=":return _map[n]/=v;
        case "%=":return _map[n]%=v;
        case "^=":return _map[n]^=v;
        case "&=":return _map[n]&=v;
        case "|=":return _map[n]|=v;
        case "&&=":return _map[n]&&=v;
        case "||=":return _map[n]||=v;
      }
      return _map[n]=v
    }else{
      throw new Error("")
    }
  },
  _getDataMap:function(n,_outMap,_inMap,_defMap){
    if(Object.keys(_inMap).includes(n)){
      return _inMap
    }
    if(Object.keys(_outMap).includes(n)){
      return _outMap
    }
    return _defMap||window
  },
  _buildScopeDataMap:function(_outMap,_inMap){
    let _map=Object.assign({},_outMap)
    _map=Object.assign(_map,_inMap)
    return _map
  },
  _findKeyOuterBlock:function(vs,tk,_start,bs,_noRegex){
    bs=bs||_bzEval.bd
    let k,b,c,s;
    _init()
    if(vs.push){
      vs=[...vs]
    }
    if(_start){
      vs=vs.push?vs.splice(_start):vs.substring(_start)
    }
    for(let i=0;i<vs.length;i++){
      c=vs[i]
      if(c=="\\"){
        b=!b
      }else if(b){
        b=0
      }else if(!_noRegex&&k=="/"&&c=="/"){
        _init()
        continue
      }else if(!_noRegex&&!k&&c=="/"&&(!s||s.trim().match(/[\(\[\=\?\:]$/))){
        k="/"
        continue
      }else if(k){
        if(k.r==c){
          if(k.n){
            k.n--
          }else{
            _init()
          }
        }else if(k.l==c){
          k.n++
        }
        continue
      }else if(bs[c]){ //([{
        k={l:c,r:bs[c],n:0,p:{k:c}}
      }
      s.push?s.push(c):s+=c;

      let kk=_isKey(s,c)
      if(kk){
        if(vs.pop){
          return {
            e:vs.splice(i+1),
            p:vs.splice(0,i),
            k:kk
          }
        }
        return {
          p:vs.substring(0,i-kk.length+1),
          k:kk,
          e:vs.substring(i+1)
        }
      }
    }

    function _init(){
      k=0
      s=vs.constructor==Array?[]:"";
    }

    function _isKey(s,c){
      if(tk.constructor==Function){
        return tk(s)
      }else if(tk.constructor==RegExp){
        s=s.match(tk)
        return s&&s[0]
      }
      return (tk==s||tk==c)&&tk
    }
  },
  _parseCode:function(v,_case){
    let vs=_bzEval._parseLine(v)
    if(_case){
      let ss=[]
      vs.forEach(x=>{
        while(1){
          let k=x.match(/^(case|default)(:|\s|\'\"\`\{)/)
          if(k){
            k=k[1]
            x=x.substring(k.length).trim()
            v=_bzEval._findKeyOuterBlock(x,":")

            if(v.e.match(/^(case|default)(:|\s|\'\"\`\{)/)){
              x=v.e
              ss.push({k:k,v:v.p.trim(),cs:[]})
              continue
            }
            ss.push({k:k,v:v.p.trim(),cs:[v.e]})
          }else if(ss[0]){
            ss[ss.length-1].cs.push(x)
          }
          break
        }
      })
      ss.forEach(x=>{
        x.cs=x.cs.map(y=>_bzEval._parseItem(y))
      })

      return ss
    }
    vs=vs.map(x=>_bzEval._parseItem(x))

    return vs
  },
  _parseItem:function(v){
    let ps=[],pps=[],
        b,p,
        c,cc=[],
        s="",_inpp,
        k,kk,inSingle,
        df, //var, let, const
        ok, //for, if, whilte, do, function,switch
        op; //delete, continue, break

    v=v.trim()

    ok=v.match(/^(if|for|while|function|do|try|switch|else +if|else)(\s|\(|\{)/)
    if(ok){
      ok={
        k:ok[1]
      }
      v=v.substring(ok.k.length).trim()
      if(ok.k=="function"){
        ok.n=v.substring(0,v.indexOf("("))
        v=v.substring(ok.n.length)
        ok.n=ok.n.trim()
      }
    }else{
      ok=v.match(/^\(?([^=,\(\)\{\}\[\]]*)\)?=>/)

      if(ok){
        let vv=v.substring(ok[0].length).trim();
        let e=_bzEval._findKeyOuterBlock(vv,")")
        if(!e){
          v=vv
          if(v[0]!="{"){
            v="return "+v
          }
          ok={
            k:"=>",
            e:_bzEval._parseItem(ok[1]||" ")
          }
        }else{
          ok=0
        }
      }else{
        let vv=v.match(/^(let|var|const)\s+([^=,\s]+)(\=|\,|$|;)/)
        if(vv){
          v=v.substring(vv[0].length)
          df={
            k:vv[1],
            n:vv[2]
          }
          ps.push(df)
        }else{
          df=v.match(/^([^=\{\[\("'`\!><\s]+\=)[^>=]/);
          if(df){
            v=v.substring(df[1].length)
            df={
              k:"=",
              n:df[1].replace("=","").trim()
            }
            k=df.n.match(/[\+\-\*\/\%\^]$/)
            if(k){
              k=k[0]
              df.k=k+df.k
              df.n=df.n.replace(k,"").trim()
            }
            ps.push(df)
          }else{
            df=v.match(/^(return|delete|throw|typeof|break|continue|new)(\s|$|\[|\{|\()/)||v.match(/^(\.\.\.)/)
            if(df){
              v=v.substring(df[1].length).trim()
              df={
                k:df[1]
              }
              if(["return","break","continue","throw"].includes(df.k)){
                df.c=_bzEval._parseCode(v)
                return df
              }
              op=df
              ps.push(op)
              df=0
            }else{
              df=v.match(/^(function)(\s|\()/)
              if(df){
                ok={
                  k:df[1]
                }
                v=v.substring(0,df[1].length).trim()
                df=v.match(/^([^\(]+)/)
                if(df){
                  ok.n=df[1].trim()
                  v=v.substring(0,ok.n.length).trim()
                }
              }
            }
          }
        }
      }
    }
    
    for(let i=0;i<v.length;i++){
      c=v[i]
      let p=ps[ps.length-1]
      if(c=="\\"){
        b=!b
      }else if(b){
        b=0
      }else if(kk){
        if(kk==c){
          kk=0
          if(_inpp){
            _inpp=0
            if(s){
              ps.push("+")
              ps.push('"'+s+'"')
            }
            continue
          }
        }else if(kk=="`"&&s.match(/\$\{$/)){
          let ss=_bzEval._findKeyOuterBlock(v,"}",i)
          if(ss){
            ps.push('"'+s.substring(1,s.length-2)+'"')
            ps.push("+")
            v=_bzEval._parseItem(ss.p)
            if(v.constructor==Array){
              v=v[0]
            }
            ps.push(v)
            v=ss.e
            i=-1
            _inpp=1
            s=""
            continue
          }
        }
      }else if("`'\"".includes(c)){
        kk=c
      }else if(k=="/"){
        if(c=="["){
          inSingle=1
        }else if(c=="]"){
          inSingle=0
        }else if(inSingle){
        }else if(c=="/"){
          k=0
        }
      }else if(!k&&!ps.length&&c=="/"&&(!s||s.trim().match(/[\(\[\=\?\:]$/))){
        k="/"
      }else if(!s&&(c==" "||c=="\n")){
        continue
      }else if(k){
        if(k.r==c){
          if(k.n){
            k.n--
          }else{
            if(ok){
              if(ok.k=="do"){
                if(ok.c){
                  ok.e=_bzEval._parseItem(s)
                  return ok
                }else if(s[0]=="{"){
                  ok.c=_bzEval._parseCode(s.substring(1))
                }else{
                  k=0
                  s+=c
                  continue
                }
              }else if(ok.k=="try"){
                if(!ok.c){
                  ok.c=_bzEval._parseCode(s)
                }else if(!ok.e){
                  ok.e=_bzEval._parseItem(s)
                }else if(!ok.ec){
                  ok.ec=_bzEval._parseCode(s)
                }else{
                  ok.f=_bzEval._parseCode(s)
                }
                if(i==v.length-1){
                  return ok
                }
                s=""
                k=0
                continue
              }else if(ok.k=="=>"){
                if(k.l=="{"){
                }else{
                  s+=c
                }
                k=0
                continue
              }else if(k.l=="("){
                if(ok.k=="for"){
                  ok.e=_bzEval._parseCode(s)
                }else{
                  ok.e=_bzEval._parseItem(s)
                }
                v=v.substring(i+1).trim()
                if(["for","if","else if"].includes(ok.k)){
                  if(v.match(/^\{.*\}$/s)){
                    v=v.substring(1,v.length-1)
                  }
                  ok.c=_bzEval._parseCode(v,ok.k=="switch")
                  return ok
                }else{
                  if(v.match(/^\{.*\}$/s)){
                    v=v.substring(1,v.length-1)
                    ok.c=_bzEval._parseCode(v,ok.k=="switch")
                    return ok
                  }
                }
                i=-1
              }else if(ok.k=="function"){
                k=0
                continue
              }else{
                ok.c=_bzEval._parseCode(s)
                return ok
              }
            }else if(df||op){
              s+=c
              k=0
              continue
            }else{
              k.p.ps=k.l=="{"?_parseObj(s):s?_bzEval._parseItem(s):[]
              if(k.p.ps.constructor!=Array){
                k.p.ps=[k.p.ps]
              }
            }
            k=0
            s=""
            continue
          }
        }else if(k.l==c){
          k.n++
        }
      }else if(_bzEval.bd[c]){ //([{
        k={l:c,r:_bzEval.bd[c],n:0,p:{k:c}}
        s=s.trim()
        if(ok&&ok.k=="do"){
          if(ok.c){
            s=""
            continue
          }
        }else if(ok&&["=>","function"].includes(ok.k)){
          if(s){
            s+=c
          }
          continue
        }else if(df||op){
        }else if(p&&p.cs){
          if(s){
            p.cs.push(s)
            s=""
          }
          k.p.d=1
          p.cs.push(k.p)
          continue
        }else if(s){
          k.p.d=1
          ps.push({
            dd:s,
            cs:[k.p]
          })
          s=""
          continue
        }else{
          ps.push(k.p)
          continue
        }
      }else if(c=="\n"){
        if(!df||op){
          _init()
          continue
        }
      // }else if(c==";"){
      //   if(df){
      //     df.c=_bzEval._parseItem(s)
      //     s=""
      //     ps.push(..._bzEval._parseItem(v.substring(i+1)))
      //     ps=ps.filter(x=>x)
      //     ps.forEach(x=>x.k=ps[0].k)
      //     return ps
      //   }else if(op){
      //     op.c=_bzEval._parseItem(s)
          
      //   }else if(ok&&(ok.k=="=>"||ok.k=="function")){
      //     ok.c=_bzEval._parseCode(s)
      //     ps.push(ok)
      //     ps.push(..._bzEval._parseItem(v.substring(i+1)))
      //     return ps
      //   }
      //   _init()
      //   continue
      }else if(c==","){
        if(df){
          df.c=_bzEval._parseItem(s)
          _parsePartItem(v.substring(i+1),ps)
          ps=ps.filter(x=>x)
          ps.forEach(x=>x.k=ps[0].k)
          return ps
        }else if(op){
          op.c=_bzEval._parseItem(s)
          _parsePartItem(v.substring(i+1),ps)
          return ps
        }else if(ok&&(ok.k=="=>"||ok.k=="function")){
          ok.c=_bzEval._parseCode(s)
          ps.push(ok)
          _parsePartItem(v.substring(i+1),ps)
          return ps
        }else if(!s.trim()){
          if(v.substring(0,i).trim().endsWith(",")){
            ps.push([])
          }
          _parsePartItem(v.substring(i+1),ps)
          return ps
        }else{
          s=`(${s})`
          p=_bzEval._parseItem(s)
          if(p.constructor==Array&&!ps.length){
            ps=p
          }else{
            ps.push(p)
            ps=[ps]
          }
          v=v.substring(i+1)
          while(1){
            let vv=_bzEval._findKeyOuterBlock(v,",")
            if(vv){
              ps.push(_bzEval._parseItem(`(${vv.p})`)[0])
              v=vv.e
            }else{
              ps.push(_bzEval._parseItem(`(${v})`)[0])
              return ps
            }
          }
        }
      }else if(df||ok||op){
      }else if(_bzEval._isSign(c)){
        if(df||op){
          s+=c
          continue
        }
        _init()
        p=ps[ps.length-1]
        if(!p||p.constructor!=String){
          ps.push(c)
        }else if("~!==+-*/<>&|".includes(p)){
          p+=c
          if(["--","++","==","===","!=","!==","+=","-=","*=","/=","&&","||",">=","<=",">>","<<","^=","&=","|=","!!","%="].includes(p)){
            ps[ps.length-1]=p
          }else{
            ps.push(c)
          }
        }else{
          ps.push(c)
        }
        p=ps[ps.length-1]
        if(v[i+1]!="="&&["=","+=","-=","/=","*=","^=","%=","&=","|=","&&=","||="].includes(p)){
          ps.pop()
          df={
            k:p,
            n:ps.pop()
          }
          ps.push(df)
        }
        continue
      }
      s+=c
    }
    _init()
    if(pps.length){
      if(!pps.includes(ps)){
        pps.push(ps)
      }
      return pps
    }
    if(!ps.length&&ok){
      return ok
    }
    return ps

    function _parsePartItem(v,ps){
      p=_bzEval._parseItem(v)
      if(!p||p.constructor!=Array){
        p=[p]
      }
      ps.push(...p)
    }

    function _init(){
      s=s.trim()
      if(s){
        if(ok&&ok.k=="do"){
          ok.c=_bzEval._parseCode(s)
        }else if(ok&&ok.k=="else"){
          if(!ok.c){
            ok.c=_bzEval._parseItem(s)
            s=""
          }
        }else if(ok&&(ok.k=="=>"||ok.k=="function")){
          ok.c=_bzEval._parseCode(s)
          ps.push(ok)
        }else if(df){
          df.c=_bzEval._parseItem(s)
        }else if(op){
          op.c=_bzEval._parseItem(s)
        }else if(s.match(/^(delete|typeof)\s/)||s.match(/^\.\.\./)){
          ps.push(_bzEval._parseItem(s))
        }else if(s.match(/^\./)){
          if(ps.length&&ps[ps.length-1].ps){
            ps[ps.length-1].ps.push(s)
          }else{
            ps.push(s)
          }
        }else{
          ps.push(s)
        }
        s=""
      }
    }

    function _parseObj(o){
      let d={},k,s="",b,ks=[],l;
      o=o.trim()
      if(!o){
        return d
      }
      for(let i=0;i<o.length;i++){
        let c=o[i]
        if(b){
        }else if(c=="\\"){
          b=!b
          continue
        }else if(!k){
          if(!ks.length&&c==":"){
            if(s=="null"){
              k=[null]
            }else if(s=="undefined"){
              k=[undefined]
            }else if(s=="false"){
              k=[false]
            }else if(s=="true"){
              k=[true]
            }else{
              s=s.trim().replace(/^['"]|['"]$/g,"")
              k=[s]
            }
            s=""
            continue
          }
        }else if(!s&&c.match(/\s/)){
          continue
        }else if(c==ks[0]){
          ks.shift()
        }else if("\"'`".includes(ks[0])){
        }else if("({['\"`".includes(c)){
          ks.unshift(_bzEval.bd[c])
        }else if(c==","&&!ks.length){
          d[k[0]]=_bzEval._parseItem(s)
          k=""
          s=""
          continue
        }
        s+=c
      }
      if(s){
        d[k[0]]=_bzEval._parseItem(s)
      }
      return d
    }
  },
  _parseLine:function(v){
    let s="",ps=[],b,k,kk,_endExpress=[],_comment,_inDo,_oneLine=[];
    v=v.trim()

    for(let i=0;i<v.length;i++){
      let c=v[i]

      if(_comment=="/"+"/"){
        if(c=="\n"){
          _comment=0
        }else{
          continue
        }
      }else if(_comment=="/"+"*"){
        if(c=="/"&&v[i-1]=="*"){
          _comment=0
        }
        continue
      }
      if(!s&&c.match(/\s/)){
        continue
      }else if(c=="\\"){
        b=!b
      }else if(b){
        b=0
      }else if(kk){
        if(kk==c){
          kk=0
        }
      }else if("`'\"".includes(c)){
        kk=c
      }else if(k=="/"&&c=="/"){
        k=0
      }else if(!k&&c=="/"&&s.trim().match(/[\(\[\=\?\:]$/)){
        k="/"
      }else if(c==" "&&("+-*/([{%!\?\:".includes(v[i+1])||s.match(/([\s\(\{\[\+\-\*\?\:\/\%\&\|\^\~])$/))){
        continue
      }else if((c=="/"||c=="*")&&s.match(/[^\\]\/$/)){
        _comment="/"+c
        s=s.replace(/[\/]$/,"")
        continue
      }else if(k){
        if(k.r==c){
          if(k.n){
            k.n--
          }else{
            if(_endExpress[0]&&s.includes(_endExpress[0])&&s.substring(_endExpress[0].length).trim()[0]!="{"){
            }else if(k.l=="{"){
              if(s.match(/^(for|if|while|switch|function|else|do|try)[\s\(\{]/)){
                s+=c
                if(!s.match(/^(do|try)/)){
                  _init()
                }
                k=0
                continue
              }
            }else if(k.l=="("&&s.match(/^(if|for|while|switch|function|else if)[\s|\(]/)){
              _endExpress.unshift(s+")")
              let vv=v.substring(i+1).trim();
              if(vv.match(/^(for|if|while|do|try)(\s|\{|\(|$)/)){
                v=vv
                i=-1
                _oneLine.push(_endExpress[0])
                _endExpress=[]
                s=""
                continue
              }
            }
            k=0
          }
        }else if(k.l==c){
          k.n++
        }else if(c.match(/\s/)){
          let vr=v.substring(i+1).trim(),
              vl=v.substring(0,i)
          if(_uselessSpace(vr,vl,c)){
            continue
          }
        }
      }else if(c=="\n"){
        if((_endExpress[0]||"").replace(/ /g,"")==(s||"").replace(/ /g,"")){
          continue
        }
        s=s.trim()
        if(s.match(/^do([\s\{]|$)/)&&!_inDo){
          if(!s.match(/^do\s*\{.+while.+\)/s)){
            s+=c
            _inDo=1
          }else{
            _init()
          }
          continue
        }


        let vr=v.substring(i+1).trim(),
            vl=v.substring(0,i)
        if(_uselessSpace(vr,vl,c)){
          continue
        }
        if(_inDo==1){
          if(!vr.match(/^while(\s|\()/)){
            _inDo=0
            _init()
          }else{
            s+=c
          }
          continue
        }
        if(vl.endsWith("}")&&vr.match(/^(catch|while)(\s|\()/)){
          continue
        }else if(s.trim()=="else"){
          s="else "
          continue
        }
        _init()
        continue
      }else if(c==";"){
        let vr=v.substring(i+1).trim()
        if((!_inDo||!vr.match(/^while(\s|\()/))&&_endExpress[0]!=s){
          ps.push(s.trim())
          s=""
          _init()
          continue
        }
      }else if(_bzEval.bd[c]){
        s=s.trim()
        k={l:c,r:_bzEval.bd[c],n:0}
      }
      s+=c
    }
    _init()
    return ps

    function _uselessSpace(vr,vl,c){
      if(vl.match(/([^-]-|[^+]\+|[^\/]\/|[\*=~!&\|\^%><?:,;\.\(\[\{])$/)||vr.match(/^(-[^-]|\!\=|\+[^+]|\/[^\/\*]|[\*%\^&|=><?:,;\.\(\)\[\]\}])/)||vl.match(/([\+][\+][\+]|---)$/)){
        return 1
      }else if(vr[0]=="{"){
        return c!="\n"
      }
    }

    function _init(){
      s=s.trim()
      if(_oneLine.length){
        s=_oneLine.join(" ")+s
        _oneLine=[]
      }
      if(s){
        ps.push(s)
        s=""
      }
      _endExpress.shift()
      _inDo=0
    }
  },
  /**/
  _chkParameter:function(){
    let vs=[]
    for(let i=0;i<arguments.length;i++){
      vs.push(arguments[i])
    }
    return vs
  },
  _testCode:function(_simpleExe,_repeat){
    let vs=[
      {c:`let a=/[a-z]+\\/[0-9]+/ig,b="89a/999B/3d2c/4";b.match(a)`,r:['a/999', 'B/3', 'c/4']},
      {c:"!1+2*3+(~4+5)/3*6+7%2+3^4+!!2<<2+3>>2",r:34},
      {c:"1<2*3&&(4+5)/3*6+7%2>3^4+2<<2+3>>2",r:49},
      {c:"let a=1;!a",r:false},
      {c:"let a=1;~a+5",r:3},
      {c:"_IDE._data._curTest._data.name",r:"demo"},
      {c:"_IDE._data._curTest._data.name+(9+6)*10+'px'",r:"demo150px"},
      {c:"_IDE._data._curTest._data.name+(9+6)*10+1",r:"demo1501"},
      {c:"[1,2,3,null,undefined,0]",r:[1,2,3,null,undefined,0]},
      {c:"({a:2}).a",r:2},
      {c:"[1,2,3][0]",r:1},
      {c:"_Util._replaceAll('lws','w','ok')",r:"loks"},
      {c:"_Util._replaceAll('lws','w','ok')[2]",r:"k"},
      {c:"_ideTestManagement._getStdDescription(_IDE._data._curTest)",r:"[m5.t4] demo"},
      {c:"_ideTestManagement._getStdDescription(_IDE._data._curTest)+' '+_ideTestManagement._getStdDescription(_IDE._data._curTest)",r:"[m5.t4] demo [m5.t4] demo"},
      {c:"_ideTestManagement._getStdDescription(_IDE._data._curTest).length+10*10",r:112},
      {c:"_bzEval._chkParameter(0)",r:[0]},
      {c:"_bzEval._chkParameter(undefined)",r:[undefined]},
      {c:"_bzEval._chkParameter()",r:[]},
      {c:"_bzEval._chkParameter(1,2,3)",r:[1,2,3]},
      {c:"_bzEval._chkParameter({})",r:[{}]},
      {c:"[]",r:[]},
      {c:"[0]",r:[0]},
      {c:"[undefined]",r:[undefined]},
      {c:"0",r:0},
      {c:"0.1",r:0.1},
      {c:"''",r:""},
      {c:"undefined",r:undefined},
      {c:"null",r:null},
      {c:"true",r:true},
      {c:"false",r:false},
      {c:`let a=true
        if(a){
          a=11
        }
      `,r:11},
      {c:"(1,2,3)",r:3},
      {c:"let a=3;a*_IDE._data._curTest._data.actions.length;",r:6},
      {c:`let a="lws",b="w",c=3;_Util._replaceAll(a,b,c)+5`,r:"l3s5"},
      {c:`let a={a:3},b=3,c=5;b=3+delete a.a+5,b`,r:9},
      {c:`let a={a:3},b=3,c=5;b=3+typeof a.a+5,b`,r:"3number5"},
      {
        c:`let a=1
        if(a){
          a=3
        }`,
        r:3
      },
      {
        c:`let a=1
        for (let i = 0; i < 10; i++) {
            a+=1
        }`,
        r:11
      },
      {
        c:`let a=1
        for (let i = 0; i < 10; i++) 
            a+=1
        `,
        r:11
      },
      {
        c:`let a=1,i=0
        do{
            a+=7
            i++
        }while(a<100)`,
        r:14
      },
      {
        c:`let a=1
        do
            a+=7
        while(a<100)`,
        r:106
      },
      {
        c:`
        let a=2,b=3;
        if(a){
          let b=222
          a+=b
        }
        `,
        r:224
      },
      {
        c:`
        let a=2,b=3;
        if(a)
          a+=b
        `,
        r:5
      },
      {
        c:`let a=3,b=34;
        lws(3,a,b)+lws(3,b,a)
        function lws(v,a,b) {
          if(a>b){
            a+=1
          }else{
            a+=b
          }
          return v+2+a*b
        }
        `,
        r:1373
      },
      {
        c:`let a=3,b=34;
        lws(3,a,b)+lws(3,b,a)
        function lws(v,a,b) {
          if(a>b)
            a+=1
          else
            a+=b
          
          return v+2+a*b
        }
        `,
        r:1373
      },
      {
        c:`let a=3,b=34;
        lws(function(x){return x*10},a,b)
        function lws(v,a,b) {
          if(a>b){
            a+=1
          }else{
            a+=b
          }
          v=v(a)
          return v+2+a*b
        }`,
        r:1630
      },
      {
        c:`let a=3,b=34;
        lws(x=>x*10,a,b)
        function lws(v,a,b) {
          if(a>b){
            a+=1
          }else{
            a+=b
          }
          v=v(a)
          return v+2+a*b
        }
        `,
        r:1630
      },
      {
        c:`let a=3,b=34;
        lws((x)=>x*10,a,b)
        function lws(v,a,b) {
          if(a>b){
            a+=1
          }else{
            a+=b
          }
          v=v(a)
          return v+2+a*b
        }
        `,
        r:1630
      },
      {
        c:`let a=3,b=34;
        lws(()=>10,a,b)
        function lws(v,a,b) {
          if(a>b){
            a+=1
          }else{
            a+=b
          }
          v=v(a)
          return v+2+a*b
        }
        `,
        r:1270
      },
      {
        c:`let lws=function(x){return x+9};lws(3)`,
        r:12
      // },
      // {
      //   c:`let lws=${_Util._replaceAll.toString()};lws(_bzEval._testCode.toString(),"a","999")`
      },
      {
        c:`b={c:33,d:334},a={a:function(){
          return b
        }}
        delete a.a().c
        b`,
        r:{d:334}
      },
      {c:"let a=[1,2,3];[a][0][1]",r:2},
      {c:"let a={a:3},b=3,c=5;b=[3+delete a.a+5,b,a];b",r:[9, 3, {}]},
      {c:"let a={a:3},b=3,c=5;b=[3+typeof a.a+5,b,a];b",r:["3number5", 3, {a:3}]},
      {c:`let a=function(){
              arguments[1]+=100;
              return [...arguments]
          }
          a(1,2,3)`,r:[1,102,3]
      },
      {c:"let a=new Date();a.getTime()>100",r:true},
      {
        c:`
        let i,j=10;
        for(i=0;i<10;i++){
          j++
          if(i>3){
            if(i){
               continue
            }
          }
          j++
        }
        j`,
        r:24
      },
      {
        c:`
        let i,j=10;
        for(i=0;i<10;i++){
          j++
          if(i>3){
            if(i){
               break
            }
          }
          j++
        }
        j`,
        r:19
      },
      {
        c:`let a=function(){
            let msg;
            try{
                let a=2;
            if(a){
              throw new Error("lws")
            }
                return 1
            }catch(ex){
                msg=ex.message
            }finally{
                return msg+3
            }
          }
          a()`,
        r:"lws3"
      },
      {
        c:`let a={
          v:"lws",
          a:function(v){
            return v+this.v+this.b(3)
          },
          b:function(v){
            return v*10
          }
        }
        a.a(10)`,
        r:"10lws30"
      },
      {
        c:`[0,1,2].filter(x=>x).map(x=>x*12)`,
        r:[12, 24]
      },
      {
        c:`let lws=function(a){
          let c;
          switch(a){
          case 1:c="+";break;
          case 2:c="-";break;
          case 3:
          case 4:c="*";break;
          default:c="%"
          }
          return eval(10+c+3)
          };
          ([0,1,2,3,4]).map(x=>lws(x))`,
        r:[1, 13, 7, 30, 30]
      },
      {
        c:`a=1,b=0;if(a)for(;a<10;a++)
        b+=3
        b`,
        r:27
      },
      {
        c:"(v=>v+1)(1)",
        r:2
      },
      {
        c:`[lws(10),lws(9),lws(2),lws(7)]
        function lws(v) {
            return v%2?v%3?11:21:v%5?111:112
        }`,
        r:[112, 21, 111, 11]
      },
      {
        c:`\`lws-\${_Util._replaceAll(name,'bz','123')}\``,
        r:"lws-123-master"
      },
      {
        c:"new Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD' }).format(22);",
        r:"$22.00"
      }
    ]
    let t=Date.now()
    if(!_simpleExe){
      vs.push(
        {
          c:`let a={a:3,b:3}
          debugger
  
          delete a.a
          a
          `,
          r:{b:3}
        },
        {c:"{a:33,b:'lws',c:{d:\"aa\",'e':[33,334,34],f:true,g:false}}",r:{a:33,b:'lws',c:{d:"aa",'e':[33,334,34],f:true,g:false}}},
        {c:"{a:0,b:undefined,c:null,'':1,null:2,undefined:2}",r:{a:0,b:undefined,c:null,'':1,null:2,undefined:2}}
      )
    }else if(_simpleExe=="bz"){
      vs.forEach(x=>x.c=_bzEval._parseCode(x.c))
      t=Date.now()
    }
    _repeat=_repeat||1
    for(let j=0;j<_repeat;j++){
      let v=vs.forEach(x=>{
        try{
          if(_simpleExe=="js"){
            eval(x.c)
          }else{
            let c=JSON.stringify(_bzEval._exeCode(x.c))
            if(!_simpleExe&&_repeat<2){
              if(c!=JSON.stringify(x.r)){
                console.log("Failed on:"+x.c+" ==> "+c)
                return 1
              }
            }else{

            }
          }
        }catch(ex){
          console.log("Get Error: "+ex.message+"\n\n"+x.c)
        }
      })
    }
    console.log("Spent time: "+(Date.now()-t))
  }
};
eval=_bzEval._exe;
window.BZ={
  _curShareData:0,
  _codeToKeyDataMap:{
    "BZ._data._autoRunning":"autoRunning",
    "_IDE._data._setting":"ideSetting",
    "_config":"config",
    "BZ._curEnv":"curEnv",
    "_aiAuthHandler._data":"aiAuthHandler",
    "BZ._data._curProject":"curProject",
    "_IDE._data._curVersion":"curVersion",
    "_IDE._data._curModule":"curModule",
    "_IDE._data._curTest":"curTest",
    "_IDE._data._curAction":"curAction",
    "_aiDataHandler":"aiDataHandler",
    "_cooperatorHandler._data":"cooperatorHandler",
    "BZ._hasVideo":"hasVideo",
    _dictionaryConfig:"dictionaryConfig",
    "BZ._data._status":"bzStatus",
    "_ideDataBind._data._key":"ideDataBindKey",
    "_ideDataBind._data._limit":"ideDataBindLimit",
    "_cssHandler._curPanel":"cssHandlerCurPanel",
    "_innerWin._data._dataBind._showDataBind":"dataBindShowDataBind",
    "_comCss":"comCss",
    "curUser._curProject.setting":"curProjectSetting",
    "_appWordHandler._wordMap":"appWordHandlerWordMap",
    "_IDE._data._setting.curEnvironment":"settingCurEnvironment",
  },
  _data:{},
  _log:function(o){
    console.log("BZ._debug")
    if(BZ._debug||["staging-be.boozang.com","location"].includes(location.host)){
      for(var i=0;i<arguments.length;i++){
        console[i?'log':'warn'](arguments[i])
      }
    }
  },
  _getHostList:function(){
    return _IDE._getCurEnvironment().items
  },
  _getHostIdx:function(_url){
    _url=_Util._removeProtocol(_url)
    let _items=BZ._getHostList()
    let v=_items.filter((o,i)=>{
      return _url.startsWith(_Util._removeProtocol(o.host))
    }).sort((a,b)=>{return b.host.length-a.host.length})[0]
    
    
    if(v){
      return _items.indexOf(v)
    }
  },
  _setStatus:function(d,_done){
    if(bzComm._isAppExtension()){
      var p=_innerWin._data._pos;
      let s=BZ._data._status
      if(s!=d){
        if(!d){
          if(s=="record"){
            bzComm.postToIDE({fun:"_end",scope:"_ideRecorder"})
          }else if(s=="play"&&s=="pause"){
            bzComm.postToIDE({fun:"_end",scope:"_ideTask",ps:[1]})
            p._inMin=p._inMin==2?1:0;
          }
        }else{
          if(d=="record"){
            bzComm.postToIDE({fun:"_start",scope:"_ideRecorder"})
          }else if(d=="play"||d=="pause"){
            bzComm.postToIDE({fun:"_start",scope:"_ideTask"})
            p._inMin=p._inMin?2:1;
          }
        }
      }
    }else if(bzComm._isApp()){
      bzComm.postToAppExtension({
        fun:"_setStatus",
        scope:"BZ",
        ps:[d]
      })
    }else{
      BZ._data._status=d
      BZ._setSharedData({"BZ._data._status":d})
    }
  },
  toolbar:{
    miniTool:function(){
      debugger    
    },
    resize:function(o){
      bzComm.postToAppExtension({
        fun:"resize",
        scope:"_innerWin"
      })
    },
    addValidation:function(){
      bzComm.postToIDE({
        fun:"_newItem",
        scope:"_ideActionManagement",
        ps:[0]
      })
    },
    addComment:function(){
      bzComm.postToIDE({
        fun:"_newItem",
        scope:"_ideActionManagement",
        ps:[5]
      })
    },
    exeCmd:function(o){
      if(o.className.includes("bz-play")){
        BZ._setStatus("play")
      }else if(o.className.includes("bz-pause")){
        BZ._setStatus("pause")
      }else if(o.className.includes("bz-stop")){
        BZ._setStatus("")
      }else if(o.className.includes("bz-record")){
        BZ._setStatus("record")
      }else if(o.className.includes("bz-validate")){
        BZ.toolbar.addValidation()
      }else if(o.className.includes("bz-comment")){
        BZ.toolbar.addComment()
      }
    },
    autoFillForm:function(){
      debugger
    }
  },
  _isPlaying:function(){
    return BZ._data._status=="play";
  },
  _isPausing:function(){
    return BZ._data._status=="pause";
  },
  _isRecording:function(){
    return BZ._data._status=="record";
  },
  _inProcessing:function(){
    return ['record','play','pause'].includes(BZ._data._status);
  },
  setDataBindSwitch:function(v){
    _innerWin._data._dataBind._showDataBind=v;
    bzComm.postToIDE("setDataBindSwitch","BZ",v);
  },
  initData:function(){
    if(window.extensionContent&&bzComm.getIdeTabId()&&bzComm._isAppExtension()){
      bzComm.postToIDE({
        fun:"getSharedData",
        scope:"BZ",
        return:function(d){
          if(d){
            BZ.assignShareData(d)
            _aiDataHandler._init()

            if(BZ._isRecording()){
              setTimeout(()=>{
                _domRecorder._handleFileInput()
              },100)
            }else if(BZ._data._status){
              bzComm.postToApp({
                fun:"_takeoverWin",
                scope:"TWHandler",
                ps:[1]
              })
            }

            bzComm.postToApp({
              fun:"initScript",
              scope:"innerScript",
              ps:[chrome.runtime.getURL(''),d],
              return:function(){
                if(BZ._isRecording()||BZ._isAutoRunning()){
                  _domRecorder._refresh()
                }
                BZ._pageReady=1
              }
            })
          }
        }
      })
    }
  },
  _isAutoRunning:function(){
    return BZ._data._autoRunning
  },
  isIgnoreReq:function(r){
    let c=_IDE._data._curVersion.setting.content;
    var s=BZ._ignoreReqs,w=BZ._whiteReqs;

    if(!s){
      s=BZ._ignoreReqs=(c.ignoreRequest||"").trim().split("\n")
    }

    if(!w){
      if(c.whiteRequest=="*"){
        w=BZ._whiteReqs=BZ._getHostList().map(x=>x.host)
      }else{
        w=BZ._whiteReqs=(c.whiteRequest||"").trim().split("\n")
      }
    }

    if(!_Util._isEmpty(w)){
      if(!w.find(x=>r.includes(x))){
        return 1
      }
    }

    if(!_Util._isEmpty(s)){
      return s.find(x=>r.includes(x))
    }
  },
  _setSharedData:function(d){
    BZ._curShareData={...BZ._curShareData,...d}
    d=_Util._changeObjectKeys(BZ._curShareData,BZ._codeToKeyDataMap)

    bzComm.postToAppExtension({
      fun:"assignShareData",
      scope:"BZ",
      ps:[d]
    })
  },  
  getSharedData:function(){
    let m=BZ._getCurModule(),t=BZ._getCurTest(),v=_IDE._data._curVersion;
    if(!BZ._curShareData||!BZ._curShareData.curUser){
      if(!BZ._data._curProject||!_IDE._data._curVersion){
        return
      }

      BZ._curShareData={
        SERVER_HOST:SERVER_HOST,
        curUser:curUser,
        "BZ._data._autoRunning":BZ._data._autoRunning,
        "BZ._data._curProject":{
          sharingRole:BZ._data._curProject.sharingRole,
          language:BZ._data._curProject.language,
          _id:pId
        },
        pId:pId,
        "_IDE._data._curVersion":{setting:v.setting,shield:v.shield,freezed:v.freezed},
        _config:_config,
        "_IDE._data._setting":_IDE._data._setting,
        "_aiAuthHandler._data":_aiAuthHandler._data,
        _dictionaryConfig:_dictionaryConfig
      }
    }
    
    let d={
      "BZ._curEnv":BZ._curEnv,
      "_aiAuthHandler._data":_aiAuthHandler._data,
      "_IDE._data._curModule":m&&{
        data:_Util._cloneSelectData(m._data,0,"code|name|parentModule|bt")
      },
      "_IDE._data._curTest":t&&{
        data:_Util._cloneSelectData(t._data,0,"code|name|actions|type")
      },
      "_IDE._data._curAction":_IDE._data._curAction,
      "BZ._data._checkout":t&&BZ._isCheckout()&&t._data.type=="unit",
    }
    d={...BZ._curShareData,...d}
    return _Util._changeObjectKeys(d,BZ._codeToKeyDataMap)
  },
  assignShareData:function(d){
    BZ._keyToCodeDataMap=BZ._keyToCodeDataMap||_Util._invertObject(BZ._codeToKeyDataMap)
    d=_Util._changeObjectKeys(d,BZ._keyToCodeDataMap)

    for(var k in d){
      var v=d[k]
      let ks=k.split(".")
      _parseData(ks,v)
    }

    if(bzComm._isAppExtension()){
      _innerWin._insertCtrls()
      _innerWin._setToolbarStatus()
    }

    function _parseData(ks,d,r){
      let k=ks.shift()
      r=r||window
      if(ks.length){
        r[k]=r[k]||{}
        _parseData(ks,d,r[k])
      }else{
        r[k]=d
      }
    }
  },
  setCheckout:function(v,_done){
    BZ._data._checkout=v
    if(bzComm._isIDE()){
      bzComm.postToAppExtension({fun:"setCheckout",scope:"BZ",ps:[v]})
    }else{
      _innerWin._setToolbarStatus()
    }
  },
  test:function(v,_fun){
    v+="-1"
    _fun&&_fun(v)
    return v
  },
};
//bz-ignore
window._Util={
  _attrRegex:/\[(.+)\=('|)(\$label|\$header)('|)\]/,
  _bzJQFun:/\:(near|input|data|panel|Contains|textElement|afterEqual|after|before|endContains|contains|endEqual|equal|RowCol|rowcol|text)\((\$label|\$header)\)/,
  _allLetterAndNumber:/[\wÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC]+/,
  _allPrintableChr:/[\wÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC !"#$%&'()*+,.\/:;<=>?@\[\] ^_`{|}~-]+/,
  _allSign:/[^\wÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC]+/,
  _jsNameRegex:/[\wÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC\_\$]/,
  _jsData:/([\wÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC\_\$]+|\.|\[\"|\[\'|\'\]|\"\])+/g,
  _matchAllLetterAndNumber:/[\wÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC]+/g,
  _matchAllSign:/[^$\_\wÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC]+/g,
  _trimSign:/(^[^\(\[\{\wÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC]+|[^\wÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC\)\]\}]+$)/g,
  _dataRegex:/(((\$(project|module|test|loop|data|group|action|parameter)((\.|\[|$)([a-zA-Z0-9\u4E00-\u9FCC_\$\'\"\(\)]+[\.|\[|\]]*)*)*|(\'|\").*(\'|\"))+( *(\+|\-|\*|\/) *)*)+)/g,
  _isVarName:function(n){
    return n.match(/^[a-z_\$\u4E00-\u9FCC][a-z0-9_\$\u4E00-\u9FCC]*$/i)
  },
  _formatJSONToString:function(v,_level){
    let _list=[]
    _level=_level||""
    if(v&&v.constructor==Object){
      for(let k in v){
        if(k.match(/^[0-9]+|[^a-z0-9\u4E00-\u9FCC\_\$]/i)){
          k="\""+k+"\""
        }
        _list.push(k+": "+_Util._formatJSONToString(v[k],""))
      }
      return _join(_list,"{","}")
    }else if(v&&v.constructor==Array){
      _list=v.map(x=>_Util._formatJSONToString(x,_level))
      return _join(_list,"[","]")
    }else if($.isNumeric(v)){
      return v
    }else if(v==="true"||v===true||v==="false"||v===false){
      return v
    }else if(v.constructor==String){
      if(v.includes("\n")){
        return "`"+v.replace(/\n/g,"\n  ")+"`"
      }else{
        return JSON.stringify(v)
      }
    }else{
      return JSON.stringify(v)
    }
    function _join(vs,t1,t2){
      if(vs.find(x=>x.includes("\n")||x.length>50)||vs.length>4){
        vs="\n"+_level+vs.map(x=>{
          if(x.includes("\n")){
            x=x.split("\n").map((y,i)=>_level+y).join("\n")
          }
          return x
        }).join(",\n"+_level)+"\n"+_level
      }else{
        vs=vs.join(", ")
      }
      if(vs){
        vs=vs.trim().split("\n").map(x=>"\n  "+x).join("")+"\n"
      }
      return t1+vs+t2
    }
  },
  _isPopWin:function(){
    let w=window.outerWidth,ww=w
    if(w<screen.width/2){
      ww++
    }else{
      ww--
    }
    window.resizeBy(1,0)
    w= w!=window.outerWidth
    window.resizeBy(-1,0)
    return w
  },
  _getElementBestWidth:function(e){
    let sw=0,ms=0,r=e.getBoundingClientRect().width
    for(let o of e.children){
      sw+=_Util._getElementBestWidth(o)
    }
    if(!e.children.length&&e.innerText){
      sw= e.innerText.trim().split("\n")[0].length*5.7
    }
    ["margin-left","margin-right","padding-left","padding-right"].forEach(x=>{
      ms+=(parseInt($(e).css(x))||0)
    })
    if(sw){
      if(sw<r){
        if(!e.children.length){
          sw+=20
        }
        if(sw>r){
          return r+ms
        }
      }
    }else{
      sw=Math.min(r,30)
    }
    return sw+ms
  },
  _isBaseDataType:function(v){
    if(v!==null&&v!==undefined){
      return v.constructor==String||v.constructor==Number||v.constructor==Boolean
    }
  },
  _isBZTWOpened:function(){
    return BZ.TW&&!BZ.TW.closed&&!window.extensionContent
  },
  _openBZTW:function(_url,ws){
    BZ.TW=window.open(SERVER_HOST+"/empty.html?bzIde="+bzComm.getIdeTabId()+"#"+_url,"bz-client",ws);
  },
  _parseStdJson:function(v){
    try{
      if(v&&v.constructor==String){
        return JSON.parse(v)
      }
    }catch(e){}
    return v
  },
  _getColorByName:function(v){
    while(v.length<6){
      v+=v
    }
    let c="#"
    for(let i=0;i<6;i++){
      c+=(v.charCodeAt(i)%10)
    }
    return c
  },
  _clickNextElement:function(_doc,_event){
    if(_event){
      
      setTimeout(()=>{
        let e=_Util._getElementByXY(_doc.body,_event.clientX,_event.clientY)

        $(e).focus()
        // $util.triggerMouseEvents(e,"click")
        $(e).click()

      },100)
    }
  },
  _getBrowserTime:function(){
    return performance.now()
  },
  _animateDownUp:function(b){
    if(!b){
      return
    }
    let p=b.style.position,t=b.style.top;

    b.style.position="relative";
    $(b).animate({top: "10px"});
    setTimeout(()=>{
      $(b).animate({top: 0});
    },200)
  },
  _isAPISucessStatus:function(v){
    return v!="0"&&v&&v<400
  },
  _isRegexData:function(s){
    if(s && s.constructor==String){
      return !!s.match(/^[\/](.+)[\/][igs]*$/)
    }
  },
  _toRegExp:function(v){
    try{
      if(_Util._isRegexData(v)){
        v=eval(v)
      }
      if(v&&v.constructor==RegExp){
        return v
      }
    }catch(ex){}
  },
  _isXMLData:function(v){
    return v&&v.constructor==String&&v.trim().match(/^<([^ ]+).+<([^>]+)>$/s);
  },
  _joinMessage:function(a){
    a=[...a]
    a=a.filter(x=>x)
    let v=a.pop()
    a=a.join(", ")
    if(a){
      return _Util._formatMessage(_bzMessage._common._andMessage,[a,v])
    }
    return v
  },
  _getEnumFromRegex:function(v){
    if((v||"").match(/^\/([^\|]+\|)+.+\/$/)){
      v=v.substring(1,v.length-1).replace("\\.",".")
      let vv=v.match((/([^\(]*)\(([^\)]+)\)([^\)]*)/))
      if(vv){
        return vv[2].split("|").map(x=>vv[1]+x+vv[3])
      }else if(!v.match(/^\{.*\}$/)){
        return v.split("|")
      }else{
        return [v]
      }
    }
    return []
  },
  _findMissingId:function(ts){
    let v;
    ts.sort((a,b)=>a-b);
    ts.find((x,i)=>{
      if(x!=i+1){
        v=i+1
        return 1
      }
    })
    return v
  },
  _log:function(){
    let ps=[]
    for(var i=0;i<arguments.length;i++){
      let v=arguments[i]
      if([Object,Array].includes(v.constructor)){
        v=JSON.stringify(v,0,2)
      }
      ps.push(v+"")
    }
    let p=ps.shift()
    if(p.match(/\{[0-9]\}/)){
      p=_Util._formatMessage(p,ps)
    }else{
      ps.unshift(p)
      p=ps.join("\n")
    }
    if(window.extensionContent){
      bzComm.postToIDE({scope:"_Util",fun:"_log",ps:[p]});
      return p
    }
    if(p.startsWith("video-img:")){
      if(!BZ._isPlaying()){
        return
      }
    }else if(p.includes("miss-element-screenshot-md5")){
      _ideTask._setLastScreenshotMd5(p.split(":")[1].trim())
    }
    console.log("BZ-LOG: "+p)
    if(p&&p.length>1000&&BZ._isAutoRunning()){
      console.clear()
    }
    return p
  },
  _getElementSimplePath:function(o){
    let os=document.getElementsByTagName(o.tagName)
    for(var i=0;i<os.length;i++){
      if(os[i]==o){
        return ["BZ.TW.document",o.tagName,i]
      }
    }
  },
  _highlightKeywordsInHTML:function(w,k,_match){
    k=(k||"").trim()
    if(!k){
      return "<div></div>"
    }

    if(_match){
      let g=eval(_match._regex+"g"),
      s=eval(_match._regex)
      w=w.split("\n")
      w=w.map(x=>{
        let xx=x.match(g)
        x=x.replace(g,"\n").split("\n")
        return x.map((z,i)=>{
          let n=0
          if(!i){
            n=1
          }else if(x[i+1]){
            n=2
          }
          z=_Util._getStringBySize(z,30,n);
          if(xx[i]){
            let vs=xx[i].match(s)
            return z+xx[i].replace(vs[_match._idx],`<span class='bz-search-word'>${vs[_match._idx]}</span>`)
          }else{
            return z
          }
        }).join("")
      }).join("\n")
    }else{
      var fw=w.toLowerCase(),
          fd=k.toLowerCase().split(" ")
      let ws=[{w:w,fw:fw}]

      fd.forEach(y=>{
        let x=ws[ws.length-1]
        let ww=x.fw.indexOf(y)
        if(ww>=0){
          let nw=x.w.substring(ww+y.length)
          let nfw=x.fw.substring(ww+y.length)
          x.w=x.w.substring(0,ww)
          x.fw=x.fw.substring(0,ww)
          ws.push({k:y})
          ws.push({w:nw,fw:nfw})
        }
      })

      w=ws.map((x,i)=>{
        if(x.w){
          if(!i){
            i=1
          }else if(ws[i+1]){
            i=2
          }else{
            i=0
          }
          return x.w
          // return _Util._getStringBySize(x.w,30,i)
        }else if(x.k){
          return `<span class="bz-search-word">${x.k}</span>`
        }
      }).join("")
    }
    return `<div>${w}</div>`
  },
  _waitElement:function(e,_fun){
    if($(e)[0]){
      return _fun($(e)[0])
    }
    setTimeout(()=>{
      _Util._waitElement(e,_fun)
    },100)
  },
  _createItem:function({_title,_data,_fun}){
    let d={}
    _Util._confirmMessage({
      _tag:"div",
      _data:d,
      _items:[
        Object.keys(_data).map(k=>{
          return _stdComponent._getInputViewDef({
            _label:_data[k],
            _dataModel:function(){
              return "_data."+k
            }
          })
        })
      ]
    },[{
      _title:"_bzMessage._common._confirm",
      _class:"btn-primary",
      _click:function(c){
        _fun(d,c)
      }
    }],_title)
  },
  _findLabel:function(f,v,_removeSign){
    let o=_cssHandler._findNodeByTxt(f,v,_removeSign);

    if(!o.length){
      let os=$(f).find(":hidden").toArray()
      os.forEach(x=>{
        x=_cssHandler._findNodeByTxt(x,v,_removeSign);
        if(x.length){
          o.push(...x)
        }
      })
    }

    if(o.length>1){
      o.forEach(x=>{
        x.w=x.w.trim().replace(/ +[*]$/,"").trim()
      })
      o.sort((a,b)=>{
        return a.w.length-b.w.length
      })
      if(o[1].w.length>o[0].w.length){
        return [o[0]]
      }
      let oo=o.filter(x=>{
        if(x.e.tagName=="LABEL"){
          return 1
        }else if(x.e.parentElement&&x.e.parentElement.tagName=="LABEL"){
          let p=x.e.parentElement
          if(p.children.length>1){
            for(let n of p.children){
              if(n!=x.e){
                if(_cssHandler._lookLikeInput(x.e,n)){
                  x.ks.push(n)
                }
              }
            }
          }
          x.e=p
          return 1
        }
      });
      if(oo.length){
        o=oo
      }
    }
    if(o.length>1&&!v.includes("|")){
      o.sort((a,b)=>a.w.length-b.w.length)
      o=o.filter(x=>x.w.length==o[0].w.length)
    }
    
    o.forEach(x=>{
      while(x.e.tagName!="LABEL"&&x.e.parentElement.children.length==1&&!x.ks.length){
        x.e=x.e.parentElement
      }
    })
    
    return o
  },
  _afterAppReady:function(_fun,_chkElement){
    if(!document.body.innerText){
      return setTimeout(()=>{
        _Util._afterAppReady(_fun)
      },100)
    }
    _domActionTask._isLoading(function(){
      _chk(_chkElement,0)
    })
    function _chk(e,i){
      if(e&&!$util.findDom(e)){
        if(i>20){
          _fun()
        }else{
          setTimeout(()=>{
            _chk(e,i+1)
          },100)
        }
      }else{
        _fun()
      }
    }
  },
  _getInputValue:function(o){
    let v=o.value
    if(["INPUT","SELECT","TEXTAREA"].includes(o.tagName)){
      if(o.type=="radio"){
        v=$("input[name="+o.name+"]").val()
      }else if(o.type=="checkbox"){
        v=o.checked
      }
    }else{
      v=$util.getElementText(o)
    }
    return v
  },
  _getTargetElement:function(os){
    os=os.toArray?os.toArray():os;
    let i=1
    while(os.length>i){
      if($(os[i-1]).find(os[i])[0]){
        os.splice(i-1,1)
      }else{
        i++
      }
    }
    return os
  },
  _testPerformance:function(_fun){
    let t=Date.now()
    _fun()
    console.log(Date.now()-t)
  },
  _getDataKeyMap:function(d){
    let m={};
    for(let k in d){
      let kk=_Util._toCamelWords(_Util._toSingularWord(_Util._parseCamelWords(_Util._toCamelWords(k))))
      m[kk]=k
    }
    return m
  },
  _isInMenu:function(o,p){
    while(!$(o).find(p)[0]){
      if(["fixed","absolute"].includes($(o).css("position"))){
        return 1
      }
      o=o.parentElement
    }
  },
  _getDiffWords:function(w1,w2,_splitRegex,_inSensitive,_noIgnoreNumber){
    w1=_initWordds(w1)
    w2=_initWordds(w2)
    let ds=[],ws1=w1.length,ws2=w2.length
    _chkEnd(w1,w2)
    while(w1.length&&w2.length){
      let p1=w1.shift(),
          p2=w2.shift()
      if(p1!=p2){
        let i1=w1.indexOf(p2),
            i2=w2.indexOf(p1)
        if(i1==-1){
          ds.push(p2)
          if(i2==-1){
            ds.push(p1)
          }else{
            w1.unshift(p1)
          }
        }else if(i2==-1){
          ds.push(p1)
          w2.unshift(p2)
        }else if(w1.length-i1>w2.length-i2){
          w2.unshift(p2)
          ds.push(p1)
        }else if(w1.length-i1<w2.length-i2){
          w1.unshift(p1)
          ds.push(p2)
        }else if(w1.length>w2.length){
          ds.push(p1)
          w2.unshift(p2)
        }else if(w1.length<w2.length){
          ds.push(p2)
          w1.unshift(p1)
        }else{
          ds.push(p1,p2)
        }
      }
    }
    ds.push(...w1)
    ds.push(...w2)
    return {ds:ds,p1:ds.length/ws1,p2:ds.length/ws2}
    
    function _chkEnd(_pop){
      while(w1.length&&w2.length){
        let p1=w1.pop(),
            p2=w2.pop()
        if(p1!=p2){
          w1.push(p1)
          w2.push(p2)
          return
        }
      }
    }
    
    function _initWordds(w){
      if(_inSensitive){
        w=w.toLowerCase()
      }
      if(!_noIgnoreNumber){
        w=w.replace(/[0-9]/g,"")
      }
      w=w.replace(_splitRegex||/ +/g," ").split(" ").filter(x=>x)
      return w
    }
  },
  _isSameElement:function(a,b,_simple){
    if(a==b){
      return 1
    }else if(!_Util._isHidden(a)&&!_Util._isHidden(b)){
      return
    }
    if(a.tagName==b.tagName&&a.type==b.type&&a.innerText==b.innerText){
      if(a.parentElement&&b.parentElement&&!a.innerText){
        if(!_Util._isSameElement(a.parentElement,b.parentElement,_simple)){
          return
        }
      }
      if(_simple){
        return 1
      }
      let d=0,s=0;
      for(let k in a.attributes){
        let av=k.value,
            bv=b.attributes[k.name];
        if(av!=bv){
          if(av&&bv){
            av=av.replace(/[0-9 ]/g,"")
            bv=bv.replace(/[0-9 ]/g,"")
            if(av!=bv){
              d++
              continue
            }
          }else if(k.name!="value"){
            d++
            continue
          }
        }
        s++
      }
      return d==0||s>d
    }
  },
  _filterEndElementList:function(_list){
    let n=0
    for(let i=n+1;i<_list.length;i++){
      let io=_list[i],no=_list[n]
      if(io.tagName!=no.tagName){
        if($(io).find(no).length){
          _list.splice(i--,1)
        }else if($(no).find(io).length){
          _list.splice(n,1)
          i--
        }
      }
    }
  },
  _drawArrow:function(c,x1,y1,x2,y2,_headlen,z){
    _headlen=_headlen||10;
    z=z||1
    var _angle = Math.atan2(y2-y1,x2-x1);
    c.moveTo(x1,y1);
    c.lineTo(x2,y2);
    c.moveTo(x2-_headlen*Math.cos(_angle-Math.PI/12)*z,y2-_headlen*Math.sin(_angle-Math.PI/12)*z);
    c.lineTo(x2,y2);
    c.lineTo(x2-_headlen*Math.cos(_angle+Math.PI/12)*z,y2-_headlen*Math.sin(_angle+Math.PI/12)*z);
    c.stroke();
  },
  _showLargeImgOnMouseover:function(o){
    o._overTime=setTimeout(()=>{
      let s=o.style;
      if(o.clicked){
        o.clicked=0
        return
      }
      if(s.position!="absolute"){
        s.position="absolute";
        let r=o.getBoundingClientRect();
        if(r.right>window.innerWidth){
          s.right="10px"
        }else if(r.left>50){
          s.marginLeft="-40px";
        }

        let c=document.createElement("div")
        document.body.append(c)
        c.style="background-color: transparent;z-index: 2147483647;position: fixed;top: 0;left: 0;width: 100%;height: 100%;"
        c.onclick=function(){
          s.position=s.marginLeft=s.right="";
          c.remove();
          o.clicked=Date.now()
          setTimeout(()=>{
            o.clicked=0
          },500)
        }
      }
    },300)
  },
  _getListSum:function(_list){
    if(_list.length){
      return _list.reduce((a,b)=>a+b)
    }
    return 0
  },
  _getListAvg:function(_list){
    if(_list.length){
      return _list.reduce((a,b)=>a+b)/_list.length
    }
    return 0
  },
  _toSingularWord:function(w){
    w=w||""
    w=w.trim().plural().replace(/\s+/g," ").split(" ")
    return w.map(x=>x.plural(1)).join(" ")
  },
  _getPageRootNode:function(){
    let o=document.body.parentElement,os=[]
    for(let x of o.children){
      if(!_Util._isHidden(x)){
        os.push(x)
      }
    }
    return os
  },
  _invertObject:function(o){
    return Object.fromEntries(Object.entries(o).map(([k,v])=>[v,k]))
  },
  _changeObjectKeys:function(o,km){
    return Object.fromEntries(Object.entries(o).map(([k,v])=>[km[k]||k,v]))
  },
  _removeProtocol:function(_url){
    return _url.replace(/^(http|https)?:?[\/][\/]/,"")
  },
  _getSysObj:function(k){
    let d=window
    let ks=k.split(".")
    for(let i=0;i<ks.length;i++){
      let x=ks[i]
      d=d[x]
      if(d===undefined||d===null){
        break
      }
    }

    return d
  },
  _setSysObj:function(k,v){
    try{
      let ks=k.split(".")
      let d=window
      k=ks.pop()
      ks.forEach(x=>{
        if(d[x]===undefined){
          d[x]={}
        }
        d=d[x]
      })
      d[k]=v
    }catch(e){
      try{
        eval(k+"=v",{},"set",k,v)
      }catch(ee){}
    }
  },
  _assign:function(f,t,ks){
    for(let k in f){
      if(!ks||ks.includes(k)){
        if(!ks){
          if(t[k]&&f[k]&&t[k].constructor==Object&&f[k].constructor==Object){
            _Util._assign(f[k],t[k])
          }else{
            t[k]=f[k]
          }
        }else{
          t[k]=f[k]
        }
      }
    }
    return t
  },
  _overwriteObj:function(c,n){
    $.extend(true,c,n);
    _cleanData(c,n)
    function _cleanData(c,n){
      for(let k in c){
        if(n[k]===undefined){
          delete c[k]
        }else if(n[k].constructor==Object){
          _cleanData(c[k],n[k])
        }
      }
    }
  },
  _getEllipsisText:function(d,s){
    if(d){
      s=s||100
      if([Array,Object].includes(d.constructor)){
        d=JSON.stringify(d)
      }
      if(d.length>s){
        d=d.substring(0,s)+" ..."
      }
    }
    return d
  },
  _toErgodicList:function(o){
    let _list=[],d={}
    if(_Util._isEmpty(o)){
      return _list[o]
    }
    for(let k in o){
      let vs=o[k],_tmpList=_list
      _list=[]
      if(!vs||vs.constructor!=Array){
        vs=[vs]
      }
      let _init=!_tmpList.length
      vs.forEach(x=>{
        if(_init){
          d={}
          d[k]=x
          _tmpList.push(d)
        }else{
          _tmpList.forEach(y=>{
            y[k]=x
          })
          _list=_list.concat(_tmpList)
          _tmpList=_Util._clone(_tmpList)
        }
      })
      if(_init){
        _list=_tmpList
      }
    }
    return _list
  },
  _getDataByPath:function(d,p){
    p=p.split(".")
    p.find(x=>{
      try{
        d=d[x]
      }catch(e){
        d=undefined
        return 1
      }
    })
    return d
  },
  _setDataByPath:function(d,p,v,_initOnly){
    p=p.split(/[.]|[\[]'?"?|[\]]'?"?/).filter(x=>x)
    while(p.length){
      let k=p.shift()
      if(p.length){
        if(d[k]===undefined){
          if($.isNumeric(p[0])){
            d[k]=[]
          }else{
            d[k]={}
          }
        }
        d=d[k]
      }else{
        if(_initOnly){
          if(d[k]===undefined){
            d[k]=v
          }
        }else if(d){
          d[k]=v
          if(d.list){
            d.list.find((x,i)=>{
              if(x==v){
                d.list.splice(i,1)
                return 1
              }
            })
            d.list.unshift(v)
          }
        }
      }
    }
    p.find((x,i)=>{
      try{
        if(d[x]===undefined){
          
        }
        d=d[x]
      }catch(e){
        d=undefined
        return 1
      }
    })
    return d
  },
  _generateNewName:function(n){
    let nn=n.match(/(.+)\(?([0-9]+)\)?$/)
    if(nn){
      n=nn[1].replace(/\($/,"")
      nn=parseInt(nn[2])+1
    }else{
      nn=1
    }
    return n+"("+nn+")"
  },
  _getSameTextDom:function(os,w){
    if(os.length<2){
      return os
    }
    let vs=[],ws=[]
    w=w.replace(/\s+/g," ").toLowerCase().trim()
    os.forEach(x=>{
      ws.push(x.innerText.replace(/\s+/g," ").toLowerCase().trim())
    })
    ws.forEach((x,i)=>{
      if(x==w){
        vs.push(os[i])
      }
    })
    if(vs.length){
      return vs
    }
    
    ws.forEach((x,i)=>{
      if(x.includes(w)){
        vs.push(os[i])
      }
    })
    if(vs.length){
      return vs
    }
    return vs
  },
  _getCeilDom:function(_list){
    let os=[],_last
    while(_list.length){
      let o=_list.pop()
      if(_last){
        if(!$(o).find(_last)[0]){
          os.unshift(o)
        }
      }else{
        os.unshift(o)
      }
      _last=o
    }
    return os
  },
  _queryToObj:function(_url){
    if(_url){
      _url=_url.split("?")[1]
      if(_url){
        _url=_url.split("#")[0]
        if(_url){
          _url=_url.split("&")
          let v={}
          _url.forEach(x=>{
            x=x.split("=")
            if(x[1]){
              x[1]=decodeURIComponent(x[1])
            }
            v[x[0]]=x[1]
          })
          return v
        }
      }
    }
  },
  _randomList:function(ts){
    ts.forEach((x,i)=>{
      ts.splice(i,1)
      if(Math.random()>0.5){
        ts.unshift(x)
      }else{
        ts.push(x)
      }
    })
  },
  _isBlankIFrame:function(x){
    try{
      return x.contentWindow.location.href=="about:blank"||x.contentWindow.location.href==location.href
    }catch(e){}
  },
  //JSON style but include ref-data, like: $test.name ...
  _isSameMissJSON:function(v1,v2){
    v1=v1.replace(/ *\: */g,":")
    let s1=v1.match(/\:\"[^\"]+\"/g)
    let s2=v2.match(/\:\"[^\"]+\"/g)
    if(s1==s2){
    }else if(!s1||!s2){
      return
    }else{
      s1=s1.sort().join("\t")
      s2=s2.sort().join("\t")
      if(s1!=s2){
        return
      }
    }
    s1=v1.replace(/\:\"[^\"]+\"/g,":")
    s2=v2.replace(/\:\"[^\"]+\"/g,":")
    v1=s1
    v2=s2

    s1=v1.match(/[^\{\,]+\:/g)
    s2=v2.match(/[^\{\,]+\:/g)
    
    if(s1==s2){
    }else if(!s1||!s2){
      return
    }else{
      s1=s1.map(x=>{return x.trim().replace(/\"/g,"")}).sort().join("\t")
      s2=s2.map(x=>{return x.trim().replace(/\"/g,"")}).sort().join("\t")
      if(s1!=s2){
        return
      }
    }
    s1=v1.replace(/[^\{\,]+\:/g,"").replace(/[\{\}]/g,"").replace(/\s/g,"").split(",").sort().join(",")
    s2=v2.replace(/[^\{\,]+\:/g,"").replace(/[\{\}]/g,"").replace(/\s/g,"").split(",").sort().join(",")
    return s1==s2
  },
  //atob
  _b64DecodeUnicode:function(str) {
    // Going backwards: from bytestream, to percent-encoding, to original string.
    try{
      return atob(str)
    }catch(e){
      return decodeURIComponent(atob(str).split('').map(function(c) {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
    }
  },
  //btoa
  _b64EncodeUnicode:function (str) {
    // first we use encodeURIComponent to get percent-encoded UTF-8,
    // then we convert the percent encodings into raw bytes which
    // can be fed into btoa.
    try{
      return btoa(str)
    }catch(e){
      return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,
          function toSolidBytes(match, p1) {
              return String.fromCharCode('0x' + p1);
      }));
    }
  },
  _t36String:"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",
  _to36:function(v){
    let i=_Util._t36String.length
    let x=_Util._t36String[v%i]
    v=Math.round(v/i)||""
    if(v){
      v=_Util._to36(v)
    }
    return v+x
  },
  _t62String:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",
  _to62:function(v){
    let i=_Util._t62String.length
    let x=_Util._t62String[v%i]
    v=Math.round(v/i)||""
    if(v){
      v=_Util._to62(v)
    }
    return v+x
  },
  _formatJQSelection:function(v){
    if(v&&"#.".includes(v[0])){
      v=v[0]+v.substring(1).replace(/([^0-9a-z-_])/gi,"\\$1")
    }
    return v
  },
  //update css before/after 
  _updateCssContent:function(k,v){
    document.styleSheets[0]&&(document.styleSheets[0].addRule(k,v))
  },
  //For check _bzMessage data
  _getKeyList:function(d,p,w){
    w=w||[],p=p||""
    for(let k in d){
      w.push(k)
      if(d[k].constructor==Object){
        _getKeyList(d[k],p+"  ")
      }
    }
    return w
  },
  _getJSONErrorPosition:function(v,_startLine){
    v=v.split("\n")
    let w=[],_followKey;
    v.forEach((x,i)=>{
      x=x.trim()
      if(x.match(/^[\,\{\}\[\]]$/)){
        _followKey=0
        return
      }
      x=x.replace(/[\[ ]+$/,"")
      
      if(x.length>1&&!_followKey&&!x.endsWith(",")&&!x.endsWith("{")){
        if(!v[i+1]||!v[i+1].trim().match(/[\}\]]/)){
          _addErr(i)
          return
        }
      }

      x=x.replace(/[\, \{\[]+$/,"")

      if(x.endsWith(":")){
        _followKey=1
        x+="0"
      }
      if(x.endsWith("}")){
        if(x.length==1){
          if(_followKey){
            _addErr(i-1)
          }
          return
        }else if(x[0]!="{"){
          x="{"+x
        }
      }else if(x.includes(":")){
        if(x[0]=="{"){
          x+="}"
        }else if(x[0]=="["){
          if(x.length>1){
            x+="}]"
          }
        }else{
          x="{"+x+"}"
        }
      }else if(_followKey){
        if(x.match(/^[\wÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC\_\$]+$/)&&$.isNumeric(x)){
          _addErr(i)
        }else if(_isErr(x)){
          _addErr(i)
        }
        return
      }
      if(_isErr(x)){
        _addErr(i)
      }
    })
    return w
    function _addErr(i){
      let vv=v[i]
      if(_startLine!==undefined){
        vv=_startLine+i+": "+vv
      }
      w.push(vv)
    }
    function _isErr(v){
      try{
        let x;
        x=eval("x="+v)
      }catch(ex){
        return 1
      }
    }
  },
  _flashElement:function(o,i){
    if(o){
      i=i||200
      $(o).fadeOut(i/2).fadeIn(i/2)
    }
  },
  _inSelectOption:function(v){
    return v.tagName=="OPTION"&& (v.parentElement.tagName=="SELECT"||(v.parentElement.parentElement&&v.parentElement.parentElement.tagName=="SELECT"))
  },
  _isIgnoreElement:function(v){
    return ["HTML","SCRIPT","NOSCRIPT","LINK","HEAD","META","BASE","STYLE","BR","HR"].includes(v.tagName)||_Util._inSelectOption(v)
  },
  _isObjOrArray:function(v){
    return v&&[Array,Object].includes(v.constructor)
  },
  _handleRequestData:function(v){
    if(v&&[Object,Array].includes(v.constructor)){
      for(let k in v){
        if(v[k]=="bz-skip"){
          delete v[k]
        }else if(v[k]=="true"){
          v[k]=true
        }else if(v[k]=="false"){
          v[k]=false
        }else{
          _Util._handleRequestData(v[k])
        }
      }
    }
  },
  /*
  like: 
    s="lws ok"
    m=" "
    w="oo"
    result:"lwsoo ok"
  */
  _ajax:function(a,_proxy){
    a.async=!!a.async
    _Util._handleRequestData(a.data)
    let _jsonData
    $util.generateDataByRegex(a.query,0,(v)=>{
      a.query=v
      $util.generateDataByRegex(a.data,0,(v)=>{
        a.data=v
        if(_proxy){
          a={
            url:_proxy,
            method:"POST",
            headers:{
              "content-type":"application/json"
            },
            data:{
              method:a.method,
              url:a.url,
              data:a.data,
              headers:a.headers
            },
            complete:a.complete,
            async:a.async
          }
        }
        _doIt()
      })
    })
    
    function _doIt(){
      _jsonData=a.data
      if(Object.keys(a.headers||{}).find(x=>{
        if(x.toLowerCase()=="origin"){
          return 1
        }
      })){
        if(!_Util._isBZTWOpened()){
          BZ._launchCurEnvUrl(_IDE._data._setting.curEnvironment,function(){
            _Util._originAJax(a.complete,a)
          })
        }else{
          _Util._originAJax(a.complete,a)
        }
        return
      }
      try{
        if(_jsonData){
          if(!a.contentType||a.contentType.toLowerCase().includes("json")){
            a.data=JSON.stringify(a.data)
          }else if(a.contentType.toLowerCase().includes("form")&&_Util._isJsonValueString(_jsonData)){
            _jsonData=_Util._strToJson(_jsonData)
            if(_jsonData.constructor==Object){
              _jsonData=a.data=_Util._objToAPIParameter(_jsonData)
            }
          }
        }
      }catch(ex){
        a.complete({message:ex.stack})
      }

      if(a.headers&&a.headers["Content-Type"]){
        delete a.contentType
      }
      _callExtensionBackgroud()
  
    }
    function _showInfo(_status,_msg){
      _msg=_msg||""
      if(_msg.constructor!=String){
        _msg=JSON.stringify(_msg,0,2)
      }
      _msg=_Util._formatMessage(_bzMessage._system._error._ajaxFailed,[
        _status,
        a.url,
        a.headers?JSON.stringify(a.headers,0,2):"",
        a.query?JSON.stringify(a.query,0,2):"",
        a.body?JSON.stringify(a.body,0,2):"",
        _msg])
      alert(_msg)
    }
    function _callExtensionBackgroud(){
      if(!a.url.match(/^http/)){
        a.url="http:"+a.url
      }

      bzComm.postToBackground({
        fun:"ajax",
        scope:"bzUtil",
        return:function(r){
          let ad={}
          for(var k in a){
            if(!["async","cache"].includes(k)||(a[k]!==null&&a[k]!==undefined&&!a[k].constructor==Function)){
              ad[k]=a[k]
            }
          }
          r.request={
            data:_jsonData,
            method:a.method,
            url:a.url,
            headers:a.headers
          }

          if(r.status!="error"&&_Util._isAPISucessStatus(r.status)){
            r.responseText=r.data
            let ro=_toData(r.data)
            if(ro){
              if(ro.constructor==Blob){
                r.data=ro
              }else if([Object,Array].includes(ro.constructor)){
                r.responseJSON=ro
              }
            }
            
            if(a.complete){
              a.complete(r)
            }else{
              a.success(r)
            }
          }else{
            if(a.error){
              a.error(r)
            }else if(a.complete){
              a.complete(r)
            }
            if(!BZ._isAutoRunning()){
              _showInfo(r.status,r.message||r.data)
              BZ._data._uiSwitch._apiResultTab="_result"
            }
          }
        }
      })
    }
    
    function _toData(v){
      if(a.responseType){
        v=new Blob([v.constructor==String?_stringToBinaryArray(v):v])
      }else{
        try{
          if(v&&"[{".includes(v.trim()[0])){
            v=eval("v="+v)
          }
        }catch(e){}
      }
      return v
    }

    function _stringToBinaryArray(str) {
      var buf = new ArrayBuffer(str.length*1); // 2 bytes for each char
      var bufView = new Uint8Array(buf);
      for (var i=0, strLen=str.length; i < strLen; i++) {
        bufView[i] = str.charCodeAt(i);
      }
      return buf;
    }
  },
  _originAJax:function(d,_fun){
    if(!window.extensionContent){
      bzComm.postToAppExtension({
        fun:"_originAJax",
        scope:"_Util",
        ps:[d],
        insertCallFun:1
      },_fun);

      return
    }

    if(Object.keys(d.headers||{}).find(x=>{
      if(x.toLowerCase()=="origin"){
        if(d.headers[x].includes(location.host)){
          return 1
        }
      }
    })){
      let _jsonData=d.data
      d.request=_Util._clone(d)
      if(_jsonData){
        d.data=JSON.stringify(d.data)
      }
      d.complete=function(r){
        r.headers=d.headers
        r.request=d.request
        if(_jsonData){
          d.request.data=_jsonData
        }
        _fun(r)
      }
      $.ajax(d)
    }
  },
  _removeValueFromArray:function(a,v){
    while(1){
      let i=a.indexOf(v)
      if(i==-1){
        return
      }
      a.splice(i,1)
    }
  },
  _toggleArray:function(a,v){
    let i=a.indexOf(v)
    if(i>=0){
      a.splice(i,1)
    }else{
      a.push(v)
    }
  },
  _isSysButton:function(o){
    return o.tagName=="BUTTON"||(o.tagName=="INPUT"&&["submit","button","reset","image"].includes(o.type))
  },
  _getRandomSelection:function(p){
    let rv=_descAnalysis._retrieveTextForElementPathItem(p),ps=[],vv;
    if(rv.startsWith("/{random")){
      p.find(v=>{
        if(v.includes(rv)){
          vv=v
          return 1
        }
        ps.push(v)
      })
      if(ps.length){
        ps.push(0)
        ps=_Util._findDoms(ps)[0]
        if(ps){
          let e=rv.split(":")[1],f;
          if(e){
            e=e.split("|")
            f=e[0]
            e=e[1]
            if(e){
              e=e.substring(0,e.length-2).split(",")
            }else if(f){
              f=f.substring(0,f.length-2)
            }
          }
          if(!f){
            vv=vv.replace(rv,"")
            f=vv.replace(/(\:|\[)(near|input|data|text|panel|contains|Contains|textElement|afterEqual|after|before|endContains|endEqual|equal|RowCol|rowcol|name|title|placeholder)(\(|\"|\'|\=|)(\)|\"|\')?/,"")
            if(f==vv){
              f=vv.replace(/\:attr\([^=]+\=\)/,"")
            }
          }

          let pps=[]
          if(f&&f[0]=="!"){
            ps=$(ps).find("*").not(f.substring(1)).toArray()
          }else{
            ps=$(ps).find(f).toArray()
          }
          ps.forEach(x=>{
            let w=$util.getElementText(x)
            if(w&&(!e||!e.includes(w))){
              pps.push(x)
            }
          })

          let o=$util.randomItem(pps)
          if(o){
            p.find((v,i)=>{
              if(v.includes&&v.includes(rv)){
                p[i]=v.replace(rv,$util.getElementText(o.value))
                return
              }
            })
            return o.value
          }
          return
        }
      }
    }
  },
  _isCsvData:function(v){
    if(v.constructor==String){
      let vs=v.split("\n")
      if(vs.length>1){
        if(v.includes("\t")){
          vs=vs.map(x=>x.split("\t").length)
        }else if(v.includes(",")){
          vs=vs.map(x=>x.split(",").length)
        }
        vs=new Set(vs)
        return vs.size==1
      }
    }
  },
  //o: element
  //c: box css selector
  _getBox:function(o,c){
    c=$(c).toArray()
    return c.find(v=>{
      return $(v).find(o).length
    })
  },
  _csvToObj:function(c,_split){
    c=c||""
    _split=_split||"\t";
    var rs=c.trim().split("\n");
    rs[0]=_Util._toSBC(rs[0])
    var cs=rs[0].split(_split);
    var _data=[];
    var _start=0;
    if(cs[0]=="_key"){
      _data={};
      _start=1;
    }
    cs=cs.map(k=>{
      return _toKeyName(k,1)
    })

    if (rs.length>1) {
      for(var i=1;i<rs.length;i++){
        var d={};
        
        if (!rs[i]&&rs.length==i+1&&!_Util._isEmpty(_data)) {
          continue;
        }
        var vs=rs[i].split(_split);
        if (_start) {
          vs[0]=_toKeyName(vs[0],1);
          if (!_data[vs[0]]) {
            _data[vs[0]]=d;
          }else{
            _Util._alertMessage(_Util._formatMessage(_bzMessage._system._error._switchCsvToObjError,[" row: '"+d[cs[ii]]+"'"]));
            return;
          }
        }else{
          _data.push(d);
        }
        for(var ii=_start;ii<cs.length;ii++){
          if (d[cs[ii]]!=undefined) {
            _Util._alertMessage(_Util._formatMessage(_bzMessage._system._error._switchCsvToObjError,[" column: '"+d[cs[ii]]+"'"]));
            return;
          }
          let v=vs[ii]
          if (v) {
            d[cs[ii]]=_parseValue(v);
          }else{
            d[cs[ii]]="";
          }
        }
      }
    }
    return _data;
    
    function _parseValue(v){
      try{
        if(v.match(/^[\{\[].+[\}\]]$/)){
          v=JSON.parse(v)
          return v
        }
      }catch(ex){}
      try{
        if(v.match(_Util._dataRegex)){
          v=eval("v="+v)
        }
      }catch(ex){}
      return v
    }
    function _toKeyName(v){
      v=v.replace(/[ \-\;\@\#\&\^]/g,"_")
      if($.isNumeric(v)){
        v="_"+v
      }
      v=v.replace(/_+/g,"_").replace(/_$/g,"")

      return v
    }
  },
  _stringToData:function(v,_bkData,_bkKey){
    if(!v||[Object,Array].includes(v.constructor)){
      return _return(v)
    }
    let n=parseFloat(v);
    if(n==v){
      return _return(n)
    }
    if(v.constructor==String&&v.includes("\t")){
      n=_Util._csvToObj(v)
    }else{
      try{
        if(v.constructor==Function){
          n=v()
        }else if(v.constructor==String&&v.trim().match(/^[\{\[].+[\}\]]$/s)){
          n=_Util._strToJson(v)
        }else{
          if(_Util._isFunction(v)){
            n=eval("n="+v)
          }else{
            let vv=v.trim().split("\n")
            while(vv.length&&!vv[vv.length-1].trim().replace(/;/g,"")){
              vv.pop()
            }
            if(!_Util._isEmpty(vv)){
              let vvv=vv[vv.length-1].trim()
              if(!vvv.match(/^(var|let|const) /)){
                vv[vv.length-1]="return "+vv[vv.length-1]
              }
              vv=vv.join("\n")
              n=eval(`n=(()=>{\n${vv}\n})()`)
            }
          }
        }
        if(n===undefined||n===null){
          return _return(n)
        }else if($.isNumeric(n)){
          if(v.includes(",")){
            v=v.split(",")
            if($.isNumeric(v[0])){
              //This is a number array
              n=v.map(a=>{return a.trim()})
            }
          }
        }else if(n.constructor==RegExp){
          if(v.includes("/,/")){
            n=v.split(",")
            n=n.map(a=>{return a.trim()})
          }
        }else if(n&&n.constructor==Function){
          n=n()
        }else if(window._bzEval&&_bzEval._isFun(n)){
          n=_bzEval._exeFun(n)
        }
      }catch(e){
        if(e.message.includes("debugger")&&v.includes("debugger")){
          v=v.replace(/debugger;?/,"").trim()
          if(!BZ._isAutoRunning()){
            alert(_bzMessage._task._debuggerError+v)
          }
          return _Util._stringToData(v,_bkData,_bkKey)
        }
        if(v&&v.constructor==String&&_Util._hasCode(v)){
          console.error(e.stack)
        }

        if(v.includes(",")){
          n=v.split(",")
          n=n.map(a=>{return a.trim()})
        }else{
          n=v
        }
      }
    }
    n=$util.generateDataByRegex(n,0,_return)
    if($.isNumeric(n)){
      n=parseFloat(n)
    }
    return n
    
    function _return(v){
      if($.isNumeric(v)){
        n=parseFloat(v)
      }
      if(_bkData){
        if(_bkData.constructor==Function){
          _bkData(v)
        }else if(_bkKey){
          _bkData[_bkKey]=v
        }
      }
      return v
    }
  },
  _listToHtml:function(d,c){
    if(d&&d.constructor==Array&&d.length){
      let _header="<tr><th>"+Object.keys(d[0]).join("</th><th>")+"</tr>"
      _header=_header.replace("</th><th></tr>","</th></tr>")
      c=c||"table{width:100%}table,tr,td,th{border-collapse: collapse;border: 1px solid black;padding: 5px;}"
      return "<!DOCTYPE html><html><head><style>"+c+"</style></head><body><table>"+_header+d.map(o=>{
        let v="<tr>"
        for(var k in o){
          v+="<td>"+(o[k]&&o[k].constructor==String?o[k].replace(/\</g,'&lt;').replace(/\>/g,"$gt;"):o[k])+"</td>"
        }
        return v+"</tr>"
      }).join("")+"</table></body></html>"
    }
    return ""
  },
  _stringToJSONString:function(v){
    v=_Util._stringToData(v)
    if(v&&v.constructor!=String){
      v=JSON.stringify(v,0,2)
    }
    return v
  },
  async _asyncTimeout(v) {
    return new Promise(_fun=> {
      setTimeout(()=>{
        _fun()
      },v)
    });
  },
  async _asyncFun(_fun,_time,_bkFun){
    while(1){
      if(_fun()){
        return _bkFun&&_bkFun()
      }
      await _Util._asyncTimeout(_time)
    }
  },
  _getMixDataLevel:function(v,i){
    i=i||0
    var dp=i,_max=0;
    if(v&&[Object,Array].includes(v.constructor)){
      for(var k in v){
        var pp=_Util._getMixDataLevel(v[k],i+1)
        if(pp>_max){
          _max=pp
        }
      }
      return _max
    }else{
      return i
    }
  },
  _hasDeepArray:function(d){
    if(d&&[Object,Array].includes(d.constructor)){
      for(var k in d){
        var v=d[k]
        if(v&&v.constructor==Array){
          return 1
        }else if(v&&v.constructor==Object){
          var vv=_Util._hasDeepArray(v)
          if(vv){
            return 1
          }
        }
      }
    }
  },
  _toFileCSV:function(s){
    return s.split("\n").map(w=>{
      w=w.trim().split("\t")
      return w.map(v=>{
        if(v.includes(",")){
          return '"'+v.replace(/\"/g,'""')+'"'
        }else{
          return v
        }
      }).join(",")
    }).join("\n")
  },
  _spliceAll:function(vs,_fun){
    let _found=[]
    for(var i=0;vs&&i<vs.length;i++){
      var o=_fun(vs[i],i)
      if(o){
        _found.push(vs[i])
        vs.splice(i--,1)
      }
    }
    return _found
  },
  _findInObj:function(o,_fun){
    if(o&&[Object,Array].includes(o.constructor)){
      for(var k in o){
        if(_fun(o[k],k)){
          return {_value:o[k],_key:k}
        }
      }
    }
  },
  _findDeepObj:function(o,_fun,_stop,pk,ps){
    ps=ps||[]
    for(var k in o){
      ps.push(o[k])
      if(_fun(o[k],k,pk,ps,o)){
        if(_stop){
          if(ps){
            ps.pop()
          }
          return o[k]
        }
      }else if(_Util._isObjOrArray(o[k])){
        let v=_Util._findDeepObj(o[k],_fun,_stop,k,ps)!==undefined
        if(v){
          if(_stop){
            ps.pop()
            return v
          }
        }
      }
      ps.pop()
    }
  },
  _loopObj:function(o,_fun){
    if(o&&[Object,Array].includes(o.constructor)){
      for(var k in o){
        _fun(o[k],k)
      }
    }
  },
  _findAll:function(vs,_fun){
    var os=[]
    vs.forEach((v,i)=>{
      if(_fun(v,i)){
        os.push(v)
      }
    })
    return os
  },
  _handlePrePanel:function(d){
    $(d).on("mousedown",".bz-pre-box",function(e){
      let p=e.target

      _Util._copyText(p.children[0]||p,this.ownerDocument)
    })
  },
  _loadTextFromFile:function(_file,_fun){
    let _reader = new FileReader();

    _reader.readAsText(_file);

    _reader.onload = function() {
      _fun(_reader.result)
    };

    _reader.onerror = function() {
      alert(_bzMessage._system._error._importFileError,_reader.error);
    };
  },
  _loadTextFromFiles:function(_files,_fun){
    let _reader = new FileReader(),
        rs=[];
    

    function _readFile(i) {
      if( i >= _files.length ) {
        return _fun(rs);
      }
      var _file = _files[i];
      _reader.onload = function(e) {  
        rs.push(e.target.result);
        _readFile(i+1)
      }
      _reader.readAsText(_file);
    }
    _readFile(0);

    _reader.onerror = function() {
      alert(_bzMessage._system._error._importFileError,_reader.error);
    };
  },
  _getZipFileContent:function(v,f){
    zip.createReader(new zip.BlobReader(v), function(zipReader) {
      zipReader.getEntries(function(_entries) {
        f(_entries)
			});
    }, function(a){alert(a)});
  },
  _extendViewDef:function(e,ex){
    var o=_Util._clone(e)
    for(var k in ex){
      if(k=="_jqext"){
        for(var kk in ex._jqext){
          o._jqext[kk]=ex._jqext[kk];
        }
      }else{
        o[k]=ex[k];
      }
    }
    return o;
  },
  // _insertTxtToEditor:function(o,w,_idx,_event){
  //   if($(o).hasClass("bz-js-editor")){
  //     return o._replaceSelectedText(o,w)
  //   }
  //   var start = o.selectionStart;
  //   var end = o.selectionEnd;
  //   _idx=_idx||w.length

  //   var $this = $(o);
  //   var value = $this.val();
    
  //   if(_idx<0){
  //     start+=_idx;
  //     _idx=w.length
  //   }

  //   $this.val(value.substring(0, start)+ w+ value.substring(end));

  //   o.selectionStart = o.selectionEnd = start + _idx;
  //   $(o).change();
  //   if(_event){
  //     _event.preventDefault()
  //   }
  //   if($(":focus")[0]!=o){
  //     $(o).focus();
  //   }
  // },
  _repeatLetter:function(w,i){
    let ws=""
    while(i--){
      ws+=w
    }
    return ws
  },
  _stringToObj:function(s){
    if(s&&s.constructor==String){
      try{
        s=eval("s="+s)
      }catch(e){}
    }
    return s
  },
  _getShareParent:function(o1,o2){
    if(o1.constructor==Array){
      return _getIn2(o1[0],o1[o1.length-1])
      let i1=parseInt((o1.length-1)/2)
    }else{
      return _getIn2(o1,o2)
    }
    
    function _getIn2(o1,o2){
      if($(o2).find(o1)[0]){
        return o2
      }
      while(o1.parentElement&&o1.tagName!="BODY"){
        if($(o1).find(o2).length||o1.tagName=="BODY"){
          return o1
        }
        o1=o1.parentElement
      }
    }
  },
  _getPathFromUrl:function(v){
    let h=_Util._retrieveHostFromUrl(v)
    if(h){
      v=v.replace(h,"")
    }
    v=v.replace(/^[\/]/,"").split(/[\?\#]/)[0].split("/")
    _Util._spliceAll(v,x=>{return !x})
    return v
  },
  _retrieveHostFromUrl:function(v){
    if(!v){
      return
    }

    v=v.url||v
    v=v.match(/^(https*|wss):\/\/[^\/]+/)
    return v&&v[0]
  },
  _formatStrAsJson:function(w){
    try{
      v=eval("v="+w)
      if(JSON.stringify(v)==w){
        return JSON.stringify(v,0,2)
      }
    }catch(e){}
    return w
  },
  _jsonToStr:function(s){
    if(s){
      if(_Util._isObjOrArray(s)){
        s=JSON.stringify(s,0,2)
      }else if(s&&$.isNumeric(s)){
        s=s+""
      }else if(s.constructor==Function){
        s=s.toString()
      }
      if(s&&s.constructor==String&&s.includes("\n")){
        s=_Util._cleanPreSpace(s)
      }
    }
    return s
  },
  _cleanPreSpace:function(v){
    if(v&&v.constructor==String&&v.includes("\n")){
      v=v.split("\n")
      let ss=v._last()
      ss=(ss.match(/^( +)/)||[])[1]
      if(ss){
        v=v.map(x=>{
          return x.replace(ss,"")
        })
      }
      v=v.join("\n")
    }
    return v
  },
  _cleanJson:function(d){
    for(let k in d){
      let v=d[k]
      if(v){
        if(v.constructor==String){
          d[k]=_Util._cleanPreSpace(v)
        }else if(_Util._isObjOrArray(v)){
          _Util._cleanJson(v)
        }
      }
    }
  },
  _strToJson:function(s,_parameter){
    let $parameter=_parameter||window.$parameter
    if(s&&s.constructor==String&&(_Util._hasCode(s)||s.trim().match(/^[\{\[].*[\]\}]$/s))){
      s=s.trim()
      try{
        if(s.constructor==String){
          if(s.match(/^\{\{.+\}\}$/)){
            s=_JSHandler._prepareData(s)
          }else{
            s=eval("s="+s)
          }
          if(s&&s.constructor==RegExp){
            s=s.toString()
          }
        }
        if(s&&[Object,Array].includes(s.constructor)){
          _Util._findDeepObj(s,(v,k,ps,pk,o)=>{
            if(v&&v.constructor==String){
              o[k]=_JSHandler._prepareData(v,0,0,_parameter)
            }
          })
        }
      }catch(e){
        _domActionTask._doLog(e.message)
        s=_JSHandler._prepareData(s,0,0,_parameter)||s
      }
    }
    return s
  },
  _initDataFromFun:function(d){
    for(let k in d){
      let v=d[k];
      if(v&&v.constructor==Function){
        try{
          d[k]=d[k]()
        }catch(ex){
          alert(ex.message)
        }
      }else if(_Util._isObjOrArray(v)){
        _Util._initDataFromFun(v)
      }
    }
  },
  _hasCode:function(v){
    return v&&v.match&&v.match(/\$(loop|parameter|parentModule|test|module|project|data|util|script|group|action)([^a-zA-Z0-9\u4E00-\u9FCC_\$]|$)/)
  },
  _hasInsertCode:function(v){
    return v&&v.match&&v.match(/\{\{[^\{]*\$(parameter|test|module|project|loop|parentModule|data|loop|util|script|control|group|action).*\}\}/)
  },
  _hasInsertCodeOnly:function(v){
    if(_Util._hasCode(v)){
      return !_Util._hasCode(v.replace(/\{\{[^\{]*\$(parameter|test|module|project|loop|parentModule|data|loop|util|script|control|group|action).*\}\}/g,""))
    }
  },
  _parseCode:function(s){
    let vs=[]
    s=s.match(/\{\{[^}]+\}\}/g)||[]
    s.forEach(c=>{
      c=c.match(/\$(loop|parameter|test|module|project|group|action)[.\[]?[a-zA-Z0-9\u4E00-\u9FCC_\$\.\[\]]*/g)||[]
      vs=vs.concat(c)
    })
    return [...new Set(vs)]
  },
  _formatObjectToFinalData:function(o,_parameter){
    if(o&&[Object,Array].includes(o.constructor)){
      for(var k in o){
        if([Array,Object].includes(o[k].constructor)){
          _Util._formatObjectToFinalData(o[k])
        }else{
          let v= _ideDataManagement._initRandomValue(_JSHandler._prepareData(o[k]))
          let kk=_JSHandler._prepareData(k,0,0,_parameter)
          if(kk!=k&&kk){
            delete o[k]
            k=kk
          }
          o[k]=v
        }
      }
    }else{
      o=_JSHandler._prepareData(o+"",0,0,_parameter)
      o=_Util._strToJson(o,_parameter)
    }
    return o
  },
  _objToAPIParameter:function(v){
    if(v&&(_Util._isObjOrArray(v))){
      var ds=[]

      _getDataList(v,"",ds)
      return ds.join("&")
    }else{
      return v
    }

    function _getDataList(v,ks,ds){
      if(v&&_Util._isObjOrArray(v)){
        for(let k in v){
          _getDataList(v[k],ks?ks+"["+k+"]":k,ds)
        }
      }else{
        ds.push(encodeURIComponent(ks)+"="+encodeURIComponent(v))
      }
    }
  },
  _parameterToObj:function(v){
    if(v&&v.constructor==String){
      v=v.trim()
      try{
        v=eval("v="+v)
      }catch(e){
        if(v.includes("=")){
          v=v.split("&")
          var o={}
          v.forEach((a,i)=>{
            a=a.replace(/\+/g," ")
            a=a.split("=")
            let k=decodeURIComponent(a[0])
            let ks=k.split("[")
            if(ks.length>1){
              ks=ks.map(x=>x.replace("]",""))
              let oo=o
              ks.forEach((x,i)=>{
                oo[x]=oo[x]||{}
                if(i==ks.length-1){
                  oo[x]=decodeURIComponent(a[1])
                }else{
                  oo=oo[x]
                }
              })
            }else{
              o[k]=decodeURIComponent(a[1])
            }
          })
          v=o
        }
      }
    }
    return v
  },
  _speakCurWords:function(w){
    if(_Util.speakingWords){
      window.speechSynthesis.cancel()
    }
    _Util.speakingWords = new SpeechSynthesisUtterance(w);
    if(curUser.language=="cn"){
      _Util.speakingWords.lang="zh-CN"
    }
    _Util.speakingWords.onend=()=>{
      _Util.speakingWords=0
    };
    window.speechSynthesis.speak(_Util.speakingWords);
  },
  _focusNextByTab:function(_curElement){
    var os=$(BZ.TW.document).find("*"),_found=0;
    var _idx=os.index(_curElement)
    var _tIdx=_curElement.tabIndex
    while(!_found){
      for(var i=_idx+1;i<os.length;i++){
        var o=os[i]
        if(o==os[i]){
          if(_tIdx>0){
            _tIdx=0
            _idx=0
          }
        }
        if($(o).css("display")!="none"&&$(o).css("visibility")!="hidden"){
          if(["INPUT","SELECT","A","BUTTON","TEXTAREA"].includes(o.tagName)&&o.type!="hidden"){
            if(_tIdx<0){
              if(o.tabIndex==0){
                return o.focus()
              }
            }else if(_tIdx==0){
              if(o.tabIndex==0||o.tabIndex==1){
                return o.focus()
              }
            }else{
              if(o.tabIndex==_tIdx+1){
                return o.focus()
              }
            }
          }
        }
      }
      if(!_found){
        if(_idx>=0){
          _idx=-1
        }else{
          break
        }
      }
    }
  },
  _formatTimeInMinSecond2:function(t){
    let h=Math.floor(t/60/60)||""
    if(h){
      h+=":"
    }
    t=t%3600
    let m=_Util._formatNumberLength(Math.floor(t/60),2)+":"
    let s=_Util._formatNumberLength(t%60,2)
    return h+m+s
  },
  _toOneLevelJson:function(d){
    let ds=[]
    _findPath(d)
    return ds;
    function _findPath(d,p){
      if(!d||![Object,Array].includes(d.constructor)){
        let o={}
        o[p]=d
        ds.push(o)
      }else{
        if(d.constructor==Object){
          for(let k in d){
            let ks=k.split(",")
            ks.forEach(kk=>{
              let pp=p?p+"."+kk:kk
              _findPath(d[k],pp)
            })
          }
        }else{
          d.forEach(e => {
            _findPath(e,p)
          });
        }
      }
    }
  },
  _formatTimeInMinSecond:function(tt,_ignoreMs){
    tt=parseInt(tt)
    let p=""
    if(tt<0){
      p="- "
      tt=0-tt
    }
    var t=Math.floor(tt/1000)
    var s=Math.floor(t%60)
    var m=Math.floor(t/60)
    var h=Math.floor(m/60)
    m=m%60
    if(h){
      h+=":"
    }else{
      h=""
    }
    if(m){
      m+=":"
    }else{
      m=""
    }
    if(!s){
      s=0
    }
    if(!_ignoreMs){
      tt=tt%1000
    }else{
      tt=0
    }
    return p+h+m+s+(!h&&!m&&s<10&&tt?"."+tt:"")+(!h&&!m?"s":"")
  },
  _formatTimer:function(t){
    let h="",m=""
    if(t>3600000){
      h=parseInt(t/3600000)+"h "
      t=t%3600000
    }
    if(t>60000){
      m=parseInt(t/60000)+"m "
      t=t%60000
    }
    if(t>10000||m){
      t= (Math.floor(t/1000)||0)+"s"
    }else{
      t= (Math.round(t/100)/10||0)+"s"
    }
    return h+m+t
  },
  _changeFavicon:function(src) {
    src=location.protocol+"/"+"/"+location.host+"/"+src;
    document.head = document.head || document.getElementsByTagName('head')[0];
    var link = document.createElement('link'),
        oldLink = document.getElementById('dynamic-favicon');
    link.id = 'dynamic-favicon';
    link.rel = 'shortcut icon';
    link.href = src;
    if (oldLink) {
      document.head.removeChild(oldLink);
    }
    document.head.appendChild(link);
  },  
  _copyText:function(w,_doc,ui){
    _doc=_doc||document
    let _isInput=["INPUT","TEXTAREA"].includes(w.tagName)
    let el =_isInput?w:$("<textarea readonly style='position:absolute;left:-9999px'></textarea>").appendTo(_doc.body);
    if(!_isInput){
      if(w.tagName=="SELECT"){
        w=$util.getElementValue(w)
      }
      w=w.innerText||w
      if([Object,Array].includes(w.constructor)){
        w=JSON.stringify(w,0,2)
      }
      el.val(w)
    }
    el.select();
    _doc.execCommand('copy');
    if(!_isInput){
      el.remove();
    }
    w=ui||w
    if(w.constructor!=String){
      _isInput=["INPUT","TEXTAREA"].includes(w.tagName)
      if(_isInput){
        w.select();
        w.focus()
      }else{
        let pu=w.parentElement||w,
            c="bz-enable-select"
        if(!$(pu).hasClass(c)){
          $(pu).addClass(c)
        }else{
          c=0
        }
        let _range = new Range(),
            _sel = w.ownerDocument.defaultView.getSelection();
            _sel.removeAllRanges();
            _range.collapse(true);
        _range.setStart(w, 0);
        _range.setEnd(w, 1);
        _sel.addRange(_range);
        setTimeout(()=>{
          _sel.removeAllRanges();
          if(c){
            $(pu).removeClass(c)
          }
        },100)
      }
    }
    if(!window.extensionContent){
      _infoManagement._addBZInfo(_bzMessage._method._copiedText)
    }
  },
  _selectInRows:function(d,e,_list,ss){
    if(!ss){
      ss=[]
      for(let x of d.parentElement.children){
        ss.push(x._data._item)
      }
      d=d._data._item
    }
    if(e.ctrlKey || e.metaKey){
      var i=_list.indexOf(d);
      if(i>=0){
        _list.splice(i,1);
        return
      }
    }else if(e.shiftKey&&_list[0]){
      let _start,_last=_list._last()
      for(let x of ss){
        if(!_start){
          _start=x==d||x==_last
        }else if(_start&&(x==d||x==_last)){
          break
        }else if(!_list.includes(x)){
          _list.push(x)
        }
      }
    }else{
      _list.length=0
    }
    if(!_list.includes(d)){
      _list.push(d);
    }
  },
  _copyData:function(o,_doc){
    _doc=_doc||document
    let d=$("<textarea readonly style='position:absolute;left:-9999px'></textarea>")
    d.appendTo(_doc.body);
    d.val(JSON.stringify(o))
    _Util._copyText(d[0],_doc)
    d.remove()
  },
  _getClipboardValue:function(_fun){
    try{
      let x=navigator.clipboard.readText();
      x.then(text => {
        try{
          _fun(text);
        }catch(ex){}
      })
    }catch(e){}
  },
  _objToURI:function(d){
    let q;
    for(let k in d){
      let w;
      if(d[k]&&[Object,Array].includes(d[k].constructor)){
        w=JSON.stringify(d[k]).replace(/\"/g,"")
      }else{
        w=(d[k]+"").replace(/^[\'\"]([^\'\"]+)[\'\"]$/,"$1")
      }
      if(w=="bz-skip"){
        continue
      }
      if(q){
        q+="&"
      }else{
        q="?"
      }
      if(!_Util._hasCode(w)){
        w=encodeURIComponent(w)
      }
      q+=k+'='+w;
    }
    return q
  },
  //d: data, t: with tab?
  _formatDataWithVariable:function(d,t){
    if(d){
      let w=d.trim()
      if(w.includes("\n")){
        return w
      }
      if(!("{[".includes(w[0])&&"}]".includes(w[w.length-1]))){
        return d
      }
      try{
        d=_Util._parseJSONWithRefDataToObj(d,1)
        d=_Util._refDataToJSON(d)
      }catch(ex){
      }
      return d
    }else{
      return d
    }
  },
  _isFocusable:function(o){
    return ["A","BUTTON","INPUT","SELECT","TEXTAREA"].includes(o.tagName)||o.contenteditable
  },
  _replaceObjValue:function(o,w,r){
    if(o&&[Object,Array].includes(o.constructor)){
      for(var k in o){
        o[k]=_Util._replaceObjValue(o[k],w,r)
      }
    }else if(o){
      o=o+""
      return (o+"").replace(w,r)
    }
    return o
  },
  _getExistItemInList:function(o,a,_list){
    for(var i=0;i<_list.length;i++){
      var v=_list[i]
      if(v[a]==o[a]){
        return v
      }
    }
  },
  _isEmpty:function(v){
    return !v||([Array,Object,Set].includes(v.constructor)&&$.isEmptyObject(v))
  },
  _findValueInObj:function(o,_fun){
    if(o){
      for(var k in o){
        if(_fun(o[k],k)){
          return o[k]
        }
      }
    }
  },
  _findKeyInObj:function(o,_fun){
    for(var k in o){
      if(_fun(o[k],k)){
        return k
      }
    }
  },
  _findIFrames:function(doc,fs){
    $(doc).find("*").each(function(i,v){
      if(v.tagName=="IFRAME"){
        fs.push(v)
        if(v.contentDocument){
          _Util._findIFrames(v.contentDocument,fs)
        }
      }else if(v.shadowRoot){
        _Util._findIFrames(v.shadowRoot,fs)
      }
    })
  },
  _getAllRadioValues:function( r ) {
    let _radios = document.getElementsByName( r.name ),vs=[];
    
    for( i = 0; i < _radios.length; i++ ) {
      vs.push(_radios[i].value);
    }
    return vs;
  },
  _getQuickPath:function(e){
    if(!e){
      return
    }
    var t=$util.getElementText(e)||""
    t=t.trim()
    if(t){
      t=t.split("\n")[0].substring(0,50)
      t=":Contains("+t+")"
    }

    while(e.parentElement){
      t=">"+_Util._getCurPath(e)+t
      e=e.parentElement
      if(e.tagName=="BODY"){
        return "BODY"+t
      }
    }
    return "BODY"
  },
  _filterOutHidden:function(os,_result){
    os=os||[]
    for(var i=0;i<os.length;i++){
      if(_Util._isHidden(os[i])){
        if(!_result){
          os.splice(i--,1)
        }
      }else if(_result){
        _result.push(os[i])
      }
    }
    
  },
  _elementTxtToPath:function(os){
    if(os.constructor==String){
      os=[os]
    }
    for(var i=0;i<os.length;i++){
      var v=(""+os[i]).trim();
      if(v===""){
        os.splice(i,1);
        i--;
      }else if(os[i].constructor==String && v.includes(" ")){
        var b=[],_map={"(":")","[":"]"};
        var vs="",vv=[];
        for(var n=0;n<v.length;n++){
          var c=v[n];
          if(c==" " && !b.length){
            vv.push(vs);
            vs="";
          }else if("([".includes(c)){
            b.unshift(_map[c]);
          }else if(c==b[0]){
            b.shift();
          }
          vs+=c;
        }
        vs=vs.trim()
        if(vs){
          vv.push(vs);
        }
        if(vv.length>1){
          os.splice(i,1)
          for(var n=0;n<vv.length;n++){
            os.splice(i+n,0,vv[n]);
          }
        }
      }
    }
    return os;
  },
  _getElementByQuickPath:function(p){
    if(p.constructor==Array){
      return $util.findDom(p)
    }
    p=p.split(">")
    if(p[0]=="BODY"){
      p.shift()
    }
    var o=document.body
    p.find(function(v){
      v=v.split(":")
      var vv=v[1]
      if(vv&&vv.match(/[0-9]+/)){
        vv=parseInt(vv.match(/[0-9]+/)[0])
      }else{
        vv=0
      }
      for(var i=0;i<o.children.length;i++){
        var t=o.children[i]
        if(t.tagName==v[0]){
          if(!vv){
            o=t;
            return
          }else{
            vv--
          }
        }
      }
      o=0
      return 1
    })
    return o
  },
  _getCurPath:function(e){
    var i=0,t=e.tagName;
    while((e = e.previousSibling)!=null){
      if(e.tagName==t){
        i++;
      }
    }
    return i?t+":eq("+i+")":t
  },
  _toCompareableWord:function(w,splitChar){
    if(w){
      w=w.replace(/([^A-Z]+)([A-Z][^A-Z]+)/,"$1_$2").trim().toLowerCase().replace(/\s+/g,' ').replace(/[^0-9a-zA-Z\u4E00-\u9FCC]+/g,'_').replace(/[_]+/g,'_')
      w=w.split("_").map(x=>{return x.plural()}).join(splitChar||"_");
    }
    return w
  },
  _parseCamelWords:function(w){
    if(w){
      w=w.replace(/([^A-Z]*|[A-Z]+)([A-Z][^A-Z]+)/g,"$1 $2").replace(/([^A-Z ]+)([A-Z]+)/g,"$1 $2").replace(/( [A-Z][^A-Z])/g,function(v){return v.toLowerCase()});
      w=w.trim().replace(/\s+/g," ")
    }
    return w
  },
  _toCamelWords:function(w,_chkUpperCase){
    w=(w||"").toString().trim()
    if(w){
      w= w.split(/[^\wÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC]]|_+| +|-+/).map((v,i)=>{
        if(i){
          return _Util._toCapitalWord(v)
        }else{
          return v
        }
      }).join("")
      if(_chkUpperCase&&w[0]==w[0].toUpperCase()&&w[1]&&w[1]==w[1].toUpperCase()){
        return w
      }
      w=w[0].toLowerCase()+w.substring(1)
      return w
    }
    return ""
      
  },
  _idToName:function(w){
    return _Util._toCapitalWord(_Util._parseCamelWords(w).plural(1))
  },
  _getTagNameFromElementPath:function(p){
    for(var i=p.length-1;i>0;i--){
      if(!$.isNumeric(p[i])){
        return p[i]
      }
    }
  },
  _isDotableKey:function(k){
    return !k.match(/^[0-9]|[^_$a-zA-Z0-9\u4E00-\u9FCC]/)
  },
  //m:property map, o: object data, p: path
  _objToProperties:function(m,o,p,_noFunStr){
    if(o&&_Util._isObjOrArray(o)){
      for(var k in o){
        _Util._objToProperties(m,o[k],_Util._mergeDataPath(p,k),_noFunStr)
      }
    }else if(!o||o.constructor!=Function){
      if(o&&o.constructor==String){
        if(o.trim().startsWith("function")&&_noFunStr){
          return m
        }else if(o.length>100){
          o=o.trim().substring(0,100)
        }
      }
      if(p){
        m[p]=o
      }else{
        m=o
      }
    }
    return m
  },
  _mergeDataPath:function(p,k){
    var pk;
    if(!p){
      pk=k
    }else if(_Util._isDotableKey(k)){
      pk=p+"."+k
    }else if($.isNumeric(k)){
      pk=p+"["+k+"]"
    }else{
      pk=p+"['"+k+"']"
    }
    return pk
  },
  _hasChinese:function(w){
    return w.match(/[\u4E00-\u9FCC]/g)
  },
  _isChinese:function(w){
    return w.trim().match(/^[\u4E00-\u9FCC]+$/g)
  },
  _countWords:function(w){
    let ws=w.match(/[\u4E00-\u9FCC]/)
    if(ws){
      return ws.length
    }
    return w.split(/[^A-Za-z]/).length
  },
  _getDiffWord:function (o,n){
    o=o.replace(/\s/g," ")
    n=n.replace(/\s/g," ")
    if(BZ._data._curProject.language=="cn"){
      s=""
    }else{
      s=" "
    }

    o=o.split(s)
    n=n.split(s)

    while(o.length&&n.length&&o[0]==n[0]){
      o.shift()
      n.shift()
    }
    if(o.length&&n.length){
      o=o.join(s)
      n=n.join(s)
      return {
        o:o,n:n
      }
    }
  },
  //s:soure words
  //r:remove word
  //ex. s="abc abcd xabc 中国abc abc中国", x="abc", y=" ", --> "abcd xabc 中国 中国"
  //ex. s="abc abcd xabc 中国abc abc中国", w="中", --> "abc abcd xabc 国abc abc国"
  _removeWord:function(s,r,_handleStar,i){
    var re,rr,ss=s,rs;
    if(!s){
      return s
    }
    if(BZ._data._curProject.language=="cn"){
      if(!r.match(/[a-z0-9] [0-9a-z]/)&&r.match(/\s/)){
        r=r.replace(/ /g,"")
        s=s.replace(/ /g,"")
      }
    }
    if(!i){
      r=r.replace(/([\+\?\$\^\(\)\[\]\{\}\|\\])/g,"\\$1")
      if(_handleStar){
        
      }else{
        r=r.replace(/([\*\.])/g,"\\$1")
      }
    }
    if(_Util._hasChinese(r)){
      re=new RegExp(r,"gi")
      rr=" "
    }else{
      re=new RegExp("(^|[^0-9a-z])"+r+"([^0-9a-z]|$)","gi")
      rr="$1 $2"
    }
    rs=s.replace(re,rr).trim()
    if(rs==s){
      return i?ss:_Util._removeWord(ss,r,_handleStar,1)
    }else{
      return i?rs:_Util._removeWord(rs,r,_handleStar,1)
    }
  },
  _getVisibleElements:function(_area,_css){
    if(_css&&_css.constructor==Array){
      _css=_css.join(",")
    }
    _css=_area.find(_css).toArray()
    _Util._filterOutHidden(_css)
    return _css
  },
  _includesWord:function(s,r,_handleStar){
    return s!=_Util._removeWord(s,r,_handleStar)
  },
  _includesWordWithoutSign:function(s,i){
    s=_Util._removeSign(s," ")
    i=_Util._removeSign(i," ")
    return s!=_Util._removeWord(s,i)
  },
  _generateIndentation:function(v){
    var s="";
    for(var i=0;i<v;i++){
      s+=" ... "
    }
    return s;
  },
  _strToRegex:function(v){
    if(v){
      if(!v.match(/^[\/].+[\/]$/)){
        v="/"+v+"/"
      }
      try{
        v=eval("v="+v)
        return v
      }catch(e){
        alert(e.message)
      }
    }
  },
  _replaceWord:function(w,x,y){
    if(!x || !y || !w){
      return w;
    }
    var x1=x[0],x2=x[x.length-1],r=x.replace(/([\(\)\{\}\[\].\$])/g,"\\$1");
    var c1=_Util._hasChinese(x1),c2=_Util._hasChinese(x2);
    
    if(c1&&c2){
      return w.replace(new RegExp(x,"g"),y).trim()
    }else if(c1){
      r=new RegExp("(.|^)"+r+"([^a-zA-Z0-9]|$)","g");
    }else if(c2){
      r=new RegExp("([^a-zA-Z0-9]|^)"+r+"(.|$)","g")
    }else{
      r=new RegExp("([^a-zA-Z0-9]|^)"+r+"([^a-zA-Z0-9]|$)","g")
    }
    return w.replace(r,"$1"+y+"$2")
  },
  //_nodes:childNodes, i: the first text node idx
  _pickTextFromNode:function(_nodes,i){
    var e=_nodes[i];
    var n,tw=e.textContent.trim();
    while(n=_nodes[i+1]){
      if(n.nodeType==3){
        var t=n.textContent.trim()
        if(t){
          tw+=" "+t
        }
      }else if(n.nodeType==1){
        break
      }
      i++
    }
    tw=_Util._filterTxt(tw)
    return {t:tw,i:i}
  },
  _pickAttrFromObj:function(o,ps){
    var oo={};
    if(ps.constructor==Object){
      ps=Object.keys(ps)
    }
    ps.forEach(function(v){
      try{
        v=v.split(".")
        let ood=oo,od=o;
        v.find((x,i)=>{
          if(i+1==v.length){
            ood[x]=od[x]
          }else{
            if(od[x]){
              ood[x]={}
              ood=ood[x]
              od=od[x]
            }else{
              return 1
            }
          }
        })
      }catch(e){}
    })
    return oo
  },
  _filterTxt:function(tw){
    return tw.replace(/[\(\)\[\]\{\}]/g," ").replace(/\s+/g," ").trim()
  },
  _insertInString:function(s,m,w){
    var i=s.indexOf(m);
    if(i>=0){
      return s.substring(0,i)+w+s.substring(i);
    }
  },
  _findCellElement:function(e,_parent){
    var k=_IDE._data._curVersion.setting.content.clickableElements;
    k=k?k+",":""
    k+="INPUT,TEXTAREA,SELECT,A,BUTTON,[contenteditable=true],[draggable=true]"
    var $e=$(e)
    try{
      if($e.is(k)){
        return e
      }
      if($e.find(k).length){
        return _parent?0:e
      }
      return _Util._findCellElement(e.parentElement,1)||(_parent?0:e)
    }catch(ee){}
  },
  _handleCodePoints:function(array) {
    var CHUNK_SIZE = 0x8000; // arbitrary number here, not too small, not too big
    var index = 0;
    var length = array.length;
    var result = '';
    var slice;
    while (index < length) {
      slice = array.slice(index, Math.min(index + CHUNK_SIZE, length)); // `Math.min` is not really necessary here I think
      result += String.fromCharCode.apply(null, slice);
      index += CHUNK_SIZE;
    }
    return result;
  },
  _getParentElementByCss:function(p,o){
    p=$(p).toArray()
    return p.find(a=>{
      return $(a).find(o).length
    })
  },
  _findParentElementByCss:function(p,o){
    p=$(o.ownerDocument).find(p).toArray();
    let oo=0
    while(!oo){
      oo= p.find(a=>{
        return $(a).find(o)[0]
      })
      if(oo){
        return oo
      }
      p=p[0].parentElement
      if(!p){
        return
      }
      p=$(p).toArray();
    }
    return oo
  },
  _getParentByTagName:function(o,_name){
    while(o.parentElement && o.tagName!="BODY"){
      o=o.parentElement
      if(o.tagName==_name){
        return o
      }
    }
  },
  _focusNextInput:function(e){
    var _org=e, os=$(e.ownerDocument).find("INPUT,BUTTON,SELECT,TEXTAREA,SELECT,[contenteditable=true]");
    var i=os.index(e)+1,b;
    while(e){
      e=os[i++];
      
      if(e && !$(BZ.TW.document).find(".BZIgnore").find(e).length && !["file","hidden"].includes(e.type)&&!$(e).attr("disabled")&&!$(e).attr("readonly")){
        if(e.type=="radio" &&_org.type=="radio"&&e.name==_org.name){
          continue
        }
        if(e.tagName!="BUTTON"&&!["button","reset","submit"].includes(e.type)){
          break
        }else if(!b){
          b=e;
        }
      }
    }
    e=e||b
    if(e){
      e.focus()
    }
    return e
  },
  _formatTextToHTML:function(w){
    w=(w||"").toString()
    
    return w.replace(/\</g,"&lt;").replace(/\>/g,"&gt")
  },
  _isSameObj:function(a,b,ks){
    let av,bv;
    if(ks){
      return !ks.find(x=>!_Util._isSameObj(a[x],b[x]))
    }
    if(a&&b&&[Object,Array].includes(a.constructor)&&a.constructor==b.constructor){
      for(var k in a){
        av=a[k];
        bv=b[k]
        if(av&&[Object,Array].includes(av.constructor)&&bv&&bv.constructor==av.constructor){
          if(!_Util._isSameObj(av,bv)){
            return
          }
          continue
        }
        if(av!=bv){
          return
        }
      }
      for(var k in b){
        if(a[k]===undefined&&a[k]!=b[k]){
          return
        }
      }
      return 1
    }
    return a==b
  },
  _isSameArray:function(a,b,_key){
    if(a==b||(!a&&!b)){
      return 1
    }else if(!a||!b||a.constructor!=Array||b.constructor!=Array||a.length!=b.length){
      return 
    }
    for(var i=0;i<a.length;i++){
      if(!b.includes(a[i])){
        if(_key){
          var _found=0
          for(var j=0;j<b.length;j++){
            if(b[j][_key]==a[i][_key]){
              _found=1
              continue
            }
          }
          if(_found){
            continue
          }
        }
        return
      }
    }
    return 1
  },
  _isSameHost:function(u1,u2){
    u1=u1.split("/"+"/")
    u2=u2.split("/"+"/")
    
    if(u1[0]&&u2[0]){
      if(u1[0]!=u2[0]){
        return
      }
    }
    if(u1.length>1){
      u1=u1[1]
    }
    if(u2.length>1){
      u2=u2[1]
    }

    u1=u1.split(/[\/#]/)
    u2=u2.split(/[\/#]/)
    if(!u1[0]){
      u1.shift()
    }
    if(!u2[0]){
      u2.shift()
    }
    return u1[0]==u2[0]
  },
  _findBackground:function(d){
    var os=[];
    $(d).find("*").filter(function(i,v){
      if($(v).css("position")=="fixed" && !_Util._isHidden(v)){
        r=v.getBoundingClientRect();
        if(window.innerWidth-r.width<40 && window.innerHeight-r.height<40){
          os.push(v)
        }
      }
    })
    os.sort(function(a,b){
      return $(a).css("z-index")>=$(b).css("z-index")
    });

    return os.length?os[os.length-1]:d
  },
  _getBackgroundColor:function(e){
    var c=$(e).css("background-color");
    if((c.startsWith("rgba") && !c.endsWith(", 0)") && !c.startsWith("rgba(255, 255, 255, 0.")) || c!=="transparent"){
      return c;
    }
    
    if(e.tagName!="BODY"){
      return _Util._getBackgroundColor(e.parentElement)
    }
  },
  _toCapitalWord:function(w,_revert){
    if(w){
      if(_revert&&w.length>1&&w[1].toLowerCase()==w[1]){
        return w[0].toLowerCase()+w.substring(1)
      }else{
        return w[0].toUpperCase()+w.substring(1)
      }
    }else{
      return ""
    }
  },
  _isNoTextElement:function(e){
    return ["TEXTAREA","SELECT","IFRAME","SVG","LINK","TITLE","META","SCRIPT","NOSCRIPT","STYLE","HEAD","HTML"].includes(e.tagName.toUpperCase())||_Util._inSelectOption(e)
  },
  _isNoVisibleElement:function(e){
    return ["OPTION","IFRAME","SVG","LINK","TITLE","META","SCRIPT","NOSCRIPT","STYLE","HTML","HEAD"].includes(e.tagName.toUpperCase())
  },
  _isInContentEditable:function(e){
    if($(e).attr("contenteditable")){
      return 1;
    }
    if(e && e.tagName!="BODY"){
      return this._isInContentEditable(e.parentNode);
    }
  },
  _isInputObj:function(e,_chkReadonly){
    if(e.nodeType!=1){
      return
    }
    if((!_chkReadonly||!$(e).attr("readonly")||e.type=="file")&&this._isStdInputElement(e)||this._isInContentEditable(e)){
      return 1
    }
    
  },
  _isForm:function(c){
    return _Util._findInputs(c).length>1
  },
  _getElementContentText:function(e){
    if(e){
      let t=e.innerText||e.textContent
      if(!_Util._isInputObj(e)){
        e=_Util._findInputs(e)[0]
      }
      if(e){
        t=e.value||t
      }
      return t||""
    }
    return ""
  },
  _getAcceptFileType:function(f){
    return ((f.accept||"").split(",")[0]||"").split("/").pop().toLowerCase()
  },
  _isUrl:function(s){
    return s&&s.match(/^(https?:)?\/\/.+/)&&!s.includes("\n")
  },
  _findInputs:function(e,_inBz){
    let bz=e&&e.dataset&&e.dataset.bz,
        _css=_cssHandler._getInputCss(),
        os=[]
    if(_inBz||bz&&bz.includes("$form")){
      for(let o of e.children){
        if($(o).is(_css)){
          if(!_Util._isHidden(o)){
            os.push(o)
          }
        }else{
          let ob=o.dataset.bz
          if(ob&&ob.includes("$field")){
            os.push(o)
          }else if(ob&&ob.includes("$skip")){
            continue
          }else{
            os.push(..._Util._findInputs(o,1))
          }
        }
      }
      return os
    }else{
      return $(e).find(_css).toArray().filter(x=>{
        return !_Util._isHidden(x)||["radio","checkbox"].includes(x.type)
      });
    }
  },
  _isInputButton:function(e){
    return e.tagName=="INPUT" && ["image","button","submit","reset"].includes(e.type)
  },
  _setTabSize:function(v,ts){
    var vs=v.split(/[\t\n\r]/);
    var m=0;
    for(var i=0;i<vs.length;i++){
      if(m<vs[i].length){
        m=vs[i].length
      }
    }
    if(m<10){
      m=9;
    }
    m++;
    for(var i=0;ts&&i<ts.length;i++){
      var t=ts[i];
      if(t.tagName=="TEXTAREA" && t.value==v){
        t.style.tabSize=m;
      }else if(t.tagName=="PRE" && t.innerText==v){
        t.style.tabSize=m;
      }
    }
    return m
  },
  _getNewClass:function(v1,nv){
    v1=v1||"";
    v1=v1.split(" ");
    if(!nv || nv.constructor!=String){
      nv="";
    }

    nv=nv.split(" ");
    for(var n=0;n<v1.length;n++){
      var i=nv.indexOf(v1[n]);
      if(i>=0){
        nv.splice(i,1);
      }
    }
    return nv;
  },
  _formatAgo:function(t){
    t=Math.round((Date.now()-t)/1000);
    var m=_bzMessage._system._info
    if(t<60){
      m=m._secondAgo
    }else{
      t=Math.round(t/60)
      if(t<60){
        m=m._minuteAgo
      }else{
        t=Math.round(t/60)
        if(t<24){
          m=m._hourAgo
        }else{
          t=Math.round(t/24)
          if(t<7){
            m=m._dayAgo
          }else{
            if(t<30){
              t=Math.round(t/7)
              m=m._weekAgo
            }else if(t<365){
              t=Math.round(t/30)
              m=m._monthAgo
            }else{
              t=Math.round(t/365)
              m=m._yearAgo
            }
          }
        }
      }
    }
    return _Util._formatMessage(m,[t,t>1?"s":""])
  },
  _formatTimestamp:function(t,f){
    t=t||Date.now()
    if(t.constructor==String&&!$.isNumeric(t)){
      f=t
      t=Date.now()
    }else if(t.constructor==Date){
      t=t.getTime()
    }
    t=parseInt(t)
    f=f||"MM-dd hh:mm";
    var d=new Date(t);
    var mp={
      y:d.getFullYear()+"",
      M:_Util._formatNumberLength(d.getMonth()+1),
      d:_Util._formatNumberLength(d.getDate(),(f.match(/d+/)||[""])[0].length),
      h:_Util._formatNumberLength(d.getHours()),
      m:_Util._formatNumberLength(d.getMinutes()),
      s:_Util._formatNumberLength(d.getSeconds()),
      MMMM:_bzMessage._schedule._fullMonthMap[d.getMonth()],
      MMM:_bzMessage._schedule._monthMap[d.getMonth()],
    }
    let m=f.match(/M+/)
    
    _Util._buildDateRegex()
    f=f.replace(/y+/i,mp.y)
      .replace(/d+/i,mp.d)
      .replace(/h+/i,mp.h)
      .replace(/m+/,mp.m)
      .replace(/s+/i,mp.s)
      .replace(/MMMM/,mp.MMMM)
      .replace(/MMM/,mp.MMM)
      .replace(/MM/,mp.M)
      .replace(/M/,d.getMonth()+1)

    return f
  },
  _selectText:function(o) {
    if (document.selection) {
      var range = document.body.createTextRange();
      range.moveToElementText(o);
      range.select();
    } else if (window.getSelection) {
      var range = document.createRange();
      range.selectNode(o);
      window.getSelection().removeAllRanges();
      window.getSelection().addRange(range);
    }
  },
  _getTopZIndex:function(_curDom,_parent){
    _curDom=_curDom||document.body
    var os=$(_parent||_curDom.ownerDocument).find("*"),zz=0;
    for(var i=0;i<os.length;i++){
      var o=os[i];
      try{
        var z=parseInt($(o).css("z-index"))||0;
        if(z>=zz && z<100000 && !$(o).hasClass("bz-modal-bg")){
          zz=z+1;
        }
      }catch(e){}
    }
    if(zz<=100&&!_parent){
      zz=200;
    }
    return zz;
  },
  _setToTop:function(_curDom,_parent){
    let dz=_parent?0:200
    var z=this._getTopZIndex(_curDom,_parent)||dz;
    var zz=parseInt($(_curDom).css("z-index"))||dz;
    if(!zz || z>zz){
      $(_curDom).css({"z-index":z})
    }
  },
  _setToTopInPanel:function(_curDom,_parent){
    let os=[]
    for(let o of _parent.children){
      os.push(o)
    }
    os.sort((a,b)=>{
      a=$(a).css("z-index")||0;
      b=$(b).css("z-index")||0;
      return a-b
    })
    os.forEach((o,j)=>{
      $(o).css({"z-index":j})
    })
    $(_curDom).css({"z-index":os.length+1})
  },
  _findInputByValue:function(v){
    return $("input,select,textarea").toArray().filter(x=>{
      if(x.value==v){
        return 1
      }else if(x.tagName=="SELECT"){
        for(let o of x.selectedOptions){
          if(o.text==v){
            return 1
          }
        }
      }
    })
  },
  _findTextBox:function(v,_fun){
    v=v.trim()
    v=v.split(":")
    let _tag="",_content=v[1]||v[0],vs;
    if(v[1]){
      _tag=v[0]
    }
    
    vs=$(_tag+":Contains("+_content+")").toArray()
    if(!_tag){
      let os=[]
      vs.forEach((x,i)=>{
        if(!x.children.length||!vs[i+1]||!$(x).find(vs[i+1])[0]){
          os.push(x)
        }
      })
      vs=os.map(x=>{
        while(x.parentElement){
          p=x.parentElement
          if(_fun($util.getElementText(p).replace(/\:/g," ").trim(),_content)){
            x=p
          }else{
            break
          }
        }
        return x
      })
    }

    return vs
  },
  _setDrag:function(_handlers,_curDom, _except,_fun){
    _curDom._position=$(_curDom).css("position")
    let _nsSlider=$(_curDom).css("cursor")=="row-resize"
    let _ewSlider=$(_curDom).css("cursor")=="col-resize"
    var _dPos,_mPos,_dSize,_tmpMouseMove,_tmpMouseUp,_tmpSelect,
        _uiSwitch=BZ._data._uiSwitch;
    for(var i=0;i<_handlers.length;i++){
      var h=_handlers[i];
      if(!h){
        continue;
      }
      h.onmousedown=function(e){
        _Util._setToTop(_curDom);
        if($("[draggable]").find(e.target)[0]){
          return
        }
        let c=this.parentElement.getBoundingClientRect(),
            r=this.getBoundingClientRect()
        // $(this).css({position:"fixed"})
        if(_ewSlider){
          $(this).css({top:c.top+"px",height:c.height+"px",left:r.left+"px"})
        }else if(_nsSlider){
          console.log("left:"+c.left+", top:"+r.top)
          $(this).css({left:c.left+"px",width:c.width+"px",top:r.top+"px"})
        }

        if(_curDom._data&&_curDom._data._noMoveable){
          return
        }
        if(_Util._isEventElement(e.target)){
          return;
        }
        if(_except){
          if(_except.constructor==String){
            if($(_except).find(e.target).length||$(_except).is(e.target)){
              return;
            }
          }else{
            for(var i=0;i<_except.length;i++){
              if(_except[i]==e.target || $(_except[i]).find("*").is(e.target)){
                return;
              }
            }
          }
        }
        _uiSwitch._inHandleSize=1
        
        
        _mPos=_Util._getMouseXY(e);
        _dPos=_Util._getDomXYForDrag(_curDom);
        _dSize=_Util._getDomSize(_curDom);
        
        if(this.ownerDocument.onmousemove!=_mousemove){
          _tmpMouseMove=this.ownerDocument.onmousemove;
        }
        
        if(this.ownerDocument.onmouseup!=_mouseup){
          _tmpMouseUp=this.ownerDocument.onmouseup;
        }
        if(this.ownerDocument.body.onselectstart!=_selectText){
          _tmpSelect=this.ownerDocument.body.onselectstart;
        }
        
        this.ownerDocument.onmousemove=_mousemove;
        this.ownerDocument.onmouseup=_mouseup;
        this.ownerDocument.body.onselectstart=_selectText;
      }
    }
    var _mousemove=function(e){
      if(_uiSwitch._inHandleSize && e.buttons){
        var _newMPos=_Util._getMouseXY(e);
        var x=_newMPos.x-_mPos.x+_dPos.x
        var y=_newMPos.y-_mPos.y+_dPos.y
        var _hSize=50;
        var ww=_curDom.ownerDocument.defaultView.innerWidth;
        var wh=_curDom.ownerDocument.defaultView.innerHeight;
        $(_curDom).css({transform:"unset"})
        if(x>0 && x+_hSize<ww&& y>0 && y+_hSize<wh){
          return _setNewPos(_curDom,x,y)
        }
        if(x>0 && x+_hSize>ww){
          x=ww-_hSize;
        }
        if(y>0 && y+_hSize>wh){
          y=wh-_hSize;
        }
        if(x<0){
          x=0;
        }
        if(y<0){
          y=0;
        }
        return _setNewPos(_curDom,x,y)
      }else if(_uiSwitch._inHandleSize){
        this.onmouseup(e)
      }
    };
    var _mouseup=function(e){
      _uiSwitch._inHandleSize=0;
      this.onmousemove=_tmpMouseMove;
      this.onmouseup=_tmpMouseUp;
      this.body.onselectstart=_tmpSelect;
      
      $(_curDom).css({position:_curDom._position})
      if(_nsSlider){
        $(_curDom).css({width:"100%"})
      }
      var _newMPos=_Util._getMouseXY(e);
      _fun&&_fun(_newMPos.x,_newMPos.y,_curDom,1)
    }
    
    function _setNewPos(o,x,y){
      if(!_fun||_fun(x,y,o)){
        if(_nsSlider){
          $(o).css({top:y+"px"});
        }else if(_ewSlider){
          $(o).css({left:x+"px"});
        }else{
          $(o).css({left:x+"px",top:y+"px"});
        }
      }
    }
    
    var _selectText=function(){return false};
    setTimeout(function(){
      _Util._setToTop(_curDom);
    },100)
  },
  _setDragDrop:function(_curDom,_selector,_area,_befFun,_AftFun,_diff){
    if(!_curDom){
      return;
    }
    var _mPos,_dPos,_inDraging,_scrollTop;
    var _tmpDiv;
    _diff=_diff||0;
    _curDom.onmousedown=function(e){
      if(["INPUT","TEXTAREA","BUTTON","PRE"].includes(e.target.tagName)){
        return
      }
      if((!_tmpDiv || !_tmpDiv.length || !_tmpDiv[0].children.length) && this.childNodes[0]){
        _tmpDiv=$(_curDom.childNodes[0].outerHTML);
        _tmpDiv.css({border:"1px dashed blue","background-color":"rgba(0, 50, 255, 0.07) !important;"});
        _tmpDiv.find("*").css({border:"1px dashed blue","background-color":"rgba(0, 50, 255, 0.07) !important;"});
        _tmpDiv.find("*").text("")
      }
      _mPos=_Util._getMouseXY(e);
      _scrollTop=_area.scrollTop-_diff;
      _dPos=_Util._getDomXYForDrag(_curDom);
      _curDom.onmousemove=function(e){
        if(!e.buttons){
          _inDraging=0
          return;
        }
        if(!_inDraging){
          if(_befFun){
            _befFun(this)
          }
//            $(this).on("selectstart","*",function(){return false});
        }
        var _curPos=_Util._getMouseXY(e);
        var dx=_mPos.x-_curPos.x;
        var dy=_mPos.y-_curPos.y;
        var os=$(_curDom).find(_selector);
        if(os.length && (dx>5 || dx<-5 || dy>5 || dy<-5 || _inDraging)){
          _inDraging=true;
          
          os.css({position:"fixed",width:os.parent().css("width")});
          _tmpDiv.css({position:""});
          var _last=null;
          var _moveItems=[];
          for(var i=0;i<os.length;i++){
            var o=os[i];
            _moveItems.push(o)
            if(i==0){
              _last=o;
              $(o).css({top:_curPos.y-10,left:_curPos.x-_mPos.x});
            }else{
              _size=_Util._getDomSize(_last);
              $(o).css({
                top:parseInt(_last.style.top)+_size._height,
                left:parseInt(_last.style.left)
              });
              _last=o;
            }
          }
          
          for(var i=0;i<_curDom.childNodes.length;i++){
            var o=_curDom.childNodes[i];
            if(!_moveItems.includes(o)){
              var _oPos=_Util._getDomXYForDrag(o);
              var _oSize=_Util._getDomSize(o);
              if((_oPos.y<_curPos.y && _oPos.y+_oSize._height>_curPos.y) || (i==_curDom.childNodes.length-1 && _oPos.y+_oSize._height<_curPos.y)){
                if(_oPos.y+_oSize._height/2>_curPos.y){
                  _tmpDiv.insertBefore(o);
                }else{
                  _tmpDiv.insertAfter(o);
                }
//                console.log("------------------------")
//                console.log(_moveItems[0]);
//                console.log(_tmpDiv[0]);
//                console.log(o)
//                console.log("========================")
                return;
              }
            }
          }
        }
      }
      var _tmpDocMouseUp=_curDom.ownerDocument.onmouseup;
      _curDom.ownerDocument.onmouseup=function(e){
        if(_inDraging){
          _inDraging=0;
          if($(_curDom).find(_tmpDiv).length){
            $(_curDom).find(_selector).insertAfter(_tmpDiv);
            $(_curDom).find(_selector).css({position:""});
            _tmpDiv.remove();
          }
          if(_AftFun){
            _AftFun(this)
          }
        }
        _curDom.ownerDocument.onmouseup=_tmpDocMouseUp;
        _curDom.onmousemove=null;
      }
    };
  },
  _checkJQueryEvent:function(e){
    try{
      return $["_"+"data"](e,"events") || {};
    }catch(e){}
    return {};
  },
  _loadInHash:function(_url,_location){
    return _url.startsWith(_location.origin+_location.pathname+"#");
  },
  _getStackTrace:function() {
    var obj = {};
    Error.captureStackTrace(obj, _Util._getStackTrace);
    return obj.stack;
  },
  _clone:function(o){
    if($.type(o)=="array"){
      return $.extend(true,[],o);
    }else if($.type(o)=="object"){
      return $.extend(true,{},o);
    }
    return o;
  },
  _simpleClone:function(o){
    if(o){
      let n={}
      if(o.constructor==Array){
        n=[]
      }else if(o.cloneNode){
        return o.cloneNode()
      }else if(o.constructor!=Object){
        return o
      }

      for(var k in o){
        n[k]=o[k]
      }
      return n
    }
    return o
  },
  _getSimpleJson:function(o){
    var d;
    if(o!==null&&o!==undefined){
      if(o.constructor==Object){
        d=Object.keys(o).length&&{}||undefined
      }else if(o.constructor==Array){
        d=o.length&&[]||undefined
      }else{
        return o===""?undefined:o
      }
      
      for(var i in o){
        var v=_Util._getSimpleJson(o[i])
        if(v!==undefined&&v!==null){
          d[i]=v
        }
      }
    }
    return d
  },
  _cloneSelectData:function(d,_ignore,_only){
    var dd={}
    if(_only&&_only.constructor==Array){
      _only=_only.join("|")
    }
    if(_ignore&&_ignore.constructor==Array){
      _ignore=_ignore.join("|")
    }
    for(var k in d){
      if(_only && k.match("^("+_only+")$")){
        dd[k]=d[k]
      }else if(_ignore && k.match("^("+_ignore+"$)")){
        
      }else if(!_only){
        dd[k]=d[k]
      }
    }
    return dd;
  },
  _setEscWindow:function(w){
    if(_Util._checkBrowserType().name=="ie"){
      if(w.document){
        w.document.onkeydown=_Util._escCloseWindow;
        w.document.tagWin=w;
      }else{
        this.tmpPopWin=w;
        setTimeout("_Util._setEscWindow(_Util.tmpPopWin)",100);
      }
    }else{
      w.onkeydown=_Util._escCloseWindow;
      w.tagWin=w;
    }
  },
  //To find the target input element scope.
  //1. in the scope, no other std input element and the same customize input element
  //2. only one label
  _findValueFromElementScope:function(e,v){
    let rv,vs=[],_break
    rv=_findValues(e)
    if(rv){
      return rv
    }
    while(!_hasValue(e)&&e.parentElement){
      for(let o of e.parentElement.children){
        if(o==e){
          continue
        }
        rv=_findValues(o)
        if(rv){
          return rv
        }
        if(_hasValue(o)){
          _break=1
        }
      }
      rv=_findValues(e.parentElement)
      if(rv){
        return rv
      }
      e=e.parentElement
      if(_break||_hasValue(e)){
        break
      }
    }
    return {e:e,vs:vs}

    function _findValues(e){
      let tx=(e.innerText||e.value||e.textContent||"").trim()
      if(tx){
        vs.push(tx)
        if(_isEqualValue(v,tx)){
          _domActionTask._doLog("BZ-LOG: Match: "+v+" vs "+tx)
          return {e:e,vs:vs,v:tx}
        }
      }
      if(e.attributes){
        for(let a of e.attributes){
          let av=(a.value||"").trim()
          if(av&&_Util._isTitleAttr(a.name)){
            vs.push(av)
            if(_isEqualValue(v,av)){
              _domActionTask._doLog("BZ-LOG: Match: "+v+" vs "+tx)
              return {e:e,vs:vs,v:av}
            }
          }
        }
      }
    }

    function _isEqualValue(tv,fv){
      if(tv.constructor==Date){
        fv=_Util._findDateFromString(fv)
        if(fv.length){
          return fv.find(x=>x.d.getTime()==tv.getTime())
        }
      }else{
        return v1==v2
      }
    }

    function _hasValue(e){
      return (e.innerText||e.textContent||e.value||"").trim()
    }
  },
  _isTitleAttr:function(e){
    return !["class","style","width","height","disabled","src","href","checked","name","type","readOnly","tabIndex","contentEditable","hidden",""].includes(e)
  },
  _formatMessage:function(_msg,_value){
    if(_value&&_value.constructor!=Array){
      _value=[_value]
    }
    _msg=(_msg||"")+""
    for(var i=0;_value && i<_value.length;i++){
      var s=new RegExp("\\{"+i+"\\}","g");
      _msg=_msg.replace(s,_value[i])
    }
    return _msg;
  },
  _escCloseWindow:function(e){
    if(e==undefined){
      e=null;
    }
    var k = _Util._checkKeycode(e);
    if(k==27){
      let os=$(e.srcElement.ownerDocument).find(".bz-modal-window .btn-cancel:last")
      if(os.length){
        os.click()
        return
      }
      try{
        this.tagWin.close();
        this.open("","bz-master");
      }catch(e){
      }
    }else if(k==116){
      this.open("","bz-master");
      parent.location.reload();
    }
  },
  _setFindDomJS:function(o){
    let s="document"
    let _bzPath=_Util._clone(o.bzTmp)
    
    if(_bzPath.find(x=>x=="shadowRoot")){
      while(_bzPath.length){
        let v=_bzPath.shift()
        if(!v||$.isNumeric(v)||v.includes("BZ.TW.document")){
          continue
        }
        if(v=="shadowRoot"){
          s+=_findShadowPath(_bzPath,document,o)
        }else{
          let t=v.split(/[:\[\.\#]/)[0]
          s+=_findElementPath(t,_bzPath,document,o)
        }
        break
      }
    }else{
      let os=document.getElementsByTagName(o.tagName)
      for(let i=0;i<os.length;i++){
        if(os[i]==o){
          s=`document.getElementsByTagName('${o.tagName}')[${i}]`
          break
        }
      }
    }

    o._jsPath=s

    function _findShadowPath(p,_root,o){
      let t=p.shift()
      t=t.split(/[:\[\.\#]/)[0]
      for(let i=0;i<_root.children.length;i++){
        let oo=_root.children[i]
        if(oo.getElementsByTagName(t).length){
          let s=_findElementPath(t,_Util._clone(p),oo,o)
          if(s){
            return ".children["+i+"]"+s
          }
        }
      }
    }
    
    function _findElementPath(_tagName,p,_root,o){
      let os=_root.getElementsByTagName(_tagName)
      let tt=p.shift(),s=`.getElementsByTagName("${_tagName}")`
      
      for(let i=0;i<os.length;i++){
        let oo=os[i]
        if(tt){
          if(tt=="shadowRoot"){
            if(oo.shadowRoot){
              let ss=_findShadowPath(_Util._clone(p),oo.shadowRoot,o)
              if(ss){
                return `${s}[${i}].shadowRoot${ss}`
              }
            }
          }else{
            tt=tt.split(/[:\[\.\#]/)[0]
            let ss=_findElementPath(tt,_Util._clone(p),oo,o)
            if(ss){
              return `${s}[${i}].getElementsByTagName("${_tagName}")[${i}]${ss}`
            }
          }
        }else if(o==oo){
          return `${s}[${i}]`
        }
      }
    }
  },
  _swapKeyValue:function(_json){
    var _result = {};
    for(var _key in _json){
      _result[_json[_key]] = _key;
    }
    return _result;
  },
  _findAllHiddenElements:function(o,os){
    o=o||document.body
    os=os||[]
    let r=o.getBoundingClientRect()
    if(!r.width&&!r.height&&!r.top&&!r.left){
      if(o.tagName!="INPUT"||["file","checkbox","radio"].includes(o.type)){
      // if($(o).is(":hidden")){
        os.push(o)
      }
    }else if($(o).css("visibility")=="hidden"){
      os.push(o)
    }else if(o.tagName!="SELECT"){
      for(let oo of o.children){
        _Util._findAllHiddenElements(oo,os)
      }
    }
    return os
  },
  _isHidden:function(o,_bParent,_chkBZElement){
    if(!o||_Util._isIgnoreElement(o)){
      return 1;
    }
    if($(o).is(".BZIgnore")||$(".BZIgnore").find(o)[0]){
      if(!_chkBZElement){
        return 1
      }
    }
    var n=o.tagName;
    if(n){
      if(n=="INPUT" && o.type=="hidden"){
        return 1;
      }else if(n=="INPUT" && o.type=="file"){
        return _Util._isHidden(o.parentElement,1);
      }else if($(o).css("display")=="none" || (($(o).css("visibility")=="hidden"||$(o).css("opacity")==0) && !_bParent)){
        if(o.tagName=="INPUT"&&["checkbox","radio"].includes(o.type)){
          
        }else{
          return 1;
        }
      }
      if(!_bParent){
        var a=o.getBoundingClientRect();
        if(o.offsetLeft+o.offsetWidth<0 || o.offsetTop+o.offsetHeight<0){
          return 1
        }
        if(a.width<2 || a.height<2){
          if(o.innerText!=undefined && !o.innerText.trim()){
            for(var i=0;i<o.children.length;i++){
              if(!_Util._isHidden(o.children[i])){
                return 0
              }
            }
            return 1
          }
        }
      }
      /*
      var _rect=o.getBoundingClientRect();
      var _minOffsetLeft=_minOffsetTop=0;
      while(o!=o.ownerDocument.body){
        if(_minOffsetLeft>o.offsetLeft){
          _minOffsetLeft=o.offsetLeft;
        }
        if(_minOffsetTop>o.offsetTop){
          _minOffsetTop=o.offsetTop;
        }
        o=o.parentElement;
        if(!o){
          return 1;
        }
      }
      
      if(_minOffsetTop+_rect.height<=0 || _minOffsetLeft+_rect.width<=0){
        return true;
      }
      */
      if(o.tagName!="BODY"){
        return _Util._isHidden(o.parentElement,1)
      }
      return !o.ownerDocument || !o.ownerDocument.defaultView;
    }
    return 1;
  },
  _isTooSmall:function(o){
    o=o.getBoundingClientRect()
    return o.width<10||o.height<10
  },
  _moveMenu:function(v,_from){
    let r=v.getBoundingClientRect();
    if(r.bottom>window.innerHeight){
      if(r.top>r.height){
        $(v).css({top:r.top-r.height+"px"})
      }else{
        $(v).css({top:0})
      }
    }
  },
  _setTabStyle:function(o){
    if(o&&o.parentElement){
      $(o.parentElement).css({display:"unset"})
      $(o).css({width:"unset"})
      let w=o.getBoundingClientRect().width+30
      $(o).css({width:w})
      o._width=w
      $(o.parentElement).css({display:"flex"})
    }
  },
  _isOpacity:function(o){
    while(o&&o.tagName!="BODY"&&$(o).css("opacity")!=0){
      o=o.parentElement
    }
    return o.tagName!="BODY"
  },
  _scrollToTop:function(o){
    while(o&&o.parentElement){
      o=o.parentElement
      o.scrollTop=0
      o.scrollLeft=0
    }
  },
  _focusElement:function(o){
    o&&o.scrollIntoView({block:"nearest"})
  },
  _getBackgroundColor:function(e){
    var c=$(e).css("background-color");
    if(c=="rgba(0, 0, 0, 0)"){
      return _Util._getBackgroundColor(e.parentElement)
    }
    return c
  },
  _isEqualValue:function(v1,v2){
    v1=v1===0?"0":v1||""
    v2=v2===0?"0":v2||""
    if(v1==v2){
      return 1
    }
    if(v1.constructor==v2.constructor){
      return _Util._isEqualData(v1,v2)
    }
  },
  _isEqualData:function(d1,d2,_ignoreKeys,_sameKey){
    d1=d1||"";
    d2=d2||""
    if(d1.constructor==Object&&!Object.keys(d1).length){
      d1=""
    }
    if(d2.constructor==Object&&!Object.keys(d2).length){
      d2=""
    }
    if(d1.constructor==Array&&!d1.length){
      d1=""
    }
    if(d2.constructor==Array&&!d2.length){
      d2=""
    }
    if(d1&&d2&&d1.constructor==d2.constructor&&[Object,Array].includes(d1.constructor)){
      var ks=[],kk=new Set()
      if(_sameKey&&d1[_sameKey]==d2[_sameKey]){
        return 1
      }
      for(var k in d1){
        if(_ignoreKeys&&_ignoreKeys.includes(k)){
          continue
        }else if(k=="key"&&!_sameKey&&!d2.key){
          continue
        }
        kk.add(k)
        if(!_Util._isEqualData(d1[k],d2[k],_ignoreKeys)){
          return
        }
        ks.push(k)
      }
      for(var k in d2){
        if(_ignoreKeys&&_ignoreKeys.includes(k)){
          continue
        }else if(k=="key"&&!_sameKey&&!d1.key){
          continue
        }
        if(!kk.has(k)){
          if(!_Util._isEqualData(d1[k],d2[k],_ignoreKeys)){
            return
          }
        }
      }
      return 1
    }else{
      return d1==d2
    }
  },
  //check whether o1 after o2;
  _positionAfterElement:function(o1,o2){
    o1=o1.getBoundingClientRect();
    o2=o2.getBoundingClientRect();
    return o1.top>=o2.bottom || (o1.bottom>o2.top && o1.left+o1.width>=o2.right);
  },
  _getWindowFromDom:function(o){
    return o.ownerDocument.defaultView;
  },
  _scrollUpSelectedItem:function(_uiBox,_selectedUI,_diffHeight,_maxMove){
    _diffHeight=_diffHeight||30;
    if(!_uiBox || !_selectedUI){return;}
    _uiBox=$(_uiBox)[0]
    var uiBoxHeight = _uiBox.offsetHeight;
    let d1 = _selectedUI.offsetTop,
        d2=d1+_selectedUI.offsetHeight,
        d3=_uiBox.scrollTop,
        d4=d3+uiBoxHeight;
    if(d1-_diffHeight<d3||d2>d4){
      d1-=_diffHeight
      if(d1>_maxMove){
        d1=_maxMove;
      }
      _uiBox.scrollTop=d1;
      return;
    }
  },
  _selectKeyWordsInInput:function(o){
    var i1=o.value.indexOf("{")
    if(i1>=0){
      o.selectionStart=i1
      var i2=o.value.indexOf("}")+1
      if(i2){
        o.selectionEnd=i2
      }
    }
  },
  _searchValueInJSON:function(j,v,_inSensitive,_include,_find,p,ks){
    p=p||""
    ks=ks||[]
    if(_inSensitive&&!ks){
      if(v.constructor==Array){
        v=v.map(x=>x.toString().trim().toLowerCase())
      }else{
        v=v.toString().trim().toLowerCase()
      }
    }
    if(j&&[Object,Array].includes(j.constructor)){
      for(var k in j){
        let pk=p?p+"."+k:k,d=j[k]
        if(_Util._isObjOrArray(d)){
          if(_Util._searchValueInJSON(d,v,_inSensitive,_include,_find,pk,ks).length&&_find){
            return ks
          }
        }else if(d){
          d=d.toString().trim()
          if(_inSensitive){
            d=d.toLowerCase()
          }

          if(d==v||(_include&&d.includes(v))){
            ks.push(pk)
          }
        }

        if(ks.length&&_find){
          return ks
        }
      }
    }
    return ks
  },
  _alertMessage:function(_msg){
    _Util._debugLocal()

    // try{
      // let _stack=new Error().stack
      // console.log("BZ-LOG:"+_stack.replace("Error","End"));
    // }catch(e){}
    if(BZ._isAutoRunning()){
      console.log("BZ-LOG:"+_msg)
      return
    }
    
    if(_bzMessage._system._error[_msg]){
      _msg=_bzMessage._system._error[_msg];
    }

    if($(".alert-msg").toArray().find(a=>{
      if(a.innerText==_msg){
        let v=$(a).attr("repeat")
        if(v){
          v=parseInt(v.split(":")[1])+1
        }else{
          v=1
        }
        $(a).attr("repeat","("+_bzMessage._api._repeat+": "+v+")")
        return 1
      }
    })){
      return
    }
    
    _msg="<div class='alert-msg'>"+_msg+"</div>"


    var _extraPara={};
    for(var i=1;i<arguments.length;i++) {
      var o=arguments[i];
      if ($.isFunction(o)) {
        _extraPara._fun=o;
      }else{
        _extraPara._exception=o;
      }
    }
    var d=_Util._clone(_Dialog),
        _winTagClass="bz-alert-window";
    d._viewDef._items[0]._attr.class+=" "+_winTagClass

    var _dialog={
      _title:_bzMessage._common._message,
      _modal:true,
      _moveable:true,
      _destroyOnClose:true,
      _buttons:[
        {
          _title:_bzMessage._common._ok,
          _class:"btn btn-primary bz-alert-btn",
          _click:function(){
            d._close()
          }
        }
      ],
      _afterClose:function(){
        _Util._alertContent=""
        if (_extraPara._fun) {
          _extraPara._fun();
        }
      }
    };
    _msg+=_extraPara._exception?"\n\nStack:"+_extraPara._exception.stack:"";
    
    if(!_Util._isBZTWOpened() || BZ.TW.focus || !BZ.TW.document.hasFocus() || _msg.indexOf("</")>0){
      if(_msg.indexOf("</")<0 && _msg.length<=50){
        _msg="<nobr>"+_msg+"</nobr>";
      }
      if(_Util._alertContent && _Util._alertContent!=_msg){
        _msg=_Util._alertContent+"\n<hr/>\n"+_msg
      }
      
      _Util._alertContent=_msg;
      var o=$("<div style='min-width:150px;max-width:100%;word-break:break-all;margin:0;float:left;white-space: pre-wrap;'></div>")
      if(_msg.includes("</html>")){
        o=o.text(_msg);
      }else{
        o=o.html(_msg);
      }
      let _win=window;
      try{
        if(event){
          _win=event.srcElement.ownerDocument.defaultView
        }
      }catch(e){}
      d._showMe(o[0],_dialog,_win.document.body,_winTagClass);
    }else{
      BZ.TW.alert(_msg);
    }
  },
  _attachResize:function(o,h){
    let _doc=_Util._getCurDocument()
    setTimeout(()=>{
      if(o.constructor==String){
        o=$(_doc).find(o)
      }
      o=$(o)[0];
      $(o).css({"min-height":"unset"});
      o=_Util._findParentElementByCss(".bz-modal-window",o);
      $(o).css({"max-height":"unset"});
      if(h){
        $(o).css({height:h+"px"})
      }
      _Util._attachResizeWindow(o)
    },100)
  },
  _attachResizeWindow:function(w){
    let _doc=w.ownerDocument
    let o=$("<div class='bz-corner-resize'></div>").appendTo(w)
    let p,wr=w.getBoundingClientRect();
    $(w).css({"max-width":"unset",left:wr.left+"px",top:wr.top+"px",transform:"unset"})
    o.mousedown(function(e){
      let x=this
      o.p=_Util._getMouseXY(e)
      wr=w.getBoundingClientRect()
      e.preventDefault()
      e.stopPropagation()


      let _onmousemove=_doc.body.onmousemove
      _doc.body.onmousemove=function(e){
        if(o.p&&e.buttons){
          if(!$(_doc.body).hasClass("prevent-select")){
            $(_doc.body).addClass("prevent-select")
          }
          let q=_Util._getMouseXY(e)
          let wl=(q.x-o.p.x),
              wh=(q.y-o.p.y)

          wl+=wr.width
          wh+=wr.height
          $(w).css({width:wl+"px",height:wh+"px"})
        }else{
          o.p=0
          _doc.body.onmousemove=_onmousemove
          $(_doc.body).removeClass("prevent-select")
        }
      }
    })
  },
  _getCurDocument:function(){
    if(window.event&&window.event.target){
      return window.event.target.ownerDocument||document
    }
    return document
  },
  _replaceObjByMap:function(o,_map){
    if(_Util._isObjOrArray(o)){
      for(var k in o){
        o[k]=_Util._replaceObjByMap(o[k],_map)
      }
    }else if(o.constructor==String){
      let i=0;
      for(var k in _map){
        let v=_map[k]
        if(v){
          o=o.split(v).join(String.fromCharCode(--i))
        }
      }
      i=0
      for(var k in _map){
        let v=_map[k]
        if(v){
          o=o.split(String.fromCharCode(--i)).join(k)
        }
      }
    }
    return o
  },
  _confirmCancelUpdate:function(_fun,_msg,_cancelFun){
    _Util._confirmMessage(_msg||_bzMessage._system._info._cancelUpdate,[{
      _title:_bzMessage._method._yes,
      _click:function(c){
        _fun()
        c._ctrl._close()
      }
    }],0,0,0,_cancelFun)
  },
  //option:{list[],_msg:"",_title:"",_btns(?):[{_title:"",_class:"",_click:function(){}}]}
  _confirmList:function(_option){
    _Util._confirmMessage({
      _tag:"div",
      _attr:{
        style:"margin:10px;display: flex;flex-direction: column;"
      },
      _items:[
        {
          _tag:"div",
          _attr:{
            style:"display: flex;flex-direction: column;margin-top: 0;padding-top: 0;"
          },
          _items:[
            {
              _if:_option._msg&&_option._msg.constructor==String,
              _tag:"div",
              _attr:{
                style:"font-size: 15px;margin-bottom:10px;"
              },
              _html:function(){
                return _option._msg
              }
            },
            {
              _if:_option._msg&&_option._msg.constructor!=String,
              _tag:"div",
              _attr:{
                style:"font-size: 15px;margin-bottom:10px;"
              },
              _items:_option._msg&&_option._msg.constructor==Array?_option._msg:[_option._msg]
            },
            {
              _if:function(){
                return _option._note
              },
              _tag:"i",
              _attr:{
                class:"bz-note-text2"
              },
              _text:function(){
                return _option._note
              }
            }
          ]
        },
        {
          _if:!_Util._isEmpty(_option._list),
          _tag:"div",
          _attr:{
            class:"bz-list-box"
          },
          _items:[
            {
              _tag:"div",
              _attr:{
                class:function(d){
                  if(_option._click){
                    let c="bz-clickable-hover"
                    if(BZ._data._uiSwitch._curUtilListItem==d._item){
                      c+=" bz-selected"
                    }
                    return c
                  }
                }
              },
              _items:[
                {
                  _tag:"span",
                  _attr:{
                    class:"(_data._item._class||'')+' bz-right-space-5'",
                    style:"_data._item._style"
                  },
                  _text:"_data._idx+1+'.' "
                },
                {
                  _if:"_data._item._icon",
                  _tag:"span",
                  _attr:{
                    class:"_data._item._icon",
                    style:"margin-right:5px;font-size:11px;"
                  }
                },
                {
                  _tag:"span",
                  _attr:{
                  },
                  _text:"_data._item.name||_data._item.code||_data._item._title||_data._item"
                }
              ],
              _jqext:{
                click:function(){
                  if(_option._click){
                    BZ._data._uiSwitch._curUtilListItem=this._data._item
                    _option._click(this._data._item)
                  }
                }
              },
              _dataRepeat:_option._list
            }
          ]
        }
      ]
    },
    (_option._btns||[]).map(x=>{
      x._title=x._title||_bzMessage._method._yes
      x._class=x._class||"btn btn-primary "
      return x
    }),_option._title,0,0,0,_option._noModel)

  },
  _confirm:function(_txt,_fun){
    _Util._confirmMessage(_txt,[
      {
        _title:_bzMessage._method._yes,
        _class:"btn btn-primary",
        _click:_fun
      }
    ])
  },
  _confirmDelete:function(_fun,_msg,_list){
    _Util._confirmList({
      _msg:_msg||_bzMessage._system._info._confirmDelete,
      _list:_list,
      _title:_bzMessage._method._confirmDelete,
      _btns:[{
        _title:_bzMessage._method._delete,
        _class:"btn btn-warn",
        _click:_fun
      }]
    })
  },
  _toJQueryValue:function(v){
    return (v||"").replace(/(:|\.|\[|\]|,|=|@)/g,"\\$1")
  },
  _debugLocal:function(){
    if(BZ._debug){
      //For developer debugger
      console.log("Debugger:",new Error().stack)
    }
  },
  _confirmMessage:function(_msg,_btns,_title,_width,_noCancel,_cancelFun,_noModel,_body,_noMoreAsk){
    _Util._debugLocal()
    let _loading=_msg
    var d=_Util._clone(_Dialog),
        _winTagClass="bz-confirm-window";
    d._viewDef._items[0]._attr.class+=" "+_winTagClass
    let ww=window.innerWidth*0.618
    if(ww<400){
      ww=400
    }else if(_msg&&_msg.constructor==String){
      ww=Math.min(_msg.split("\n").filter(x=>x).sort((a,b)=>b.length-a.length)[0].length*8,ww)
      if(curUser.language=="cn"){
        ww*=1.5
      }
    }
    _width=(_width||Math.min(ww,600))+"";
    if(!_width.match(/\%/)){
      _width+="px"
    }
    _btns=_btns||[]
    _btns.forEach(b=>{
      b._class=b._class||"btn-primary "+(b._exClass||"")
      if(!(b._class||"").includes("pull-")){
        b._class+=" bz-left-space-10 btn pull-right"
      }
      b._title=b._title||_bzMessage._method._save
    })
    var _dialog=_CtrlDriver._buildProxy({
      _title:_title?_title:_bzMessage._common._confirm,
      _width:400,
      _height:200,
      _modal:!_noModel,
      _moveable:1,
      _destroyOnClose:true,
      _buttons:_noCancel&&_noCancel!='_close'?[]:[
        {
          _title:_btns.length?_bzMessage._method[_noCancel||!_btns.length?"_close":'_cancel']:_bzMessage._common._close,
          _class:"btn-cancel btn btn-secondary bz-pull-right",
          _style:function(d){
            return "margin-right:5px;"
          },
          _click:function(_this){
            if(_cancelFun){
              if(_cancelFun()===0){
                return
              }
            }
            _this._ctrl._close();
          }
        }
      ]
    });

    var _content=$("<pre class='pull-left bz-dlg-content' style='word-break: break-word;white-space: pre-wrap;max-width:100%;width:100%;margin: 0;'></pre>")
    
    try{
      if(bzComm._isAppExtension()){
        $("#bz-dialog").remove()
        let o=$("<div id='bz-dialog' style='position:fixed;width:0;height:0;z-index:"+Number.MAX_SAFE_INTEGER+"'></div>").appendTo(document.body.parentElement)
        _body=o[0].attachShadow({mode:"open"})
        _body.innerHTML=`<link rel='stylesheet' href='${SERVER_HOST.replace(/^https?:/,location.protocol)}/ide/css/main.max.css'>`
                       +`<link rel='stylesheet' href='${SERVER_HOST.replace(/^https?:/,location.protocol)}/ide/css/main.icons.css'>`
                       +`<style>.bz-bg>*{background:#FFF;box-shadow: inset 2px 2px 2px hsla(0,0%,100%,.25), inset -2px -2px 2px rgba(0,0,0,.25);border: 2px solid #CCC;border-radius: 10px;}</style>`
      }else{
        _body=_body||_Util._getCurDocument().body
      }
    }catch(e){}
    if(!_body){
      _body=window.document.body
    }
  
    if(_msg.constructor==String){
      _content.html(_msg); 
    }else if(_msg.constructor==Object){
      _msg=_CtrlDriver._execute({},{},_msg,_body);
      _content.append(_msg); 
    }else{
      _content.append(_msg); 
    }
    if(_noMoreAsk){
      _content.append("<label style='display:block;margin:20px 0;'><input type='checkbox' onclick='this.checked?localStorage.setItem(\"BZ:"+_noMoreAsk+"\",1):localStorage.clear()'/>"+_bzMessage._system._info._noMoreAsk+"</label>")
    }
    _content.css({opacity:0,position:"fixed"})
    $(_body).append(_content[0]);
    // $(document.body).append(_content[0]);
    var dm=_Util._getDomSize(_content[0]);
    _dialog._width=_width
    
    _dialog._height=parseInt(dm._height)+150;
    if(_dialog._height>700){
      _dialog._height-=10
    }
    _btns.forEach(b=>{
      b&&_dialog._buttons.unshift(b);
    })
    _dialog=d._showMe(_content[0],_dialog,_body,_winTagClass);
    _content.css({opacity:1,position:"unset"})
    //_Util._resizeModelWindow(_dialog,_body.ownerDocument)
    _waitExe()
    _chkSize()
    function _waitExe(i){
      var _timer=$(_body).find(".bz-dlg-timmer-btn")
      if(_timer[0]){
        var s=_timer.find(".bz-second-num")[0]
        if(!s){
          s=$(_body).find("<span class='bz-second-num'> (31 s)</span>")[0];
          _timer.append(s)
        }
        var v=parseInt(s.innerText.substring(2))-1
        if(!v){
          return _timer.click()
        }
        s.innerText=" ("+v+" s)"
        setTimeout(_waitExe,1000)
      }
    }

    function _chkSize(){
      if(_loading&&_loading._load){
        return setTimeout(()=>{
          _chkSize()
        },100)
      }
      _Util._resizeModelWindow(_dialog,_body.ownerDocument)
    }
  },
  _setMoveWindow:function(_noMove){
    $(".bz-modal-window").toArray().forEach(o=>{
      if(o._data){
        o._data._noMoveable=_noMove
      }
    })
  },
  _closeModelWindow:function(e){
     setTimeout(function(){
      if($(".bz-large-editor")[0]){
        $(".bz-textarea-ctr").click()
      }else if($(".bz-large")[0]){
        $(".bz-ui-switch").click()
      }else{
        while(_dialogList.find((v,i)=>{
          if(v&&!v._noEsc){
            if(!e||(e.target&&(e.target==document.body||v._isSameDlg(e.target)))||$(v).find(e)){
              v._close()
              return v
            }
          }
        })&&Date.now()-_lastCloseDlgTime<50){}
        _lastCloseDlgTime=Date.now()
     }
   },10)
  },
  _gotoPageFromModelWindow:function(v,o){
    BZ._setHash(v)
    _Util._closeModelWindow(o)
  },
  _gotoPageFromModelWindow:function(v,o){
    BZ._setHash(v)
    _Util._closeModelWindow(o)
  },
  _resizeModelWindow:function(o,_doc){
    clearTimeout(_Util._resizeWindowTimer)
    _Util._resizeWindowTimer=setTimeout(function(){
      _doc=_doc||window.document
      let os=$(_doc).find(".bz-modal-window").toArray()
      if(o){
        o=os.find(oi=>{
          return oi==o|| $(oi).find(o).length
        })
        _doIt(o)
      }else if(os.length){
        _doIt(os.pop())
      }
    },10)
    
    function _doIt(o,i){
      i=i||0
      o=$(o)
      let v=o.find(".bz-dlg-content")[0]
      if(v){
        let r=o[0].getBoundingClientRect(),
            wh=_doc.defaultView.innerHeight,_resize;

        if(r.top>wh-r.bottom){
          _resize=wh-r.bottom>20
        }

        o.css({height:"100px"})
        o.css({height:100+v.scrollHeight-v.getBoundingClientRect().height+40+"px"})
        if(!v.innerText&&i<10&&v.getBoundingClientRect().height<10){
          return setTimeout(()=>{
            _doIt(o,i+1)
          },100)
        }
        if(_resize){
          r=o[0].getBoundingClientRect()
          if(r.top>wh-r.bottom){
            if(wh-r.bottom<20){
              o.css({top:r.top-20+wh-r.bottom+"px"})
            }
          }
        }
      }
    }
  },
  _getEndElementsByWord:function(_judgeFun,o,_inHidden,_checkingElement){
    o=$(document.body).find(o).toArray()
    let _last,_hiddens=[];;

    for(let i=0;i<o.length;i++){
      let x=o[i]
      if(_last&&$(_last).find(x)[0]){
        if(_hiddens.includes(_last)){
          if(_judgeFun(x.innerText)){
            _hiddens.push(x)
          }
        }
        o.splice(i--,1)
      }else if(!_judgeFun(x.innerText)){
        o.splice(i--,1)
        _last=x
      }else if(_Util._isHidden(x)){
        _hiddens.push(x)
        o.splice(i--,1)
        _last=x
      }else{
        _last=0
      }
    }
    if(_inHidden){
      _doIt(_hiddens)
      return _hiddens
    }else{
      _doIt(o)
      if(o.length){
        return o
      }
      _doIt(_hiddens)
      return _hiddens
    }
    function _doIt(o){
      _last=o[o.length-1]

      for(let i=o.length-2;i>=0;i--){
        if(!_Util._isCellElement(o[i])&&$(o[i]).find(_last)[0]){
          o.splice(i,1)
        }else{
          _last=o[i]
        }
      }
      // _Util._spliceAll(o,x=>{
        // if(!_Util._isCellElement(x)){
          // for(let i=0;i<x.childNodes.length;i++){
            // let n=x.childNodes[i]
            // if(n.nodeType==3&&_judgeFun(n.textContent||"")){
              // return
            // }
          // }
          // return 1
        // }
      // })
    }
    return o
  },
  //for shadowRoot
  _getRootDom:function(o){
    while(o.parentElement&&o.tagName!="BODY"){
      o=o.parentElement
    }
    return o
  },
  _getElementsByWord:function(_judgeFun,o,_inHidden,_root){
    if(o=="BODY"){
      o=[_root||document.body]
    }else{
      o=$(_root||document.body).find(o).toArray()
    }
    let _last,_hiddens=[];

    for(let i=0;i<o.length;i++){
      let x=o[i]
      if(_last&&$(_last).find(x)[0]){
        if(_hiddens.includes(_last)){
          if(_judgeFun(x.innerText)){
            _hiddens.push(x)
          }
        }
        o.splice(i--,1)
      }else if(!_judgeFun(x.innerText)){
        o.splice(i--,1)
        _last=x
      }else if(_Util._isHidden(x)){
        _hiddens.push(x)
        o.splice(i--,1)
        _last=x
      }else{
        _last=0
      }
    }
    if(_inHidden||!o.length){
      return _hiddens
    }
    return o
  },
  _isStdInputElement:function(v){
    return this._isInputTag(v.tagName) && !["image","button","reset","submit","hidden"].includes(v.type);
  },
  _isEventElement:function(v){
    return _Util._isInputObj(v)||$("[contenteditable=true]").find(v)[0]|| ["OPTION","BUTTON","A"].includes(v.tagName)
  },
  _isCellElement:function(v){
    return _Util._isEventElement(v)
  },
  _findAllCellsInPanel:function(p,os){
    os=os||[]
    if(p.constructor!=Array){
      p=[p]
    }
    p.forEach(o=>{
      _find(o,os)
    })
    function _find(p,os){
      let _found
      for(let i=0;i<(p.children||[]).length;i++){
        let o=p.children[i],r=o.getBoundingClientRect()
        if(!_Util._isHidden(o)&&r.width>=5&&r.height>=5){
          _found=1
          if(["SELECT","SVG","svg","BUTTON","A"].includes(o.tagName)||_Util._isInContentEditable(o)){
            os.push(o)
          }else{
            _find(o,os)
          }
        }
      }
      if(!_found){
        os.push(p)
      }else{
        for(let i=0;i<p.childNodes.length;i++){
          let o=p.childNodes[i]
          if(o.nodeType==3){
            let v=(o.textContent||"").trim()
            if(v){
              os.push(o)
            }
            break
          }
        }
      }
    }
    return os
  },
  _isInputTag:function(v){
    return ["INPUT","SELECT","TEXTAREA"].includes(v);
  },
  _popWin:function(url,name,_win,_width,_height,_viewDef,_title){
    _Util._debugLocal()

    var w=_width || screen.availWidth*0.50;
    var h=_height || screen.availHeight*0.50;
    var l=(screen.availWidth-w)/2;
    var t=(screen.availHeight-h)/2;
    if(!_win){
      _win=window;
    }
    w=(_win.BZ_PopOpen||_win.open)(url,name,"width="+w+",height="+h+",left="+l+",top="+t+",resizable=yes");
    
    var d=w.document;
    w.focus();
    var _host=SERVER_HOST;
    if(window.extensionContent&&_host.match(/^\/\/[0-9\.]+$/)){
      _host="/"+"/ai.boozang.com"
    }

    

    //Setup css
    if(_Util._style){
      d.write("<style>"+_Util._style+"</style>")
    }else{
      d.write("<link rel='stylesheet' type='text/css' href='"+_host+"/ide/css/js-editor.css'>");
      d.write("<link rel='stylesheet' type='text/css' href='"+_host+"/ide/css/main.max.css'>");
    }
    d.write("<link rel='stylesheet' type='text/css' href='"+_host+"/ide/css/main.icons.css'>");
    d.write("<style>input{font-family: Courier;}\n#_content span{color:blue;}\nul input{border: 0;margin: 2px;}</style>");

    d.write("<link type='image/x-icon' href='"+_host+"/favicon.ico'>");
    d.write(`<body style='min-width:unset;overflow:hidden;' class='bz-pop-win'></body>`);

    w.BZ=BZ;

    
    _Util._handlePrePanel(d)
    
    _Util._setEscWindow(w);
    d.title="BZ - "+_title
    if(!_viewDef._attr||!_viewDef._attr.disabled){
      _viewDef._attr=_viewDef._attr||{}
      _viewDef._attr.disabled=!BZ._isCheckout()
    }
    _CtrlDriver._setupKeyInput(d)
    _CtrlDriver._execute({},{},_viewDef,d.body);

    // d.insertBefore(d.implementation.createDocumentType('html','',''), d.childNodes[0]);
    setTimeout(function(){
      if(curUser.uiModel){
        $(w.document.body.parentElement).addClass("bz-in-"+curUser.uiModel)
      }
      $(w.document).contextmenu((e)=>{
        e=e.target
        _Util._copyText(e,e.ownerDocument,e)
        return false
      })
      w.onresize=function(){
        let _this=this
        clearTimeout(this._resizeTime)
        this._resizeTime=setTimeout(function(){
          $(w.document).find(".bz-resize").each(function(i,o){
            o._viewDef._resize(o,_this);
          })
        },100);
      }
      w.onclick=function(e){
        window.document.body.click()
      }
      w.onresize();
    },10)
    return w
  },
  _checkKeycode:function(e) {
    var _keycode;
    if (window.event) {
      _keycode = window.event.keyCode;
    }else if (e) {
      _keycode = e.which;
    }
    return _keycode;
  },
  _checkCharcode:function(e) {
    e=e||window.event;
    var _keycode=0;
    if (e) {
      _keycode = e.charCode;
    }
    if(!_keycode && e && e.key && e.key.length==1){
      _keycode=e.key.charCodeAt(0)
    }
    return _keycode;
  },
  _getDomXYForDrag:function(obj){
    let _nsSlider=$(obj).css("cursor")=="row-resize"
    let _ewSlider=$(obj).css("cursor")=="col-resize"
    if(obj.defaultView){
      return {x:0,y:0};
    }
    var o=obj.getBoundingClientRect()
    var x=o.x,
        y=o.y,
        t=$(obj).css("transform");
    if(!t||t=="none"){
      if(_nsSlider){
        $(obj).css({top:y+"px"})
      }else if(_ewSlider){
        $(obj).css({left:x+"px"})
      }else{
        $(obj).css({left:x+"px",top:y+"px"})
      }
      o=obj.getBoundingClientRect()
      var x1=o.x,
          y1=o.y;
      
      if(x1!=x||y1!=y){
        x=x+x-x1
        y=y+y-y1
        if(_nsSlider){
          $(obj).css({top:y+"px"})
        }else if(_ewSlider){
          $(obj).css({left:x+"px"})
        }else{
          $(obj).css({left:x+"px",top:y+"px"})
        }
      }
    }
    return {"x":x, "y":y};    
  },
  _inBrokenDom:function(o){
    while(o){
      if(o.tagName){
        o=o.parentElement
      }else{
        return 1
      }
    }
  },
  _getDomXY:function(obj){
    if(obj.defaultView){
      return {x:0,y:0};
    }
    
    var _box = obj.getBoundingClientRect();
    
    if((_box.width==0||_box.height==0)&&(_box.left==0&&_box.top==0)){
      if(_cssHandler._isInShadowDom(obj)){
        _box=obj.parentElement.getBoundingClientRect()
      }
    }
    return {"x":_box.left, "y":_box.top};
  },
  _trimSpace:function(v){
    return v.trim().replace(/\s+/g," ");
  },
  _BZContentToFormatedHtml:function(_view,_step){
    if(_view.tag){
      var _attr=""
      if(_view.id){
        _attr=" id=\""+_view.id+"\"";
      }
      if(_view.tagAttr){
        for(var k in _view.tagAttr){
          _attr+=" "+k+"=\""+_view.tagAttr[k]+"\"";
        }
      }
      var s=_step+"<"+_view.tag+_attr+">\r";
      var v="";
      if(_view.items){
        for(var i=0;i<_view.items.length;i++){
          var vv=_view.items[i];
          v += _Util._BZContentToFormatedHtml(vv,_step+"  ");
        }
      }
      var e=_step+"</"+_view.tag+">\r";
      return s+v+e;
    }else{
      return _step+_view.html+"\r";
    }    
  },  
  _getParentNode:function(_dom,_tag){
    while(_dom.parentNode){
      _dom=_dom.parentNode;
      if(_dom.tagName==_tag){
        return _dom;
      }else if(_dom.tagName=="HTML"){
        return null;
      }
    }
  },
  _objToArray:function(o){
    let a=[];
    Object.keys(o||{}).forEach(x=>{
      a.push({key:x,value:o[x]})
    })
    return a
  },
  _arrayToObj:function(a,k,v){
    let o={};
    k=k||"key";
    v=v||"value";
    (a||[]).forEach(x=>{
      let kk=x[k]
      if(kk===undefined&&!_Util._isObjOrArray(x)){
        kk=x
      }
      o[kk]=x[v]
    });
    return o
  },
  _getMouseOnChild:function(e,_pos){
    var os=e.children,o;
    for(var i=0;i<os.length;i++){
      o=os[i]
      if(!_Util._isHidden(os[i])){
        var e=o.getBoundingClientRect()
        if(_pos.x>=e.left&&_pos.y>=e.top&&_pos.x<=e.right&&_pos.y<=e.bottom){
          if(!$(o).hasClass("BZIgnore")){
            return o
          }
        }else if(o.children){
          var oo=_Util._getMouseOnChild(o,_pos)
          if(oo){
            return oo
          }
        }
      }
    }
  },
  _getMouseOnParent:function(e,_pos){
    while(e.parentElement){
      var o=e.getBoundingClientRect()
      if(_pos.x>=o.left&&_pos.y>=o.top&&_pos.x<=o.right&&_pos.y<=o.bottom){
        return e
      }
      e=e.parentElement
    }
  },
  _getMouseXY:function(e) {
    if(!e.target){
      return {x:0,y:0};
    }
    var _posx = 0;
    var _posy = 0;
    var _doc=e.target.ownerDocument;
    if (e.pageX || e.pageY)   {
      _posx = e.pageX;
      _posy = e.pageY;
    }else if (e.clientX || e.clientY)   {
      _posx = e.clientX;
      _posy = e.clientY;
    }
    _posx -= _doc.scrollingElement.scrollLeft;
    _posy -= _doc.scrollingElement.scrollTop;
    return {x:_posx,y:_posy};
  },
  _convertObj:function(v){
    if(!v){
      return v;
    }
    v=JSON.stringify(v);
    v=_compressJSON._convertToEntities(v);
    return JSON.parse(v);
  },
  _unConvertObj:function(v){
    if(!v){
      return v;
    }
    v=JSON.stringify(v);
    v=_compressJSON._unConvert(v);
    return JSON.parse(v);
  },
  _chkExistDataAttr:function(d,as){
    as.find(a=>{
      if(d[a]){
        if(d[a].constructor==Array){
          return d[a].length
        }else if(d[a].constructor==Object){
          return Object.keys(d[a]).length
        }
        return 1
      }
    })
  },
  _getDomSize:function(_dom){
    var _tmp=false;
    if(!_dom.parentElement){
      _tmp=$("<div></div>").appendTo(document.body)
      $(_dom).appendTo(_tmp);
    }
    var _size={_width:_dom.offsetWidth,_height:_dom.offsetHeight};
    if(_tmp){
      $(_tmp).remove();
    }
    return _size;
  },
  _isNumber:function(v){
    try{
      if(!isNaN(parseFloat(v))){
        return v+""==parseFloat(v)+"";
      }
    }catch(e){
    }
    return false;
  },
  _getScreenXYByClientXY:function(w,x,y){
    x+=4;
    y+=54;
    return {x:x,y:y};
  },
  _getSouElementFromEvent:function(_event,_window){
    if(!_event){
      _event=_window.event;
    }
    if(_event){
      if(_event.srcElement){
        return _event.srcElement;
      }else{
        return _event.target;
      }
    }
    return null;
  },
  _formatInnerText:function(v){
    v=v.replace("\r","\n");
    var vs=v.split("\n");
    var rv="";
    for(var i=0;i<vs.length;i++){
      v=this._replaceAll(vs[i].trim(),/  /g," ");
      if (v) {
        rv+=v+"\n";
      }
    }
    return rv.trim();
  },
  _replaceLast:function(w,r,s){
    if(s=="."){
      s="\\."
    }
    return w.replace(new RegExp(s+"[^"+s+"]+$"),r)
  },
  _replaceAll:function(w,r,v){
    return w.split(r).join(v)
  },
  _isFunIgnoreInBrowser:function(n){
    for(var i=0;i<n.length;i++){
      if(_Util._checkBrowserType().name.includes(n)){
        return 1
      }
    }
  },
  _checkBrowserType:function(){
    var ua= navigator.userAgent, tem,
    M= ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
    if(/trident/i.test(M[1])){
        tem=  /\brv[ :]+(\d+)/g.exec(ua) || [];
        return {name:"ie",version:(tem[1] || "")};
    }
    if(M[1]=== "Chrome"){
        tem= ua.match(/\b(OPR|Edge)\/(\d+)/);
        if(tem!= null) return {name:tem.slice(1).join(" ").replace("OPR", "Opera")};
    }
    M= M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, "-?"];
    if((tem= ua.match(/version\/(\d+)/i))!= null) M.splice(1, 1, tem[1]);
    return {name:M[0],version:M[1],letterWidth:M[0]=="firefox"?9:8};
  },
  _addCSSRule:function(v){
    let ss=document.styleSheets;
    for(let i=0;i<ss.length;i++){
      try{
        let s=ss[i];
      
        s.insertRule(v)
        return
      }catch(ex){}
    }
  },
  _removeCSSRule:function(v){
    let ss=document.styleSheets;
    for(let i=0;i<ss.length;i++){
      try{
        let s=ss[i];
        for(let j=0;j<s.cssRules.length;j++){
          if(s.cssRules[j].cssText==v){
            s.deleteRule(j)
            return
          }
        }
      }catch(ex){}
    }

  },
  _downloadFile:function(_name,_content,_type){
    _content=_content||""
    if(_Util._isObjOrArray(_content)){
      _content=JSON.stringify(_content,0,2)
    }
    _content=_content.toString();
    
    if(_Util._checkBrowserType().name=="ie"){
      var blobObject = new Blob([_content],_type?{type:_type}:undefined); 
      
      window.navigator.msSaveBlob(blobObject, _name);
    }else{
      var a=$("<a></a>");
      $(document.body).append(a[0]);
      a.attr("download",_name).attr("href","data:application/octet-stream," + encodeURIComponent(_content))[0].click();
      a.remove();
    }
  },
  _downloadAsHtmlFile:function(_name,_content){
    if(!_content.startsWith("<!DOCTYPE html>")){
      _content="<!DOCTYPE html><html><header><meta http-equiv='Content-Type' content='text/html; charset=UTF-8'></header><body>"+_content+"</body></html>"
    }
    if(_Util._checkBrowserType().name=="ie"){
      var blobObject = new Blob([_content]); 
      
      window.navigator.msSaveBlob(blobObject, _name);
    }else{
      var a=$("<a></a>");
      $(document.body).append(a[0]);
      a.attr("download",_name).attr("href","data:application/octet-stream," + encodeURIComponent(_content))[0].click();
      a.remove();
    }
  },
  //w: doc content 
  //n: file name
  _downloadAsWordFile:function(_name,_content){
    let w1="http:/"+"/schemas.microsoft.com/office/2004/12/omml"
    let w2="http:/"+"/www.w3.org/TR/REC-html40"
    let _sourceHTML = `<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns:m="${w1}" xmlns="${w2}">

      <head>
          <!--[if gte mso 9]><xml><w:WordDocument><w:View>Print</w:View><w:TrackMoves>false</w:TrackMoves><w:TrackFormatting/><w:ValidateAgainstSchemas/><w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid><w:IgnoreMixedContent>false</w:IgnoreMixedContent><w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText><w:DoNotPromoteQF/><w:LidThemeOther>EN-US</w:LidThemeOther><w:LidThemeAsian>ZH-CN</w:LidThemeAsian><w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript><w:Compatibility><w:BreakWrappedTables/><w:SnapToGridInCell/><w:WrapTextWithPunct/><w:UseAsianBreakRules/><w:DontGrowAutofit/><w:SplitPgBreakAndParaMark/><w:DontVertAlignCellWithSp/><w:DontBreakConstrainedForcedTables/><w:DontVertAlignInTxbx/><w:Word11KerningPairs/><w:CachedColBalance/><w:UseFELayout/></w:Compatibility><w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel><m:mathPr><m:mathFont m:val="Cambria Math"/><m:brkBin m:val="before"/><m:brkBinSub m:val="--"/><m:smallFrac m:val="off"/><m:dispDef/><m:lMargin m:val="0"/> <m:rMargin m:val="0"/><m:defJc m:val="centerGroup"/><m:wrapIndent m:val="1440"/><m:intLim m:val="subSup"/><m:naryLim m:val="undOvr"/></m:mathPr></w:WordDocument></xml><![endif]-->

          <meta charset='utf-8'/>
          <title>${_name}</title>
          <style>
          @page {
            size: 4in 6in landscape;
          }
          @media print {
            html, body {
              width: 210mm;height: 297mm;
            }
          }
          page[size="A4"] {
            background: white;
            width: 21cm;
            height: 29.7cm;
            display: block;
            margin: 0 auto;
            margin-bottom: 0.5cm;
            box-shadow: 0 0 0.5cm rgba(0,0,0,0.5);
          }
tbody td:first-child,tbody td:last-child{
  text-align:center;
}
          </style>
      </head>
      <body>${_content}</body></html>`;
     
     var source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(_sourceHTML);
     var _fileDownload = document.createElement("a");
     document.body.appendChild(_fileDownload);
     _fileDownload.href = source;
     _fileDownload.download = _name;
     _fileDownload.click();
     document.body.removeChild(_fileDownload);
  },
  _downloadAsPdfFile:function(title,o) {
    let w= window.open('', 'PRINT', 'height=650,width=900,top=100,left=150');
    let d=w.document,
        _txt=`<html><head><title>${title}</title></head><body>${o}</body></html>`;
    d.write(_txt);

    d.close(); // necessary for IE >= 10
    w.focus(); // necessary for IE >= 10
    setTimeout(function(){
      w.print();
      w.close();
    },100)

    return true;
  },
  _downloadAsZip:function(_files,_zipFileName,_fun){
    zip.createWriter(new zip.BlobWriter("application/zip"), function(_zipWriter) {
      _addFile(_zipWriter,0)
    }, function(_msg){
      alert(_msg)
    });

    function _addFile(_zipWriter,i){
      let f=_files[i]
      if(f){
        _zipWriter.add(f._name, new zip.BlobReader(f._data), function() {
          _addFile(_zipWriter,i+1)
        });
      }else{
        _zipWriter.close(function(blob) {
					var blobURL =URL.createObjectURL(blob);
          var _clickEvent = document.createEvent("MouseEvent");
          _clickEvent.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
          let _downloadButton=$("<a></a>").appendTo(document.body)[0]
          
          _downloadButton.href = blobURL;
          _downloadButton.download = _zipFileName;
          _downloadButton.dispatchEvent(_clickEvent);
					zipWriter = null;
          $(_downloadButton).remove()
				});
      }
    }
  },
  _getDomsByTagAndName:function(tag,name){
    if(BZ._autoRecording){
      return []
    }
    return $(tag+"[name='"+name+"']").toArray()
  },
  _removeAllLinkTarget:function(){
    $("A").toArray().forEach(a=>{
      _Util._removeLinkTarget(a)
    })
  },
  _setUrlFileToInput:function(_url,e,_fun){
    _Util._getFileFromUrl(_url,function(v){
      $util.triggerChangeEvent(e,v,1,0,0,0,_fun);
    })
  },
  _getFileFromUrl:function(_url,_fun){
    if(_url.match(/^[\/]?example\..+$/)){
      _url="http:"+SERVER_HOST.replace(/^https?:/,"")+"/file/"+_url.replace("/","")
    }else{
      _url=_url.replace("/"+"/www.dropbox.com/","/"+"/dl.dropbox.com/");
    }
    if(!_url.match(/^http/)){
      _url=location.protocol+_url
    }
    bzComm.postToBackground({
      scope:"bgUtil",
      fun:"ajax",
      ps:[{url:_url,method:"GET",responseType:'arraybuffer'}],
      return:_fun
    })
  },
  _isFileData:function(v){
    try{
      if(v && v.constructor==String){
        v=JSON.parse(v)[0]
      }
      return v.base64Link
    }catch(e){}
  },
  _removeLinkTarget:function(e){
    while(e){
      if(e.tagName=="A"){
        if($(".BZIgnore").find(e)[0]){
          return
        }
        var _target=$(e).attr("target");
        if(_target){
          if(!_target.match(/^_(parent|self|top)$/)&&!bzComm._getIframeByAttr("uId",_target)){
            $(e).attr("target","_"+"self")
          }
        }else{
          $(e).attr("target","_"+"self")
        }
      }
      if(e!=e.parentElement){
        e=e.parentElement;
      }else{
        return;
      }
    }
  },
  _toKey:function(v){
    v= v?v.replace(/[^a-zA-Z0-9_.]/g,"_"):"";
    if(v && v.match(/^[0-9.]/)){
      v="_"+v;
    }
    while(v.indexOf("..")>=0){
      v=v.replace("..",".");
    }
    if(v && v[v.length-1]=="."){
      v=v.substring(0,v.length-1);
    }
    return v.toLowerCase();
  },
  /*
  _formatPeriod:function(v){
    v=parseInt(v/1000);
    var h=parseInt(v/3600);
    v-=h*3600;
    var m=parseInt(v/60);
    v-=m*60;
    
    m=m<10?"0"+m:m;
    v=v<10?"0"+v:v;
    return h?h+":"+m+":"+v:parseInt(m)?parseInt(m)+":"+v:parseInt(v)+" s";
  },
  */
  _formatNumberLength:function(v,l){
    return (v+"").padStart(l||2,0);
  },
  _getAngularModelAttr:function(o){
    var _tmp=null;
    var _curWin=_Util._getWindowFromDom(o);
    if(_curWin.angular){
      var _scope=_curWin.angular.element(o).scope();
      if(_scope){
        for(var n=0;n<o.attributes.length;n++){
          var a=o.attributes[n];
          try{
            var _model=a.value.split(".");
            var _variable=_scope;
            for(var x=0;x<_model.length;x++){
              _variable=_variable[_model[x]];
            }
            if(_variable!=undefined || x>1){
              _tmp= a;
              if(a.name.indexOf("-model")>=0){
                break;
              }
            }
          }catch(e){}
        }
      }
    }
    return _tmp;
  },
  _retrieveFileName:function(v){
    v=v.replace(/[^-_ a-zA-Z0-9]/g,"\t").trim();
    v=v.split("\t");
    return v[v.length-2];
  },
  _retrieveCssProperty:function(e,_extra,_name){
    return window.getComputedStyle(e,_extra).getPropertyValue(_name);
  },
  _retrieveCssProperties:function(e,_extra,_names){
    if(_extra==true){
      _extra=":before"
    }else if(_extra){
      _extra=":after"
    }
    var c=window.getComputedStyle(e,_extra);
    var vs=[];
    for(var i=0;i<_names.length;i++){
      vs.push(c.getPropertyValue(_names[i]));
    }
    if(!_extra || _extra==":after"){
      return vs;
    }else{
      return vs.concat(this._retrieveCssProperties(e,_extra,_names));
    }
  },
  _pickAttrFromArray:function(vs,_name){
    var ps=[];
    for(var i=0;i<vs.length;i++){
      ps.push(vs[i][_name]);
    }
    return ps;
  },
  _getRealWord:function(o,v){
    if(o.maxLength<0){
      return v;
    }else{
      return v.substring(0,o.maxLength);
    }
  },
  _buildRefPath:function(n,k){
    var m=k.match(/[a-z_$][a-z0-9_$]*/i);
    if(m && m[0]==k){
      return n+"."+k;
    }else{
      return n+"['"+k+"']";
    }
  },
  _pickValuePath:function(d,_name){
    var ps=[];
    _name=_name||"";
    for(var k in d){
      var v=d[k];
      if(v){
        if(v.constructor==Object){
          ps.concat(this._pickObjPath(v,_name+"."+k))
        }else if(v.constructor==Array){
          
        }else{
          ps.push(_name+"['"+k+"']")
        }
      }
    }
    return ps;
  },
  _toSBC:function(v){
    var s = "",_len = (v||"").length;
    for(var i=0;i<_len;i++){
        var c = v.charCodeAt(i);
        if("“”".includes(v[i])){
          c=34;
        }else if("‘’".includes(v[i])){
          c=39;
        }
        c = (c>=0xFF01 && c<=0xFF5E)?(c - 65248) : c;
        c = (c==0x03000)?0x0020:c;
        s += String.fromCharCode(c);
    }
    return s;
  },
  _cleanObj:function(o){
    if(o){
      for(let k in o){
        delete o[k]
      }
    }
  },
  _cleanArray:function(vs){
    var v="";
    if(vs){
      for(var i=0;i<vs.length;i++){
        var v=vs[i].trim();
        if(v){
          vs[i]=v;
        }else{
          vs.splice(i,1)
        }
      }
    }
    return vs;
  },
  _clearEmptyAttr:function(o){
    let ks=Object.keys(o);
    ks.forEach(k=>{
      if(!o[k]&&o[k]!==0){
        delete o[k];
      }else if(_Util._isObjOrArray(o[k])){
        this._clearEmptyAttr(o[k])
      }
    })
  },
  _getAttributeCss:function(e,v,bv){
    if(!e.attributes){
      return ""
    }
    var o;
    for(var i=0;i<e.attributes.length;i++){
      var a=e.attributes[i];
      
      if(a.value.trim() && (!v || a.value.toLowerCase().includes(v.toLowerCase()))){
        var n=a.name.toLowerCase();
        if(n.match(/title|label/)){
          o=a;
          break;
        }else if(n.includes("alt")){
          o=a;
        }else if(n=="placeholder" && !o){
          o=a;
        }else if(n=="name" && !o){
          o=a;
        }
      }
    }
    if(o && !v){
      v=o.value.split("\n")[0].trim().substring(0,50)
    }else if(o && bv){
      v=bv;
    }
    return o && v?_Util._getAttrPath(o.name,v):""
  },
  _getDataPathByValue:function(d,v){
    var r,t;
    for(var k in d){
      t=d[k];
      if([Object].includes(t.constructor)){
        r=this._getDataPathByValue(t,v);
        if(r){
          return k+"."+r
        }
      }else if(t==v){
        return k;
      }
    }
  },
  _getAllVisableElements:function(){
    let hs=[]
    let os=($(document.body).find("*").toArray().filter(x=>{
      if(["file","checkbox","radio"].includes(x.type)){
        return 1
      }
      let r=x.getBoundingClientRect()
      if(r.width&&r.height&&$(x).css("visibility")!="hidden"&&$(x).css("opacity")!=0){
        if(r.left+r.width>0&&r.top+r.height>0){
          return 1
        }else{
          let p=$(x).css("position")
          if(p=="fixed"||p=="absolute"){
            hs.push(p)
            return
          }else{
            return !$(hs).find(p)[0]
          }
        }
      }
      //&&!$(x).hasClass("BZIgnore")//&&!bs.has(x)
    }));
    return os
  },
  _clearPreEventElements:function(){
    delete _Util.preEventElements
  },
  _getAllVisableElementsInJQ:function(){
    return $(_Util._getAllVisableElements())
  },
  _preTriggerEvent:function(){
    _Util.preEventElements=new Set(_Util._getAllVisableElements())
  },
  _getDiffAfterTriggerEvent:function(_continuePreTriggerEvent,_keepPreEventElements){
    let os=_Util._getAllVisableElements();
    let ps=_Util.preEventElements

    if(_continuePreTriggerEvent){
      if(!_keepPreEventElements||!ps){
        _Util.preEventElements=new Set(os)
      }
    }else{
      delete _Util.preEventElements
    }
    if(ps){
      os=os.filter(x=>!ps.has(x))
    }else{
      return []
    }
    return os
  },
  _clickToHidden:function(o,_fun){
    _Util._preTriggerEvent()
    $util.triggerMouseEvents(o,1,0,0,0,0,0,function(){
      setTimeout(function(){
        if(_Util._getHiddenAfterTriggerEvent(1).length){
          _fun&&_fun()
        }else if(o.parentElement){
          _Util._clickToHidden(o.parentElement,_fun)
        }else{
          _fun&&_fun()
        }
      },50)
    })
  },
  _getHiddenAfterTriggerEvent:function(_continuePreTriggerEvent){
    let os=new Set(_Util._getAllVisableElements())
    let ps=[..._Util.preEventElements]

    if(_continuePreTriggerEvent){
      _Util.preEventElements=new Set(os)
    }else{
      delete _Util.preEventElements
    }
    return ps.filter(x=>!os.has(x))
  },
  _findElementAfterChange:function(_inputList,v,_findTargetFun,_fun){
    _Util._preTriggerEvent()
    _changeElement(_clickList)
    function _changeElement(os){
      let o=os.shift()
      if(o){
        $util.triggerChangeEvent(o,v,0,0,0,0,function(){
          _foundElement(function(o){
            if(o){
              _fun(o)
            }else{
              _changeElement(os)
            }
          },0)
        })
      }else{
        _fun()
      }
    }


    function _foundElement(_fun,_wait){
      let os=_Util._getDiffAfterTriggerEvent(1)
      os=_findTargetFun(os)
      
      if(os.length){
        _fun(os)
      }else if((TWHandler._curRequestList||[]).length&&_wait<30){
        setTimeout(function(){
          _foundElement(_fun,_wait+1)
        },100)
      }else if(!_wait){
        setTimeout(function(){
          _foundElement(_fun,1)
        },100)
      }else{
        _fun()
      }
    }
  },
  _buildDateRegex:function(){
    if(!_Util._mmmm&&_IDE._data._setting){
      _Util._mmmm={}
      _IDE._data._setting.MMMM.split(",").map(x=>x.trim().toLowerCase()).forEach((x,i)=>{
        _Util._mmmm[x]=i+1
      })
      _Util._mmm={}
      _IDE._data._setting.MMM.split(",").map(x=>x.trim().toLowerCase()).forEach((x,i)=>{
        _Util._mmm[x]=i+1
      })
      let y="([0-9]{4})",
          d="([0-9]{1,2})",
          mm=Object.keys(_Util._mmmm).join("|")+"|"+Object.keys(_Util._mmm).join("|"),
          m="("+mm+"|[0-9]{1,2})",
          s=" ?[\\/\\-., ] ?"
          
      _Util._ymdRegex=new RegExp(`${y} ?[年\\/\\-., ] ?${m} ?[月\\/\\-,. ] ?${d}`,"i")
      _Util._ymdRegexAll=new RegExp(`${y} ?[年\\/\\-., ] ?${m} ?[月\\/\\-,. ] ?${d}`,"ig")
      if(_IDE._data._setting.mdParser=="mdy"){
        _Util._mdyRegex=new RegExp(`${m}${s}${d}${s}${y}`,"i")
        _Util._mdyRegexAll=new RegExp(`${m}${s}${d}${s}${y}`,"ig")
        _Util._mdRegex=new RegExp(`(${mm})${s}${d}`,"i")
        _Util._mdRegexAll=new RegExp(`(${mm})${s}${d}`,"ig")
      }else{
        _Util._mdyRegex=new RegExp(`${d}${s}${m}${s}${y}`,"i")
        _Util._mdyRegexAll=new RegExp(`${d}${s}${m}${s}${y}`,"ig")
        _Util._mdRegex=new RegExp(`${d}${s}(${mm})`,"i")
        _Util._mdRegexAll=new RegExp(`${d}${s}(${mm})`,"ig")
      }
    }
  },
  _findDateString:function(v){
    if(v&&v.constructor==String){
      _Util._buildDateRegex()
      return v.match(_Util._ymdRegexAll)||v.match(_Util._mdyRegexAll)||v.match(_Util._mdRegexAll)||[]
    }
  },
  _findDateFromString:function(v){
    return (_Util._findDateString(v)).filter(x=>x).map(x=>{
      return {d:_Util._toDate(x),v:x}
    })
  },
  _isDateValue:function(v){
    if(v){
      if(v.constructor==Date){
        return v
      }else if(v.constructor==String){
        return _Util._findDateString(v)[0]==v
      }
    }
  },
  _toDate:function(d){
    if(d){
      if(d instanceof Date){
        return d
      }else if(d.constructor==String){
        let y,m,dd,cd=new Date();
        d=d.split(/[ -.,\/年月日号]+/).map(x=>parseInt(x)||x)
        d.find((x,i)=>{
          if(x>31){
            y=x
            d.splice(i,1)
            return 1
          }
        })
        y=y||cd.getFullYear();
        d.find((x,i)=>{
          if(!$.isNumeric(x)){
            m=x
            d.splice(i,1)
            return 1
          }else if(x>12){
            dd=x
            d.splice(i,1)
            return 1
          }
        })

        if(d.length==1){
          if(m){
            dd=d[0]
          }else{
            m=d[0]
          }
        }else if(d.length){
          if(_IDE._data._curVersion.setting.mdParser=="dmy"){
            dd=d[0]
            m=d[1]
          }else{
            dd=d[1]
            m=d[0]
          }
        }
        return new Date(y+"/"+m+"/"+dd)
      }
    }
  },
  _findElementAfterClick:function(_clickList,_doWait,_findTargetFun,_fun){
    _Util._preTriggerEvent()
    _clickElement(_clickList)
    function _clickElement(os){
      let o=os.shift()
      if(o){
        $util.triggerMouseEvents(o,1,0,0,0,0,0,function(){
          setTimeout(()=>{
            _foundElement(function(o){
              if(o){
                _fun(o)
              }else{
                _clickElement(os)
              }
            },0)
          },250)
        })
      }else{
        _fun([])
      }
    }


    function _foundElement(_fun,_wait){
      let os=_Util._getDiffAfterTriggerEvent(1)
      os=_findTargetFun(os)
      
      if(os.length){
        _fun(os)
      }else if((TWHandler._curRequestList||[]).length&&_wait<30){
        setTimeout(function(){
          _foundElement(_fun,_wait+1)
        },100)
      }else if(!_wait&&_doWait){
        setTimeout(function(){
          _foundElement(_fun,1)
        },100)
      }else{
        _fun()
      }
    }
  },
  _getNewPanelFromNewElements:function(os){
    return os.find(o=>{
      return $(o).find(os).length>os.length/2
    })
  },
  _removeEndSign:function(v){
    var w="";
    for(var i=0;i<v.length;i++){
      var vv=v[i];
      var x=this._removeSign(vv,"");
      if(x){
        v=v.substring(i)
        break;
      }
    }
    if(i==v.length){
      return v;
    }
    for(var i=v.length-1;i>=0;i--){
      var vv=v[i];
      var x=this._removeSign(vv,"");
      if(x){
        v=v.substring(0,i+1);
        break;
      }
    }
    return v;
  },
  //v: words, it will be handle
  //r: replace word
  //k: keep sign
  //like: _removeSign("abc,xyz-网站  é#è&^êë"," ","-") --> "abc xyz-网站 é è  êë"
  _removeSign:function(v,r,k,_removeUnderscroe){
    r=r||"";
    k=k||"";
    v=this._toSBC(v);
    v= v.replace(/[^\wÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC\s$-]/g,r); 
    if(_removeUnderscroe){
      v=v.replace("_",r)
    }
    if(!k.includes("-")){
      v=v.replace(/\-/g,r)
    }
    if(!k.includes("$")){
      v=v.replace(/\$/g,r)
    }
    if(!k.includes(" ")&&r!=" "){
      v=v.replace(/ /g,r)
    }
    
    if(r==" "){
      v=v.replace(/\s+/g,r)
    }

    return v.trim()
  },
  //output function code
  _toString:function(os,n,_mini){
    var s="{";
    for(var k in os){
      var o=os[k];
      s+=k+":"
      if(!o){
        s+=o;
      }else if(o.constructor==Function){
        s+=o.toString()
      }else{
        try{
          s+=JSON.stringify(o)
        }catch(e){
          throw e;
        }
      }
      s+=","
    }
    s=s.substring(0,s.length-1)+"};";
    if(_mini){
      s=_JSHandler._cleanCode(s)
    }
    if(n){
      s="var "+n+"="+s;
    }
    return s;
  },
  _setFun:function(o,e,f){
    o=$(window.document).find(o);
    for(var i=0;i<o.length;i++){
      o[i][e]=f;
    }
  },
  _shareArray:function(a1,a2){
    a1=a1||[];
    a2=a2||[];
    if(a1.constructor!=Array){
      a1=[a1];
    }
    if(a2.constructor!=Array){
      a2=[a2];
    }
    var a=[];
    a1.forEach(function(v){
      if(a2.includes(v)){
        a.push(v);
      }
    });
    return a;
  },
  //o: old data, n: new data
  //_ignore: ignore data function
  //p: data key path
  _getSimpleDiffInJson:function(o,n,_ignore,_diffs,p){
    _diffs=_diffs||[]
    p=p||""
    let _found,_mapIdx=[];
    if(o&&n&&o.constructor==n.constructor&&[Array,Object].includes(o.constructor)){
      if(o.constructor==Array){
        if(!o.length){
          if(n.length){
            _diffs.push({
              key:p,
              from:o,
              to:n
            })
          }
        }else if(!n.length){
          _diffs.push({
            key:p,
            from:o,
            to:n
          })
        }else if(o[0].code||o[0].key){
          if(o.length==n.length){
            o.forEach((x,i)=>{
              if(!n.find((y,yi)=>{
                if(_mapIdx.includes(yi)){
                  return
                }
                if((y.code&&y.code==x.code)||(y.key&&y.key==x.key)){
                  if(i!=yi){
                    _diffs.push({
                      key:p,
                      from:i,
                      to:yi,
                      order:1
                    })
                  }else{
                    _mapIdx.push(yi)
                    _Util._getSimpleDiffInJson(x,y,_ignore,_diffs,p+"."+i)
                  }
                  return 1
                }
              })){
                _diffs.push({
                  key:p+"."+i,
                  from:x
                })
              }
            })
          }else if(o.length>n.length){
            let ds=[]
            o.forEach((x,i)=>{
              if(!n.find((y,yi)=>{
                if(_mapIdx.includes(yi)){
                  return
                }
                if((y.code&&y.code==x.code)||(y.key&&y.key==x.key)){
                  _mapIdx.push(yi)
                  _Util._getSimpleDiffInJson(x,y,_ignore,ds,p+"."+i)
                  return 1
                }
              })){
                ds.push({
                  key:p+"."+i,
                  from:x
                })
              }
            })
            ds.reverse()
            _diffs.push(...ds)
          }else{
            let ds=[]
            n.forEach((x,i)=>{
              if(!o.find((y,yi)=>{
                if(_mapIdx.includes(yi)){
                  return
                }
                if((y.code&&y.code==x.code)||(y.key&&y.key==x.key)){
                  _mapIdx.push(yi)
                  _Util._getSimpleDiffInJson(y,x,_ignore,ds,p+"."+i)
                  return 1
                }
              })){
                ds.push({
                  key:p+"."+i,
                  to:x
                })
              }
            })
            ds.reverse()
            _diffs.push(...ds)
          }
        }else if(o.length!=n.length){
          let no=o[0]||n[0]
          if(!no.key||!no.code){
            _diffs.push({
              key:p,
              from:o,
              to:n
            })
          }else{
            let _dIdx=0
            if(o.length>n.length){
              for(let k in o){
                let ds=[]
                _Util._getSimpleDiffInJson(o[k],n[parseInt(k)+_dIdx],_ignore,ds,p+"."+k)
                if(ds.length){
                  _diffs.push({
                    key:p+"."+k,
                    from:o[k]
                  })
                  _dIdx++
                  if(o.length==n.length+_dIdx+1){
                    break
                  }
                }
              }
            }else{
              for(let k in n){
                let ds=[]
                _Util._getSimpleDiffInJson(n[k],o[parseInt(k)+_dIdx],_ignore,ds,p+"."+k)
                if(ds.length){
                  _diffs.push({
                    key:p+"."+k,
                    to:n[k]
                  })
                  _dIdx++
                  if(o.length==n.length+_dIdx+1){
                    break
                  }
                }
              }
            }
          }
        }else{
          o.forEach((x,i)=>{
            _Util._getSimpleDiffInJson(x,n[i],_ignore,_diffs,p+"."+i)
          })
        }
      }else{
        for(let k in n){
          if(_ignore&&_ignore(k,p,o[k],n[k])){
            continue
          }
          _Util._getSimpleDiffInJson(o[k],n[k],_ignore,_diffs,p+"."+k)
        }
        for(let k in o){
          if(_ignore&&_ignore(k,p,n[k],o[k])){
            continue
          }
          if(!Object.keys(n).includes(k)){
            _diffs.push({
              key:p+"."+k,
              from:o[k]
            })
          }
        }
      }
    }else if(o!=n){
      _diffs.push({
        key:p,
        from:o,
        to:n
      })
    }
    return _diffs
  },
  _formatDiffJson:function(v1,v2,s,_csv){
    let w1="",w2="";
    s=s||""
    let ss=s+"  "

    if(v1&&v2&&v1.constructor==v2.constructor){
      if(v1.constructor==Object){
        w1+="{\n";w2+="{\n";
      }else if(v1.constructor==Array){
        w1+="[\n";w2+="[\n";
      }else{
        if(_csv){
          let v=_ideDiff._compareCSV(v1,v2,1)
          v1=v.fh+"\n";
          v2=v.th+"\n";
        }else{
          if(!_Util._isJsonValueString(v1)){
            v1=JSON.stringify(v1);
          }
          if(!_Util._isJsonValueString(v2)){
            v2=JSON.stringify(v2);
          }
  
          if(v1!==v2){
            if(v1&&v1.constructor==String&&v2&&v2.constructor==String){
              let w1=v1.split("\n"),
                  w2=v2.split("\n"),
                  _switch;
              if(w1.length==w2.length&&w1.length==1){
                w1=v1.split(/\\n/)
                w2=v2.split(/\\n/)
              }
              let r1=w1,
                  r2=w2
  
              if(w1.length<w2.length){
                _switch=1
                r1=w2
                r2=w1
                w1=r1
                w2=r2
              }
  
              r1.forEach((w,i)=>{
                let ww=w2[i]
                if(ww!=w){
                  r1[i]=_highlight(w);
                  r2[i]=_highlight(ww||"");
                }else{
                  r1[i]=w;
                  r2[i]=ww||"";
                }
              })
  
              v2=r2=r2.join("\n")
              v1=r1=r1.join("\n")
              if(_switch){
                v1=r2
                v2=r1
              }
            }else{
              v1=_highlight(v1);
              v2=_highlight(v2);
            }
          }
        }

        return {w1:v1,w2:v2}
      }
      Object.keys(v1).forEach(k=>{
        if(v1[k]!==undefined){
          let v;
          if(_csv&&k=="value"&&"cm".includes(v1.type)){
            v=_ideDiff._compareCSV(v1[k],v2[k],1)
            w1+=v.fh+"\n";
            w2+=v.th+"\n";
          }else{
            v=_Util._formatDiffJson(v1[k],v2[k],ss)
            w1+=ss;
            w2+=ss;
            if(v1.constructor==Object){
              w1+='"'+k+'": '
              w2+='"'+k+'": '
            }
            w1+=v.w1+",\n";
            w2+=v.w2+",\n";
          }
          w1=_addLine(w1,w2);
          w2=_addLine(w2,w1);
        }
      })
      Object.keys(v2).forEach(k=>{
        if(v1[k]===undefined){
          let v=_Util._formatDiffJson(v1[k],v2[k],ss)
          w1+=ss;
          w2+=ss;
          if(v1.constructor==Object){
            w1+='"'+k+'": '
            w2+='"'+k+'": '
          }
          w1+=v.w1+",\n";
          w2+=v.w2+",\n";
          w1=_addLine(w1,w2);
          w2=_addLine(w2,w1);
        }
      })
      w1=w1.replace(/(,)(\n*)$/,"$2")
      w2=w2.replace(/(,)(\n*)$/,"$2")
      w1+=s;
      w2+=s;
      if(v1.constructor==Object){
        w1+="}";
        w2+="}";
      }else{
        w1+="]";
        w2+="]";
      }
    }else{
      w1=_formatJsonWithIndent(v1,ss);
      w2=_formatJsonWithIndent(v2,ss);
      if(v1!==v2){
        w1=_highlight(w1);
        w2=_highlight(w2);
      }
    }
    return {w1:w1,w2:w2}

    function _addLine(w1,w2){
      return w1+"\n".repeat(Math.max(w2.split("\n").length-w1.split("\n").length,0))
    }

    function _highlight(v){
      return `<span class="bz-diff-item">${v}</span>`
    }
    function _formatJsonWithIndent(v,s){
      v=JSON.stringify(v,0,2)||""
      return v.replace(/^/gm,s).trim()
    }

  },
  _strToObj:function(vv){
    let v=vv||""
    if(v.constructor==String){
      v=v.trim()
      if(v.match(/(^\[.*\]$)|(^\{.*\}$)/s)){
        try{
          v=eval("v="+v)
          return v
        }catch(e){}
      }
    }
    return vv
  },
  _getDiffArray:function(a1,a2){
    var vs=[]
    for(var i=0;i<a1.length;i++){
      if(!a2.includes(a1[i])){
        vs.push(a1[i])
      }
    }
    for(var i=0;i<a2.length;i++){
      if(!a1.includes(a2[i])){
        vs.push(a2[i])
      }
    }
    return vs;
  },
  fetchBlob:function(uri, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', uri, true);
    xhr.responseType = 'arraybuffer';

    xhr.onload = function(e) {
      if (_Util._isAPISucessStatus(this.status)) {
        var blob = this.response;
        if (callback) {
          callback(blob);
        }
      }
    };
    xhr.send();
  },
  _mergeURL:function(r,_url){
    _url= _url||"";
    r=r.trim()
    if(r && !_url.startsWith(r) && !_url.startsWith("http") && !_url.startsWith("/"+"/")){
      if(!_url){
        _url=r
      }else if(r.endsWith("/") && _url[0]=="/"){
        _url=r+_url.substring(1);
      }else if(!r.endsWith("/") && _url[0]!="/"){
        _url=r+"/"+_url;
      }else{
        _url=r+_url;
      }
    }
    return _url
  },
  _mergeDeep:function(_target, ..._sources) {
    if (!_sources.length) return _target;
    const _source = _sources.shift();

    if ((_target&&_target.constructor==Object) && (_source&&_source.constructor==Object)) {
      for (const _key in _source) {
        var o=_source[_key]
        if (o&&o.constructor==Object) {
          if(!_target[_key]||_target[_key].constructor!=Object){
            _target[_key]={}
          }
          _Util._mergeDeep(_target[_key], _source[_key]);
        } else if(!_target[_key]||_target[_key].constructor!=Function){
          _target[_key]=_source[_key];
        }
      }
    }

    return _Util._mergeDeep(_target, ..._sources);
  },
  _mergeDeepWithArray:function(_target, ..._sources) {
    if (!_sources.length) return _target;
    const _source = _sources.shift();

    if ((_target&&_target.constructor==Object) && (_source&&_source.constructor==Object)) {
      for (const _key in _source) {
        var o=_source[_key]
        if(o&&o.constructor==Array&&_target[_key]&&_target[_key].constructor==Array){
          _target[_key].push(...o)
        }else if (o&&o.constructor==Object) {
          if(!_target[_key]||_target[_key].constructor!=Object){
            _target[_key]={}
          }
          _Util._mergeDeepWithArray(_target[_key], _source[_key]);
        } else if(!_target[_key]||_target[_key].constructor!=Function){
          _target[_key]=_source[_key];
        }
      }
    }

    return _Util._mergeDeepWithArray(_target, ..._sources);
  },
  _clearAttributes:function(o){
    for(var k in o){
      if(!o[k]){
        delete o[k]
      }
    }
  },
  _findInInsensitive:function(r,p,_tmpPanel){
    try{
      if(_tmpPanel&&_tmpPanel.includes("BZ.TW")){
        _tmpPanel=0
      }
      return r&&r.find(p,_tmpPanel)
    }catch(e){
      _domActionTask._reportAppInfo("Error on findInInsensitive: "+e.message)
      return r.find(_Util._updateAttrSelector(p))
    }
  },
  _getAttrPath:function(n,v){
    return ":attr("+n+"="+_Util._trimSpace(v.replace(/[\(\)\{\}\[\]]/g," "))+")"
  },
  _updateAttrSelector:function(v){
    return v.replace?v.replace(/(\[)([^=]+)(\=)([\"\']*)([^\]\"\']+)([\"\']*)( *)(i*)(\])/g,":attr($2$3$5)"):v
  },
  _getElementByXY:function(b,x,y,_ignoreElement){
    var _last;
    for(var i=0;i<b.children.length;i++){
      var o=b.children[i];
      var r=o.getBoundingClientRect();
      if(r.x<=x && r.x+r.width>=x && r.y<=y && r.y+r.height>=y){
        if(o!=_ignoreElement){
          _last=o;
        }
      }
      _last=this._getElementByXY(o,x,y,_ignoreElement)||_last;
    }
    return _last;
  },
  _isBetweenWords:function(w,i){
    if(w){
      if(i){
        w=w[0]
      }else{
        w=w[w.length-1]
      }
      return !w.match(/[a-z0-9]/i)
    }
    return 1
  },
  _splitWords:function(w,s){
    w=w.trim()
    s=s||"\n;,"
    for(var i=0;i<s.length;i++){
      if(w.includes(s[i])){
        s= w.split(s[i]);
        w=[]
        for(var i=0;i<s.length;i++){
          var ss=s[i].trim()
          if(ss){
            w.push(s)
          }
        }
        return w
      }
    }
    return [w]
  },
  _isDynamicValue:function(v){
    v=v.match(/[0-9]+/g);
    return !(!v || (v.length==1 && parseInt(v[0])<3))
  },
  _setBlankIFramePath:function(p,e){
    if(e.ownerDocument!=document){
      for(var i=0;i<window.frames.length;i++){
        if(window.frames[i]==e.ownerDocument.defaultView){
          p[0]="$(BZ.TW.document.body).find('IFRAME:eq("+i+")')[0].contentDocument"
        }
      }
    }
  },
  _findDomsWithSimplySolution:function(ps){
    let o=document.body,os,_lastX;
    try{
      ps.find(x=>{
        x=x||0
        if(x!="BZ.TW.document"){
          if(os&&os.toArray()){
            os=os.toArray()
            _Util._spliceAll(os,x=>_Util._isHidden(x))
            os=$(os)
          }
          if(os===undefined){
            if(x.match(/^body\>/i)){
              o=document
            }
            let xs=_matchTRTD(x,$(BZ.TW.document.body))
            if(xs){
              os=xs
              _lastX=x
              return
            }
            os=$(o).find(x)
          }else if(x&&!$.isNumeric(x)){
            let xos=[],_idx
            
            let xs=_matchTRTD(x,os)
            if(xs){
              os=xs
              _lastX=x
              return
            }
            if(x.match(/\:(eq\([0-9]+\)|last|first)$/)){
              x=x.split(":")
              _idx=x.pop()
              x=x.join(":")
            }
            if(_lastX.match(/contains/i)){
              os=os.toArray()
              let rs=[]
              while(os.length){
                let oo=os.pop();
                rs.push(oo)
                let xo=$(oo).find(x).toArray()
                if(xo.length){
                  xo.reverse()
                  xo.forEach(y=>{
                    xos.unshift(y)
                  })

                  _Util._spliceAll(os,xx=>$(xx).find(oo).length)
                }
              }
              while(!xos.length&&rs.length&&rs[0]&&rs[0].tagName!="BODY"){
                rs=rs.map(r=>r.parentElement)
                rs.forEach(r=>{
                  if(r){
                    let xo=$(r).find(x)
                    if(xo.length){
                      xo.reverse()
                      xo.forEach(y=>{
                        xos.unshift(y)
                      })
                    }
                  }
                })
              }
              os=$(xos)
            }else{
              os=os.find(x,os)
            }
            if(os.length){
              if(_idx=="first"){
                os=[os[0]]
              }else if(_idx=="last"){
                os=[os[os.length-1]]
              }else if(_idx){
                os=[os[_idx.match(/[0-9]+/)]]
              }
              if(_idx){
                os=$(os)
              }
            }
          }else if(os.length){
            if(_lastX.match(/contains/i)){
              os=os.toArray()
              let xo=[],lo
              while(os.length){
                let oo=os.pop();
                xo.unshift(oo)
                
                _Util._spliceAll(os,xx=>$(xx).find(oo).length)
              }
              os=xo
            }
            if(os[x]){
              os=[os[x]]
            }else{
              os=0
              return 1
            }
          }
          _lastX=x
        }
      })
    }catch(e){}
    return _Util._isEmpty(os)?0:os
    
    function _matchTRTD(x,os){
      if(x.match(/\>[a-zA-Z]+\:(eq\(|last|first|Contains|attr|endContains|equal)/)||x.match(/\>[a-zA-Z]+$/)||x.match(/\>[a-zA-Z]+[.#]/)){
        x=x.split(">")
        let ss=os
        x.forEach(y=>{
          ss=ss.find(y)
        })
        os=ss.toArray()
        return os
      }
      
    }
  },
  _formatFun:function(s,t){
    t=t||""
    let f="\"'`/",b,fs=[],w="",
        k={
          "(":")",
          "[":"]",
          "{":"}"
        },ks=[],_newLine;
    for(let i=0;i<s.length;i++){
      let c=s[i]
      if(c=="\\"){
        b=1
      }else if(b){
        b=0
      }else if(c=="\r"){
        continue
      }else if((c==" "||c=="\t")&&_newLine){
        continue
      }else if(f.includes(c)){
        if(fs[0]==c){
          fs.shift()
        }else{
          fs.unshift(c)
        }
      }else if(!fs.length){
        if(k[c]){
          ks.unshift({k:c,i:i})
          if(c=="{"){
            w+=c+"\n"
            _newLine=1
            t+="  "
            w+=t
            while(s[i+1]&&s[i+1].match(/\s/)){
              i++
            }
            continue
          }
        }else if(ks[0]&&k[ks[0].k]==c){
          let ck=ks.shift()
          if(c=="}"){
            t=t.substring(2)
            if(_newLine){
              w=w.trim()
            }
            w+="\n"+t+c
            while(s[i+1]&&s[i+1].match(/\s/)){
              i++
            }
            continue
          }
        }else if(c==";"&&(!ks[0]||ks[0].k=="{")){
          w+=c+"\n"+t
          _newLine=1
          while(s[i+1]&&s[i+1].match(/\s/)){
            i++
          }
          continue
        }
      }
      w+=c
      _newLine=c=="\n"
      if(_newLine){
        w+=t
      }
    }
    return w
  },
  _isFunction:function(s){
    if(s){
      if(s.constructor==String){
        s=s.trim()
        if(s.match(/^function\(.*\)\{.*\}$/s)){
          return 1
        }else if(s.match(/^\(.*\)=>\{.*\}$/s)){
          return 1
        }
      }else if(s.constructor==Function){
        return 1
      }
    }
  },
  _newFindDom:function(){
    document._Contains=document._input=document._link=document._near=document._after=document._before=document._endContains=document._rowcol=0
  },
  _findDoms:function(_paths,_errOnHidden,_bRetry,_toShow){
    _extendJQuery()
    _Util._newFindDom()
    if(_paths.constructor==String){
      _paths=_paths.split("\n")
    }
    if(!bzComm._isIDE()){
      let p=_paths[0]
      if(p&&p.constructor==String&&p.includes("frame")){
        _paths[0]="BZ.TW.document"
      }else if(p&&p.constructor==String&&!p.includes("BZ.TW.document")){
        _paths.unshift("BZ.TW.document")
      }
    }

    if(!_paths){
      return
    }
    let _showIdx=_toShow?-1:_paths.findIndex(x=>x&&x.match&&x.match(/:show([\:\.\[\#]|$)/))
    if(_showIdx!=-1){
      let xs=_paths.splice(_showIdx+1)
      let oo=_Util._findDoms(_paths,_errOnHidden,_bRetry,1)
      oo.forEach(y=>{
        if(_Util._isHidden(y)&&!y.getBoundingClientRect().width){
          y._bzShow=1
          $(y).show()
        }
      })
      _paths.push(...xs)
      let o=_Util._findDoms(_paths,_errOnHidden,_bRetry,1)
      
      oo.forEach(y=>{
        if(y._bzShow){
          delete y._bzShow
          $(y).css({display:""})
        }
      })
      return o
    }

    let _orgPath=_Util._clone(_paths)
    
    var os,_root,_cells,_osInHidden=[]
    if(!_paths.find(x=>{
      return !$.isNumeric(x)&&(x.includes("shadowRoot")||x.match(/^canvas:/i))
    })&&_paths.find(x=>{
      return !$.isNumeric(x)&&x.match(/\:(first|last|eq)/)
    })){
      os=_Util._findDomsWithSimplySolution(_paths)
      if(os&&os.length){
        if(os.toArray){
          os=os.toArray()
        }
        return os
      }
      os=0
    }

    // let _idx=_paths.pop()||0;
    // if(!$.isNumeric(_idx)){
      // _paths.push(_idx)
      // _idx=null
    // }

    let _idx=null;
    _paths=_paths.filter(x=>{
      if($.isNumeric(x)){
        _idx=parseInt(x)
      }else{
        return 1
      }
    })

    let _sufIdx=_paths[_paths.length-1]
    if(!$.isNumeric(_sufIdx)){
      //for :input
      if(_paths.length>2&&_sufIdx.match(/:input\(/)){
        _paths.pop()
        _paths=_Util._findDoms(_paths);
        let os=[]
        _paths.forEach(x=>{
          $util._tmpFormForSearchingInput=x
          os.push(...$(x).find(_sufIdx).toArray())
        })
        if(os.length&&_idx!==undefined){
          os=[os[_idx||0]]
        }
        return os
      }
      //for quick path
      if(_sufIdx.match(/^body\>[^\>]+\>/i)){
        return [_Util._getElementByQuickPath(_sufIdx)]
      }
      _sufIdx=_sufIdx.split(":").pop()
      
      if(!_sufIdx.match(/last|first/)){
        _sufIdx=0
      }else{
        _paths[_paths.length-1]=_paths[_paths.length-1].replace(/[:](last|first)$/,"")
      }
    }

    try{
      if (_paths && _paths.length>0) {
        //for shadowRoot
        while(_paths.includes("shadowRoot")){
          if(os){
            let tmp=_paths.shift();
            if(tmp=="shadowRoot"){
              for(var i=0;i<os.length;i++){
                if(os[i].shadowRoot){
                  os=_root=$(os[i].shadowRoot)
                  break
                }
              }
            }else{
              os=_root=os.find(tmp)
            }
          }else{
            let ps=_paths.splice(0,_paths.indexOf("shadowRoot"))
            os=_Util._findDoms(ps)
            for(var i=0;i<os.length;i++){
              if(os[i].shadowRoot){
                os=_root=$(os[i].shadowRoot)
                break
              }
            }
            _paths.shift()
          }
        }
        if(!os){
          os=_paths[0];
          if(os.constructor==String){
            os=_root=$(document)
            if(_paths[1]&&_paths[1].toUpperCase().startsWith("IFRAME")){
              os=_root=$(os).find(_paths[1])
              if(os.length){
                os=_root=$(os.toArray().map(x=>{
                  return x.contentWindow.document
                }))
                _paths.splice(1,1)
              }else{
                return
              }
              
            }
          }else{
            os=_root=$(os)
          }
          if (_paths.length==1 || !_paths[1].toUpperCase) {
            return [os[0]];
          }else if(_paths[1]=="defaultView"){
            return [window.BZ?BZ.TW:window];
          }
        }
        /*
        var _cell=_Util._findElementFromParent(_root,_paths,_idx)
        if(_cell){
          return [_cell]
        }
        */
        
        let _curPath=_paths[_paths.length-1]

        _cells=_Util._findInInsensitive(_root,_curPath,_paths[_paths.length-2]);

        if(_curPath.includes(":before")){
          _cells=_cells.toArray?_cells.toArray():_cells
          _cells.reverse()
        }
        _cells=_Util._findChildrenDomFromList(_cells)
        for(var i=0;i<_cells.length;i++){
          var o=_cells[i];
          if(_Util._isHidden(o)){
            _osInHidden.push(o)
            _cells.splice(i--,1)
          }
        }
        if(!_errOnHidden){
          _cells.push(..._osInHidden)
        }
        if(!_cells.length){
          return []
        }
        if(_paths.length>2){
          for(var i=1;i<_paths.length-1;i++){
            os=os.find(_Util._findInInsensitive(_root,_paths[i],_paths[i-1]));
            os=_getOffset(_paths[i],os)
          }
          if(!os.length){
            os=_root;
            for(var i=1;i<_paths.length-1;i++){
              os=os.find(_Util._findInInsensitive(_root,_paths[i].replace(/\:endContains\(/g,":Contains("),_paths[i-1]));
            }
          }
          if(!os.length){
            return []
          }else if(_cells.length==1&&$(os).find(_cells).length){
            return _getOffset(_curPath,_cells)
          }
          if(os.length>1&&_paths.find(x=>x&&x.match&&x.match(/\:(contains|endcontains|equal|endequal)\(/i))){
          // if(os.length>1&&$.isNumeric(_idx)){
            var nos=_Util._findChildrenDomFromList(os,_cells)
            if(!nos.length){
              return []
            }
            var oo=$(_root).find("*");
            var ii=oo.index(nos[0])
            for(var i=0;i<_cells.length;i++){
              if(oo.index(_cells[i])<ii && _cells.length){
                _cells.splice(i--,1)
              }
            }
            _cells.sort(function(a,b){
              var ba=Boolean(nos.find(a)[0]);
              var bb=Boolean(nos.find(b)[0]);
              if(ba==bb){
                return oo.index(a)-oo.index(b)
              }
              return ba?-1:1
            })
          }else{
            _cells=os.find(_cells)
          }
        }
        
        if(_cells){
          if(_cells.constructor!=Array){
            _cells=_cells.toArray()
          }
        }
        
        if(_cells&&_cells[0]&&_cells[0].tagName=="CANVAS"&&_orgPath.join(" ").includes(":textElement")){
          let _txt=_descAnalysis._retrieveTextForElementPathItem(_orgPath)
          if(_idx===null){
            let n=0
            _cells.forEach((c,i)=>{
              c.bzTxtElement=c.bzTxtElement||TWHandler._getCanvasTextElement(c,_txt,0)
            })
            return _getOffset(_curPath,_cells)
          }else{
            let i=0;
            let cc=_cells.find(c=>{
              let cs=TWHandler._getCanvasTextElement(c,_txt)
              if(cs.length+i>_idx){
                c.bzTxtElement=cs[_idx-i]
                return 1
              }else{
                i+=cs.length
              }
            })
            if(!cc){
              cc=_cells[_cells.length-1]
              let cs=TWHandler._getCanvasTextElement(cc,_txt)
              cc.bzTxtElement=cs[cs.length-1]
            }
            return _getOffset(_curPath,[cc])
          }
        }else{
          if(_sufIdx=="first"){
            return _getOffset(_curPath,[_cells[0]])
          }else if(_sufIdx=="last"){
            return _getOffset(_curPath,[_cells.pop()])
          }else if(_idx===null){
            return _getOffset(_curPath,_cells)
          }else{
            return _getOffset(_curPath,[_cells[_idx]||_cells[_cells.length-1]])
          }
        }
      }
    }catch(e){
      _domActionTask._reportAppInfo("Error on findDoms: "+e.message)
      console.log(e.stack)
      if(os && os.constructor==String && !_bRetry){
        return this._findDoms(_paths,_errOnHidden,1);
      }
    }
    return null;
    
    function _getOffset(v,os){
      let _toArray
      if(os&&os.toArray){
        _toArray=1
        os=os.toArray()
      }
      v=v.match(/(\[[^\]]+\])|(\:[^\(\.\#\[]+(\([^\)]*\)+([^:\.\#]+\))*)?)|([\.\#][^\:\[\.\#]+)/g)
      if(!v||!os){
        if(_toArray){
          os=$(os)
        }
        return os
      }
      os=os.filter(x=>x).map(o=>{
        v.forEach(x=>{
          if(o){
            if(x==":next"){
              o=o.nextElementSibling
            }else if(x==":previous"){
              o=o.previousElementSibling
            }else if(x==":parent"){
              o=o.parentElement
            }
          }
        })
        return o
      })
      if(_toArray){
        os=$(os)
      }
      return os
    }
  },
  _findDomWithPanels:function(d,ps,pp){
    ps=ps||[]
    var _idx=d.pop()
    if(!$.isNumeric(_idx)){
      d.push(_idx)
      _idx=0
    }
    var ds=_Util._findDoms(d,pp)
    if(!ds||!ds.length){
      return
    }else if(ds.length==1){
      return ds[0]
    }
    for(var i=ps.length-1;i>=0;i--){
      var p=ps[i]
      if(!p){
        continue
      }
      var pps=_Util._findDoms(p)
      var dds=$(pps).find(ds)
      if(!dds||!dds.length){
      }else if(dds.length==1){
        return dds[0]
      }else{
        ds=dds
      }
    }
    if(ds){
      return ds[_idx]||ds[0]
    }
  },
  _findAfterDoms:function(o){
    var os=[o];
    while(o.parentElement&&o.tagName!="BODY"){
      $(o).nextAll().each(function(i,oo){
        os.push(oo)
      })
      o=o.parentElement
    }
    return $(os)
  },
  _findChildrenDomFromList:function(os,_cells){
    var ns=[],_last;
    for(var i=os.length-1;i>=0;i--){
      if(_cells && !$(os[i]).find(_cells).length){
        continue
      }else if(!ns.length||!$(os[i]).find(ns).length){
        ns.unshift(os[i])
      }
    }
    return $(ns)
  },
  _findTextElement:function(e){
    while(e && !$(e).text().trim() && e.tagName!="BODY"){
      e=e.parentElement
    }
    return e
  },
  _mergeSummary:function(sd,d,k){
    if(d){
      if(!sd[k]){
        sd[k]=d
      }else if(sd[k]!=d){
        Object.keys(d).forEach(x=>{
          sd[k][x]+=d[x]
        })
      }
    }
  },
  _getClosestElement:function(p,o,c){
    if($(p).is(c)){
      return p
    }
    let e=$(p).find(c).toArray()
    if(e.length){
      let os=$(p).find("*")
      let oi=os.index(o),mi=0,mo;
      for(let i=0;i<e.length;i++){
        let ee=e[i]
        let x=Math.abs(oi-os.index(ee))
        if(x<mi||!mi){
          mi=x
          mo=ee
        }
      }
      return mo;
    }else if(p&&p.tagName!="BODY"){
      return _Util._getClosestElement(p.parentElement,o,c)
    }
  },
  // _findNearTxt:function(a,_compareWord){
    // let ar=a.getBoundingClientRect(),_org=a,_hide
    // _compareWord=(_compareWord||"").toLowerCase()
    // var _right=["radio","checkbox"].includes(a.type),_stop=0,_bkLabel="";
    
    // var match=0,_txt="";
    // while(a.tagName!="BODY" && a.parentNode&&!_stop){
      // var p=a.parentNode,
          // _start=!_right;
      // let w=(p.innerText||"").trim()
      // if(w){
        // for(let i=0;i<p.childNodes.length;i++){
          // let o=p.childNodes[i]
          // if(o==a){
            // _start=!_start
            // continue
          // }
          // if(_start){
            // if(o.nodeType==1){
              // _txt+=" "+_formatTxt($util.getElementText(o))
            // }else if(o.nodeType==3){
              // _txt+=" "+_formatTxt(o.textContent)
            // }
            // _txt=_txt.trim()
            // if(_txt==_compareWord||_txt.match(new RegExp(_compareWord))){
              // _txt=_compareWord
            // }
          // }else if(!_txt&&o.nodeType==1){
            // w=_formatTxt($util.getElementText(o))||""
            // if(w==_compareWord||w.match(new RegExp(_compareWord))&&_Util._positionAfterElement(a,o)){
              // _txt=w
              // break
            // }else if(w){
              // break
            // }
          // }else if(o.nodeType==3&&(o.textContent+"").trim()){
            // break
          // }
        // }
        // if(_txt){
          // break
        // }
      // }
      
      // a=p;
    // }
    
    // return _txt
    
    // function _formatTxt(w){
      // return _Util._trimSpace(_Util._filterTxt(w.toLowerCase()))
    // }
  // },
  _findNearTxt:function(a,_compareWord){
    let ar=a.getBoundingClientRect(),_org=a
    _compareWord=(_compareWord||"").toLowerCase()
    var _right=["radio","checkbox"].includes(a.type),_stop=0,_bkLabel="";

    var _start=!_right,_match=0,_txt;
    while(a.tagName!="BODY" && a.parentNode&&!_stop){
      var p=a.parentNode;
      let os=$(p).find(_org.tagName)
      if(!_bkLabel){
        let w=$util.getElementText(p)
        if(w){
          w=_Util._filterTxt(w.toLowerCase());
          w=_Util._trimSpace(w)
          if((w==_compareWord||w.match(new RegExp(_compareWord)))&&os.length==1){
            _txt=w
            break
          }
        }else{
          a=p
          continue
        }
      }
      let _first=os[0]
      if(_bkLabel&&_first!=_org&&!_Util._isHidden(_first)){
        _txt=_bkLabel
        break 
      }
      for(var i=0;i<p.childNodes.length;i++){
        var n=p.childNodes[i];
        if(n.nodeType==1&&_Util._isHidden(n)){
          continue
        }
        if(n==a){
          if(_start){
            break
          }else{
            _start=1
          }
        }else if(!_start){
          continue
        // }else if(n.nodeType==1&& _cssHandler._isInput(n)){
          // break
        }else if((n.nodeType==1||n.nodeType==3)){
//          _stop=1
          
          var v1=_Util._filterTxt($util.getElementText(n).toLowerCase()).trim();
          if(v1&&v1!=_bkLabel){
            _stop=_txt=v1
            if(!_right&&v1.length>50){
              _stop=0
            }
          }
          if(_right && _txt){
            break
          }
        }
      }

      if(!_bkLabel&&_compareWord&&_stop&&_txt&&_txt!=_compareWord&&!v1.includes(_compareWord)&&["INPUT","TEXTAREA"].includes(_org.tagName)&&!["radio","checkbox","submit","butt","image","reset"].includes(_org.type)){
        let nr=p.getBoundingClientRect()
        
        if(ar.top-nr.top<15&&ar.left-nr.left<20){
          _bkLabel=_txt
          _stop=_txt=""
          continue
        }
      }

      
      a=p;
    }

    return (_txt||"").replace(/\*+$/,"").replace(/\s+/g," ").trim()
  },
  _toTrimSign:function(v,n){
    v=(v||"").replace(_Util._trimSign,"")
    if(n){
      v=_Util._retrieveTopWords(v,n)
    }
    return (v||"").replace(_Util._trimSign,"")
  },
  /*
  d:data, pick attribute name from data
  {
    Name:$project.data,
    Age:15,
    data:{
      value:"abc"
    }
  }
  ==>
  ["Name","Age","data"]
  */
  _pickAttrFromStringJSON:function(d){
    if(d){
      if(d.constructor==String){
        let vs=[]
        d=d.trim()
        if(d[0]=="{"&&d[d.length-1]=="}"){
          d=d.substring(1,d.length-1).trim()
          let p=d.match(/$args\: *\[[^.]+\]/)
          if(p){
            d=d.replace(p[0],"")
          }
          while(d.includes("{")&&d.indexOf("{")<d.indexOf("}")){
            d=d.replace(/\{[^\{\}]*\}/g,"''")
          }
          while(d.includes("[")&&d.indexOf("[")<d.indexOf("]")){
            d=d.replace(/\[[^\[\]]*\]/g,"''")
          }
          d=d.replace(/\:[^,]*(,|$)/g,":''$1")
          d=d.replace(/:''/g,"")
          d=d.replace(/\s/g,"")
          d=d.split(",")
          
          _Util._spliceAll(d,v=>{return !v})

          vs=d
        }
        return vs
      }else{
        return Object.keys(d)
      }
    }
  },
  _retrieveTopWords:function(w,_size){
    if(w && w.length>_size){
      w=w.split(" ");
      var ww=w[0],i=1
      while(ww.length<_size){
        ww+=" "+w[i++]
      }
      w=ww
    }
    return w
  },
  _getElementRoot:function(e){
    let r=0;
    while(e.parentNode){
      e=e.parentNode;
      if(e.constructor==ShadowRoot){
        return e
      }else if(e.tagName=="BODY"){
        r=e
      }
    }
    return r||e
  },
  _hasDeepContent:function(e){
    var _hasNone=0
    for(var i=0;i<e.children.length;i++){
      var o=e.children[i];
      if($(o).css("pointer-events")=="none"){
        _hasNone=1
      }else if(!["STYLE","SCRIPT","NOSCRIPT","OPTION"].includes(o.tagName)){
        return 1
      }
    }
    return 0
  },
  _getStringBySize:function(v,i,_back){
    i=i||30
    if(v&&v.length>i){
      if(_back==1){
        return "... "+ v.substring(v.length-i)
      }else if(_back){
        i=parseInt(i/2)
        return v.substring(0,i)+"... "+ v.substring(v.length-i)
      }

      return v.substring(0,i)+" ..."
    }
    return v
  },
  getEONumList:function(n){
    let ls=[];
    for(let i=0;i<n;i++){
      ls.push(i)
    }
    let ns=[],w=0;
    while(ls.length){
      if(ls.length==1){
        ns.push(ls.pop())
      }else{
        let i=Math.ceil(ls.length/2)
        if(!w){
          ns.push(ls.splice(i,1).pop())
        }else if(w==1){
          ns.push(ls.splice(Math.ceil(parseInt(ls.length/2)/2),1).pop())
        }else if(w==2){
          ns.push(ls.splice(parseInt((ls.length+Math.ceil(ls.length/2))/2),1).pop())
        }
        w++
        if(w==3){
          w=0
        }
      }
    }
    return ns
  },  
  _compressBase64:function(bs){
    var q=9,_best;
    bs=bs.substring(22);
    
    while(1){
      var h="",hh="",k=0,j=0;
      s=bs
      while(s){
        var v=s.substring(0,q)
        var sss=s.substring(q)
        var ss=_Util._replaceAll(sss,v,"*"+j)
        if(sss!=ss){
          k+=(sss.length-ss.length)
          h+=v
          s=ss
          j++
        }else{
          hh+=s[0]
          s=s.substring(1)
        }
      }
      q++;
      if(!_best || _best>k){
        _best=k
        _bestQ=q
      }else{
        return _bestQ+"\n"+h+"\n"+hh
      }
    }
  },
  _isOverlapping:function(a,b){
    let ar=a.getBoundingClientRect()
    let br=b.getBoundingClientRect()
    if(ar.left<=br.left+10 && ar.right>=br.right-10 && ar.top<=br.top+10&&ar.bottom>=br.bottom-10){
      return 1
    }
    return br.left<=ar.left+10 && br.right>=ar.right-10 && br.top<=ar.top+10&&br.bottom>=ar.bottom-10
  },
  _unCompressBase64:function(s){
    
  },
  _removeNoJSONData:function(a){
    if(a&&![Number,String,Object,Array].includes(a.constructor)){
      return 
    }
    if(a&&[Array,Object].includes(a.constructor)){
      for(var k in a){
        if(!_Util._removeNoJSONData(a[k])){
          delete a[k]
        }
      }
    }
    return 1
  },
  _removeStringSign:function(v){
    return v?v.replace(/(^["'`])|(["'`]$)/,""):v
  },
  _refDataToJSON:function(vs,p){
    p=p||""
    let w=""
    vs.forEach(x=>{
      if(w){
        w+=",\n"
      }
      if(x._key){
        if(x._value.constructor==Array){
          w+=p+"  \""+x._key+"\" : "+_Util._refDataToJSON(x._value,p+"  ")
        }else{
          w+=p+"  \""+x._key+"\" : "+x._value
        }
      }else{
        if(x._value.constructor==Array){
          w+=p+_Util._refDataToJSON(x._value,p+"  ")
        }else{
          w+=p+"  "+x._value
        }
      }
    })
    if(vs[0]){
      if(vs[0]._key){
        w=p+"{\n"+w+"\n"+p+"}"
      }else{
        w=p+"[\n"+w+"\n"+p+"]"
      }
    }else{
      return "{}"
    }
    return w
  },
  _isJsonKey:function(s){
    return s&&(s.match(/^[0-9]*[.]?[0-9]*$/))||(!s.match(/^[0-9]/)&&s.match(/(^"[^"]*"$)|(^`[^`]*`$)|(^`[^`]*`$)|[\wÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC]+/))
  },
  _isJsonValueString:function(v){
    if(v&&v.constructor!=String){
      return
    }
    v=(v||"").trim()
    if(!v){
      return
    }else if(v.match(/(^".+"$)|(^'.+'$)|(^`.+`$)/)){
      let k=v[0]
      v=v.substring(1,v.length-1).replace(/[\\][\\]/g,"").replace(/[\\]['"`]/g,"")
      
      return !v.includes(k)
    }else if(v.match(/(^\{.+\}$)|(^\[.+\]$)/s)){
      return 1
    }else if(v.match(/(^\(.+\)$)/)){
      return _Util._isJsonValueString(v.substring(1,v.length-1))
    }else if(v.match(/(^["].*["]$)|(^['].*[']$)|(^[`].*[`]$)/)||$.isNumeric(v)){
    //}else if(v.match(/[^\?]+\:/)){
    }else{
      return
    }
    return 1
  },
  _parseJSONWithRefDataToObj:function(v,_throwError){
    v=v||""
    if(v.constructor!=String){
      v=JSON.stringify(v,0,2)
    }
    v=v.trim()
    if(!v){
      return []
    }
    
    if(v.replace(/\s/g,"")=="{}"){
      return []
    }
    let vs=[],
        _left=_bzJSEditor.bd,
        _right=_bzJSEditor.db,
        _key,_value,lc=[],rc=[],s="",b,_startIdx
    
    for(let i=0;i<v.length;i++){
      let c=v[i]
      if(c=="\\"){
        b=!b
      }else if(b){
        b=0
      }else if(c.match(/\s/)&&!s){
        continue
      }else if(c==':'&&lc[0]=="{"){
        let ss=s.trim()
        if(ss&&!_key){
          if(_Util._isJsonKey(ss)){
            _key=ss
            s=""
            continue
          }else{
            return _throw(v,i)
          }
        }else if(!ss){
          return _throw(v,i)
        }else if(!ss.includes("?")&&lc.length==1){
          return _throw(v,i)
        }
      }else if((c==","||c==_left[lc[0]])&&lc.length==1){
        s=s.trim()||""
        if(!_Util._isJsonValueString(s)&&!_Util._hasCode(s)&&!$.isNumeric(s)&&!s.match(/^(true|false)$/)){
          return _throw(v,i)
        }
        if(_key){
          vs.push({
            _key:_key,
            _value:s
          })
        }else if(lc[0]=="["){
          vs.push({_value:s})
        }else{
          return _throw(v,i)
        }
        _key=_value=s=""
        if(c!=","){
          lc.pop()
        }
        continue
      }else if(!lc[0]&&(c=="{"||c=="[")&&!vs.length){ //start
        lc.unshift(c)
        continue
      }else if(!lc[0]){ //not start { and [
        return _throw(v,i)
      }else if(c==_left[lc[0]]){
        lc.shift()
      // }else if(lc[0]=="{"&&!_key&&!s&&!c.match(/["'a-zA-ZÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC\$\_]/)){
        // return _throw(v,i)
      }else if(_left[c]){
        lc.unshift(c)
      }
      s+=c
    }
    if(s){
      return _throw(v,v.length-s.length)
    }
    if(vs.find(x=>{
      if(x._key&&"'\"`".includes(x._key[0])){
        x._key=x._key.substring(1,x._key.length-1)
      }
      if(x._value.match(/^[\{\[]/)){
        try{
          x._value=_Util._parseJSONWithRefDataToObj(x._value,1)
        }catch(ex){
          v=ex.message
          return 1
        }
      }
    })){
      return _throw(v,0)
    }
    return vs
    function _throw(v,i){
      return
      // if(i){
      //   i-=25
      //   if(i<0){
      //     i=0
      //   }
      // }
      // let _msg=_bzMessage._system._error._parseParameterError+": "+v.substring(i,i+50)
      // if(_throwError){
      //   throw new Error(_msg)
      // }
      // alert(_msg)
    }
  },
  _showLabelMenu:function(k,e,x,y,t,w){
    let o=$("#"+k)[0]
    if(!o){
      o=$(`<div id='${k}' onmouseleave='this.remove()' class='bz-menu-with-arrow-${w}'><div class='bz-menu-with-arrow-out-${w}'></div><div class='bz-menu-with-arrow-in-${w}'></div><pre class='bz-menu-with-arrow-box'></pre></div>`)[0]
    }
    if(o._curData&&o._curData.x==x&&o._curData.y==y&&o._curData.t==t){
      return
    }
    o._curData={x:x,y:y,t:t}
    o=$(o)
    o.css({opacity:0})
    o.appendTo(document.body)
    o.find(".bz-menu-with-arrow-box").text(t)
    let r=o[0].getBoundingClientRect()
    o.find(".bz-menu-with-arrow-out-"+w).css({top:r.height-5+"px",left:r.width/2-2+"px"})
    o.find(".bz-menu-with-arrow-in-"+w).css({top:r.height-6+"px",left:r.width/2-2+"px"})
    o.css({opacity:1,left:x-r.width/2+"px",top:y-r.height-7+"px"})
    return o[0]
  },
  _isCompleteBlock:function(w){
    w=w.replace(/\\\\/g,"").replace(/(\\\"|\\\'|\\\(|\\\)|\\\[|\\\]|\\\{|\\\})/g,"").replace(/(\"[^\"]*\"|\'[^\']*\')/g,"")
    let ks=_bzJSEditor._leftKeys;
    return !w.match(/[\"\']/)&&!['[','{','('].find(x=>{
      m1=w.match(new RegExp("[\\"+x+"]","g"))||[]
      m2=w.match(new RegExp("[\\"+ks[x]+"]","g"))||[]
      return m1.length!=m2.length
    })
  },
  _getRegexByBZName:function(r,_final){
    while(r&&r[0]=="/"&&r[r.length-1]=="/"){
      r=r.substring(1,r.length-1)
    }
    if(r&&r.match(/^BZ-/i)){
      var rr=r.toUpperCase()
      for(var i=0;i<_IDE._data._curVersion.setting.attributeMap.length;i++){
        var v=_IDE._data._curVersion.setting.attributeMap[i]
        if(rr=="BZ-"+v.key.toUpperCase()){
          r=v.regex
          r=r.substring(1,r.length-1)
          break
        }
      }
    }
    if(_final&&_IDE._data._curModule){
      r=r.replace("{module}",_IDE._data._curModule._data.name).replace("{num}","[0-9]+").replace("{timestamp}","[0-9]{13}").replace("{time}","[0-9]{6}")
    }
    return r
  },
  _readyExecute:function(_ckFun,_exeFun,_time){
    setTimeout(()=>{
      if(_ckFun()){
        _exeFun()
      }else{
        _Util._readyExecute(_ckFun,_exeFun,_time)
      }
    },_time||100);
  },
  _parseExpression:function(s,_headerSplit,_logic){
    let w="",b,p=[],g,gs=[],hs=[],pml={
      "'":"'",
      '"':'"',
      "{":"}",
      "(":")",
      "[":"]",
      "/":"/",
      "`":"`"
    },pmr=_Util._swapKeyValue(pml),_split=""
    
    for(let i=0;i<s.length;i++){
      let c=s[i]
      if(b){
        w+=c
        b=0
      }else if(c=="\\"){
        b=1
      }else if(p.length){
        w+=c
        if(pml[p[p.length-1]]==c){
          p.pop()
        }else if(pml[c]){
          p.push(c)
        }
      }else if(_headerSplit&&c.match(_headerSplit)){
        if(gs.length||w){
          hs=hs.concat(gs)
          w=w.trim()
          if(w){
            hs.push(w)
            w=""
          }
          gs=[]
          if(_split){
            continue
          }
        }
        _split+=c.match(_headerSplit)[0]
        _split=_split.replace("==","=")
      }else if(pml[c]){
        p.push(c)
        w+=c
      }else if(_logic&&(c=="|"||c=="&")){
        if(w){
          gs.push(w)
        }
        gs.push(c)
        w=""
      }else if(!c.match(/\s/)||w){
        w+=c
      } 
    }
    if(w){
      gs.push(w)
    }
    gs=gs.map(x=>{
      while(x.match(/^[\(](.+)[\)]$/)){
        x=x.substring(1,x.length-1)
      }
      return x
    })
    if(_headerSplit){
      if(hs.length){
        return {_headers:hs,_groups:gs,_split:_split}
      }else{
        return {_headers:gs,_groups:[],_split:_split}
      }
    }else{
      return gs
    }
  }
};
if(!window.bzComm){
  window.bzComm={
    _shareData:{},
    _callBackMap:{},
    _newId:Date.now(),
    _keyToCodeMap:{
      _setSharedData:"setSharedData",
      _timingInfo:"timingInfo",
      _start:"start",
      _end:"end",
      _setStatus:"setStatus",
      _flashTmpCover:"flashTmpCover",
      _bzDomPicker:"bzDomPicker",
      _ideRecorder:"ideRecorder",
      _ideTask:"ideTask",
      _domActionTask:"domActionTask",
      _exeAction:"exeAction"
    },
    pageType:{
      bzIdeExtension:{
        key:'bzIdeExtension',
        getTabId:function(){
          return bzComm.getIdeTabId()
        }
      },
      bzAppExtension:{
        key:'bzAppExtension',
        getTabId:function(){
          return bzComm.getAppTabId()
        }
      },
      bzIde:{
        key:'bzIde',
        getTabId:function(){
          return bzComm.getIdeTabId()
        }
      },
      bzApp:{
        key:'bzApp',
        getTabId:function(){
          return bzComm.getAppTabId()
        }
      },
      bzBg:{
        key:'bzBg',
        getTabId:function(){}
      }
    },
    init:function(d){
      if(d){
        bzComm.assignId(d)
      }
  
      if(window._startComm){
        return _end()
      }
      window._startComm=1
      let cp=bzComm.getCurPageType();
  
      window.addEventListener(cp.key, (event) => {
        console.log("Received message on "+cp.key+" and from the same page",event.detail)
        bzComm.handleMessage(event.detail)
      });
      if(window.extensionContent){
        chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
          console.log("Received message on "+cp.key+" and from remote",message)
          bzComm.handleMessage(message)
          sendResponse(0)
        });
      }
      if(parent!=window){
        window.addEventListener('message', (e) => {
          if (e.data.type==='bz-set-iframe-idx') {
            bzComm.postToBackground({
              fun:"updateIframeIdx",
              scope:"bgComm",
              ps:[bzComm.getIframeId(),e.data.idx]
            })
            bzComm.buildIFrameMap()
          }else if(e.data.type==='bz-exe'){
            window[e.data.scope][e.data.fun](...e.data.ps)
          }
        });
      }
      _end()
      function _end(){
        if(bzComm._isAppExtension()){
          bzComm.postToBackground({
            fun:"tabReady",
            scope:"bgComm"
          })
        }
      }
    },
    getBZId:function(){
      return document.documentElement.getAttribute("bz-id");
    },
    getIdeTabId:function(){
      return document.documentElement.getAttribute("ide");
    },
    getAppTabId:function(){
      return document.documentElement.getAttribute("app");
    },
    getAppIFrames:function(){
      let v=document.documentElement.getAttribute("appIFrames")
      if(v){
        v=v.replace(/'/g,'"');
        v=JSON.parse(v)
        return v
      }
    },
    _getNotReadyIFrame:function(){
      let v= bzComm._findIFrame((x)=>{return !x.bzCommReady})
      if(v){
        console.log("Missing bzCommReady:",v)
      }else{
        v=bzComm._findIFrame((x)=>{return x.idx===undefined})
        if(v){
          console.log("Missing idx:"+v)
        }else{
          console.log("Not missing")
          bzComm._findIFrame(x=>console.log(x))
        }
      }
    },
    _forEachIFrame:function(fun,fs){
      _doIt(fs||bzComm.getAppIFrames())
      function _doIt(d){
        for(let k in d){
          if(d[k]&&d[k].constructor==Object){
            fun(d[k],k)
            _doIt(d[k])
          }
        }
      }

    },
    _findIFrame:function(fun,fs){
      return _doIt(fs||bzComm.getAppIFrames())
      function _doIt(d){
        for(let k in d){
          if(d[k]&&d[k].constructor==Object){
            if(fun(d[k],k)){
              return {v:d[k],k:k}
            }
            let r=_doIt(d[k])
            if(r){
              return r
            }
          }
        }
      }
    },
    _filterIFrame:function(fun,fs){
      let r=[]
      bzComm._forEachIFrame((x,k)=>{
        if(fun(x,k)){
          r.push(x)
        }
      },fs)
      return r;
    },
    getIframeId:function(v){
      return window.curBZIframeId||parseInt(document.documentElement.getAttribute("iframeId")||0);
    },
    assignId:function(d){
      for(let k in d){
        document.documentElement.setAttribute(k,d[k])
      }
      if(window.curBZIframeId){
        document.documentElement.setAttribute("iframeId",curBZIframeId)
      }
      delete d.iframeId

      bzComm._exeInIframes({
        fun:"assignId",
        scope:"bzComm",
        ps:[d]
      })
    },
    _exeInIframes:function(d){
      d.type="bz-exe"
      $("IFRAME").toArray().forEach((x)=>{x.contentWindow.postMessage(d, "*")})
    },
    getIds:function(_fun){
      let v={
        ide:bzComm.getIdeTabId(),
        app:bzComm.getAppTabId(),
        appIFrames:bzComm.getAppIFrames()
      }
      _fun&&_fun(v)
      return v
    },  
    _getIframeByAttr:function(k,v,fs){
      fs=fs||bzComm.getAppIFrames()
      return _find(fs)
      function _find(f){
        if((v&&f[k]==v)){
          return f
        }else if(!v&&f[k]){
          return f[k]
        }
        let r;
        if(f.constructor==Object){
          Object.values(f).find((x)=>{
            r=_find(x)
            return r
          })
        }
        return r
      }
    },
    _updateIframe:function(k,v,fs){
      fs=fs||bzComm.getAppIFrames()
      _find(fs)
      bzComm.updateAppIFrameMap(fs)
      function _find(f){
        if(f[k]){
          f[k]=v
          return 1
        }

        if(f.constructor==Object){
          Object.values(f).find((x)=>{
            return _find(x)
          })
        }
      }
    },
    updateAppIFrameMap:function(v,_updateSubIframe){
      document.documentElement.setAttribute("appIFrames",JSON.stringify(v).replace(/"/g,"'"))
      if(_updateSubIframe){
        let d=bzComm._getIframeByAttr(bzComm.getIframeId(),0,v)
        Object.keys(d).forEach((k)=>{
          k=parseInt(k)
          if(!Number.isNaN(k)){
            bzComm.postToAppExtension({
              fun:"updateAppIFrameMap",
              scope:"bzComm",
              toIFrameId:k,
              ps:[v,1]
            })
          }
        })
      }
    },
    buildIFrameMap: function (fs) {
      fs=fs||$("IFRAME").toArray()
      fs.forEach((x,i)=>{
        if(x.contentDocument&&x.contentWindow&&!x.contentWindow.bzComm){
          bzComm.postToBackground({
            fun:"updateIframeIdx",
            scope:"bgComm",
            ps:[x.contentWindow.curBZIframeId,i]
          })
          bzComm.buildIFrameMap($(x.contentDocument).find("IFRAME").toArray())
        }else{
          x.contentWindow.postMessage({type:"bz-set-iframe-idx",idx:i}, "*")
        }
      })
    },
    reportIFrameResize:function(v){
      let f=bzComm._curResizeIFrame
      if(f){
        delete bzComm._curResizeIFrame
        f._fun(v)
      }
    },  
    getCurPageType:function(){
      if(!bzComm._curPageType){
        let pt=bzComm.pageType,p,e="";
        if(window.name=="bz-master"){
          p="Ide"
        }else{
          p="App"
        }
        if(window.extensionContent){
          e="Extension"
        }
        bzComm._curPageType=pt["bz"+p+e];
      }
      return bzComm._curPageType;
    },
    _isIDE:function(){
      return window.name=="bz-master"&&!window.extensionContent
    },
    _isApp:function(){
      return window.name!="bz-master"&&!window.extensionContent
    },
    _isAppExtension:function(){
      return window.name!="bz-master"&&window.extensionContent
    },
    _isIDEExtension:function(){
      return window.name=="bz-master"&&window.extensionContent
    },
    handleMessage:function(v){
      if(!v){
        return
      }
      let cp=bzComm.getCurPageType();
  
      bzComm._codeToKeyMap=bzComm._codeToKeyMap||_Util._invertObject(bzComm._keyToCodeMap)
      v.scope=bzComm._codeToKeyMap[v.scope]||v.scope
      v.fun=bzComm._codeToKeyMap[v.fun]||v.fun
  
      if(v.toPage&&v.toPage!=cp.key){
        return bzComm._postMessage(v)
      }else if(v.result){
        return _handleResult(v)
      }
      try{
        if(v.eval){
          v.result={value:eval(v.eval)}
        }else if(v.insertCallFun){
          return window[v.scope][v.fun](...(v.ps||[]),(r)=>{
            v.result={value:r}
            _end(v)
          })
        }else{
          v.result={value:window[v.scope][v.fun](...(v.ps||[]))}
        }
      }catch(ex){
        v.result={error:ex.stack}
      }
      _end(v)
      function _end(v){
        if(v.callBack){
          v.callBack.ps=[v.result.value]
          _postCallBack(v.callBack,v)
        }else if(v.return){
          _postCallBack(v,v)
        }
      }
      
      function _postCallBack(rv,v){
        rv.toPage=v.fromPage
        rv.toId=v.fromId
        rv.toIFrameId=v.fromIFrameId
        delete rv.fromPage;
        delete rv.fromId;
        delete rv.fromIFrameId
        bzComm._postMessage(rv)
      }
  
      function _handleResult(v){
        if(v.return){
          let fun=bzComm._callBackMap[v.return].return;
          delete bzComm._callBackMap[v.return];
          if(v.result){
            if(v.result.error){
              if(cp.key=="bzIde"){
                alert(v.result.error)
              }else{
                console.log("BZ-LOG:"+v.result.error)
              }
            }

            fun&&fun(v.result.value,v.ps)
          }
        }else{
          window[v.scope][v.fun](v.result.value,v.ps)
        }
      }
    },
    _postMessage:function(v){
      let cp=bzComm.getCurPageType()
      console.log("Send message from "+cp.key)
      if(cp.getTabId()==v.toId&&v.toIFrameId==bzComm.getIframeId()){
        window.dispatchEvent(new CustomEvent(v.toPage, {detail:v}));
      }else{
        let _bkFun=function(r){
          console.log("Get response message on "+cp.key+" and from remote page")
  
          bzComm.handleMessage(r)
        }
    
        if(window.extensionContent){
          chrome.runtime.sendMessage(v)
        }else if(window.name=="bz-master"){
          chrome.runtime.sendMessage(bzComm.getBZId(), v);
        }else{
          window.dispatchEvent(new CustomEvent("bzAppExtension", {detail:v}));
        }
      }
    },
    _prepareDataAndPost:function(to,v,fun){
      let cp=bzComm.getCurPageType()
      if(cp==to&&v.toIFrameId==bzComm.getIframeId()){
        return
      }
      if(v.constructor==String){
        v={
          eval:v
        }
      }
      v.toPage=to.key;
      v.toId=to.getTabId();

      v.fromPage=cp.key;
      v.fromId=cp.getTabId();
      v.fromIFrameId=bzComm.getIframeId()||0
      if(v.toIFrameId===undefined||v.toIFrameId===null){
        if(v.toId==v.fromId){
          v.toIFrameId=v.fromIFrameId
        }else{
          v.toIFrameId=0
        }
      }
      v.fun=bzComm._keyToCodeMap[v.fun]||v.fun
      v.scope=bzComm._keyToCodeMap[v.scope]||v.scope
  
      bzComm._handleReturnFun(v,fun)
      bzComm._postMessage(v)
    },
    _setCmd:function(v){
      let cp=bzComm.getCurPageType()
      v={
        eval:v
      }
      if(cp.key=="bzIde"){
        bzComm.postToAppExtension(v)
      }else{
        bzComm.postToIDE(v)
      }
    },
    postToIDE:function(v,fun){
      bzComm._prepareDataAndPost(bzComm.pageType.bzIde,v,fun)
    },
    postToIDEExtension:function(v,fun){
      bzComm._prepareDataAndPost(bzComm.pageType.bzIdeExtension,v,fun)
    },
    postToApp:function(v,fun){
      bzComm._prepareDataAndPost(bzComm.pageType.bzApp,v,fun)
    },
    postToAppExtension:function(v,fun){
      bzComm._prepareDataAndPost(bzComm.pageType.bzAppExtension,v,fun)
    },
    postToBackground:function(v,fun){
      bzComm._prepareDataAndPost(bzComm.pageType.bzBg,v,fun)
    },
    _handleReturnFun:function(v,fun){
      fun=v.return||fun
      if(fun&&fun.constructor==Function){
        let rd=bzComm._newId++;
        v.return=v.return||fun
        bzComm._callBackMap[rd]={...v}
        v.return=rd
      }
    },
    _transferCallBetweenIDEAndAppExtension:function(d,fun){
      let cp=bzComm.getCurPageType()
      if(cp.key=="bzIde"){
        bzComm.postToAppExtension(d,fun)
      }else{
        bzComm.postToIDE(d,fun)
      }
    }
  }
  if(window.name=="bz-client"){
    bzComm.init()
    // BZ.initData()
  }else if(window.name=="bz-master"){
    if(!opener){
      if(!window.extensionContent&&!_Util._isPopWin()&&location.href.includes("/extension")){
        window.name=""
        let p=localStorage.getItem("bz-ide")
        if(p){
          p=JSON.parse(p)
        }else{
          p={w:screen.availWidth/2,h:screen.availHeight}
        }
        let v=location.href
        window.open(v,"bz-master","width="+p.w+",height="+p.h)
        location.href=location.origin
        window.close()
      }
    }else{
      bzComm.init()
    }
  }
};
var _DialogViewDef={
  //modal cover
  id:"_dialog",
  _tag:"div",
  _attr:{
    "class":function(d){
      var c=window.extensionContent?"BZIgnore":""
      return d._modal?"bz-modal-bg "+c:"bz-bg "+c
    }
  },
  _animation:{
    _hide:function(e,_fun){$(e).fadeOut("slow",_fun)}
  },
  _items:[
    {
      //Main window
      _tag:"div", 
      _attr:{
        "class":"bz-modal-window",
        style:function(d,c){
          //if(1||d._moveable&&!d._modal){
          //}
          var _innerSize=_Util._getDomSize(d._content),
              _winHeight=d._content?d._content.ownerDocument.defaultView.innerHeight:0;
          if(!d._width){
            d._width=_innerSize._width+30+"px";
          }else if(!(d._width+"").match(/(\%|px)/)){
            d._width+="px"
          }
          if(!d._height){
            d._height=_innerSize._height+165;
          }
          s=d._inMax?"width:90% !important;height:90% !important;":"width:"+d._width+" !important;max-width:90%;height:"+d._height+"px !important;min-width:200px;";
          if(d._moveable&&!d._modal&&_Dialog._position){
            _top=_Dialog._position.top
            if(d._content&&d._content.ownerDocument){
              _top=(_winHeight-d._height)/2;
            }
            s+="top:"+_top+"px;left:"+_Dialog._position.left+"px;transform:unset;"
          }
          return (_winHeight&&_winHeight<800?'':"max-height:80%;")+s;
        }
      },
      _after:function(o){
        // var oo=".bz-modal-header";
        if(!o._dragDefined){
          o._dragDefined=true;
          setTimeout(function(){
            _Util._setDrag($(o).find(".bz-modal-header,.bz-modal-footer").toArray(),o);

            let mwr=o.getBoundingClientRect()
            $(o).css({
              top:mwr.top,
              left:mwr.left,
              transform:"unset"
            })
          },100);
        }
      },
      _items:[
        {
          _tag:"div",
          _attr:{
            "class":"bz-modal-header",
          },
          _text:function(d){
            return d._title
          }
        },
        {
          _tag:"div",
          _attr:{
            "class":"bz-modal-body disable-select"
          },
          _html:function(d){
            return d._content
          }
        },
        {
          _tag:"div",
          _attr:{
            "class":"bz-modal-footer",
            style:function(d){
              if(d._buttons.length==1){
                return "text-align:center;"
              }
              return "";
            }
          },
          _items:[
            {
              _if:function(d){
                return d._buttons.find(x=>x._options)
              },
              _tag:"span",
              _attr:{
                class:"pull-left"
              },
              _items:[
                {
                  _tag:"select",
                  _attr:{
                    class:"form-control",
                    style:"width:150px;"
                  },
                  _items:[
                    {
                      _tag:"option",
                      _attr:{
                        value:function(d){
                          return d._item._value||d._key
                        }
                      },
                      _text:function(d){
                        return d._item._text||d._item
                      },
                      _dataRepeat:function(d){
                        return d._item._dataRepeat
                      }
                    }
                  ],
                  _dataModel:function(d){
                    return d._item._dataModel
                  },
                  _dataRepeat:function(d){
                    return d._buttons.filter(x=>x._options).map(x=>x._options)
                  },
                  _jqext:function(d){
                    return d._item._jqext
                  }
                }
              ]
            },
            {
              _tag:"button",
              _dataRepeat:function(d){
                return d._buttons
              },
              _attr:{
                disabled:function(d){
                  if(d._item._if){
                    if(d._item._if.constructor==Function){
                      return !d._item._if()
                    }else if(d._item._if.constructor==String){
                      var v;
                      v=eval("v="+d._item._if)
                      return !v
                    }
                    return !d._item._if
                  }
                },
                tabindex:function(d){
                  return d._supData._buttons.length-d._idx
                },
                class:function(d){
                  return d._item._class.constructor==Function?d._item._class(d):d._item._class
                },
                style:function(d){
                  return d._item._style.constructor==Function?d._item._style(d):d._item._style
                }
              },
              _text:function(d){
                return d._item._title
              },
              _jqext:{
                click:function(e){
                  this._data._item._click(this,e);
                }
              }
            }
          ]
        }
      ]
    }
  ],
  _jqext:{
    mousedown:function(e){
      if(e.target==this){
        _Util._closeModelWindow()
      }
    }
  }
};

var _dialogList=[];
var _lastCloseDlgTime=0;
var _Dialog={
  _comps:{},
  _viewDef:_DialogViewDef,
  _showMe:function(_content,_data,_area,_winTagClass){
    this._data=_data;
    this._data._content=_content;
    this._area=_area;
    if(!_data._modal){
      let bg=$(_area).find("."+_winTagClass).toArray().pop()
      if(bg){
        if(_winTagClass=="bz-confirm-window"){
          _Dialog._position=bg.getBoundingClientRect()
          $(".bz-confirm-window .btn-cancel").click()
        }
        $(".bz-alert-window .btn-primary").click()
      }
    }
    this._window=_CtrlDriver._execute(this);
    var _this=this;
    setTimeout(function(){
      _this._initLayout();
      if($(_this._window).hasClass("bz-modal-bg")){
        _this._window.style.zIndex=100000
      }else{
        _Util._setToTop($(_this._window).find(".bz-modal-window")[0])
      }
    },100);
  },
  _initLayout:function(){
    var d=this._data;
    var o=this._data._content;
    _dialogList.unshift(this)

    var _input=$(".bz-modal-bg:last").find("input,textarea,select,.bz-js-editor-box");
    if(_input.is(":focus")){
    }else if(_input.length){
      _input.toArray().find(x=>{
        if(x.getBoundingClientRect().width>10){
          x.focus()
          return 1
        }
      })
    }else{
      var btn=$(".bz-modal-bg:last button.btn-primary:eq(0)");
      if(btn.length){
        btn.focus()
      }else{
        $(".bz-modal-bg button:last").focus();
      }
    }
  },
  _close:function(){
    if (this._data._afterClose) {
      this._data._afterClose();
    }
    $(this._comps._dialog).remove();
    _dialogList.splice(_dialogList.indexOf(this),1)
  },
  _isSameDlg:function(o){
    return $(this._window).find(o).length
  }
};

setTimeout(function(){
  $(document).keydown(function(e){
    if(_Util._checkKeycode(e)==27){
      _Util._closeModelWindow(e)
    }
  });
},10);
console.log("Insert $$$$$$$$$$$$$$")
var $util={
  extractData:function(d,k){
    return _extractData._extract(d,k)
  },
  wait:function(v){
    return (_fun)=>{
      setTimeout(_fun,v)
    }
  },
  continue:function(){

  },
  break:function(){
    
  },
  showJsonValidateResult:function(v,d){
    if(!d&&v.valid){
      d=v.valid
      v=v.data
    }
    _extractData._showTools(v,d)
  },
  refreshData:function(m,t,n){
    let d=$data(m,t)
    _ideDataHandler._takeData((_ideDataManagement._curMap[(m||"")+(t||"")]||[]).find(x=>x.name==n),d,m,t)
  },
  validateData:function(v,d,r){
    let url;
    r=r||[]
    if(!window.extensionContent){
      let url=location.protocol+"/"+"/"+location.host+location.pathname+"?id="+BZ._data._curProject._id+"#"+_ideLocation._getPath(0,_ideTask._data._curModule||_IDE._data._curModule,_ideTask._data._curTest||_IDE._data._curTest)
      if(_domActionTask._lastAction){
        // _domActionTask._lastAction._extractJsonData=v
        // _domActionTask._lastAction._validJsonData=d
        _domActionTask._lastAction._url=url
      }
    }
    v=_compressJSON._unConvert(v)
    console.log("BZ-LOG: BZ-Start-Validating:"
                +"url: "+url
                +"-- Data --"
                +JSON.stringify(v)
                +"-- Validation --"
                +JSON.stringify(d)
                +"BZ-End-Validating");
    let rr= !!_extractData._checkData(v,d,r)
    if(!rr){
      if(window.$result){
        window.$result.msg=JSON.stringify(r,0,2)
      }
    }
    return rr
  },
  extendExtensionScript:function(c,_pos){
    let d={bz:1}
    if(_pos=="end"){
      _pos="extendEndScript"
    }else{
      _pos="extendTopScript"
    }
    d[_pos]=`try{${c}}catch(ex){alert(ex.message)}`
    bzComm.postToBackground({
      fun:"setTmpCode",
      scope:"bzUtil",
      ps:[_pos,c]
    })
  },
  extendExceptionScript:function(c,_pos){
    return $util.extendExtensionScript(c,_pos)
  },
  removeDuplicateData:function(d){
    if(d&&d.constructor==Array){
      let v,_idx=d.length-1;
      while(_idx>=0){
        v=d[_idx]
        for(let i=0;i<_idx;i++){
          if(_Util._isSameObj(d[i],v)){
            d.splice(_idx,1)
            break
          }
        }
        _idx--
      }
    }else if(d&&d.constructor==Object){
      Object.keys(lws).forEach(k=>{
        if(!lws[k]){
          delete lws[k]
        }
      })
    }
  },
  attachScreenshotToReport:function(v){
    v=v||["BZ.TW.document","BODY",0]
    let _curBack
    $util.takeScreenshot(v,(x)=>{
      $util.attachInfoToReport(x)
      _curBack&&_curBack()
    })
    return function(_back){
      _curBack=_back
    }
  },
  attachInfoToReport:function(v){
    window._ideReport&&_ideReport._attachInfo(v)
  },
  jsonToXML:function(_obj,_root) {
    if(!_root||_root===1){
      _root="data"
    }
    let _xml = '';
    for (let _prop in _obj) {
      let v=_obj[_prop]
      if(v&&v.constructor==Function){
        continue
      }
      _xml += v instanceof Array ? '' : "<" + _prop + ">";
      if (v instanceof Array) {
        for (let _array in v) {
          _xml += "<" + _prop + ">";
          _xml += $util.jsonToXML(new Object(v[_array]),1);
          _xml += "</" + _prop + ">";
        }
      } else if (typeof v == "object") {
        _xml += $util.jsonToXML(new Object(v),1);
      } else {
        _xml += v;
      }
      _xml += v instanceof Array ? '' : "</" + _prop + ">";
    }
    _xml=_xml.replace(/<\/?[0-9]{1,}>/g, '');
    if(_root&&_root!==1){
      _xml=`<${_root}>${_xml}</${_root}>`
    }
    return _xml
  },
  xmlToJson:function(x) {
    let j = {},cj,ps=[j],k;
    let xo=x.match(/<[^< \n>]+(>| |\n)/g);

    if(xo){
      xo.forEach(o=>{
        let i=x.indexOf(o)
        if(i){
          let xx=x.substring(0,i).trim();
          x=x.substring(i)
          if(xx[xx.length-1]==">"){
            xx=xx.substring(0,xx.length-1).trim()
            _addNode(k)
            k=""
            if(xx.endsWith("/")){
              xx=xx.substring(0,xx.length-1).trim()
              _parseProperties(xx,j)
              ps.shift()
              j=ps[0]
            }else{
              _parseProperties(xx,j)
            }
          }else{
            if($.isNumeric(xx)){
              j[k]=parseFloat(xx)
            }else{
              j[k]=xx
            }
            k=""
          }
        }
        x=x.substring(o.length).trim()

        if(o[0]=="<"){
          o=o.substring(1)
        }
        if(o[o.length-1]==">"){
          o=o.substring(0,o.length-1)
        }
        if(o[o.length-1]=="/"){
          return
        }
        if(o[0]=="/"){
          o=_glossaryHandler._getVariableName(o.substring(1),0,1)
          if(ps[1]&&(ps[1][o]==j||(ps[1][o]&&ps[1][o].constructor==Array&&ps[1][o].includes(j)))){
            ps.shift()
            j=ps[0]
          }
          return
        }else{
          if(k){
            _addNode(k)
          }
          k=_glossaryHandler._getVariableName(o,0,1)
        }
      })
    }
    return j;

    function _addNode(k){
      let d={}
      if(j[k]){
        if(j[k].constructor!=Array){
          j[k]=[j[k]]
        }
        j[k].push(d)
      }else{
        j[k]=d
      }
      j=d
      ps.unshift(d)
    }

    function _parseProperties(xx,j){
      let xxo=xx.match(/[^\s=]+=\s*"/g)
      if(xxo){
        let k;
        xxo.forEach(o=>{
          if(k){
            let i=xx.indexOf(o)
            let v=xx.substring(0,i)
            xx=xx.substring(i)
            _parseValue(v,j,k)
          }
          xx=xx.substring(o.length)
          o=o.substring(0,o.length-1).trim()
          o=o.substring(0,o.length-1)
          k=o=_glossaryHandler._getVariableName(o,0,1)
        })
        _parseValue(xx,j,k)
      }
    }

    function _parseValue(v,j,k){
      v=v.trim()
      if(v){
        j[k]=v.substring(0,v.length-1)
        if($.isNumeric(j[k])){
          j[k]=parseFloat(j[k])
        }
      }
    }
  },
  resetClient:function(){
  },
  getHostIdxByUrl:function(_url){
    _url=_url||location.href
    return BZ._getHostList().findIndex(x=>_Util._isSameHost(x.host,_url))
  },
  openApp:function(_url){
    TWHandler._openUrl(_url)
  },
  isMatch:function(d1,d2){
    if(d1==d2){
      return !0
    }else if(d1=="bz-skip"||d2=="bz-skip"){
      return !0
    }else if(d1&&d2&&d1.constructor==d2.constructor){
      if(d1.constructor==Array){
        if(d1.length==d2.length){
          for(let i=0;i<d1.length;i++){
            if(!$util.isMatch(d1[i],d2[i])){
              return !1
            }
          }
          return !0
        }
        return !1
      }else if(d1.constructor==Object){
        for(let k in d1){
          if(!$util.isMatch(d1[k],d2[k])){
            return !1
          }
        }
        for(let k in d2){
          if(d1[k]===undefined){
            return !1
          }
        }
        return !0
      }
      return d1==d2
    }else if(d1&&d1.constructor==Array&&d1.length&&d2&&d2.constructor==Object){
      return !d1.find(x=>{
        return !$util.isMatch(x,d2)
      })
    }
    return !1
  },
  //search d1 in d2
  includes:function(d1,d2){
    if(d1==d2){
      return 1
    }else if($util.isMatch(d1,d2)){
      return 1
    }
    if(!d2){
      return
    }else if(d2.constructor==Array){
      if(!d1||![Object,Array].includes(d1.constructor)){
        return d2.find(x=>x==d1)
      }else if(d1.constructor==Object){
        return d2.find(x=>$util.includes(d1,x))
      }
      return !d2.find(x=>!$util.includes(x,d1))
    }else if(d2.constructor==Object){
      if(!d1||![Object,Array].includes(d2.constructor)){
        return
      }else{
        for(let k in d2){
          if($util.includes(d1,d2[k])){
            return 1
          }
        }
      }
    }
  },
  getElementValue:function(e,fun){
    if(fun){
      return fun(e)
    }
    let os=$(e).find("input,textarea,select").toArray()
    let v;
    if(!os.length){
      if($(e).is("input,textarea,select")){
        os=[e]
      }
    }
    os.forEach(x=>{
      if(x.type=="radio"){
        if(x.selected){
          v=x.value
        }
      }else if(x.type=="checkbox"){
        if(x.checked){
          v=x.value||"on"
        }
      }else if(x.tagName=="SELECT"){
        v=v||""
        for(a of x.selectedOptions){
          v+=","+a.text
        }
        v=v.substring(1)||""
      }else if(x.getBoundingClientRect().width){
        let vv=x.value
        if(!v||vv.length>v.length){
          v=vv
        }
      }
    })
    if(v===undefined){
      v=e.innerText.trim()
    }
    return v
  },
  //getLanguage
  // getLanguage:function(){
  //   return BZ._data._uiSwitch._curAppLanguage
  // },
  //translate
  // translate:function(v){
  //   let i=_IDE._data._setting.appLanguages.indexOf(BZ._data._uiSwitch._curAppLanguage)
  //   if(i){
  //     let w=_appWordHandler._wordMap[v]
  //     if(w){
  //       return w[i-1]||v
  //     }
  //   }
  //   return v
  // },
  //randomItem
  randomItem:function(d){
    let i=Math.floor(Math.random()*Object.keys(d).length)
    let k=Object.keys(d)[i]
    return {key:k,value:d[k]}
  },
  //addLogData
  addLogData:function(d){
    _ideTask._logData=_ideTask._logData||[]
    console.log("BZ-LOG: addLogData:")
    for(var i=0;i<arguments.length;i++){
      let v=arguments[i]
      _ideTask._logData.push(v)
      console.log("BZ-LOG: "+JSON.stringify(v))
    }
  },
  //setLogData
  setLogData:function(d){
    _ideTask._logData=[]
    for(var i=0;i<arguments.length;i++){
      _ideTask._logData.push(arguments[0])
    }
  },
  //cleanLogData
  cleanLogData:function(){
    _ideTask._logData=[]
  },
  //log
  log:function(){
    let v=_Util._log(...arguments)
    if(window.extensionContent){
      bzComm.postToIDE({scope:"$console",fun:"output",ps:["App: "+v]});
      return
    }
    $console.output(v)
  },
  //takeScreenshot
  takeScreenshot:function(o,_fun){
    _bzDomPicker._flashTmpCover(o)
    let _callBack
    let f=(bf)=>{
      _callBack=bf
    }
    bzComm.postToBackground({
      scope:"bgUtil",
      fun:"getScreenshot",
      return:(v)=>{
        console.log(v)
        $util._canvas=v
        _fun&&_fun(v)
        _callBack&&_callBack(v)
      },
      insertCallFun:1,
    })
    return f
  },
  //findDataInMap
  findDataInMap:function(map,o){
    for(let k in map){
      let v=map[k],found=1
      if(o){
        for(let kk in o){
          if(o[kk]!=v[kk]){
            found=0
            break
          }
        }
      }
      if(found){
        return v
      }
    }
  },
  // exeTests:function(ts){
  //   console.log(ts)
  //   _ideTask._exeTmpTasks(ts)
  // },
  //formatTimestamp
  formatTimestamp:function(t,f){
    return _Util._formatTimestamp(t,f)
  },
  addDate:function(d,v,u,f){
    if(d.constructor==String){
      d=new Date(d.replace(/(^|-|\/)([0])/g,"$1"))
    }
    if(u=="y"||u=="year"){
      d.setFullYear(d.getFullYear()+v)
    }else if(u=="m"||u=="month"){
      d.setMonth(d.getMonth()+v)
    }else if(u=="d"||u=="date"){
      d.setDate(d.getDate()+v)
    }
    if(f){
      d=$util.formatTimestamp(d.getTime(),f)
    }
    return d
  },
  parseBoolean:function(v){
    return !!v&&!v.toString().match(/^(false|0|off|undefined|null)$/i)
  },
  //getScenariosByTag
  getScenariosByTag:function(ts){
    return _ideObjHandler._getItemsByTag(ts,"scenario",1)
  },
  //getTestsBySuite
  getTestsBySuite:function(t,_fun){
    return _ideObjHandler._getRefTests(t,_fun)
  },
  //downloadFile
  downloadFile:function(_name,_content,_type){
    console.log("BZ-LOG: download-data-file:"+_name)
    _Util._downloadFile(_name,_content,_type)
  },
  //getTestsByTag
  getTestsByTag:function(ts){
    return _ideObjHandler._getItemsByTag(ts,"unit")
  },
  //isEmptyData
  isEmptyData:function(d){
    return d!==0&&(!d||$.isEmptyObject(d))
  },
  //gotoFlag
  gotoFlag:function(s){
    _ideTask._gotoFlag(s)
  },
  //getRoles
  getRoles:function(){
    try{
      let t=BZ._getCurTest(),
          m=BZ._getCurModule()
      
      return _aiAuthHandler._getRolesByHostId(t?t._data.hostId:m?m._data.defaultHostId:0)
    }catch(e){}
    return []
  },
  //getElementText
  getElementText:function(u,_chkSvg){
    if(u.constructor==Array){
      return u.map(v=>$util.getElementText(v,_chkSvg))
    }
  //    return u.innerText?u.innerText.trim():""
    /*
    if(!_back){
      var _time=Date.now()
    }
    */
    if(u.nodeType==3){
      return (u.textContent||"").trim()
    }else if(u.innerText===undefined){
      if(_chkSvg){
        u=$("<div>"+u.outerHTML+"</div>").appendTo(document.body);
        var v=u[0].innerText;
        u.remove()
        return v.trim()
      }else{
        return ""
      }
    }else if(!u.innerText||!u.innerText.trim()){
      return ""
    }
    if(["SCRIPT","NOSCRIPT","STYLE","SELECT","TEXTAREA"].includes(u.tagName)){
      return ""
    }else if(u.tagName=="BR"){
      return "\n"
    }
    var t="",co=0,lo=0,s,r=u.getBoundingClientRect();
    for(var i=0;i<u.childNodes.length;i++){
      var n=u.childNodes[i],tt="";
      if(n.nodeType==1){
        if(!_Util._isHidden(n)){
          tt=$util.getElementText(n,_chkSvg)
          co=n.getBoundingClientRect()
        }else{
          continue
        }
      }else if(n.nodeType==3){
        tt=n.textContent.trim()
        co=0
      }
      if(tt){
        if(lo){
          if(co){
            if(lo.bottom>co.top){
              s="\n"
            }else{
              s=" "
            }
          }else{
            if(lo.width+lo.left>=r.left+r.width-20){
              s="\n"
            }else{
              s=" "
            }
          }
        }else if(t){
          if(co){
            if(co.left==r.left){
              s="\n"
            }else{
              s=" "
            }
          }else{
            s=" "
          }
        }else{
          s=""
        }
        t+=s+tt
      }
    }
    /*
    if(!_back){
      $util._chkFunTime+=Date.now()-_time
    }
    */
    return t.trim()
  },
  //printDataToFile
  printDataToFile:function(f,d){
    if(f.toLowerCase().endsWith("csv")){
      d=_Util._toFileCSV($util.jsonToCSV(d))
    }else if(f.toLowerCase().endsWith("html")){
      d=_Util._toFileCSV(_Util._listToHtml(d))
    }else{
      d=JSON.stringify(d,0,2)
    }
    d=f+"\n"+d.trim()+"\n"
    console.log("BZ-OUTPUT-FILE:"+d+"BZ-OUTPUT-FILE-END")

  },
  //jsonToCSV
  jsonToCSV:function(d){
    if(d&&d.constructor==Array&&d.length){
        return Object.keys(d[0]).join(",")+"\n"+
      d.map(o=>{
        let v=""
        for(var k in o){
            let x=o[k]
            v+=x&&x.constructor==String?'"'+o[k].replace(/\"/g,'""')+'",':o[k]+','
        }
        return v.replace(/,(\n|$)/g,"\n").trim()
      }).join("\n")
    }
    return ""
  },
  //clearCookie
  clearCookie:function(_document){
    _document=_document||document;
    var cookies = _document.cookie.split("; ");
    for (var c = 0; c < cookies.length; c++) {
      var d = window.location.hostname.split(".");
      var _name=encodeURIComponent(cookies[c].split(";")[0].split("=")[0])
      // console.log(_name)
      _document.cookie = _name + '=; Max-Age=-99999999;';
    }
  //    _document.cookie.split(";").forEach(function(c) { _document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); });
  },
  clearLocalStorage:function(_document){
    var _bzData=localStorage.getItem("bz-data");
    localStorage.clear();
    localStorage.setItem("bz-data",_bzData);
  },
  //p: data path. like: "$test.data"
  //resetData
  resetData:function(pp){
    let d,p=pp.split(".")
    switch(p[0]){
      case "$project":d=$data(0,0,1);break;
      case "$module":d=$data(BZ._getCurModule()._data.code,0,1);break;
      case "$test":d=$data(BZ._getCurModule()._data.code,BZ._getCurTest()._data.code,1);break;
      case "$parameter":d=BZ._getCurTest()._data.defParameter;break;
    }
    if(d){
      try{
        if(d.constructor==String){
          d=eval(d)
          _ideDataManagement._initRandomValue(d)
        }
        if(p.length>1){
          for(let i=1;i<p.length;i++){
            d=d[p[i]]
          }
          eval(pp+"=d",{},"set",pp,d)
        }else{
          pp=eval(pp)
          for(var k in d){
            pp[k]=d[k]
          }
        }
      }catch(e){}
    }
  },
  //generateDataByRegex
  generateDataByRegex:function(d,key,dd,kk,_notParseInsertCode){
    let _apiData
    d=_handleData(d,key,dd,kk)
    function _handleData(d,_key,dd,kk){
      if(!d){
      }else if([String,RegExp].includes(d.constructor)){
        let s=d.toString()
        if(s.match(/^[\/].+[\/]$/)){
          d= $util.generateWordsByRegex(s,_key,dd,kk)
        }else{
          d=!_notParseInsertCode&&s.match(/\{\{.+\}\}/)?_JSHandler._prepareData(s):s
        }
        if(d&&!window.extensionContent&&d.constructor==BZApiDataPicker){
          _apiData=d
        }
      }else if([Object,Array].includes(d.constructor)){
        for(var k in d){
          d[k]= _handleData(d[k],k,d,k,1)
        }
      }
      return d
    }
    
    if(_apiData){
      _apiDataHandler._registerExeFun(function(){
        _doIt(d)
      })
    }else{
      _doIt(d)
    }
    return d
    
    function _doIt(d){
      if(dd){
        if(dd.constructor==Function){
          dd(d)
        }else if(kk){
          dd[kk]=d
        }
      }
    }
  },
    /*
    examples:
    let vs=[
      "[a-z]+[0-9]+",
      "BZ-name",
      "{today}",
      "{today-10}",
      "{today+10|MM/dd/yyyy}",
      "{today-1week|MM/dd/yyyy}",
      "{today+w}",
      "{today-1M}",
      "{today+M|MM/dd/yyyy}",
      "{today-1Y}",
      "{today+Y|MM/dd/yyyy}",
      "{today+10y+2M+1|MM/dd/yyyy}",
      "{this-month-first}",
      "{this-month-first+10|MM/dd/yyyy}",
      "{this-month-first+10M-2}",
      "{date:08/30/2020|MM/dd/yyyy|yyyy-MM-dd}",
      "{date:08/30/2020+y+1|MM/dd/yyyy|yyyy-MM-dd}",
      "{this-month,3}",
      "{date:08/20/2020+y+2M+12+7m+33s+3h|MM/dd/yyyy|yyyy-MM-dd hh:mm:ss}",
      "{last-month-first+y+2M+12+7m+33s+3h|MM/dd/yyyy|yyyy-MM-dd hh:mm:ss}"
    ]
    vs.forEach(v=>{
      console.log(v+": "+$util.generateWordsByRegex("/"+v+"/"))
    })
    */
  //generateWordsByRegex
  generateWordsByRegex(r,_key,_ddd,_kkk){
    try{
      if(!r){
        return _return(r)
      }
      r=r.toString()
      
      if(_Util._hasInsertCode(r)){
        r=_JSHandler._prepareData(r)
        return _return(r)
      }else if(_Util._hasCode(r)){
        r=eval(r)
        return _return(r)
      }
      
      if(r[0]=="/"&&r[r.length-1]=="/"){
        r=r.substring(1,r.length-1)
      }
      if(r[0]=="/"&&r[r.length-1]=="/"){
        return _return("/"+r+"/")
      }
      r=_Util._getRegexByBZName(r)
      let _std=r.match(/\{(label|random:?|search[\: ]|search-list[\: ]|new[\: ]|exist-new[\: ]|exist[\: ]|exist-list[\: ]|date[\: ]|time[\: ]|num|time|date|module|this|next|last|today|tomorrow|yesterday|timestamp|textstamp|longtextstamp)[^\}]*\}/g)
      if(_std){
        if(_std[0]=="{label}"){
          return _Util._idToName($util.generateWordsByRegex(r.replace("{label}",_key||_bzMessage._common._description)));
        }else if(_std[0]&&_std[0].startsWith("{random")){
          return _return(_getRandom(_std[0]))
        }else if(_std[0]&&_std[0].startsWith("{exist")){
          console.log("BZ-LOG: "+_std[0])
          let v= _return(_getExist(_std[0]))
          return v
        }else if(_std[0]&&_std[0].startsWith("{new")){
          console.log("BZ-LOG: "+_std[0])
          return _return(_getCreate(_std[0]))
        }else if(_std[0]&&_std[0].startsWith("{search")){
          console.log("BZ-LOG: "+_std[0])
          return _return(_getSearch(_std[0]))
        }
        _std.forEach(s=>{
          let _stdValue=getStandard(s)
          let vs=r.split(s)
          let _result=""
          for(var i=0;i<vs.length;i++){
            _result+=vs[i]
            if(i<vs.length-1){
              _result+=_stdValue
            }
          }
          r=_result
        })
        return $util.generateWordsByRegex(r,_key,_ddd,_kkk)
      }else{
        _std=r.match(/\{data[\: ](.+)\}/)
        if(_std){
          _std=_std[1]
          _std=_std.replace(/[\=\>\<\!]/g,"")
          return _return(_std)
        }else{
          var vs=[];
          var m=1;
          if(m.constructor!=Number){
            m=1
          }
          for(var i=0;i<m;i++){
            vs.push(new RandExp(r).gen())
          }
          vs=vs[0]
          
          return _return(vs)
        }
      }
    }catch(e){}
    
    function _return(v){
      if(_ddd){
        if(_ddd.constructor==Function){
          _ddd(v)
        }else{
          _ddd[_kkk]=v
          if(v&&v.constructor==Promise){
            v.then(x=>_ddd[_kkk]=x)
          }
        }
      }
      return v===null?undefined:v
    }
    function _getRandom(vv){
      let v=vv.split(":")[1]
      if(v){
        v=v.substring(0,v.length-1)
        v=v.split("|")
        if(v[0].match(/^[0-9-\.]+$/)||_Util._hasCode(v[0])){
          return _getRandomNumber(v[0],v[1])
        }else if(v.length>1){
          v=$util.randomItem(v)
          if(v){
            return v.value
          }
        }
      }
      return "/"+vv+"/"
    }
    
    function _getRandomNumber(vv,ee){
      let v1,v2,e,v=vv.split(/[-~]/)
      if(_Util._hasCode(vv)){
        v=vv.split(/~/)
      }
      if(v.length>1){
        v1=parseFloat(_Util._stringToData(v[0]))
        v2=parseFloat(_Util._stringToData(v[1]));
      }else{
        v1=0
        v2=v;
      }
      let vvv=Math.random()*(v2-v1)+v1,l=1;
      if(v[0].match(/[0-9]+\.[0-9]+/)){
        l=v[0].split(".")[1].length
        l=Math.pow(10,l)
      }else if(v[1].match(/[0-9]+\.[0-9]+/)){
        l=v[1].split(".")[1].length
        l=Math.pow(10,l)
      }
      vvv=vvv*l
      v= Math.round(vvv)/l
      if(v>v2){
        v=v2
      }
      if(ee){
        e=ee.split(",")
        if(e.includes(v+"")&&v1!=v2){
          return _getRandomNumber(vv,ee)
        }
      }
      return v
    }
    
    async function _getExist(v){
      let s={};
      if(v.match(/\{exist-list[ :]/)){
        s={_list:1}
        v=v.replace(/\{exist-list[ :](.+)\}/,"$1")
      }else if(v.match(/\{exist-new[ :]/)){
        s={_new:1}
        v=v.replace(/\{exist-new[ :](.+)\}/,"$1")
      }else{
        v=v.replace(/\{exist[ :](.+)\}/,"$1")
      }
      return await _aiAPI._getExistData(v,s,_ddd,_kkk)
    }
    
    async function _getCreate(v){
      let s;
      v=v.replace(/\{new[ \:](.+)\}/,"$1")
      return await _aiAPI._createData(v,_ddd,_kkk)
    }
    async function _getSearch(v){
      let s={};
      if(v.match(/\{search-list[ :]/)){
        s={_list:1}
        v=v.replace(/\{search-list[ :](.+)\}/,"$1")
      }else if(v.match(/\{search-new[ :]/)){
        s={_new:1}
        v=v.replace(/\{search-new[ :](.+)\}/,"$1")
      }else{
        v=v.replace(/\{search[ :](.+)\}/,"$1")
      }
      return await _aiAPI._searchData(v,s,_ddd,_kkk)
    }

    function getStandard(v){
      let now=new Date(),n,d=new Date();
      var y=d.getFullYear(),m=d.getMonth();
      
      v=v.substring(1,v.length-1)
      v=v.split("|")
      if(v.length>1&&v[0].startsWith("date:")){
        return _getDate(v[0],v[1],v[2])
      }
      var w=v[0].match(/[a-z-]+[a-z]/),c;
      if(!w){
        w=v[0]
      }else{
        w=w[0]
        c=v[0].substring(w.length)
      }
      switch(w){
        case "now": 
        case "this":
        case "this-month":
        case "today": 
          break;
        case "num": 
          $project._tmpIdx=$project._tmpIdx||1
          return $project._tmpIdx++
        case "module": 
          let _tmpModule=window._tmpTakeDataModule||BZ._getCurModule()
          if(_tmpModule){
            return _tmpModule._data.name.replace(/[ ,\.-]+/g,"-")
          }
          return "Module"
        case "timestamp": return Date.now();
        case "time": return _Util._formatTimestamp(0,"hh:mm:ss");
        case "date": return _Util._formatTimestamp(0,"yyyy-MM-dd");
        case "this-month-first": 
          d.setDate(1)
          break;
        case "this-month-end":
          d.setDate(_getLastDate(d.getMonth()+1,d.getYear()))
          break;
        case "this-year-first": 
          d.setDate(1)
          d.setMonth(0)
          break;
        case "this-year-end":
          d.setMonth(11)
          d.setDate(31)
          break;
        case "tomorrow": 
          d=new Date(d.getTime()+86400000);
          break;
        case "longtextstamp":
          w=_Util._to62(parseInt(Date.now()/1000))
          if(_cooperatorHandler._data.inService){
            w+=_cooperatorHandler._data.key
          }
          return w
        case "textstamp":
          w=_Util._to36(parseInt(Date.now()/1000))
          if(_cooperatorHandler._data.inService){
            w+=_cooperatorHandler._data.key
          }
          return w
        case "timestamp":
          w=parseInt(Date.now()/1000)+""
          if(_cooperatorHandler._data.inService){
            w+=_cooperatorHandler._data.key
          }
          return w
        case "yesterday":
          d=new Date(d.getTime()-86400000);
          break;
        case "last-year":
          d.setYear(y-1);
          break
        case "last-year-first":
          d.setMonth(0)
          d.setDate(1);
          d.setYear(y-1);
          break
        case "last-year-end":
          d.setMonth(11)
          d.setDate(31);
          d.setYear(y-1);
          break
        case "last-month": 
          if(d.getMonth()){
            d.setMonth(d.getMonth()-1);
          }else{
            d.setMonth(11);
            d.setYear(y-1)
          }
          break
        case "last-month-first": 
          d.setDate(1);
          d.setMonth(d.getMonth()-1);
          break
        case "last-month-end": 
          d.setDate(1);
          if(d.getMonth()){
            d.setMonth(d.getMonth()-1);
          }else{
            d.setMonth(11);
            d.setYear(y-1)
          }
          d.setDate(_getLastDate(d.getMonth()+1,d.getYear()));
          break
        case "last-hour":
          d=new Date(d.getTime()-3600000)
          break
        case "last-minute":
          d=new Date(d.getTime()-60000)
          break
        case "last-second":
          d=new Date(d.getTime()-1000)
          break
        case "last-mon":
          n=6
        case "last-tus":
        case "last-tue":
            n=n||5
        case "last-wed":
          n=n||4
        case "last-thu":
          n=n||3
        case "last-fri":
          n=n||2
        case "last-sat":
          n=n||1
        case "last-sun":
          n=n||7
          d=new Date(d.getTime()-86400000*(n+d.getDay()))
          break
        case "next-year":
          d.setYear(y+1);
          break
        case "next-year-first":
          d.setMonth(0)
          d.setDate(1);
          d.setYear(y+1);
          break
        case "next-year-end":
          d.setMonth(11)
          d.setDate(31);
          d.setYear(y+1);
          break
        case "next-month": 
          d.setMonth(d.getMonth()+1);
          break
        case "next-month-first":
          d.setDate(1);
          d.setMonth(d.getMonth()+1);
          break
        case "next-month-end": 
          d.setMonth(d.getMonth()+1);
          if(d.getMonth()+1==12){
            d.setDate(_getLastDate(0,d.getYear()+1));
          }else{
            d.setDate(_getLastDate(d.getMonth()+1,d.getYear()));
          }
          break
        case "next-hour":
          d=new Date(d.getTime()+3600000)
          break
        case "next-minute":
          d=new Date(d.getTime()+60000)
          break
        case "next-second":
          d=new Date(d.getTime()+1000)
          break
        case "next-mon":
          n=8-now.getDay();
        case "next-tus":
        case "next-tue":
          n=n||9-now.getDay();
        case "next-wed":
          n=n||10-now.getDay();
        case "next-thu":
          n=n||11-now.getDay();
        case "next-fri":
          n=n||12-now.getDay();
        case "next-sat":
          n=n||13-now.getDay();
        case "next-sun":
          n=n||7-now.getDay()
          d=new Date(d.getTime()+86400000*n)
          break
        case "this-mon":
          n=n||1
        case "this-tus":
        case "this-tue":
          n=n||2
        case "this-wed":
          n=n||3
        case "this-thu":
          n=n||4
        case "this-fri":
          n=n||5
        case "this-sat":
          n=n||6
        case "this-sun":
          n=n||0
          if(n){
            d=new Date(now.getTime()+86400000*(n-now.getDay()))
          }else{
            d=new Date(now.getTime()-86400000*now.getDay())
          }
      }
      
      if(c){
        if(c[0]==","){
          //for this month, last month, next month only
          d.setDate(parseInt(c.substring(1)))
        }else{
          d=_countDay(d,c)
        }
      }
      
      
      if(v.length==1){
        v.push(_IDE._data._setting.dateFormat||"yyyy-MM-dd")
      }
      return _Util._formatTimestamp(d.getTime(),v[1].replace(/Y/g,"y").replace(/D/g,"d"));
      // for(var i=1;i<v.length;i++){
        // if(v[i].match(/^[0-9]+$/)){
          // d.setDate(parseInt(v[1]))
        // }else if(v[i].match(/^[0-9]+-[0-9]+$/)){
          // var vv=v[i].split("-")
          // d.setDate(parseInt(vv[1]))
          // d.setMonth(parseInt(vv[0])-1)
        // }else if(v[i]=="end"){
          // d.setDate(_getLastDate(d.getMonth()+1,d.getFullYear()))
        // }else{
          // return v[i].replace(/yyyy/i,d.getFullYear())
                 // .replace(/yy/i,_Util._formatNumberLength(d.getFullYear()%100))
                 // .replace(/MM/,_Util._formatNumberLength(d.getMonth()+1))
                 // .replace(/dd/i,_Util._formatNumberLength(d.getDate()))
                 // .replace(/hh/i,_Util._formatNumberLength(d.getHours()))
                 // .replace(/mm/,_Util._formatNumberLength(d.getMinutes()))
                 // .replace(/ss/i,_Util._formatNumberLength(d.getSeconds()))
                 // .replace(/M/,d.getMonth()+1)
                 // .replace(/d/i,d.getDate())
                 // .replace(/h/i,d.getHours())
                 // .replace(/m/,d.getMinutes())
                 // .replace(/s/i,d.getSeconds())
        // }
      // }
      
    }
    
    function _getLastDate(m,y){
      if([1,3,5,7,8,10,12].includes(m)){
        return 31
      }else if(m==2){
        return y%4?28:29
      }
      return 30
    }
    
    function _countDay(d,v){
      if(v){
        v=v.match(/[+-]([0-9]*y|[0-9]*M|[0-9]*w|[0-9]*d|[0-9]*h|[0-9]*m|[0-9]*s|[0-9]+)/gi)
        v&&v.forEach(vv=>{
          vv=vv.match(/([-+])([0-9]*)(y|Y|M|w|W|h|H|d|D|m|S|s)*/)
          if(!vv[2]){
            vv[2]=1
          }
          v=parseInt(vv[1]+vv[2])
          
          switch(vv[3]){
            case "Y":
            case "y":d.setYear(d.getFullYear()+v);break;
            case "M":d.setMonth(d.getMonth()+v);break;
            case "W":
            case "w":d.setDate(d.getDate()+v*7);break;
            case "H":
            case "h":d.setHours(d.getHours()+v);break;
            case "m":d.setMinutes(d.getMinutes()+v);break;
            case "S":
            case "s":d.setSeconds(d.getSeconds()+v);break;
            case "d":
            case "D":
            default:
              d.setDate(d.getDate()+v)
          }
        })
      }      
      return d
    }
    //d: date, pf: parse date format, ft: format to
    function _getDate(d,pf,ft){
      d=d.substring(5)
      ft=ft||pf
      let f1=pf.split(_Util._allSign),
          f2=pf.split(_Util._allLetterAndNumber),
          d1=d.split(_Util._allSign),
          d2=d.split(_Util._allLetterAndNumber),c,ii=0,i=0,df={},fd="",
          ff=/yyyy|YYYY|yy|YY|MM|M|DD|dd|D|d|HH|H|hh|h|mm|m|SS|ss|S|s/g,
          di=["yy","yyyy","YY","YYYY","MM","M","DD","dd","D","d","HH","hh","H","h","mm","m","SS","ss","S","s"]
          
      _Util._spliceAll(f1,a=>{return !a})
      _Util._spliceAll(f2,a=>{return !a})
      _Util._spliceAll(d1,a=>{return !a})
      _Util._spliceAll(d2,a=>{return !a})
      d1.splice(f1.length)
      d2.splice(f2.length)
      if(f1.length){
        if(f1.length==1){
          i=f1[0].length
        }else{
          i=f1.reduce((v,o)=>{
            return (v.length||v)+(o?o.length:0)
          })
        }
      }
      if(f2.length){
        if(f2.length==1){
          ii=f2[0].length
        }else{
          ii=f2.reduce((v,o)=>{
            return (v.length||v)+(o?o.length:0)
          })
        }
      }
      i+=ii
      c=d.substring(i)
      d=d.substring(0,i)
      
      f1.forEach((v,j)=>{
        v=v.match(ff)
        v&&v.forEach(vv=>{
          if(v.length==1){
            df[vv]=d1[j]
          }else{
            df[vv]=d1[j].substring(0,vv.length)
            d1[j]=d1[j].substring(vv.length)
          }
        })
      })

      // di.forEach(v=>{
        // fd+=df[v]||""
        // if(
      // })
      d=new Date()
      d.setDate(1)
      for(let kk in df){
        let k=kk[0]
        if(k=="D"||k=="d"){
          let v=df[kk]
          delete df[kk]
          df[kk]=v
        }
      }
      for(let kk in df){
        let k=kk[0],
            v=df[kk]
            v=parseInt(v)||v
        switch(k){
          case "Y":
          case "y":
            if(kk.length==2){
              if(v>70){
                v+=1900
              }else{
                v+=2000
              }
            }
            d.setYear(v);
            break;
          case "M":d.setMonth(v-1); break;
          case "D":
          case "d":d.setDate(v);break;
          case "H":
          case "h":d.setHours(v);break;
          case "m":d.setMinutes(v);break;
          case "S":
          case "s":d.setSeconds(v);
        }
      }
      
      d=_countDay(d,c)
      return _Util._formatTimestamp(d.getTime(),ft)
    }
  },
  triggerHover:function(o){
    let cs=_cssHandler._findHoverCssByElement(o)||[]
    cs.forEach(x=>{
      let o=x.o
      o._tmpClass=o._tmpClass||("bz"+_aiAPI._newId())
      $(o).addClass(o._tmpClass)
      let c=x.v.split(":hover")
      let _last=c.pop()
      let _key=c.pop()
      c=c.join("")+_key+"."+o._tmpClass+_last
      let v=x.css.split("{")
      v.shift()
      v="{"+v.join("{")
      o._rule=c+v
      _Util._addCSSRule(o._rule)
    })

    return cs
  },
  //triggerKeyEvents
  triggerKeyEvents:function(o,k,ch,c,a,s,_fun){ //c:ctrl, a:alt, s:shift
        if(_Util._isSysButton(o)&&[13,32].includes(k)){
            return $util.triggerMouseEvents(o,"click",0,0,0,0,0,_fun)
    }

    $(o).focus();
    setTimeout(()=>{
      // o._bzSetKeyPress=0;
      try{
        $util.triggerKeyEvent(o,"keydown",k,ch,c,a,s)
      }catch(e){
        _domActionTask._doLog("util: "+1345+" "+e.stack)
      }
      _exe("_keydownDone",function(){
        if((!c && !a) || _Util._checkBrowserType().name=="firefox"){
          if(_Util._isHidden(o)){
            return _finalFun()
          }
          $util.triggerKeyEvent(o,"keypress",k,ch,c,a,s)
          _exe("_keypressDone",function(){
            if(_Util._isHidden(o)){
              return _finalFun()
            }
            $util.triggerKeyEvent(o,"textInput",k,ch,c,a,s);
            if(_Util._isHidden(o)){
              return _finalFun()
            }
            $util.triggerKeyEvent(o,"input",k,ch,c,a,s);
            if(_Util._isHidden(o)){
              return _finalFun()
            }
            try{
              $util.triggerKeyEvent(o,"keyup",k,ch,c,a,s);
              if(k==9 && ["INPUT","SELECT","A","LINK","BUTTON","TEXTAREA"].includes(o.tagName)){
                _Util._focusNextByTab(o)
              }
            }catch(ex){
            }
            _finalFun()
          })
        }else{
          $util.triggerKeyEvent(o,"keyup",k,ch,c,a,s);
          _finalFun()
        }
      })
    },1)
    function _exe(k,_next,_timer){
      _timer=_timer||Date.now()
      if(o[k]||Date.now()-_timer>50){
        o[k]=0
        console.log("next ...")
        return _next()
      }
      setTimeout(function(){
        console.log(k)
        _exe(k,_next,_timer)
      },1)
    }
    
    function _finalFun(){
      _fun&&_fun()
    }
  },
  //triggerKeyEvent
  triggerKeyEvent:function(o,e,k,ch,c,a,s){
    if(!o){
      return
    }

    $(o).focus()
    o._bzKey=ch
    o._bzKeyCode=k
    if(ch&&o.maxLength&&o.maxLength>0&&o.maxLength<=(o.value+"").length){
      return
    }
    if(!e.startsWith("key")){
      e="key"+e;
    }
    if(e=="keypress"){
      k=ch;
    }
    if(!o._bzSetKeyPress){
      o._bzSetKeyPress=1;
      
      $(o).keydown(function(_event){
        this._keydownDone=1
        this._bCancel=_event.originalEvent.cancelBubble
      });
      $(o).keypress(function(_event){
        this._keypressDone=1
        if(!this._bCancel && !_event.originalEvent.isTrusted){
          if(this._bzKey && (this.tagName=="TEXTAREA" || (this.tagName=="INPUT" && this._bzKey))){
            this.value+=String.fromCharCode(this._bzKey);
          }else if(this._bzKeyCode==13 && ["INPUT","SELECT"].includes(this.tagName)){
            var f=_Util._getParentByTagName(this,"FORM")
            if(f){
              var o=$(f).find("input[type=submit]")[0]
              if(o){
                f.submit()
              }else{
                f.dispatchEvent(new Event("submit"));
              }
            }
          }
        }
        this._bCancel=0
      })
    }
    
  //    if(!window.extensionContent){
  //      var k = new KeyboardEvent(e, {bubbles:true});
  //      Object.defineProperty(k, 'charCode', {get:function(){return e=="keypress"?ch:0;}});
  //      Object.defineProperty(k, 'keyCode', {get:function(){return k;}});
  //      Object.defineProperty(k, 'which', {get:function(){return k;}});
  //      Object.defineProperty(k, 'key', {get:function(){return String.fromCharCode(ch);}});
  //      Object.defineProperty(k, 'code', {get:function(){return 'Key'+String.fromCharCode(ch).toUpperCase();}});
  //      Object.defineProperty(k, 'composed', {get:function(){return true;}});
  //      k.charCodeVal = ch
  //      o.dispatchEvent(k);
  //    }else{
    let _jsPath

    o.focus()
    if(document.activeElement!=o){
            o.bzTmp=_cssHandler._findPath(o)
      _Util._setFindDomJS(o)
    //   _jsPath=o._jsPath
    // }else{
    //   _jsPath="document.activeElement"
    }

    // let _key=k==13?"Enter":k==9?"Tab":k==32?"Space":String.fromCharCode(ch),
    //     _code=k==13?"Enter":k==9?"Tab":k==32?"Space":'Key'+String.fromCharCode("+ch+").toUpperCase()
    // var s="(function(){const o="+_jsPath+";const k = new KeyboardEvent('"+e+"', {bubbles:true}); "
    //      +"Object.defineProperty(k, 'charCode', {get:function(){return "+(e=="keypress"?ch:0)+";}});"
    //      +"Object.defineProperty(k, 'keyCode', {get:function(){return "+k+";}});"
    //      +"Object.defineProperty(k, 'which', {get:function(){return "+k+";}});"
    //      +"Object.defineProperty(k, 'key', {get:function(){return '"+_key+"';}});"
    //      +"Object.defineProperty(k, 'code', {get:function(){return '"+_code+"';}});"
    //      +"Object.defineProperty(k, 'composed', {get:function(){return true;}});"
    //      +"k.charCodeVal = "+(ch||0)+";"
    //      +"o.dispatchEvent(k);})();"
    // var d=o.ownerDocument.createElement("script");
    // d.innerHTML=s;
    // o.ownerDocument.body.parentNode.append(d);
    // d.remove()
    setTimeout(()=>{
      o._keydownDone=1
    },10)
  //    }
    
  },
  //o:element, e:event, b:button, x, y, c:ctrlKey, a:alt, s:shift, t:target,tr:dataTransfer
  //triggerMouseEvent
  triggerMouseEvent:function(o,e,b,x,y,c,a,s,tr,_fun){
    if(!o){
      return
    }else if(o.constructor==Array){
      o.forEach(oo=>{
        $util.triggerMouseEvent(oo,e,b,x,y,c,a,s,tr)
      })
      return _fun&&_fun()
    }

    var _curWin=_Util._getWindowFromDom(o);
    if(o.tagName=="CANVAS"&&o.bzTxtElement&&(["click","mousedown","dblclick"].includes(e)||("mouseup"==e&&x==-1&&y==-1))){
      let r=o.getBoundingClientRect(),
          te=o.bzTxtElement;
      if(o._offset){
        x=o._offset.x
        y=o._offset.y
      }else{
        x=r.left+te.x+te.w/2
        y=r.top+te.y+te.h/2
      }
    }
    b=parseInt(b||1);
    x=parseInt(x||0)
    y=parseInt(y||0)
    if(b==2 && e=="click"){
      e="contextmenu"
    }else if(e=="click"){
      b=0
    }
    var ps={
      'view': _curWin,
      'bubbles': true,
      //composedPath:$util.getComposedPath(o),
      'cancelable': true,
      buttons:parseInt(b),
      ctrlKey:c,
      metaKey:false,
      altKey:a,
      shiftKey:s,
      clientX:x,
      clientY:y,
      pointerX:x,
      pointerY:y,
      relatedTarget:null
    },_event
    if(tr){
      ps.dataTransfer=tr;
      ps.target=o;
      _event = new DragEvent(e, ps);
    }else{
      _event = new MouseEvent(e, ps);
    }
    o.dispatchEvent(_event);
    if(e=="mouseover"){
      o.dispatchEvent(new MouseEvent("mouseenter",ps));
    }else if(e=="mousedown"){
      o.dispatchEvent(new MouseEvent("pointerdown",ps));
    }else if(e=="mouseup"){
      o.dispatchEvent(new MouseEvent("pointerup",ps));
    }else if(e=="mousemove"){
      o.dispatchEvent(new MouseEvent("pointermove",ps));
    }
    if(_fun){
      _fun()
    }
  },
  // getComposedPath:function(o){
    
  // },
  //triggerFocusEvent
  triggerFocusEvent:function(o){
    var _event=new FocusEvent("focus")
    o.dispatchEvent(_event)
  },
  //triggerWheelEvent
  triggerWheelEvent:function(o,x,y,z,c,a,s){
    var _event = new WheelEvent({
      'view': _curWin,
      'bubbles': true,
      'cancelable': true,
      ctrlKey:c,
      metaKey:false,
      altKey:a,
      shiftKey:s,
      deltaX:v,
      deltaY:v,
      deltaZ:v
    });
    o.dispatchEvent(_event);
    
  },
  //triggerDblClickEvents
  triggerDblClickEvents:function(o,b,x,y,c,a,s){
    $util.triggerMouseEvents(o,b,x,y,c,a,s)
    $util.triggerMouseEvents(o,b,x,y,c,a,s)
    $util.triggerMouseEvent(o,"dblclick",b,x,y,c,a,s);
  },
  //triggerMouseEvents
  triggerMouseEvents:function(o,b,x,y,c,a,s,_fun){
    x=x||1
    y=y||1
    let _focus=$(":focus")[0]
    this.triggerMouseEvent(o,"mouseenter",0,x,y,c,a,s);
    this.triggerMouseEvent(o,"mouseover",0,x,y,c,a,s);
    this.triggerMouseEvent(o,"mousemove",0,x,y,c,a,s);
    this.triggerMouseEvent(o,"mousedown",b,x,y,c,a,s);
    if(o.tagName=="CANVAS"&&o.bzTxtElement){
      this.triggerMouseEvent(o,"mouseup",b,-1,-1,c,a,s);
    }else{
      this.triggerMouseEvent(o,"mouseup",b,x,y,c,a,s);
    }
    this.triggerMouseEvent(o,"click",b,x,y,c,a,s);
    let _focus2=$(":focus")[0]
    if(_Util._isFocusable(o)){
      if(!_focus2||_focus2==_focus){
        this.triggerFocusEvent(o)
      }
    }else if(_focus2){
      _focus2.blur()
    }
    if(_fun){
      _fun()
    }
  },
  //triggerChangeEvent
  triggerChangeEvent:function(o,v,_blur,_result,_withEnter,_withSubmit,_fun,_noAutoSelect){
    if(!_withEnter&&!_withSubmit&&o.tagName=="INPUT"&&o.type!="file"){
      _Util._preTriggerEvent()
    }else{
      _noAutoSelect=1 
    }
    var ff,ov=v;

    o.focus()
    _doIt()
    // $util.triggerMouseEvents(o,1,0,0,0,0,0,function(){
    //   setTimeout(()=>{
    //   },v=="christina@pivohub"?3000:0)
    // })
  //    o.value=this._getRealWord(o,v);
    function _doIt(){
      try{
        if(!_Util._isStdInputElement(o)){
          if(!o.attributes["contenteditable"]&&(!v||$util.getElementText(o).includes(v)||v.startsWith("/{random"))){
            return $util.triggerMouseEvents(o,1,0,0,0,0,0)
          }else if(o.attributes["contenteditable"]){
            o.innerHTML=v;
          }
        }else if(o.tagName=="SELECT"){
          v=v.toLowerCase().trim()
          var _best=0,_found;
          for(var i=0;i<o.options.length;i++){
            var t=o.options[i].text || o.options[i].textContent||"";
            t=t.toLowerCase()
            if(v==t){
              o.options[i].selected=_found=true;
              break
            }else if(v.includes(t)){
              if(t.length>_best){
                _best=t.length
                o.options[i].selected=_found=true;
              }
            }else if(t.includes(v)){
              if(v.length>_best){
                _best=v.length
                o.options[i].selected=_found=true;
              }
            }
          }
          if(!_found&&_result){
            _result._type=2;
            _result._msg=_Util._formatMessage(_bzMessage._action._setValueFailed,[ov])
          }
        }else if(o.type=="file"){
          _uploadHandler._setFileValue(o,v);
        }
        
        try{
          if(o.type!="file"){
            //trigger react event
            if(o.tagName=="INPUT"){
              o.value=v
              var nativeInputValueSetter = Object.getOwnPropertyDescriptor(o.ownerDocument.defaultView.HTMLInputElement.prototype, "value").set;
              nativeInputValueSetter.call(o,v);
            }else if(o.tagName=="TEXTAREA"){
              o.value=v
              var nativeInputValueSetter = Object.getOwnPropertyDescriptor(o.ownerDocument.defaultView.HTMLTextAreaElement.prototype, "value").set;
              nativeInputValueSetter.call(o,v);
            }else if(o.tagName!="SELECT"){
              if(o.value!=v){
                o.value=v
              }
            }
          }
          var event = new Event("input", { bubbles: true });
          o.dispatchEvent(event);
        }catch(e){
          _domActionTask._doLog("util 1664: "+e.message)
          _domActionTask._reportAppInfo("error on Set: "+e.stack)
        }
        try{
          var event = new Event("change", { bubbles: true });
          o.dispatchEvent(event);
        }catch(e){
          console.log(e.stack);
        }
        if(_withEnter){
                    return $util.triggerKeyEvents(o,13,0,false,false,false,function(){
                        _doFinal()
          });
        }else if(_withSubmit){
          let _form=_Util._getParentElementByCss("form",o)
          if(_form){
                        _doFinal()
            _form.submit()
            return
          }
                    _doFinal()
        }else if(!_noAutoSelect){
                    return _autoClickMenuAfterSetValue(v,o,_doFinal)
        }else{
                    return _doFinal()
        }
      }catch(eee){
                _domActionTask._doLog("util: "+eee.stack)
        console.log(eee.stack);
        _doFinal()
      }
    }

    // 
    function _doFinal(){
            if(_blur){
                $util.triggerBlurEvent(o);
      }
      _domActionTask._doLog("util: "+1709+(_fun?1:0))
      if(_fun){
        let _tmp=_fun
        _fun=0
        _tmp()
      }
      
    }
    function _autoClickMenuAfterSetValue(v,dom,_afterFun){
            if(!_handleDiff(v,dom,_afterFun)){
        if(!_Util._isHidden(dom)){
                    $util.triggerKeyEvents(dom,null,null,false,false,false,_afterFun);
        }else{
                    _afterFun&&_afterFun()
        }
        setTimeout(()=>{
          if(!_Util._isHidden(dom)){
                        _handleDiff(v,dom)
          }
        },50)
      }else{
              }
    }

    function _handleDiff(v,dom,_afterFun){
      try{
        let _diff=_Util._getDiffAfterTriggerEvent()
        if(_diff){
          _diff=$(_diff).find(`:Contains(${v})`).toArray()
          if(_diff.length){
            _diff=_diff.filter((x,i)=>{
              if(_diff.length-i>1){
                return !$(_diff[i]).find(_diff[i+1])[0]&&x.getBoundingClientRect().width>20
              }else{
                return 1
              }
            })
            if(_diff.length){
              let ds=_diff.filter(x=>x.getBoundingClientRect().width&&x.innerText.trim())
              if(!ds.length){
                return
              }else{
                _diff=ds
              }
              ds=_diff.filter(x=>x.innerText.trim().toLowerCase().startsWith(v.toLowerCase()))
              if(ds.length){
                _diff=ds
              }
              if(_diff.find(x=>{
                if(_Util._isInMenu(x,o)){
                  _domActionTask._doLog("Click menu: "+x.outerHTML)
                  $util.triggerMouseEvents(x,1,0,0,0,0,0,function(){
                                        $util.triggerKeyEvents(dom,null,null,false,false,false,_afterFun);
                  })
                  return 1
                }
              })){
                return 1
              }
            }
          }
        }
      }catch(ex){
        _domActionTask._reportAppInfo("Set input 88: "+ex.message+"\n"+ex.stack)
      }
    }
  },
  //triggerBlurEvent
  triggerBlurEvent:function(o,_fun){
    setTimeout(function(){

      if(window.extensionContent){
        _Util._getWindowFromDom(o).focus();
        var _path=_Util._getQuickPath(o)
        window.postMessage({bz:1,_script:"var bzBlur=_Util._getElementByQuickPath('"+_path+"');try{$(bzBlur).blur()}catch(e){bzBlur&&bzBlur.blur()}"}, "*");
      }else{
        var _curWin=_Util._getWindowFromDom(o);
        $(o).blur();
        if(_curWin.angular){
          var e=_curWin.angular.element(o);
          if(e.blur){
            e.blur();
          }
          if(e.triggerHandler){
            e.triggerHandler("blur");
          }
        }
      }
      _fun&&_fun()
    },30)
  },
  findDoms:function(p){
    let o=_Util._findDoms(p)
    return o.toArray?o.toArray():o
  },
  //findDom
  findDom:function(paths,_errOnHidden){
    var os=_Util._findDoms(paths,_errOnHidden)
    if(os){
      os=os[0]
    }
    return window.$element=os
  },
  getParameterFromUrl:function(k,_url){
    let p={}
    _url=(_url||location.search).substring(1)
    _url.split("&").forEach(function(v){
      v=v.split("=")

      if(v[0]){
        p[v[0]]=v[1]
      }
    })
    return k?p[k]:p
  },
  //isDomExist
  isDomExist:function(p){
    return Boolean($util.findDom(p))
  },
  //nextKey
  // nextKey:function(d,ck){
  //   var _bNext=!ck && ck!=0;
  //   for(var k in d){
  //     if(k==ck){
  //       _bNext=true;
  //     }else if(_bNext){
  //       return k;
  //     }
  //   }
  //   return null;
  // },
  //getCurEnvironment
  getCurEnvironment:function(){
    var v= _Util._clone(BZ._curEnv)
    v.items.forEach((o,i)=>{
      let t=_aiAuthHandler._data[i]
      if(t){
        o.token=t.tokenValue
      }
    })
    return v;
  },
  getTokenByHostId:function(i){
    if(i===undefined){
      i=BZ._getCurTest()
      if(i){
        i=i._data.hostId
        i=_aiAuthHandler._getTokenHostIdxByUIHostIdx(i)
      }
    }
    return _aiAuthHandler._getToken(i||0)
  },
  setToken:function(v,i){
    if(v){
      if(v.constructor==String){
        v=v.trim()
        v.replace(/^authorization[^a-z0-1](.+)/i,"$1");
        v={
          Authorization:v
        }
      }
      if(i===undefined){
        i=_IDE._getDefaultAPIHostIdx()||0
      }
      _aiAuthHandler._setToken({
        tokenValue:v,
        _tokenHost:i
      })
    }
  },
  //removeToken
  removeToken:function(i){
    $aiAPI.removeToken(i)
  },
  //getCurEnvironmentIdx
  getCurEnvironmentIdx:function(){
    return _IDE._data._setting.curEnvironment
  },
  //setEnvironment
  setEnvironment:function(v){
    _IDE._data._setting.curEnvironment=v
    BZ._curEnv=_IDE._data._setting.environments[v];
    BZ._setSharedData({
      "BZ._curEnv":BZ._curEnv,
      "_IDE._data._setting.curEnvironment":_IDE._data._setting.curEnvironment
    })
  },
  //getCoopStatus
  getCoopStatus:function(d,n){
    return _cooperatorHandler._getCoopStatus(d,n)
  },
  //getCoopStatus
  getCoopStatus:function(d,n){
    return _cooperatorHandler._getCoopStatus(d,n)
  },
  //getCoopStatus
  getCoopStatus:function(d,n){
    return _cooperatorHandler._getCoopStatus(d,n)
  },
  //getCoopKey
  getCoopKey:function(){
    return _cooperatorHandler._data.key||0
  },
  //getCoopScope
  getCoopScope:function(){
    return _cooperatorHandler._data.inService?_cooperatorHandler._data.scope:""
  },
  //getCoopGroup
  getCoopGroup:function(){
    return _cooperatorHandler._data.inService?_cooperatorHandler._data.group:""
  }
}
/*******************************************************************************
//AI Functions
*******************************************************************************/
$aiAPI={
  // getModelAlias:function(o){
  //   if(o.constructor!=String){
  //     o=_descAnalysis._retrieveTextForElementPathItem(_cssHandler._findPath(o))||_descAnalysis._retrieveTextForElementPathItem(_cssHandler._findInputPath(o))||""
  //   }
  //   return _Util._toCamelWords(_Util._toSingularWord(o))
  // },
  //To generate test case by parameter: key
  getAccessTest:function(p,m){
    return _aiAPI._getAccessTest(p,m)
  },
  isSkipValue:function(v){
    return _aiAPI._isSkipValue(v)
  },
  deleteRef:function(d,k,m){
    _aiAPI._deleteRef(d,k,m)
  },
  //updateDataStatus
  updateDataStatus:function(data,step){
    _aiAPI._updateDataStatus(data,step)
  },
  //getExeSolutionByParameter
  getExeSolutionByParameter:function(p,toCreate){
    return _aiAPI._getExeSolutionByParameter(p,toCreate)||[]
  },
  async getExistData(express,takeList,data,key){
    if(takeList&&takeList.constructor!=Object){
      takeList={_list:1}
    }
    return await _aiAPI._getExistData(express,takeList||{},data,key)
  },
  searchData:function(express,takeList,data,key){
    if(takeList&&takeList.constructor!=Object){
      takeList={_list:1}
    }
    _aiAPI._searchData(express,takeList||{},data,key)
  },
  searchOrNewData:function(express,data,key){
    _aiAPI._searchData(express,{_new:1},data,key)
  },
  newData:function(express,data,key){
    _aiAPI._createData(express,data,key)
  },
  async initCurModuleData(fun){
    let d=_IDE._data._curModule._data
    return await _aiAPI._getExistData(d.alias||d.code,{_list:1},fun)
  },
  //removeToken
  removeToken:function(i){
    return _aiAPI._removeToken(i)
  },
  //addData
  addData:function(p,m,k){
    return _aiAPI._addData(p,m,k)
  },
  getModuleDataMap:function(m){
    return _aiAPI._getSysCtrlDataMap(m)
  },
  //updateData
  updateData:function(p,m,k){
    return _aiAPI._updateData(p,m,k)
  },
  //deleteData
  deleteData:function(p,m,k){
    return _aiAPI._deleteData(p,m,k)
  },
  rebuildData:function(d){
    return _aiAPI._rebuildData()
  },
  removeData:function(m,d){
    return _aiAPI._removeData(m,d)
  },
  //preHandleParameter
  preHandleParameter:function(p,t,m){
    return _aiAPI._preHandleParameter(p,t,m)
  },
  //getAllDataOfCurModule
  getAllDataOfCurModule:function(p){
    return _aiAPI._getAllDataOfCurModule(p)
  },
  //getAllRelatedDataOfCurModule
  getAllRelatedDataOfCurModule:function(m,mc){
    return _aiAPI._getAllRelatedDataOfCurModule(m,mc)
  },
  //stopRegexAction
  // stopRegexAction:function(r,p,k){
  //   return _aiAPI._stopRegexAction(r,p,k)
  // },
  //getCurRefModuleData
  // getCurRefModuleData:function(d,dn,k){
  //   return _aiAPI._getCurRefModuleData(d,dn,k)
  // },
  //assignCurtUser
  assignCurtUser:function(p){
    return _aiAPI._assignCurtUser(p)
  },
  //getAuthFlowByRole
  getAuthFlowByRole:function(t){
    return _aiAPI._getAuthFlowByRole(t)
  },
  getAccount:function(d,p){
    if(p&&p.constructor==Object){
      return p
    }
    return d.find((x,i)=>{
      if(!p){
        return 1
      }else if(p.constructor==String){
        return x.role==p
      }else{
        for(var k in p){
          if(p[k]!=x[k]){
            return
          }
        }
        return 1
      }
    })||d.find(x=>x.username==p)
  },
  //overwriteExistValue
  overwriteExistValue:function(d){
    return _aiAPI._overwriteExistValue(d)
  },
  //parseInnerData
  parseInnerData:function(d){
    return _aiAPI._parseInnerData(d)
  },
  getModuleDataById:function(v,m){
    return _aiAPI._getModuleDataById(v,m)
  },
  retrieveExistData:function(m,f,d){
    return _aiAPI._retrieveExistData(m,f,d)
  },
  toJSONParameter:function(v,fn,_insertIgnoreSubmit){
    v=v===null||v===undefined?{}:v
    if(v.constructor!=Object){
      let vv={}
      vv[fn]=v
      v=vv
    }
    if(_insertIgnoreSubmit){
      v.$ignoreSubmit=1
    }
    return v
  },
  getUpdateParameter:function(d,p){
    let n={}
    for(let k in p){
      if(d[k]!=p[k]){
        n[k]=p[k]
      }
    }
    return n
  }
}
//---------------------------------------------------------------------------------------------//
//Remove output function content
for(let k in $util){
  $util[k].toString=function(){}
}

for(let k in $aiAPI){
  $aiAPI[k].toString=function(){}
}

var __=function(v,c,_tab){
  if(!v){
    if(_IDE._data._curAction){
      BZ._log("_IDE._data._curAction")
    }else if(_IDE._data._curTest){
      BZ._log("_IDE._data._curTest")
    }else if(_IDE._data._curModule){
      BZ._log("_IDE._data._curModule")
    }else{
      BZ._log("_IDE._data._curVersion")
    }
    BZ._log("_IDE._data._curProject,_curVersion,_curModule,_curTest,_curAction,_Util,_CtrlDriver,_setting,_debug")
  }
  v=v||_IDE._data._curAction

  if(!v){
    var t=_IDE._data._curTest,m=_IDE._data._curModule,s=_IDE._data._curVersion.setting;
    var k=BZ._data._curPage._key;
    if(t){
      t=t._data;
      switch (k){
        case "_actions":v=t.actions;break;
        case "_data":v=t.dataMap;break;
      }
    }else if(m){
      v=m._data.dataMap
    }else{
      switch (k){
        case "_defaultData":v=s.defaultData;break;
        case "_service":v=s.service;break;
        // case "_preferences":v=curUser._curProject.setting.subscriptions;break;
        // case "_dictionary":v=s.dictionary;break;
        // case "_objectLib":v=s.objectLib;break;
        case "_contentPolice":v=s.content;break;
        case "_alias":v=s.aliasMap;break;
        case "_record":v=s.record;break;
      }
    }
  }
  if(_tab===undefined){
    _tab=2
  }
  return JSON.stringify(v,c,_tab);
}

function _extendJQuery(){
  if(jQuery.expr[":"].include){
    return
  }
  var _bzExJQueryFun=/\:(attr|Contains|contains|hidden|show|input|data|link|near|panel|afterEqual|after|before|containCss|css|endContains|endEqual|equal|RowCol|rowcol|bz|textElement|blank|Attr|text) *(=|$)/g;

  /**
   * includes other element
   */
  jQuery.expr[":"].include= function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    m=m[3]

    if(!document._include||document._include.k!=m||Date.now()-document._include._time>1000){
      document._include={_time:Date.now(),k:m}
      
      m=m.replace(/\\:/g,":\r")
      let s=m.match(/[\-]? *\{[^\}]+\}/g)||[m]
      s=s.map(x=>{
        let n=x.match(/^([\-]? *)\{/)||""
        if(n){
          n=n[1].trim()
          if(n){
            x=x.substring(1)
          }
        }
        x=x.trim()
        if(x.match(/^\{.+\}$/)){
          x=x.substring(1,x.length-1)
        }

        let v=x.match(_bzExJQueryFun),vs=[]
        if(v){
          v.forEach(y=>{
            let i=x.indexOf(y)
            vs.push(x.substring(0,i))
            x=x.substring(i+y.length)
          })
          vs.push(x)
          x=vs.map((y,i)=>{
            y=y.trim().replace(/[:]\r/g,":")
            if(i){
              let vv=v[i-1].replace(/=$/,"").trim()
              if(y){
                y=vv+"("+y+")"
              }else{
                y=vv
              }
            }
            return y
          }).join("")
        }
        x=$(x).toArray()
        return {n:n,x:x}
      })
      document._include.os=s
    }
    return !document._include.os.find(x=>{
      let xx=$(a).find(x.x)[0]
      return x.n?xx:!xx
    })
  }

  jQuery.expr[":"].text=function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    var v2=m[3].toLowerCase().trim();
    if(!v2){
      return
    }
    v2=v2.replace(/\s+/," ")
    if(a.nodeType!=1){
      return
    }

    if(!document._text||document._text.k!=m[3]||Date.now()-document._text._time>1000){
      let f=document.body;

      // let o=_Util._findLabel(f,v2)

      // if(!o.length&&!_Util._isRegexData(v2)&&!v2.includes("|")){
      //   let vv=_Util._removeSign(v2," ")
      //   o=_Util._findLabel(f,vv,1)
      // }
      // o=o.map(x=>_cssHandler._findCellElement(x.o))

      let o=$(":Contains("+v2+")",f).toArray() 
      o=o.filter((x,i)=>{
        let n=o[i+1]
        return o.tagName=="LABEL"||_Util._isCellElement(o)||!n||!$(x).find(n)[0]
      })
      let _label=o.filter(x=>x.tagName=="LABEL")
      o=o.filter(x=>x.tagName!="LABEL")
      o.unshift(..._label)
      
      if(!o.length||!o.find(x=>x.innerText.trim().toLowerCase()==v2.toLowerCase())){
        let ks=_IDE._data._setting.content.contentAttribute.replace("placeholder","").replace(/\|\|/g,"|")
        let oa=$(`:attr(${ks}=${v2})`).toArray()
        if(!oa.length){
          oa=$(`input:attr(value=${v2})`).toArray()
          ks=["value"]
        }else{
          ks=ks.split("|")
        }
        if(oa.length){
          oa.forEach(x=>x._bzWordLength=_findBestAttrValue(x,ks))
          oa.sort((a,b)=>a._bzWordLength-b._bzWordLength)
          
          o=oa.filter(x=>x._bzWordLength==oa[0]._bzWordLength)
        }
      }

      document._text={
        _time:Date.now(),
        k:m[3],
        as:o
      }
    }

    let as=document._text.as
    return as.includes(a)||$(as).find(a)[0]||(["A","BUTTON"].includes(a.tagName)&&$(a).find(as)[0])
    function _findBestAttrValue(a,ks){
      let aa="";
      ks.forEach(x=>{
        x=a.attributes[x]||{}
        x=x.value
        if(x){
          if(x.toLowerCase().includes(v2.toLowerCase())){
            if(!aa||aa.length>x.length){
              aa=x
            }
          }
        }

      })
      a._bzWordLength=aa.length
      return aa.length
    }
  }

  jQuery.expr[":"].attr=function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    return _chkAttr(a,i,m)
  }

  jQuery.expr[":"].Attr=function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    return _chkAttr(a,i,m,1)
  }

  function _chkAttr(aa,i,m,_full){
    var v2=m[3],a=aa;
    v2=v2.split("=")
    var v1=v2.shift()
    v2=v2.join("=")

    v1=v1.replace("*","").trim()
    v1=v1.split("|")
    return v1.find(v1=>{
      if(v1!="value"){
        a=aa.attributes[v1]
      }
      if(a && a.value){
        try{
          if(_Util._isRegexData(v2)){
            v2=eval(v2)
            return a.value.match(v2)
          }
          if(v2.endsWith("\" i")||v2.endsWith("\i i")){
            v2=v2.substring(1,v2.length-3)
          }
          v2=_Util._filterTxt(v2)
          v2=_Util._trimSpace(v2)
          v1=_Util._filterTxt(a.value)
          
          if(v1==v2||(!_full&&v1.toLowerCase().includes(v2.toLowerCase()))){
            a._bzJq="attr"
            a._bzJqVal=v1
            return true
          }
        }catch(e){
          if(v1==v2){
            a._bzJq="attr"
            a._bzJqVal=_Util._filterTxt(a.value)
            return true
          }
        }
      }
    })
  }

  jQuery.expr[":"].Contains = function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    m=m[3]

    if(!document._Contains||document._Contains.k!=m||!document._Contains._tag.includes(a.tagName)||a._Contains||Date.now()-document._Contains._time>1000){
      // console.log("pre-handle-dom: "+m)
      // console.log("init Contains: "+a.tagName+","+m)
      let v2=m;
      if(!document._Contains||document._Contains.k!=m||Date.now()-document._Contains._time>1000){
        document._Contains=0
      }
      let _inHidden=jQuery._inHidden
      
      let _inRegex=_Util._isRegexData(v2)
      if(_inRegex){
        v2=_Util._getRegexByBZName(v2.substring(1,v2.length-1),1)
        v2=new RegExp(v2,"im")
      }else{
        v2=v2.trim().toLowerCase();
        v2=_Util._filterTxt(v2)
        v2=v2.replace(/\*/g,".*")
      }
      let os=_Util._getElementsByWord(function(w){
        w=(w||"").trim().toLowerCase();
        if(_inRegex){
          return w.match(v2)
        }else{
          w=_Util._filterTxt(w)
          return _Util._includesWord(w,v2,1)
        }
      },a.tagName,document._Contains?document._Contains._inHidden:_inHidden,_Util._getRootDom(a))
      if(document._Contains){
        document._Contains._tag.push(a.tagName)
        document._Contains.os=document._Contains.os.concat(os)
      }else{
        document._Contains={
          _inHidden:_inHidden,
          _tag:[a.tagName],
          k:m,
          os:os,
          _time:Date.now()
        }
        jQuery._inHidden=_inHidden
      }
    }
    return document._Contains.os.includes(a)
  };

  jQuery.expr[":"].hidden= function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    return _Util._isHidden(a)
  }

  jQuery.expr[":"].show= function(a,i,m){
    return true
  }

  jQuery.expr[":"].panel=function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    var v2=_Util._toTrimSign(m[3].toLowerCase());
    if(!v2){
      return
    }
    v2=v2.replace(/\s+/," ")
    if(a.nodeType!=1){
      return
    }

    if(!document._panel||document._panel.k!=m[3]||Date.now()-document._panel._time>1000){
      let os=_cssHandler._findNodeByTxt(document.body,v2),oo=new Set();
      if(!os.length&&!_Util._isRegexData(v2)&&!v2.includes("|")){
        let vv=_Util._removeSign(v2," ")
        os=_cssHandler._findNodeByTxt(document.body,vv,1)
      }
      os.forEach(x=>{
        let ss=[]
        _findPanelByHeader(x,ss)
        ss.forEach(y=>oo.add(y))
      })

      document._panel={
        _time:Date.now(),
        k:m[3],
        as:[...oo],
        _tags:new Set()
      }
    }
    
    return document._panel.as.includes(a)
    function _findPanelByHeader(x,ss){
      let e=x.e,
  //        c=_cssHandler._getUniqueClass(x.o),
          f=_cssHandler._retrieveFontInfo(x.o),
          _start,_hasPreHeader,
          pp=_cssHandler._getBetterParent(x.e);
      while(e.parentElement){
        let p=e.parentElement
        for(let c of p.children){
          if(c==e){
            _start=1
            ss.push(c)
          }else if(!_Util._isHidden(c)){
            if(_start){
              
              let os=$(c).find(x.o.tagName).toArray()
              if(x.o.tagName==c.tagName){
                os.unshift(c)
              }
              if(!os.find(y=>{
                if(!_Util._isHidden(y)){
                  y=_cssHandler._retrieveFontInfo(y)
                  return _Util._isSameObj(f,y)
                }
              })){
                ss.push(c)
              }else{
                return ss
              }
            }else{
              _hasPreHeader=1
            }
          }
        }
        if(p==pp||_cssHandler._isFixedAbsoluteElement(p)||p.previousElementSibling||p.tagName=="BODY"){
          if(_hasPreHeader){
            return ss
          }
          ss.length=0
          ss.push(p)
          return ss
        }
        e=p
      }

    }
  }

  jQuery.expr[":"].match=function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    m=m[3]
    if(!_Util._isRegexData(m)){
      m="/"+m+"/"
    }
    m=eval(m)
    return (a.innerText||"").trim().match(m)
    
  }
  jQuery.expr[":"].input=function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    var v2=m[3].toLowerCase().trim();
    if(!v2){
      return
    }
    v2=v2.replace(/\s+/," ")
    if(a.nodeType!=1){
      return
    }

    if($util._tmpFormForSearchingInput||!document._input||document._input.k!=m[3]||Date.now()-document._input._time>1000){
      let f=$util._tmpFormForSearchingInput||_cssHandler._findForm()||document.body;
      $util._tmpFormForSearchingInput=0
      let o=_Util._findLabel(f,v2),
          os=new Set()

      if(!o.length&&!_Util._isRegexData(v2)&&!v2.includes("|")){
        let vv=_Util._removeSign(v2," ")
        o=_Util._findLabel(f,vv,1)
      }
      o.forEach(x=>{
        let ss=[]
        _findInputByLabel(x,ss)
        ss.forEach(y=>os.add(y))
      })
      os=[...os]

      if(!os.length||!os.find(x=>_Util._isStdInputElement(x)||_Util._isInContentEditable(x))){
        let oos=$(`:attr(${_IDE._data._setting.content.contentAttribute}=${v2})`).toArray()
        _Util._spliceAll(oos,x=>{
          if(!_Util._isInputObj(x)||(_Util._isHidden(x)&&!["checkbox","radio"].includes(x.type))){
            return 1
          }
        })
        if(oos.length){
          os=oos
        }
      }

      let ios=$(os).find("input").toArray().filter(x=>["checkbox","radio"].includes(x.type))
      if(ios.length){
        os=ios
      }

      document._input={
        _time:Date.now(),
        k:m[3],
        as:os,
        _tags:new Set()
      }
    }

    
    return document._input.as.includes(a)||$(document._input.as).find(a)[0]
    
    function _findInputByLabel(o,os){
      if(o.e&&o.e.tagName=="LABEL"){
        let k=o.e.attributes.for
        if(k){
          k=$("#"+k.value.replace(/([^0-9a-zA-Z\_\-])/g,"\\$1"))[0]
          if(k){
            os.push(k)
            return
          }
        }
        let oo=_Util._findInputs(o.e,1)
        if(oo.length){
          os.push(...oo)
          return
        }
      }
      if(o.ks.length){
        o.ks.find(x=>{
          let oo=_Util._findInputs(x,1)
          if(oo.length){
            os.push(...oo)
            return 1
          }
        })
      }
      if(os.length){
        return
      }
      let e=o.e
      while(e&&e.tagName!="TD"&&e.nextElementSibling){
        if(_cssHandler._findSamilarElementByStyle(e.nextElementSibling,o.o).length){
          break
        }
        if(_cssHandler._findSamilarElementByStyle(e.nextElementSibling,o.e).length){
          break
        }
        if(e==o.e){
          let _chkbox=_findCheckboxInPreviousElement(e)
          if(_chkbox){
            os.push(_chkbox)
            break
          }
        }
        let oo=_Util._findInputs(e.nextElementSibling,1)
        oo=oo.filter(x=>!_Util._isHidden(x))
        os.push(...oo);
        
        if(!os.length){
          if(_cssHandler._lookLikeInput(o.e,e.nextElementSibling)){
            os.push(e.nextElementSibling)
            break
          }
        }else{
          break
        }
        e=e.nextElementSibling
      }
      if(os.length){
        return
      }
      if(o.ks.length==1){
        os.push(...o.ks)
      }else if(o.ks.length>1){
        os.push(_Util._getShareParent(o.ks[0],o.ks[1]))
      }
      if(!os.length&&o.e){
        o.e=o.e.parentElement
        _findInputByLabel(o,os)
      }
    }
    
    function _findCheckboxInPreviousElement(e){
      let p=e.previousElementSibling
      if(p){
        if(p.tagName=="INPUT"&&p.type=="checkbox"){
          return p
        }else if(!p.innerText){
          let cs=$(p).find("input[type=checkbox]")
          if(cs.length){
            return cs[cs.length-1]
          }else{
            return _findCheckboxInPreviousElement(p)
          }
        }
      }
    }
    
  }


  jQuery.expr[":"].data=function(a,i,m){
    let r=jQuery.expr[":"].input(a,i,m)
    if(r){
      var vv=_Util._removeSign(m[3]).toLowerCase().trim();
      if(_Util._isInputObj(a)){
        if(a.type=="checkbox"){
          a.bzData=a.checked
        }else if(a.type=="radio"){
          a.bzData=$(`input[name=${a.value}]:checked`).val()
        }else if(_Util._isInContentEditable(a)){
          a.bzData=a.innerText
        }else{
          a.bzData=$(a).val()
        }
      }else{
        let v=a.innerText
        v=v.split(/[:：]/)
        if(v.length>1){
          if(vv==_Util._removeSign(v[0].toLowerCase())){
            a.bzData=v[1]
          }
        }else{
          a.bzData=a.innerText
        }
      }
    }
    return r
  }

  jQuery.expr[":"].link=function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    var v2=_Util._toTrimSign(m[3].toLowerCase());
    if(!v2){
      return
    }
    v2=v2.replace(/\s+/," ")
    if(a.nodeType!=1){
      return
    }

    /******************* New Code start *****************************************/
    if(!document._link||document._link.k!=v2||Date.now()-document._link._time>1000){
      let vs=v2.split("|"),oo=[]
      vs.forEach(v=>{
        let o=_Util._getTargetElement($(":endContains("+v+")")),os=[],ss=$("*")

        if(!o.length){
          o=$(":Contains("+v+")").toArray()
          o=_Util._getCeilDom(o)
        }
        if(!o.find(x=>x.innerText==v)){
          os=$("INPUT").toArray().filter(x=>["image","submit","button","reset"].includes(x.type)&&_Util._toTrimSign(x.value.toLowerCase())==v2)
          if(!os.length){
            os=$(`:attr(${_IDE._data._setting.content.contentAttribute}=${v2})`).toArray()
          }
          if(!os.length){
            os=o
          }
        }else{
          os=o
        }
        oo=oo.concat(os)
      })
      
      let os=oo.filter(x=>["A","BUTTON","INPUT"].includes(x.tagName))
      
      if(!os.length){
        os=oo.map(x=>_Util._getParentElementByCss("button,a",x)).filter(x=>x)
        if(!os.length){
          os=oo
        }
      }

      document._link={
        _time:Date.now(),
        k:v2,
        as:os,
        _tags:new Set()
      }
    }

    
    return document._link.as.includes(a)
  }

  jQuery.expr[":"].near = function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    let v2=m[3]
    let _inRegex=_Util._isRegexData(v2)
    if(!v2){
      return
    }
    if(!_inRegex){
      v2=_Util._toTrimSign(v2.toLowerCase());
      v2=v2.replace(/\s+/," ")
    }else{
      _inRegex=eval(v2)
    }
    if(a.nodeType!=1){
      return
    }

    /******************* New Code start *****************************************/
    if(!document._near||document._near.k!=v2||a._near||Date.now()-document._near._time>1000){
      let _inHidden=jQuery._inHidden
      let o=_Util._getTargetElement($(":endContains("+v2+")"))
      _Util._spliceAll(o,x=>{
        return _Util._isHidden(x)
      })
      if(!o.length){
        o=$(":Contains("+v2+")").toArray()
        o=_Util._getCeilDom(o)
        _Util._spliceAll(o,x=>{
          return _Util._isHidden(x)
        })
      }

      document._near={
        _inHidden:_inHidden,
        o:o,
        _time:Date.now(),
        k:v2,
        as:new Set(),
        _tags:new Set()
      }
    }  

    if(document._near._inHidden){
      if(!_Util._isHidden(a)){
        return
      }
    }else{
      if(_Util._isHidden(a)){
        return
      }
    }
    _searchCandiate(a)
    if(!document._near.as.has(a)){
      return
    }
    /******************* New Code end *********************************************/
    v2=_Util._toTrimSign(v2,30)
    if(BZ._tmpNearRegexKey!=v2){
      BZ._tmpNearRegexKey=v2
      v2=_Util._filterTxt(v2);
      v2=_Util._trimSpace(v2)
      BZ._tmpNearRegex=v2.replace(/\*/g,".*")
    }
    var v1=_Util._findNearTxt(a,BZ._tmpNearRegex)
    if(v1){
      if((_inRegex&&v1.match(_inRegex))||(!_inRegex&&_Util._includesWord(v1,BZ._tmpNearRegex,1))){
        a._bzJq="near"
        a._bzJqVal=v1
        return true
      }
    }
    return false
    
    function _searchCandiate(a){
      let d=document._near
      if(d._tags.has(a.tagName)){
        return
      }
      d._tags.add(a.tagName)
      let o=Object.assign([],d.o)
      let oo=o.map(x=>x.getBoundingClientRect()),as=new Set(),_loop=0;
      while(oo.length&&_loop<3){
        
        for(let i=0;i<o.length;i++){
          let x=o[i]
          let p=x.parentElement
          if(!p||p.tagName=="BODY"){
            return
          }
          o[i]=p
          let os=$(p).find(a.tagName).toArray()
          if(os.length){
            os.forEach(y=>as.add(y))
            if(_Util._isCellElement(a)){
              o.splice(i,1)
              oo.splice(i--,1)
            }
          }
        }
        if(!o[0]||o[0].tagName=="BODY"){
          break
        }
        if(as.size){
          if(d._inHidden){
            break
          }
          _loop++
          for(let i=0;i<oo.length;i++){
            let or=o[i].getBoundingClientRect()
            if(or.width- oo[i].width>100&&or.height- oo[i].height>100){
              oo.splice(i,1)
              o.splice(i--,1)
            }
          }
        }
      }
      as=[...as]
      as.forEach(x=>d.as.add(x))
    }
  };

  jQuery.expr[":"].next= function(a,i,m){
    return a.nextElementSibling
  }

  jQuery.expr[":"].previous= function(a,i,m){
    return a.previousElementSibling
  }

  jQuery.expr[":"].parent= function(a,i,m){
    return a.parentNode
  }

  jQuery.expr[":"].afterEqual= function(a,i,m){
    return jQuery.expr[":"].after(a,i,m,"endEqual")
  }
  jQuery.expr[":"].after= function(a,i,m,_equal){
    if(_Util._isIgnoreElement(a)){
      return
    }
    m=m[3]
    if(a.nodeType!=1 ||a.type=="hidden"){
      return
    }

    if(!document._after||document._after.k!=m||a._after||Date.now()-document._after._time>1000){
      let _inHidden=jQuery._inHidden,
          _panel=jQuery.tmpPanel
      if(_panel&&_panel.constructor!=jQuery){
        _panel=$(_panel)
      }
      let o,os=_inHidden?$("*"):_Util._getAllVisableElementsInJQ();
      if(_isSubSelector(m)){
        o=$(m)[0]
      }else{
        o=_Util._getTargetElement($(":"+(_equal||"endContains")+"("+m+")"))
        
        _Util._spliceAll(o,x=>{
          return (_panel&&!_panel.find(x)[0])||_Util._isHidden(x)
        })
        if(!o.length){
          o=$(":Contains("+m+")").toArray()
          _Util._spliceAll(o,x=>{
            return (_panel&&!_panel.find(x)[0])||_Util._isHidden(x)
          })
          o=o.pop()
        }else{
          o=o[0]
        }
        jQuery._inHidden=_inHidden
      }

      document._after={
        _panel:_panel,
        _inHidden:_inHidden,
        o:o,
        _time:Date.now(),
        k:m,
        os:os,
        _idx:os.index(o)
      }
    }
    if(!document._after._inHidden&&_Util._isHidden(a)){
      return
    }
    if(document._after.os.index(a)>document._after._idx){
      return 1
    }
  };

  jQuery.expr[":"].before= function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    return _findBeforeElement(a,i,m)
  };

  function _findBeforeElement(a,i,m){
    m=m[3]
    if(a.nodeType!=1 ||a.type=="hidden"){
      return
    }
    let _timer=Date.now()

    if(!document._before||document._before.k!=m||a._before||Date.now()-document._before._time>1000){
      let _inHidden=jQuery._inHidden
      let o=$(":endEqual("+m+")").toArray(),
          os=_inHidden?$("*"):_Util._getAllVisableElementsInJQ()
          
      if(!o.length){
        o=_Util._getTargetElement($(":endContains("+m+")"))
        _Util._spliceAll(o,x=>{
          return _Util._isHidden(x)
        })
      }
      if(!o.length){
        o=$(":Contains("+m+")").toArray()
        _Util._spliceAll(o,x=>{
          return _Util._isHidden(x)
        })
        o=_Util._getSameTextDom(_Util._getCeilDom(o),m)
      }
      jQuery._inHidden=_inHidden
      document._before={
        _inHidden:_inHidden,
        _time:Date.now(),
        k:m,
        os:os,
        o:o.map(x=>{
          return {
            o:x,
            _idx:os.index(x),
            r:x.getBoundingClientRect()
          }
        })
      }
    }
    if(!document._before._inHidden&&_Util._isHidden(a)){
      return
    }
    let n=document._before.os.index(a)
    return document._before.o.find(x=>{
      let _idx=x._idx
      if(a.tagName=="INPUT"&&a.type=="checkbox"&&$(x.o).find(a.tagName)[0]){
        return !!$(x.o).find(a)[0]
      }
      if(_idx>n){
        if(x._idx-n==1){
          return 1
        }
        for(let j=n+1;j<_idx;j++){
          let c=document._before.os[j]
          if((c.innerText||"").trim()&&!_Util._isHidden(c)){
            if($(c).find(x.o)[0]){
              continue
            }
            return
          }else if(c.tagName==a.tagName&&c.type!=="hidden"){
            return
          }else{
            c=c.getBoundingClientRect()

            if(c.top>x.r.bottom||c.right>x.r.right){
              return
            }
          }
        }
        return 1
      }else if(n-x._idx==1){
        return _Util._positionAfterElement(x.o,a)
      }
    })
  }
  jQuery.expr[":"].containCss = function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    return $(a).find(m[3].trim()).length>0;
  };

  jQuery.expr[":"].css=function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    let v=m[3].toLowerCase().split("|"),
        c=""
    return v.find(vv=>{
      if(vv[0]=="."){
        if(a.className&&a.className.constructor==String){
          return _includes(a.className,vv)
        }
      }else if(vv[0]=="#"){
        if(a.id&&a.id.constructor==String){
          return _includes(a.id,vv)
        }
      }
    })&&true
    
    function _includes(c,vv){
      c=c.toLowerCase()
      vv=vv.substring(1)
      let v2=vv.split(/[^a-z0-9]/)
      if(v2.length==1){
        return c.split(/[^a-z0-9]/).includes(vv)
      }else{
        return c.includes(vv)
      }
    }
    return $(a).find(m[3].trim()).length>0;
  };

  jQuery.expr[":"].noCss=function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    let v=m[3].toLowerCase().split("|"),
        c=""
    return v.find(vv=>{
      if(vv[0]=="."){
        if(a.className&&a.className.constructor==String){
          return !_includes(a.className,vv)
        }
      }else if(vv[0]=="#"){
        if(a.id&&a.id.constructor==String){
          return !_includes(a.id,vv)
        }
      }
    })&&true
    
    function _includes(c,vv){
      c=c.toLowerCase()
      vv=vv.substring(1)
      let v2=vv.split(/[^a-z0-9]/)
      if(v2.length==1){
        return c.split(/[^a-z0-9]/).includes(vv)
      }else{
        return c.includes(vv)
      }
    }
  };

  jQuery.expr[":"].endContains = function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    let o= _checkEndContains(a,i,m)
    if(o){
      a._bzJq="endContains"
    }
    return o
  };

  function _checkEndContains(a,i,m){
    m=m[3]

    if(!document._endContains||document._endContains.k!=m||!document._endContains._tag.includes(a.tagName)||a._endContains||Date.now()-document._endContains._time>1000){
      let _inHidden=jQuery._inHidden
      // console.log("init endContains:"+a.tagName+","+m)
      let v2=m;
      if(!document._endContains||document._endContains.k!=m||Date.now()-document._endContains._time>1000){
        document._endContains=0
      }
      let _inRegex=_Util._isRegexData(v2)
      if(_inRegex){
        v2=_Util._getRegexByBZName(v2.substring(1,v2.length-1),1)
        v2=new RegExp(v2,"im")
      }else{
        v2=v2.trim().toLowerCase();
        v2=_Util._filterTxt(v2)
        v2=v2.replace(/\*/g,".*")
      }
      let os=_Util._getEndElementsByWord(function(w){
        w=(w||"").trim().toLowerCase();
        if(_inRegex){
          return w.match(v2)
        }else{
          w=_Util._filterTxt(w)
          return _Util._includesWord(w,v2,1)
        }
      },a.tagName,document._Contains?document._Contains._inHidden:_inHidden,a)
      if(document._endContains){
        document._endContains._tag.push(a.tagName)
        document._endContains.os=document._endContains.os.concat(os)
      }else{
        document._endContains={
          _inHidden:_inHidden,
          _tag:[a.tagName],
          k:m,
          os:os,
          _time:Date.now()
        }
        jQuery._inHidden=_inHidden
      }
    }
    return document._endContains.os.includes(a)
  }

  jQuery.expr[":"].endEqual = function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    if(_Util._isNoTextElement(a)){
      return
    }
    var os=a.childNodes;
    var v2=m[3],_inRegex=_Util._isRegexData(v2)
    if(_inRegex){
      v2=_Util._getRegexByBZName(v2.substring(1,v2.length-1),1)
      v2=new RegExp(v2,"i")
    }else{
      v2=v2.trim().toLowerCase();
      v2=_Util._trimSpace(v2)
    }
    for(var i=0;i<os.length;i++){
      var o=os[i];
      if(o.nodeType==3){
        var t=_Util._pickTextFromNode(os,i);
        i=t.i;
        var v1=_Util._trimSpace(t.t.toLowerCase()).replace(/^\*|\*$/,"").trim()
        if(_inRegex){
          if(v1.match(v2)){
            a._bzJq="endEqual"
            a._bzJqVal=t.t
            return true
          }else{
            return 
          }
        }else{
          try{
            if(v1==v2){
              a._bzJq="endEqual"
              a._bzJqVal=t.t
              return true;
    //          return $(a.ownerDocument.body).find(a).length;
    //          return !_Util._isHidden(a);
            }
          }catch(e){
            if(v1.includes(v2)){
              a._bzJq="endEqual"
              a._bzJqVal=t.t
              return true;
    //          return $(a.ownerDocument.body).find(a).length;
    //          return !_Util._isHidden(a);
            }
          }
        }
      }
    }
  };

  jQuery.expr[":"].equal = function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    if(_Util._isNoTextElement(a)){
      return
    }
    let t=jQuery(a).text().trim().toLowerCase(),_match
    m=m[3].trim().toLowerCase()
    if(_Util._isRegexData(m)){
      m=eval(m)
      return !!t.match(m)
    }
    return t==m
  };

  //simplar(include)
  jQuery.expr[":"].RowCol=function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    return _findRowCol(a,i,m,(v1,v2)=>{
      return v1.toLowerCase()==v2.toLowerCase()
    })
  }

  jQuery.expr[":"].rowcol=function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    return _findRowCol(a,i,m,(v1,v2)=>{
      return v1==v2
    })
  }

  function _findRowCol(a,i,m,_fun){
    m=m[3].replace(/^\[(.+)\]$/,"$1")
    let rs,cs,k=m;
    let _timer=Date.now()

    if(!document._rowcol||document._rowcol.k!=m||a._rowcol||Date.now()-document._rowcol._time>1000){

      m=m.split("|")
      if(m[0]){
        rs=_Util._findTextBox(m[0],_fun)||[]
      }else{
        rs=$("*").toArray()
      }
      if(!rs.length){
        rs=_Util._findInputByValue(m[0])
      }
      rs=[...new Set(rs)]
      
      cs=_Util._findTextBox(m[1],_fun)||[]
      if(!cs.length){
        cs=_Util._findInputByValue(m[1])
      }
      cs=[...new Set(cs)]
      let _founds=[]
      if(rs.length&&cs.length){
        let ss=$("*").toArray()
        let mi=ss.indexOf(ss[0])
        rs.find((x,i)=>{
          if(ss.indexOf(x)<mi){
            return
          }
          let os1=_getCloser(x,cs,1),cc=[]
          os1.forEach(y=>{
            let os2=_getCloser(y,rs)
            if(os2.includes(x)){
              cc.push(y)
            }
          })
          if(cc.length){
            rs[i]={
              o:x,
              r:x.getBoundingClientRect(),
              cs:cc.map(y=>y.getBoundingClientRect()),
              cc:cc
            }
            return 1
          }
        });
        rs.forEach(r=>{
          if(r.cs){
            let xo=r.o,_chkRow
            while(1){
              let os=$(xo).find(a.tagName).toArray(),_found=[]
              if(!os.length){
                if($(xo).is(a.tagName)){
                  os=[xo]
                }
              }
              os.find(o=>{
                let or=o.getBoundingClientRect();
                if(_match([r],or)){
                  _found.push(o)
                }else if(_found.length){
                  return 1
                }
              })
              _chkRow=os.length
              _founds=_founds.concat(_found)
              if(_found.length||r.cs.find(c=>{return c.right-5<=xo.getBoundingClientRect().right})){
                break
              }
              xo=xo.parentElement
            }
          }
        })
      }

      document._rowcol=a._rowcol={
        _time:Date.now(),
        rs:rs,
        k:k,
        _founds:_founds
      }
    }
    return document._rowcol._founds.includes(a)

    function _match(rs,ar,_chkRow){
      let md=(ar.left+ar.right)/2
      return rs&&rs.find(y=>{
        return (y.r.right<=ar.left||y.r.left<=ar.left)
              &&(!_chkRow||(y.r.top-5<ar.top&&y.r.bottom+5>ar.bottom))
              &&y.cs.find(x=>{
                if(x.bottom<=ar.top){
                  if(x.left<=md&&x.right>=md){
                    return 1
                  }
                  x=(x.left+x.right)/2
                  return x>=ar.left&&x<=ar.right
                }
              })
      })
    }
    
    function _getCloser(x,os,_before){
      let xr=x.getBoundingClientRect(),
          vs=[]
      os.forEach(o=>{
        if(o.getBoundingClientRect){
          let or=o.getBoundingClientRect()
          if(_before){
            if(or.bottom<xr.top+5&&xr.left<=or.left+5){
              vs.push(o)
            }
          }else{
            if(or.top+5>xr.bottom&&xr.left+5>or.left){
              vs.push(o)
            }
          }
        }
      })
      while(vs.length){
        let cs=$(x).find(vs).toArray()
        if(!cs.length){
          x=x.parentElement
        }else{
          return cs
        }
      }
      return []
    }
  }
  //canvas text
  jQuery.expr[":"].textElement=function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    if(a.tagName!="CANVAS"){
      return
    }
    if(TWHandler._getCanvasTextElement(a,m[3])){
      return true
    }
  }

  jQuery.expr[":"].blank=function(a,i,m){
    if(_Util._isIgnoreElement(a)){
      return
    }
    m=m[3]||0
    return m==_identifyIFrameHandler._getBlankIFrameID(a)
    
  }

  // jQuery.expr[":"].bz=function(a,i,m){
  //   let v=a.dataset.bz
  //   if(!v){
  //     return
  //   }

  //   m=m[3]
  //   m=m.split("=")
  //   a=_cssHandler._getBzPath(a)
  //   return a.bz.find(x=>x.k==m[0]&&(x.v==m[1]||!m[1]))
  // }

  jQuery.expr[":"].value=function(a,i,m){
    let v=m[3],vv=(a.value||"").toString()
    if(_Util._isRegexData(v)){
      v=eval(v)
      return vv.match(v)
    }
    return v==vv
  }

  jQuery.expr[":"].val=function(a,i,m){
    let v=m[3],vv=(a.value||"").toString()
    if(_Util._isRegexData(v)){
      v=eval(v)
      return vv.match(v)
    }
    return vv.includes(v)
  }

  for(var k in jQuery.expr[":"]){
    jQuery.expr[":"][k].toString=function(){}
  }

  //get sub iframe
  jQuery.fn.findIframe=function(a){
    return _findIFrame(arguments)
  }

  function _findIFrame(ii,n,d){
    d=d||BZ.TW;
    var i=0
    while(ii.length>i){
      var v=ii[i++]
      d=d.frames[v]
      if(!d){
        return
      }
    }
    return d.document
  }

  _isSubSelector=function(v){
    return v.match(/:(include|text|attr|Attr|Contains|hidden|show|panel|match|input|data|link|near|next|previous|parent|afterEqual|after|before|containCss|css|noCss|endContains|contains|endEqual|equal|RowCol|rowcol|textElement|blank|bz|value|val)\([^\)]*\)/)
  }
}

_extendJQuery();
var _BZDocumentsHandler={
  find:function(_jPath){
    var _result=null;
    this._documents.each(function(i,d){
      try{
        if(!_result){
          _result=$(d).find(_jPath);
        }else{
          _result=_result.add($(d).find(_jPath));
        }
      }catch(e){}
    });
    return _result;
  },
  each:function(_fun){
    if(this._documents && this._documents.each){
      this._documents.each(_fun);
    }
  },
  _buildMe:function(_preDoc){
    if(window.extensionContent){
      this._documents=$(window.document);
      return this;
    }
    try{
      if(!_Util._isBZTWOpened() || !BZ.TW.document || !BZ.TW.document.body || !BZ.TW.document.body.innerHTML){
        return 0;
      }
    }catch(e){
      return 0;
    }
    this._documents=$(BZ.TW.document);
    BZ._insertCSSIntoDoc&&BZ._insertCSSIntoDoc(BZ.TW.document);

    var fs=$(BZ.TW.document).find("IFRAME");
    for(var i=0;i<fs.length;i++){
      var f=fs[i];
      try{
        if(f.src && !TWHandler._isSameDomain(f.src)){
          continue;
        }else if(f.src && (!f.contentDocument || !f.contentDocument.body)){
          return 0;
        }else{
          BZ._insertCSSIntoDoc(f.contentDocument);
          this._documents=this._documents.add($(f.contentDocument));
        }
      }catch(e){}
    }
    return this;
  },
  _getBodyHtml:function(){
    var _html="";
    this._documents.each(function(i,d){
      try{
        _html+=d.body.outerHTML;
      }catch(e){}
    });
    return _html;
  }
};
var _CtrlDriver={
  bd:{"{":"}","[":"]","(":")","'":"'",'"':'"','`':'`'},
  _tmpValue:0,
  _curDomItem:null,
  _curSignedList:[],
  _updateUIList:[],
  _cleanList:new Set(),
  _refershDataList:[],
  _arrayUIList:[],
  _afterUpdateFunList:[],
  _proxyTypes:[Location,Object,Array],
  _delaySet:function(d,k,v){
    setTimeout(()=>{
      d[k]=v
    },10)
  },
  _updateObj:function(o,kk,v){
    if(kk.constructor!=Array){
      kk=[kk]
    }
    kk.forEach(k=>{
      o[k]=0
      if(v===undefined){
        delete o[k]
      }else{
        o[k]=v
      }
    })
  },
  _refreshDom:function(_dom,_doc){
    if(_dom){
      if(_dom.constructor==String){
        _doc=_doc||document
        _dom=$(_doc).find(_dom)[0]
        if(!_dom){
          return
        }
      }

      let p=_dom.parentElement,
      pp=_dom.previousSibling;
      if(p){
        _dom.remove()
        _dom=_CtrlDriver._drawView(_dom._ctrl,_dom._data,_dom._viewDef,p,pp)
        if(!pp&&p.firstChild!=_dom){
          _dom.parentElement.insertBefore(_dom,_dom.parentElement.firstChild)
        }
      }
    }
  },
  _refreshData:function(d,k,_fun,vv){
    // _CtrlDriver._refershDataList=_CtrlDriver._refershDataList.filter(x=>Date.now()-x._time<100)
    // if(_CtrlDriver._refershDataList.find(x=>x.k==k)){
      // return
    // }
    let v=d[k]
    d[k]=vv===undefined?!v:vv
    setTimeout(()=>{
      d[k]=v
      // _CtrlDriver._refershDataList.push({
        // k:k,
        // _time:Date.now()
      // })
      if(_fun){
        setTimeout(()=>{
          _fun()
        },20)
      }
    },100)
  },
  _isProxibleObj:function(o){
    return o && !o._isBZProxy && _CtrlDriver._proxyTypes.indexOf(o.constructor)>=0;
  },
  _mergeData:function(_from,_toData){
    for(var k in _from){
      _toData[k]=_from[k]
    }
  },
  _replaceData:function(_from,_toData){
    _CtrlDriver._mergeData(_from,_toData);
    for(var k in _toData){
      if(_from[k]!=_toData[k]){
        _toData[k]=undefined;
      }
    }
  },
  _createBZArea:function(_doc){
    var o=$(_doc).find("#bz-tmp-area");
    if(!o.length){
      $("<div id='bz-tmp-area'></div>").insertAfter(_doc.body);
      o=$(_doc).find("#bz-tmp-area");
    }
    return o;
  },
//support parse html to dom-json
  _findKeyOuterBlock:function(vs,tk,_start,bs,_noRegex){
    bs=bs||_CtrlDriver.bd
    let k,b,c,s;
    _init()
    if(vs.push){
      vs=[...vs]
    }
    if(_start){
      vs=vs.push?vs.splice(_start):vs.substring(_start)
    }
    for(let i=0;i<vs.length;i++){
      c=vs[i]
      if(c=="/"&&vs[i+1]==">"){
        vs=vs.substring(0,i)+"></"+vs.match(/^<([^ \/>]+)/)[1]+">"+vs.substring(i+2)
        c=">"
      }
      if(c=="\\"){
        b=!b
      }else if(b){
        b=0
      }else if(!_noRegex&&k=="/"&&c=="/"){
        _init()
        continue
      }else if(!_noRegex&&!k&&c=="/"&&(!s||s.trim().match(/[\(\[\=\?\:]$/))){
        k="/"
        continue
      }else if(k){
        if(k.r==c){
          if(k.n){
            k.n--
          }else{
            _init()
          }
        }else if(k.l==c){
          k.n++
        }
        continue
      }else if(bs[c]){ //([{
        k={l:c,r:bs[c],n:0,p:{k:c}}
      }
      s.push?s.push(c):s+=c;

      let kk=_isKey(s,c)
      if(kk){
        if(vs.pop){
          return {
            e:vs.splice(i+1),
            p:vs.splice(0,i),
            k:kk
          }
        }
        return {
          p:vs.substring(0,i-kk.length+1),
          k:kk,
          e:vs.substring(i+1)
        }
      }
    }

    function _init(){
      k=0
      s=vs.constructor==Array?[]:"";
    }

    function _isKey(s,c){
      if(tk.constructor==Function){
        return tk(s)
      }else if(tk.constructor==RegExp){
        s=s.match(tk)
        return s&&s[0]
      }
      return (tk==s||tk==c)&&tk
    }
  },
  _parseViewDef:function(s){
    let r= {s:s.trim()}
    let rr=[];
    _parseXML(r.s,rr,[])
    if(rr.length==1){
      rr=rr[0]
    }
    return rr

    function _parseXML(s,rs,ps){

      let p=_CtrlDriver._findKeyOuterBlock(s,">")
      if(p){
        let d={}
        rs.push(d)
        p.p=_parseTag(p.p,d)
        _parseProperties(p.p,d)
        p.e=p.e.trim()
        if(p.p&&p.p.endsWith("/")){
          p=_parseContent(p.e,rs)
          // p=_CtrlDriver._findKeyOuterBlock(p.e,"<")
          // if(p.p){
          //   p.p=p.p.trim()
          // }
          // if(p.p){
          //   let dd={}
            
          // }
          return _parseXML(p,rs,ps)
        }else{
          d._items=d._items||[]
          p=_parseContent(p.e,d._items)
          if(p[0]=="/"){
            let i=0
            while(p[0]=="/"){
              p=p.replace(/^\/[^>]+>/,"")
              p=p?_parseContent(p,rs):p
              if(i){
                rs=ps.shift()
              }
              i++
            }
            return _parseXML("<"+p,rs,ps)
          }else{
            ps.unshift(rs)
            return _parseXML("<"+p,d._items,ps)
          }
        }
      }
    }

    function _parseTag(s,d){
      s=s.substring(1)
      let p=_CtrlDriver._findKeyOuterBlock(s," ")
      if(p){
        d._tag=p.p
        return p.e
      }
      if(s.endsWith("/")){
        d._tag=s.substring(0,s.length-1)
        return "/"
      }else{
        d._tag=s
      }
      return ""
    }

    function _parseProperties(s,d){
      s=s.trim()
      if(!s){
        return
      }
      d._attr=d._attr||{}
      let p=_CtrlDriver._findKeyOuterBlock(s,"=")
      if(p){
        p.p=p.p.split(/\s/).map(x=>x);
        let y=p.p.pop()
        p.p.forEach(x=>{
          d._attr[x]=1
        })
        let pp=_CtrlDriver._findKeyOuterBlock(p.e.trim()," "),dd;
        if(y[0]=="_"){
          dd=d
        }else if(["click","dblclick","change","focus","blur","mouseover","mousedown","mouseup","keydown","keyup","keypress"].includes(y)){
          d._jqext=d._jqext||{}
          dd=d._jqext
        }else{
          dd=d._attr
        }
        if(pp){
          dd[y]=_parseValue(pp.p,1)
          _parseProperties(pp.e,d)
        }else{
          dd[y]=_parseValue(p.e,1)
        }
      }else{
        s.split(/\s/).forEach(x=>{
          d._attr[x]=1
        })
      }
    }

    function _parseContent(s,rs){
      s=_CtrlDriver._findKeyOuterBlock(s,"<")
      if(s){
        s.p=s.p.trim()
        if(s.p){
          rs.push({
            _text:_parseValue(s.p)
          })
        }
        return s.e
      }
    }

    function _parseValue(s,p){
      if(p){
        if(s.match(/["'\[]/)){
          s=eval("s="+s)
          return s
        }
      }
      if(_CtrlDriver._isFunction(s)){
        s=eval("s="+s)
        return s
      }
      return s
    }

    function _throwError(){
      throw new Error(_bzMessage._system._error._formatError+s.substring(0,100)+(s.length>100?" ...":""))
    }
  },
  _execute:function(_ctrl,_data,_viewDef,_box){
    _ctrl=_ctrl||{}
    _doc=_ctrl._document||document;

    _data = _data || _ctrl._data || {};
    _viewDef=_viewDef || _ctrl._viewDef;
    _box=_box || _ctrl._area || (_doc==document?_doc.body:_CtrlDriver._createBZArea(_doc));
    if(_box.constructor==String){
      _box=$(_doc).find(_box)[0]
    }
    if(!_ctrl._data){
      _ctrl._data=_data;
    }
    if(_data==_ctrl._data){
      _data=_CtrlDriver._buildProxy(_data);
      _ctrl._data=_data;
    }else if(!_data._isBZProxy){
      throw Error("Data is not build in binding. ('"+JSON.stringify(_data,0,2)+"')")
    }
    _CtrlDriver._initUIBind(_ctrl,_data,_viewDef);
    var _dom = _CtrlDriver._drawView(_ctrl,_data,_viewDef,_box);
    _CtrlDriver._curDomItem = null;
    return _dom;
  },
  _monitorData:function(_target,name,value){
    if(window.BZ&&BZ._debugger){
      if(!_CtrlDriver._lastSet){
        _CtrlDriver._lastSet={}
      }
      if(_CtrlDriver._lastSet._target!==_target || _CtrlDriver._lastSet.name!==name){
        _CtrlDriver._lastSet={_target:_target,name:name,value:value,_repeat:0,_repeatValue:0}
      }else{
        if(_CtrlDriver._lastSet.value!==value){
          _CtrlDriver._lastSet._repeatValue++
        }
        _CtrlDriver._lastSet._repeat++
      }
    }
  },
  _buildProxy:function(_data,_parent,_name){
    if(!_data){
      return _data
    }
    if(!_data._isBZProxy){
      return new Proxy(_data, {
        _parent:_parent,
        _name:_name,
        get:function(_target, name){
          if(name=="_isBZProxy"){
            return true;
          }else if(name=="_uiMap"){
            if(!this._uiMap){
              this._uiMap={};
            }
            return this._uiMap;
          }else if(name=="constructor"){
            return _target.constructor;
          }else if(name=="_target"){
            return _target;
          }
          
          var _result=_target[name];
          
          //Add to be refreshed ui setting
          if(!this._uiMap){
            this._uiMap={};
          }
          if(_CtrlDriver._isProxibleObj(_result)){
            _target[name]=_CtrlDriver._buildProxy(_target[name],this,name);
          }
          
          if(_CtrlDriver._curDomItem){
            if(!this._uiMap[name] && (_CtrlDriver._isProxibleObj(_target)) && (!_result || _result.constructor!=Function) && !(_target.constructor==Array && name=="length")){
              this._uiMap[name]=[];
            }
            
            if(_result && _result.constructor==Array && !_target[name]._uiMap.splice){
              _target[name]._uiMap.splice=this._uiMap[name];
              _target[name]._uiMap.push=this._uiMap[name];
              _target[name]._uiMap.unshift=this._uiMap[name];
              _target[name]._uiMap.pop=this._uiMap[name];
              _target[name]._uiMap.shift=this._uiMap[name];
            }

            if(this._uiMap[name]&&this._uiMap[name].constructor==Array){
              if(_result && _result.constructor==Function){
                _CtrlDriver._updateArrayUI(this._uiMap[_result.name]);
              }else{
                _CtrlDriver._bindUI(this._uiMap[name]);
              }
            }
          }else if(_result && _target.constructor==Array && _result.constructor==Function && ["splice","push","unshift","pop","shift"].indexOf(_result.name)>=0){
            _CtrlDriver._updateArrayUI(this._uiMap[_result.name]);
          }
          
          return _target[name];
        },
        set:function(_target,name,value){
          if(name=="constructor"){
            return _target.constructor;
          }
          _CtrlDriver._monitorData(_target,name,value)
          // console.log(name+":"+value)
          var _toUpdate=false;
          if(_CtrlDriver._isProxibleObj(value)){
            value=_CtrlDriver._buildProxy(value,this,name);
          }

          if(!value || !_target[name] || !value._target || !_target[name]._target){
            _toUpdate=_target[name]!==value;
          }else{
            _toUpdate=value._target !==_target[name]._target
          }

          if(_toUpdate){
            var o=this._uiMap?this._uiMap[name]:0;
            if(o && !_CtrlDriver._updateUIList.includes(o)){
              _CtrlDriver._updateUIList.push(o);
              _CtrlDriver._exeUpdateUI();
            // }else if(this._parent){
            //   var o=this._parent._uiMap[this._name]
            //   if(o && !_CtrlDriver._updateUIList.includes(o)){
            //     _CtrlDriver._updateUIList.push(o);
            //     _CtrlDriver._exeUpdateUI();
            //   }
            }
            o=_CtrlDriver._rootUpdateMap
            if(o && !_CtrlDriver._updateUIList.includes(o)){
              _CtrlDriver._updateUIList.push(o);
              _CtrlDriver._exeUpdateUI();
            }
          }
          
          if(_target[name] && _target[name]._uiMap){
            if(value && value._isBZProxy && !value._uiMap){
              value[0];
              delete value._uiMap[0];
            }
            if(value && value._uiMap && value._uiMap!=_target[name]._uiMap){
              for(var k in _target[name]._uiMap){
                var _vList=value._uiMap[k];
                var _tList=_target[name]._uiMap[k];
                
                if(_vList && _vList!=_tList){
                  for(var i=0;i<_tList.length;i++){
                    if(!_vList.includes(_tList[i])){
                      _vList.push(_tList[i]);
                    }
                  }
                }else{
                  value._uiMap[k]=_target[name]._uiMap[k];
                }
                _CtrlDriver._cleanList.add(value._uiMap[k]);
              }
            }
          }
          var _result=(_target[name]=value);
          if(value===undefined && this._uiMap){
            delete this._uiMap[name]
          }
          if(_target.constructor==Array && name=="length" && _result==0){
            return true;
          }else if(_target.constructor==Array && (parseInt(name) || parseInt(name)==0) && !_result){
            return true;
          }
          return _result;
        }
      });
    }else{
      return _data;
    }
  },
  _updateArrayUI:function(_uiList){
    if(_uiList){
      if(_CtrlDriver._arrayUIList.indexOf(_uiList)<0){
        _CtrlDriver._arrayUIList.push(_uiList);
      }
      if(_CtrlDriver._arrayUITimeout){
        clearTimeout(_CtrlDriver._arrayUITimeout);
      }
      _CtrlDriver._arrayUITimeout=setTimeout("_CtrlDriver._updateArrayUI()");
      return;
    }
    var _timer=Date.now();
    _CtrlDriver._inUpdateArrayUIList=true;
    while(_CtrlDriver._arrayUIList.length){
      var u=_CtrlDriver._arrayUIList.shift();
      _CtrlDriver._updateDataUI(u,_timer);
    }
    _CtrlDriver._inUpdateArrayUIList=false;
  },
  _updateDataUI:function(_uiList,_timer){
    if(!_uiList){
      return;
    }
//    var _ignore=0;
//    var _exe=0;
//    console.time("_updateDataUI")
//    console.log("_uiList.length: "+_uiList.length)
    for(var i=0;i<_uiList.length;i++){
      var u=_uiList[i];
      if(!u){
        continue;
      }
      if(i){
        let lu=_uiList[i-1]
        if(u._dom==lu._dom&&u._attr==lu._attr&&u._group==lu._group){
          continue
        }
      }
      if($(u._dom.ownerDocument).find(u._dom).length){
        if(_timer && u._time>_timer){
//          _ignore++;
          continue;
//        Don't remove the comment for chrome debug modal!!!
        }
//        _exe++;
        let _viewDef=u._dom._viewDef
        try{
          if(!u._dom._data&&_viewDef._data){
            u._dom._data=_CtrlDriver._retrieveResult(_viewDef._data,{},{},u._dom,_viewDef);
          }
          _CtrlDriver._curSignedList=[];
          _CtrlDriver._updateCount++;
          _CtrlDriver._curDomItem=u;
          if(u._attr=="_if"){
            if(_viewDef._if){
              _CtrlDriver._updateIf(u);
            }
          }else if(u._attr=="['load']"){
            if(_viewDef._load){
              _CtrlDriver._loadContent(u);
            }else{
              _uiList.splice(i,1);
              i--;
            }
          }else if(u._attr=="['html']"){
            _CtrlDriver._updateHtml(u);
          }else if(u._attr=="['text']"){
            if(_viewDef._text){
              _CtrlDriver._updateText(u);
            }
          }else if(u._attr=="['value']"){
            _CtrlDriver._updateValue(u);
          }else if(u._attr=="rebuild"){
            _CtrlDriver._updateRebuild(u);
          }else if(u._attr=="repeat"){
            _CtrlDriver._updateRepeat(u);
          }else{
            _CtrlDriver._updateAttr(u);
          }
        }catch(e){_CtrlDriver._handleError(e);}
      }else{
//        _ignore++
        _uiList.splice(i,1);
        i--;
      }
    }
//    console.timeEnd("_updateDataUI")
//    console.log("_ignore: "+_ignore)
  },
  _handleError:function(_error){
//    console.clear();
    if(window._inDebugging){
      console.log(_error.stack)
    }
  },
  _initUIBind:function(_ctrl,_data,_viewDef,_hookers){
    _CtrlDriver._curSignedList=[];
    var _doc=_ctrl._document || document;
    _CtrlDriver._curDomItem=_doc.createTextNode("");
    _CtrlDriver._curDomItem._ctrl=_ctrl;
    _CtrlDriver._curDomItem._data=_data;
    _CtrlDriver._curDomItem._viewDef=_viewDef;
    _CtrlDriver._curDomItem._hookers=_hookers?_hookers:[];
    _CtrlDriver._curDomItem={_dom:_CtrlDriver._curDomItem,_attr:"_if"};
  },
  _initUIBindByDom:function(_dom){
    _CtrlDriver._initUIBind(_dom._ctrl,_dom._data,_dom._viewDef,_dom._hookers);
  },
  _changeBindAttr:function(_attr){
    _CtrlDriver._curDomItem={
      _dom:_CtrlDriver._curDomItem._dom,
      _attr:_attr
    };
  },
  _replaceBindDom:function(_newDom,_attr,_clean){
    if(_newDom){
      _newDom._ctrl=_CtrlDriver._curDomItem._dom._ctrl;
      _newDom._data=_CtrlDriver._curDomItem._dom._data;
      _newDom._viewDef=_CtrlDriver._curDomItem._dom._viewDef;
      _newDom._hookers=_CtrlDriver._curDomItem._dom._hookers;
      _CtrlDriver._curDomItem._dom=_newDom;
    }
    if(_attr){
      _CtrlDriver._curDomItem._attr=_attr;
    }
    for(var i=0;i<_CtrlDriver._curSignedList.length;i++){
      var o=_CtrlDriver._curSignedList[i];
      if(_newDom){
        o._dom=_newDom;
      }
      if(_attr){
        o._attr=_attr;
      }
    }
    if(_clean){
      _CtrlDriver._curSignedList=[];
    }
  },
  _retrieveResult:function(_exe,_data,_ctrl,_dom,_viewDef){
    var _result=null;
    try{
      if(_exe && _exe.constructor==Function){
        _result=_exe(_data,_ctrl,_dom,_viewDef);
      }else if(_exe && (_exe.constructor==Array || _exe.constructor==Object)){
        _result=_exe;
      }else if(_exe && _exe.constructor!=String){
        _result=_exe;
      }else{
        try{
          if(_exe && (_exe.includes(".") || (_exe.endsWith("'") && _exe[0]=="'")) && !_exe.endsWith(".")){
            _result=eval("_result="+_exe,{_data:_data,_ctrl:_ctrl,_dom:_dom,_viewDef:_viewDef});
          }else{
            _result=_exe;
          }
        }catch(e){
          _result=_exe;
          if(e.message && (e.message.includes("null") || e.message.includes("undefined"))){
            if(_exe.constructor==String){
              _result="";
            }
          }
        }
      }
    }catch(ee){
      _result=""
      console.log(ee.stack)
      if(!ee.message || (!ee.message.endsWith("of null") && !ee.message.endsWith("of undefined"))){
        console.error(ee);
      }
    }
    
    return _result;
  },
  //triggered on get data attributes
  _bindUI:function(_uiList){
    if(!_uiList||_uiList.constructor==Function){
      return;
    }
    for(var i=0;i<_uiList.length;i++){
      var u=_uiList[i];
      if(u._dom==_CtrlDriver._curDomItem._dom && u._attr==_CtrlDriver._curDomItem._attr){
        if(u._attr=="repeat" && u._viewDef._dataRepeat !==_CtrlDriver._curDomItem._viewDef._dataRepeat){
          continue;
        }
        return;
      }
    }

    if(!_uiList.includes(_CtrlDriver._curDomItem)){
      _CtrlDriver._curDomItem._time=Date.now();
      _uiList.push(_CtrlDriver._curDomItem);
      _CtrlDriver._curSignedList.push(_CtrlDriver._curDomItem);
      _CtrlDriver._cleanList.add(_uiList);
      _CtrlDriver._exeCleanList();
    }
  },
  //triggered on set data attributes
  _cleanDom:function(_dom){
    $(_dom).remove();
    if(_dom.children){
      for(var i=0;i<_dom.children.length;i++){
        _CtrlDriver._cleanDom(_dom.children[i])
      }
    }
  },
  _isRemovedElement:function(e){
    while(e.parentElement){
      if(["BODY","HTML"].includes(e.tagName)){
        return
      }
      e=e.parentElement
    }
    return 1
  },
  _cleanData:function(_data,_key){
    if(_key){
      if(_data.constructor==Array){
        if($.isNumeric(_key)){
          _data.splice(_key,1);
        }else{
          _data.forEach(x=>{
            x[_key]=0;
            delete x[_key];
          })
        }
      }else{
        _data[_key]=0;
        delete _data[_key];
      }
      return
    }
    if(_data.constructor==Array){
      while(_data.length){
        _data.pop();
      }
    }else{
      for(var k in _data){
        _data[k]=null;
        delete _data[k];
      }
    }
  },
  _exeCleanList:function(_lanuch){
    if(!_lanuch){
      if(_CtrlDriver._curCleanListTimeout){
        clearTimeout(_CtrlDriver._curCleanListTimeout)
      }
      _CtrlDriver._curCleanListTimeout=setTimeout(function(){
        _CtrlDriver._exeCleanList(1)
      },1);
      return;
    }
    var _timer=Date.now(),_count=0,_chk=0,_item=0;
//    console.time("_exeCleanList")
//    console.log("_CtrlDriver._cleanList: "+_CtrlDriver._cleanList.size)
    for(var _uiList of _CtrlDriver._cleanList){
      var _tmpList=[],_tmpAttrList=[],_tmpMap={};
      _item++;
      for(var i=0;i<_uiList.length;i++){
        var u=_uiList[i],os=0;
        _chk++;
        
        if((!u._dom.parentElement || !u._dom.ownerDocument || !u._dom.ownerDocument.defaultView ||(!u._dom.parentElement.getBoundingClientRect().width &&_CtrlDriver._isRemovedElement(u._dom.parentElement))) && u._time<_timer){
          os=_uiList.splice(i--,1);
        }else if(_tmpList.indexOf(u._dom)<0){
          _tmpAttrList.push([u._attr]);
          _tmpList.push(u._dom);
        }else{
          var _idx=_tmpList.indexOf(u._dom);
          if(u._attr=="repeat" || _tmpAttrList[_idx].indexOf(u._attr)<0){
            _tmpAttrList[_idx].push(u._attr);
          }else{
            os=_uiList.splice(i--,1);
          }
        }
        
        if(os){
          _CtrlDriver._cleanDom(os[0])
          _count++;
        }
      }
    }
    _CtrlDriver._cleanList.clear()
//    console.timeEnd("_exeCleanList")
  },
  _assignFunForAfterUpdate:function(f){
    if(!_CtrlDriver._afterUpdateFunList.includes(f)){
      _CtrlDriver._afterUpdateFunList.push(f)
    }
    clearTimeout(_CtrlDriver._assignFunTimer)
    _CtrlDriver._assignFunTimer=setTimeout(()=>{
      if(!_CtrlDriver._updateUIList.length){
        _CtrlDriver._exeAfterUpdate()
      }
    },20)
},
  _exeAfterUpdate:function(){
      while(_CtrlDriver._afterUpdateFunList.length){
        _CtrlDriver._afterUpdateFunList.shift()();
      }
    // clearTimeout(_CtrlDriver._exeAssignTimer)
    // _CtrlDriver._exeAssignTimer=setTimeout(function(){
      // while(_CtrlDriver._afterUpdateFunList.length){
        // _CtrlDriver._afterUpdateFunList.shift()();
      // }
    // },50)
  },
  _exeUpdateUI:function(_lanuch){
    if(!_lanuch){
      if(_CtrlDriver._curUIUpdateTimeout){
        clearTimeout(_CtrlDriver._curUIUpdateTimeout)
      }
      _CtrlDriver._curUIUpdateTimeout=setTimeout(function(){
        _CtrlDriver._exeUpdateUI(1)
      },1);
      return;
    }
    var _timer=Date.now();
    _CtrlDriver._updateCount=0;
    var ul=[];
    // var t1=Date.now()
    while(_CtrlDriver._updateUIList.length){
      var _uiList=_CtrlDriver._updateUIList.shift();
      for(var i=0;i<_uiList.length;i++){
        var u=_uiList[i];
        if(ul.indexOf(u)<0){
          ul.push(u);
        }
      }
      _CtrlDriver._cleanList.add(_uiList);
    }
    _CtrlDriver._updateDataUI(ul,_timer);
    _CtrlDriver._exeCleanList();

    _CtrlDriver._curDomItem=null;
    _CtrlDriver._curSignedList=[];
    if(!_CtrlDriver._updateUIList.length){
      _CtrlDriver._exeAfterUpdate()
    }
  //  console.log("update time: "+(Date.now()-t1))
},
  _updateValue:function(u){
    var _data=u._dom._data;
    var _viewDef=u._dom._viewDef;
    var _value=null;
    try{
      if(_viewDef._dataModel.constructor==Function){
        _value=eval("_value="+_viewDef._dataModel(_data),{_data:_data,_viewDef:_viewDef});
      }else{
        _value=eval("_value="+_viewDef._dataModel,{_data:_data,_viewDef:_viewDef});
      }

      if(_value===undefined || _value===null){
        _value="";
      }else if(_value&&![Object,Array].includes(_value.constructor)){
        _value=_value.toString();
      }
      if(u._dom.contenteditable){
        let fs=$(u._dom.ownerDocument).find(":focus")[0];
        if(fs&&(fs!=u._dom&&!$(u._dom).find(fs)[0])){
          u._dom._refresh&&u._dom._refresh()
        }
      }else if(u._dom.type && u._dom.type=="checkbox"){
        u._dom.checked=(_value&&u._dom.value=="on")||(_value==u._dom.value)
      }else if(u._dom.type && u._dom.type=="radio"){
        u._dom.checked=(u._dom._orgValue||u._dom.value)==_value;
      }else if(u._dom.tagName=="SELECT"){
        var ps=u._dom.options;
        for(var i=0;i<ps.length;i++){
          var p=ps[i];
          if(p._orgValue == _value || p.value==_value){
            u._dom.value=p.value;
            return;
          }
        }
      }else{
        var _focus=$(u._dom.ownerDocument).find("*:focus")[0]==u._dom;
        if(!_focus){
          if(u._dom._viewDef._formatGet){
            _value=u._dom._viewDef._formatGet(_value,u._dom)
            if(_value===undefined){
              _value=""
            }
          }
          u._dom.value=_value;
        }else{
          _CtrlDriver._inTyping=true;
          if(!u._dom._bzTypingBlur){
            u._dom._bzTypingBlur=true;
            $(u._dom).blur(function(){
              this._bzTypingBlur=false;
              _CtrlDriver._inTyping=false;
            });
          }
        }
      }
    }catch(e){_CtrlDriver._handleError(e);}
  },
  _updateAttr:function(u){
    var _data=u._dom._data;
    var _viewDef=u._dom._viewDef;
    if(!_viewDef._attr){
      return;
    }
    var _value="";
    
    _value=eval("_value=_viewDef"+u._attr,{_data:_data,_viewDef:_viewDef});

    var _result=_CtrlDriver._retrieveResult(_value,_data,u._dom._ctrl,u._dom,_viewDef);
    _result=_result===undefined?"":_result;
    if(u._attr=="['_attr']['style']"){
      if(_result){
        _result=_result.split(";");
        for(var i=0;i<_result.length;i++){
          var r=_result[i].split(":");
          r.length>1&&u._dom.style.setProperty(r[0],r[1].replace(" !important",""),r[1]&&r[1].includes("!important")?"important":"")
        }
      }
    }else if(u._attr=="['_attr']['class']"){
      u._dom.className=_result;
    }else{
      var _attr=u._attr.split("]['")[1].split("'")[0];
      if(["disabled","readonly","checked","selected","draggable","droppable","enable"].includes(_attr)){
        _result=Boolean(_result)
      }

      if(_attr=="value"){
        u._dom.value=_result;
      }else{
        u._dom[_attr]=_result;
        $(u._dom).attr(_attr,_result);
        if(_attr=="enable"||_attr=="disabled"){
          _CtrlDriver._attachEnable(u._dom);
        }
      }
    }
  },
  _blockTest:function(e){
    return
    e=e.originalEvent||e;
    if(e&&!e.isTrusted&&e.target._viewDef&&e.target._viewDef._blockTest){
      e.preventDefault();
      e.stopPropagation();
      return 1;
    }
  },
  _loadContent:function(u){
    var _dom=_CtrlDriver._curDomItem._dom;
    if(u){
      _CtrlDriver._curDomItem=u;
      _dom=u._dom;
    }else{
      _CtrlDriver._curDomItem={_dom:_dom,_attr:"['load']"};
    }
    var _data=_dom._data;
    var _ctrl=_dom._ctrl;
    var _ajax=_dom._viewDef._load;
    if(!_ajax){
      return
    }else if(_ajax.constructor==Function || _ajax.constructor==String){
      _ajax=_CtrlDriver._retrieveResult(_ajax,_dom._data,_dom._ctrl,_dom,_dom._viewDef);
    }
    if(_ajax.constructor==String){
      _ajax={url:_ajax,dataType:"text/plain"};
    }
    //cache last ajax;
    if(_CtrlDriver._equalObj(_dom._viewDef._lastLoad,_ajax) && !_ajax._noCache){
      if(_dom._viewDef._html){
        return _CtrlDriver._updateHtml(u);
      }else if(_dom._viewDef._text){
        return _CtrlDriver._updateText(u);
      }
      return _dom;
    }
    _dom._viewDef._lastLoad=_ajax;
    
    $.ajax(_ajax).fail(function(e){
      if(e.message){
        alert("Load page error: "+e.message);
      }else if(e.responseText){
        _buildDom(e);
      }
    }).done(function(e){
      _buildDom(e);
    });
    function _buildDom(d){
      if(d.responseText){
        d=d.responseText;
      }
      //_handler: customize function
      if(_ajax._handler){
        d=_ajax._handler(d);
      }
      var dd=null;
      var _doc=_dom._ctrl._document || document;
      var _box=_doc==document?_doc.body:_CtrlDriver._createBZArea(_doc);
      try{
        if(_dom.tagName=="SCRIPT"){
          eval(d);
        }else{
          //The loading file is a viewDef json file
          
          dd=eval("dd="+d);
          if(!_dom._viewDef._noCache){
            delete _dom._viewDef._load
            Object.assign(_dom._viewDef,dd)
          }else{
            _dom._viewDef=dd;
          }
          dd=_CtrlDriver._drawView(_dom._ctrl,_dom._data,_dom._viewDef,_box,_dom);
        }
      }catch(e){
        //The loading file is a html file
        var dd=$(d)[0];
        if(!dd){
          dd=_doc.createTextNode(d);
        }
      }
      if(dd){
        dd._ctrl=_dom._ctrl;
        dd._data=_dom._data;
        dd._viewDef=_dom._viewDef;
        if(dd._viewDef._load){
          if(dd.outerHTML){
            dd._viewDef._html=d;
          }else{
            dd._viewDef._text=d;
          }
          if(_dom._resultDom){
            _CtrlDriver._cleanDom(_dom._resultDom);
          }
          $(dd).insertAfter(_dom);
          _dom._resultDom=dd;
          return dd;
        }else{
          $(_dom).replaceWith(dd);
        }
      }
    }
    _CtrlDriver._attachEnable(_dom);
    return _dom;
  },
  _updateHtml:function(u){
    if(u){
      _CtrlDriver._curDomItem=u;
    }else{
      _CtrlDriver._curDomItem={_dom:_CtrlDriver._curDomItem._dom,_attr:"['html']"};
    }
    var _doc=_CtrlDriver._curDomItem._dom._ctrl._document || document;
    var _dom=_CtrlDriver._curDomItem._dom;
    var _tmpResult=_CtrlDriver._retrieveResult(_dom._viewDef._html,_dom._data,_dom._ctrl,_dom,_dom._viewDef);
    var _tmpDom=null;
    if(_tmpResult!==null && _tmpResult!==undefined){
      if(_tmpResult.constructor==String){
        _tmpResult=_tmpResult.trim();
      }
      if(_tmpResult.constructor==String && _tmpResult[0]=="<" && _tmpResult[_tmpResult.length-1]==">"){
        _tmpDom=$(_tmpResult)[0]
      }else if(_tmpResult.nodeType){
        _tmpDom=_tmpResult;
      }
      if(!_tmpDom){
        _tmpDom=_doc.createTextNode(_tmpResult);
      }
    }else{
      _tmpDom=_doc.createTextNode("");
    }
    
    if(u){
      $(u._dom).replaceWith(_tmpDom);
    }
    _CtrlDriver._replaceBindDom(_tmpDom,"['html']",true);
    return _tmpDom;
  },
  _updateText:function(u){
    var _dom=_CtrlDriver._curDomItem._dom;
    if(u){
      _CtrlDriver._curDomItem=u;
    }else{
      _CtrlDriver._curDomItem={_dom:_dom,_attr:"['text']"};
    }
    var _doc=_dom._ctrl._document || document;
    
    var _tmp=_CtrlDriver._retrieveResult(_dom._viewDef._text,_dom._data,_dom._ctrl,_dom,_dom._viewDef);
    if(_tmp===null || _tmp===undefined){
      _tmp="";
    }
    _dom.textContent=_tmp;
    if(_dom.innerHTML){
      _dom.innerHTML=_dom.innerHTML.replace(/\&(amp\;)([\#0-9a-z]+\;)/g,"&$2")
    }
    _CtrlDriver._replaceBindDom(null,"['text']",true);
    return _dom;
  },
  _updateRebuild:function(u){
    var _box=u._dom.parentElement;
    var _dom=_CtrlDriver._drawView(u._dom._ctrl, u._dom._data, u._dom._viewDef);
    if(_dom){
      if(_dom.constructor!=Array){
        _dom=[_dom];
      }
      for(var i=0;i<_dom.length;i++){
        $(_dom[i]).insertAfter(u._dom);
      }
    }
    _CtrlDriver._cleanDom(u._dom);
  },
  _updateIf:function(u){
    if(u){
      _CtrlDriver._initUIBindByDom(u._dom);
    }
    var _dom=_CtrlDriver._curDomItem._dom;
    var _value = _CtrlDriver._retrieveResult(_dom._viewDef._if,_dom._data,_dom._ctrl,_dom,_dom._viewDef);
    
    if(!_value || (_value.constructor==String && _value==_dom._viewDef._if)){
      if(u && u._dom.nodeType==_dom.nodeType && !u._dom.textContent){
        _CtrlDriver._curDomItem._dom=u._dom;
        return;
      }else if(!u){
        return null;
      }else{
        var _tmp=_CtrlDriver._curDomItem._dom;
        if(((_dom._viewDef._animation && _dom._viewDef._animation._hide) || _CtrlDriver._animationHideAll) && (!_dom._viewDef._animation || _dom._viewDef._animation._hide!="none")){
          if(_dom._viewDef._animation && _dom._viewDef._animation._hide){
            _dom._viewDef._animation._hide(u._dom,function(){
              _toHide(u,_tmp);
            });
          }else{
            _CtrlDriver._animationHideAll(u._dom,function(){
              _toHide(u,_tmp);
            });
          }
        }else{
          _toHide(u,_tmp);
        }
        return;
      }
    }else if(u && (u._dom.nodeType!=_dom.nodeType || u._dom.textContent)){
      return;
    }else if(!u){
      return _CtrlDriver._curDomItem;
    }
    if(u._dom._viewDef._dataRepeat){
      _CtrlDriver._repeatData(u._dom._ctrl,u._dom._data,u._dom._viewDef,u._dom.parentElement,u._dom);
      _CtrlDriver._cleanDom(u._dom);
    }else{
      
      if(u._dom._viewDef._tag){
        _dom=_CtrlDriver._updateDom(u);
      }else if(u._dom._viewDef._load){
        _dom=_CtrlDriver._loadContent(u);
      }else if(u._dom._viewDef._html){
        _dom=_CtrlDriver._updateHtml(u);
      }else if(u._dom._viewDef._text){
        _dom=_CtrlDriver._updateText(u);
      }
      
      var _doAnimation=((_dom._viewDef._animation && _dom._viewDef._animation._show) || _CtrlDriver._animationShowAll) && (!_dom._viewDef._animation || _dom._viewDef._animation._show!="none");
      if(_doAnimation && _dom.tagName){
        _dom.style.display="none";
      }
      $(u._dom).replaceWith(_dom);
      if(_dom.parentElement){
        _CtrlDriver._attachEnable(_dom.parentElement,_dom);
      }
      if(_doAnimation && _dom.tagName){
        if(_dom._viewDef._animation && _dom._viewDef._animation._show){
          _dom._viewDef._animation._show(_dom);
        }else if(_CtrlDriver._animationShowAll){
          _CtrlDriver._animationShowAll(_dom); 
        }
      }
    }
    function _toHide(u,_tmp){
      $(u._dom).replaceWith(_tmp);
      _CtrlDriver._cleanDom(u._dom);
      u._dom=_tmp;
    }
  },
  _buildDom:function(u){
    u=u._dom;
    var _data=u._data;
    if(u._viewDef._data){
      u._data=_data=_CtrlDriver._retrieveResult(u._viewDef._data,u._data,u._ctrl,u,u._viewDef)||_data;
    }
    var _tag=_CtrlDriver._retrieveResult(u._viewDef._tag,u._data,u._ctrl,u,u._viewDef);

    var _html="<"+_tag+" ";
    
    var _body=_CtrlDriver._fillAttrs(u._viewDef,_data,u._ctrl);
    if(_body===null || (_body && (_body.constructor==Object || _body.constructor==Array))){
      _html+=_body._html;
    }else{
      _html+=_body;
    }
    if(["INPUT","IMG","BR","HR"].indexOf(_tag.toUpperCase())>=0){
      _html+="/>";
    }else{
      _html+="></"+_tag+">"
    }
    var _dom= $(_html)[0];
    if(_body===null || (_body && (_body.constructor==Object || _body.constructor==Array))){
      _dom._orgValue=_body._orgValue;
    }
    if(u._viewDef._after){
      setTimeout(function(){
        u._viewDef._after(_dom,_data)
      },u._viewDef._animation?1010:10)
    }

    return _dom;
  },
  _updateDom:function(u,_data){
    var _dom=_CtrlDriver._buildDom(u);
    
    _CtrlDriver._replaceBindDom(_dom,null,true);
    
    _CtrlDriver._bindJqExt(_dom._viewDef._jqext,_dom,_data);
    _CtrlDriver._setBZCommonBehavior(_dom);
    
    var id=null;
    if(_dom._viewDef.id){
      id=_dom._viewDef.id;
    }else if(_dom._viewDef._attr && _dom._viewDef._attr.id){
      id=_dom._viewDef._attr.id;
    }
    if(id){
      if(!_dom._ctrl._comps){
        _dom._ctrl._comps={};
      }
      _dom._ctrl._comps[id]=_dom;
    }
    var _hasItems=0
    if(_dom._viewDef._items){
      var _items=_dom._viewDef._items;
      if(_items.constructor==String || _items.constructor==Function){
        _items=_CtrlDriver._retrieveResult(_items,_dom._data,_dom._ctrl,_dom,_dom._viewDef);
      }
      
      for(var i=0;_items&&i<_items.length;i++){
        _hasItems=1
        var r=_items[i];
        if(r){
          if(r.constructor==String){
            r=_CtrlDriver._parseViewDef(r)
          }
          _CtrlDriver._drawView(_dom._ctrl,_dom._data,r,_dom);
        }
      }
    }
    if(_hasItems){
    }else if(_dom._viewDef._load){
      _dom=_CtrlDriver._loadContent();
    }else if(_dom._viewDef._html){
      $(_dom).append(_CtrlDriver._updateHtml());
    }else if(_dom._viewDef._text){
      $(_dom).append(_CtrlDriver._updateText());
    }

    if(_dom._viewDef._required){
      var _required=_CtrlDriver._retrieveResult(_dom._viewDef._required,_dom._data,_dom._ctrl,_dom,_dom._viewDef);
      if(_required){
        if(!$(_dom).val()){
          $(_dom).addClass("required");
        }
        $(_dom).on("input",function(){
          if(!this.value){
            $(this).addClass("required");
          }else{
            $(this).removeClass("required");
          }
        });
      }
    }
    
    if(_dom._viewDef._dataModel){
      var _tag=_CtrlDriver._retrieveResult(_dom._viewDef._tag,_dom._data,_dom._ctrl,_dom,_dom._viewDef);
      if(["INPUT","SELECT","TEXTAREA"].includes(_tag.toUpperCase())||(_dom._viewDef._attr&&_dom._viewDef._attr.contenteditable)){
        if(_dom._viewDef._attr && _dom._viewDef._attr.type){
          var type=_CtrlDriver._retrieveResult(_dom._viewDef._attr.type,_dom._data,_dom._ctrl,_dom,_dom._viewDef);
        }else{
          type="text";
        }
        
        //_trigger data update by databind
        var _event="change";
        if(["INPUT","TEXTAREA"].indexOf(_dom.tagName)>=0 && type!="checkbox" && type!="radio"){
          _event="input";
        }
        _event=_dom._viewDef._updateEvent || _event;
        $(_dom).on("change",function(e){
          this._bzUpdate=1
        })
        $(_dom).on(_event,function(e){
          let _this=this;
          try{
            _CtrlDriver._typingBox=_this;
            var _data=_this._data;
            var _bind=_this._viewDef._dataModel;
            if(_bind.constructor==Function){
              _bind=_bind(_data)
            }
            if(_this.type=="checkbox"){
              
              if(_this.checked){
                eval(_bind+"=_this._orgValue||_this.value",{_this:_this},"set",_bind,_this._orgValue||_this.value);
              }else{
                eval(_bind+"=null",{},"set",_bind,null);
                eval("delete "+_bind);
              }
            }else{
              var _value=null;
              if(_this._viewDef._dataType==Number){
                _value=parseFloat(_this.value);
                if(!_value){
                  _value=0;
                }
              }else{
                _value=_this.value;
              }
              if(_this.tagName=="SELECT"){
                if(_this.selectedOptions[0]._orgValue){
                  _value=_this.selectedOptions[0]._orgValue;
                }
              }else if(_this.type=="radio"){
                _value=_this._orgValue||_this.value;
              }
              if(_this._viewDef._formatSet){
                _value=_this._viewDef._formatSet(_value,_data,_this);
              }
              
              eval(_bind+"=_value",{_data:_data},"set",_bind,_value);
            }
          }catch(e){}
        });
        $(_dom).on(_event=="input"?"change":_event,function(e){
          let _this=this,_org=this
          _CtrlDriver._chkIgnoreUpdate(_this,function(){
            while(_this&&_this._viewDef&&!_this._viewDef._update){
              if(_this._viewDef._noUpdate||_this.tagName=="BODY"){
                return
              }
              _this=_this.parentElement
            }
            if(!_org._bzUpdate){
              return
            }
            _org._bzUpdate=0
            if(_this&&_this._viewDef){
              setTimeout(function(){
                var _update=_this._viewDef._update
                if(_update.constructor==Function){
                  _update(_data,_dom,_this)
                }else{
                  eval(_update,{_data:_data})
                }
              },100)
            }
          })
        })
        $(_dom).on("keyup",function(e){
          this._bzOldValue=this._bzOldValue===undefined&&this.value
        })
        $(_dom).on("blur",function(){
          this._bzOldValue=undefined
          if(["INPUT","TEXTAREA"].includes(this.tagName)){
            this.value=this.value.trim()
            //$(this).change()
          }
          _CtrlDriver._typingBox=null;
        });

        var _data=_dom._data;
        _CtrlDriver._curDomItem={_dom:_dom,_attr:"['value']"};
        try{
          if(_dom._viewDef._dataModel.constructor==Function){
            _value=eval("_value="+_dom._viewDef._dataModel(_data),{_data:_data});
          }else{
            _value=eval("_value="+_dom._viewDef._dataModel,{_data:_data});
          }
          //set value by data bind
          if(type=="checkbox"){
            _dom.checked=_dom.value=="on"?!!_value:_dom.value==_value;
          }else if(type=="radio"){
            _dom.checked=(_dom._orgValue||_dom.value)==(_value||(_value===0?"0":""));
          }else{
            if(_dom._viewDef._formatGet){
              _value=_dom._viewDef._formatGet(_value,_data,_dom);
            }
            $(_dom).val(_value);
            if(_value===null || (_value && (_value.constructor==Object || _value.constructor==Array))){
              _dom._orgValue=_value;
              if(_dom.tagName=="SELECT"){
                for(var i=0;i<_dom.options.length;i++){
                  var op=_dom.options[i];
                  if(op._orgValue==_value || (op._orgValue && _value && _dom._viewDef._key && op._orgValue[_dom._viewDef._key]==_value[_dom._viewDef._key])){
                    op.selected=true;
                    break;
                  }
                }
              }
            }
          }
        }catch(e){
          console.log("BZ-LOG: "+_dom._viewDef._dataModel)
          _CtrlDriver._handleError(e);
        }
        
      }else{
        _CtrlDriver._curDomItem={_dom:_dom,_attr:"rebuild"};
        try{
          var _data=_dom._data;
          eval(_dom._viewDef._dataModel,{_data:_data});
        }catch(e){_CtrlDriver._handleError(e);}
      }
    }
    
    if(_dom._viewDef._focus){
      var _focus=!_CtrlDriver._inTyping && _CtrlDriver._retrieveResult(_dom._viewDef._focus,_dom._data,_dom._ctrl,_dom,_dom._viewDef);
      if(_focus){
        setTimeout(function(){
          if(!_CtrlDriver._inTyping){
            $(_dom).focus();
            if(_dom._viewDef._select){
              $(_dom).select()
            }
          }
        },10);
      }
    }
    _CtrlDriver._curSignedList=[];
    _CtrlDriver._attachEnable(_dom);
    return _dom;
  },
  _triggerUpdateData:function(cd,_from,d,_fun){
    _from=_from||cd
    d=d||_from._data
    if(cd._viewDef){
      if(cd._viewDef._update){
        if(cd._viewDef._update.constructor==Function){
          cd._viewDef._update(d,_from,cd,_fun)
        }else{
          eval(cd._viewDef._update)
          _fun&&_fun()
        }
      }else if(cd.parentElement){
        _CtrlDriver._triggerUpdateData(cd.parentElement,_from,d,_fun)
      }else{
        _fun&&_fun()
      }
    }else{
      _fun&&_fun()
    }
  },
  _chkIgnoreUpdate:function(_this,_doUpdate){
    if(_this._viewDef._ignoreUpdate){
      let _ignoreUpdate=$(_this._viewDef._ignoreUpdate)[0]
      if(_ignoreUpdate&&_ignoreUpdate.getBoundingClientRect().width){
        return
      }
    }else if(_this._viewDef._cancelUpdate){
      return
    }
    _doUpdate()
  },
  _updateRepeat:function(u){
    var _data=u._supData;
    _CtrlDriver._curDomItem=u;
    _data=_CtrlDriver._retrieveResult(u._group,_data,u._ctrl);
    if(_data && _data.constructor==Number){
      _data=new Array(_data).fill(0);
      _CtrlDriver._updateRepeatInArray(u,_data);
    }else if(_data && _data.constructor==Array){
      _CtrlDriver._updateRepeatInArray(u,_data);
    }else{
      _CtrlDriver._updateRepeatInObject(u,_data);
    }
    _CtrlDriver._attachEnable(u._dom);
  },
  _updateRepeatInArray:function(u,_data){
    var _idx=0;
    var _last=0,_tmp=0;
    for(var i=0;i<u._dom.childNodes.length;i++){
      var o=u._dom.childNodes[i];
      if(o._data && o._data._group==u._group && o._data._supData==u._supData){
        if(!_tmp){
          _tmp=_last=$("<div></div>").insertBefore(o)[0]
          continue
        }
        if(!$.isNumeric(o._data._idx)){
          _CtrlDriver._cleanDom(o);
          i--;
          continue;
        }else {
          o._data._idx=_idx
          if(!_data || _idx>=_data.length){
            _CtrlDriver._cleanDom(o);
            i--;
          }else if(o._data._item!=_data[_idx]){
            var d=o._data._item;
            var dd=_data[_idx]
            
            try{
              if(_CtrlDriver._typingBox && $(o).find(_CtrlDriver._typingBox).length){
                if(JSON.stringify(d)==JSON.stringify(_data[_idx])){
                  return;
                }
              }
            }catch(e){}

            if(![Object,Array].includes(o._data._item)){
              o._data._item=dd
              // let fs=$(o.ownerDocument).find(":focus")[0]
              // if(fs&&(fs==o||$(o).find(fs)[0])){
              //   _last=o
              // }else{
                var _dom=_CtrlDriver._drawView(o._ctrl,o._data,o._viewDef);
                $(_dom).insertBefore(o);
                _CtrlDriver._cleanDom(o)
                _last=_dom;
              // }
            }else if(_data.includes(d)){
              var _newData=_CtrlDriver._simpleClone(o._data)
              _newData._item=dd
              var _dom=_CtrlDriver._drawView(o._ctrl,_newData,o._viewDef);
              $(_dom).insertBefore(o);
              _last=_dom;
            }else{
              _CtrlDriver._cleanDom(o)
              i--
              continue
            }
          }else if(o._data._idx!=o._data._key){
            o._data._key=o._data._idx
            var _dom=_CtrlDriver._drawView(o._ctrl,o._data,o._viewDef);
            $(_dom).insertBefore(o);
            _last=_dom;
            _CtrlDriver._cleanDom(o)
          }else{
            _last=o
          }
        }
        _idx++;
      }else if(_idx){
        break;
      }
    }
    if(_last!=_tmp){
      _CtrlDriver._cleanDom(_tmp)
      _tmp=0
    }
    var _tmpViewDef=_CtrlDriver._clone(u._viewDef);
    delete _tmpViewDef._dataRepeat;
    let _lastItem=_findEndItem(u._dom)

    for(var n=_idx;_data && n<_data.length;n++){
      var _dom=_CtrlDriver._drawView(u._ctrl,{_item:_data[n],_group:u._group,_supData:u._supData,_idx:n,_key:n},_tmpViewDef);
      if(_last){
        $(_dom).insertAfter(_last);
        if(_last===_tmp){
          _CtrlDriver._cleanDom(_last)
          _tmp=0
        }
      }else if(_lastItem){
        $(_dom).insertBefore(_lastItem)
      }else{
        $(u._dom).append(_dom);
      }
      _last=_dom;
    }
    if(_last==_tmp && _tmp){
      _CtrlDriver._cleanDom(_last)
    }

    function _findEndItem(d){
      for(let o of d.children){
        if(o._viewDef&&o._viewDef._endItem){
          return o
        }
      }
    }
  },
  _updateRepeatInObject:function(u,_data){
    if(_data&&_data.constructor==String){
      _data=[_data]
    }else if(_data&&_data.constructor==Number){
      _data=new Array(_data).fill(0)
    }
    var _tmpViewDef=_CtrlDriver._clone(u._viewDef);
    delete _tmpViewDef._dataRepeat;

    var _oth=0;
    var _insertMethod="append";
    var _othDom=null;
    while(u._dom.childNodes.length>_oth){
      var o=u._dom.childNodes[_oth];
      var _equal=false;
      try{
        _equal=JSON.stringify(o._viewDef)==JSON.stringify(_tmpViewDef);
      }catch(e){}
      if(_equal){
        _CtrlDriver._cleanDom(o);
      }else if(_oth){
        _othDom=o;
        _insertMethod="insertBefore";
        break
      }else{
        _oth++;
      }
    }

    for(var n in _data){
      var _dom=_CtrlDriver._drawView(u._ctrl,{_item:_data[n],_group:u._group,_supData:u._supData,_idx:n,_key:n},_tmpViewDef);
      if(_insertMethod=="append"){
        $(u._dom).append(_dom);
      }else{
        $(_dom).insertBefore(_othDom);
      }
    }
  },
  _repeatData:function(_ctrl,_data,_viewDef,_box,_point){
    _CtrlDriver._curDomItem={
      _dom:_box,
      _attr:"repeat",
      _time:Date.now(),
      _group:_viewDef._dataRepeat,
      _supData:_data,
      _ctrl:_ctrl,
      _viewDef:_viewDef
    };
    var value = _CtrlDriver._retrieveResult(_viewDef._dataRepeat,_data,_ctrl,_box,_viewDef)||[];
    var _doms=[];
    if(value){
      if(value.constructor==Number){
        value=new Array(value).fill(0);
      }else if(value.constructor==String){
        value=[value]
      }
      var _tmpViewDef=_CtrlDriver._clone(_viewDef);
      delete _tmpViewDef._dataRepeat;
      for(var k in value){
        if($.isNumeric(k)){
          k=parseInt(k);
        }
        var o={
          _item:value[k],
          _group:_viewDef._dataRepeat,
          _supData:_data,
          _idx:k,
          _key:k,
          _groupValue:value
        }
        if(value.constructor==Array){
          o._size=value.length
        }

        _doms.push(_CtrlDriver._drawView(_ctrl,o,_tmpViewDef,_box,_point));
      }

      _CtrlDriver._curDomItem={
        _dom:_box,
        _attr:"repeat",
        _time:Date.now(),
        _group:_viewDef._dataRepeat,
        _supData:_data,
        _ctrl:_ctrl,
        _viewDef:_viewDef
      };
  
    }
    return _doms;
  },
  _drawView:function(_ctrl,_data,_viewDef,_box,_point){
    if(_viewDef._data){
      _data=_CtrlDriver._retrieveResult(_viewDef._data,_data,_ctrl,_box,_viewDef);
    }

    _CtrlDriver._initUIBind(_ctrl,_data,_viewDef);
    if(_viewDef._if!==undefined && !_CtrlDriver._updateIf()){
      if(_point){
        $(_CtrlDriver._curDomItem._dom).insertAfter(_point);
      }else{
        $(_box).append(_CtrlDriver._curDomItem._dom);
      }
      return _CtrlDriver._curDomItem._dom;
    }
    if(_viewDef._dataRepeat){
      return _CtrlDriver._repeatData(_ctrl,_data,_viewDef,_box);
    }
    var _dom=null;
    if(_viewDef._tag){
      _dom=_CtrlDriver._updateDom(_CtrlDriver._curDomItem,_data);
    }else if(_viewDef._load){
      _dom=_CtrlDriver._loadContent();
    }else if(_viewDef._html){
      _dom=_CtrlDriver._updateHtml();
    }else if(_viewDef._text){
      _dom=_CtrlDriver._updateText();
    }
    if(_viewDef._dragOrder){
      _CtrlDriver._setDragOrder(_dom,_viewDef._dragOrder)
    }
    if(_point){
      $(_dom).insertAfter(_point);
    }else if(_box){
      $(_box).append(_dom);
      _CtrlDriver._attachEnable(_box,_dom)
    }

    return _dom;
  },
  _attachEnable:function(_box,_dom,_enable,_disabled){
    if(_box._viewDef&&((_enable!==undefined||_disabled!==undefined)||(_box._viewDef._attr&&_box._viewDef._attr.enable)||$(_box).attr("enable"))){
      if(_enable===undefined&&_disabled===undefined){
        _enable=$(_box).attr("enable")
        _disabled=$(_box).attr("disabled")
      }
      _enable=(_disabled?0:_enable)&&true
      if(_dom){
        if(_dom.tagName){
          _doDom(_dom,_enable,_disabled)
        }
      }else{
        for(let o of _box.children){
          _doDom(o,_enable,_disabled)
        }
      }
    }

    function _doDom(o,_enable,_disabled){
      if(o._viewDef){
        if($(o).attr("disabled")||(o._viewDef._attr&&o._viewDef._attr.enable)||$(o).attr("enable")==_enable){
        }else{
          $(o).attr("enable",_enable)
          _CtrlDriver._attachEnable(o,0,_enable,_disabled)
        }
      }
    }
  },
  _setDragOrder:function(_dom,_dragOrder,_retry){
    _retry=_retry||0
    let p=_dragOrder._getBox?_dragOrder._getBox(_dom):_dom.parentElement
    if(!p){
      if(_retry>100){
        return
      }
      return setTimeout(()=>{
        _CtrlDriver._setDragOrder(_dom,_dragOrder,_retry+1)
      },10)
    }
    if(p._dragOrder){
      _dragOrder=p._dragOrder
    }else{
      p._dragOrder=_dragOrder
    }
    $(_dom).css({cursor:"move"})
    _dom.droppable=true
    _dom.draggable=true
    _dom.ondragover=function(e){
      if(_dragOrder._if){
        if(!_dragOrder._if()){
          retrn
        }
      }
      if(_dragOrder._curElement){
        e.preventDefault();
        let os=_dragOrder._curElement.parentElement.children
        _setDragInsertPosMark(os[os.length-1])
        _dragOrder._curOver=this
        if(this!=_dragOrder._curElement){
          for(o of os){
            if(o==this){
              this._insert="top"
              break
            }else if(o==_dragOrder._curElement){
              this._insert="bottom"
              break
            }
          }
          _setDragInsertPosMark(this,this._insert)
        }
      }
    }
    _dom.ondragstart=function(e){
      if(_dragOrder._if){
        if(!_dragOrder._if()){
          retrn
        }
      }
      _dragOrder._curElement=this
      _dragOrder._curItem=_getItemData(this)
      
      if(!p.droppable){
        p.droppable=true
        p.ondragend=function(){
          if(_dragOrder._curElement){
            let _list = _getListData();
            let _idx=_list.indexOf(_dragOrder._curItem)
            if(_idx<_list.length-1){
              _list.splice(_idx,1)
              _list.push(_dragOrder._curItem)
              _dragOrder._after&&_dragOrder._after()
            }
          }
        }
        p.ondragover=function(e){
          if(_dragOrder._curElement&&!_dragOrder._curOver){
            e.preventDefault()
            let os=_dragOrder._curElement.parentElement.children
            _setDragInsertPosMark(os[os.length-1],"bottom")
          }
        }
      }
    }
    _dom.ondragend=function(e){
      if(_dragOrder._if){
        if(!_dragOrder._if()){
          retrn
        }
      }
      console.log("dom - ondragend")

      let _list = _getListData();
      let _item1=_dragOrder._curItem
      if(!_dragOrder._curOver){
        return
      }
      let _item2=_getItemData(_dragOrder._curOver)
      e.preventDefault();
      _dragOrder._curElement=0
      if(_item1==_item2){
        _setDragInsertPosMark(this)
        return
      }
      let _idx=_list.indexOf(_item1)
      _list.splice(_idx,1)
      _idx=_list.indexOf(_item2)
      
      if(_dragOrder._curOver._insert=="top"){
        _list.splice(_idx,0,_item1)
      }else{
        _list.splice(_idx+1,0,_item1)
      }
      if(_list&&_list[0]&&$.isNumeric(_list[0].idx)){
        _list.forEach((x,i)=>{
          x.idx=i
        })
      }
      _setDragInsertPosMark(this)
      _dragOrder._curElement=0
      _dragOrder._after&&_dragOrder._after()
    }
    _dom.ondragleave=function(e){
      _setDragInsertPosMark(this)
    }
    
    function _getListData(){
      return _dragOrder._getListData.constructor==Function?_dragOrder._getListData():_dragOrder._getListData
    }
    
    function _getItemData(o){
      return _dragOrder._getItemData?_dragOrder._getItemData():o._data._item
    }
    function _setDragInsertPosMark(o,t){
      if(!o._topBorder){
        o._topBorder=$(o).css("border-top")
        o._bottomBorder=$(o).css("border-bottom")
      }
      
      $(o).css({"border-top":o._topBorder,"border-bottom":o._bottomBorder})
      _dragOrder._curOver=0
      if(t){
        _dragOrder._curOver=o
        let d={}
        d["border-"+t]="2px dotted var(--active-color)"
        $(o).css(d)
      }
    }
  },
  _fillAttrs:function(_viewDef,_data,_ctrl){
    var _html="";
    var _orgValue=null;
    if(_viewDef._attr){
      for(var k in _viewDef._attr){
        /*
        for event, if value include '"', example:
        to get: onclick="alert(\"1\")", set like: onclick:"alert(\\\"1\\\")"
        to get: onclick="alert(\"abc' xyz\")", set like: onclick:"alert(\\\"abc' xyz\\\")"
        */
        var m=k.match(/^on[a-z]+/);
        var v=_viewDef._attr[k];
        if(!m || m[0]!=k || v.constructor!==String){
          _CtrlDriver._curDomItem={_dom:_CtrlDriver._curDomItem._dom,_attr:"['_attr']['"+k+"']"};
          if(!v){
          }
          v=_CtrlDriver._retrieveResult(v,_data,_ctrl,0,_viewDef);
          if(v===undefined){
            continue
          }
          v=v===null?"":v;
          if(["disabled","readonly","required","selected","checked","draggable","droppable","enable"].indexOf(k)>=0){
            if(v){
              _html+=" "+k+"=\"true\"";
            }
            continue;
          }
        }
        if(v===null || (v && (v.constructor==Array || v.constructor==Object))){
          _orgValue=v;
          v=_CtrlDriver._tmpValue++;
        }
        if(v.includes){
          if(!v.includes('"')){
            v='"'+v+'"';
          }else if(!v.includes("'")){
            v="'"+v+"'";
          }else{
            v='"'+v.replace(/"/g,"&quot;")+'"';
          }
        }else{
          v='"'+v+'"';
        }
        _html+=" "+k+"="+v;
      }
      
      var _tag=_CtrlDriver._retrieveResult(_viewDef._tag,_data,_ctrl,0,_viewDef);
      if(_tag.toLowerCase()=="input" && !_viewDef._attr.type){
        _html+=" type=\"text\"";
      }
    }
    if(_orgValue){
      return {_orgValue:_orgValue,_html:_html};
    }
    return _html;
  },
  _bindJqExt:function(_jqext,_jq,_data){
    if(_jqext){
      if(_jqext.constructor==String){
        _jqext=eval(_jqext)
      }else if(_jqext.constructor==Function){
        _jqext=_jqext(_data)
      }
      _jq=$(_jq);
      for(var k in _jqext){
        if(!_jqext[k]){
          continue
        }
        if(_jqext[k].constructor==String){
          _jqext[k]=eval("_jqext[k]="+_jqext[k]);
        }
        
        if($.isArray(_jqext[k])){
          _jq[k](_jqext[k][0],_jqext[k][1]);
        }else{
          if(["BUTTON","INPUT","TEXTAREA","SELECT"].includes(_jq[0].tagName)&&["click","mousedown","dbclick"].includes(k)){
            _jq[0]["bzEvent"+k]=_jqext[k];
            _jq[k](function(a,b,c){
              if(k=="click"&&_CtrlDriver._blockTest(a)){
                return false;
              }

              if($(this.ownerDocument).find("[disabled]").find(this).length){
                if(!$(this).attr("enable")){
                  a.stopPropagation();
                  a.preventDefault();
                  return
                }
              }
              this["bzEvent"+a.type](a,b,c)
            })
          }else{
            _jq[k](_jqext[k]);
          }
        }
      }
    }
  },
  _isFunction:function(s){
    if(s&&s.constructor==String){
      s=s.trim()
      return s.match(/^\(?(function|\([^\)]*\) *=> *)/)
    }
  },
  _simpleClone:function(o){
    if(o){
      let n={}
      if(o.constructor==Array){
        n=[]
      }else if(o.cloneNode){
        return o.cloneNode()
      }else if(o.constructor!=Object){
        return o
      }

      for(var k in o){
        n[k]=o[k]
      }
      return n
    }
    return o
  },
  _sign:/[^\$\_\-\wÀ-Üà-øoù-ÿŒœ\u4E00-\u9FCC]+/,
  _setBZCommonBehavior:function(jq){
    // if(jq.tagName=="TEXTAREA"
    //   ||(jq.tagName=="INPUT" && (!jq.type || !["checkbox","button","radio"].includes(jq.type)))
    //   ||$(jq).hasClass("ai-select")){
    //   $(jq).mouseup(function(e){
    //     let o=e.target
    //     setTimeout(()=>{
    //       let aa=o._ctrlSelectionStart||0,
    //           bb=o._ctrlSelectionEnd||0,
    //           a=o.selectionStart,
    //           b=o.selectionEnd,
    //           _sel,_range,ac,bc,aac,bbc

    //       if(!["INPUT","TEXTAREA"].includes(e.target.tagName)){
    //         _sel = window.getSelection();
    //         _range = _sel.getRangeAt(0);

    //         a=_range.startOffset
    //         b=_range.endOffset
    //         ac=_range.startContainer
    //         bc=_range.endContainer
    //         aac=o._ctrlContainerStart
    //         bbc=o._ctrlContainerEnd
    //       }
              
    //       if(a==b&&(ac==bc)&&(ac!=aac||aa>a||bb<a)){
    //         let _word=_range?_Util._getElementContentText(_range.startContainer):o.value
    //         if(!_word){
    //           return
    //         }
    //         if(a==_word.length){
    //           a--
    //           b--
    //         }
    //         for(let i=a;i>=0;i--){
    //           let c=_word[i]
    //           if(!c){
    //             break
    //           }
    //           if(!c.match(_CtrlDriver._sign)){
    //             a=i
    //           }else{
    //             break
    //           }
    //         }
    //         for(let i=a;i<_word.length;i++){
    //           let c=_word[i]
    //           if(!c){
    //             break
    //           }
    //           if(!c.match(_CtrlDriver._sign)){
    //             b=i+1
    //           }else{
    //             break
    //           }
    //         }

    //         if(!_range){
    //           if(a!=b){
    //             o.selectionStart=a
    //             o.selectionEnd=b
    //           }else{
    //             a=o.selectionStart
    //             b=o.selectionEnd
    //           }
    //         }else{
    //           if(a!=b){
    //             _range.setStart(_range.startContainer, a);
    //             _range.setEnd(_range.endContainer, b);
    //           }else{
    //             a=o._ctrlSelectionStart
    //             b=o._ctrlSelectionEnd
    //           }
    //         }
    //       }
    //       if(_range){
    //         o._ctrlSelectionStart=a
    //         o._ctrlSelectionEnd=b
    //         o._ctrlContainerStart=ac
    //         o._ctrlContainerEnd=bc
    //       }else{
    //         o._ctrlSelectionStart=o.selectionStart
    //         o._ctrlSelectionEnd=o.selectionEnd
    //       }
    //     })
    //   });
    // }
  },
  _cleanFromData:function(_data){
    var _count=0;
    var _clean=0;
    if(_data && _data._uiMap){
      for(var k in _data._uiMap){
        var _uiList=_data._uiMap[k];
        for(var i=0;i<_uiList.length;i++){
          var u=_uiList[i];
          _count++;
          if(!u._dom || !u._dom.parentElement){
            _uiList.splice(i,1);
            _clean++;
            i--;
          }
        }
        var _result=_CtrlDriver._cleanFromData(_data[k]);
        _count+=_result._count;
        _clean+=_result._clean;
      }
    }
    return {_count:_count,_clean:_clean};
  },
  _clone:function(o){
    if($.type(o)=="array"){
      return $.extend(true,[],o);
    }else if($.type(o)=="object"){
      return $.extend(true,{},o);
    }
    return o;
  },
  _equalObj:function(o1,o2){
    if(o1==o2){
      return 1;
    }else if(!o1 || !o2){
      return 0;
    }
    o1=JSON.stringify(o1);
    o2=JSON.stringify(o2);
    if(o1==o2){
      return 1;
    }else if(o1.constructor!==String || o2.constructor!==String || o1.length!=o2.length){
      return 0;
    }
    o1=JSON.parse(o1);
    o2=JSON.parse(o2);
    return this._sortJson(o1)==this._sortJson(o2);
  },
  _sortJson:function(d,_ignoreNull,tab){
    if(!tab){
      tab="";
    }
    var _result="";
    if(d && d.constructor==Object){
      var _keys=[];
      for(var k in d){
        if(d[k]===undefined || (_ignoreNull && !d[k] && d[k]!==0 && d[k]!==false)){
          continue;
        }
        _keys.push(k);
      }
      _keys.sort();
      _result=tab+"{\n"
      for(var i=0;i<_keys.length;i++){
        k=_keys[i];
        _result+=tab+"  \""+k+"\":"+this._sortJson(d[k],_ignoreNull,tab+"  ");
        if(i<_keys.length-1){
          _result+=",\n";
        }else{
          _result+="\n";
        }
      }
      _result+=tab+"}";
    }else if(d && d.constructor==Array){
      _result=tab+"[\n"
      for(var k in d){
        _result+=this._sortJson(d[k],_ignoreNull,tab+" ");
        if(k<d.length-1){
          _result+=",\n";
        }else{
          _result+="\n";
        }
      }
      _result+=tab+"]";
    }else{
      _result=JSON.stringify(d);
    }
    return _result;
  },
  _setupKeyInput:function(_doc){
    _doc=_doc||document
    $(_doc).ready(function(){
      $(_doc.body).on("keydown",".bz-key-input",function(e){
        let m=_Util._matchAllSign
        if(event.key&&m.test(event.key)){
          event.preventDefault();
        }
      });
      $(_doc.body).on("keyup",".bz-key-input",function(e){
        if(!this._chInput&&this.value.match(_Util._matchAllSign)){
          this.value=this.value.replace(_Util._matchAllSign,"")
        }
      });
      $(_doc.body).on("compositionstart",".bz-key-input",function(e){
        this._chInput=1
      });
      $(_doc.body).on("compositionend",".bz-key-input",function(e){
        this._chInput=0
        this.value=this.value.replace(_Util._matchAllSign,"")
      });
      $(_doc.body).on("keydown",".bz-name-input",function(e){
        let m=/[0-9a-z-\._]/i
        if (!m.test(event.key)) {
          event.preventDefault();
        }
      });
      $(_doc.body).on("keyup",".bz-name-input",function(e){
        this.value=this.value.replace(/[^0-9a-z-\._]/ig,"")
      });
    
      $(_doc.body).on("keyup",".bz-name-input",function(e){
        this.value=this.value.replace(/[^0-9a-z-\._]/ig,"")
      });
  
      $(_doc.body).on("focus","input,select,textarea,[contenteditable]",function(e){
        if($(this).attr("enable")){
          return
        }
        if($(_doc).find("[disabled]").find(this).length){
          this.blur()
        }
      });
      $(_doc.body).on("mousedown","INPUT,SELECT,TEXTAREA,BUTTON,LABEL",function(e){
        if($(_doc).find("[disabled]").find(this).length){
          if($(this).attr("enable")){
            return
          }

          e.stopPropagation();
          e.preventDefault();
          let o=this
          o.disabled=true
          $(o).find("input,select,textarea,[contenteditable],button").attr("disabled",true)
          setTimeout(()=>{
            o.disabled=false
            $(o).find("input,select,textarea,[contenteditable],button").attr("disabled",false)
          },3000)
          return false;
        }
      });
  
      // $(_doc.body).on("click","*",function(e){
      //   if($(_doc).find("[disabled]").find(this).length){
      //     e.stopPropagation();
      //     if($(this).attr("enable")){
      //       return
      //     }
      //     e.preventDefault();
      //     return false;
      //   }
      // });
    })
  },
  _getResizePanelElement:function(_triggerFun,_panel,_offset,_fun){
    return {
      _tag:"span",
      _after:function(o,i){
        _resize()
        function _resize(){
          setTimeout(()=>{
            if(_fun){
              return _fun(o)
            }
            let w=o.ownerDocument.defaultView.innerHeight
            let ro=$(o.ownerDocument).find(_panel)[0]
            let r=ro.getBoundingClientRect()
            if(r.top>=w){
              return _resize()
            }
            $(ro).css({height:`calc(100% - ${r.top+_offset}px)`})
          })
        }
      },
      _attr:{
        style:function(d,c,o){
          _triggerFun(d)
          if(o){
            o._viewDef._after(o)
          }
          return "visibility:hidden;"
        }
      }
    }
  }
};
_CtrlDriver._setupKeyInput();
var _extractData={
//bz-test-code-start
  _testData:{
    d:{
      name:"name-1",
      value:"value-1",
      data:{
        name:"name-2",
        value:"value-2"
      },
      list:[
        {
          name:"name-3",
          value:"value-3"
        },
        {
          name:"name-4",
          value:"value-4",
          age:33
        },
        {
          name:"name-5",
          value:"value-5",
          age:33
        }
      ]
    },
    ds:[{
      name:"name-1",
      value:"value-1",
      data:{
        name:"name-2",
        value:"value-2"
      },
      list:[
        {
          name:"name-3",
          value:"value-3"
        },
        {
          name:"name-4",
          value:"value-4",
          age:33
        },
        {
          name:"name-5",
          value:"value-5",
          age:33
        }
      ]
    },{
      name:"name-1",
      value:"value-1",
      data:{
        name:"name-2",
        value:"value-2"
      },
      list:[
        {
          name:"name-3",
          value:"value-3"
        },
        {
          name:"name-4",
          value:"value-4",
          age:33
        },
        {
          name:"name-5",
          value:"value-5",
          age:33
        }
      ]
    }]
  },
  _test:function(){
    let d=_extractData._testData.d,
        ds=_extractData._testData.ds
    
    _testData(d)
    _testData(ds)
    function _testData(d){
      console.log("Test extractData: ------------------------")
      _showData(d,"name",{name:"name-1"})
      _showData(d,"name(Name)",{"Name":"name-1"})
      _showData(d,"name()","name-1")
      _showData(d,"*().name()",["name-1","name-2","name-3","name-4","name-5"])
      _showData(d,["name","value"],{"name": "name-1","value": "value-1"})
      _showData(d,["name(Name)","value(Value)"],{"Name": "name-1","Value": "value-1"})

      _showData(d,["*.name","*.value"],{
        "name": "name-1",
        "data": {
          "name": "name-2",
          "value": "value-2"
        },
        "list": [
          {
            "name": "name-3",
            "value": "value-3"
          },
          {
            "name": "name-4",
            "value": "value-4"
          },
          {
            "name": "name-5",
            "value": "value-5"
          }
        ],
        "value": "value-1"
      })
      _showData(d,["*(obj).name","*(obj).value"],{
        "obj": {
          "name": "name-1",
          "data": {
            "name": "name-2",
            "value": "value-2"
          },
          "list": [
            {
              "name": "name-3",
              "value": "value-3"
            },
            {
              "name": "name-4",
              "value": "value-4"
            },
            {
              "name": "name-5",
              "value": "value-5"
            }
          ],
          "value": "value-1"
        }
      })
      _showData(d,["*(obj1).name","*(obj2).value"],{
        "obj1": {
          "name": "name-1",
          "data": {"name": "name-2"},
          "list": [{"name": "name-3"},{"name": "name-4"},{"name": "name-5"}]
        },
        "obj2": {
          "value": "value-1",
          "data": {"value": "value-2"},
          "list": [{"value": "value-3"},{"value": "value-4"},{"value": "value-5"}]
        }
      })
      _showData(d,{"*":["name","value"]},{
        "name": "name-1",
        "value": "value-1",
        "data": {
          "name": "name-2",
          "value": "value-2"
        },
        "list": [
          {
            "name": "name-3",
            "value": "value-3"
          },
          {
            "name": "name-4",
            "value": "value-4"
          },
          {
            "name": "name-5",
            "value": "value-5"
          }
        ]
      })
      _showData(d,{"*(obj)":["name(Name)","value(Value)"]},{
        "obj": {
          "Name": "name-1",
          "Value": "value-1",
          "data": {
            "Name": "name-2",
            "Value": "value-2"
          },
          "list": [
            {
              "Name": "name-3",
              "Value": "value-3"
            },
            {
              "Name": "name-4",
              "Value": "value-4"
            },
            {
              "Name": "name-5",
              "Value": "value-5"
            }
          ]
        }
      })
      _showData(d,{"+":["name","value"]},{
        "data": {
          "name": "name-2",
          "value": "value-2"
        },
        "list": [
          {
            "name": "name-3",
            "value": "value-3"
          },
          {
            "name": "name-4",
            "value": "value-4"
          },
          {
            "name": "name-5",
            "value": "value-5"
          }
        ]
      })
      _showData(d,{"+(obj)":["name(Name)","value(Value)"]},{
        "obj": {
          "data": {
            "Name": "name-2",
            "Value": "value-2"
          },
          "list": [
            {
              "Name": "name-3",
              "Value": "value-3"
            },
            {
              "Name": "name-4",
              "Value": "value-4"
            },
            {
              "Name": "name-5",
              "Value": "value-5"
            }
          ]
        }
      })
      // _showData(d,{"*":[{"bz-if":{"name()":"name-4"}},"name","value"]})
      // _showData(d,{"*":[{"bz-if":{"*().name()":"name-4"}},"name","value"]},{
      //   "name": "name-1",
      //   "value": "value-1",
      //   "list": [
      //     {
      //       "name": "name-4",
      //       "value": "value-4"
      //     }
      //   ]
      // })
      // _showData(d,{"*":[{"bz-if":{"*().name()":"name-4"}},"*"]},d)      
      // _showData(d,{"*(array)":[{"bz-if":{"*().name()":"name-4"}},"name(Name)","value(Value)"]},{
      //   "array": {
      //     "Name": "name-1",
      //     "Value": "value-1",
      //     "list": [
      //       {
      //         "Name": "name-4",
      //         "Value": "value-4"
      //       }
      //     ]
      //   }
      // })
      // _showData(d,{"*":[{"bz-if":{"name":"name-3"}},{"bz-if":{"*.name":"name-4"}},"name","value"]})
      // _showData(d,{"*":[{"bz-if":{name:/name-[13]+/}},"name","value"]},{
      //   "name": "name-1",
      //   "value": "value-1",
      //   "list": [
      //     {
      //       "name": "name-3",
      //       "value": "value-3"
      //     }
      //   ]
      // })
      console.log("Test checkData: ------------------------")
      _showChkResult(d,/[0-9]+/)
      _showChkResult(d,{"*.name":/name-[0-9]+/})
      _showChkResult(d,{"*":{
        name:/name-[0-9]+/,
        value:/value-[0-9]+/,
        age:/[0-9]+/
      }})
    }
    function _showChkResult(d,k){
      if(!_extractData._checkData(d,k)){
        console.error("failed: "+__(k))
      }
    }
    function _showData(d,k,t){
      let kk=_Util._clone(k)
      if(d.constructor===Array&&d!==t){
        t=t?[t,t]:[]
      }
      d=_extractData._extract(d,k)

      if(_Util._isEqualData(d,t)){
        // console.log("pass: "+__(kk))
      }else{
        console.error("failed: "+__(kk))
        console.log(d?__(d):d)
      }
    }
  },
//bz-test-code-end
  _data:_CtrlDriver._buildProxy({
    _definition:{},
    _orgData:{},
    _showResult:1,
    _type:"v"
  }),
  /**
   * 1, "name1", "name1.name2","name1.*.name", name1 in top level, name2 under object of name1
   * 2, ["name1","name2"], in any level
   * 3, {name1:["name2","name3"]}, name1 is in the any leval, name2 and name3 are under name1, but in the any level
   * 4, {name1:["name2","name3"]}, name1 is in the any leval, name2 and name3 are under name1, but in the any level
   * 4, {name1:["name2","name3"]}, name1 is in the any leval, name2 and name3 are under name1, but in the any level
   */
  _extract:function(ov,ks){
    if(!ov||!ks){
      return
    }else if(!_Util._isObjOrArray(ov)){
      if(ks.constructor==String){
        if(ks[0]=="+"){
          return
        }else if(ks[0]=="*"){
          return ov
        }
      }
      return
    }

    ov=_Util._clone(ov);

    ks=_handleKey(ks);
    ov= _takeDataByMap(ov,ks)

    return _clearEmptyData(ov)

    function _takeDataByMap(v,km,_parent){

      if(km.constructor==Function||km.constructor==RegExp){
        if(_Util._isObjOrArray(v)){
          return _filterEndData(v,km)
        }else{
          if(km.constructor==Function){
            if(km(v)){
              return v
            }
          }else if(km.constructor==RegExp){
            if(km.test(v)){
              return v
            }
          }
        }
      }
      if(!_Util._isObjOrArray(v)){
        return
      }
      if(v.constructor==Array){
        return v.map(x=>{
          return _takeDataByMap(x,km,_parent)
        })
      }
      if(km.constructor==String){
        let vv={}
        vv[km]=""
        return _takeDataByMap(v,vv,_parent)
      }

      let _data={}
      for(let k in km){
        let kv=km[k],d;
        if(km.constructor==Array){
          d=_takeDataByMap(v,kv,_parent)
        }else{
          d=_takeDataByKey(v,k,_parent,kv);
        }

        if(d){
          if(_Util._isObjOrArray(d)){
            _data=_mergeData(_data,d)
          }else if(_Util._isEmpty(_data)){
            _data=d
          }else if(_data.constructor==Array){
            _data.push(d)
          }else{
            _mergeList(_data,d,"dataList")
          }
        }
      }
      if(!_Util._isEmpty(_data)){
        return _data
      }
    }

    function _filterEndData(v,d){
      if(!v||!_Util._isObjOrArray(v)){
        if(d.constructor==Function){
          return d(v)
        }else{
          return d.test(v)
        }

      }else if(v.constructor==Array){
        v=v.filter(x=>_filterEndData(x,d))
      }else{
        for(let k in v){
          if(!_filterEndData(v[k],d)){
            delete v[k]
          }
        }
      }
      return v
    }

    function _clearEmptyData(v){
      if(!v){
      }else if(v.constructor==Array){
        v=v.map(x=>_clearEmptyData(x)).filter(x=>x!==undefined&&(!_Util._isObjOrArray(x)||!_Util._isEmpty(x)))
      }else{
        for(let k in v){
          let vv=v[k]
          if(_Util._isObjOrArray(vv)){
            vv=_clearEmptyData(vv)
            v[k]=vv
            if(vv&&_Util._isEmpty(vv)&&vv){
              delete v[k]
            }
          }else if(vv===undefined){
            delete v[k]
          }
        }
      }
      return v
    }

    function _takeDataByKey(v,k,_parent,_subKeys){
      k=_parseKey(k)
      if(k._key=="*"||k._key=="+"){
        if(k._key=="+"){
          v= _skipRootData(v)
        }
        if(_subKeys){
          v =_takeDataByMap(v,_subKeys,k)
        }
        if(!_Util._isEmpty(v)){
          if(!k._name){
            return _pickEndData(v,_subKeys)
          }else if(k._name=="*"){
            if(_parent&&!_parent._name&&(_parent._key=="*"||_parent._key=="+")){
              return _pickEndData(v,1)
            }else{
              return v
            }
          }else{
            return _newValue(v,k._name)
          }
        }
      }else if(_parent&&(_parent._key=="*"||_parent._key=="+")){
        return _filterDataByKey(v,k,_subKeys)
      }else{
        v=v[k._key]
        if(v){
          let v1={}
          v1[k._key]=v
          return _filterDataByKey(v1,k,_subKeys)
        }
      }
    }

    function _filterDataByKey(v,k,_subKeys){
      let d={}
      if(v.constructor==Array){
        d=v.map(x=>_filterDataByKey(x,k,_subKeys))
      }else{
        for(let kk in v){
          let kv=v[kk]
          if(kk==k._key){
            if(kv!==undefined){
              if(_subKeys){
                kv=_takeDataByMap(kv,_subKeys,k)
              }else{
                delete v[kk]
              }
              if(kv!==undefined){
                if(k._name){
                  d[k._name]=kv
                }else if(_Util._isEmpty(d)){
                  d=kv
                }else if(d.constructor!=Array){
                  if(kv&&kv.constructor==Array){
                    d=[d,...kv]
                  }else{
                    d=[d,kv]
                  }
                }else{
                  if(kv&&kv.constructor==Array){
                    d.push(...kv)
                  }else{
                    d.push(kv)
                  }
                }
              }
            }
          }else if(_Util._isObjOrArray(kv)&&!_Util._isEmpty(kv)){
            kv=_filterDataByKey(kv,k,_subKeys)
            if(kv){
              if(k._name){
                d[kk]=kv
              }else if(_Util._isEmpty(d)){
                d=kv
              }else if(d.constructor!=Array){
                if(kv&&kv.constructor==Array){
                  d=[d,...kv]
                }else{
                  d=[d,kv]
                }
              }else{
                if(kv&&kv.constructor==Array){
                  d.push(...kv)
                }else{
                  d.push(kv)
                }
              }
            }
          }
        }
      }
      if(!_Util._isEmpty(d)){
        return d
      }
    }

    function _pickEndData(vv,_keepLabel,_data,_listKey){
      if(!_Util._isObjOrArray(vv)){
        return vv
      }
      if(_keepLabel){
        _data=_data||{}
        if(vv.constructor==Array){
          let nv=[]
          vv.forEach(x=>{
            if(x&&x.constructor==Object){
              _pickEndData(x,1,_data)
            }else{
              nv.push(x)
            }
          })
          if(nv.length){
            if(_Util._isEmpty(_data)){
              if(_listKey){
                _data[_listKey]=nv
              }else{
                _data=nv
              }
            }else{
              if(!_listKey){
                _listKey="dataList"
              }
              _mergeList(_data,nv,_listKey)
            }
          }
          return _data
        }
      }else{
        _data=_data||[]
      }
      for(let kk in vv){
        let v=vv[kk]
        if(_Util._isObjOrArray(v)){
          _data=_pickEndData(v,_keepLabel,_data,kk)
        }else{
          if(!_keepLabel){
            _data.push(v)
          }else{
            _mergeList(_data,v,kk)
          }
        }
        delete vv[kk]
      }
      return _data
    }

    function _mergeList(d,v,k){
      if(d[k]===undefined){
        d[k]=v
      }else{
        if(d[k]===undefined){
          d[k]=[]
        }else if(d[k].constructor!=Array){
          d[k]=[d[k]]
        }
        if(v&&v.constructor==Array){
          d.push(...v)
        }else{
          d[k].push(v)
        }
      }
    }
    function _newValue(v,n){
      let d={}
      d[n]=_cloneObj(v)
      return d
    }
    function _cloneObj(v){
      if(_Util._isObjOrArray(v)){
        let d=v.constructor==Array?[]:{}
        for(let k in v){
          d[k]=v[k]
          delete v[k]
        }
        v=d
      }
      return v
    }

    function _skipRootData(v){
      let d={}
      for(let k in v){
        let vv=v[k]
        if(_Util._isObjOrArray(vv)){
          d[k]=vv
        }
      }
      return d
    }

    function _mergeData(d,v){
      if(_Util._isEmpty(d)){
        return v
      }
      for(let k in v){
        let dv=d[k],vv=v[k]
        if(vv===undefined||dv===vv){
          continue
        }else if(dv===undefined){
          d[k]=v[k]
        }else if(_Util._isObjOrArray(vv)&&dv.constructor==vv.constructor){
          for(let kk in vv){
            if(vv[kk]===undefined){
            }else if(dv[kk]===undefined){
              dv[kk]=vv[kk]
            }else if(dv[kk]!=vv[kk]){
              _mergeData(dv[kk],vv[kk])
            }
          }
        }
      }
      return d
    }

    function _parseKey(k){
      let kk=k.split("(")
      if(kk.length>1){
        let k1=kk[1].replace(")","").split(",")
        kk={
          _key:kk[0],
          _name:kk[0]=="+"?"*":kk[0],
          _org:k
        }
        if(k1.length){
          k1.forEach(n=>{
            if(n=="-"){
              kk._minus=1
            }else if(n=="1"||n=="-1"){
              kk._idx=parseInt(n)
            }else{
              kk._name=n
            }
          })
        }else{
          kk._name=""
        }
      }else{
        kk={
          _key:k,
          _name:k=="+"?"*":k,
          _org:k
        }
      }
      return kk
    }

    function _handleStringKey(k,d){
      let v=d[k]
      if(k.indexOf(",")==-1){
        if(k.indexOf(".")>0){
          delete d[k]
          k=k.split(".").map(x=>x.trim())
          let ok=d;
          k.forEach((kk,i)=>{
            if(i<k.length-1){
              if(!ok[kk]){
                ok[kk]={}
              }else if(ok[kk].constructor==String){
                let vv=ok[kk]
                ok[kk]={}
                ok[kk][vv]=""
              }
              ok=ok[kk]
            }else{
              ok[kk]=v
            }
          })
        }
      }else{
        k=k.split(",").map(x=>x.trim())
        k.forEach((kk,i)=>{
          d[kk]=v
          _handleStringKey(kk,d)
        })
      }
      return d
    }
    function _handleKey(k){
      if(k.constructor==Array){
        return k.map(x=>_handleKey(x))
      }else if(k.constructor==Object){
        for(let kk in k){
          k[kk]=_handleKey(k[kk])
          _handleStringKey(kk,k)
        }
        return k
      }else if(k.constructor==Function||k.constructor==RegExp){
        return k
      }else if(k.constructor==String){
        let kk=_Util._toRegExp(k)
        if(kk){
          return kk
        }
        return k.match(/[,.]/)?_handleStringKey(k,{}):k;
      }
    }
  
  },
  _checkData:function(v,d,r){
    v=v||""
    d=d||""
    if(d.constructor==String&&(_Util._isJsonValueString(d)||_Util._hasCode(d))){
      d=eval(d)
    }
    if(v.constructor==String&&_Util._isJsonValueString(v)||_Util._hasCode(v)){
      v=eval(v)
    }

    if(!d||d.constructor!=Object){
      return _extractData._chkValue(v,d)
    }
    d=_Util._toOneLevelJson(d)
    let _failed
    d.find(x=>{
      for(let k in x){
        let f=x[k]
        let vv=_extractData._extract(v,k)
        if(!_extractData._chkValue(vv,f,[])){
          _failed=1
          if(!r){
            return _failed
          }
          r.push({
            key:k,
            expect:f,
            value:vv
          })
        }
      }
    })
    return !_failed
  },
  _chkValue:function(v,d,fs){
    let r;
    if(!d){
    }else if(v&&v.constructor==Array){
      if(fs){
        v.forEach((x,i)=>{
          if(!_extractData._chkValue(x,d,fs)&&!_Util._isObjOrArray(x)){
            v[i]="❌"+x
          }
        })
        return fs.length==0
      }else{
        r= !v.find(x=>!_extractData._chkValue(x,d))
      }
    }else if(v&&v.constructor==Object){
      for(let k in v){
        if(!_extractData._chkValue(v[k],d,fs)){
          if(!fs){
            return 
          }else if(!_Util._isObjOrArray(v[k])){
            v[k]="❌"+v[k]
          }
        }
      }
      return !fs||fs.length==0
    }else if(d.constructor==RegExp||_Util._isRegexData(d)){
      v+=""
      r= _Util._toRegExp(d).test(v)
    }else if(d.constructor==Function){
      r= d(v)
    }
    if(r===undefined){
      r= v==d
    }
    if(!r){
      if(fs){
        fs.push(1)
      }else{
        console.log("BZ-LOG: Check data fail: "+v+", "+d)
      }
    }
    return r
  },
  _saveData:function(v,d){
    _DataBuilder._saveData(v,d)
  },
  _stringToData:function(v){
    if(v.constructor==String){
      if(_Util._isJsonValueString(v)||_Util._hasCode(v)||_Util._isFunction(v)){
        v=eval(v)
      }else if(_Util._isXMLData(v)){
        v=$util.xmlToJson(v)
      }
    }
    return v
  },
  _getChkData:function(v,d){
    if(!d||!v){
      return ""
    }
    let r={}
    if(d.constructor==String&&(_Util._isJsonValueString(d)||_Util._hasCode(d)||_Util._isFunction(d))){
      d=eval(d)
    }
    v=_extractData._stringToData(v)
    if(!_Util._isObjOrArray(d)){
      let fs=[]
      _chkObj(v,d,"",fs)
    }else{
      d=_Util._toOneLevelJson(d)
      d.forEach(x=>{
        for(let k in x){
          let f=x[k],fs=[]
          let vv=_extractData._extract(v,k)
          _chkObj(vv,f,k,fs)
        }
      })
    }
    return r

    function _chkObj(vv,dv,p,fs){
      let rr;
      if(!vv){
        rr=vv==dv?"✔️":"❌"
      }else if(_Util._isEmpty(vv)&&!dv){
        rr="❌"
      }else{
        _extractData._chkValue(vv,dv,fs)
        rr=fs.length?"❌":"✔️";
      }
      r[rr+p+":"+dv]=vv
    }
  },
  _findDataInScript:function(){
    let a=_IDE._data._curAction,ds

    if(a){
      ds=_findTagCode(a)
    }
    if(!ds){
      _ideActionManagement._findAction(_IDE._data._curTest,a=>{
        ds=_findTagCode(a)
        return ds
      })
    }
    return ds


    function _findTagCode(aa){
      let a=[aa.script,...(aa.requests||[]).map(x=>x.responseScript)]
      let r;
      a.find(x=>{
        if(x){
          if(x&&x.includes("$util.validateData")){
            x=x.split("$util.validateData")[1].trim()
            if(x[0]=="("){
              x=_CtrlDriver._findKeyOuterBlock(x.substring(1),")")
              let a=_CtrlDriver._findKeyOuterBlock(x.p,",")
              if(a.p){
                a.p=a.p.trim()
                if(a.p.match(/\$(test|module|project|parameter|loop|result)/)){
                  r={}
                  r.v=a.p
                }
                a.e=(a.e||"").trim()
                if(a.e.match(/\$(test|module|project|parameter|loop|result)/)){
                  r=r||{}
                  r.d=a.e
                }
                if(!r||!r.v||!r.d){
                  aa=_debugDataHandler._retrieveBindDataFromAction(aa)
                  aa=aa.filter(x=>!r||(x!=r.v&&x!=r.d))
                  if(aa.length){
                    try{
                      aa.sort((a,b)=>JSON.stringify(_Util._getSysObj(b)).length-JSON.stringify(_Util._getSysObj(a)).length)
                    }catch(ex){}
                    r=r||{}
                    r.v=r.v||aa.shift()
                    r.d=r.d||aa[0]
                  }
                }
                return r
              }
            }
          }
        }
      })
      return r
    }

    function _findInScript(s){
      return 
    }
  },
  _showResult:function(){
    _CtrlDriver._refreshData(_extractData._data,"_showResult")
  },
  _showTools:function(v,d){

    let ds=_extractData._findDataInScript()||[];

    if(!v){
      if(ds.v){
        _extractData._data._orgData._key=ds.v
        v=_Util._getSysObj(ds.v)
      }
    }
    if(v&&v.constructor==String&&(_Util._isJsonValueString(v)||_Util._hasCode(v))){
      try{
        v=eval(v)
        if(v.constructor!=String){
          v=__(v)
        }
      }catch(ex){}
    }

    if(!d){
      if(ds.d){
        _extractData._data._definition._key=ds.d
        d=_Util._getSysObj(ds.d)
      }
    }
    if(d && d.constructor==String&&(_Util._isJsonValueString(d)||_Util._hasCode(d))){
      try{
        d=eval(d)
        if(d.constructor!=String){
          d=__(d)
        }
      }catch(ex){}
    }
    _extractData._data._definition._value=d
    _extractData._data._orgData._value=v
    let _viewDev={
      _tag:"div",
      _attr:{
        class:"bz-extract-box"
      },
      _items:[
        //body
        {
          _tag:"div",
          _attr:{
            class:"bz-extract-body"
          },
          _items:[
            //definition
            {
              _tag:"div",
              _attr:{
                class:"bz-extract-column"
              },
              _after:function(o){
                setTimeout(()=>{
                  $(o).find("pre").focus();
                })
              },
              _items:[
                {
                  _tag:"div",
                  _attr:{
                    class:"bz-extract-column-title"
                  },
                  _items:[
                    _getDataList("_definition")
                  ]
                },
                {
                  _tag:"div",
                  _attr:{
                    class:"bz-extract-column-content"
                  },
                  _items:[
                    _bzJSEditor._buildJSEditor({
                      _model:"_extractData._data._definition._value",
                      _noBtn:1,
                      _label:"",
                      _noUpdate:1,
                      _disabled:0
                    })
                  ]
                }
              ]
            },
            //org-data
            {
              _tag:"div",
              _attr:{
                class:"bz-extract-column",
                style:"border-left:var(--bz-border);border-right:var(--bz-border);"
              },
              _items:[
                {
                  _tag:"div",
                  _attr:{
                    class:"bz-extract-column-title"
                  },
                  _items:[
                    _getDataList("_orgData")
                  ]
                },
                {
                  _tag:"div",
                  _attr:{
                    class:"bz-extract-column-content"
                  },
                  _items:[
                    _bzJSEditor._buildJSEditor({
                      _model:"_extractData._data._orgData._value",
                      _noBtn:1,
                      _label:"",
                      _noUpdate:1,
                      _disabled:0
                    })
                  ]
                }
              ]
            },
            //result-data
            {
              _tag:"div",
              _attr:{
                class:"bz-extract-column"
              },
              _items:[
                {
                  _tag:"div",
                  _attr:{
                    class:"bz-extract-column-title"
                  },
                  _items:[
                    {
                      _tag:"div",
                      _attr:{
                        class:"input-group"
                      },
                      _items:[
                        {
                          _tag:"select",
                          _attr:{
                            class:"form-control"
                          },
                          _items:[
                            {
                              _tag:"option",
                              _text:"_bzMessage._common._select"
                            },
                            {
                              _tag:"option",
                              _attr:{
                                value:"_data._key"
                              },
                              _text:"_data._item",
                              _dataRepeat:"_bzMessage._extractData._result"
                            }
                          ],
                          _dataModel:"_extractData._data._type",
                          _jqext:{
                            change:function(){
                              setTimeout(()=>{
                                _extractData._showResult()
                              },10)
                            }
                          }
                        },
                        {
                          _tag:"div",
                          _attr:{
                            class:"input-group-btn"
                          },
                          _items:[
                            {
                              _tag:"button",
                              _attr:{
                                class:"btn btn-icon bz-refresh bz-left-space-5"
                              },
                              _jqext:{
                                click:function(){
                                  _extractData._showResult()
                                }
                              }
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  _if:"_extractData._data._showResult",
                  _tag:"div",
                  _attr:{
                    class:"bz-extract-column-content"
                  },
                  _items:function(){
                    let d=_extractData._data._definition._value,
                        v=_extractData._data._orgData._value;
                    if(!d){
                      d=_extractData._data._definition._key
                      if(!d){
                        return
                      }
                      d=_DataBuilder._getOrgDataByPath(d)
                      _extractData._data._definition._value=d
                    }

                    if(!v){
                      v=_extractData._data._orgData._key
                      if(!v){
                        return
                      }
                      v=_DataBuilder._getOrgDataByPath(v)
                      _extractData._data._orgData._value=v
                    }

                    d=_Util._clone(_extractData._stringToData(d))
                    v=_Util._clone(_extractData._stringToData(v))

                    if(_extractData._data._type=="v"){
                      d=_extractData._getChkData(v,d)
                    }else{
                      d=_extractData._extract(v,d)
                      v={}
                      v[_bzMessage._extractData._extractData]=d
                      d=v
                    }
                    d=_CtrlDriver._buildProxy(d)
                    return [_jsonViewor._viewDev(d,[d[_bzMessage._extractData._extractData]])]
                  }
                }
              ]
            }
          ]
        }
      ]
    }
    if(!_extractData._popWin||_extractData._popWin.closed){
      _extractData._popWin=_Util._popWin("","_bzExtractData",0,Math.max(screen.availWidth*0.8,800),Math.max(screen.availHeight*0.8,800),_viewDev,_bzMessage._extractData._title)
    }else{
      _extractData._popWin.focus()
    }

    function _getDataList(k){
      return {
        _tag:"div",
        _attr:{
          class:"input-group"
        },
        _items:[
          {
            _tag:"label",
            _attr:{
              class:"input-group-addon"
            },
            _text:"_bzMessage._extractData."+k
          },
          {
            _tag:"select",
            _attr:{
              class:"form-control"
            },
            _items:[
              {
                _tag:"option",
                _text:"_bzMessage._common._select"
              },
              {
                _tag:"option",
                _attr:{
                  value:"_data._item"
                },
                _text:"_data._item",
                _dataRepeat:function(){
                  let vs=[];
                  (["$loop","$result","$parameter","$test","$module","$project"]).forEach(x=>{
                    try{
                      let v=eval(x)
                      for(let k in v){
                        if(k=="_tmpIdx"){
                          continue;
                        }
                        if(!_Util._isEmpty(v[k])&&v[k].constructor!=Function){
                          vs.push(x+"."+k)
                        }
                      }
                    }catch(ex){}
                  })
                  return vs
                }
              }
            ],
            _jqext:{
              change:function(){
                let v=_extractData._stringToData(_DataBuilder._getOrgDataByPath(this.value))
                _extractData._data[k]._value=v
                _extractData._showResult()
              }
            },
            _dataModel:"_extractData._data."+k+"._key"
          },
          {
            _tag:"div",
            _attr:{
              class:"input-group-btn"
            },
            _items:[
              {
                _tag:"button",
                _attr:{
                  class:"btn btn-icon bz-save bz-left-space-5",
                  disabled:function(){
                    let d=_extractData._data[k]._key
                    return !d||!d.match(/\$(test|module|project)/)
                  }
                },
                _jqext:{
                  click:function(){
                    let d=_extractData._data[k]
                    if(d._key.match(/^\$(test|module|project)/)){
                      _extractData._saveData(d._value,d._key)
                    }
                  }
                }
              }
            ]
          }
        ]
      }
    }
  }
}
/** */;
var _infoManagement={
  _data:_CtrlDriver._buildProxy({
    _map:{},
    _read:{},
    _curData:{},
    _popData:[],
    _showPop:true,
    _lastMsgTime:0,
    _sentMsg:[],
    _sentIdx:0
  }),
  _hidePop:function(item){
    $(item).fadeOut();
  },
  _new:function(_user,_timeStamp,_msg,_timer){
    return {
      user:_user,
      timeStamp:_timeStamp,
      msg:_msg,
      _timer
    };
  },
  _getUnRead:function(t){
    var s=r=0;
    for(var k in this._data._map){
      if(k==t || !t){
        s+=this._data._map[k].length;
        r+=this._data._read[k];
      }
    }
    return s-r;
  },
  _add:function(_info){
    if(_info.body){
      _info=_info.body;
      _userManagement._findItem(_info.user,function(data){
        if(_info.msg.startsWith("*|")){
          var _msg=_info.msg.split("|");
          return alert(_msg[1].replace(/\\n/g,"\n"));
        }
        
        var m=_infoManagement._new({displayName:data.displayName,_id:_info.user},_info.timeStamp,_info.msg);
        m.to=_info.to;
        _infoManagement._add(m);
      });
      return;
    }
    var t=_info.to||curProjectData._id;
    if(t==curUser._id){
      t=_info.user._id;
    }
    var m=this._data._map[t]=this._data._map[t]||[];
    this._data._read[t]=this._data._read[t]||0;
    m.push(_info);
    if(_info.user.sys){
      this._data._read[t]++;
    }
    if(m.length>500){//TODO: buffer
      m.pop();
    }
    if(_info.user._id!=curUser._id){
      this._data._popData.push(_info);
    }
    _infoManagement._clear()
  },
  _clear:function(){
    setTimeout(function(){
      var os=_infoManagement._data._popData
      for(var i=0;i<os.length;i++){
        var o=os[i]
        var t=o._timer||2000;
        if(Date.now()-o.timeStamp>=t){
          _infoManagement._data._popData.splice(i--,1)
        }
      }
      if(os.length){
        _infoManagement._clear()
      }
    },2000);
  },
  _addBZInfo:function(msg, _userId, o,_alert,_timer){
    _userManagement._findItem(_userId,function(data){
      var _infoMsg=_Util._formatMessage(msg,[data.displayName,o]);
      var _info=_infoManagement._new({sys:1,displayName:"Boozang"},Date.now(),_infoMsg,_timer);
      if(_alert){
        alert(_infoMsg)
      }else{
        _infoManagement._add(_info);
      }
    });
  },
  _post:function(_tab){
    var d=this._data;
    if(!d._curData.msg){
      return;
    }
    d._curData.timeStamp=Date.now();
    d._curData.user=curUser._id;
    d._curData.to=_tab==curProjectData._id?'':_tab;
    _requestHandler._callService({
      _data:{
        method:"POST",
        url:"/api/info/",
        data:d._curData,
        callback:"_infoManagement._add"
      }
    });
    $(".postMsg").focus();
    var _msg=d._curData.msg;
    var _idx=d._sentMsg.indexOf(_msg);
    if(_idx>=0){
      d._sentMsg.splice(_idx,1);
    }
    d._sentMsg.unshift(_msg);
    if(d._sentMsg.length>100){
      d._sentMsg.pop()
    }
    d._sentIdx=0;
    d._curData.msg="";
    setTimeout(function(){
      $(".info-input").focus();
    },100);
  },
  _login:function(d){
    _userManagement._findItem(d.user,function(data){
      var _infoMsg=_Util._formatMessage(_bzMessage._log._info._login,[data.displayName]);
      var _info=_infoManagement._new({sys:1,displayName:"Boozang"},Date.now(),_infoMsg);
      _infoManagement._add(_info);
      if(_userManagement._data._onlineUsers && data._id!=curUser._id){
        _userManagement._data._onlineUsers.push(data);
      }
    });
  },
  _logout:function(d){
    _userManagement._findItem(d.user,function(data){
      var _infoMsg=_Util._formatMessage(_bzMessage._log._info._logout,[data.displayName]);
      var _info=_infoManagement._new({sys:1,displayName:"Boozang"},Date.now(),_infoMsg);
      _infoManagement._add(_info);
      for(var i =0;i<_userManagement._data._onlineUsers.length;i++){
        var u=_userManagement._data._onlineUsers[i];
        if(u._id==data._id){
          _userManagement._data._onlineUsers.splice(i,1)
        }
      }
    });
  },
  _showImportantInfo:function(_text,_type,_extra,_main,_timer){
    if(!window.extensionContent){
      bzComm.postToAppExtension({scope:"_infoManagement",fun:"_showImportantInfo",ps:[_text,_type,_extra]})

      if(!_main){
        return;
      }
    }else{
      if(window.bzIframeId){
        return
      }
      if(BZ._data._dock&&parent.parent!=parent){
        return
      }else if(!BZ._data._dock&&parent!=window){
        return;
      }
    }
    var w=_main?window:this._getMainWin();
    if(w){
      if(!w.document.body){
        return setTimeout(function(){
          _infoManagement._showImportantInfo(_text,_type,_extra,_main)
        },500);
      }
      $(w.document.body.parentNode).find(".bz-importantInfo-bk").remove();
    }
//    _infoManagement._removeImportantInfo(_main)
    //For remove only
    if(!_text){
      return;
    }
    _type=_type||"";
    _text=_bzMessage._importantInfo[_text]||_text;
    var wl=_text.length;

    if(_extra){
      wl="width:550px !important;"
    }else if(wl<20){
      wl="width:300px !important;"
    }else{
      wl="width:650px !important;"
    }
    _extra=_extra?"<div class='extra'>"+_extra+"</div>":"";
    var _html ="<div class='bz-importantInfo-bk' onmouseover='this.remove()'>"
              +"<pre class='bz-importantInfo "+_type+"' style='"+wl+"'>"
              +"<a class='bz-close-white bz-small-icon bz-small-btn' style='border:0;float:right;margin:-15px -15px;'></a>"
              +"<div style='font-size:16px' class='bz-main-info'>"+_text+"</div>"
              +_extra
              +"</pre>"
              +"</div>"
    
    var o=document.createElement("div");
    o.innerHTML=_html;
    o=o.children[0];
    try{
      var w=_main?window:this._getMainWin();
      if(w){
        w.document.body.parentNode.append(o);
      }
    }catch(e){}
    setTimeout(function(){
      o.remove()
    },_timer||5000)
  },
  _getMainWin:function(){
    if(_Util._isBZTWOpened() && !window.inPlugIn){
      return BZ.TW
    }
  },
  _removeImportantInfo:function(_main){
    this._showImportantInfo()
  }
};
var _JSHandler={
  _parseCode:function(c,_type,_alert,_trimCode,_returnSynErr){
    if(!c || c.constructor!==String){
      return c;
    }
    let _exRight,_chker=/^([\/]\{.+)\}[\/]$/;
    if(c.match(_chker)){
      _exRight="}/"
      c=c.replace(_chker,"$1")
    }
    var _list=[];
    //has insert JS
    if(!_type){
      var _idx1=c.indexOf("{{");
      var _idx2=c.lastIndexOf("}}");
      if(_idx1>=0 && _idx1<_idx2){
        _list.push({txt:c.substring(0,_idx1)});
        var _code=c.substring(_idx1+2,_idx2);
        var _tmpList=_JSHandler._parseCode(_code,1);
        if(_tmpList && _tmpList.constructor==Array){
          _list=_list.concat(_tmpList)
        }else{
          _list.push({code:_tmpList});
        }
        _list.push({txt:c.substring(_idx2+2)});
      }else{
        if(_exRight){
          c+=_exRight
        }
        return c;
      }
    }else{
      var _idx1=c.lastIndexOf("{{");
      var _idx2=c.indexOf("}}");
      if(_idx1<0 && _idx2<0){
        return [{code:c}]
      }else if(_idx1>0 && _idx1>_idx2){
        _list.push({code:c.substring(0,_idx2)});
        var _code=c.substring(_idx2+2,_idx1);
        var _tmpList=_JSHandler._parseCode(_code);
        if(_tmpList && _tmpList.constructor==Array){
          _list=_list.concat(_tmpList)
        }else{
          _list.push({txt:_tmpList});
        }
        _list.push({code:c.substring(_idx1+2)});
      }
    }
    for(var i=0;i<_list.length;i++){
      var v=_list[i];
      var _errMsg="";
      if(!v.txt && !v.code){
        _list.splice(i,1);
        i--;
      }else if(v.code){
        if(_trimCode){
          v.code=v.code.trim()
        }
        if(_returnSynErr || _alert){
          _list._hasErr=_list._hasErr||!this._chkSyntaxError(v.code,_alert)
        }
        if(!_returnSynErr){
          delete _list._hasErr
        }
      }
    }
    if(_exRight){
      let o=_list[_list.length-1]
      if(o.txt){
        o.txt+=_exRight
      }else{
        _list.push({txt:_exRight})
      }
    }
    return _list;
  },
  _chkSyntaxError:function(c,_alert){
    try{
      eval(c);
    }catch(e){
      if(e.message && (e.message.includes("SyntaxError") || e.stack.startsWith("SyntaxError"))){
        if(_alert){
          e.message+=" \ncode: "+c;
          _Util._alertMessage(e);
        }
        return 0;
      }
    }
    return true;
  },
  //_noSkip: 1, use undefined, 2: use empty space
  _exeCodeList:function(_list,_parseOnly,_noSkip,_parameter){
    let $parameter=_parameter===undefined?window.$parameter:_parameter;
    if(!_list || _list.constructor==String || _list.constructor==Number){
      return _list;
    }
    var s="";
    for(var i=0;i<_list.length;i++){
      var c=_list[i];
      if(c.txt){
        if(_list[i-1] && _list[i-1].code && _parseOnly){
          s+="}}";
        }
        c.txt=c.txt.replace(/\\{/g,"{").replace(/\\}/g,"}");
        s+=c.txt;
      }else if(c.code){
        var v=_ideDataHandler._parseToExeCode(c.code);
        var w=v;
        if(!_parseOnly){
          let vv=v;
          try{
            eval("v="+v);
          }catch(ex){
            v=undefined
            console.log("BZ-LOG:"+ex.message+"\n"+vv)
          }
          if(v===undefined){
            if(!_noSkip){
              v="bz-skip"
            }else if(_noSkip==2){
              v=""
            }
          }
        }else if(!_list[i-1] || _list[i-1].txt){
          s+="{{";
        }
        if(v && (v.constructor==Object || v.constructor==Array)){
          if(_parseOnly){
            s+=JSON.stringify(v);
          }else{
            s=v
          }
        }else if(!s && v && v.constructor==Function){
          if(v==_ideDataHandler._loadingFlag){
            s=_ideDataHandler._getOrgDataSettingFromNamePath(w)
            if(s){
              s=s.url
            }
          }else{
            s=v
          }
        }else if(s){
          s+=v;
        }else{
          s=v
        }
      }
    }
    if(_parseOnly && _list[i-1] && _list[i-1].code){
      s+="}}"
    }
    return s;
  },
  //_noSkip: 1, use undefined, 2: use empty space
  _prepareData:function(_code,_parseOnly,_noSkip,_parameter){    
    try{
      if(window.$parameter&&$parameter.constructor==String&&$parameter.match(/\$test|\$module|\$project|\$loop/)){
        try{
          eval("$parameter="+$parameter)
        }catch(e){
          
        }
      }
      if(_code && _code.constructor==Array){
        return _code.map(c=>{
          return _JSHandler._prepareData(c,_parseOnly,_noSkip)
        })
      }else{
        _code=_JSHandler._parseCode(_code,0)
      }
      if(_code && _code.constructor==Array && _code[0] && _code[0].constructor!=Object){
        var vs=[];
        for(var i=1;i<_code.length;i++){
          vs.push(_JSHandler._exeCodeList(_code[i],_parseOnly,_noSkip,_parameter));
        }
        vs.unshift(_code[0])
        return vs;
      }else if(_code&&[String,Object,Array].includes(_code.constructor)){
        var v= _JSHandler._exeCodeList(_code,_parseOnly,_noSkip,_parameter);
        return v
      }
    }catch(e){
    }
    return _code
  },
  //_start: only for beginning of //
  _cleanCode:function(v,_start){
    var t1=Date.now();
    
    var i1=v.indexOf("/"+"*"),i2=v.includes("*"+"/"),i3=v.includes("/"+"/");
    var p,w=v,c1,b,cs,cm,l;
    if((i1>=0 && i1<i2 ) || i3>=0){
      
      w=l="";
      for(var i=0;i<v.length;i++){
        var c=v[i];

        if(cs){//single line comment
          if(c=="\n"){
            cs=0;
          }
          continue;
        }else if(cm){ //mutiple line comment
          if(c=="/" && v[i-1]=="*"){
            cm=0;
          }
          continue;
        }else if(c=="\n"){
          _addResult(l);
          continue;
        }else if("\"'".includes(c) && !b){
          if(!p){
            p=c
          }else if(p==c){
            p=0
          }
        }else if(c=="\\"){
          b=!b
        }else if(!p && c=="/" && !b){
          if(c1){
            _addResult(l=l.substring(0,l.length-1));
            cs=1; //start single line comment
            continue;
          }else if(!_start || l.trim()=="/"){
            c1=c;
          }
        }else if(c=="*" && c1){
          cm=1;
          cs=0;
          _addResult(l=l.substring(0,l.length-1));
          continue;
        }else if(c1){
          c1="";
        }
        l+=c;
        if(c!="\\"){
          b=0;
        }
        if(c!="/"){
          c1="";
        }
      }
      _addResult(l);
    }
    return w//.trim();
    function _addResult(){
      var ll=l.trim(),ww=w.trimRight();
      
      if(ll){
        if(ll[0]=="." || ww.endsWith(".")){
          w=ww+ll
        }else{
          w+="\n"+l;
        }
        l=""
      }
    }
  },
  _formatInsertCodeToDisplay:function(d){
    if(!d){
      return d||"";
    }
    d=this._parseCode(d);
    if(d.constructor!=Array){
      return d;
    }
    var w="",v;
    
    for(var i=0;i<d.length;i++){
      v=d[i]
      if(v.code){
        w+="{{"+_ideDataHandler._parseToExeCode(v.code)+"}}"
      }else{
        w+=v.txt
      }
    }
    return w;
  },
  _formatInsertCodeToData:function(d){
    d=this._parseCode(d);
    if(d.constructor==String){
      return d;
    }
    var w="",v
    for(var i=0;i<d.length;i++){
      v=d[i]
      if(v.code){
        w+="{{"+v.code+"}}"
      }else{
        w+=v.txt
      }
    }
    return w;
  }
};
var _localStorageManagement={
  _preKey:"bz-data3/",
  _getKey:function(v,m,t,k){
    if(t){
      t=_IDE._getShortcutTestCode(t==1?0:t)
      if(!t){
        return ""
      }
    }
    
    if(m){
      m=_IDE._getShortcutModuleCode(m==1?0:m)
      if(!m){
        return ""
      }
    }
    if(v==1){
      v=_IDE._data._curVersion.code
    }
    let kk=_localStorageManagement._preKey+pId+"/"
    if(v){
      kk+=v+"/"
    }
    if(m){
      kk+=m+"/"
    }
    if(t){
      kk+=t+"/"
    }
    if(k){
      kk+=k+"/"
    }
    return kk
  },
  _encrypt:function(a,bEncrypt){
    return a;
    /*
    if(!a||_Util._checkBrowserType().name.includes("Edge")){
      return a;
    }
    var b=md5Value;
    var c=""
    var ii=0;
    for(var i=0;i<a.length;i++){
      var v1=a[i].charCodeAt();
      var v2=0;
      if(!b[ii]){
        ii=0;
      }
      v2=b[ii].charCodeAt();
      if(bEncrypt){
        c+=String.fromCharCode((v1 ^ v2)+10);
      }else{
        v1-=10;
        c+=String.fromCharCode(v1 ^ v2);
      }
      ii++;
    }
    return c;
    */
  },
  _decrypt:function(a){
    return this._encrypt(a,false);
  },
  _parseData:function(_noClean){
    if(!this._storeData){
      let _data={},
          hk=/\/t[0-9]+\/(bz-history|bz-debug)[\/]/,
          pk=_localStorageManagement._getKey();
      try{
        for(var n=0;n<localStorage.length;n++){
          var k=localStorage.key(n);
          if(k.startsWith(pk)&&!k.match(hk)){
            var d=k.split("/");
            if(k.endsWith("/")){
              d.splice(d.length-1);
            }
            var _tmp=_data;
            for(var i=1;i<d.length-1;i++){
              if(i<=d.length-1 && !_tmp[d[i]]){
                _tmp[d[i]]={}
              }
              _tmp=_tmp[d[i]];
            }
            if(!_tmp[d[i]]){
              _tmp[d[i]]=JSON.parse(this._decrypt(_compressData._unCompress(localStorage.getItem(k))));
            }else{
              Object.assign(_tmp[d[i]],JSON.parse(this._decrypt(_compressData._unCompress(localStorage.getItem(k)))))
            }
          }
        }
      }catch(e){
        if(!_noClean){
          _localStorageManagement._cleanAll()
        }
      }
      this._storeData=_data;
    }
    return this._storeData;
  },
  _getCurProjectData:function(bCreate){
    if(!_IDE._data._curVersion){
      return;
    }
    var _data=this._parseData();
    if(!_data[BZ._data._curProject._id]){
      if(bCreate){
        _data[BZ._data._curProject._id]={};
      }else{
        return null;
      }
    }
    _data=_data[BZ._data._curProject._id];
    if(!_data[_IDE._data._curVersion.code]){
      if(bCreate){
        _data[_IDE._data._curVersion.code]={};
      }else{
        return null;
      }
    }
    _data=_data[_IDE._data._curVersion.code];
    return _data;
  },
  _remove:function(_path){
    var _data=this._getCurProjectData();
    var i=0,ps=_localStorageManagement._getKey(1);
    for(i=0;i<_path.length-1;i++){
      ps+=_path[i]+"/";
      _data=_data[_path[i]];
      if(!_data){
        return;
      }
    }
    delete _data[_path[i]];
    ps+=_path[i]+"/";
    _localStorageManagement._removeData(ps);
    _localStorageManagement._cleanTask(ps,[],0)
  },
  _update:function(_path,_value,_md5){
    if(_path=="bz-habit"){
      this._store(_path,_value);
      this._parseData(1)[_path]=_value;
    }else{
      let _test=_ideObjHandler._getDataByPath(_path[0],_path[1])
      if(_test&&_test._data.code[0]=="t"){
        if(_aiGeneratorDataHandler._isAIGenerateTest(_test)){
          return _md5
        }
      }
      var _data=this._getCurProjectData(true);
      var i=0,ps="";
      for(i=0;i<_path.length-1;i++){
        if(!_data[_path[i]]){
          _data[_path[i]]={};
        }
        ps+=_path[i]+"/";
        _data=_data[_path[i]];
      }
      ps+=_path[i]+"/";
      if(_value){
        if(_value.doc&&_value.doc.content&&_value.doc.content.constructor==String&&_value.doc.content.startsWith("BZ-")){
          _value.doc.content=JSON.stringify(_compressJSON._unCompress(_value.doc.content))
        }
        _value=_compressJSON._compress(_value);
        if(!_data[_path[i]]){
          _data[_path[i]]={};
        }else if(_path[i]=="tmp"){
          _md5=_md5||_data[_path[i]].md5
        }
        if(!_md5){
          _md5=_calcMD5(_value);
        }
        var d=_data[_path[i]]={md5:_md5,value:_value};
        this._store(ps,d);
      }else{
        delete _data[_path[i]];
        _localStorageManagement._removeData(_localStorageManagement._getKey(1)+ps);
      }
    }
    return _md5;
  },
  _removeData:function(p){
    localStorage.removeItem(p);
  },
  _retrieve:function(_path){
    let d;
    try{
      if(_path=="bz-habit"){
        d=JSON.parse(this._decrypt(_compressData._unCompress(localStorage.getItem("bz-habit"))))
      }else if(_path=="bz-auth"||_path=="bzTmpDB"){
        d=JSON.parse(this._decrypt(_compressData._unCompress(localStorage.getItem(pId+"/"+_path))))
      }else{
        d=this._getCurProjectData();
        if(d){
          for(var i=0;i<_path.length;i++){
            d=d[_path[i]];
            if(!d){
              return null;
            }
          }
        }
      }
    }catch(e){}
    return d||{};
  },
  _store:function(_path,_data,_reTry){
    try{
      _data = _compressData._compress(this._encrypt(JSON.stringify(_data),true));
    }catch(e){
      _data = JSON.stringify(_data);
    }
    try{
      var _prePath;
      if(_path=="bz-auth"||_path=="bzTmpDB"){
        _prePath=pId+"/"+_path
      }else if(_path!="bz-habit"){
        _prePath=_localStorageManagement._getKey(1)+_path
      }else{
        _prePath="bz-habit"
      }
      localStorage.setItem( _prePath, _data);
      _localStorageManagement._removeData(_prePath+"tmp/");
    }catch(e){
      if(_reTry){
        alert("Data is too large to store!")
      }else{
        _localStorageManagement._cleanAll();
        _localStorageManagement._store(_path,_data,1);
      }
    }
  },
  _cleanData:function(_path,gs){
    var _data=this._getCurProjectData();
    var ps=_localStorageManagement._getKey(1)
    for(var i=0;i<_path.length;i++){
      _data = _data[_path[i]];
      ps+=_path[i]+"/"
      if(!_data){
        return;
      }
    }
    _localStorageManagement._cleanTask(ps,gs,0)
  },
  _cleanTask:function(ps,gs,i){
    var k=localStorage.key(i),gs=gs||[];
    if(!k){
      return
    }else if(k.startsWith(ps)){
      var g=k.replace(ps,"").split("/");
      g=g.shift()||g.shift()
      if(!gs.includes(g) && g!="setting"&&g!="tmp"){
        _localStorageManagement._removeData(k);
        i--;
      }
    }
    setTimeout(()=>{
      _localStorageManagement._cleanTask(ps,gs,i+1)
    },1)
  },
  _cleanVersion:function(){
    var _data=this._parseData();
    _data=_data[BZ._data._curProject._id];
    if(!_data){
      return;
    }
    var vs=BZ._data._curProject.versions;
    for(var k in _data){
      var _found=false;
      for(var i=0;i<vs.length;i++){
        var v=vs[i];
        if(v.code==k){
          _found=true;
          break;
        }
      }
      if(!_found){
        delete _data[k];
        _localStorageManagement._cleanTask(_localStorageManagement._getKey(k),[],0)
      }
    }
  },
  _updateTmpData:function(oo,v,_md5){
    if(!oo){
      return
    }
    var _path=["tmp"],
        pd=_localStorageManagement._getCurProjectData(),
        o=oo._data;
        
    if(o.modules){
      _path.unshift("setting");
      _md5=_md5||pd.setting.md5;
    }else if(o.tests){
      _path.unshift(o.code);
      _md5=_md5||o.updateStamp.time;
    }else{
      _path.unshift(o.code);
      _path.unshift(oo._parent._data.code);
      _md5=_md5||pd[oo._parent._data.code][o.code].md5;
    }
    _localStorageManagement._update(_path,v,_md5);
  },
  _deleteTmpData:function(v){
    let kk=_localStorageManagement._getKey(1)
    for(var i=0;i<localStorage.length;i++){
      var k=localStorage.key(i);
      if(k.startsWith(kk) && k.endsWith("/tmp/")&&(!v||k.includes(v))){
        _localStorageManagement._removeData(k)
      }
    }
  },
  _cleanAll:function(){
    let _found=0,vs=[],ms=[],
        pk=_localStorageManagement._getKey(),
        vk=_localStorageManagement._getKey(1),
        mk=_IDE._getShortcutModuleCode(1,1);

    for(var n=0;n<localStorage.length;n++){
      var k=localStorage.key(n);
      if(["bz-habit","bz-ide","bz-init-resize"].includes(k)){
      }else if(!k.startsWith(pk)){
        localStorage.removeItem(k);
        _found=1
        n--
      }else if(!k.startsWith(vk)){
        vs.push(k)
      }else if(mk&&!k.startsWith(mk)){
        ms.push(k)
      }
    }
    !_found&&(vs||ms).forEach(v=>{
      localStorage.removeItem(v);
    })
  },
  //clean old version data
  _cleanOldBZVersion:function(){
    for(var n=0;n<localStorage.length;n++){
      if(localStorage.key(n).startsWith(_localStorageManagement._preKey)){
        return
      }
    }
    if(!localStorage.getItem("BZ-Reload")&&!localStorage.getItem("bz-init-resize")){
      localStorage.clear()
    }
  },
  _reloadData:function(){
    if(localStorage.getItem("BZ-Reload")){
      return alert("Data update error!")
    }else{
      localStorage.clear()
      localStorage.setItem("BZ-Reload","1")
      return setTimeout(()=>{
        location.reload()
      },BZ._isInDemo()?500:1)
    }
  },
};
if(!window.extensionContent){
  _localStorageManagement._cleanOldBZVersion();
};
var _optHistoryHandler={
  _testUpdateKeys:[
    "code",
    "initParameter",
    "subtype",
    "name",
    "tag",
    "loopData",
    "dataMap",
    "hostId",
    "actions",
    "note",
    "description",
    "defParameter"
  ],
  _moduleUpdateKeys:[
    "code",
    "dataMap",
    "definition",
    "alias",
    "comment",
    "defaultHostId",
    "keyField",
    "name",
    "rootUrl",
    "tag",
    "tmpDataSize"
  ],
  _data:_CtrlDriver._buildProxy({_undo:{},_redo:{}}),
  _init:function(_code){
    if(BZ._isAutoRunning()){
      return
    }
    let o=_ideObjHandler._getDataByPath(_code)
    if(!o){
      return
    }
    if(o._parent&&!o._parent._loaded){
      return setTimeout(()=>{_optHistoryHandler._init(_code)},100)
    }
    o=o._data

    let d=_optHistoryHandler._data,dd={},
        i=Date.now()

    d._undo._key=o.base
    d._undo._list=0
    d._undo._size=0

    d._redo._key=o.redo
    d._redo._list=0
    d._redo._size=0

    d._path=_code

    d._hoverIdx=-1;
    BZ._data._uiSwitch["_undo"+"_menu"]=BZ._data._uiSwitch["_redo"+"_menu"]=0;

    if(o.code[0]=="t"){
      _optHistoryHandler._updateKeys=_optHistoryHandler._testUpdateKeys
    }else{
      _optHistoryHandler._updateKeys=_optHistoryHandler._moduleUpdateKeys
    }
    _optHistoryHandler._data._hoverGroupIdx=0
    _optHistoryHandler._toBase=0

    _optHistoryHandler._updateKeys.forEach(x=>{
      if(x=="actions"){
        _ideActionManagement._findAction(o,y=>{
          y.key=y.key||i++
        })
      }
      dd[x]=_Util._clone(o[x])
    })

    _optHistoryHandler._curOldData=dd
  },
  _getUpdateContent:function(d,_code){
    if(_code&&_optHistoryHandler._data._path==_code){
      let dd;
      if(_optHistoryHandler._opt){
        dd=_optHistoryHandler._opt
        delete _optHistoryHandler._opt
      }else{
        let _diffs=[]
        
        _optHistoryHandler._updateKeys.forEach(k=>{
          let o=_optHistoryHandler._curOldData[k],
              n=d[k]
          // if(["dataMap","defParameter"].includes(k)){
          //   o=_Util._strToObj(o)
          //   n=_Util._strToObj(n)
          // }
          _Util._getSimpleDiffInJson(o,n,(kk,p,o,f)=>{
            return kk[0]=="_"||(kk=="inGroup"&&!o&&!f)
          },_diffs,k)
        })
        
        if(_diffs.length){
          dd={
            base:d.base,
            key:_IDE._data._curVersion.code+","+d.updateStamp.time,
            details:_diffs
          }
          d.base=dd.key
          d.redo=""
        }
      }

      return dd
    }else{
      return 1
    }
  },
  _getBtnView:function(_type){
    //undo
    let _icon=_type=="_undo"?"undo":"redo"

    return {
      _icon:`bz-${_icon}`,
      _disable: function(){
        return BZ._data._uiSwitch._undoing||!_optHistoryHandler._has(_type)
      },
      _fun:function(){
        _optHistoryHandler[_type]()
      },
      _title:"_bzMessage._method."+_type
    }
  },
  _getOptDesc:function(v){
    let ks=Object.keys(v)
    if(!ks.includes("from")){
      return _bzMessage._method._add+": "+v.key
    }else if(!ks.includes("to")){
      return _bzMessage._method._remove+": "+v.key
    }else{
      return _bzMessage._method._update+": "+v.key
    }
  },
  _redo:function(_idx,_group){
    console.log("Redo:")
    let _curData=BZ._data._curPage._obj._data
    if(_idx===undefined){
      BZ._data._uiSwitch._undoing=1
      _optHistoryHandler._getItemByBase("_redo",function(d){
        _curData.redo=""
        if(!d.find(x=>{
          if(x.key==_optHistoryHandler._data._redo._key){
            let dd;
            if(d.length>1){
              dd=d.pop()
            }
            
            _doIt([x],dd)

            return 1
          }
        })){
          _optHistoryHandler._store()
        }
        if(_IDE._data._curAction){
          BZ._setHash(location.hash)
        }
        BZ._data._uiSwitch._undoing=0
      })
    }else{
      let _list=_optHistoryHandler._data._redo._list[_group]
      _doIt(_list.slice(0,_idx+1),_list[_idx+1])
    }
    
    function _doIt(ds,dd){
      let rd=_optHistoryHandler._buildData(ds,"from","to","redo",dd);

      rd.base=ds.pop().key
      rd.redo=dd?dd.key:""

      _Util._assign(rd,_curData)
      _optHistoryHandler._store()
      _DataBuilder._refreshData(BZ._data._curPage._obj,ds)
      if(_aiGeneratorDataHandler._isAIModule(_IDE._data._curModule)){
        _aiFlowHandler._refreshPopWin()
        _aiPageHandler._refreshPopWin()
      }
    }
  },
  _undo:function(_idx,_group){
    console.log("Undo:")
    let _curData=BZ._data._curPage._obj._data
    if(_idx===undefined){
      BZ._data._uiSwitch._undoing=1
      _optHistoryHandler._getItemByBase("_undo",function(d){
        _curData.base=""
        if(d.length){
          d=d[0]
          _doIt([d],d)
        }else{
          _optHistoryHandler._store()
        }
        if(_IDE._data._curAction){
          BZ._setHash(location.hash)
        }
        BZ._data._uiSwitch._undoing=0
      })
    }else{
      let _list=_optHistoryHandler._data._undo._list[_group]
      _doIt(_list.slice(0,_idx+1),_list[_idx])
    }
    
    function _doIt(ds,d){
      let rd=_optHistoryHandler._buildData(ds,"to","from","undo",d);

      rd.redo=d.key
      rd.base=d.base

      _Util._assign(rd,_curData)

      _optHistoryHandler._store()
      _DataBuilder._refreshData(BZ._data._curPage._obj,ds)
      if(_aiGeneratorDataHandler._isAIModule(_IDE._data._curModule)){
        _aiFlowHandler._refreshPopWin()
        _aiPageHandler._refreshPopWin()
      }

    }
  },
  _store:function(){
    let o=BZ._data._curPage._obj._data
    if(o.code[0]=="t"){
      _ideTestManagement._save()
    }else{
      _ideModuleManagement._save(0,function(){
        _aiModelHandler._refreshGUI()
      })
    }
  },
  _buildData:function(_list,f,t,_type,dd){
    let d=_Util._clone(_optHistoryHandler._curOldData)
    
    _list.forEach(x=>{
      if(x.details.length){
        let os={},us=[]
        console.log(__(x.details))
        x.details.forEach(y=>{
          if(y.order){
            os[y.key]=os[y.key]||[]
            os[y.key].push(y)
          }else{
            us.push(y)
          }
        })
        _handleOrder(os)
        _handleUpdate(us)
        
      }        
    })
    
    _optHistoryHandler._opt={
      base:dd?dd.base:"",
      opt:_type,
      key:_IDE._data._curVersion.code+","+BZ._data._curPage._obj._data.updateStamp.time
    }

    return d
    
    function _handleOrder(os){
      if(!_Util._isEmpty(os)){
        for(let k in os){
          let x=os[k]
          let ks=k.split(".")
          let dd=_toData(d,ks)
          let _list=[].concat(dd)
          x.forEach(y=>{
            _list[y[t]]=dd[y[f]]
          })
          _setData(d,ks,_list)
        }
      }
    }
    
    function _handleUpdate(x,_reversed){
      //for remove
      while(x.length){
        let y=x.shift()
        let yks=Object.keys(y)

        let ks=y.key.split(".")
        let kk=ks.pop()
        dd=_toData(d,ks)
        if(dd===undefined||dd===null){
          x.unshift(y)
          if(!_reversed||x.length<_reversed){
            x.reverse()
            return _handleUpdate(x,x.length)
          }else{
            return
          }
        }

        if(yks.includes(f)&&!yks.includes(t)){
          if(dd.constructor==Array){
            dd.splice(kk,1)
          }else{
            delete dd[kk]
          }
        }else if(yks.includes(t)&&!yks.includes(f)){
          if(dd.constructor==Array){
            if(dd.length>kk){
              dd.splice(kk,0,y[t])
            }else{
              dd.push(y[t])
            }
          }else{
            dd[kk]=y[t]
          }
        }else{
          dd[kk]=y[t]
        }
      }
      /*
      //for add
      x.reverse()
      for(let i=0;i<x.length;i++){
        let y=x[i]
        let yks=Object.keys(y)
        if(yks.includes(t)&&!yks.includes(f)){
          let ks=y.key.split(".")
          let kk=ks.pop()
          dd=_toData(d,ks)
          if(dd.constructor==Array){
            if(dd.length>kk){
              dd.splice(kk,0,y[t])
            }else{
              dd.push(y[t])
            }
          }else{
            dd[kk]=y[t]
          }
          x.splice(i--,1)
        }
      }
      
      //for remove
      x.reverse()
      for(let i=0;i<x.length;i++){
        let y=x[i]
        let yks=Object.keys(y)
        if(yks.includes(f)&&!yks.includes(t)){
          let ks=y.key.split(".")
          let kk=ks.pop()
          if(!$.isNumeric(kk)){
            dd=_toData(d,ks)
            delete dd[kk]
            x.splice(i--,1)
          }
        }
      }

      //for add
      x.forEach(y=>{
        let yks=Object.keys(y)
        if(yks.includes(t)&&yks.includes(f)){
          let ks=y.key.split(".")
          let kk=ks.pop()
          dd=_toData(d,ks)
          dd[kk]=y[t]
        }
      })
      */
    }
    
    function _toData(d,ks){
      let dd=d
      ks.find(z=>{
        let dv=_strToData(z,dd[z])
        if(dv!==undefined&&dv!==null){
          dd[z]=dv
          dd=dv
        }else{
          dd=dv
          return 1
        }
      })
      return dd
    }
    
    function _setData(d,ks,v){
      let kk=ks.pop()
      ks.forEach(x=>{
        d=d[x]
      })
      d[kk]=v
    }
    function _strToData(k,d){
      if(["defParameter","dataMap"].includes(k)&&d&&d.constructor==String){
        d=_Util._strToObj(d)
      }
      return d
    }
  },
  _has:function(_type){
    let d=BZ._data._curPage._obj
    if(d){
      d=d._data||d
      if(!BZ._isPlaying()&&BZ._isCheckout()&&!_optHistoryHandler._data._retrieving){
        return _optHistoryHandler._data[_type]._key
      }
    }
  },
  _showList:function(_type,_size){
    let d=_optHistoryHandler._data[_type]
    if(d._list&&d._size>=_size){
      return d._list
    }
    if(_type=="_undo"){
      _retrieveList("undoes",function(_list){
        let vs=[],k=d._key;
        while(_list.find((x,i)=>{
          if(x.key==k){
            vs.push(x)
            k=x.base
            _list.splice(i,1)
            return 1
          }
        })){}
        
        _optHistoryHandler._data[_type]._list=[vs]
      })
    }else{
      _retrieveList("redoes",function(_list){
        _buildRedoTree(_list,_optHistoryHandler._data._undo._key)
      })
    }
    d._size=_size
    
    function _buildRedoTree(_list,_root){
      let _tree=[]
      for(let i=0;i<_list.length;i++){
        let d=_list[i]
        if(d.base==_root){
          _list.splice(i--,1)
          let vs=[d]
          _buildBranch(_list,d.key,vs)
          _tree.push(vs)
        }
      }
      _optHistoryHandler._data[_type]._list=_tree
    }
    
    function _buildBranch(_list,_key,_branch){
      let vs=[]
      for(let n=0;n<_list.length;n++){
        let d=_list[n]
        if(d.base==_key){
          vs.push(d)
          _list.splice(n--,1)
        }
      }
      if(vs.length==1){
        _branch.push(vs[0])
        
        _buildBranch(_list,vs[0].key,_branch)
      }
    }
    
    function _retrieveList(f,_fun){
      _optHistoryHandler._data._retrieving=1
      let p=_optHistoryHandler._getSearchFilter(_optHistoryHandler._data._undo._key,_size)

      _requestHandler._callService({
        _data:{
          method:"GET",
          url:`/api/projects/${BZ._data._curProject.code}/${f}/?${p}`
        },
        _success:function(d){
          _optHistoryHandler._data._retrieving=0
          
          _fun(d.result)
        },
        _failed:function(d){
          alert(d.message)
          _optHistoryHandler._data._retrieving=0
        }
      });
    }
  },
  _getItemByBase:function(_type,_fun){
    let d=_optHistoryHandler._data[_type]

    let p=_optHistoryHandler._getSearchFilter(d._key)
    _optHistoryHandler._data._retrieving=1
    _requestHandler._callService({
      _data:{
        method:"GET",
        url:`/api/projects/${BZ._data._curProject.code}/${_type=="_undo"?"undo":"redo"}/?${p}`
      },
      _success:function(d){
        _optHistoryHandler._data._retrieving=0
        _fun(d.result)
      }
    });
  },
  _getSearchFilter:function(k,_size){
    let d=_optHistoryHandler._data
    return `path=${d._path}&base=${k||""}&limit=${_size}`
  }
};
var _screenshotHandler={
  _elementImg:function(_element,cd,_fun){
    _screenshotHandler._getScreenshot(_element,0,function(c){
      _fun(c);
    })
  },
  //cd: coordinate deviation
  _elementImgMd5:function(_element,cd,_fun){
    this._elementImg(_element,cd,function(v){
      if(v.toDataURL){
        v=v.toDataURL();
      }
      _fun(v)
    })
  },
  _getMergeArea:function(_element,_mark){
    if(_element.tagName=="BODY"){
      return {
        _left:0,
        _top:0,
        _width:window.innerWidth,
        _height:window.innerHeight
      }
    }
    var xy=_Util._getDomXY(_element);
    var _rect=_element.getBoundingClientRect();
    var _rect1={
      left:xy.x,
      top:xy.y,
      width:_rect.width,
      height:_rect.height
    }
    
    var xy=_Util._getDomXY(_mark);
    _rect=_mark.getBoundingClientRect();
    var _rect2={
      left:xy.x,
      top:xy.y,
      width:_rect.width,
      height:_rect.height
    }
    
    var x1=_rect1.left<_rect2.left?_rect1.left:_rect2.left;
    var x2=(_rect1.left+_rect1.width)>(_rect2.left+_rect2.width)?(_rect1.left+_rect1.width):(_rect2.left+_rect2.width);
    var y1=_rect1.top<_rect2.top?_rect1.top:_rect2.top;
    var y2=(_rect1.top+_rect1.height)>(_rect2.top+_rect2.height)?(_rect1.top+_rect1.height):(_rect2.top+_rect2.height);
    
    if(x1>10){
      x1-=10;
    }
    if(y1>10){
      y1-=10;
    }
    
    if(x2-x1<500){
      x1-=(500-x2+x1)/2;
      x2+=(500-x2+x1)/2;
      if(x1<0){
        x2-=x1;
        x1=0;
      }
    }
    
    if(y2-y1<320){
      y1-=(320-y2+y1)/2;
      y2+=(320-y2+y1)/2;
      if(y1<0){
        y2-=y1;
        y1=0;
      }
    }
    return {_left:x1,_width:x2-x1,_top:y1,_height:y2-y1};
  },
  _canvasToImg:function(d){
    var o={base64Link:d.toDataURL?d.toDataURL():d, type:"image/png"};
    return _uploadHandler._base64ToBlob(o);
  },
/*Don't delete. It is for generate img 
  _postImg:function(_result){
    var _file=_screenshotHandler._canvasToImg(_result._canvas);
    var formData = new FormData();

    formData.append("uploads[]", _file, _result._data._path+".png");

    $.ajax({
      url: SERVER_HOST+"/api/projects/"+BZ._data._curProject.code+"/uploadScreenshot/",
      type: "POST",
      data: formData,
      processData: false,
      contentType: false,
      success: function(data){
//        console.log('upload successful!\n' + data);
      },
      error:function(data){
//        console.log("error: "+data);
      }
    });
  },
*/ 
  _postImgInString:function(_result,_triggerScreenshot){
    if(_result._type<3){
      console.log("BZ-LOG: postImgInString ...")
    }else{
      delete _result._canvas
    }
    if(_result._canvas||_result._imgData||_result._attachIdx!==undefined){
      console.log("BZ-LOG: postImgInString-1 ...")
      let _data=_result._imgData
      if(!_data||!_data.file){
        _data={
          file:_result._canvas||_getAttachImg(),
        }
        _result._imgData=_data;
      }
      if(_data.file){
        _data.name=_calcMD5(_data.file)
        console.log("BZ-LOG: Screenshot:"+_data.name)

        _requestHandler._callService({
          _data:{
            method:"POST",
            url:"/api/projects/"+BZ._data._curProject.code+"/uploadScreenshotInString/",
            data:_data,
            noresponse:1
          }
        });
      }else{
        console.log("BZ-LOG: postImgInString-2 ...")
        console.log("BZ-LOG: "+Object.keys(_result).join(", "))
      }
    }else if(_result._type<3&&_result._url&&_result._data.element){
      if(!_triggerScreenshot){
        $util.takeScreenshot(0,function (a) {
          _result._imgData={
            file:a,
            name:_result._data._path.replace(/[\/]/g,".").replace(/[\.]$/,"")
          }
        })
      }
      setTimeout(function(){
        _screenshotHandler._postImgInString(_result,1);
      },10);
    }

    function _getAttachImg(){
      return (_ideReport._attachedInfo[_result._attachIdx]||{})._info
    }
  },
  //e: element, p: position
  _getScreenshot:function(e,p,_bkFun){
    if(e){
      _Util._focusElement(e)
      if(e!=document.body){
        _bzDomPicker._showTmpCover([e])
        e=_Util._findTextElement(e)
        if(!p){
          p=e.getBoundingClientRect().toJSON()
        }
      }
    }
    $("#BZ_Win").hide();
    setTimeout(function(){
      bzComm.postToBackground({
        fun:"getScreenshot",
        scope:"bgUtil",
        insertCallFun:1,
        return:function(c){
          $("#BZ_Win").show();
          if(p){
            p.minHeight=300;
            p.minWidth=400;
  
            _bzDomPicker._removeTmpCover();
            _screenshotHandler._cropImage(c,p,_bkFun)
          }else{
            _bkFun&&_bkFun(c)
          }
        },
      })
    },10)
  },
  _cropImage:function(_dataURL, { x, y, width, height,minWidth,minHeight }, _bkFun) {
    let r=new Promise((_resolve, _reject) => {
      const _img = new Image();
      _img.src = _dataURL;

      _img.onload = function() {
        const _canvas = document.createElement('canvas');
        if(minWidth&&width<minWidth){
          x-=(minWidth-width)/2;
          width=minWidth;
          if(x<0){
            x=0;
          }else if(x+width>_img.width){
            x=_img.width-width;
          }
        }
        if(minHeight&&height<minHeight){
          y-=(minHeight-height)/2;
          height=minHeight;
          if(y<0){
            y=0;
          }else if(y+height>_img.height){
            y=_img.height-height;
          }
        }
        _canvas.width = width;
        _canvas.height = height;
        const _ctx = _canvas.getContext('2d');

        _ctx.drawImage(_img, x, y, width, height, 0, 0, width, height);

        const croppedDataURL = _canvas.toDataURL('image/png');
        _resolve(croppedDataURL);
      };

      _img.onerror = function(err) {
        _reject(err);
      };
    });
    r.then(x=>{
      _bkFun&&_bkFun(x)
    })
  }
};
var _stdComponent={
  _getCheckboxRadioViewDef:function(d){
    let _chk={
      _tag:"input",
      _attr:d._attr||{
        id:d.id,
        checked:d._checked,
        type:d._type||"checkbox",
        style:d._style,
        disabled:d._disabled||d._exDisabled
      },
      _dataModel:d._dataModel,
      _jqext:d._jqext
    }
    if(!d._label){
      return _chk
    }
    let v={
      _if:d._if,
      _data:d._data,
      _after:d._after,
      _update:d._update,
      _tag:"div",
      _attr:{
        class:(d._boxClass||"")+" bz-help-bar",
        style:d._boxStyle||"line-height:30px;"
      },
      _items:[
        {
          _tag:"label",
          _attr:{
            title:d._ariaLabel,
            style:d._labelBoxStyle,
            disabled:d._disabled
          },
          _items:[
            _chk,
            {
              _tag:"span",
              _attr:{
                style:d._labelStyle||(curUser.language=='cn'?'position:relative;top:-1px;':"position:relative;top:0px;"),
                class:d._labelClass
              },
              _text:d._label
            },
            _uiHandler._getHelperIcon({
              _msg:d._help
            })
          ]
        }
      ],
      _dataRepeat:d._dataRepeat
    }
    if(d._exContent){
      v._items.push(d._exContent)
    }
    if(d._link){
      v._items.push({
        _if:d._link._if,
        _tag:"a",
        _attr:{
          class:d._link._class,
          style:d._link._style
        },
        _items:[
          {
            _text:d._link._label,
          },
          _uiHandler._getHelperIcon({
            _msg:d._link._help||d._link._ariaLabel
          })
        ],
        _jqext:d._link._jqext
      })
    }else if(d._btn){
      v._items.push(_stdComponent._getButtonViewDef(d._btn))
    }
    return v
  },
  _getSelectViewDef:function(d){
    let vv={
      _tag:"select",
      _after:d._after,
      _update:d._update,
      _attr:d._attr||{
        class:d._class||"form-control"+(d._exClass||""),
        style:d._style,
        disabled:d._disabled||(d._chk&&"!"+d._chk)||d._exDisabled,
        enable:d._enable
      },
      _dataModel:d._dataModel,
      _items:[
        
      ],
      _focus:d._focus,
      _jqext:d._jqext||(d._resizeModelWindow&&{
        change:function(){
          _Util._resizeModelWindow()
        }
      })
    }
    if(d._groups){
      let gs=d._groups
      if(d._groups.constructor==Function){
        gs=d._groups()
      }
      gs.forEach(g=>{
        let vvv={
          _tag:"optgroup",
          _attr:{
            label:g._label
          },
          _items:[]
        }
        vv._items.push(vvv)
        _buildOptionGroup(g,vvv)
      })
    }else{
      _buildOptionGroup(d,vv)
    }
    if(!d._label&&!d._btn&&!d._btns){
      vv._if=d._if
      return vv
    }
    let v={
      _if:d._if,
      _tag:"div",
      _after:d._afterBox,
      _data:d._data,
      _attr:{
        class:(d._boxClass||"input-group"),
        style:d._boxStyle
      },
      _items:[
      ]
    }
    
    if(d._label){
      v._items.push(_stdComponent._getLabelViewDef(d))
    }else{
      vv._if=d._if
    }
    v._items.push(vv);
    _stdComponent._insertInputButtonViewDef(d,v)
    return v
    function _buildOptionGroup(d,vv){
      if(d._empty||d._emptyDesc){
        vv._items.push({
          _tag:"option",
          _attr:{
            value:"",
            enable:1
          },
          _text:d._emptyDesc||`_bzMessage._common["${d._empty}"]`
        })
      }
  
      if(d._preOptions){
        d._preOptions.forEach(x=>{
          vv._items.push(_buildOption(x))
        })
      }
      vv._items.push(_buildOption(d));  
    }
    function _buildOption(d){
      return {
        _tag:"option",
        _after:d._optionAfter,
        _attr:{
          value:d._value||"_data._item._value||_data._key",
          style:d._optionStyle,
          title:d._optionTitle,
          class:d._optionClass
        },
        _text:d._text||"_data._item._text||_data._item",
        _dataRepeat:d._dataRepeat
      }
    }
  },
  _getTextareaViewDef:function(d){
    return {
      _if:d._if,
      _tag:"div",
      _attr:{
        class:(d._boxClass||"col-xs-12")+" bz-help-bar",
        style:d._boxStyle
      },
      _items:[
        {
          _tag:"div",
          _attr:{
            class:d._labelClass||"bz-row"
          },
          _items:[
            {
              _text:d._label
            },
            _uiHandler._getHelperIcon({
              _msg:d._help
            })
          ]
        },
        {
          _tag:"textarea",
          _after:d._after,
          _attr:d._attr||{
            spellcheck:false,
            class:d._class||"bz-editor"+(d._exClass||""),
            readonly:d._readonly,
            disabled:d._disabled||d._exDisabled,
            placeholder:d._placeholder,
            required:d._required,
            style:d._style||("height:100px;padding:5px;"+(d._exStyle||""))
          },
          _text:d._value,
          _focus:d._focus,
          _dataModel:d._dataModel,
          _jqext:d._jqext
        }
      ]
    }
  },
  _getInputViewDef:function(ds){
    let _single
    if(ds.constructor!=Array){
      ds=[ds]
      _single=1
    }
    let vs=ds.map(d=>{
      if(d._type=="checkbox"||d._type=="radio"){
        return _stdComponent._getCheckboxRadioViewDef(d)
      }else if(d._type=="select"){
        return _stdComponent._getSelectViewDef(d)
      }else if(d._type=="textarea"){
        return _stdComponent._getTextareaViewDef(d)
      }else if(d._type=="test"){
        return _uiHandler._getTestList({
          _title:d._label,
          _dataModel:d._dataModel,
          _afterSetValue:d._afterSetValue
        })
      }else if(d._src){
        return d._src
      }
      let v={
        _if:d._if,
        _tag:"div",
        _endItem:d._endItem,
        _data:d._data,
        _attr:{
          class:(d._boxClass||"input-group"),
          style:d._boxStyle
        },
        _update:d._update,
        _items:[
          _stdComponent._getLabelViewDef(d)
        ],
        _dataRepeat:!d._options&&d._dataRepeat,
      }
      
      if(d._options){
        d._options.forEach(x=>{
          v._items.push(_buildItem(x,x._if))
        })
      }else if(!d._label){
        return _buildItem(d,d._if)
      }else{
        v._items.push(
          _buildItem(d)
        )
      }
      
      if(d._dataList){
        v._items.push({
          _tag:"datalist",
          _attr:{
            id:d._dataList.id
          },
          _items:[
            {
              _tag:"option",
              _attr:{
                value:d._dataList._value
              },
              _text:d._dataList._text,
              _dataRepeat:d._dataList._dataRepeat,
              _jqext:d._jqext
            }
          ]
        })
      }
      _stdComponent._insertInputButtonViewDef(d,v)
      _stdComponent._insertCheckboxViewDef(d,v)
      return v
      
      function _buildItem(d,_if){
        return {
          _if:_if,
          _tag:d._tag||"input",
          _after:d._after,
          _attr:{
            id:d.id,
            class:d._class||"form-control "+(d._exClass||""),
            style:d._style,
            autocomplete:d._autocomplete,
            type:d._type||"text",
            readonly:d._readonly,
            placeholder:d._placeholder,
            disabled:d._disabled||(d._chk&&"!"+d._chk)||d._exDisabled,
            list:d._dataList&&d._dataList.id,
            value:d._value,
            enable:d._enable,
            ...d._attr
          },
          _focus:d._focus,
          _dataModel:d._dataModel,
          _jqext:d._jqext,
        }
      }
    })
    if(_single){
      vs=vs[0]
    }
    return vs
  },
  _insertInputButtonViewDef:function(d,v){
    let _btns=d._btns||(d._btn&&[d._btn]);
    if(_btns&&_btns.length){
      v._items.push(_stdComponent._getButtonViewBoxView(_btns))
    }
  },
  _insertCheckboxViewDef:function(d,v){
    if(d._exChk){
      // d._exChk._boxClass=d._exChk._boxClass||"input-group-btn bz-input-group-ex"
      // d._exChk._boxStyle=d._exChk._boxStyle||" "

      let o=_stdComponent._getCheckboxRadioViewDef(d._exChk)
      let oo=o._items[0]
      o._tag="label"
      o._attr={class:"input-group-addon"}
      o._items=oo._items
      v._items.push(o)
    }
  },
  _getButtonViewBoxView:function(_btns){
    if(_btns.constructor!=Array){
      _btns=[_btns]
    }
    let _box={
      _tag:"div",
      _attr:{
        class:"input-group-btn"
      },
      _items:[]
    }
    _btns.forEach(x=>{
      x&&_box._items.push(_stdComponent._getButtonViewDef(x))
    })
    return _box
  },
  _getButtonViewDef:function(d){
    let v={
      _if:d._if,
      _tag:"button",
      _attr:{
        class:d._class||("btn "+d._exClass),
        disabled:d._disabled,
        style:d._style,
        title:d._title,
        enable:d._enable
      },
      _items:[
        {
          _text:d._text
        },
        _uiHandler._getHelperIcon({
          _msg:d._help||d._ariaLabel
        })
      ],
      _jqext:d._jqext
    }
    if(!d._class){
      let _setting=d._large?"":" bz-small-btn"
      _setting+=d._primary?" btn-primary":""
      _setting+=d._left?" pull-left":""
      _setting+=d._right?" pull-right":""
      
      let _icon=d._icon||""
      if(_icon){
        if(_icon.constructor==Function){
          v._attr.class=_icon
          return v
        }else if(d._text){
          v._attr.class+=" btn-icon-text "
        }else{
          v._attr.class+=" btn-icon "
        }
      }
      v._attr.class+=" "+_icon+_setting
    }
    return v
  },
  _getNoteViewDef:function(d){
    return {
      _if:d._if,
      _tag:"div",
      _attr:{
        class:d._class||"bz-note-text",
        style:d._style
      },
      _text:d._text
    }
  },
  _getBoxViewDef:function(d){
    let v={
      _if:d._if,
      _tag:"div",
      _data:d._data,
      _attr:{
        class:d._class,
        style:d._style
      },
      _items:[]
    }
    if(d._title){
      v._items.push({
        _tag:"div",
        _attr:{
          _tag:"bz-header"
        },
        _text:d._title
      })
    }
    d._items&&d._items.forEach(x=>{
      _addItem(x,v)
    })
    return v
    
    function _addItem(x,v){
      if(x._type=="box"){
        v._items.push(_stdComponent._getBoxViewDef(x))
      }else if(x._type=="_rowbox"){
        let _row={
          _if:x._if,
          _update:x._update,
          _tag:"div",
          _attr:{
            style:"display:flex;"
          },
          _items:[]
        }
        v._items.push(_row)
        x._items.forEach(x=>{
          _addItem(x,_row)
          let o=_row._items.pop()
          o._attr.style=o._attr.style||"flex:1;"
          _row._items.push(o)
        })
      }else if(x._src){
        v._items.push(x._src)
      }else{
        v._items.push(_stdComponent._getInputViewDef(x))
      }
    }
  },
  _getHrWithTitle:function(d){
    return {
      _if:d._if,
      _tag:"div",
      _attr:{
        class:"bz-hr-title"
      },
      _items:[
        {
          _tag:"span",
          _text:d._text
        }
      ]
    }
  },
  _getTestMenuItems:function(){
    return [
      {
        _html:function(d){
          if(d._item){
            if(d._item._parent){
              return _uiHandler._getBadge(d._item._parent._data,d._item._data)
            }else{
              return _uiHandler._getBadge(d._item._data)
            }
          }
        }
      },
      {
        _tag:"span",
        _attr:{
          class:"'bz-small-btn bz-'+(_data._item._data.tests?_data._item._data.bt||'module':_data._item._data.type)",
          style:"padding: 0px 5px;"
        }
      },
      {
        _text:"_data._item._data.name"
      }
    ]
  },
  _getHoverMenuViewDef:function(d){
    return {
      _tag:"div",
      _attr:{
        class:"bz-hover-box",
        style:d._btnBoxStyle
      },
      _items:[
        {
          _tag:"button",
          _attr:{
            class:d._class||("btn btn-icon bz-small-btn "+d._icon),
            style:d._style
          }
        },
        {
          _tag:"div",
          _attr:{
            class:"bz-menu-with-arrow-"+d._way+" bz-hover-menu",
            style:d._menuStyle
          },
          _items:[
            {
              _tag:"div",
              _attr:{
                class:"bz-menu-with-arrow-out-"+d._way,
                style:d._arrowStyle
              }
            },
            {
              _tag:"div",
              _attr:{
                class:"bz-menu-with-arrow-in-"+d._way,
                style:d._arrowStyle
              }
            },
            {
              _tag:"div",
              _attr:{
                class:"bz-menu-with-arrow-box",
                style:"border: 1px solid var(--menu-color);box-shadow: var(--bz-shadow);border-radius: 5px;"
              },
              _items:d._items
            }
          ]
        }
      ]
    }
  },
  _getOpenCloseNode:function({_dragOrder,d,_disabled,_style,_class,_labelStyle,_labelClass,k,_text,_exParts,_resizeFun}){
    _exParts=_exParts||[]
    if(_exParts.constructor!=Array){
      _exParts=[_exParts]
    }
    return {
      _tag:"div",
      _dragOrder:_dragOrder,
      _attr:{
        class:_class||"bz-row",
        style:_style||"padding:0px;",
        disabled:_disabled
      },
      _items:[
        {
          _tag:"div",
          _attr:{
            enable:1,
            class:function(dd){
              let c="btn btn-icon "
              let v;
              let kd=k
              if(k.constructor==Function){
                kd=k(dd)
              }

              if(d.constructor==Array){
                v=d.includes(kd)
              }else{
                v=d[kd]
              }
              return c+(v?'bz-open-node':'bz-close-node')
            },
            style:"cursor:pointer;background-size:6px !important;"
          }
        },
        {
          _tag:"span",
          _attr:{
            style:_labelStyle||"flex:1;cursor:pointer;",
            class:_labelClass||"bz-nowrap"
          },
          _text:_text
        },
        ..._exParts
      ],
      _jqext:{
        click:function(e){
          if([this,this.children[0],this.children[1]].includes(e.target)){
            let kd=k
            if(k.constructor==Function){
              kd=k(this._data)
            }
            if(d.constructor==Array){
              if(d.includes(kd)){
                d.splice(d.indexOf(kd),1)
              }else{
                d.push(kd)
              }
              _CtrlDriver._refreshDom(this.children[0])
            }else{
              d[kd]=!d[kd]
            }
            _resizeFun&&_resizeFun()
          }
        }
      }
    }
  },
  _getLabelViewDef:function(d){
    return {
      _tag:"label",
      _attr:{
        class:function(_data){
          let c=(d._labelClass||"input-group-addon")
          try{
            eval("c="+c)
          }catch(ex){}
          if(d._required){
            if(d._required.constructor==Function){
              if(d._required(_data)){
                c+=" required"
              }
            }else{
              c+=" required"
            }
          }
          return c
        },
      },
      _items:[
        {
          _if:d._chk?1:0,
          _tag:"input",
          _attr:{
            type:"checkbox",
            style:"top:0px;",
          },
          _dataModel:d._chk,
          _jqext:d._chkJqext
        },
        {
          _tag:"span",
          _text:d._label
        },
        _uiHandler._getHelperIcon({
          _msg:d._help||d._ariaLabel,
          _style:"margin-left: 5px !important;margin-right: -5px;"
        })
      ]
    }
  }
};
var _timingInfo={
  _message:[],
  _positionKey:"bz-timing-pos",
  _messageKey:"bz-timing-message",
  _highlightKey:"bz-timing-highlight",
  _build:function(_fun){
    //TODO:Remove for tmp
    return
    
    if(_Util._isFunIgnoreInBrowser(["Edge"])){
      return
    }

    if(this._setCmd("window._timingInfo?_timingInfo._build():''")){
      return
    }
    if(!_Util._isBZTWOpened() || !BZ.TW.document || !BZ.TW.document.body){
      return setTimeout(function(){
        _timingInfo._build(_fun)
      },100)
    }
    var _iframe=$(BZ.TW.document).find("#bzInTimeInfo")[0];
    if(!_iframe){
      _iframe=$("<iframe id='bzInTimeInfo' style='width:0px;height:0px;position:fixed;left:0;top:0;z-index:2147483647;border:0 !important;box-shadow:none !important;' class='BZIgnore'></iframe>")[0];
      BZ.TW.document.body.parentNode.append(_iframe);
    }

    if(_fun){
      this._doc=_iframe.contentDocument;
      _fun(_iframe,_iframe.contentDocument)
    }
  },
  // _setCmd:function(s){
  //   if(BZ._hasExtension()){
  //     _ideComm._setCmd(s);
  //     return 1;
  //   }else if(window.extensionContent && parent!=window){
  //     return 1;
  //   }
  // },
  _setTmpInfo:function(m,_timer){
    if(_timingInfo._blockOnIframe()){
      return
    }
    m=(_timingInfo._message||[]).concat(m)
    while(m.length>2){
      m.shift()
    }
    _timingInfo._setInfo(m);
    clearTimeout(_timingInfo._tmpTimer)
    _timingInfo._tmpTimer=setTimeout(function(){
      _timingInfo._end()
    },_timer||5000)
  },
  _blockOnIframe:function(){
    if(BZ._isPlaying()){
      let a=BZ._getCurAction()
      a=a&&a.element
      a=(a&&a[0])||""
      if(a.toLowerCase().includes("iframe")){
        _timingInfo._end()
        return 1
      }
    }
  },
  _setInfo:function(m,i,p){
    //TODO:Remove for tmp
    if(window._ideTask&&_ideTask._curMode!="_demo"){
      return
    }else if($("#bz-demo-window")[0]){
      let o=$("#bz-demo-window i")[0]
      $(o).text(m[0])
      let wr=$("#BZ_Win")[0]
      if(wr){
        wr=wr.getBoundingClientRect()
        let r=o.getBoundingClientRect()
        if(r.height>wr.top&&r.width>wr.left){
          $(o).css({top:wr.bottom+10})
        }else{
          $(o).css({top:0})
        }
      }
      return
    }
    if(window.extensionContent||_timingInfo._blockOnIframe()){
      return
    }
    //remove realtime execute action info
    if(!BZ._hasVideo){
      if(!curUser._curProject.setting.infoRunningTest){
        return
      }
      if(BZ._isAutoRunning()||!window.SERVER_HOST){
        return
      }
    }
    // if(this._setCmd("window._timingInfo?_timingInfo._setInfo("+JSON.stringify(m)+"):''")){
    //   return
    // }
    // this._build(_doIt)
    // function _doIt(_iframe,doc){
    //   if(!_iframe.contentDocument){
    //     return setTimeout(function(){
    //       _doIt(_iframe,doc)
    //     },10)
    //   }
    //   if(!_iframe.contentDocument.body.innerHTML){
    //     var _html="<link rel='stylesheet' href='"+SERVER_HOST+"/ide/css/bzInsert.css'/><link rel='stylesheet' href='"+SERVER_HOST+"/ide/css/insert.icons.css'/><div style='background-color: rgba(0, 0, 0, 0.6);float:left;padding:10px;user-select:none;' class='bz-timing-info BZIgnore'></div>"
    //     _iframe.contentDocument.write(_html)
    //   }
    //   var o=doc.createElement("div"),r;
    //   o.className="bz-item-info";
    //   o.innerHTML="<div class='bz-info-text'></div><div class='bz-sub-info'></div>";
    //   _timingInfo._setHighLight()
    //   i=i||0;
    //   if(!m[i]){
    //     return
    //   }
    //   localStorage.setItem(_timingInfo._messageKey,JSON.stringify(m))
    //   if(!i){
    //     _timingInfo._message=m;
    //     r=$(doc).find(".bz-timing-info")[0];
    //     r.innerHTML=""
    //     r.append(o)
    //   }else{
    //     $(p).find(".bz-sub-info")[0].append(o)
    //   }
    //   $(o).find(".bz-info-text")[0].innerText=m[i++].trim();
    //   if(m[i]){
    //     _timingInfo._setInfo(m,i,o)
    //   }
    //   if(r){
    //     _timingInfo._resize(_iframe,r)
    //   }
    // }
  },
  _end:function(){
    localStorage.removeItem(this._messageKey)
    if(window.extensionContent){
      $("#bzInTimeInfo").remove()
    }else{
      bzComm.postToAppExtension({
        fun:"_end",
        scope:"_timingInfo"
      })
    }
  },
  _addInfo:function(_test,_format,_loopValue){
    //TODO:Remove for tmp
    return
    // if(_timingInfo._blockOnIframe()){
    //   return
    // }
    // if(window.extensionContent && parent!=window){
    //   return ;
    // }
    // var m=_test._supData.name+" / "+_test.name;
    
    // if(_format){
    //   for(var i=0;i<this._message.length;i++){
    //     var mm=this._message[i];
    //     if(mm.startsWith(m)){
    //       this._message.splice(i);
    //       break;
    //     }
    //   }
      
    //   m=_Util._formatMessage(_format,[m,_loopValue])
    // }
    // this._message.push(m)
    // this._setInfo(this._message)
  },
  _removeLast:function(){
    //TODO:Remove for tmp
    return
    // if(window.extensionContent && parent!=window){
    //   return ;
    // }
    // this._message.pop();
    // this._setInfo(this._message)
  },
  _resize:function(f,p){
    f.style.width="100%";
    f.style.height="50px"
    var r=p.getBoundingClientRect()
    f.style.width=r.width+20+"px";
    f.style.height=r.height+20+"px";
  },
  _setHighLight:function(doc,v){
    doc=doc||this._doc
    localStorage.setItem(this._highlightKey,v+"")
    doc.body.style.backgroundColor="transparent"
    doc.body.style.color="#FFF"
    doc.body.style.overflow="hidden";
  },
  _init:function(){
    //TODO:Remove for tmp
    return
    // if(BZ._isAutoRunning()){
    //   return
    // }
    // if(this._setCmd("window._timingInfo?_timingInfo._setInfo("+JSON.stringify(this._message)+"):''")){
    //   return
    // }
    // this._build(function(p,doc){
    //   var pos=localStorage.getItem(_timingInfo._positionKey)
    //   if(pos){
    //     try{
    //       pos=JSON.parse(pos)
    //     }catch(e){
    //       // console.log("Error josn data: ")
    //       // console.log(pos)
    //       return
    //     }
    //     if(pos.lx<0){
    //       pos.lx=0
    //     }
    //     if(pos.ly<0){
    //       pos.ly=0
    //     }
    //     if(pos.lx>BZ.TW.innerWidth-50){
    //       pos.lx=BZ.TW.innerWidth-50
    //     }
    //     if(pos.ly>BZ.TW.innerHeight-50){
    //       pos.ly=BZ.TW.innerHeight-50
    //     }
    //     p.style.left=pos.lx+"px";
    //     p.style.top=pos.ly+"px";
        
    //   }
    //   var v=localStorage.getItem(_timingInfo._highlightKey);
    //   _timingInfo._setHighLight(doc,v)
    //   var m=localStorage.getItem(_timingInfo._messageKey);
    //   if(m){
    //     _timingInfo._setInfo(JSON.parse(m))
    //   }

    //   var r=doc.body,x,y,lx,ly;
    //   r.ondblclick=function(){
    //     var v=localStorage.getItem(_timingInfo._highlightKey);
    //     if(v && parseInt(v)){
    //       v=0
    //     }else{
    //       v=1
    //     }
    //     _timingInfo._setHighLight(doc,v)
    //   }
      
    //   r.onmousedown=function(e){
    //     x=e.x
    //     y=e.y
    //     var pr=p.getBoundingClientRect();
    //     lx=pr.left;
    //     ly=pr.top;
    //   }
    //   r.onmousemove=function(e){
    //     if(e.buttons){
    //       lx=parseInt(p.style.left=(lx+(e.x-x))+"px");
    //       ly=parseInt(p.style.top=(ly+(e.y-y))+"px");
    //     }
    //   }
    //   r.onmouseup=function(e){
    //     localStorage.setItem(_timingInfo._positionKey,'{"lx":'+lx+',"ly":'+ly+'}')
    //     x=y=lx=ly=0;
    //   }
    //   r.onselectstart=function(){
    //     return false;
    //   }
    // })
  }
};
var _uploadHandler={
  _retrieveBase64ValueFromLink:function(url){
    return url.substring(url.indexOf("base64,")+7); 
  },
  _base64ToBlob:function(o){
      var _sliceSize = 1024;
      var _byteChars = _Util._b64DecodeUnicode(this._retrieveBase64ValueFromLink(o.base64Link));
      var _byteArrays = [];

      for (var _offset = 0, _len = _byteChars.length; _offset < _len; _offset += _sliceSize) {
          var _slice = _byteChars.slice(_offset, _offset + _sliceSize);

          var _byteNumbers = new Array(_slice.length);
          for (var i = 0; i < _slice.length; i++) {
            _byteNumbers[i] = _slice.charCodeAt(i);
          }

          _byteArrays.push(new Uint8Array(_byteNumbers));
      }

      var v = new Blob(_byteArrays, {type:o.type});
      for(var k in o){
        try{
          v[k]=o[k];
        }catch(e){}
      }
      v.$ngfBlobUrl=window.URL.createObjectURL(v);
//      delete v.base64Link;
      return v;
  },
  _inputFileToBase64Obj:function(_files,_funNext,_idx,_result){
    if(!_idx){
      _idx=0;
    }
    if(!_result){
      _result=[];
    }
    if(_files.length<=_idx){
      return _funNext(_result);
    }
    var _file=_files[_idx++];
    var _reader = new FileReader();
    _reader.onload = function (e) {
      var v=e.target.result;
      var o = $.extend(null,_file);
      o.base64Link=e.target.result;
      _result.push(o);
      _uploadHandler._inputFileToBase64Obj(_files,_funNext,_idx,_result);
    }
    _reader.readAsDataURL(_file);
  },
  _buildUploadBold:function(_list){
    var _result=[];
    for(var i=0;i<_list.length;i++){
      var o=_list[i];
      _result.push(this._base64ToBlob(o));
    }
    return _result;
  },
  _setFileValue:function(_input,v){
    if(v.constructor==String){
      v=eval(v);
    }
    if(v.constructor==Object){
      v=[v]
    }
    for(var i=0;i<v.length;i++){
      v[i].name=decodeURIComponent(v[i].name.split("?")[0]);
    }
    let a=_uploadHandler._buildUploadBold(v)
    let d = new ClipboardEvent('').clipboardData || new DataTransfer();
    a.forEach((x,i)=>{
      let f=new File([x],v[i].name,{type:v[i].type})
      d.items.add(f);
    })
    _input.files=d.files
    
    
    // let a=_uploadHandler._buildUploadBold(v)
    // let d = new ClipboardEvent('').clipboardData || new DataTransfer();
    // let f=new File(a,v[0].name,{type:v[0].type})
    // d.items.add(f);
    // f=new File(a,v[0].name,{type:v[0].type})
    _input.files=d.files
    
    
  },
  /*
  _fakeInputFile:function(_input,_files,_fileData){
    this._overWriteSubmitForm(_input);
    var _fakeInput=$("<div></div>").insertBefore(_input)[0];
    var _angularScope=null;
    var _curWin=_Util._getWindowFromDom(_input);
    var _data={}
    if(_curWin.angular){
      _angularScope=_curWin.angular.element(_input).scope();
    }
    for(var i=0;i<_input.attributes.length;i++){
      var a = _input.attributes[i];
      $(_fakeInput).attr(a.name,a.value);
      _data[a.name]=a.value;
      if(_angularScope){
        try{
          var tmp=null;
          eval("tmp=_angularScope."+a.value+"._"+"directives.select");
          for(var x=0;x<tmp.length;x++){
            var _element=tmp[x].element;
            for(var y=0;y<_element.length;y++){
              if(_element[y]==_input){
                _element[y]=_fakeInput;
                break;
              }
            }
          }
        }catch(e){}
      }
    }
    
    _fakeInput.files=_files;
    _data.files=_fileData;
    _data.value=_fakeInput.value=_files[0].name;
    $(_fakeInput).attr("value",_files[0].name);
    var n="bzFile"+Date.now()
    $(_fakeInput).attr("bzId",n);
    _data.bzId=n;

    if(window.extensionContent){
      window.postMessage({bz:1,_fun:"_setFakeFileForExtWebPage",_scope:"_uploadHandler",_data:_data}, "*");
    }
    
    $(_input).remove();
    if(_input.onchange){
      _fakeInput.onchange=_input.onchange
    }
    return _fakeInput;
  },
  */
  _outputSubmitResult:function(data,_target){
    var w=BZ.TW.open('',_target||"_"+"self");
    w.location.reload();
    w.document.write(data);
  },
  _overWriteSubmitForm:function(_field){
    if(_field.name){
      var _form=_uploadHandler._curForm=_Util._getParentNode(_field,"FORM");
      if(_form && !_form.BZ_handled){
        _form.BZ_handled=true;
        $(_form).on("submit",function(){
          this.submit();
        });
        _form.submit=function(){
          var ps=$(this).serializeArray();
          
          var formData = new FormData();
          
          for(var i=0;i<ps.length;i++){
            var p=ps[i];
            formData.append(p.name, p.value);
          }
           
          var fs=$("div[type='file']")
          for(var i=0;i<fs.length;i++){
            var f=fs[i];
            for(var n=0;n<f.files.length;n++){
              formData.append($(f).attr("name"), f.files[n],f.files[n].name);
            }
          }
          var _this=this;
          $.ajax({
            url:this.action,
            type:this.method,
            data:formData,
            processData: false,
            contentType: false,
            success: function(data){
              _uploadHandler._outputSubmitResult(data,_this.target);
            },
            error:function(data){
              _uploadHandler._outputSubmitResult(data,_this.target);
            }
          });
          return true;
        }
        
        
      }
    }
  },
  _submitCurForm:function(){
    _uploadHandler._curForm.submit();
  },
  //p:path
  _keepChangeFileFun:function(p){
    //p[0]="window.document";
    if(window.jQuery){
      var o=$(p)[0];
      if(o && o.type=="file" && jQuery["_"+"data"](o).events && jQuery["_"+"data"](o).events.change){
        this._fileChangeFun=jQuery["_"+"data"](o).events.change;
      }
    }
  },
  _exeKeepChangeFileFun:function(p){
    p=_Util._getElementByQuickPath(p)
//    console.log(p)
//    p.dispatchEvent(new Event("load"));
    p.dispatchEvent(new Event("change",{bubbles:true}));
  },
  _getProjectFiles:function(){
    return _IDE._data._curVersion.setting.defaultData.filter(x=>x.type=="r"&&x.value.url&&x.value.url.includes("/"+"/"+location.host))
  },
  _findDataByFileName:function(v){
    let fs=_uploadHandler._getProjectFiles();
    return (fs.find(x=>x.value.name==v)||{}).name
  },
  _addProjectData:function(d){
    let n=_glossaryHandler._getVariableName(d.name)
    _IDE._data._curVersion.setting.defaultData.push({
      type:"r",
      name:n,
      value:{
        url:d.url,
        type:"file"
      }
    })
    _ideVersionManagement._save()
    return "$project."+n
  },
  _handleUploadFile:function(v,_fun){
    let d=_uploadHandler._findDataByFileName(v.name);
    if(d){
      return _fun("$project."+d)
    }
    let fs=_uploadHandler._getProjectFiles();
    if(fs.length>10){
      return alert(_bzMessage._action._limitFileCount)
    }
    _requestHandler._callService({
      _data:{
        method:"POST",
        url:"/api/projects/"+BZ._data._curProject.code+"/uploadFileData/",
        data:v
      },
      _success:function(x){
        _fun(_uploadHandler._addProjectData(x.result))
      }
    });
  },
  _askHandleFile:function(a,_fun){
    let v=a._uploadFile[0]
    v.file=v.base64Link
    delete v.base64Link
    delete a._uploadFile
    _Util._confirmMessage({
      _tag:"div",
      _items:[
        {
          _tag:"label",
          _text:"_bzMessage._action._confirmUploadFileToServer"
        }
      ]
    },[{
      _title:_bzMessage._method._not,
      _class:"btn-secondary",
      _click:function(c){
        if(v.size>6000){
          return alert(_bzMessage._action._tooLargeInScript)
        }
        c._ctrl._close()
      }
    },{
      _title:_bzMessage._method._yes,
      _click:function(c){
        _uploadHandler._handleUploadFile(v,function(n){
          a.event.value=`{{${n}}}`
          $(".row-selected").click()
        })
        c._ctrl._close()
      }
    },{
      _title:_bzMessage._method._cancel,
      _class:"btn-secondary",
      _click:function(c){
        a.event.value=""
        $(".row-selected").click()
        c._ctrl._close()
      }
    }],0,0,1)
  }
};
var TWHandler={
  _resetTime:60000,
  _lastPageInfo:{},
  _curRequestList:[],
  BZ_sent:0,
  _popExpected:{alert:[],confirm:[],prompt:[],onbeforeunload:[]},
  _popActual:{alert:[],confirm:[],prompt:[],onbeforeunload:[]},
  _init:function(){
    this.BZ_sent=0;
    this._lastPageInfo={};
    this._popExpected={alert:[],confirm:[],prompt:[],onbeforeunload:[]};
    this._popActual={alert:[],confirm:[],prompt:[],onbeforeunload:[]};
    if(window.name!="bz-master"){
      if(window.extensionContent){
        $(document.body).on("mouseover","a",function(){
          _Util._removeLinkTarget(this)
        })
      }else{
        let w=window
        TWHandler._takeoverAddEventListener();
        TWHandler._takeoverCanvas(w);
        TWHandler._takeoverOpenWin(w);
        TWHandler._takeoverSocket(w);
        TWHandler._takeoverAjax(w)
        TWHandler._takeoverConsole(w);

      }
    }
  },
  _uiSync:function(){
    
  },
  _chkPopInfo:function(_action,_second){ //for alert, confirm, prompt
    var a=TWHandler._popActual;
    var e=TWHandler._popExpected;

    for(var k in a){
      var aa=a[k].shift();
      var ee=e[k].shift();
      if (aa===undefined && (ee===undefined || ee.expectation===undefined)) {
      }else if (aa===undefined) {
        if(!_second){
          e[k].unshift(ee);
          return "wait"
        }
        return _Util._formatMessage(_bzMessage._test._error._missPop,[k,ee.expectation]);
      }else if (ee===undefined) {
        return _Util._formatMessage(_bzMessage._test._error._unexpectedPop,[k,aa]);
      }else if (aa.trim()!=ee.expectation.toString().trim()) {
        return _Util._formatMessage(_bzMessage._test._error._unMatchPop,[k,ee.expectation,aa]);
      }
    }
  },
  _setPlayMode:function(v){
    TWHandler._curMode=v
    if(window.extensionContent){
      var o=document.createElement("script");
      o.innerHTML="window.TWHandler&&(window.TWHandler._curMode='"+v+"')";
      document.body.parentNode.append(o);
    }
  },
  _setBackTestPage:function(){
    w=window;
    if(document.documentElement.getAttribute("bzOverrideMark")){
      w.alert=w.BZ_Alert;
      w.confirm=w.BZ_Confirm;
      w.prompt=w.BZ_Prompt;
      if(w.onbeforeunload){
        w.onbeforeunload=w.BZ_Onbeforeunload;
      }else if(TWHandler._checkJQueryEvent().beforeunload){
        TWHandler._checkJQueryEvent().beforeunload[0].handler=w.BZ_Onbeforeunload;
      }
      
      w.BZ_Alert=0;
      w.BZ_Confirm=0;
      w.BZ_Prompt=0;
      w.BZ_Onbeforeunload=0;
      delete w.BZ_Onbeforeunload_fun;
      document.documentElement.removeAttribute("bzOverrideMark");
    }
  },
  _takeoverWin:function(){
    if(window.extensionContent){
      return bzComm.postToApp({fun:"_takeoverWin",scope:"TWHandler",ps:[]});
    }
    
    try{
      TWHandler._takeoverPopMsg(window);
      document.documentElement.setAttribute("bzOverrideMark",1)
    }catch(e){
    }
  },
  _takeoverConsole:function(w){
    if(!w._orgAssert){
      w._orgAssert=w.console.assert;
      var _this=this;
      w.console.assert=function(a,b){
        if(!a){
          _this._assertList=_this._assertList||[];
          _this._assertList.push(b)
        }
      }
    }
  },
  _takeoverCanvas:function(w){
    w=w||window
    if(window.name=="bz-master"){
      return
    }
    let _CanvasRenderingContext2D="Ca"+"nvas"+"Render"+"ingCont"+"ext2D",
        _prototype="pro"+"tot"+"ype",
        _fillText="fi"+"llTe"+"xt",
        _strokeText="st"+"rokeT"+"ext",
        _clearRect="cle"+"arR"+"ect",
        _reset="r"+"es"+"et",
        _setTransform="se"+"tTr"+"ansfo"+"rm",
        _transform="tr"+"ansfo"+"rm",
        _scale="sca"+"le",
        _translate="tra"+"nsla"+"te",
        _getTransform="ge"+"tTra"+"nsfo"+"rm",
        _drawImage="dra"+"wIma"+"ge",
        _putImageData="pu"+"tIma"+"geD"+"ata",
        _createImageData="cr"+"eateI"+"mageD"+"ata",
        _HTMLCanvasElement="HT"+"MLCan"+"vasEl"+"eme"+"nt",
        _width="wi"+"dth",
        _height="he"+"ig"+"ht",
        _setAttribute="setAttribute";
        
    if(!w[_CanvasRenderingContext2D][_prototype]._bzFillText){
      w[_HTMLCanvasElement][_prototype]._bzSetAttribute=w[_HTMLCanvasElement][_prototype][_setAttribute];
      w[_HTMLCanvasElement][_prototype][_setAttribute]=function(a,b){
        if(a=="width"||a=="height"){
          _clearMap(this["ge"+"tCon"+"tex"+"t"]("2"+"d"))
        }
        this._bzSetAttribute(a,b)
      }

      w[_CanvasRenderingContext2D][_prototype]._bzFillText=w[_CanvasRenderingContext2D][_prototype][_fillText];
      w[_CanvasRenderingContext2D][_prototype][_fillText]=function(a,b,c,d){
//        console.log("fill text: "+a+","+b)
        _handleFillText(this,a,b,c,d)
        this._bzFillText(a,b,c,d)
      }

      w[_CanvasRenderingContext2D][_prototype]._bzStrokeText=w[_CanvasRenderingContext2D][_prototype][_strokeText];
      w[_CanvasRenderingContext2D][_prototype][_strokeText]=function(a,b,c,d){
        _handleFillText(this,a,b,c,d)
        this._bzStrokeText(a,b,c,d)
      }


      w[_CanvasRenderingContext2D][_prototype]._bzClearRect=w[_CanvasRenderingContext2D][_prototype][_clearRect]
      w[_CanvasRenderingContext2D][_prototype][_clearRect]=function(a,b,c,d){
        // console.log("_clearMap:"+a+":"+b+":"+c+":"+d)
        _clearMap(this,a,b,c,d)
        this._bzClearRect(a,b,c,d)
      }

      w[_CanvasRenderingContext2D][_prototype]._bzReset=w[_CanvasRenderingContext2D][_prototype][_reset]
      w[_CanvasRenderingContext2D][_prototype][_reset]=function(a,b,c,d){
        // console.log("_clearMap:"+a+":"+b+":"+c+":"+d)
        _clearMap(this)
        this._bzReset(a,b,c,d)
      }

      if(!w[_CanvasRenderingContext2D][_prototype][_getTransform]){
        w[_CanvasRenderingContext2D][_prototype]._bzSetTransform=w[_CanvasRenderingContext2D][_prototype][_setTransform]
        w[_CanvasRenderingContext2D][_prototype][_setTransform]=function(a,b,c,d,e,f){
          TWHandler._curTransform={
            a:a,b:b,c:c,d:d,e:e,f:f
          }
          this._bzSetTransform(a,b,c,d,e,f)
        }

        w[_CanvasRenderingContext2D][_prototype]._bzTransform=w[_CanvasRenderingContext2D][_prototype][_transform]
        w[_CanvasRenderingContext2D][_prototype][_transform]=function(a,b,c,d,e,f){
          let v=TWHandler._curTransform=TWHandler._curTransform||{a:1,b:0,c:0,d:1,e:0,f:0}
          v.e+=e*v.a
          v.f+=f*v.d
          v.a*=a
          v.b+=b
          v.c+=c
          v.d*=d
          // console.log("transform:"+v.a+":"+v.b+":"+v.c+":"+v.d+":"+v.e+":"+v.f)
          
          this._bzTransform(a,b,c,d,e,f)
        }

        w[_CanvasRenderingContext2D][_prototype]._bzScale=w[_CanvasRenderingContext2D][_prototype][_scale]
        w[_CanvasRenderingContext2D][_prototype][_scale]=function(a,b){
          let v=TWHandler._curTransform=TWHandler._curTransform||{a:1,b:0,c:0,d:1,e:0,f:0}
          v.a*=a
          v.d*=b
          // console.log("scale:"+v.a+":"+v.d)
          this._bzScale(a,b)
        }

        w[_CanvasRenderingContext2D][_prototype]._bzTranslate=w[_CanvasRenderingContext2D][_prototype][_translate]
        w[_CanvasRenderingContext2D][_prototype][_translate]=function(a,b){
          let v=TWHandler._curTransform=TWHandler._curTransform||{a:1,b:0,c:0,d:1,e:0,f:0}
          v.e+=a
          v.f+=b
          // console.log("translat:"+v.e+":"+v.f)
          this._bzTranslate(a,b)
        }

        w[_CanvasRenderingContext2D][_prototype]._bzGetTransform=w[_CanvasRenderingContext2D][_prototype][_getTransform]
        w[_CanvasRenderingContext2D][_prototype][_getTransform]=function(){
          if(this._bzGetTransform){
            return this._bzGetTransform()
          }else{
            return TWHandler._curTransform||{a:1,b:0,c:0,d:1,e:0,f:0}
          }
        }
      }
      /*
      w[_CanvasRenderingContext2D][_prototype]._bzDrawImage=w[_CanvasRenderingContext2D][_prototype][_drawImage];
      w[_CanvasRenderingContext2D][_prototype][_drawImage]=function(a,b,c,d,e,f,g,h,j){
        let r=this[_getTransform]()
        if(a.src){
          let dd={
            t:a.src.split("/").pop().split(".")[0],
            w:h*r.a,
            h:j*r.d,
            x:f+r.e,
            y:g+r.f,
            _img:1
            // bg:bg
          }
          dd.c={x:dd.x+dd.w/2,y:dd.y+dd.h/2}
          _addData(this,dd)
        }
        this._bzDrawImage(a,b,c,d,e,f,g,h,j)
      }
      
      // w[_CanvasRenderingContext2D][_prototype]._bzMoveTo=w[_CanvasRenderingContext2D][_prototype].moveTo;
      // w[_CanvasRenderingContext2D][_prototype].moveTo=function(a,b){
        // // console.log("--------moveTo--------")
        // // let r=this[_getTransform]()
        // // console.log(r)
        // // console.log(a+":"+b)
        // // console.log("----------------------------")
        // this._bzMoveTo(a,b)
      // }
      
      // w[_CanvasRenderingContext2D][_prototype]._bzLineTo=w[_CanvasRenderingContext2D][_prototype].lineTo;
      // w[_CanvasRenderingContext2D][_prototype].lineTo=function(a,b){
        // // console.log("--------lineTo--------")
        // // console.log(this.canvas.getAttribute("bzTxtId"))
        // // console.log("strokeStyle: "+this.strokeStyle)
        // // console.log("lineWidth"+this.lineWidth)
        // // let r=this[_getTransform]()
        // // console.log(r)
        // // console.log(a+":"+b)
        // // console.log("----------------------------")
        // // if(a>10||b>10){
          // // return
        // // }
        // this._bzLineTo(a,b)
      // }

      w[_CanvasRenderingContext2D][_prototype]._bzCreateImageData=w[_CanvasRenderingContext2D][_prototype][_createImageData];
      w[_CanvasRenderingContext2D][_prototype][_createImageData]=function(a,b,c){
        // console.log("------CreateImageData------")
        // console.log(a+":"+b+":"+c)
        // console.log("----------------------------")
        this._bzCreateImageData(a,b,c)
      }

      w[_CanvasRenderingContext2D][_prototype]._bzPutImageData=w[_CanvasRenderingContext2D][_prototype][_putImageData];
      w[_CanvasRenderingContext2D][_prototype][_putImageData]=function(a,b,c,d,e,f){
        // console.log("-------[_putImageData]---------")
        // console.log(a+":"+b+":"+c+":"+d+":"+e+":"+f)
        // console.log("----------------------------")
        this._bzPutImageData(a,b,c,d,e,f)
      }
      /**/
    }else{
      return
    }

    function _handleFillText(cc,a,b,c,d){
      let h=parseInt(cc.font.match(/[0-9\.]+/)[0])
      // console.log(a+":"+b+":"+c+":"+h+":"+cc.measureText(a).width)
      // let bg=cc.getImageData(b, c-h, 1, 1)
      // bg=bg.data
      // bg=[bg[0],bg[1],bg[2],bg[3]]
      
      let r=cc[_getTransform](),
          ww=cc.measureText(a).width

      let dd={
        t:a,
        w:ww*r.a,
        h:h*r.d,
        x:b+r.e,
        y:c-h+r.f
        // bg:bg
      }
      
      // console.log(JSON.stringify(dd))
      // console.log(JSON.stringify(r))
      
      dd.c={x:dd.x+dd.w/2,y:dd.y+dd.h/2}
      if(cc.textAlign=="center"){
        dd.x-=dd.w/2
      }else if(cc.textAlign=="right"){
        dd.x-=dd.w
      }
      if(!cc._bzSetTransform||(dd.x>0&&dd.y>0)){
        _addData(cc,dd)
      }
    }

    function _clearMap(c,x,y,w,h){
      if(!TWHandler._canvasDataMap){
        return
      }
      let _map=TWHandler._canvasDataMap[c.canvas.getAttribute("bzTxtId")]
      if(_map){
        if(x===undefined){
          for(let k in _map){
            delete _map[k]
          }
        }else{
          let wx=w+x,hy=h+y
          for(var k in _map){
            let d=_map[k]
            _Util._spliceAll(d,v=>{
              return v.x>=x&&v.x<=wx&&v.y>=y&&v.y<=hy
            })
            if(!d.length){
              delete _map[k]
            }
          }
        }
        TWHandler._buildCanvasDataPath()
      }
    }
    function _addData(c,d){
      d.t=(d.t||"").trim()
      if(!d.t){
        return
      }
      
      if(!d.t.match(_Util._allPrintableChr)){
        return 
      }

      let _key=c.canvas.getAttribute("bzTxtId")
      if(!_key||!TWHandler._canvasDataMap[_key]){
        _key="bz"+Date.now()
        c.canvas.setAttribute("bzTxtId",_key)
        
        if(!TWHandler._canvasDataMap){
          TWHandler._canvasDataMap={}
        }

        TWHandler._canvasDataMap[_key]={}
      }
      _clearMap(c,d.x,d.y,d.w,d.h)
      
      let _map=TWHandler._canvasDataMap[_key]
      let dd=_map[d.t]
      if(!dd){
        dd=_map[d.t]=[]
      }
      
      dd.push(d)
      dd.sort((a,b)=>{
        let v=a.y-b.y
        if(!v){
          v=a.x-b.x
        }
        if(!v){
          v=a.w-b.w
        }
        if(!v){
          v=a.h-b.h
        }
        return v
      })
      TWHandler._buildCanvasDataPath()
    }
  },
  _buildCanvasDataPath:function(){
    clearTimeout(TWHandler._buildCanvasDataPathTimer)
    TWHandler._buildCanvasDataPathTimer=setTimeout(()=>{
      _clean()
      TWHandler._getCanvasData()
    },100)
    function _clean(){
      let cs=document.getElementsByTagName("CANVAS")
      for(var k in TWHandler._canvasDataMap){
        let _found=0
        for(var i=0;i<cs.length;i++){
          if(cs[i].getAttribute("bzTxtId")==k){
            _found=1
            break
          }
        }
        if(!_found){
          delete TWHandler._canvasDataMap[k]
        }
      }
    }
  },
  _getCloseCanvasItem:function(o,_list){
    let _min,x,y,vv;
    _list.forEach(v=>{
      if(o.x+o.w<=v.x||v.x+v.w<o.x){
        x=v.x-o.x-o.w
      }else{
        x=v.c.x-o.c.x
      }
      if(o.y+o.h<=v.y||v.y+v.h<o.y){
        y=v.y-o.y-o.h
      }else{
        y=v.c.y-o.c.y
      }
      
      vv=Math.pow(x*x+y*y,0.5)
      if(!_min||_min.v>vv){
        _min={
          o:v,
          v:vv
        }
      }
    })
    return _min
  },
  _getCanvasData:function(_map){
    if(!window.extensionContent){
      bzComm.postToAppExtension({
        fun:"_getCanvasData",
        ps:[TWHandler._canvasDataMap],
        scope:"TWHandler"
      })
    }else if(_map){
      TWHandler._canvasDataMap=_map
    }else{
      return TWHandler._canvasDataMap
    }
  },
  _getCanvasTextElement:function(c,t,i){
    if(TWHandler._canvasDataMap){
      let m=TWHandler._canvasDataMap[c.getAttribute("bzTxtId")]
      if(m){
        m=m[t]
        if(m){
          if(i!==undefined){
            return m[i]
          }
          return m
        }else{
          let tt=t.split(">"),ts=[]
          for(let j=0;j<tt.length;j++){
            let tv=tt[j]
            if(tv.endsWith("\\")&&j<tt.length-1){
              tv=tv.replace("\\",">")+tt[j+1]
              j--
            }
          }
          tt=tt.map(x=>x.trim())
          while(tt.length){
            let tv=tt.pop().replace(/\)$/,"")
            tv=TWHandler._getCanvasTextElement(c,tv)
            if(tv){
              ts.unshift(tv)
            }else{
              return
            }
          }
          let kt=ts.shift(),_min
          while(ts.length){
            let to=ts.shift()
            kt.forEach((kk,i)=>{
              let mm=TWHandler._getCloseCanvasItem(kk,to)
              if(!i||mm.v<_min.v){
                _min=mm
              }
            })
            if(_min){
              kt=[_min.o]
            }
          }
          if(i===undefined){
            return [_min.o]
          }else{
            return _min.o
          }
        }
      }
    }
  },
  _getCanvasTextElementIdx:function(c,d){
    if(TWHandler._canvasDataMap){
      let m=TWHandler._canvasDataMap[c.getAttribute("bzTxtId")]
      if(m){
        m=m[d.t]
        if(m){
          return m.findIndex(v=>{
            return v==d
          })
        }
      }
    }
  },
  _getCanvasTextElementByMousePos:function(c,x,y,_ignoreTxt){
    if(TWHandler._canvasDataMap){
      let m=TWHandler._canvasDataMap[c.getAttribute("bzTxtId")]
      if(m){
        let r=c.getBoundingClientRect(),_min;
        x-=r.left;
        y-=r.top;
        
        for(var k in m){
          let ds=m[k]
          for(var i=0;i<ds.length;i++){
            let d=ds[i]
            
            if(_ignoreTxt==d.t){
              continue
            }

            if(d.x<=x&&d.x+d.w>=x&&d.y<=y&&d.y+d.h>=y){
              return d
            }else{
              let v=Math.pow(Math.pow(d.c.x-x,2)+Math.pow(d.c.y-y,2),0.5)
              if(!_min||_min.v>v){
                _min={v:v,d:d}
              }
            }
          }
        }
        if(_min){
          let d=_min.d
          d.offset=0
          if(x<d.x||x>d.x+d.w||y<d.y||y>d.y+d.h){
            d.offset={
              X:parseInt(x-d.c.x),
              Y:parseInt(y-d.c.y),
              origin:"mc"
            }
          }
          return d
        }
      }
    }
  },
  _takeAssertInfo:function(){
    var v=this._assertList||[];
    this._assertList=[];
    return v;
  },
  _takeoverPopMsg:function(w){
    var _beforeunload=w.onbeforeunload || (TWHandler._checkJQueryEvent().beforeunload?TWHandler._checkJQueryEvent().beforeunload[0].handler:null);
    
    if((!w.BZ_Onbeforeunload && _beforeunload) || (w.BZ_Onbeforeunload_fun && w.BZ_Onbeforeunload_fun!=_beforeunload)){
      w.BZ_Onbeforeunload=_beforeunload;
      if(_beforeunload){
        _beforeunload=function(){
          TWHandler._setOnbeforeunload(w.BZ_Onbeforeunload());
        };
        if(w.onbeforeunload){
          w.onbeforeunload=_beforeunload;
        }else{
          TWHandler._checkJQueryEvent().beforeunload[0].handler=_beforeunload;
        }
      }
      w.BZ_Onbeforeunload_fun=_beforeunload;
    }
    if(w.BZ_Alert){
      return;
    }
    w.BZ_Alert=w.alert;
    w.BZ_Confirm=w.confirm;
    w.BZ_Prompt=w.prompt;
    
    w.alert=function(m){
      TWHandler._setAlert(m);
    };
    w.confirm=function(_msg){
      var v= TWHandler._triggerConfirm(_msg);
      return v;
    };
    w.prompt=function(_msg){
      var v=TWHandler._triggerPrompt(_msg)
      return v
    };
  },
  _takeoverAjax:function(_win){
    console.log("TWHandler._takeoverAjax ....")
    var p=_win.XMLHttpRequest.prototype
    if(!p.BZ_Ajax||p.open==p.BZ_Ajax){
      p.BZ_Ajax=p.open;
      p.open=function(a,b,c){
        var o=this;
        var _host=_Util._retrieveHostFromUrl(b)
        if(!_host){
          _host=location.protocol+"/"+"/"+location.host;
        }
        o.url=b;

        o.m=a;
        TWHandler._curAPI={url:b,method:a,host:_host}

        this.BZ_ReceiveAjax=function(url){
          if((o.readyState==4 || o._time && Date.now()-o._time>1000) && url==o.url){
            bzComm.postToAppExtension({
              fun:"_setRequestCount",
              ps:{_url:o.url,i:-1,_type:"api"},
              scope:"TWHandler"
            });
          }else{
            if(o._send && o.readyState==0 && !o._time){
              o._time=Date.now()
            }
            var a=this;
            _win.setTimeout(function(){
              a.BZ_ReceiveAjax(url)
            },0);
          }
        };
        _win.setTimeout(function(){
          o.BZ_ReceiveAjax(b)
        },0);
        if(c!==undefined){
          return this.BZ_Ajax(a,b,c);
        }else{
          return this.BZ_Ajax(a,b);
        }
      };

      if(!p.BZ_SetHeader||p.BZ_SetHeader==p.setRequestHeader){
        p.BZ_SetHeader=p.setRequestHeader;
        
        p.setRequestHeader=function(a,b){
          this._headers=this._headers||{}
          if(this._headers[a]!==b){
            this._headers[a]=b
          }
          this.BZ_SetHeader(a,b)
        }
      }

      if(!p.BZ_AjaxSend||p.BZ_AjaxSend==p.send){
        p.BZ_AjaxSend=p.send;
        p.send=function(a,b,c){
          bzComm.postToAppExtension({
            fun:"_setRequestCount",
            ps:[{_url:this.url,i:1,_type:"api"}],
            scope:"TWHandler"
          });
          this._send=1;
          TWHandler._setAjaxRequest(a,this._headers)
          return this.BZ_AjaxSend(a,b,c);
        };
      }
      
      let _bzFetch=_win.fetch
      _win.fetch=function(a,b,c){
        let _url=a.url||a
        let _host=_Util._retrieveHostFromUrl(_url)
        let m=a.method?a.method:b?b.method:"GET"
        let _body=(a&&a.body)||(b&&b.body)||b
        let _headers=(a&&a.headers)||(b&&b.headers)||b||{}
        TWHandler._curAPI={url:_url,method:m,host:_host}
        bzComm.postToAppExtension({
          fun:"_setRequestCount",
          ps:[{_url:_url,i:1,_type:"fetch"}],
          scope:"TWHandler"
        });

        let _featchResult=_bzFetch(a,b,c)
        _featchResult.then(x=>{
          x=x.clone()
          TWHandler._setAjaxRequest(_body,_headers)
          setTimeout(()=>{
            bzComm.postToAppExtension({
              fun:"_setRequestCount",
              ps:[{_url:_url,i:-1,_type:"fetch"}],
              scope:"TWHandler"
            });
            try{
              let _contentType=x.headers.get('content-type')||""
              if(_contentType.includes("json")){
                x.json().then(xx=>{
                  let d={data:xx,url:_url,m:m,status:x.status,host:_host}
                })
              }
            }catch(e){}
          },100)
        },_err=>{
          bzComm.postToAppExtension({
            fun:"_setRequestCount",
            ps:[{_url:_url,i:-1,_type:"fetch"}],
            scope:"TWHandler"
          });
         // throw _err
        })
        return _featchResult
      }
    }
  },
  _setRequestCount:function(v){
    if(BZ.isIgnoreReq(v._url)){
      return
    }
    if(v.i==-1){
      TWHandler._curRequestList.find((x,i)=>{
        if(x._url==v._url){
          TWHandler._curRequestList.splice(i,1)
          return 1
        }
      })
    }else{
      TWHandler._curRequestList.push(v)
    }
    if(window.extensionContent&&v._type=="socket"){
      bzComm.postToIDE({
        fun:"_setRequestCount",
        scope:"TWHandler",
        ps:[v]
      })
    }
  },
  _takeoverSocket:function(_win){
    var p=_win.WebSocket.prototype
    if(!p._bzSocketSend||p._bzSocketSend==p.send){
      p._bzSocketSend=p.send
      p.send=function(_msg,bz){
        if(!bz){
          bzComm.postToAppExtension({
            fun:"_setRequestCount",
            ps:{_url:this.url,i:1,_type:"socket"},
            scope:"TWHandler"
          });

          if(!_win._bzSocket){
            _win._bzSocket=this
            _win._bzSocket.addEventListener("message",function(e){
              var o=_win._bzSocket
              bzComm.postToAppExtension({
                fun:"_setRequestCount",
                ps:{_url:this.url,i:1,_type:"socket"},
                scope:"TWHandler"
              });
            })
          }
        }
        this._bzSocketSend(_msg)
      }
    }
  },
  _setAjaxRequest:function(v,_headers){
    if(!window.extensionContent){
      if(v){
        if(TWHandler._curAPI){
          TWHandler._curAPI.data=v
        }else{
          TWHandler._curAPI=v
        }
      }
      
      v=TWHandler._curAPI
      if(_headers&&v){
        v.contentType=_headers["Content-Type"]||_headers["content-type"]
        v.headers=JSON.stringify(_headers)
      }
      TWHandler._curAPI=0
      bzComm.postToAppExtension({
        fun:"_postAPIData",
        ps:[v],
        scope:"TWHandler"
      });
    }
  },
  _postAPIData:function(v){
    v.url=_Util._mergeURL(location.protocol+"/"+"/"+location.host,v.url)
    TWHandler._setToken(v)
    bzComm.postToIDE({
      fun:"_attachReqData",
      scope:"_appReqRepHandler",
      ps:[v]
    })
  },
  _setToken:function(v){
    if(v.headers){
      try{
        let r={_tokenHost:BZ._getHostIdx(v.url),tokenValue:""}
        if(r._tokenHost===undefined){
          return
        }
        var h=_Util._strToJson(v.headers)
        let a=_IDE._data._setting.authList.find(x=>x.hostToken==r._tokenHost)
        var ts=a.tokenKey.split(/, */)
        if(ts.find(t=>{
          if(h[t]){
            if(!r.tokenValue){
              r.tokenValue={}
            }
            r.tokenValue[t]=h[t]
          }else{
            return 1
          }
        })){
          return
        }
        
        if(_Util._isSameObj(_aiAuthHandler._getToken(r._tokenHost),r.tokenValue)){
          return
        }
        TWHandler._token=r

        bzComm.postToIDE({fun:"_setToken",scope:"_aiAuthHandler",ps:[r]})
      }catch(e){}
    }
  },
  _bzOnBeforeUnload:function(){
    _bzDomPicker._cancel();
  },
  _setUnload:function(){
    window.onbeforeunload=TWHandler._bzOnBeforeUnload;
    
  },
  _isAfterRequest:function(){
    var v=0,t=60000;
    if(window.BZ && BZ._hasExtension()){
      v= !TWHandler.BZ_sent || TWHandler.BZ_sent<0;
      t=6000;
    }else{
      v=(!TWHandler.BZ_sent || TWHandler.BZ_sent<0) || (BZ.TW && !BZ.TW.XMLHttpRequest.prototype.BZ_Ajax)
    }
    if(!v){
      this._lastAfterRequest=this._lastAfterRequest||Date.now();
      if(Date.now()-this._lastAfterRequest>t){
        this._lastAfterRequest=0
        return 1
      }
    }else{
      this._lastAfterRequest=0
    }
    return v;
  },
  _takeoverOpenWin:function(_win){
    _win=_win||window
    
    _win=_win||window
    if(_win.BZ_PopOpen&&_win.BZ_PopOpen!=_win.open){
      // console.log("3:"+_key)
      return;
    }
    _win.BZ_PopOpen=_win.open;
    _win.open=function(_url,_name,_option,_replace){
      // console.log("BZ open: "+_key)
      if(!TWHandler._isSameDomain(_url) && !window.extensionContent && window.BZ){
        if(!confirm(_bzMessage._system._info._outDomainWarning)){
          return;
        }
      }
      if(_name!="BZ-In-Testing" && !window.BZ){
        var fs=window.document.getElementsByTagName("IFRAME");
        for(var i=0;i<fs.length;i++){
          if(fs[i].name==_name){
            return _win.BZ_PopOpen(_url,_name,_option,_replace);
          }
        }
      }else if(_name=="BZ-In-Testing" || _Util._getDomsByTagAndName("IFRAME",_name).length){
        return _win.BZ_PopOpen(_url,_name,_option,_replace);
      }
      var _pop=_win.BZ_PopOpen(_url,"_"+"self",_option,_replace);

      setTimeout(function(){
        if(_pop&&_pop.closed){
          _win.BZ_PopOpen(_url,"_"+"self",_option,_replace);
        }
      },1000)
      return _pop
    }
  },
  _setAlert:function(_msg){
    if(!window.extensionContent){
      bzComm.postToAppExtension({
        fun:"_setAlert",
        ps:[_msg],
        scope:"TWHandler"
      })
    }else{
      TWHandler._popActual.alert.push(_msg+"");
    }
  },
  _setOnbeforeunload:function(_msg){
    if(_msg){
      if(!window.extensionContent){
        bzComm.postToAppExtension({
          fun:"_setOnbeforeunload",
          ps:[_msg],
          scope:"TWHandler"
        })
      }else{
        TWHandler._popActual.onbeforeunload.push(_msg+"");
      }
    }
  },
  _triggerConfirm:function(_msg){
    if(!window.extensionContent){
      bzComm.postToAppExtension({
        fun:"_triggerConfirm",
        ps:[_msg],
        scope:"TWHandler"
      })
      return true
    }
    var a = TWHandler._popActual.confirm;
    a.push(_msg+"");
    var aa=TWHandler._popExpected.confirm;
    var rv=true;
    if(aa && aa[a.length-1]!==undefined){
      rv=aa.pop().returnValue;
      a.pop();
    }
    return rv;
  },
  _triggerPrompt:function(_msg){
    if(!window.extensionContent){
      bzComm.postToAppExtension({
        fun:"_triggerPrompt",
        ps:[_msg],
        scope:"TWHandler"
      });
      return;
    }
    var a = TWHandler._popActual.prompt;
    a.push(""+_msg);
    var b=TWHandler._popExpected.prompt;
    
    var rv=false;
    
    if(b && b.length){
      rv=b[0].returnValue;
      if(b.length>1){
        b.shift()
      }
    }
    return rv;
  },
  _waitFollowingPop:function(_result,_fun,_time){
    if(TWHandler._popExpected){
      // console.log("has alert setting")

      for(var k in TWHandler._popExpected){
        var v=TWHandler._popExpected[k];
        if(v && v.length){
          _time=_time||0;
          _time+=1000;
          if(_time>2000){
            return _fun();
          }
          return setTimeout(function(){
            _ideTask._addRealtimeInfo(_bzMessage._log._info._checkingPopup)
            TWHandler._waitFollowingPop(_result,_fun,_time)
          },1000);
        }
      }
    }
    _fun();
  },
  _isAfterHashLoad:function(w){
    if(w.location.pathname==TWHandler._lastPageInfo._pathname && (w.location.hash || w.location.href.endsWith("#"))){
      if(w.location.hash==TWHandler._lastPageInfo._hash){
        return true;
      }else if(w.location.hash && $(w.document.body).html()!=TWHandler._lastPageInfo.html){
        return true;
      }else if(Date.now()-TWHandler._lastPageInfo.time>2000){
        return true;
      }
    }
    return false;
  },
  _getPopWinSize:function(h){
    if(window.screenX>0){
      window.moveTo(-7,0);
    }
    var ws=BZ._userHabit.popSize[h],
        w=screen.width-window.outerWidth
    if(!ws){
      ws="height="+screen.availHeight+",top=0,";
      if(window.outerWidth>screen.width*0.7){
        ws+="left=0,width="+screen.width
      }else{
        ws+="left="+window.outerWidth+window.screenX+",width="+(w)
      }
    }else if(ws.match(/^[0-9 x#%]+$/)){
      ws=ws.split("x").map(x=>x.trim())
      if(!ws[1]){
        ws[1]=screen.height
      }
      if(ws[0].includes("%")){
        ws[0]=screen.width*(parseInt(ws[0])/100)
      }
      ws=`width=${ws[0]},height=${ws[1]},top=0,left=${w>ws[0]?window.outerWidth+window.screenX:screen.width-ws[0]}`
    }
    return ws;
  },
  _takeoverAddEventListener:function(){
    if(!EventTarget.prototype._addEventListener){
      let _fun=EventTarget.prototype.addEventListener;
      EventTarget.prototype._addEventListener = _fun
      
      EventTarget.prototype.addEventListener=function(t,f,c){
        if(this==window&&t=="beforeunload"){
          this._addEventListener(t,function(event){
            let play=localStorage.getItem("playModel")
            if(t=="beforeunload"&&play=="play"){
            }else{
              return f(event)
            }
          },c)
        }else{
          console.log("addEventListener:"+t)
          this._addEventListener(t,f,c)
        }
      }
  
    }
  },
  //h:window size,
  _openUrl:function(_enterPointValue,_callBack,h){
    window.$project&&(window.$project.$flag="")
    if(!BZ._isPlaying()&&_IDE._data._curTest){
      setTimeout(function(){
        _CtrlDriver._refreshDom($(".bz-action-list-content")[0])
        $(".bz-action-element .bz-popout").hide()  
      },100)
    }
    if(_enterPointValue){
      _enterPointValue=_ideTask._setCurValue(_enterPointValue)
    }

    try{
      if(!BZ._hasExtension()&&_Util._isBZTWOpened()){
        BZ.TW.document
      }
    }catch(e){
      BZ._closePopWindow()
    }
    if(h===undefined&&!_ideTestManagement._getCurHost()){
      BZ._setStatus("")
      BZ._setHash("settingEnvironment")
      return alert(_bzMessage._system._error._missHost)
    }
    var ws=this._getPopWinSize(h);

    _ideTask._addTWChecker(_finalFun);

    if(!_IDE._alertExtensionRequest()){
      _openURL(_enterPointValue,ws);
    }else if(BZ._isAutoRunning()){
      // console.log("BZ-LOG: No extension issue and stop task!")
      _ideTask._end()
    }
  
    function _finalFun(a,b,c){
      if(_callBack){
        _callBack(a,b,c)
      }
    }

    function _openURL(_enterPointValue,ws){
      console.log("BZ-LOG: open url - "+_enterPointValue)
      if(window.$project){
        $project.$flag=""
      }
      _ideTask._appReady=0

      if(_Util._isBZTWOpened()){
        if(BZ._twInError){
          BZ._twInError=0
          BZ.TW.location.href=_enterPointValue
        }else{
          bzComm._setCmd("document.body.innerHTML='';location.href=='"+_enterPointValue+"'?location.reload():location.href='"+_enterPointValue+"'")
          BZ.TW.focus()
        }
      }else{
        _Util._openBZTW(_enterPointValue,ws);
      }
      _finalFun()
    }  
  },
  _isSameDomain:function(_url){
    if(_url && _url.indexOf("http")!=0 && _url.includes(":/"+"/")){
      return false;
    }
    return !_url || _url.startsWith("javascript:") || (_url.indexOf("http")!=0 && _url.indexOf("/"+"/")!=0) || _url.indexOf(location.origin)==0;
  },
  _checkJQueryEvent:function(e){
    try{
      return $["_"+"data"](e,"events") || {};
    }catch(e){}
    return {};
  }
};
if(window.name=="bz-client"){
  TWHandler._init();
};
var _domRecorder={
  _uploadFileTypes:["avi","bat", "css", "docx", "epub", "gif", "html", "jpg", "js", "json", "odt","ogv","pdf", "png", "rtf", "sh", "txt", "zip"],
  _tmpPath:[],
  _curAPI:0,
  _listenEvents:{
    change: "1",
    dblclick: "1",
    dragDrop: "1",
    click: "1"
  },
  unTmpClass:new Set(),
  _monitorList:[],
  _start:function(){
    bzComm.postToIDE({scope:"_ideTestManagement",fun:"_insertInitRefresh",ps:[location.href]});
    _domRecorder._lastStep=null;
    _domRecorder._refresh();
  },
  _refresh:function(){
    _domRecorder._setEventListenerOnAllDoms();
  },
  _end:function(){
    // _elementMonitor._handleMonitor();
    // _elementMonitor._close();
    _domRecorder._closeObserver();
    _domRecorder._removeEventListener();
    _domRecorder._setBackPopMsg();
    BZ._recording=0;
    
  },
  _observerTime:Date.now(),
  _observer:new MutationObserver(function(_mutations) {
    let _hasNew;
    if(_mutations.find(_mutation=>{
      let a=_mutation.addedNodes[0]
      
      return a&&a.nodeType==1&&!_domRecorder._isBZElement(a)
    })){
      if(_domRecorder._clickInputStep){
        _domRecorder._createRecordAction(_domRecorder._clickInputStep,1)
        _domRecorder._clickInputStep=0
      }
      clearTimeout(_domRecorder._newInsertTrigger);
    }
  }),
  _isBZElement:function(t){
    return t&&($(t).hasClass("BZIgnore")||$(".BZIgnore").find(t).length)
  },
  _handleFileInput:function(){
    $("input[type=file]").off("click",_domRecorder._clickFileFun)
    $("input[type=file]").on("click",_domRecorder._clickFileFun)
  },
  _clickFileFun:function(e){
    if(BZ._isRecording()){
      bzComm.postToIDE({scope:"_domRecorder",fun:"_setClickFileInput"});
      e.stopPropagation()
      e.preventDefault()
      _domRecorder._selectUploadFileOption(this)
    }else if(BZ._isPlaying()){
      e.stopPropagation()
      e.preventDefault()
    }
  },
  _getCurFileData:function(){
    let ds={
          $test:$test||{},
          $module:$module||{},
          $project:$project||{}
        },
        fs=[];
    Object.keys(ds).forEach(x=>{
      for(let k in ds[x]){
        let v=ds[x][k]
        if(_Util._isFileData(v)){
          fs.push(x+"."+k)
        }
      }
    })
    return fs
  },
  _selectUploadFileOption:function(e){
    window._uiSwitch=_CtrlDriver._buildProxy({_uploadFileFrom:"std"});
    
    let fs=_domRecorder._getCurFileData()
    
    if(fs.length){
      _uiSwitch._uploadFileFrom="_exist"
    }
    if(this._domPickerWindow){
      this._domPickerWindow.close()
    }
    let _viewDef={
      _tag:"div",
      _attr:{
        style:"flex-direction: column;display: flex;line-height: 30px;height:350px;font-size:13px;padding:10px;"
      },
      _items:[
        {
          _tag:"div",
          _text:"_bzMessage._action._ifUploadFile"
        },
        //exist file data
        {
          _if:function(){
            return fs.length
          },
          _tag:"label",
          _attr:{
            style:"height: 25px;padding: 8px;line-height: normal;line-height: normal;"
          },
          _items:[
            {
              _tag:"input",
              _attr:{
                style:"margin-right:10px;height: 10px;",
                type:"radio",
                value:"_exist"
              },
              _dataModel:"_uiSwitch._uploadFileFrom"
            },
            {
              _text:"_bzMessage._action._existFileData"
            }
          ]
        },
        {
          _if:function(){
            return _uiSwitch._uploadFileFrom=='_exist'&&fs.length
          },
          _tag:"div",
          _attr:{
            style:"display:flex;"
          },
          _items:[
            {
              _tag:"select",
              _attr:{
                style:"height:25px;width:100%;margin-left:30px;margin-right:10px;"
              },
              _dataModel:"_uiSwitch._uploadUrl",
              _items:[
                {
                  _tag:"option",
                  _attr:{
                    style:"font-size:13px",
                    value:function(d){
                      return '{{'+d._item+'}}'
                    }
                  },
                  _text:function(d){
                    d=d._item
                    let v=eval(d)
                    if(v.constructor==Function){
                      v=_ideDataHandler._getOrgDataSettingFromNamePath(d).url
                    }
                    if(v.constructor==String){
                      d=`${d} (${v})`
                    }
                    return d
                  },
                  _dataRepeat:function(){
                    return fs
                  }
                }
              ]
            }
          ]
        },
        //std files
        {
          _tag:"label",
          _attr:{
            style:"height: 25px;padding: 8px;line-height: normal;"
          },
          _items:[
            {
              _tag:"input",
              _attr:{
                style:"margin-right:10px;height: 10px;",
                type:"radio",
                value:"std"
              },
              _dataModel:"_uiSwitch._uploadFileFrom"
            },
            {
              _text:"_bzMessage._action._uploadInStdFiles"
            }
          ]
        },
        {
          _if:"_uiSwitch._uploadFileFrom=='std'",
          _tag:"div",
          _attr:{
            style:"display:flex;"
          },
          _items:[
            {
              _tag:"select",
              _attr:{
                style:"height:25px;width:100%;margin-left:30px;margin-right:10px;"
              },
              _dataModel:"_uiSwitch._uploadUrl",
              _items:[
                {
                  _tag:"option",
                  _attr:{
                    style:"font-size:13px",
                    value:function(d){
                      return d._item
                    }
                  },
                  _text:function(d){
                    return d._item
                  },
                  _dataRepeat:function(){
                    let vs=_domRecorder._uploadFileTypes
                    return vs.map(x=>'example.'+x)
                  }
                }
              ]
            }
          ]
        },
        //url
        {
          _tag:"label",
          _attr:{
            style:"height: 25px;padding: 8px;line-height: normal;"
          },
          _items:[
            {
              _tag:"input",
              _attr:{
                style:"margin-right:10px;height: 10px;",
                type:"radio",
                value:"url"
              },
              _dataModel:"_uiSwitch._uploadFileFrom"
            },
            {
              _text:"_bzMessage._action._uploadInUrlFile"
            }
          ]
        },
        {
          _if:function(){
            let r=_uiSwitch._uploadFileFrom=='url'
            if(r&&!_uiSwitch._uploadUrl){
              _uiSwitch._uploadUrl="/"+"/"
            }
            return r
          },
          _tag:"div",
          _attr:{
            style:"display:flex;"
          },
          _items:[
            {
              _tag:"input",
              _attr:{
                style:"flex:1;height:25px;margin-left:30px;margin-right:10px;"
              },
              _dataModel:"_uiSwitch._uploadUrl",
            }
          ]
        },
        {
          _tag:"label",
          _attr:{
            style:"height: 25px;padding: 8px;line-height: normal;"
          },
          _items:[
            {
              _tag:"input",
              _attr:{
                style:"margin-right:10px;height: 10px;",
                type:"radio",
                value:"local"
              },
              _dataModel:"_uiSwitch._uploadFileFrom"
            },
            {
              _text:"_bzMessage._action._uploadFromDesk"
            }
          ]
        },
        {
          _if:"_uiSwitch._uploadUrl&&_uiSwitch._uploadFileFrom!='local'",
          _tag:"div",
          _items:[
            {
              _if:"_uiSwitch._uploadUrl&&_uiSwitch._uploadUrl.match(/[.](docx|html|odt|epub|avi|pdf|rtf|zip)$/)",
              _tag:"a",
              _attr:{
                style:"cursor:pointer;",
                href:"_uiSwitch._uploadUrl",
                target:"_"+"blank"
              },
              _text:"_bzMessage._action._reviewByDownload"
            },
            {
              _if:"_uiSwitch._uploadUrl&&_uiSwitch._uploadUrl.endsWith('.ogv')",
              _tag:"video",
              _attr:{
                width:200,
                controls:1,
                style:"margin-top:5px;"
              },
              _items:[
                {
                  _tag:"source",
                  _attr:{
                    src:"_uiSwitch._uploadUrl"
                  },
                  _text:"Your browser does not support HTML video."
                }
              ]
            },
            {
              _if:"_uiSwitch._uploadUrl&&_uiSwitch._uploadUrl.match(/[.](png|jpg|gif)$/)",
              _tag:"img",
              _attr:{
                onerror:"this.style.display='none'",
                onload:"this.style.display='block'",
                src:function(){
                  return SERVER_HOST.replace(/^https?:/,"")+"/file/"+_uiSwitch._uploadUrl
                },
                style:"max-width:50px;max-height:50px;",
                onmouseover:"this.style.position='fixed';this.style.maxWidth='unset';this.style.maxHeight='unset';",
                onmouseout:"this.style.position='unset';this.style.maxWidth='50px';this.style.maxHeight='50px';",
              }
            },
            {
              _if:function(){
                let s=_uiSwitch._uploadUrl
                if(s&&s.match(/[.](bat|js|sh|css|json|txt)$/)){
                  $.get(s,function(d){
                    _uiSwitch._tmpContent=d
                  })
                  return 1
                }
              },
              _tag:"div",
              _attr:{
                style:"line-height:20px;padding:10px 0;"
              },
              _text:function(){
                if(_uiSwitch._uploadUrl.endsWith(".json")){
                  return JSON.stringify(_uiSwitch._tmpContent,0,2)
                }else{
                  return _uiSwitch._tmpContent
                }
              }
            }
          ]
        },
        {
          _tag:"div",
          _attr:{
            style:"display:flex;justify-content: space-between;margin-top:10px;bottom: 10px;position: fixed;width: calc(100% - 40px);border-top: var(--bz-border);padding: 10px 10px 0 10px;"
          },
          _items:[
            {
              _tag:"button",
              _attr:{
                class:"btn btn-primary",
              },
              _text:"_bzMessage._method._continue",
              _jqext:{
                click:function(c){
                  if(_uiSwitch._uploadFileFrom!="local"&&!_uiSwitch._uploadUrl){
                    return alert(_bzMessage._action._missingUploadFile)
                  }else if(_uiSwitch._uploadFileFrom=="local"){
                    _uiSwitch._uploadUrl=""
                    $(e).click()
                  }else{
                    let _url=_uiSwitch._uploadUrl
                    if(_uiSwitch._uploadFileFrom=="_exist"){
                      _url=eval(_url.replace(/[\{\}]/g,""))
                    }
                    if(_url.constructor==String){
                      _Util._setUrlFileToInput(_url,e)
                    }else{
                      $util.triggerChangeEvent(e,_url,1);
                    }
                  }
                  setTimeout(()=>{
                    _uiSwitch._uploadFileFrom=""
                    this.ownerDocument.defaultView.close()
                  },100)
                }
              }
            },
            {
              _tag:"button",
              _attr:{
                class:"btn btn-secondary",
              },
              _text:"_bzMessage._method._cancel",
              _jqext:{
                click:function(c){
                  _uiSwitch._uploadFileFrom=0
                  _uiSwitch._uploadUrl=0
                  this.ownerDocument.defaultView.close()
                }
              }
            }
          ]
        }
      ]
    }
    this._domPickerWindow = _Util._popWin("","_selectFile",null,400,400,_viewDef,_bzMessage._action._selectUploadFile);

    // _Util._confirmMessage(,[{
    //   _title:_bzMessage._method._continue,
    //   _style:"background-color: #0069FF !important;color: #FFF !important;border: 1px solid #999 !important;border-radius: 6px !important;padding: 6px 10px !important;font-size:15px !important;",
    //   _click:function(c){
    //     if(_uiSwitch._uploadFileFrom!="local"&&!_uiSwitch._uploadUrl){
    //       return alert(_bzMessage._action._missingUploadFile)
    //     }else if(_uiSwitch._uploadFileFrom=="local"){
    //       _uiSwitch._uploadUrl=""
    //       $(e).click()
    //     }else{
    //       let _url=_uiSwitch._uploadUrl
    //       if(_uiSwitch._uploadFileFrom=="_exist"){
    //         _url=eval(_url.replace(/[\{\}]/g,""))
    //       }
    //       if(_url.constructor==String){
    //         _Util._setUrlFileToInput(_url,e)
    //       }else{
    //         $util.triggerChangeEvent(e,_url,1);
    //       }
    //     }
    //     setTimeout(()=>{
    //       _uiSwitch._uploadFileFrom=""
    //     },100)
    //     c._ctrl._close()
    //   }
    // },{
    //   _title:_bzMessage._method._cancel,
    //   _style:"background-color: #FFF !important;color: #000 !important;float: right !important;border: 1px solid #999 !important;border-radius: 6px !important;padding: 6px 10px !important;font-size:15px !important;",
    //   _click:function(c){
    //     _uiSwitch._uploadFileFrom=0
    //     _uiSwitch._uploadUrl=0
        
    //     c._ctrl._close()
    //   }
    // }],0,0,1,0,1)
    // setTimeout(()=>{
    //   $(".bz-modal-window").css({height:"480px","font-size":"11px"})
    // },20)
  },
  _setClickFileInput:function(){
    _domRecorder._lastClickFileInput=Date.now()
    if(_domRecorder._lastNewActionTime&&_domRecorder._lastClickFileInput-_domRecorder._lastNewActionTime.t<200){
      let a=_domRecorder._lastNewActionTime.a,
          g=_ideActionManagement._getCurGroup(a),
          _idx=_ideActionManagement._getCurIdx(a);

      _ideTestManagement._removeAction(_IDE._data._curTest,_domRecorder._lastNewActionTime.a)
      a=_ideActionManagement._findActionByPath(_idx)
      if(!a){
        a=g.actions._last()||g
      }
      BZ._setHash(a)
    }
  },
  _setBackPopMsg:function(){
    if(window.extensionContent){
      return window.postMessage({bz:1,_setBackPopMsg:1}, "*");
    }
    _doIt(window)
    function _doIt(w){
      try{
        w.alert=w.BZ_Recording_Alert;
        w.confirm=w.BZ_Recording_Confirm;
        w.prompt=w.BZ_Recording_Prompt;
        
        if(w.BZ_Recording_Onbeforeunload){
          w.onbeforeunload= w.BZ_Recording_Onbeforeunload;
        }
        
        w.BZ_Recording_Alert=w.BZ_Recording_Confirm=w.BZ_Recording_Confirm=0
        
        if(w.XMLHttpRequest.prototype.BZ_Ajax){
          w.eval("window.XMLHttpRequest.prototype.open=window.XMLHttpRequest.prototype.BZ_Ajax");
          w.eval("window.XMLHttpRequest.prototype.send=window.XMLHttpRequest.prototype.BZ_AjaxSend");
          w.eval("window.XMLHttpRequest.prototype.setRequestHeader=window.XMLHttpRequest.prototype.BZ_SetHeader");
        }
      }catch(e){
      }
    }
  },
  _closeObserver:function(){
    try{
      this._observer.disconnect();
    }catch(e){}
    this._monitorList=[];
  },
  _setEventListenerOnAllDoms:function(){
    _domRecorder._setDomEventListener(document)
  },
  _setDomEventListener:function(_document){
    let b=_document
    if(b._inListening){
      return;
    }
    b._inListening=true;
    if(window.extensionContent){
      bzComm.postToApp({
        fun:"_takeoverPopMsg",
        scope:"_domRecorder"
      }, "*");
    }else{
      _domRecorder._takeoverPopMsg(b.defaultView);
    }
    _domRecorder._removeDomEventListener(_document);
    _domRecorder._monitor(b);
    _domRecorder._handleFileInput();

    $(b).on("mousedown","*",_domRecorder._bindFun);
    
    $(b).on("mouseup","*",_domRecorder._bindFun);
    $(b).on("mousemove","*",_domRecorder._bindFun);
    $(b).on("dblclick","*",_domRecorder._bindFun);
    $(b).on("click","*",_domRecorder._bindFun);
    $(b).on("keyup","*",_domRecorder._bindFun);
    $(b).on("keydown","*",_domRecorder._bindKeydown);
    $(b).on("change","input,textarea,select",_domRecorder._bindFun);
    $(b).on("focus","input,textarea,select",_domRecorder._bindFocus);
    $(b).on("blur","[contenteditable=true]",_domRecorder._bindContentEditable);

    // for(var k in _domRecorder._listenEvents){
    //   if (k=="click") {
    //     $(_document).find("*").not("style,script").bind("mousedown",_domRecorder._bindFun);
    //   }else if (k=="mousedown" && _domRecorder._listenEvents.click) {
    //     continue;
    //   }else if (k=="focus") {
    //     continue;
    //   }else if(k=="dragDrop"){
    //     $(_document).find("*").not("style,script").bind("mouseup",_domRecorder._bindFun);
    //     $(_document).find("*").not("style,script").bind("mousemove",_domRecorder._bindFun);
    //     if(!_domRecorder._listenEvents.mousedown && !_domRecorder._listenEvents.click){
    //       $(_document).find("*").bind("mousedown",_domRecorder._bindFun);
    //     }
    //     continue;
    //   }else if(k=="change"){
    //     $(_document).find("input,textarea,select").bind(k,_domRecorder._bindFun);
    //   }else{
    //     $(_document).find("*").not("style,script").bind(k,_domRecorder._bindFun);
    //   }
    // }
    // $(_document).find("*").not("style,script").bind("keyup",_domRecorder._bindFun);
    // $(_document).find("*").not("style,script").bind("keydown",_domRecorder._bindKeydown);
    /*
    let iframes=$(_document).find("IFRAME")
    if(iframes[0]){
      iframes=iframes.toArray();
      iframes.forEach(function(v){
        if(!v.src){
          _domRecorder._setDomEventListener(v.contentDocument)
        }
      })
    }
    */
  },
  _buildTmpPath:function(o,_last){
    _last=_last||[]
    if(_last[0]==o){
      return _last
    }
    var _tmpPath=[]
    while(o && o.tagName!="BODY"){
      _tmpPath.push(o)
      o=o.parentNode||o.host
    }
    return _tmpPath
  },
  _retrievePath:function(p,x,y,_ignoreTxt){
    var _removedElement=[],_body
    if(p.length){
      delete p[0].bzTxtElement
      _body=p[0].ownerDocument.body
    }else{
      return
    }
    if(!_cssHandler._isInShadowDom(p[0])){
      let _lastPath=p[0].bzTmp
      while(p[0]&&!$(p[0].ownerDocument).find(p[0]).length){
        _removedElement.push(p.shift())
        if(!p.length){
          p=this._lastPaths
          _removedElement=[]
        }
      }
      if(!p[0]){
        return {
          _elementPath:_lastPath,
          W:{
            HH:[],
            LL:{}
          }
        }
      }
    }else{
      while(!p[0].getBoundingClientRect().width){
        p.shift()
      }
    }
    if(!p.length){
      p.push(_body)
    }
    let pp=0;
    if(p[0].tagName=="CANVAS"){
      p[0].bzTxtElement=TWHandler._getCanvasTextElementByMousePos(p[0],x,y,_ignoreTxt)
      pp=p[0]
    }
    p[0].bzShortCut=0
    p=_cssHandler._findPath(p[0],1,_removedElement.length?2:0);
    if(_removedElement.length){
      var i=p._elementPath.pop();
      if(!$.isNumeric(i)){
        p._elementPath.push(i)
      }
      var e=_cssHandler._findCellElement(_removedElement[0]);
      var i=_removedElement.indexOf(e);
      _removedElement.splice(i+1)
      while(_removedElement.length){
        if(_removedElement[0]==e){
          break
        }
        _removedElement.shift()
      }
      while(_removedElement.length){
        e=_removedElement.pop()
        var d={e:e,oe:e,ps:[],ee:1,_headers:[]};
        _cssHandler._findAttributes(d)
        d=d._result._main
        if(d){
          d=d.join("")
        }else{
          d=e.tagName
        }
        p._elementPath.push(d);
      }
      if(e&&!_cssHandler._isInput(e)){
        var w=_Util._filterTxt($util.getElementText(e))
        if(w){
          p._elementPath[p._elementPath.length-1]+=":Contains("+w+")"
        }
      }
      p._elementPath.push(0)
    }

    return p;
  },
  _takeoverPopMsg:function(){
    let w=window
    try{
      var _beforeunload=w.onbeforeunload || (_checkJQueryEvent().beforeunload?_checkJQueryEvent().beforeunload[0].handler:null);
      if((!w.BZ_Recording_Onbeforeunload && _beforeunload) || (w.BZ_Recording_Onbeforeunload_fun && w.BZ_Recording_Onbeforeunload_fun!=_beforeunload)){
        w.BZ_Recording_Onbeforeunload=_beforeunload;
        if(_beforeunload){
          _beforeunload=function(){
            var _msg=w.BZ_Recording_Onbeforeunload();
            if(_msg){
              _domRecorder._curPopMsg={_type:"onbeforeunload",_msg:_msg,_time:Date.now()};
              var r=_domRecorder._curPopMsg._returnValue=_domRecorder._curPopMsg._msg;
              _domRecorder._setPopMsg();
              return r;
            }
          }
          if(w.onbeforeunload){
            w.onbeforeunload=_beforeunload;
          }else{
            _checkJQueryEvent().beforeunload[0].handler=_beforeunload;
          }
        }
        w.BZ_Recording_Onbeforeunload_fun=_beforeunload;
      }
      TWHandler._takeoverCanvas(w)
      
      if(!w.BZ_Recording_Alert||w.BZ_Recording_Alert==w.alert){
        w.BZ_Recording_Alert=w.alert
        w.alert=function(m){
          _domRecorder._curPopMsg={_type:"alert",_msg:m,_time:Date.now()};
          _domRecorder._setPopMsg();
          w.BZ_Recording_Alert(m);
        }
      }
      if(!w.BZ_Recording_Confirm||w.BZ_Recording_Confirm==w.confirm){
        w.BZ_Recording_Confirm=w.confirm
        w.confirm=function(m){
          _domRecorder._curPopMsg={_type:"confirm",_msg:m,_time:Date.now()};
          var r=_domRecorder._curPopMsg._returnValue=w.BZ_Recording_Confirm(m);
          _domRecorder._setPopMsg();
          return r
        }
      }
      if(!w.BZ_Recording_Prompt||w.BZ_Recording_Prompt==w.prompt){
        w.BZ_Recording_Prompt=w.prompt
        w.prompt=function(m){
          _domRecorder._curPopMsg={_type:"prompt",_msg:m,_time:Date.now()};
          var r=_domRecorder._curPopMsg._returnValue=w.BZ_Recording_Prompt(m);
          _domRecorder._setPopMsg();
          return r
        }
      }
    }catch(e){}
    function _checkJQueryEvent(e){
      try{
        return $["_"+"data"](e,"events") || {};
      }catch(e){}
      return {};
    }
  },
  _setPopMsg:function(_popMsg){
    _popMsg=_popMsg||_domRecorder._curPopMsg;
    _domRecorder._curPopMsg=null;
    if(!bzComm._isIDE()){
      bzComm.postToIDE({
        fun:"_setPopMsg",
        ps:[_popMsg],
        scope:"_domRecorder"
      });
    }else{
      _domRecorder._curPopMsg=_popMsg;
    }
  },
  _showSetAlert:function(v){
    _Util._confirmMessage({
      _tag:"div",
      _data:v,
      _items:[
        {
          _tag:"div",_attr:{"class":"input-group"},
          _items:[
            {
              _tag:"div",_attr:{"class":"input-group-addon"},
              _items:[
                {
                  _tag:"label",
                  _text:"_bzMessage._action._popType"
                }
              ]
            },
            {
              _tag:"select",
              _attr:{
                "disabled":"!BZ._isCheckout()",
                "class":"form-control",
              },
              _dataModel:"_data.popType",
              _items:[
                {
                 _tag:"option",
                  _attr:{
                    value:"_data._item"
                  },
                  _text:"_data._item",
                  _dataRepeat:["","alert","confirm","prompt","onbeforeunload"]
                }
              ]
            }
          ]
        },
        //Compare
        {
          _tag:"div",_attr:{"class":"input-group"},
          _items:[
            {
              _tag:"div",_attr:{"class":"input-group-addon"},
              _items:[
                {
                  _tag:"label",_text:"_bzMessage._action._compare"
                }
              ]
            },
            {
              _tag:"select",
              _attr:{
                "disabled":"!BZ._isCheckout()",
                "class":"form-control"
              },
              _items:[
                {
                  _tag:"option",
                  _attr:{
                    value:"_data._item"
                  },
                  _text:function(d){
                    return d._item.includes("clude")?_bzMessage._common[d._item]:d._item;
                  },
                  _dataRepeat:["==",">",">=","<","<=","!=","regex","include","exclude"]
                }
              ],
              _dataModel:"_data.compareMark"
            }
          ]
        },
        {
          _tag:"div",
          _attr:{
            "class":"input-group"
          },
          _items:[
            {
              _tag:"div",_attr:{"class":"input-group-addon"},
              _items:[
                {
                  _tag:"label",
                  _text:"_bzMessage._action._expectation"
                },
              ]
            },
            //expectation value
            {
              _tag:"input",
              _attr:{
                "class":"form-control",
                placeholder:"_bzMessage._action._dataSizeWarning"
              },
              _dataModel:"_data.expectation"
            }
          ]
        },
        //return value
        {
          _if:function(d){
            return d.popType=='confirm' || d.popType=='prompt';
          },
          _tag:"div",_attr:{"class":"input-group"},
          _items:[
            {
              _tag:"div",_attr:{"class":"input-group-addon"},
              _items:[
                {
                  _tag:"label",
                  _text:"_bzMessage._action._returnValue"
                }
              ]
            },
            {
              _tag:"input",
              _attr:{
                "disabled":"!BZ._isCheckout()",
                type:"text",
                "class":"form-control"
              },
              _dataModel:"_data.returnValue"
            }
          ]
        }
      ]
    },[{
      _title:_bzMessage._method._close,
      _click:function(c){
        c._ctrl._close()
        _ideTestManagement._save()
      }
    }],0,0,1,0,1)
  },
  _isIgnoreClickElement:function(e){
    return ["INPUT","TEXTAREA","SELECT"].includes(e.tagName) && !["reset","submit","button","image"].includes(e.type)
  },
  _monitorSetInputActions:{
    _mergeForSetAction:function(e,a){
      let _this=this
      if(e._coverChkRadio){
        setTimeout(()=>{
          a._txt=e._coverChkRadio.checked&&"on"
          _buildMergeData([a],e._coverChkRadio)
        },100)
      }else if(!_cssHandler._isCover(e)&&_this._isInMonitoredScope(e)&&(a._type=="click"||a._type=="change")){
        let as=_this._curMonitorElement._actions
        if(as.length==2){
          if(a._type!="click"||as[1]._type=="click"){
            _setLastAction(a)
            return
          }
        }else if(as.length>2){
          _setLastAction(a)
          return
        }
        as.push(a)
        if(a._type=="click"){
          _Util._clearPreEventElements()
          _this._curMonitorElement._diffList=[]
          clearTimeout(_domRecorder._mergeSetActionTime)
          _Util._preTriggerEvent()

          _domRecorder._mergeSetActionTime=setTimeout(()=>{
            _doIt(as)
          },500)
        }
      }else{
        _setLastAction(a)
      }
            
      function _doIt(as){
        if(_Util._isHidden(_this._curMonitorElement._element)&&_domRecorder._lastAction._tmpUrl==location.href){
          let _targetElement=as[0]._element
          if(_Util._isHidden(_targetElement)||(_targetElement.innerText||_targetElement.value||"").toLowerCase().trim().includes((a._element.innerText||a._element.value||"").toLowerCase().trim())){
            _buildMergeData(as,_targetElement)
          }
          _this._lastAction=_this._curMonitorElement=0
        }else{
          _this._lastAction=a
          _this._curMonitorElement._actions=[a]
        }
      }

      function _buildMergeData(as,_targetElement){
        as={
          _actions:as,
          _data:{
            _value:a._txt,
            _elementType:_targetElement.type||_targetElement.tagName,
          }
        }
        
        if(_innerWin._data._dataBind._showDataBind&&_targetElement){
          if(_Util._isHidden(_targetElement)){
            let ee=$(":text("+a._txt+")")
            if(ee.length==1){
              _targetElement=ee[0]||_targetElement
            }else{
              _targetElement=_Util._getClosestElement(a._element,a._element,ee)||ee[0]
            }
          }

          as._data._inputPath=_cssHandler._findInputPath(_targetElement)
          
          let p=_ideDataBind._getBindData(_targetElement)
          if(p){
            if(p.includes("$")){
              p="{{"+p+"}}"
            }
            as._data._name=p
          }
        }
        if(!window.extensionContent){
          _ideActionManagement._mergeToSetAction(as);
        }else{
          bzComm.postToIDE({ps: [as],scope:"_ideActionManagement",fun:"_mergeToSetAction"});
        }
        _Util._preTriggerEvent()
      }

      function _setLastAction(a,_noclear){
        if(a._type=="click"){
          _this._lastAction=a
        }else{
          if(Date.now()-_domRecorder._monitorSetInputActions._chkTime>300){
            _Util._clearPreEventElements()
          }
          _this._lastAction=0
        }
        _this._curMonitorElement=0
      }
    },
    _chkElementUpdate:function(e){
      if(this._isInMonitoredScope(e)){
        return
      }

      let ds=_Util._getDiffAfterTriggerEvent(1,1)
      this._chkTime=Date.now()
      if(ds.includes(e)&&this._lastAction){
        this._curMonitorElement={
          _element:e,
          _diffList:ds,
          _actions:[this._lastAction]
        }
      }else{
        this._curMonitorElement=0
        this._lastAction=0
      }
    },
    _isInMonitoredScope:function(e){
      return this._curMonitorElement&&this._curMonitorElement._diffList.includes(e)
    }
  },
  _recordEvent:function(_action,_value){
    // if(_domRecorder._lastChkAction){
    //   if(_domRecorder._lastChkAction._type==_action.type&&_domRecorder._lastChkAction._target==_action.target){
    //     return
    //   }
    // }
    // _domRecorder._lastChkAction={
    //   _type:_action.type,
    //   _target:_action.target
    // }
    if(!_domRecorder._hiddenItems){
      _domRecorder._hiddenItems=_Util._findAllHiddenElements()
    }else{
      let v=_Util._findAllHiddenElements()
      if(v.length>_domRecorder._hiddenItems.length){
        _domRecorder._hiddenItems=v
      }
    }
    if(_action.type=="mousemove"&&!_action.target._coverChkRadio&&!_Util._isStdInputElement(_action.target)&&!_Util._isInContentEditable(_action.target)){
      _action.target._coverChkRadio=_cssHandler._findChkRadio(_action.target)
    }

    var _element=_action.currentTarget;
    if(["mousedown"].includes(_action.type)){
      _domRecorder._monitorSetInputActions._chkElementUpdate(_element)
    }

    if(_action.type=="change"){
      _element=_action.target;
      if(_element.type=="hidden"){
        return;
      }
    }
    _Util._removeLinkTarget(_element);

    if(_cssHandler._isInput(_element) && !_element.readOnly && !$("#BZ_Win").find(_element).length && "focusin"==_action.type){
      // setTimeout(function(){
        // _ideDataBind._showMe(_element)
      // },100);
      return
    }else if(_Util._isInContentEditable(_element) && !$("#BZ_Win").find(_element).length && "mousedown"==_action.type){
      // setTimeout(function(){
        // _ideDataBind._showMe(_element)
      // },100);
    }else if(!$(BZ.TW.document).find(".BZIgnore").find(_element).length){
      if(_action.type=="blur" && !_domRecorder._typed){
        return;
      }
    }
    //ignore tab on input/select
    var _keyCode=_Util._checkKeycode(_action)
    if(_keyCode==9 && ["A","BUTTON","INPUT","SELECT","TEXTAREA"].includes(_element.tagName)){
      return
    }else if([40,38,39,37].includes(_keyCode) && ["SELECT","TEXTAREA"].includes(_element.tagName)){
      return
    // }else if(13==_keyCode && ["TEXTAREA"].includes(_element.tagName)){
    //   return 
    }
    var _paths;
    if(!this._lastPaths || this._lastPaths[0]!=_element){
      this._lastPaths=_paths=_domRecorder._buildTmpPath(_element);
    }else{
      _paths=this._lastPaths
    }

    if(["click","dblclick","mousedown"].includes(_action.type) && this._isIgnoreClickElement(_element)){
      if(_element.type=="file"){
        console.log("click file")
      }else if(_element.tagName!="SELECT"){
        this._lastStep._action=_action.type=="mousedown"?"click":_action.type;
        this._clickInputStep=this._lastStep
      }
      this._lastStep=0
      return;
    }

    var _step={
      _element:_element,
      _type:_ideActionData._type._triggerEvent,
      _paths:_paths,
      _action:_action.type,
      _ctrl:_action.ctrlKey,
      _alt:_action.altKey,
      _code:_keyCode,
      _char:_Util._checkCharcode(_action),
      _shift:_action.shiftKey,
      _value:_value,
      _button:_action.buttons||_action.button,
      _pageX:_action.pageX,
      _pageY:_action.pageY,
      _time:Date.now(),
      _tmpUrl:BZ.TW.location.href,
      _domXY:_Util._getDomXY(_element),
      _keyName:_action.key
    };

    if(_action.type=="mouseup"){
      if(!this._lastStep){
      }else if(this._listenEvents.dragDrop && this._lastStep._inDragdrop){
        _step._element=this._lastStep._element;
        _step._paths=this._lastStep._paths;
        _step._action="dragdrop";
        _step._orgPath=this._lastStep._orgPath;
        _step._tmpUrl=this._lastStep._tmpUrl;
        _step._startPos=_domRecorder._mousedownStep._domXY
        _domRecorder._createRecordAction(_step);
        this._lastStep=_step
      }else if(this._lastStep._action=="mousemove"){
        this._lastStep._action="click";
        _domRecorder._createRecordAction(this._lastStep);
        this._lastStep=0
      }
      return;
    }
    var _this=this;
    if (_action.type=="mousedown") {
      this._lastStep=_domRecorder._mousedownStep=_step;
      _step._orgPath=_domRecorder._retrievePath(_step._paths,_action.pageX,_action.pageY)
      return;
    }else if(_action.type=="mousemove"){
      if(!_step._button){
        if(this._lastStep && this._lastStep._action=="mousedown"){
          if(this._lastStep._element.draggable && (Math.abs(_step._pageX-this._lastStep._pageX)>10||Math.abs(_step._pageY-this._lastStep._pageY)>10)){
            this._lastStep._action="dragdrop";
            this._lastStep._pageX=_action.clientX
            this._lastStep._pageY=_action.clientY
            this._lastStep._targetElement=_Util._getElementByXY(this._lastStep._element.ownerDocument,_action.clientX,_action.clientY,this._lastStep._element)
            if(this._lastStep._targetElement){
              this._lastStep._targetElement=_cssHandler._findPath(this._lastStep._targetElement)
            }
          }else{
            this._lastStep._action="click";
          }
          _domRecorder._createRecordAction(this._lastStep);
          this._lastStep=0
        }else{
          this._lastStep=_step;
        }
      }else{
        if(this._lastStep && this._lastStep._element==_step._element && (this._lastStep._domXY.x!=_step._domXY.x || this._lastStep._domXY.y!=_step._domXY.y)){
          this._lastStep._inDragdrop=1
        }
      }
      return;
    }else if(_action.type=="click"){
      if(!this._lastStep){
        return
      }else if(this._lastStep._action=="dragdrop"){
        this._lastStep=0;
        return;
      }
      
      if(this._lastStep._action!=="mousedown"){
        return _domRecorder._createRecordAction(_step);
        /*
        var _tmpClick=_step;
        return setTimeout(function(){
          _domRecorder._createRecordAction(_tmpClick);
        },100)
        */
      }else if(this._lastStep && this._lastStep._action=="mousedown"){
        if((_action.pageX||_action.pageY)&&(Math.abs(_action.pageX-_domRecorder._lastStep._pageX)>50||Math.abs(_action.pageY-_domRecorder._lastStep._pageY)>50)){
          this._lastStep._action="dragdrop"
          this._lastStep._pageX=_action.pageX
          this._lastStep._pageY=_action.pageY
          if(this._lastStep._element.tagName=="CANVAS"){
            let _ignoreTxt=_descAnalysis._retrieveTextForElementPathItem(this._lastStep._orgPath._elementPath)
            let ee=_domRecorder._retrievePath(_step._paths,_action.pageX,_action.pageY,_ignoreTxt)
            if(ee){
              this._lastStep._targetElement=ee._elementPath
            }
          }
        }else{
          this._lastStep._action="click"
        }
        _domRecorder._createRecordAction(_domRecorder._lastStep);
        this._lastStep=0;
        return;
      }
    }
    if(!(this._lastStep && this._lastStep._action=="mousedown" && _step._element!=this._lastStep._element)){
      this._lastStep=_step;
    }
    _domRecorder._createRecordAction(_step);
  },
  _setPopInfo:function(_popMsg,a){
    if(!_popMsg){
      return;
    }
    a=a||_IDE._data._curAction;
    if(a){
      if(!a.event.popType){
        a.event.popType=_popMsg._type;
        a.expectation=_popMsg._msg;
        a.event.returnValue=_popMsg._returnValue;
        a.event.popFollow=""
      }else{
        if(!a.event.alerts){
          a.event.alerts=[]
          a.event.alerts.push({
            popType:a.event.popType,
            expectation:a.expectation,
            returnValue:a.event.returnValue,
            popFollow:""
          })
        }
        a.event.alerts.push({
          popType:_popMsg._type,
          expectation:_popMsg._msg,
          returnValue:_popMsg._returnValue,
          popFollow:""
        })
      }
    }
  },
  _insertHoverAction:function(e){
    if(_inHidden(e)){
      let p=e.parentNode,ee
      while(_inHidden(p)){
        e=p
        p=e.parentNode
      }
      if(!p||p.tagName=="BODY"){
        return
      }

      for(let o of p.children){
        if(o!=e&&!_Util._isIgnoreElement(o)){
          if(!ee||_Util._getElementContentText(o)){
            ee=o
          }
        }else{
          break
        }
      }
      ee=ee||p
      if(_domRecorder._lastElement==(ee)){
        return
      }
      if(_cssHandler._findHoverCssByElement(ee).length){
        let a={
          type:1,
          element:_cssHandler._findPath(ee),
          event:{
            type:"mouse",
            action:"hover",
          }
        }

  
        _domRecorder._sendData(a)
      }
    }

    function _inHidden(o){
      return _domRecorder._hiddenItems.includes(o)||$(_domRecorder._hiddenItems).find(o).length
    }
  },
  _addData:function(d){
    if(_isIgnoreElement(d._element,d._action)){
      return
    }
    let ld=_domRecorder._lastData
    if(!BZ._autoRecording && ld && ld._element==d._element && ld._action==d._action && d._action=="click"&&Date.now()-ld._time<200){
      return
    }else{
      _domRecorder._lastData={_element:d._element,_action:d._action,_time:Date.now()}
    }
    if(d._action=="change"){
      _domRecorder._typed=0;
    }
    if(!d._orgPath){
      d._orgPath=_domRecorder._retrievePath(d._paths,d._pageX,d._pageY);
      if(!d._orgPath){
        return
      }
    }

    var a={
      "type":d._type,
      "element":d._orgPath._elementPath||d._orgPath.element||d._orgPath,
      // qpath:_Util._getQuickPath(d._element),
      // css:d._orgPath.W||d._orgPath.css,
      event:{
        type:["change","focus","blur"].indexOf(d._action)>=0?d._action:d._action.indexOf("key")==0?"key":"mouse",
        ctrl:d._ctrl,
        alt:d._alt,
        shift:d._shift,
        button:d._button,
        x:d._pageX,
        y:d._pageY,
        keyCode:d._code,
        charCode:d._char,
        _customize:d._element._customize,
        value:BZ._autoRecording?d._value:_domActionTask._curValueDataBind||d._value
      },
      _tmpUrl:d._tmpUrl,
      _inUpload:d._inUpload,
      _uploadFile:d._uploadFile,
      _uploadUrl:d._uploadUrl
    };
    if(_isComElement(a.element)){
      let tt=_getComTarget(d._element)
      let tw=_descAnalysis._retrieveTextForElementPathItem(a.element)
      a.event.type="change"
      if(!tt){
        a.event.value="{{$parameter."+_glossaryHandler._getVariableName(tw)+"}}"
      }else if(tt.type=="radio"){
        a.event.value=tw
      }else{
        a.event.value="true"
      }
    }else if(d._action=="click"){
      _ideDataBind._bindDataOnElement(a,"element")
    }
    //It is in blank IFRAME
    if(d._element.ownerDocument!==document&&!a.element[1].includes("IFRAME")){
      a.element.splice(1,0,"IFRAME:blank("+_identifyIFrameHandler._getBlankIFrameID(d._element.ownerDocument.defaultView)+")")
    }
    
    if(d._element.bzTxtElement){
      a.offset=d._element.bzTxtElement.offset
      delete d._element.bzTxtElement
    }
    
    if(d._targetElement){
      a.event.element=d._targetElement
      if(a.offset){
        a.event.offset=a.offset
        delete a.offset//={x:0,y:0,origin:"mc"}
      }
    }
    if(d._action=="dragdrop"&&d._startPos&&d._domXY){
      a.event.way=Math.abs(d._startPos.x-d._domXY.x)>Math.abs(d._startPos.y-d._domXY.y)?"H":"V"
    }
    if(!BZ._autoRecording){
      _domActionTask._curValueDataBind=0;
    }
    _domRecorder._setPopInfo(this._curPopMsg,a);
    this._curPopMsg=0;
    
    if(d._action=="change" && d._element.type!="file"){
      a.event.autoBlur="on";
    }else if(d._action=="keyup"){
      a.event.action="group";
      a.event.keyName=d._keyName
      delete a.event.value;
    }
    if(d._button==2){
      a.event.action="click";
    }else if (!["keyup","change","focus","blur"].includes(d._action)) {
      a.event.action=d._action;
    }
    
    if(d._element.tagName=="CANVAS"&&a.event.action=="click"&&!_descAnalysis._retrieveTextForElementPathItem(a.element)){
      
    }
    
    _ideDataBind._bindDataOnElement(a,"element")
    _domRecorder._lastAction=a;
    _domRecorder._insertHoverAction(d._element)
    _domRecorder._lastElement=d._element;
    _domRecorder._clickInputStep=0
    setTimeout(()=>{
      _domRecorder._hiddenItems=0
    },100)
    // if(!BZ._autoRecording && a.event.type!="change"){
      // _ideDataBind._hideMe()
    // }
    if(this._lastStep&&d._action=="change"){
      if(this._lastStep._action!="mousedown"){
        this._lastStep=0
      }
    }else{
      this._lastStep=0
    }
    if(_IDE._data._setting.autoMergeToSetValue){
      a._mergeId=Date.now()
      _domRecorder._monitorSetInputActions._mergeForSetAction(d._element,{
        _action:a,
        _element:d._element,
        _type:d._action,
        _txt:d._element.innerText||_descAnalysis._retrieveTextForElementPathItem(d._element),
        _elementScope:_cssHandler._getElementScope(d._element)
      })
    }
    if(BZ._autoRecording){
      BZ._storeData(a)
    }else if(!window.extensionContent){
      _ideActionManagement._addItem(a);
    }else{
      //Call background to set back recording action
      console.log("send click event")
      _domRecorder._sendData(a)
    }
    _timingInfo._setTmpInfo([_ideActionManagement._getAutoDescription(a,1)])
    setTimeout(function(){
      _descAnalysis._clearTmpPath(1);
    },200)

    function _getComTarget(o){
      while(o){
        let os=$(o).find("INPUT")
        if(os.length){
          if(os.length>1){
            return
          }else{
            return os[0]
          }
        }else if(o.tagName=="BODY"){
          return
        }
        o=o.parentNode
      }
    }

    function _isComElement(p){
      return p[1][0]==":"&&!p[1].match(/^\:(input|text|Contains|RowCol|equal)/i)
    }

    function _isIgnoreElement(e,_action){
      if(_action=="click"&&e){
        if(e.tagName!="LABEL"&&e.tagName!="INPUT"){
          e=_Util._getParentNode(e,"LABEL")
        }
        
        if(e&&e.tagName=="LABEL"){
          e=$(e).find("input")[0]
        }

        if(e&&e.tagName=="INPUT"&&e.getBoundingClientRect().width&&(["checkbox","radio"].includes(e.type))){
          return 1
        }
      }
    }
  },
  _sendDataList:[],
  _sendData:function(a){
    this._lastData=a;
    BZ._formatInIFramePath(a.element)
    _domRecorder._sendDataList.push({action: a})
    _doIt()
    function _doIt(){
      if(!_domRecorder._waitSendData){
        let o=_domRecorder._sendDataList.shift()
        if(o){
          _domRecorder._waitSendData=1
          bzComm.postToIDE({
            ps:[o.action],
            scope:"_ideRecorder",
            fun:"_addNewItem"
          });
          
          setTimeout(()=>{
            _domRecorder._waitSendData=0
            _doIt()
          },100)
        }
      }else{
        setTimeout(()=>{
          _doIt()
        },100)
      
      }
    }
  },
  _isIgnoreEvent:function(d){
    var _tagName=d.tagName;
    if(!d.readOnly){
      if((_tagName=="INPUT" && !["button","submit","radio","image"].includes(d.type)) || ["TEXTAREA","SELECT"].includes(_tagName)){
        //ignore click on input event
        return _tagName=="SELECT" || !_cssHandler._getParentSelect(d);
      }
    }
    return _Util._inSelectOption(d)
  },
  _insertPrepareChange:function(){
    if(this._prepareChange){
      var a=this._prepareChange;
      a._time=Date.now()
      this._prepareChange=0;
      this._createRecordAction(a)
      this._lastPrepareChangeElement={_element:a._element,_time:Date.now()}
    }
  },
  _createRecordAction:function(d,_force){
    if(this._lastPrepareChangeElement&&this._lastPrepareChangeElement._element==d._element&&Date.now()-this._lastPrepareChangeElement._time<500){
      if(d._code!=13||(this._lastAction&&this._lastAction.event.type!="change")){
        return
      }
    }
    if(!d || d._action=="focusin"){
      return;
    }
    if(d._action=="blur" && !_domRecorder._typed){
      return;
    }
    if(d._action=="keyup"){
      if(!d._code){
        return;
      }
      if(d._char==0 && ([13,40,38,33,34,9].includes(d._code) || d.code>111)){
        this._insertPrepareChange();
      }else if(_Util._isStdInputElement(d._element)){
        d._action="change"
        d._value=d._element.value;
        if(d._code==13 && !d._value){
          this._insertPrepareChange();
        }else{
          return this._prepareChange=d;
        }
      }else if($(d._element).attr("contenteditable")){
        return;
      }
    }else if(this._prepareChange && d._action._element!=this._prepareChange._element){
      this._insertPrepareChange();
    }else{
      this._prepareChange=0;
    }
    if(d._action=="click" && this._lastStep && this._lastStep._action=="keyup"){
      return;
    }
    if(["change","blur","focusout"].includes(d._action)){
      if(this._lastChangeStep && this._lastChangeStep._element==d._element && d._time-this._lastChangeStep._time<500){
        return;
      }else{
        this._lastChangeStep=d;
      }
    }else{
      this._lastChangeStep=0;
    }
    
    if(!_force&&"click,mousedown,mouseup".includes(d._action)){
      if(this._isIgnoreEvent(d._element)){
        return;
      }
    }else if(d._action=="change" && d._element.tagName=="SELECT"){
      var vs=""
      for(var i=0;i<d._element.selectedOptions.length;i++){
        var o=d._element.selectedOptions[i];
        v=o.textContent || o.text;
        vs+="\n"+v;
      }
      d._value=vs.substring(1);
    }
    var _changeOnFile=d._action=="change" && d._element.tagName=="INPUT" && d._element.type=="file";
    if(_changeOnFile){
      _uploadHandler._inputFileToBase64Obj(d._element.files,function(_result){
        var uf=_uiSwitch._uploadUrl
        d._uploadFile=_result
        _result=JSON.stringify(_result,0,2)
        if(uf||_ideActionManagement._checkFileSize(_result)){
          d._value=uf||("{{"+_result+"}}");
          d._inUpload=1
          d._uploadUrl=uf
          if(uf){
            delete d._uploadFile
          }
          _domRecorder._addData(d);
        }
      })
    }else if(d._action=="change" && d._element.tagName=="INPUT" && d._element.type=="checkbox"){
      if(!d._element.checked){
        d._value=null;
      }
    }else if(["focusout","blur"].includes(d._action) && !_Util._isStdInputElement(d._element) && d._element.contentEditable){
      d._action="change"
    }
    if(!_changeOnFile){
      _domRecorder._addData(d);
    }
  },
  _bindKeydown:function(a){
    if(!a.keyCode){
      return;
    }
    if($(BZ.TW.document).find(".BZIgnore").find(a.target).length){
      return;
    }
    // _elementMonitor._handleMonitor();
    if(_Util._isInContentEditable(a.currentTarget || a.target)){
      _domRecorder._typed=1;
    }
    clearTimeout(_domRecorder._keyDownTime);
    _domRecorder._keyDownTime=setTimeout(function(){
      _ideDataBind._filter(a.target)
    },100)
  },
  _bindFun:function(a){
    if(!BZ._isRecording()){
      return;
    }
    if(a.type=="mousemove"&&a.target.tagName=="CANVAS"&&!a.target._bindFun){
      a.target._bindFun=1
      $(a.target).bind("mousedown",_domRecorder._bindFun);
    }
    if($(BZ.TW.document).find(".BZIgnore").find(this).length){
      return;
    }else if(!_IDE._data._setting.disableShadowRootRecording&&a.target.shadowRoot&&_Util._hasDeepContent(a.target.shadowRoot)){
      if(!a.target.shadowRoot._inListening){
        a.target.shadowRoot._path=_cssHandler._findPath(a.target)
        _domRecorder._setDomEventListener(a.target.shadowRoot)
      }
      return
    }else if(a.target==this){
      _domRecorder._recordEvent(a,this.value);
    }else if(a.type=="change"){
      _domRecorder._recordEvent(a,a.target.value);
    }
  },
  _bindContentEditable:function(a){
    if(!BZ._isRecording() || (!BZ._autoRecording && _bzDomPicker._isPicking() && !_bzDomPicker._isRecording())){
      return;
    }
    if(a.target==this){
      _domRecorder._recordEvent(a,this.innerHTML);
    }
  },
  _bindFocus:function(a){
    if(!BZ._isRecording()){
      return;
    }
    if(a.target==this && !$(BZ.TW.document).find(".BZIgnore").find(this).length){
      _domRecorder._recordEvent(a,this.value);
    }
  },
  _removeEventListener:function(){
    _domRecorder._removeDomEventListener(document)
    if(!_bzDomPicker._isPicking()){
      _bzDomPicker._removeTmpCover();
    }
  },
  _removeDomEventListener:function(_document){
    try{
      let b=_document

      b._inListening=false;
      $(b).off("mousedown","*",_domRecorder._bindFun);
    
      $(b).off("mouseup","*",_domRecorder._bindFun);
      $(b).off("mousemove","*",_domRecorder._bindFun);
      $(b).off("dblclick","*",_domRecorder._bindFun);
      $(b).off("click","*",_domRecorder._bindFun);
      $(b).off("keyup","*",_domRecorder._bindFun);
      $(b).off("keydown","*",_domRecorder._bindKeydown);
      $(b).off("change","input,textarea,select",_domRecorder._bindFun);
      $(b).off("focus","input,textarea,select",_domRecorder._bindFocus);
      $(b).off("blur","[contenteditable=true]",_domRecorder._bindContentEditable);
      
      $(b).find("CANVAS").unbind("mousedown",_domRecorder._bindFun);

//       $(_document).off("focus","select,input,textarea",_domRecorder._bindFocus);
// //      $(_document).find("select,input,textarea").unbind("focus",_domRecorder._bindFocus);
//       $(_document).find("[contenteditable=true]").unbind("blur",_domRecorder._bindContentEditable);
      
//       for(var k in _domRecorder._listenEvents){
//         if (k=="click") {
//           $(_document).find("*").not("style,script").unbind("mousedown",_domRecorder._bindFun);
//         }else if (k=="mousedown" && _domRecorder._listenEvents.click) {
//           continue;
//         }else if (k=="focus") {
//           continue;
//         }else if(k=="dragDrop"){
//           $(_document).find("*").not("style,script").unbind("mouseup",_domRecorder._bindFun);
//           $(_document).find("*").not("style,script").unbind("mousemove",_domRecorder._bindFun);

//           if(!_domRecorder._listenEvents.click){
//             $(_document).find("*").unbind("mousedown",_domRecorder._bindFun);
//           }
//           continue;
//         }
//         if(k=="change"){
//           $(_document).find("input,textarea,select").unbind(k,_domRecorder._bindFun);
//         }else{
//           $(_document).find("*").not("style,script").unbind(k,_domRecorder._bindFun);
//         }
//       }
//       $(_document).find("*").not("style,script").unbind("keyup",_domRecorder._bindFun);
//       $(_document).find("*").not("style,script").unbind("keydown",_domRecorder._bindKeydown);
    }catch(e){
      
    }
  },
  _monitor:function(_doc){
    var ds=_domRecorder._monitorList;
    if(!ds.includes(_doc)){
      ds.push(_doc);
      _domRecorder._observer.disconnect();
      for(var i=ds.length-1;i>=0;i--){
        var d=ds[i];
        if(!d.defaultView || d.defaultView.closed || !d.body){
          ds.splice(i,1);
        }else{
          _domRecorder._observer.observe(d.body,{
            childList:true,
            subtree:true,
            characterData: true,
            attributes:true,
            attributeFilter: ['style','class'],
            attributeOldValue:true
          });    
        }
      }
    }
  }
};
var _taskInfo={
  _type:{
    _notReady:5,
    _success:4,
    _warning:3,
    _failed:2,
    _error:1,
    _crash:0
  },
  _errSou:{
    _env:0,        // Environment
    _page:1,       // Open Page
    _perf:2,       // performance
    _element:3,     // Source Data
    _exp:4,         // Expectation Data
    _script:5
  },
  _valueMap:{
    s:"_success",
    w:"_warning",
    f:"_failed",
    e:"_error",
    c:"_crash"
  },
  _values:["_crash","_error","_failed","_warning","_success","_notReady"]
};
var _domActionTask={
  _findElement:function(o,p){
    if(!o.e){
      if(o.panels){
        o.e=_Util._findDomWithPanels(o.element,o.panels,p)
      }else{
        if(o.multipleElement){
          window.$element=o.e=_Util._findDoms(o.element.filter(x=>!$.isNumeric(x)));
        }else{
          o.e=$util.findDom(o.element,p);
        }
      }
    }
    return o.e
  },
  /*
  1:"Element appears",
  2:"Element appears and disappears",
  3:"Element appears and click",
  4:"Element appears and double click",
  5:"Element disappears",
  6:"Element disappears and appears again",
  7:"Element disappears and appears again and click",
  8:"Element disappears and appears again and double click",
  */
  _preCkRepElement:function(a,_result){
    //The action already completed in last page.
    var t=_taskInfo._type,
        md=a.event.repElementMethod;
    if(!md||!a.event.responseElement){
      return 
    }
    _result._startTime=Date.now()
    var o=$util.findDom(a.event.responseElement)
    if(o&&!_Util._isHidden(o)){
      _result._repElement=o
    }
    if("a1234".includes(md)){
      if(o&&!_Util._isHidden(o)){
        _result._type=t._error
        _result._msg=_bzMessage._task._repElementAppearBeforeExeError
      }
    }else{
      if(!o){
        _result._type=t._error
        _result._msg=_bzMessage._task._missBeginningRepElementError
      }
    }
  },
  /*
  1:"Element appears",
  2:"Element appears and disappears",
  3:"Element appears and click",
  4:"Element appears and double click",
  5:"Element disappears",
  6:"Element disappears and appears again",
  7:"Element disappears and appears again and click",
  8:"Element disappears and appears again and double click",
  */
  _ckRepElement1:function(a,_result,_fun){
    let t=_taskInfo._type,md=a.event.repElementMethod;
    if(!md||!a.event.responseElement){
      return _fun(_result)
    }
    if("a1234".includes(md)){
      var o=$util.findDom(a.event.responseElement)
      if(o&&!_Util._isHidden(o)){
        if(md==2){
          _result._repElement=o
          return _domActionTask._ckRepElement2(a,_result,_fun)
        }else if(3==md){
          _domActionTask._clickElement(o)
        }else if(4==md){
          _domActionTask._dblclickElement(o)
        }
        return _fun(_result)
      }
    }else{
      if(_Util._isHidden(_result._repElement)){
        if(md!=5){
          return _domActionTask._ckRepElement2(a,_result,_fun)
        }
        return _fun(_result)
      }
    }
    let _time=parseInt(a.max||2000)
    if(_result._pTime>_time){
      _result._type=t._error
      if("a1234".includes(md)){
        _result._msg=_bzMessage._task._repElementAppearFailed
      }else{
        _result._msg=_bzMessage._task._repElementDisappearFailed
      }
      return _fun(_result)
    }else{
      if(_reExe(a)){
        a._reTrigger=1
        if($(document).find(a.e)[0]){
          return _domActionTask._trigger(a,function(r){
            _domActionTask._ckRepElement1(a,_result,_fun)
          })
        }else{
          _result._type=1
          _result._msg=_bzMessage._system._error._lostElement
          return _fun(_result)
        }
      }
      setTimeout(function(){
        _domActionTask._ckRepElement1(a,_result,_fun)
      },10)
    }
    
    function _reExe(a){
      if(md=="a"){
        _result._retryTimes=_result._retryTimes||0
        let _speed=Math.max(parseInt(a.event.repInterval)||(_time/10),1000)
        if(parseInt(_result._pTime/_speed)>_result._retryTimes){
          _result._retryTimes++
          return 1
        }
      }
    }
  },
  /*
  2:"Element appears and disappears",
  6:"Element disappears and appears again",
  7:"Element disappears and appears again and click",
  8:"Element disappears and appears again and double click",
  */
  _ckRepElement2:function(a,_result,_fun){
    var t=_taskInfo._type,md=a.event.repElementMethod;
    if(!md||!a.event.responseElement){
      return _fun(_result)
    }
    if("678".includes(md)){
      var o=$util.findDom(a.event.responseElement)
      if(o&&!_Util._isHidden(o)){
        if(md==7){
          _domActionTask._clickElement(o)
        }else if(md==8){
          _domActionTask._dblclickElement(o)
        }
        return _fun(_result)
      }
    }else{
      if(_Util._isHidden(_result._repElement)){
        return _fun(_result)
      }
    }
    var t=a.max||2000
    if(Date.now()-_result._startTime>t){
      _result._type=t._error
      if(4==md){
        _result._msg=_bzMessage._task._repElementAppearFailed
      }else{
        _result._msg=_bzMessage._task._repElementDisappearFailed
      }
      return _fun(_result)
    }else{
      setTimeout(function(){
        _domActionTask._ckRepElement2(a,_result,_fun)
      },10)
    }
  },
  _clickElement:function(o,_fun){
    _domActionTask._isLoading(function(){
      $util.triggerMouseEvents(o,1,0,0,0,0,0,_fun)
    })
  },
  _dblclickElement:function(o,_fun){
    _domActionTask._isLoading(function(){
      $util.triggerDblClickEvents(o,1,0,0,0,0,0,_fun);
    })
  },
  _showIssueInComment:function(_result){
    var _element,_data=_result._data||_IDE._data._curAction,_chkSize;
    if(_result._errSou==_taskInfo._errSou._exp){
      _element=_data.element;
    }else{
      _element=$.extend([],_data.element);
      while(_element.length>1){
        var e=$util.findDom(_element)
        if(e){
          if(_chkSize){
            let r=e.getBoundingClientRect()
            while(r.width<500||r.height<500&&e.tagName!="BODY"){
              e=e.parentElement
              r=e.getBoundingClientRect()
            }
            _element=_cssHandler._findPath(e)
          }
          break
        }
        _chkSize=1
        _element.pop();
      }
      if(_element.length==1){
        _element.push("*:eq(0)","0")
      }
    }

    _bzDomPicker._removeTmpCover();
    _domActionTask._doComment({description:_result._msg,element:_element});    
    return _element;
  },
  _setBackData:function(a){
    let s=(a.script||"")
    if(a.requests){
      s+=a.requests.map(x=>x.responseScript||""+(x.loopData||"")).join("")
    }
    if(s.toString().includes("$util.validateData")){
      s=s.split("$util.validateData")
      s.shift()
      s.forEach(x=>{
        x=x.split(",")
        x.shift()
        x.forEach(y=>{
          y=y.split(")")[0].trim()
          let d=y.match(/\$(test|module|project)[\.\[]([^\.\)]+)/)
          if(d){
            let dd=window["$"+d[1]]
            dd[d[2]]=_DataBuilder._getOrgDataByPath(y)
          }
        })
      })
    }
  },
  _prepareItem:function(_setting,a,_result,_funOnSelfCtrl){
    var u=!BZ._isAutoRunning();
    var _element=a.element||a.panel
    _domActionTask._setBackData(a)

    if(a.element){
      a.element.forEach((ee,j)=>{
        ee=_descAnalysis._retrieveTextForElementPathItem(ee)+""
        if(ee){
          ee=ee.match(/\/\{random:[0-9-]+[^\}]\}[\/]/)
          if(ee){
            ee=ee[0]
            let vv=$util.generateWordsByRegex(ee)
            a.element[j]=a.element[j].replace(ee,vv)
            if(a.event&&a.event.value==ee){
              a.event.value=vv
            }
          }
        }
      })
      if(a.skipActionElement){
        if($util.findDom(a.skipActionElement)){
          _result._bzSkip=1
          _result._pos="_element"
          _result._type=4
          _finalFun()
          
          _domActionTask._reportAppInfo("Prepare action: on skip element setting")
          return
        }
      }
      
      _domActionTask._setErrorPos(_result,"_element","_actionDetailsGeneral");
      _domActionTask._reportAppInfo("Prepare element")

      var e=_domActionTask._findElement(a,a.errOnHidden);
      
      if(!e){
        _domActionTask._reportAppInfo("Prepare action: element-1 not found. HTML size: "+(((document.body||{}).innerHTML||{}).length||0))
        bzComm.postToIDE({
          fun:"_end",
          scope:"_timingInfo",
          ps:[""]
        });
        e=_Util._getRandomSelection(a.element)
        
        if(e&&a.event&&a.event.value&&a.event.value.startsWith("/{random")){
          a.event.value=$util.getElementText(e)
          _domActionTask._setRandomValueToVariable(a.event.value,a)
        }
      }
      _Util._focusElement(e)
      
      // if(e&&a.finalElement){
      //   e=_findFinalElement(e,a)
      //   if(!e){
      //     _domActionTask._reportAppInfo("Prepare action: element-2 not found")
      //   }
      //   a.e=e
      // }
      
      if(!e){
        _domActionTask._reportAppInfo("Prepare action: element-3 not found")
        if(a.content&&a.content.type=="unexist"){
          _result._type=_taskInfo._type._success
          return _finalFun()
        }else{
          _result._msg=_bzMessage._system._error._testError+"\n"+JSON.stringify(a.element,0,2);
        }
      }
      if(!e&&a.failElement&&$util.findDom(a.failElement)){
        _result._type=_taskInfo._type._failed
        _finalFun()
        return
      }else if(u&&!e&&(!a.content||a.content.type!="unexist")&&(!a.refOfError||a.refOfError.includes("e"))){
        _result._type=_taskInfo._type._error
        return _finalFun()
      }else if(!e){
        _result._type=_taskInfo._type._error
        
        return _finalFun()
      }else{
        if(e.constructor!=Array&&_Util._isHidden(e)){
          if(a.content&&a.content.type=="unexist"){
            _domActionTask._reportAppInfo("Prepare action: check unexist on hidden element")
            _result._type=_taskInfo._type._success
            return _finalFun()
          }
        }else if(a.offset){
          if(a.e.bzTxtElement){
            var xy = _Util._getDomXY(a.e);
            let aa={
              x:parseFloat(xy.x)+a.e.bzTxtElement.x,
              y:parseFloat(xy.y)+a.e.bzTxtElement.y,
              h:a.e.bzTxtElement.h,
              w:a.e.bzTxtElement.w
            }
            a.e._offset=_bzDomPicker._getOffsetPoint(aa,a.offset)
          }
        }
        if(_cssHandler._lastAllInputsMap){
          var p=_element.join(" ")
          _cssHandler._lastAllInputsMap[p]=e
        }
      }
    }
    return 1
    
    function _isSkip(v,p){
      v=v||""
      if(JSON.stringify(v).match(/bz-skip-group/i)){
        _result._type=_taskInfo._type._success
        _result._bzSkipGroup=1;
        _result._pos=p
        _finalFun()
        return 1
      }else if(JSON.stringify(v).match(/bz-skip/i)){
        _result._type=_taskInfo._type._success
        _result._bzSkip=1;
        _result._pos=p
        _finalFun()
        return 1
      }else if(JSON.stringify(v).match(/bz-stop/i)){
        _result._type=_taskInfo._type._success
        _result._bzStop=1;
        _result._pos=ps
        _finalFun()
        return 1
      }
    }
    function _finalFun(){
      if(_funOnSelfCtrl){
        _funOnSelfCtrl(_result)
      }
    }
  },
  _exeFillForm:function(d,_backFun){
    let p=[...d.element]
    if($.isNumeric(p._last())){
      p.pop()
    }
    _buildActions(d.event.value,p);

    let as=Object.keys(d.event.value).map(k=>{
      if(k=="$map"){
        return
      }
      return $script.set([...p,`:input(${_Util._parseCamelWords(k).replace(/_/g," ")})`],d.event.value[k])
    })
    $script.exe(as,_backFun)

    function _buildActions(d,p){
      let as=Object.keys(d).map(k=>{
        let v=d[k],op=[...p]
        if(k=="$map"){
          return
        }
        if(d.$map&&d.$map[k]!==undefined){
          k=d.$map[k]
        }

        k=_parsePath(k)

        if(_Util._isObjOrArray(v)){
          if(k){
            op.push(`:Contains(${k})`)
          }
        }else if(k){
          op.push(`:input(${k})`)
        }
        return $script.set(op,v)
      })
    }
    function _parsePath(k,p){
      if(!k){
        return k
      }
      if(k&&k.match(/[.#:]/)){
        return k
      }else{
        let kk=k.replace(/_/g," ").trim()
        if(k!=kk){
          return kk
        }
        return _Util._parseCamelWords(k)
      }
    }

  },
  _logOneAction:function(a){
    let v=(a._path||"").match(_IDE._actionPathRegex)
    if(v){
      v="##"+_bzMessage._log._exeSingleActionGroup+"## ("+v._last()+"), "+a.description
      _domActionTask._doLog(v)
    }
  },
  _reportAppInfo:function(v){
    if(window.extensionContent){
      bzComm.postToIDE({
        fun:"_receiveAPPInfo",
        scope:"_ideTask",
        ps:[v]
      })
    }
  },
  _doLog:function(v){
    if(window.extensionContent){
      bzComm.postToIDE({
        fun:"log",
        scope:"console",
        ps:['["BZ-LOG: "+v]']
      })
    }else{
      console.log("BZ-LOG: "+v+" (APP)")
    }
  },
  _exeOneActionList:function(_data,_setting,_backFun,_descDelay){
    _data.asOneAction=0
    let as=[_data],_result,_lastLog,_waitSameRequest=0,_startTime=Date.now(),_tryNotWait;
    _domActionTask._curOneActionList=as.concat(_data._oneActionList)
    let ss=[],_curGroup,_retry=0,_speed=50,_lastAction;
    let _localActions=localStorage.getItem(_data._path)
    localStorage.removeItem(_data._path)
    _domActionTask._curOneActionList.forEach(x=>x._inOneAction=1)
    if(_localActions){
      let _leaveActions=_Util._strToJson(_localActions)
      if(!_Util._isEmpty(_leaveActions)){
        _domActionTask._curOneActionList=_leaveActions
      }
    }

    _doIt()
    
    function _doIt(a){
      let _ssss=(a&&(a.max||a.min))||_speed
      setTimeout(()=>{
        if(TWHandler._curRequestList.length&&!_tryNotWait){
          _waitSameRequest++
          let _log=_Util._formatMessage(
            _bzMessage._task._waitRequests,[
              TWHandler._curRequestList.length,
              TWHandler._curRequestList.map(r=>{
                return "    "+r._url
              }).join("\n")+"\n"
            ]
          )
          if(_lastLog!=_log){
            _lastLog=_log
            _domActionTask._doLog(_log)
            _retry=0
            return _doIt(a)
          }else{
            _log=_bzMessage._task._logAgain
            if(_waitSameRequest<10&&Date.now()-_startTime<30000){
              _domActionTask._doLog(_log)
              _tryNotWait=1
              return _doIt(a)
            }
          }
        }
        if(!_tryNotWait){
          _lastLog=""
        }
        a=a||_domActionTask._curOneActionList.shift()
        _storeTmpData(_data._path,_domActionTask._curOneActionList)
        
        if(!a||a.type==7){
          if(_curGroup){
            _handleResult(_result,_curGroup)
            _curGroup=0
            ss=[]
            if(a){
              return _doIt(a)
            }
          }else if(a){
            _curGroup=a
            //Handle group data
            return _doIt()
          }else if(_result){
            return _backFun(_result)
          }
        }else if(_curGroup){
          if(!ss.includes(a)){
            ss.push(a)
          }
          delete a.e
        }
        
        if(a){
          TWHandler._curRequestList.length=0
          if(a!=_lastAction){
            _domActionTask._logOneAction(a);
            _lastAction=a
          }
          _domActionTask._exeAction(a,_setting,function(r){
            //Retry
            if((r._type==1&&a.failedReaction!=1)||(r._type==2&&a.failedReaction==2)){
              if(a.e&&a.type==1&&a.event.type=="change"&&!_Util._isInputObj(a.e,1)){
              }else{
                delete a.e
                let _time=2000//parseInt(a.max||_IDE._data._setting.advanced[a.hostId||0].expectReactionTime||2000)
                if(_retry<_time){
                  _retry+=_speed
                  if(r._type==1){
                    _domActionTask._doLog(_bzMessage._task._retryOnMissingElement)
                  }else{
                    _domActionTask._doLog(_bzMessage._task._retryOnElementExist)
                  }
                  _tryNotWait=0
                  return _doIt(a)
                }else if(r._stillRetryable){
                  _tryNotWait=0
                  a._doRetryPreviousAction=1
                  delete a.e
                  a.min=1
                  return _doIt(a)
                }else if(r._redidPreviousAction){
                  a._doRetryPreviousAction=0
                  _retry=0
                  a.min=_speed
                  return _doIt(a)
                }
              }
            }
            delete a.e
            let v=_handleResult(r,a)
            if(r._type<=2){
              if(_final(r._type==1,r)){
                return
              }
            }else{
              _retry=0
            }

            if(_domActionTask._curOneActionList.length){
              return _doIt()
            }else{
              return _final()
            }
          },_descDelay)
        }else if(_result){
          return _backFun(_result)
        }
      },_ssss)
    }
    
    function _storeTmpData(p,_list){
      try{
        localStorage.setItem(p,JSON.stringify(_list))
      }catch(e){
        
      }
    }
    function _handleResult(r,a){
      r._data=a
      if(a.type==0){
        if(!a.content){
        }else if(a.content.type=="exist"){
          if(r._type==1){
            r._type=2
          }
        }else if(a.content.type=="unexist"){
          // if(r._type==1){
            // r._type=4
          // }else if(r._type==4){
            // r._type=2
          // }
        }
      }
      
      if(!r.exeTime){
        r.exeTime=a.exeTime
      }

      if(!_result){
        _result=_Util._clone(r)
        _result._resultList=[]
      }else if(_result._type>r._type){
        _result._type=r._type
      }
      if(r!=_result){
        _result._resultList.push(r)
        if(!_result._failedAction&&r._type<=2){
          _result._failedAction=a
        }
      }
      
    }
    
    function _final(_inError,r){
      if(_inError){
        _result._msg=r._msg
      }
      if(!_curGroup){
        if(_inError){
          _doScreenshot(r)
        }else{
          _backFun(_result)
        }
        return 1
      }

      _handleResult(_result,_curGroup)
      if(_inError){
        if(_curGroup._tmp){
          if(_result._type>=3){
            _curGroup.refOfSuccess="../"
          }else if(_result._type==2){
            _curGroup.refOfFailed="../"
          }else{
            _curGroup.refOfError="../"
          }
        }
        if(_result._type<3){
          if(_Util._isBZTWOpened()&&!r._data.apiReplaceEvent&&r._data.element){
            _doScreenshot(r)
            return 1
          }
          _backFun(_result)
          return 1
        }else{
          delete _result._failedAction
          delete _result._msg
          
          if(!_domActionTask._curOneActionList.length){
            _backFun(_result)
            return 1
          }
        }
      }else {
        _backFun(_result)
        return 1
      }
      _curGroup=0
      ss=[]
    }
    
    function _doScreenshot(r){
      setTimeout(()=>{
        _screenshotHandler._getScreenshot(0,0,function(c){
          _result._imgData={
            file:c,
            name:r._data._path.replace(/[\/]/g,".").replace(/[\.]$/,"")
          };
  
          _result._stack=r._data._idx
          return _backFun(_result)
        })
      },1000)
    }
  },
  _isLoading:function(_fun){
    let s=_IDE._data._setting.content.loadingElement
    if(s){
      if(_Util._isFunction(s)){
        try{
          s=eval(s)

          if(s&&window._bzEval&&_bzEval._isFun(s)){
            return _end(_bzEval._exeFun(s))
          }

          return _end(s)
        }catch(e){
          alert(e.message)
          return
        }
      }else{
        s=$util.findDom(s)
        if(s&&!_Util._isHidden(s)){
          return _end(1)
        }
      }
    }

    return _end()
    function _end(r){
      if(r){
        if(_fun){
          setTimeout(()=>{
            _domActionTask._isLoading(_fun)
          },100)
        }
        return r
      }
      _fun&&_fun()
    }
  },
  _registerSuccessAction:function(d){
    if(d.retryable){
      BZ._lastMouseAction=d
    }else{
      BZ._lastMouseAction=0
    }
  },
  _exeAction:function(_data,_setting,_backFun,_descDelay){
    if(_data.event&&_data.event.action=="rightclick"){
      _data.event.action="click"
      _data.event.button=2
    }

    BZ._data._uiSwitch._curLoadingAPIInfo=0
    _domActionTask._doLog("Exe Action ...")
    _domActionTask._reportAppInfo("Exe action "+_data.description)
    if(_domActionTask._isLoading()){
      console.log("Page in Loading ...")
      return setTimeout(()=>{
        _domActionTask._exeAction(_data,_setting,_backFun,_descDelay)
      },100)
    }
    if(_domActionTask._lastAction&&_domActionTask._lastAction!=_data&&_data._repeatOnExtensionComm){
      if(_domActionTask._lastAction._path==_data._path){
        return
      }
    }
    _data._repeatOnExtensionComm=0
    _domActionTask._lastAction=_data
    if(_data.asOneAction&&_data._oneActionList){
      return _domActionTask._exeOneActionList(_data,_setting,function(_result){
        localStorage.removeItem(_data._path)
        _result.$returnValue=window.$returnValue
        _result.exeTime=_data.exeTime
        delete window.$returnValue
        _result._dataMap=_domActionTask._buildActionData()

        _backFun(_result)
      },_descDelay)
    }
    var _fun,_orgData=_Util._clone(_data),_result={};
    TWHandler._takeoverWin(0,_data);
    
    if(_backFun){
      _fun=function(r){
        _domActionTask._doLog("Send back result")
        r.exeTime=_data.exeTime
        if(_data.e){
          delete _data.e.bzTxtElement
        }
        r._img=_data._img
        if(window.extensionContent||!BZ._hasExtension()){
          r._url=BZ.TW.location.href
        }
        if(r._type>2&&_data._loopData){
          _setting.$action=_data._loopData.shift()
          if(!_data._loopData.length){
            _data._loopData=0
          }
          return setTimeout(()=>{
            _domActionTask._exeAction(_orgData,_setting,_backFun,_descDelay)
          },_orgData.min||50)
        }

        BZ._lastResult=r;
        
        r._errorPos=_domActionTask._errorPos;

        r.$returnValue=window.$returnValue
        _fun=0

        if(_backFun){
          r._dataMap=_domActionTask._buildActionData()
          let _finalFun=_backFun
          
          _backFun=0
          r._data={..._data}
          if(r._type<3&&window.name!="bz-master"){
            delete _data.e
            r._data.element=["BZ.TW.document"]
            _domActionTask._doLog("Go to take screenshot")
            return _screenshotHandler._getScreenshot(0,0,function(v){
              r._canvas=v
              delete r._data.e
              _domActionTask._doLog("Send result 3")
              _finalFun&&_finalFun(r);
              _finalFun=0
            })
          }else if(r._type>2){
            _domActionTask._registerSuccessAction(_data)
          }
          delete r._data.e
          _domActionTask._doLog("Send result 2")
          _finalFun&&_finalFun(r);
          _finalFun=0
        }
      }
    }

    if(!BZ._isAutoRunning()&&_data._applyTmpData){
      _data._applyTmpData()
      $parameter=_aiAPI._preHandleParameter($parameter,0,_data._supData?_data._supData._module:0)
    }
    if(_doApiRegister()){
      return
    }

    if(_cssHandler._hasWaitingElement()){
      return setTimeout(function(){
        _domActionTask._exeAction(_data,_setting,_backFun,_descDelay)
      },100)
    }
    if(_data._code&&!_descDelay){
      return setTimeout(function(){
        _domActionTask._exeAction(_data,_setting,_backFun,1)
      },100)
    }
    var _force=_setting._force;
    
    try{
      _tipHandler._removeAll();
      if(!_data._orgData){
        var a=_Util._clone(_data);
        a._orgData=_data;
        _data=a;
      }
      
      _domActionTask._reportAppInfo("Prepare action: "+_data.description)
      if(!_domActionTask._prepareItem(_setting,_data,_result)){
        _domActionTask._reportAppInfo("Prepare action failed on: "+_data.description)
        if(_result._type==_taskInfo._type._notReady&&(!_domActionTask._notReadyTime||Date.now()-_domActionTask._notReadyTime<2000)){
          _domActionTask._notReadyTime=_domActionTask._notReadyTime||Date.now()
          return setTimeout(function(){
            _domActionTask._exeAction(_orgData,_setting,_backFun,_descDelay)
          },100)
        }
        _doRedoLastAction(_result,_data,()=>{
          _domActionTask._notReadyTime=0
          _fun&&_fun(_result)
        })
        return 
      }else if(_data.type==1&&_data.e&&!_data.apiReplaceEvent&&_data.event&&_data.event.action=="click"){
        _domActionTask._reportAppInfo("clicked: "+_data.e.outerHTML.substring(0,300))
      }
      if(_data.e){
        try{
          if(_data.e.constructor==Array){
            _data.e.forEach(e=>{
              _domActionTask._logElement(e)
            })
          }else{
            _domActionTask._logElement(_data.e)
          }
        }catch(exx){

        }
      }
      _domActionTask._reportAppInfo("After Prepare action: "+_data.e)
      _domActionTask._notReadyTime=0
      _result._data=_data;
      _waitData(function(){
        if (!_force) {
          _waitOverWin()
        }else{
          _doIt(0)
        }
      })
    }catch(ex){
      _domActionTask._doLog("Exception error: "+ex.stack)
      if(_fun){
        _result._type=window.extensionContent?_taskInfo._type._error:_taskInfo._type._crash;
        _result._msg=ex.message;
        _fun(_result)
      }
    }

    function _doRedoLastAction(r,a,_call){
      let d=BZ._lastMouseAction
      if(d){
        if(a._doRetryPreviousAction){
          r._redidPreviousAction=1
          
          delete BZ._lastMouseAction
          if(d.type==1&&d.event&&d.event.type=="change"&&_Util._isStdInputElement(d.e)&&["INPUT","TEXTAREA"].includes(d.e.tagName)){
            $util.triggerChangeEvent(d.e,"",0,0,0,0,()=>{
              setTimeout(()=>{
                delete d.e
                _domActionTask._trigger(d,function(){
                  _domActionTask._doLog("redo last action: "+d.description)
                  _call()
                })
              },1000)
            })
          }else{
            delete d.e
            _domActionTask._trigger(d,function(){
              _domActionTask._doLog("redo last action: "+d.description)
              _call()
            })
          }
        }else{
          r._stillRetryable=1
          _call()
        }
      }else{
        r._stillRetryable=0
        _call()
      }
    }

    function _waitData(_fun){
      let d=[$parameter,$test,$module,$project,window.$action,window.$group]
      _chkData()
      function _chkData(){
        if(_hasWaitData(d)){
          return setTimeout(()=>{
            _chkData()
          },100)
        }
        _fun()
      }
    }

    function _hasWaitData(d,_fun){
      let _has;
      if(d&&_Util._isObjOrArray(d)){
        for(let k in d){
          let v=d[k]
          if(v&&v.constructor==Promise){
            if(!v._has){
              v.then(x=>{
                d[k]=x
                _hasWaitData(d,_fun)
              })
            }
            _has=1
          }else if(_Util._isObjOrArray(v)){
            _has=_has||_hasWaitData(v)
          }
        }
      }
      return _has
    }
    function _doApiRegister(){
      if(!window.extensionContent){
        if(!_aiAuthHandler._isAuthItem(BZ._getCurModule())){
          return (!_data.apiReplaceEvent||_apiDataHandler._hasWaitingData([window.$parameter,window.$group,window.$action]))&&_apiDataHandler._registerExeFun(()=>{
            _domActionTask._exeAction(_data,_setting,_backFun,_descDelay)
          },0,1,_data)
        }
      }
    }
    function _waitOverWin(){
      if(window.extensionContent){
        setTimeout(function(){
          var w=window.$TW||window;
          if(document.documentElement.getAttribute("bzOverrideMark")){
            _doIt(0)
          }else{
            TWHandler._takeoverWin(0,_data)
            _waitOverWin()
          }
        },10)
      }else{
        _doIt(0)
      }
    }
    
    function _doIt(_tryTime,_noCamera){
      if(_data.e&&BZ._hasVideo&&!_noCamera&&BZ.TW==window){
        return _domActionTask._takeScreenshot(_data,function(v){
          if(v&&v.length>100){
            _Util._log("video-img: "+v)
          }
          _doIt(_tryTime,1)
        })
      // }else if(_data.e&&_setting._takeScreenshot&&!_noCamera&&!_data.cameraMd5&&!_data._camera&&!_data._inVisit&&!_data._inForm){
      }else if(_data.e&&_setting._takeScreenshot&&!_noCamera&&!_data._inVisit&&!_data._inForm){
        _bzDomPicker._showTmpCover([_data.e])
        $(_innerWin._curDom).hide()

        return setTimeout(()=>{
          _domActionTask._takeScreenshot(_data,function(){
            $(_innerWin._curDom).show()
            _doIt(_tryTime,1)
          })
        },10)
      }

      _domActionTask._next=_setting._next;
      
      var T=_ideActionData._type;
      var M=_ideActionData._method;
      try{
        //Validation
        if(_data.type==T._script){
          _domActionTask._setErrorPos(_result,"_script","_actionDetailsGeneral");
          return _domActionTask._doScript(_data,function(r){
            var _assertList=TWHandler._takeAssertInfo();
            if(_assertList.length){
              r._type=_taskInfo._type._failed;
              
              r._msg=r._msg||"";
              _assertList.forEach(function(v){
                r._msg+=v+"\n"
              });
            }
            
            if(_fun){
              _fun(r)
            }
          });
        //validation Script
        }else if(_data.type==T._validation && _data.method==M._script&&_data.runInIDE){//script
          return _domActionTask._validateJs(_data,_fun);
        }else{
          //Validation html
          if(_data.type==T._validation && _data.method==M._html){
            // if(_data.content.type=="screenshot"){
            //   return _domActionTask._validateScreenshot(_data,_force,_fun);
            // }
            _result=_domActionTask._validateHtml(_data,_force);
          //validation Script
          }else if(_data.type==T._validation && _data.method==M._script){//script
            return _domActionTask._validateJs(_data,_fun);
          //Extract data on html
          }else if(_data.type==T._extractData){ //extract
            _result=_domActionTask._extractDataByHtml(_data);
            _domActionTask._exeScript(_data.script,_result._extractData,window.$element);
          //event
          }else if(_data.type==T._triggerEvent){ //event
            var _change=null;
            if(_data.event.action=="dragdrop"){
              return _domActionTask._doDragdrop(_data,_fun)
            }else if(_data.event.action=="drag"){
              return _domActionTask._doDrag(_data,_fun)
            }
            return _domActionTask._trigger(_data,_fun);
          }else if (_data.type==T._comment) {
            _result=_domActionTask._doComment(_data);
          }
        //Refresh load page
        }
      }catch(e){
        _domActionTask._doLog("exeaction error: "+e.message)
        console.error(e.stack)
        _result._type=_taskInfo._type._error;
        if(_data.element && !window.$element){
          _result._errSou=_taskInfo._errSou._element;
          _result._msg=_bzMessage._system._error._missElement;
        }else{
          _result._msg=(e.stack||"").toString().split("\n")[0];
        }
        if(e.stack.includes("_exeScript")){
          _result._errSou=_taskInfo._errSou._script;
        }
      }
      _result._errorPos=_domActionTask._errorPos;
      if(_fun){
        _fun(_result);
      }
    }
  },
  _logElement:function(e){
    _domActionTask._doLog("Action element: "+_Util._getQuickPath(e))
    let r=e.getBoundingClientRect()

    _domActionTask._doLog("Action position: ("+window.innerWidth+","+window.scrollY+"), top:"+r.top+", left:"+r.left+", width:"+r.width+", height:"+r.height)
  },
  _parseFunForData:function(d){
    if(d){
      Object.keys(d).forEach(k=>{
        window[k]=d[k]
      })
      if(!bzComm._isIDE()&&d.funMap){
        let funMap=d.funMap
        Object.keys(funMap).forEach(k=>{
          eval(k+"="+funMap[k])
        })
      }
    }
  },
  _buildActionData:function(){
    let ds=["$project","$module","$test","$action","$group","$loop","$parameter"],fm={},r={};
    ds.forEach(k=>{
      r[k]=window[k]
      _buildFunMap(r[k],k+".")
    })
    r.funMap=fm
    return r

    function _buildFunMap(d,p){
      if(d&&d.constructor==Object){
        for(let k in d){
          if(d[k]&&d[k].constructor==Function){
            fm[p+k]=d[k].toString()
          }else{
            _buildFunMap(d[k],p+k+".")
          }
        }
      }
    }
  },
  _fetchMultipleFileDataFromURL:function(us,_fun,i,fs){
    i=i||0
    let u=us[i]
    fs=fs||[]
    if(u){

      _Util._getFileFromUrl(u,function(v){
        v.forEach(x=>fs.push(x))
        setTimeout(()=>{
          _domActionTask._fetchMultipleFileDataFromURL(us,_fun,i+1,fs)
        },1)
      })
    }else{
      _fun(fs)
    }
  },
  _doScript:function(d,_fun){
    var $element;
    if(d.element){
      _domActionTask._setErrorPos({},"_element","_actionDetailsGeneral");
      $element = _domActionTask._findElement(d);
    }

    _domActionTask._setErrorPos({},"_script","_actionDetailsGeneral");

    var _back=_domActionTask._exeScript(d.script,null,$element,_doIt);
    if(_back&&_back.constructor==Function){
      _back(_doIt)
    }else if($util._takeScreenshotBkFun){
      $util._takeScreenshotBkFun._wait=_doIt
    }else{
      _doIt()
    }
    function _doIt(w){
      if(!window.extensionContent){
        _apiDataHandler._registerExeFun(()=>{
          _final(w)
        },0,0,d)
      }else{
        _final(w)
      }
    }
    
    function _final(w){
      if(_fun){
        let c=$util._canvas
        delete $util._canvas
        if(c){
          c={
            file:c
          }
        }
        _fun({_type:_taskInfo._type._success,_msg:w,_imgData:c})
      }
    }
  },
  _exeScript:function(c,$result,$element,bzCallBack){
    if(c){
      if(c.constructor==Function){
        return c()
      }
      let cc=eval(c);
      return cc
    }
  },
  _takeScreenshot:function(o,_fun){
    let ee=document.body;
    if(o){
      o.e=_domActionTask._findElement(o)||ee
    }else{
      o={e:ee}
    }
    _screenshotHandler._getScreenshot(o.e,0,function(c) {
      o._img=c
      _fun(c)
    });
  },
  //Validation action
  _compareWithExpectation:function(d,v,_force){
    if(v && $.type(v)!="object" && $.type(v)!="string"){
      v=JSON.stringify(v,0,2);
    }
    var _result={};
    var _bRebuild=false;
    var _bNumber=false;
    var _org=v;
    if(v && v.constructor==String){
      v=v.replace(/\r\n/g,"\n");
    }
    var v1="";
    
    if (d.expectation==undefined || d.expectation==null || d.expectation==""){
      v1="";
    }else{
      v1=(d.expectation+"").replace(/\r\n/g,"\n");
    }
    if (d.md5 && !d.expectation) {
      v=_calcMD5(v);
      v1=d.md5;
    }else if (_Util._isNumber(d.expectation)) {
      v1=parseFloat(d.expectation);
    }else{
      v=_compressJSON._convertToEntities(v);
      v1=_compressJSON._convertToEntities(v1);
    }

    var bOk=false;

    v=(v+"").replace(/[\r\n]/g," ").replace(/\s+/g," ")
    v1=(v1+"").replace(/[\r\n]/g," ").replace(/\s+/g," ")
    d.compareMark=d.compareMark||"=="
    //v: actual, v1: expectation
    if(d.content&&["enable","disable","checked"].includes(d.content.type)){
      v=Boolean(v==0||v=="false"?false:v)
      v1=Boolean(v1==0||v1=="false"?false:v1)
      bOk=v==v1
    }else if(d.compareMark=="include"){
      bOk=v.includes(v1)
    }else if(d.compareMark=="exclude"){
      bOk!=v.includes(v1)
    }else if (d.compareMark!="regex") {
      if($.isNumeric(v)){
        v=parseFloat(v);
        v1=parseFloat(v1);
      }
      if($.isNumeric(v1)){
        v1=parseFloat(v1);
      }
      switch (d.compareMark) {
        case "==":
          bOk=v==v1;
          break;
        case "!=":
          bOk=v!=v1;
          break;
        case ">":
          bOk=v>v1;
          break;
        case "<":
          bOk=v<v1;
          break;
        case ">=":
          bOk=v>=v1;
          break;
        case "<=":
          bOk=v<=v1;
          break;
      }
    }else{
      if(_Util._isRegexData(v1)){
        v1=eval(v1);
      }
      bOk=Boolean(v.match(v1))
    }

    if(!bOk){
      d._actual=_org;
      if(_force){
        if (d._orgData.expectation===undefined || d===null || d===""){
          _bRebuild=true;
        }else{
          _bRebuild=true;
        }
      }
      if(_bRebuild){
        d._orgData.expectation=_org;
        d._orgData.md5="";
        _result._type=_taskInfo._type._warning;
        _result._msg="_replaceExpectation";
        _result._data=d;
      }else{
        _result._type=_taskInfo._type._failed;

        _result._msg=_bzMessage._task.UnMatch+": "+v+" => "+v1;
        _result._errSou=_taskInfo._errSou._exp;
        _result._newData=_org;
        if((d._orgData.expectation||"").includes("{{")){
          _result._orgRealValue=v1;
        }
      }
    }else{
      _result._type=_taskInfo._type._success;
    }
    
    return _result;
  },
  _validateHtml:function(_data,_force){
    var _result=_domActionTask._extractDataByHtml(_data);

    if(_result._type==_taskInfo._type._success){
      if(!["exist","unexist"].includes(_data.content.type)){
        if(_data.content.type=="data"){
          _result = _domActionTask._compareWithDataExpectation(_data,_result._extractData,_force);
        }else{
          _result = _domActionTask._compareWithExpectation(_data,_result._extractData,_force);
        }
        if(_result._type==2){
          document.body._bzValidateData.find(x=>{
            if(x._key==_data._key){
              if(x._html&&x._html!=_calcMD5(_data.e.outerHTML)){
                _result._type=_taskInfo._type._notReady;
              }
            }
          })
        }else if(_result._type==1){
          document.body._bzValidateData.find(x=>{
            if(x._key==_data._key){
              if(!x._html&&!_data.e){
                _result._type=_taskInfo._type._notReady;
              }
            }
          })
        }
      }else if(_data.content.type=="unexist"){
        _result._type=_taskInfo._type._failed
        _result._msg=_bzMessage._system._error._existError
      }
    }else if(_data.content.type=="unexist"){
      _result._type=_taskInfo._type._success
    }
    return _result;
  },
  _validateJs:function(_data,_fun,$parameter,$test,$module,$loop){
    $parameter=$parameter||window.$parameter
    $test=$test||window.$test
    $module=$module||window.$module
    $loop=$loop||window.$loop
    
    _domActionTask._extractDataByJs(_data,function(_result){
      if(_result._type==_taskInfo._type._success){
        if(!_result._extractData){
          _result._type=_taskInfo._type._failed
        }else if(_result._extractData=="bz-stop"){
          _result._bzStop=1
        }
      }
      return _fun(_result);
    },$parameter,$test,$module,$loop);
  },
  _extractDataByHtml:function(_data){
    var _element=_data.element;
    _domActionTask._setErrorPos({},"_element","_actionDetailsGeneral");
    var _dom=_domActionTask._findElement(_data);
    if(_dom){
      if(_data.type!=_ideActionData._type._extractData){
        var _content = null;
        var _cType=_data.content.type;
        if(["exist","unexist"].includes(_cType)){
        }else if(_cType=="innerText"){
          _content=_Util._formatInnerText($util.getElementText(_dom,1));
          
          if(_data.content.preFormat){
            try{
              _content=_content.replace(new RegExp(_data.content.preFormat),_data.content.replace)
            }catch(e){
              if(!BZ._isAutoRunning()){
                alert(e.message)
              }
            }
          }
        }else if(_cType=="value"){
          if(_dom.tagName=="SELECT"){
            _content=""
            for(var i=0;i<_dom.selectedOptions.length;i++){
              if(_content){
                _content+="\n"
              }
              _content+=_dom.selectedOptions[i].text
            }
          }else if(_dom.tagName=="INPUT"&&_dom.type=="checkbox"){
            _content=_dom.checked?"on":"off"
          }else{
            _content=_dom.value
          }
        }else if(_cType=="enable"){
          _content=!(_dom.disabled||$(_dom).attr("disabled")||"")
        }else if(_cType=="disable"){
          _content=(_dom.disabled||$(_dom).attr("disabled")||"")+""
        }else if(_cType=="checked"){
          _content=_dom.checked||$(_dom).attr("checked")||""
        }else if(_cType=="data"){
          _content=_dom;
        }

        if(_data._preDom){
          _data._preDom._changed=_calcMD5(_dom.outerHTML)!=_data._preDom.html
        }
      }else{
        _content=window.$element
      }
      return {
        _type:_taskInfo._type._success,
        _extractData:_content
      };
    }else{
      return {
        _type:_taskInfo._type._error,
        _msg:_bzMessage._system._error._missElement,
        _errSou:_taskInfo._errSou._element
      };
    }
  },
  _doDrag:function(d,_fun){
    let r=d.e.getBoundingClientRect(),x=r.left,y=r.top;
    if(d.e&&d.e.tagName=="CANVAS"&&d.e.bzTxtElement){
      x+=d.e.bzTxtElement.x
      y+=d.e.bzTxtElement.y
    }
    let x2=parseFloat(d.event.moveToX||0),
        y2=parseFloat(d.event.moveToY||0);
    var tr=new DataTransfer(),te,
        _dom=_domActionTask._findElement(d);

    var _result={_type:_taskInfo._type._failed}
    
    var ps=[{_action:"mousedown", x:x, y:y}];
    let t=10,
        xs=(x2-x)/t,
        ys=(y2-y)/t;
    for(var i=0;i<t;i++){
      let xx=x+xs*i,
          yy=y+ys*i
      
      ps.push({_action:"mousemove", x:xx, y:yy})
    }
    ps.push({_action:"mousemove", x:x2, y:y2});
    ps.push({_action:"mouseup", x:x2, y:y2});
    _exeMouseGroup()
    
    function _exeMouseGroup(){
      var p=ps.shift()
      if(p){
        setTimeout(function(){
          $util.triggerMouseEvent(_dom,p._action,d.event.button,p.x,p.y,d.event.ctrl,d.event.alt,d.event.shift,tr);
          _exeMouseGroup()
        },100);
      }else{
        _fun({_type:_taskInfo._type._success,_errorPos:_domActionTask._errorPos})
      }
    }
  },
  _doDragdrop:function(d,_fun){
    var x=parseFloat(d.event.x||1),y=parseFloat(d.event.y||1);
    var tr=new DataTransfer(),te,r;

    var _result={_type:_taskInfo._type._failed}
    if(x>=0 && y>=0){
      var _element=d.element;
      _domActionTask._setErrorPos({},"_element","_actionDetailsGeneral");
      var _dom=_domActionTask._findElement(d),_dom2;
      if(d.event.element && d.event.element.length){
        let _lastTxtElement=_dom.bzTxtElement
        
        _dom2=_domActionTask._findElement(d.event);
        if(_dom2.tagName=="CANVAS"&&_dom2.bzTxtElement){
          r=_dom2.getBoundingClientRect()
          te=_dom2.bzTxtElement
          x=r.left+te.x+te.w/2
          y=r.top+te.y+te.h/2

          if(d.event.offset){
            var xy = _Util._getDomXY(_dom2);
            let aa={
              x:parseFloat(xy.x)+_dom2.bzTxtElement.x,
              y:parseFloat(xy.y)+_dom2.bzTxtElement.y,
              h:_dom2.bzTxtElement.h,
              w:_dom2.bzTxtElement.w
            }
            let _offset=_bzDomPicker._getOffsetPoint(aa,d.event.offset)
            x=_offset.x
            y=_offset.y
          }


          if(_lastTxtElement&&_dom==_dom2){
            _dom.bzTxtElement=_lastTxtElement
          }
        }
      }
      if(!_dom2){
        _dom2=_Util._getElementByXY(_dom.ownerDocument.body,d.event.x,d.event.y)
      }
      var xy=_Util._getDomXY(_dom);
      var _rect=_dom.getBoundingClientRect();
      if(_dom.tagName=="CANVAS"&&_dom.bzTxtElement){
        te=_dom.bzTxtElement;

        xy.x=_rect.left+te.x+te.w/2
        xy.y=_rect.top+te.y+te.h/2
      }else{
        xy.x+=parseInt(_rect.width/2);
        xy.y+=parseInt(_rect.height/2);
      }
      var t=10;
      var xs=parseInt((x-xy.x)/t);
      var ys=parseInt((y-xy.y)/t);

      var ps=[{_action:"mousedown", x:xy.x, y:xy.y}];
      
      // if(_dom.tagName=="CANVAS"&&_dom.bzTxtElement){
        // ps=[{_action:"mousedown", x:-1, y:-1}];
      // }
      
      ps.push({_action:"dragstart", x:xy.x, y:xy.y,tr:tr});
      ps.push({_action:"drag", x:xy.x, y:xy.y,tr:tr});
      
      for(var i=0;i<t;i++){
        let xx=xy.x+=xs,
            yy=xy.y+=ys
        
        if(r&&r.left<xx&&r.right>xx&&r.top<yy&&r.bottom>yy){
          ps.push({_action:"mousemove", x:xx, y:yy,_dom:_dom2})
        }else{
          ps.push({_action:"mousemove", x:xx, y:yy})
        }
      }

      ps.push({_action:"mousemove", x:x, y:y,_dom:_dom2});
      ps.push({_action:"dragenter", x:x, y:y,_dom:_dom2,tr:tr});
      ps.push({_action:"dragover", x:x, y:y,_dom:_dom2,tr:tr});
      ps.push({_action:"mouseup", x:x, y:y,_dom:_dom2});
      ps.push({_action:"drop", x:x, y:y,_dom:_dom2,tr:tr});
      ps.push({_action:"dragend", x:x, y:y,tr:tr});
      _exeMouseGroup()
      
      function _exeMouseGroup(){
        if(ps.length){
          var p=ps.shift()
          setTimeout(function(){
            $util.triggerMouseEvent(p._dom||_dom,p._action,d.event.button,p.x,p.y,d.event.ctrl,d.event.alt,d.event.shift,p.tr);
            _exeMouseGroup()
          },100);
        }else{
          _fun({_type:_taskInfo._type._success,_errorPos:_domActionTask._errorPos})
        }
      }
    }else{
      _domActionTask._setErrorPos({},"xy","_actionDetailsGeneral");
      _result._errorPos=_domActionTask._errorPos;
      _fun(_result)
    }
  },
  _closeLastHover:function(_dom){
    if(_domActionTask._lastHover&&_dom){
      let ns=[]
      _domActionTask._lastHover.forEach(x=>{
        if(x.o!=_dom&&!$(x.o).find(_dom).length){
          $(x.o).removeClass(x.o._tmpClass)
          _Util._removeCSSRule(x.o._rule)
        }else{
          ns.push(x)
        }
      })
      if(!ns.length){
        _domActionTask._lastHover=0
      }else{
        _domActionTask._lastHover=ns
      }
    }
    if(!_domActionTask._lastHover){
      $(document.body).unbind("mouseover",_domActionTask._closeLastHover)
    }
  },
  //Trigger event action
  _trigger:function(d,_fun){
    if(d.type==1){//event only
      _domActionTask._prepareValidation();
    }
    var _result={_type:4},dd;
    try{
      dd=d.event.alerts||(d.event.popType?[{
        popType:d.event.popType,
        expectation:d.expectation,
        returnValue:d.event.returnValue,
        popFollow:d.event.popFollow
      }]:0)
      if(dd){
        TWHandler._popExpected.alert=[]
        TWHandler._popExpected.confirm=[]
        TWHandler._popExpected.prompt=[]
        dd.forEach(ddd=>{
          TWHandler._popExpected[ddd.popType].push({
            expectation:ddd.expectation,
            returnValue:ddd.returnValue,
            popFollow:ddd.popFollow
          });
        })
      }
      
      _domActionTask._setErrorPos(_result,"_element","_actionDetailsGeneral");
      var dom=_domActionTask._findElement(d);
      if(!dom){
        //on retryable action
        return _fun&&_fun(_result);
      }
      _domActionTask._closeLastHover(dom)
      if(["BUTTON","INPUT","TEXTAREA","SELECT"].includes(dom.tagName)){
        if(dom.disabled){
          _result._type=_taskInfo._type._error
          _result._msg=_bzMessage._system._error._disableElement
          _result._errSou=_taskInfo._errSou._element;
          if(_fun){
            _fun(_result)
          }
          return
        }
      }

      var _eType=d.event.type;
      var _action=d.event.action;
      //keypress
      if (_eType=="key") {
        if(d.event.value){
          dom.value=""
          
          _triggerKeyGroup(dom,d.event.value,0)
          
        }else if(_action=="group"){
          return $util.triggerKeyEvents(dom,d.event.keyCode,d.event.charCode,d.event.ctrl,d.event.alt,d.event.shift,_doAfterKeyEvent);
        }else{
          $util.triggerKeyEvent(dom,_action,d.event.keyCode,d.event.charCode,d.event.ctrl,d.event.alt,d.event.shift);
        }
        if(_Util._isStdInputElement(dom) && (d.event.char || d.event.value) && _action=="group"){
          $util.triggerChangeEvent(dom,$(dom).val(),1,_result,0,0,0,1)
        }
      //mouse (click)
      }else if (_eType=="mouse") {
        _domActionTask._preCkRepElement(d,_result)

        if(_result._type!=_taskInfo._type._error){
          _Util._removeLinkTarget(dom);
          if(["group","click"].includes(_action) && d.event.button!=2){
            return $util.triggerMouseEvents(dom,parseInt(d.event.button)||1,d.event.x,d.event.y,d.event.ctrl,d.event.alt,d.event.shift,function(){
              if(!_checkPop()){
                return
              }
              if(d._reTrigger){
                return _fun(_result)
              }
              return _exeRepElementAction(d,_result,_fun)
            });
          }else if(_action=="DOMMouseScroll"){
            $util.triggerWheelEvent(dom,d.event.y);
          }else if(_action=="dblclick"){
            $util.triggerDblClickEvents(dom,parseInt(d.event.button)||1,d.event.x,d.event.y,d.event.ctrl,d.event.alt,d.event.shift);
            return _exeRepElementAction(d,_result,_fun)
          }else if(_action=="hover"){
            _domActionTask._lastHover=$util.triggerHover(dom)
            $(document.body).bind("mouseover",_domActionTask._closeLastHover)
          }else{
            return $util.triggerMouseEvent(dom,_action,d.event.button,d.event.x,d.event.y,d.event.ctrl,d.event.alt,d.event.shift,0,function(){
              return _exeRepElementAction(d,_result,_fun)
            });
          }
        }
      //change
      }else if(_eType=="change"){
        var v=$util.generateDataByRegex(d.event.value||"")

        if(!_Util._isObjOrArray(v)){
          v+=""
        }else if(v.constructor==Object){
          return _domActionTask._exeFillForm(d,_fun)
        }
        if(["bz-skip-group"].includes(v)){
          _result._bzSkipGroup=1
          if(_fun){
            _fun(_result)
          }
          return;
        }else if(["bz-skip"].includes(v)){
          _result._bzSkip=1
          if(_fun){
            _fun(_result)
          }
          return;
        }else if(v=="bz-stop"){
          _result._bzStop=1
          if(_fun){
            _fun(_result)
          }
          return;
        }
        d.event.value=v
        if(_Util._isDateValue(v)||(v.constructor==Array&&!v.find(x=>!_Util._isDateValue(x)))){
          if(d.e.tagName!="INPUT"||d.e.readOnly||v.constructor==Array){
            return _calendarInputHandler._trigger(d,function(r){
              _fun(r)
            })
          }
        }

        if(dom.type=="radio"){
          try{
            if(v.startsWith("/{random")){
              dom=$util.randomItem($("input[name='"+dom.name.replace(/'/g,"\\'")+"']").toArray()).value
              v=dom.value
              _domActionTask._setRandomValueToVariable(v,d)
            }else{
              dom=$("input[name='"+dom.name.replace(/'/g,"\\'")+"'][value='"+v.replace(/'/g,"\\'")+"']")[0]||dom
            }
          }catch(e){}
          $util.triggerMouseEvents(dom,1,0,0,0,0,0);

        }else if (dom.type && dom.type=="checkbox") {
          if((!v||v=='off'||v=="false") != !dom.checked){
            $util.triggerMouseEvents(dom,1,0,0,0,0,0);
          }
        }else if(_cssHandler._isNatureCustomizeInput(dom)){
          /**********************************/
          //set value on customize dropdown 
          /**********************************/
          return _domActionTask._exeSetValueOnUnInput(d,dom,function(v){
            _result._type=v
            _fun(_result)
          })
        }else{
          try{
            if(dom.tagName=="INPUT" && dom.type=="file" && window.extensionContent){
              if(v && v.constructor==String){
                if(v.match(/^[\/]?example\..+$/)){
                  v=SERVER_HOST+"/file/"+v.replace("/","")
                }
                _Util._getFileFromUrl(v,function(v){
                  _setFileFun(d,dom,v,_fun)
                })
              }else if(v&&v.constructor==Array&&v[0]&&v[0].constructor==String){
                _domActionTask._fetchMultipleFileDataFromURL(v,function(v){
                  _setFileFun(d,dom,v,_fun)
                })
              }else{
                _setFileFun(d,dom,v,_fun)
              }
              return
            }else if(v.constructor==Array&&dom.tagName=="SELECT"){
              for(let k of dom.options){
                if(v.includes(k.text)){
                  $(k).prop("selected",true)
                }else{
                  $(k).prop("selected",false)
                }
              }
            }else if(v.startsWith("/{random")&&dom.tagName=="SELECT"){
              let vs=[],e=v.split(":")[1],f,os
              if(e){
                e=e.split("|")
                f=e[0]
                e=e[1]
                if(e){
                  if(e.endsWith("}/")){
                    e=e.substring(0,e.length-2).split(",")
                  }
                }
              }
              if(f&&f[0]=="!"){
                f=f.substring(1)
                if(f.endsWith("}/")){
                  f=f.substring(0,f.length-2)
                }
                os=$(dom).find("*").not(f).toArray()
              }else{
                os=$(dom).find(f||"option").toArray()
              }
              
              for(var i =0;i<os.length;i++){
                let x=os[i].text
                if(x&&(!e||!e.includes(x))){
                  vs.push(x)
                }
              }
              v=$util.randomItem(vs).value
              _domActionTask._setRandomValueToVariable(v,d)
            }
            return $util.triggerChangeEvent(dom,v,d.event.autoBlur,_result,d.withEntry,d.withSubmit,function(){
              _doAfterKeyEvent()
            },d.disableAISet);
          }catch(ex){
            //DO NOT REMOVE!!!!
            //Sometime trigger customer key event error
            console.log(e.stack)
          }
        }
      }
      if(!_checkPop()){
        return
      }
    }catch(e){
      _result._type=_taskInfo._type._error;
      _result._msg=_bzMessage._system._error._missElement;
      _result._errSou=_taskInfo._errSou._element;
    }
    if(_fun){
      _fun(_result)
    }
    
    function _exeRepElementAction(d,_result,_fun){
      return _domActionTask._ckRepElement1(d,_result,function(){
        if(_fun){
          _fun(_result)
        }
      })
    }
    function _setFileFun(d,dom,vs,_fun){
      if(vs.constructor==Array){
        let v=vs.shift()
        if(v){
          _setFileFun(d,dom,v,function(){
            _setFileFun(d,dom,vs,_fun)
          })
        }else{
          _fun({_type:4})
        }
      }else{
        $util.triggerChangeEvent(dom,vs,d.event.autoBlur,0,0,0,()=>{
          _fun({_type:4})
        });
      }
    }
    function _triggerKeyGroup(dom,s,i){
      if(i>=s.length){
        return _doAfterKeyEvent()
      }
      var c=s[i].charCodeAt(0),k;
      if(c==10){
        k=13;
      }else{
        k=c-32;
      }
      $util.triggerKeyEvents(dom,k,c,false,false,false,function(){
        _triggerKeyGroup(dom,s,i+1)
      });
    }
    function _doAfterKeyEvent(){
      if(_Util._isStdInputElement(dom) && (d.event.char || d.event.value) && _action=="group"){
        $util.triggerChangeEvent(dom,$(dom).val(),1,_result,0,0,0,1)
      }
      if(!_checkPop()){
        return
      }
      if(_fun){
        _fun(_result)
      }
    }
    function _checkPop(){
      if(!_IDE._data._curVersion.setting.content.ignorePopValidation){
        var _popAction=localStorage.getItem("BZ-Action-pop");
        if(!_popAction){
          var _msgObj = TWHandler._chkPopInfo(d);
          if(_msgObj && _msgObj=="wait"){
            localStorage.setItem("BZ-Action-pop",_result)
            return _recheck(0)
            
            function _recheck(i){
              setTimeout(function(){
                _msgObj = TWHandler._chkPopInfo(d,i==100?1:0);
                if(_msgObj && _msgObj=="wait" && i<100){
                  return _recheck(++i);
                }else if(_msgObj){
                  _setPopResult(_msgObj);
                }
                _fun(_result)
              },100);
            }
          }else if(_msgObj){
            localStorage.setItem("BZ-Action-pop",_result)
            _setPopResult(_msgObj);
          }
          function _setPopResult(_msgObj){
            _result._type=_taskInfo._type._failed;
            _result._msg=_msgObj;
            _result._missingPopMsg=true;
            _result._errSou=_taskInfo._errSou._element;
            localStorage.removeItem("BZ-Action-pop");
          }
        }else{
          localStorage.removeItem("BZ-Action-pop");
        }
      }
      return 1
    }
  },
  _getActionExpectReactionTime:function(a){
    return parseInt(a.max||((_IDE._data._setting.advanced[a._supData?a._supData.hostId||0:0]||{}).expectReactionTime)||2000);
  },
  /**********************************/
  //set value on customize dropdown 
  //a: action, e: element
  /**********************************/
  _exeSetValueOnUnInput:function(a,e,_bkFun,_ignoreForce){
    let _curInputDom=e
    _domActionTask._doLog("Auto set uninput value on: "+e.outerHTML)
    if(!_ignoreForce){
      let _focus=$(":focus")[0]
      if(_focus){
        return $util.triggerBlurEvent(_focus,function(){
          setTimeout(()=>{
            _domActionTask._exeSetValueOnUnInput(a,e,_bkFun,1)
          },10)
        })
      }
    }
    
    _Util._preTriggerEvent()

    let _values=_Util._clone(a.event.value),
        _value=a.event.value,//current value
        rs,//request
        // cs,//UI exist item;
        _times,
        _valueIdx=0,
        _newElements=[],
        _preValue=_Util._toTrimSign(_cssHandler._getElementScope(e).innerText),
        _start=Date.now(),
        _period=_domActionTask._getActionExpectReactionTime(a),
        _isCheckSet=a.element.find(x=>{
          return (x+"").includes(a.event.value)
        })

    if(_values.constructor!=Array){
      _values=[a.event.value]
    }

    if(_selectOption(e,_values,function(r){
      return _bkFun(r)
    })){
      return
    }
    if(_selectMultip(e,_values,a)){
      return _bkFun(4)
    }

    // _prepareValues()
    let _elementList=_getElementList(e)
        // _observer=_buildObserver();

    if(e&&e.innerText==a.event.value){
      _Util._log("Exe Click of no-input")
      return _exeClick(e,0,function(){
        setTimeout(()=>{
          _newElements=_Util._getDiffAfterTriggerEvent(1,1);
          if(_newElements.length){
            if(_isCheckSet&&!_newElements.find(x=>(x.innerText||"").toLowerCase().includes(a.event.value.toLowerCase()))){
              return _end(4)
            }
            _findTarget(0,_doIt)
          }else{
            _bkFun(4)
          }
        },100)
      })
    }

    _doIt()
    
    function _selectOption(e,_options,_fun){
      let os=_cssHandler._getOptionElementByBZFlag(e)||_cssHandler._isList(e,1),
          r=4
      if(os){
        _options.find((x,i)=>{
          if(x=="/{random}/"){
            if(a._requestErgodicDom&&!a._requestErgodicDom._ergodicValueList){
              d._ergodicValueList=os
            }else{
              _Util._randomList(os)
            }
            x=os[0]
          }
          if(!os.find((o,j)=>{
            if(_Util._isRegexData(x)){
              x=eval(`${x}i`)
              if((o.innerText||o).toLowerCase().match(x)){
                _exeClick(o)
                os.splice(j,1)
                return 1
              }
            }else if(o==x||o.innerText.toLowerCase()==x.toLowerCase()){
              _exeClick(o)
              os.splice(j,1)
              return 1
            }
          })){
            r=1
            return 1
          }
        })
        _fun(r)
        return 1
      }
    }

    function _doIt(){
      _value=_values[_valueIdx]
      TWHandler._curRequestList.length=0
      _times=0
      if(_value){
        if(!_valueIdx){
          // cs=$(":equal("+_value+")").toArray(),
          // _Util._spliceAll(cs,c=>{
            // return _Util._isHidden(c)
          // })
          _exe(_elementList,0)
        }else{
          // cs=[]
          setTimeout(()=>{
            _findTarget(0,function(v){
              _fun(v)
            })
          },BZ._isAutoRunning()?0:500)
        }
      }else{
        _end(4)
      }
    }
    
    function _fun(v){
      if(v){
        _valueIdx++
        //Do next value
        _doIt()
      }else{
        //result is Failed
        _end(1)
      }
    }
    
    function _end(v){
      _bkFun(v)

      // _exeClick(BZ.TW.document.body,0,function(){
      //   _bkFun(v)
      // })
    }
    
    function _exe(es){
      let x=es.shift(),
          _curFun;
      if(x&&Date.now()-_start<60000){
        let er=x.getBoundingClientRect()
        if(!er.height||!er.width){
          return _exe(es)
        }
        if(_Util._isInputObj(x,1)){
          if(_value!==undefined&&_isEditableInput(x)&&_value!="/{random}/"){
            _curFun=_exeChange
          // }else if(!_value){
          //   return _end()
          }else{
            return _exe(es)
          }
        }else{
          _curFun=_exeClick
        }
        _curFun(x,1,function(v){
          if(v){
            $(x).blur()
            _fun(1)
          }else{
            _exe(es)
          }
        })
      }else{
        _fun()
      }
    }
    
    function _exeChange(o,_continueTarget,_fun){
      $util.triggerChangeEvent(o,_value,0,0,0,0,function(){
        _domActionTask._doLog("auto fill input: "+o.outerHTML)
        _findTarget(_cssHandler._getElementScope(o),_fun,1)
      },1)
    }
    
    function _exeClick(o,_continueTarget,_fun){
      $util.triggerMouseEvents(o,1,0,0,0,0,0,function(){
        setTimeout(()=>{
          _continueTarget?_findTarget(_cssHandler._getElementScope(o),_fun):_fun&&_fun(1)
        },100)
      })
    }
    
    function _findTarget(_exceptScope,_fun,_fromInput,_waitTimes){
      _waitTimes=_waitTimes||0
      setTimeout(()=>{
        if(TWHandler._curRequestList.length){
          if(!rs){
            rs=_Util._clone(TWHandler._curRequestList)
          }
          if(rs.find(r=>{
            return TWHandler._curRequestList.find(rr=>{
              return rr.url==r.url
            })
          })){
            return _findTarget(_exceptScope,_fun,_fromInput,_waitTimes)
          }
        }
        if(!_findItem(_exceptScope,"equal")&&!_findItem(_exceptScope,"Contains")){
          _newElements=_Util._getDiffAfterTriggerEvent(1,1);
          if(_fromInput||!_newElements.find(n=>{
            if(n.nodeType!=1){
              n=n.parentElement
            }
            if(!n){
              return
            }
            if(a.event.fromPanel&&!$(n).is(a.event.fromPanel)){
              return
            }
            let os=_Util._findInputs(n)
            
            return os.find(o=>{
              if(_isEditableInput(o)&&_value!=="/{random}/"){
                _exeChange(o,1,_fun)
                return 1
              }
            })
          })){
            if((_waitTimes<10&&!_fromInput)||Date.now()-_start<_period){
              _findTarget(_exceptScope,_fun,_fromInput,_waitTimes+1)
            }else{
              _fun()
            }
          }
        }else{
          _fun(1)
        }
      },50)
    }
    
    function _findItem(_exceptScope,_bzPathMethod){
      _newElements=_Util._getDiffAfterTriggerEvent(1,1);
      return _newElements.find(n=>{
        if(a.event.fromPanel&&!$(n).is(a.event.fromPanel)){
          return
        }
        if(_exceptScope){
          if(n.nodeType!=1){
            n=n.parentElement
          }
          if(!n){
            return
          }
          let nt=n.getBoundingClientRect(),
              et=_exceptScope.getBoundingClientRect()
          if(_exceptScope==n||$(_exceptScope).find(n).length){
            return
          }
        }

        if(_value=="/{random}/"){
          let _random=_findRandomValue(n)
          if(!_random){
            return
          }else{
            _values[_valueIdx]=_value=_random
            try{
              let vv=a._orgData.event.value
              if(vv.match(/^\{\{.+\}\}$/s)){
                vv=vv.substring(2,vv.length-2)
                if(_values.length==1){
                  _Util._setSysObj(vv,_value)
                }else{
                  _Util._setSysObj(vv,_values)
                }
              }
            }catch(e){}
          }
        }
        _Util._newFindDom()
        let os=$(n).find(":"+_bzPathMethod+"("+_value+")").toArray().reverse();
        
        if(os.length){
          let _triggered=0
          os.forEach(o=>{
            let or=o.getBoundingClientRect()
            if(or.width&&or.height){
              _triggered=1
              $util.triggerMouseEvents(o,1,0,0,0,0,0)
              return 1
            }
          })
          return _triggered
        }
      })
    }
    
    function _findRandomValue(o,_style){
      if(o.tagName=="BODY"){
        return
      }
      let os=_Util._getTargetElement($(o).find(":endContains(/./)"))
      _Util._spliceAll(os,x=>{
        return !$util.getElementText(x)||!_Util._toTrimSign(x.innerText)||_Util._isHidden(x)||x.getBoundingClientRect().width<5||x.getBoundingClientRect().height<5||(_style&&!_cssHandler._getElementScope(x,_style))
      })

      _Util._filterEndElementList(os)

      if(!BZ._isPlaying()&&a._requestErgodicDom&&_Util._isEmpty(a._requestErgodicDom._ergodicValueList)){
        a._requestErgodicDom._ergodicValueList=os.map(x=>$util.getElementText(x)).filter(x=>x)
        if(_Util._isEmpty(a._requestErgodicDom._ergodicValueList)){
          return
        }
        a._requestErgodicDom._ergodicIdx=0
        return a._requestErgodicDom._ergodicValueList[0]
      }
      while(os.length){
        o=$util.randomItem(os)
        if(o&&o.value){
          let v=$util.getElementText(o.value)
          if(!_preValue||_Util._toTrimSign(v)!=_preValue||os.length==1){
            return v
          }
        }else{
          return
        }
      }
    }
    function _isEditableInput(o){
      let or=o.getBoundingClientRect()
      return o.tagName=="INPUT"&&!o.readonly&&!$(o).attr("readonly")&&!$(o).attr("disabled")&&!o.disabled&&or.width&&or.width&&!["checkbox","radio","file"].includes(o.type)
    }
    function _getElementList(e){
      let s=_cssHandler._getElementScope(e)
      let es=$(s).find("*").toArray()
      
      es.splice(es.indexOf(e),1)
      es.unshift(e)
      es.push(s)
      es.find(x=>{
        if(_Util._isInputObj(x,1)&&!_Util._isHidden(x)&&!["checkbox","radio","file"].includes(x.type)){
          es.unshift(x)
          return 1
        }
      })
      return es
    }
    
    function _selectMultip(e,vs,a){
      let ws=$util.getElementText(e).split(/\s/),
          _chkEqual=`:endEqual(/${vs.join("|")}/)`,
          os
      if(vs.find(x=>{
        return !ws.includes(x)
      })){
        return 
      }
      
      os=$(e).find(`INPUT[type=checkbox]:near(/${vs.join("|")}/)`);
      if(os.length){
        $(e).find(`INPUT[type=checkbox]:checked`).click()
        $(os).click()
      }else{
        return
      }
      return 1
    }
  },
  _setRandomValueToVariable:function(v,a){
    if(_Util._hasCode(a._orgData.event.value)){
      try{
        let cc=a._orgData.event.value.replace(/[\{\}]/g,"")
        _Util._setSysObj(cc,v)
      }catch(e){
      }
    }
  },
  _mouseoverItems:function(e,ck,_fun){
    let _org=e
    $util.triggerMouseEvent(e,"mouseover")
    $util.triggerMouseEvent(e,"mousemove")
    setTimeout(function(){
      if(!_chkFun(e)){
        _triggerChildren(e)
        setTimeout(function(){
          if(!_chkFun(e)){
            let p=_triggerParents(e,_org)
            setTimeout(function(){
              if(!_chkFun(p)){
                _fun()
              }
            },10)
          }
        },10)
      }
    },10)
    
    function _triggerParents(e,_org){
      e=e.parentElement
      let r=_org.getBoundingClientRect()
      let pr=e.getBoundingClientRect()
      if(pr.width<=r.width+50&&pr.width>=r.width&&pr.height<=r.height+10&&pr.height>=r.height){
        $util.triggerMouseEvent(e,"mouseover")
        $util.triggerMouseEvent(e,"mousemove")
        return _triggerParents(e,_org)
      }else{
        return e
      }
    }
    
    function _triggerChildren(e){
      for(var i=0;i<e.children.length;i++){
        let ee=e.children[i]
        $util.triggerMouseEvent(ee,"mouseover")
        $util.triggerMouseEvent(ee,"mousemove")
        _triggerChildren(ee)
      }
    }
    
    function _chkFun(e){
      let o=$(e).find(ck)[0]
      if(o){
        _fun(o)
        return 1
      }
    }
  },
  _doComment:function(_data){
    _domActionTask._setErrorPos({},"_element","_actionDetailsGeneral");
    var _dom=_domActionTask._findElement(_data);
    
    
    if(_tipHandler._showItem(_data)){
      return {_type:_taskInfo._type._success};
    }else{
      return {_type:_taskInfo._type._failed};
    }
  },
  _getJsonAfterIgnore:function(d,_ignoreKeys,_ignoreValues,_nullValue,_emptyValue){
    _ignoreKeys=(_ignoreKeys||"").trim();
    _ignoreValues=(_ignoreValues||"").trim();
    
    if(d.constructor==Array || d.constructor==Object){
      for(var k in d){
        if(!_ignoreKeys || !k.match(_ignoreKeys)){
          var v=_domActionTask._getJsonAfterIgnore(d[k],_ignoreKeys,_ignoreValues,_nullValue,_emptyValue);
          if(_emptyValue && v===""){
            delete d[k];
          }else if(_nullValue && v===null){
            delete d[k];
          }else if(v && v.constructor!=Object && v.constructor!=Array){
            v=v.toString();
            if(_ignoreValues && v.match(_ignoreValues)){
              delete d[k];
            }else{
              d[k]=v;
            }
          }else{
            d[k]=v;
          }
        }else{
          delete d[k]
        }
      }
    }
    return d;
  },
  _compareWithDataExpectation:function(d,o,_force){
    var _result={_type:_taskInfo._type._success,_msg:""},_valids=[];
    _domActionTask._setErrorPos(_result,"_expectation","_actionDetailsGeneral");
    var vs=(d.expectation||"").split("\n");
    var _text=$util.getElementText(o)
    var _inputs=_cssHandler._findAllInputs(d.e)
    _inputs&&_inputs.forEach(u=>{
      var w=_ideDataBind._getBindData(u,1,1)
      if(w){
        w=w.split(".")[1]
        if(!w){
          return
        }
        let m=BZ._getCurModule()
        if(m._data.bt=="data"){
          let f=_aiGeneratorDataHandler._getFieldByName(w,m)
          if(f){
            w=f.data
          }
        }
        let i=_findMapData(vs,w)
        if(i!==undefined){
          let v=vs[i],_found=0
          if(v=="bz-skip"){
            vs.splice(i,1)
            return
          }
          if(u.type=="checkbox"){
            if(v&&u.checked&&v!="off"&&v!="false"){
              _found=1
            }else if((!v||v=="off"||v=="false")&&!u.checked){
              _found=1
            }
          }else if(u.tagName=="SELECT"){
            if(v==u.selectedOptions[0].text){
              _found=1
            }
          }else if(u.value==v){
            _found=1
          }
          if(_found){
            _valids.push(u)
            vs.splice(i,1)
          }
          return
        }
      }
    })
    
    for(var i=0;i<vs.length;i++){
      try{
        var vv=vs[i];
        if(!vv.trim()){
          throw new Error("Empty value");
        }

        if(!vv&&vv!==0&&vv!==false){
          continue
        }else if(["bz-skip","bz-ignore"].includes(vv)){
          
          continue
        }else if(v=="bz-stop"){
          _result._bzStop=1
          break;
        }
        if(!_text.includes(vv)){
          _result._type=_taskInfo._type._failed;

          _result._msg=_bzMessage._task.UnMatch+": \n\n"+v+` (${vv})`;
          _result._errSou=_taskInfo._errSou._exp;
          break;
        }else{
          _valids.push($(":Contains("+vv+"):last")[0])
        }
      }catch(e){
        _result._type=_taskInfo._type._failed;
        _result._msg+=e.message+" ("+v+")\n";
        _result._errSou=_taskInfo._errSou._exp;
        break;
      }
    }
    _bzDomPicker._showTmpCover(_valids,0,0,1)
    if(_force && _result._type!==_taskInfo._type._success){
      alert(_result._msg)
    }
    return _result;

    function _findMapData(vs,w){
      let _max
      for(var i=0;i<vs.length;i++){
        let ww=vs[i].split(".").pop()
        let v=_glossaryHandler._getSimilarityRate(ww,w)
        if(v._type==1){
          return i
        }
        if(!_max||_max._size<v._size){
          _max={v:ww,_size:v._size,i:i}
        }
      }
      if(_max&&_glossaryHandler._isSimilarityWord(_max.v,w)){
        return _max.i
      }
    }
  },
  _extractDataByJs:function(_data,_fun,$parameter,$test,$module,$loop){
    $parameter=$parameter||window.$parameter
    $test=$test||window.$test
    $module=$module||window.$module
    $loop=$loop||window.$loop
    window.$result=window.$result||{}
    if(_data.script){
      var element;
      if(_data.element){
        _domActionTask._setErrorPos({},"_element","_actionDetailsGeneral");
        element = _domActionTask._findElement(_data);
      }
      var s=_data.script.trim();
      if(s[s.length-1]==";"){
        s=s.substring(0,s.length-1);
      }
      try{
        var v=eval(s)
        if(v&&v.constructor==Function){
          return setTimeout(function(){
            try{
              v=v()
              _fun({
                _type:v?_taskInfo._type._success:_taskInfo._type._failed,
                _extractData:v,
                _msg:$result.msg
              })
            }catch(ee){
              _fun({
                _type:_taskInfo._type._error,
                _extractData:v,
                _msg:ee.message
              })
            }
          },100)
        }else if(!v){
          return _fun({
            _type:_taskInfo._type._failed,
            _extractData:v,
            _msg:_bzMessage._task.UnMatch+"\n\n"+($result.msg?$result.msg:_domActionTask._getCurDataExpress(s))
          })
        }
      }catch(e){
        return _fun({
          _type:_taskInfo._type._error,
          _extractData:undefined,
          _msg:e.message
        });
      }
    }else{
      var v=undefined;
    }
    _fun({
      _type:_taskInfo._type._success,
      _extractData:v
    });
  },
  /*
  var data=[
    'DIV:Contains({{$parameter.name1}})',
    'DIV:Contains({{$util.findDom($parameter.name2)}})',
    'DIV:Contains({{$util.findDom($parameter.name3 + $parameter.value1)}})',
    'DIV:Contains({{$util.findDom($parameter.name4 + " "+$parameter.value2)}})',
    'DIV:Contains({{$util.findDom($parameter.name5 + $parameter.value3)}})',
    'DIV:Contains({{$util.findDom($parameter.name11) + $util.findDom($parameter.value7)}})',
    'DIV:Contains({{$util.findDom($parameter.name12) + $parameter.value8}}',
    'DIV:Contains({{$parameter.value10+$util.findDom($parameter.name14)}}',
    'DIV:Contains($parameter.name6)',
    'DIV:Contains($util.findDom($parameter.name7))',
    'DIV:Contains($util.findDom($parameter.name8 + $parameter.value4))',
    'DIV:Contains($util.findDom($parameter.name9 + " "+$parameter.value5))',
    'DIV:Contains($util.findDom($parameter.name10 + $parameter.value6))',
    'DIV:Contains($util.findDom($parameter.name13) + $util.findDom($parameter.value9))',
    'DIV:Contains($util.findDom($parameter.value11+$util.findDom($parameter.name15)))',
    '$util.findDom($parameter.value12+$util.findDom($parameter.name16))',
    '$parameter["lws-ok"]',
  ]
  data.forEach(x=>{
    console.log(_domActionTask._retrieveBindDataFromString(x))
  })
  */
  _retrieveBindDataFromString:function(w){
    if(w){
      // w=w.match(_IDE._insertJSOnlyRegex)
      //    w=w.match(/\$(project|module|test|loop|data|group|action|parameter|result|element)((\.[^\s\)\]\}\,\;\:\!\=\?\>\<\.\^\%\&\|\@\"\'\+\-\*\/]+)|\[[^\]]+\])+(\(.+\))?/g)
      w=w.match(/\$(project|module|test|loop|data|group|action|parameter|result|element)(\.[^\s\(\[\)\]\}\+\-\*\/\,\;\:\=\?]+)*/g)
      if(w){
        w=w.map(x=>{
          return x.split(/[\(\)\[\]\+\-\|\&\*\/\{\}\!\^\=]+/).filter(x=>x)[0]
        }).filter(x=>!x.match(/\.constructor$/))
        w=[...new Set(w)]
      }
      return w
    }
  },
  _getCurDataExpress:function(ss){
    if(ss){
      let s=_domActionTask._retrieveBindDataFromString(ss);
      if(s){
        s.forEach((v,i)=>{
          let vv=_Util._getSysObj(v)
          try{
            if(vv&&vv.constructor==Function){
              s[i]=v+" = Function"
            }else{
              s[i]=v+" = "+JSON.stringify(vv)
            }
          }catch(e){
            s[i]=v+" ("+_bzMessage._common._error+": "+e.message+")"
          }
        })
        return s.join("\n")
      }
    }
    return ss
  },
  _prepareValidation:function(){
    document.body._bzValidateData=(_domActionTask._next||[]).map(t=>{
      try{
        var dom=_domActionTask._findElement(t);
        return {
          _key:t._key,
          _html:dom?_calcMD5(dom.outerHTML):0
        }
      }catch(e){}
    })
  },
  _setErrorPos:function(_result,_value,_key){
    if(!window.extensionContent){
    }else{
      this._errorPos={_value:_value,_key:_key}
    }
  }
};
const _calendarInputHandler={
  _trigger:function(_action,_fun,_retryTrigger){
    _retryTrigger=_retryTrigger||0
    let p=_action.e,fvs=[],
        v=_action.event.value;

    
    if(v.constructor==Array){
      v=v.map(x=>_Util._toDate(x))
    }else{
      v=[_Util._toDate(v)]
    }
    let bv=[...v],
        bvf=bv.map(x=>_Util._formatTimestamp(x,_IDE._data._setting.dateFormat)).join(", ")

    fvs=_findValues(v)
    if(!fvs.find(x=>!x.v)){
      _domActionTask._doLog("BZ-LOG: Found date without setting: "+bvf)
      return _fun&&_fun({_type:4})
    }
    _preStart(_action.e)

    function _findValues(vs){
      let ff=[]
      vs.forEach(x=>{1
        ff.push(_Util._findValueFromElementScope(_action.e,x))
      })
      return ff
    }

    function _preStart(o){
      let as=_calendarInputHandler._parsePanel([o])
      if(as._panels.length){
        _fillDates([o],v,_fun)
      }else{
        _start(o)
      }
    }

    function _start(o,_retryStart){
      _Util._findElementAfterClick([o],0,(s)=>{
        return s
      },(s)=>{
        if(!s.length){
          if(_retryStart){
            if(o.tagName=="INPUT"&&!o.readOnly){
              return $util.triggerChangeEvent(o,_action.event.value,0,0,0,0,()=>_fun&&_fun({_type:4}))
            }
            _fun({_type:2})
          }else{
            _Util._clickToHidden(o.parentElement,()=>{
              _start(o,1)
            })
          }
        }else{
          _fillDates(s,v,function(r,_box,py,pm){
            _end(o,_box,r,_box,py,pm)
          })
        }
      })

    }

    function _fillDates(s,vs,_fun,_box){
      let v=vs.shift()
      if(v){
        _domActionTask._doLog("BZ-LOG: set date: "+v)
        let as=_calendarInputHandler._parsePanel(s)
        if(as._panels.length){
          s=[as._box]
          _calendarInputHandler._fillDate(as,v,(r,py,pm)=>{
            if(r._type==4){
              _fillDates(s,vs,_fun,as._box)
            }else{
              _fun(r,as._box,py,pm)
            }
          })
        }else{
          _fun({_type:2})
        }

      }else{
        _domActionTask._doLog("BZ-LOG: No more date")
        _fun({_type:4},_box,{})
      }

    }

    function _end(o,_box,r,bb,py,pm){
      setTimeout(()=>{
        if(!_Util._isHidden(_box)&&(bb||o)){
          $util.triggerMouseEvents(bb||o,1,0,0,0,0,0,()=>{
            setTimeout(()=>{
              if(bb){
                _end(o,_box,r,bb.parentElement,py,pm)
              }else if(o){
                _end(o.parentElement,_box,r,bb,py,pm)
              }
            },50)
          })
        }else{
          let nvs=_findValues(bv);
          if(nvs.find(x=>x.v)){
            _domActionTask._doLog("BZ-LOG: set date success: "+bvf)
            return _fun&&_fun(r)
          }
          if(_retryTrigger<2){
            _domActionTask._doLog("BZ-LOG: set date failed and retry: "+bvf)
            setTimeout(()=>{
              return _calendarInputHandler._trigger(_action,_fun,_retryTrigger+1)
            },_retryTrigger*1000)
          }else if(py&&pm){
            _domActionTask._doLog("BZ-LOG: set date maybe failed: "+bvf)
            _fun&&_fun(r)
          }else{
            _domActionTask._doLog("BZ-LOG: set date failed: "+bvf)
            _fun&&_fun({_type:2})
          }
        }
      },100)
    }
  },
  _findPanel:function(p,v,_chkFun,_fun){
    let ps=_Util._findAllCellsInPanel(p)
    _Util._findElementAfterClick(ps,0,(os)=>{
      let es=_chkFun(os)

      return es
    },_fun);
  },
  _getElementPath:function(o){
    return o.tagName+":eq("+$(document).find(o.tagName).toArray().indexOf(o)+")"
  },
  _fillDate:function(as,v,_fun){
    let ms=_calendarInputHandler._getMonthList(),py,pm;

    _fillYear(as,v.getFullYear(),(r,ps)=>{
      py=ps&&1
      if(r._type==4){
        if(ps){
          if(ps.find(p=>{
            if(p.m&&p.m.v==v.getMonth()){
              _clickDate(p,v,_fun)
              return 1
            }
          })){
            return 1
          }
        }
        setTimeout(()=>{
          as=_calendarInputHandler._parsePanel([as._box])
          _fillMonth(as,v.getMonth(),(r,fm)=>{
            if(r._type==4){
              pm=fm
              as=_calendarInputHandler._parsePanel([as._box])
              if(as.m.v==v.getMonth()){
                _clickDate(as,v,_fun)
              }else{
                _calendarInputHandler._doNav(as,v.getMonth()-as.m.v,(x)=>{
                  return x.m&&x.m.v==v.getMonth()
                },()=>{
                  return _chkNavMonth(as,v.getMonth())
                },()=>{
                  _clickDate(as,v,_fun)
                });
              }
            }else{
              _fun(r)
            }
          })
        },1000)
      }else{
        _fun(r)
      }
    })
    
    function _fillYear(as,tv,_fun,_retry){
      let p=as._panels.filter(p=>p.y.v==tv)
      if(!_Util._isEmpty(p)){
        _fun({_type:4},p)
      }else{
        let y=as.y

        if(y.o.tagName=="SELECT"){
          return $script.exe([$script.set(_calendarInputHandler._getElementPath(y.o),tv)],()=>{
            setTimeout(()=>{
              _fun({_type:4})
            },100)
          })
        }
        _Util._preTriggerEvent()
        _Util._findElementAfterClick([y.o],0,(os)=>os,(os)=>{
          if(!os.length){
            return _calendarInputHandler._doNav(as,tv-y.v,(x)=>{
              return x.y&&x.y.v==tv
            },()=>{
              return _chkNavYear(as,tv)
            },_fun)
          }
          let yp=_calendarInputHandler._parsePanel(os)
          if(!yp.ys.find(yy=>{
            if(yy.v==v.getFullYear()){
              $util.triggerMouseEvents(yy.o,1,0,0,0,0,0,()=>{
                setTimeout(()=>{
                  _fun({_type:4})
                },100)
              })
              return 1
            }
          })){
            if(_retry){
              _calendarInputHandler._doNav(as,tv-y.v,(x)=>{
                return x.y&&x.y.v==tv
              },()=>{
                return _chkNavYear(as,tv)
              },_fun)
            }else if(yp.ms.length>=12){
              if(yp.y){
                setTimeout(()=>{
                  _fillYear(yp,tv,_fun,1)
                },200)
              }
            }else{
              _calendarInputHandler._doNav(as,tv-y.v,(x)=>{
                return x.y&&x.y.v==tv
              },()=>{
                return _chkNavYear(as,tv)
              },_fun)
            }
          }
        })
      }
    }

    function _fillMonth(as,tv,_fun,_retry){
      let vv=(as.mt||ms).map(x=>x[tv])
      if(as.m &&as.m.o.tagName=="SELECT"){
        for(let tt of as.m.o.options){
          if(vv.includes(tt.text.toLowerCase())){
            vv=tt.text
            break
          }
        }
        return $script.exe([$script.set(_calendarInputHandler._getElementPath(as.m.o),vv)],()=>{
          setTimeout(()=>{
            _fun({_type:4},1)
          },100)
        })
      }

      if(as.ms.length>=12){
        while(as.ms.length>12){
          if(as.ms[0].v!=0||ms.ms[1].v==0||ms.ms[1].v!=1){
            as.ms.shift()
          }
        }
        let o=as.ms.find(x=>x.v==tv).o
        _domActionTask._doLog("Click month: "+o.outerHTML)
        o.scrollIntoView()

        setTimeout(()=>{
          $util.triggerMouseEvents(o,1,0,0,0,0,0,()=>{
            setTimeout(()=>{
              _fun({_type:4})
            },1000)
          })
        },100)
      }else if(_retry){
        _domActionTask._doLog("Do month nav")
        return _calendarInputHandler._doNav(as,tv-as.m.v,(x)=>{
          return x.m&&x.m.v==tv&&$.isNumeric(x.m.fv)==$.isNumeric(as.m.fv)
        },()=>{
          return _chkNavMonth(as,tv)
        },_fun)
      }else if(as.m){
        if(as.m.v==tv){
          _domActionTask._doLog("Ignore on selected month")
          return _fun({_type:4},1)
        }
        _Util._preTriggerEvent()

        _domActionTask._doLog("Month element: "+as.m.fv+", "+as.m.v+", "+as.m.o.outerHTML)

        _Util._findElementAfterClick([as.m.o],0,(os)=>os,(os)=>{
          if(!os.length){
            _domActionTask._doLog("Not get month menu and to nav - 1")
            return _calendarInputHandler._doNav(as,tv-as.m.v,(x)=>{
              return x.m&&x.m.v==tv&&$.isNumeric(x.m.fv)==$.isNumeric(as.m.fv)
            },()=>{
              return _chkNavMonth(as,tv)
            },_fun)
          }
          let mp=_calendarInputHandler._parsePanel(os)
          if(mp.ms.length<12){
            _domActionTask._doLog("Not get month menu and to nav - 2")
            return _calendarInputHandler._doNav(as,tv-as.m.v,(x)=>{
              return x.m&&x.m.v==tv&&$.isNumeric(x.m.fv)==$.isNumeric(as.m.fv)
            },()=>{
              return _chkNavMonth(as,tv)
            },_fun)
          }
          setTimeout(()=>{
            _fillMonth(mp,tv,_fun,1)
          },200)
        })
      }
    }

    function _clickDate(p,v,_fun){
      let oo=p.ds.filter(x=>x.v==v.getDate())
      if(oo.length){
        $util.triggerMouseEvents(oo[0].o,1,0,0,0,0,0,()=>{
          _fun({_type:4},py,pm)
        })
      }else{
        _fun({_type:2})
      }
    }

    function _chkNavYear(as,tv){
      let o=as.y.o,n=as.y.n
      let v=_calendarInputHandler._getElementText(n||o).split(_Util._matchAllSign)

      v=_calendarInputHandler._parseYear(o,v,n)
      if(v&&v.v!=as.y.v){
        as.y=v
        return v.v==tv
      }
    }

    function _chkNavMonth(as,tv){
      let o=as.m.o,n=as.m.n
      
      let v=_calendarInputHandler._getElementText(n||o).split(_Util._matchAllSign)

      v=_calendarInputHandler._parseMonth(o,v,n)
      if(v&&v.v!=as.m.v){
        as.m=v
        return v.v==tv
      }
    }
  },
  _getElementText:function(o){
    if(o.nodeType==3){
      o=o.textContent
    }else{
      o=o.innerText||o.value
    }
    return (o||"").trim().toLowerCase()
  },
  _getMonthList:function(){
    let ms1=Object.values(_bzMessage._schedule._fullMonthMap).map(x=>x.toLowerCase()),
        ms2=Object.values(_bzMessage._schedule._monthMap).map(x=>x.toLowerCase()),
        ms3=Array.from({ length: 12 }, (_, idx) => `${idx+1}`),
        ms4=ms3.map(x=>parseInt(x)>9?x:`0${x}`);
    return [ms1,ms2,ms3,ms4]
  },
  _parsePanel:function(ps){
    let ds=[1,2,3,4,5,6,7,8,9],
        ds1=new Set(ds.map(x=>`${x}`)),
        ds2=new Set(ds.map(x=>`0${x}`)),
        _wayMap={innerText:0},
        _box=_findBox(ps),
        as={
          d:"",
          _panels:[],
          ms:[],
          ys:[],
          ds:[]
        },
        os=_Util._findAllCellsInPanel(_box);

    
    os.find((a)=>{
      let vv=((a.nodeType==3?a.textContent:a.innerText)||"").toLowerCase().trim(),
          n=a.nodeType==3&&a.parentElement
      a=a.nodeType==3?a.parentElement:a
      let av=_isDate(a);

      if(!av){
        if(_calendarInputHandler._isNavBtn(a,vv)){
          let r1=a.getBoundingClientRect(),
              _next=as._nextBtn,_pre=as._preBtn;
          if(!_pre){
            as._preBtn=a
          }else{
            let r2=as._preBtn.getBoundingClientRect();
            if(r1.left<r2.left){
              as._preBtn=a
            }else if(r1.left==r2.left){
              if(r1.top<r2.top){
                as._preBtn=a
              }
            }

            if(!_next){
              if(as._preBtn==a){
                as._nextBtn=_pre
              }else{
                as._nextBtn=a
              }
            }else{
              let r3=_next.getBoundingClientRect(),rr,aa
              if(as._preBtn==a){
                if(r1.top==r2.top&&r1.top!==r3.top){
                  as._nextBtn=_pre
                }else if(r1.top==r3.top&&r1.top!==r2.top){
                }else if(r2.left>r3.left){
                  as._nextBtn=_pre
                }
              }else{
                if(r1.top==r2.top&&r2.top!==r3.top){
                  as._nextBtn=a
                }else if(r2.top==r3.top&&r2.top!==r1.top){
                }else if(r1.left>r3.left){
                  as._nextBtn=a
                }
              }
            }
  
          }


          return
        }
      }

      if(av){
        as.ds.push(av)
      }

      if(vv){
        av=vv.split(_Util._matchAllSign)
        let mm=_calendarInputHandler._parseMonth(a,av,n)
        if(mm){
          if(as.ms[0]){
            if($.isNumeric(mm.fv)){
              if(!$.isNumeric(as.ms[0].fv)){
                return
              }
            }else if($.isNumeric(as.ms[0].fv)){
              as.ms=[]
            }
          }
          _groupMonthPanel(as)
          as.ms.push(mm)
        }
        
        mm=_calendarInputHandler._parseYear(a,av,n)
        if(mm){
          _groupMonthPanel(as)
          as.ys.push(mm)
        }
      }
    });
    _groupMonthPanel(as)

    ds=Object.entries(_wayMap)
    ds.sort((a,b)=>{
      return b[1]-a[1]
    })

    ds=ds[0][0]

    as._panels.forEach((p,j)=>{
      while(p.ds.length>27&&(p.ds[0].v!=1||p.ds[1].v==1)){
        p.ds.shift()
      }
      //handle month
      if(p.ms.length){
        let mm=p.ms.filter(x=>!$.isNumeric(x.fv));
        p.mt=_calendarInputHandler._getMonthList()
        if(mm.length){
          p.ms=mm
          p.mt.pop()
          p.mt.pop()
        }else{
          p.ms=p.ms.filter(x=>{
            return !p.ds.find((d,j)=>{
              let n=p.ds[j+1]
              if(d.o==x.o){
                return !n||d.v==n.v-1
              }
            })
          }).filter(x=>{
            if(p.ys.find(y=>y.o==x.o)||x.o.tagName=="SELECT"||x.fv==x.o.innerText.toLowerCase().trim()||!$.isNumeric(x.fv)){
              return 1
            }
          })
        }
        mm=p.ms.filter(x=>{
          let v=x.o.innerText.trim().split(_Util._matchAllSign)
          if(p.ys.find(y=>y.o==x.o)){
            return v.length==2
          }else{
            return v.length==1
          }
        })
        if(mm.length){
          p.ms=mm
        }

        if(p.ms.length<10){
          p.ms.find(x=>{
            if(!p.ys.find(y=>y.o==x.o)){
              p.m=x
            }
          })

          if(!p.m){
            p.m=p.ms[0]
          }
        }

        p.ys.sort((a,b)=>{
          a=a.o.innerText.trim().length
          b=b.o.innerText.trim().length
          return a-b
        })
        p.ys=p.ys.filter((x,i)=>{
          if(!i||p.ms.find(m=>m.o==x.o)){
            return 1
          }
        })
        p.y=p.ys[0]
      }

      //handle date
      if(ds!="innerText"){
        p.ds=p.ds.filter(x=>x.o.attributes[ds])
      }

      if(!j){
        as.ys=p.ys
        as.ms=p.ms
        as.ds=p.ds
        as.y=p.y
        as.m=p.m
        as.d=p.d

      }
    })

    if(as.ms.length){
      _box=_box.find(x=>{
        return $(x).find(as.ms[0].o)[0]
      })

    }else if(as.ys.length){
      _box=_box.find(x=>{
        return $(x).find(as.ys[0].o)[0]
      })
    }
    if(!as.y&&as.ys.length){
      as.y=as.ys[0]
    }

    as._box=_box
    as._boxClass=_getBoxClass(_box)

    return as

    function _groupMonthPanel(as){
      if(as.ds.length>20){
        as._panels.push({
          ys:as.ys,
          ms:as.ms,
          ds:as.ds
        });
        as.ys=[]
        as.ms=[]
        as.ds=[]
      }
    }

    function _getBoxClass(o){
      if(o && o.className){
        let c="."+o.className.replace(/\s+/g,".")
        $(c).toArray().find((x,i)=>{
          if(x==o){
            return c+=`:eq(${i})`
          }
        })
        return c
      }
    }

    function _isDate(a){
      let fv=(a.innerText||(a.nodeType==3?a.textContent:"")||"").trim(),v;
      if(!fv){
        if(_wayMap.innerText<7){
          for(let aa of a.attributes){
            if(["rowspan","colspan"].includes(aa.name)){
              continue
            }
            fv=(aa.value||"").trim()
            if(fv&&$.isNumeric(fv)){
              v=parseInt(fv)
              if(v&&v>=1&&v<=31){
                _wayMap[aa.name]=_wayMap[aa.name]||0
                _wayMap[aa.name]++
                return _handleDate(a,v,fv)
              }
            }
          }
        }
      }else if($.isNumeric(fv)){
        v=parseInt(fv)
        if(v&&v>=1&&v<=31){
          _wayMap.innerText++
          return _handleDate(a.nodeType==3?a.parentElement:a,v,fv,a.nodeType==3&&a)
        }
      }
    }

    function _handleDate(a,v,fv,n){

      ds1.delete(fv)
      ds2.delete(fv)
      return {o:a,v:v,fv:fv,n:n}
    }

    function _findBox(os){
      let bs=[]
      os.forEach(x=>{
        if(!bs.length||!$(bs).find(x)[0]){
          bs.push(x)
        }
      })
      return bs
    }
    
  },
  _parseMonth:function(a,av,n){
    let mss=_calendarInputHandler._getMonthList(),r;
    mss.find((m)=>{
      return m.find((x,i)=>{
        if(av.includes(x)){
          r={o:a,v:i,fv:x,n:n}
          return 1
        }
      })
    })
    return r
  },
  _parseYear:function(a,av,n){
    let r;
    av.find(x=>{
      x=x.match(/((20|19|18)\d{2})/)
      if(x){
        r={o:a,v:x[1],n:n}
        return 1
      }
    })
    return r
  },
  _doNav:function(as,nv,_chkNav,_chkNav2,_fun){
    let rs=nv>0?as._nextBtn:as._preBtn;
    if(rs){
      if(_Util._isHidden(rs)){
        if(_Util._isHidden(as._box)){
          as._box=$(as._boxClass).toArray().find(x=>!_Util._isHidden(x))
        }
        as=_calendarInputHandler._parsePanel([as._box])
        return _calendarInputHandler._doNav(as,nv,_chkNav,_chkNav2,_fun)
      }
      _Util._findElementAfterClick([rs],0,(os)=>os,(os)=>{
        let oo=_calendarInputHandler._parsePanel(os)
        if(_chkNav(oo)){
          _fun({_type:4})
        }else if(_chkNav2()){
            _fun({_type:4})
        }else{
          _calendarInputHandler._doNav(as,nv,_chkNav,_chkNav2,_fun)
        }
      })
    }else{
      _fun({_type:2})
    }
  },
  _isNavBtn:function(o,v){
    let r=o.getBoundingClientRect(),
        c=o.className;
    c=c.toLowerCase?c:(c.baseVal||"")
    c=c.toLowerCase()
    if(["«","»","<",">",_bzMessage._method._next.toLowerCase(),_bzMessage._method._pre.toLowerCase()].includes(v)||c.match(/prev|next/)){
      return o
    }else if(!v&&r.width>=10&&r.width<50&&r.height>=10&&r.height<50){
      return o
    }
  },
  _getFormattedDate:function(d,f){
    return _Util._formatDate(_Util._toDate(d),f)
  }
};
var _glossaryHandler={
  /***************************************
  //thisIsATest --> this, is, a, test
  //this.is.a.test --> this, is, a, test
  ***************************************/
  _splitWord:function(w){
    if(!w || w.constructor!=String){
      return [];
    }
    w=w.replace(/[\`\~\!\@\#\$\%\^\&\*\(\)\_\+\-\=\[\]\{\}\;\'\:\"\<\,\.\>\/\?]/g," ");
    var vv="";
    var ws=[];
    var _inUpper=false;
    for(var i=0;i<w.length;i++){
      var v=w[i];
      if(v!=" "){
        if(v.match(/[A-Z]/)){
          if(vv && !_inUpper){
            ws.push(vv.toLowerCase());
            vv="";
          }
          _inUpper=true;
        }else if(_inUpper && vv.length>1){
          v=vv[vv.length-1]+v;
          vv=vv.substring(0,vv.length-1);
          ws.push(vv.toLowerCase());
          vv="";
          _inUpper=false;
        }else{
          _inUpper=false;
        }
        vv+=v;
      }else if(vv){
        ws.push(vv.toLowerCase());
        vv="";
        _inUpper=false;
      }
    }
    if(vv){
      ws.push(vv.toLowerCase());
    }
    return ws;
  },
  _removeIgnore:function(w){
    var p= new RegExp("(^| |_|,)("+_bzMessage._root._dictionary._options.attribute.id+"|"+_bzMessage._root._dictionary._options.attribute.name+")($| |_|,)","i");
    return w.replace(p,BZ._data._curProject.language=='cn'?"":" ").trim()||w;
  },
  //check whether _textName similar to _dataName
  //return: _type=1 is match, _type=2, check size
  //ex. _glossaryHandler._getSimilarityRate("lws 1","lws 1.0") --> {_type:2,_size:4}
  _getSimilarityRate:function(_textName, _dataName, _textGroup){
    //var _ignore=_glossaryHandler._getIgnoreParten()
    if(_textName==_dataName){
      return {_type:1,_size:_dataName.length}
    }
    _textGroup=_textGroup||_glossaryHandler._splitWord(_textName);
    
    _textName=_textName.toLowerCase();
    _dataName=_dataName.toLowerCase()
    var _dataGroup=this._splitWord(_dataName);
    _dataName=_dataGroup.toString();
    _dataName=_glossaryHandler._removeIgnore(_dataName)
    if(_textName==_dataName){
      return {_type:1,_size:_dataName.length}
    }else if(_textName.includes(_dataName)){
      return {_type:2,_size:_dataName.length}
    }else if(_textName.replace(/ /g,"").includes(_dataName)){
      return {_type:2,_size:_dataName.length}
    }
    var _gMax=0
    for(var i=0;i<_textGroup.length;i++){
      var t=_textGroup[i],_max=0;
      for(var n=0;n<_dataGroup.length;n++){
        var d=_dataGroup[n];
        var m=this._getSameSize(t,d);
        if(m>_max){
          _max=m;
        }
      }
      _gMax+=_max;
    }
    return {_type:2,_size:_gMax};
  },
  _isSimilarityWord:function(_textName, _dataName, _textGroup){
    let v=_glossaryHandler._getSimilarityRate(_textName, _dataName, _textGroup)
    if(v._type==1||v._type==2&&(v._size/_textName.length>0.8||v._size/_dataName.length>0.8)){
      return true
    }
  },
  //g: word list
  //w: to find word
  _findSimilarWord:function(g,w){
    var _max;
    for(var i=0;i<g.length;i++){
      var v=g[i]
      var p=_glossaryHandler._getSimilarityRate(w,v)
      if(p._type==1){
        return v
      }else if(!_max||p._size>_max._size){
        _max=p
        p._value=v
      }
    }
    if(_max&&_max._size>w.length*0.8){
      return _max._value
    }
  },
  _getSameSize:function(t,d){
    if(t.startsWith(d)){
      return d.length
    }else if(t.length>d.length){
      for(var i=0;i<d.length;i++){
        if(t[i]!=d[i]){
          return i;
        }
      }
    }
    return 0;
  },
  _getVariableName:function(w,_keepDash,_chkUpperCase){ 
    if(w){
      if(w.toUpperCase()==w){
        w=w.toLowerCase()
      }
      let v="";
      for(let i=0;i<w.length;i++){
        let l=w[i]
        v+=($.isNumeric(l)&&i)||l.match(/[a-zA-Z_\$]/)?l:_isVariableLetter(l,_keepDash)
      }
      if(_keepDash){
        return v.replace(" ","")
      }
      return _Util._toCamelWords(v.replace(/_+/g," "),_chkUpperCase)
    }else{
      return ""
    }

    function _isVariableLetter(v,_keepDash){
      try{
        if(!_keepDash||v!="-"){
          return v=="-"||_Util._isVarName(v)
        }
      }catch(e){
        v="_"
      }
      return v
    }
  

  }
};
/*
String.prototype.isEnglish=function(){
  if(!this.match(/a-z/i)){
    return false
  }
  w=this.replace(/[0-9]/g," ");
  
  var w=w.replace(/al|air|ar|ear|eir|er|ere|ight|ir|ong|or|oor|ore|ow|ur/gi,"a");
  w=w.replace(/ght|ng|ur|th|dr|sh|ch|tw|wh|ts|ds/gi,"");
  var ws=w.split(/\W/);
  for(var n=0;n<ws.length;n++){
    w=ws[n];
    if(!w){
      continue;
    }
    var v=0;
    var ok=false;
    var UP=true;
    for(var i=0;i<w.length;i++){
      var c=w[i];
      if(c.match(/a|e|i|o|u|y/gi)){
        v=1;
        ok=true;
      }else{
        v--;
        if(UP && !c.match(/[A-Z]/)){
          UP=false;
        }
      }
      if(v==-4 && !UP){
        return false
      }
    }
    if(!ok && !UP){
      return false;
    }
  }
  return true;
}
*/
Object.defineProperty(String.prototype,"plural", {enumerable: false,value:function(revert){
  //============================================================
  //BZ Code Start
  if(this.trim()!=this){
    return this.trim().plural(revert)
  }else if(this.match(/\s/)){
    var w=this.split(/\s/);
    w.forEach(function(v,i){
      w[i]=v.plural(revert).toString()
    });
    return w.toString().replace(/,/g," ");
  }else if(this.match(/[A-Z\-\`\~\!\@\#\%\^\&\*\(\)\+\=\{\}\[\]\:\;\"\'\<\>\?\,\.\/\\\|\：\，\。\（\）\？\！\；\‘\“\”\’]/)){
    var w=_Util._removeSign(this.toLowerCase()," ")
    return w.plural(revert);
  }else if(this.length<3){
    return this
  }else if(_dictionaryHandler._isIgnoreWord(this)||_dictionaryHandler._isVerb(this)){
    return this;
  }
  
  
  if(!this.match(/[a-z]/i)){
    return this
  }
  //BZ code end
  //============================================================
  
  var plural = {
    '(quiz)$'               : "$1zes",
    '^(ox)$'                : "$1en",
    '([m|l])ouse$'          : "$1ice",
    '(matr|vert|ind)ix|ex$' : "$1ices",
    '(x|ch|ss|sh)$'         : "$1es",
    '([^aeiouy]|qu)y$'      : "$1ies",
    '(hive)$'               : "$1s",
    '(?:([^f])fe|([lr])f)$' : "$1$2ves",
    '(shea|lea|loa|thie)f$' : "$1ves",
    'sis$'                  : "ses",
    '([ti])um$'             : "$1a",
    '(tomat|potat|ech|her|vet)o$': "$1oes",
    '(bu)s$'                : "$1ses",
    '(alias)$'              : "$1es",
    '(octop)us$'            : "$1i",
    '(ax|test)is$'          : "$1es",
    '(us)$'                 : "$1es",
    '([^s]+)$'              : "$1s"
  };

  var singular = {
    '(quiz)zes$'             : "$1",
    '(matr)ices$'            : "$1ix",
    '(vert|ind)ices$'        : "$1ex",
    '^(ox)en$'               : "$1",
    '(alias)es$'             : "$1",
    '(octop|vir)i$'          : "$1us",
    '(cris|ax|test)es$'      : "$1is",
    '(shoe)s$'               : "$1",
    '(o)es$'                 : "$1",
    '(bus)es$'               : "$1",
    '([m|l])ice$'            : "$1ouse",
    '(x|ch|ss|sh)es$'        : "$1",
    '(m)ovies$'              : "$1ovie",
    '(s)eries$'              : "$1eries",
    '([^aeiouy]|qu)ies$'     : "$1y",
    '([lr])ves$'             : "$1f",
    '(tive)s$'               : "$1",
    '(hive)s$'               : "$1",
    '(li|wi|kni)ves$'        : "$1fe",
    '(shea|loa|lea|thie)ves$': "$1f",
    '(^analy)ses$'           : "$1sis",
    '((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$': "$1$2sis",        
    '([ti])a$'               : "$1um",
    '(n)ews$'                : "$1ews",
    '(h|bl)ouses$'           : "$1ouse",
    '(corpse)s$'             : "$1",
    '(us)es$'                : "$1",
    's$'                     : ""
  };

  var irregular = {
    'move'   : 'moves',
    'foot'   : 'feet',
    'goose'  : 'geese',
    'sex'    : 'sexes',
    'child'  : 'children',
    'man'    : 'men',
    'tooth'  : 'teeth',
    'person' : 'people'
  };

  var uncountable = [
    'sheep', 
    'fish',
    'deer',
    'moose',
    'series',
    'species',
    'money',
    'rice',
    'information',
    'equipment'
  ];

  // save some time in the case that singular and plural are the same
  if(uncountable.indexOf(this.toLowerCase()) >= 0){
    return this;
  }
  // check for irregular forms
  for(word in irregular){

    if(revert){
      var pattern = new RegExp(irregular[word]+'$', 'i');
      var replace = word;
    } else{ 
      var pattern = new RegExp(word+'$', 'i');
      var replace = irregular[word];
    }
    if(pattern.test(this)){
      return this.replace(pattern, replace);
    }
  }

  if(revert) {
    var array = singular;
  }else{
    var array = plural;
  }

  // check for matches using regular expressions
  for(reg in array){

    var pattern = new RegExp(reg, 'i');

    if(pattern.test(this)){
      return this.replace(pattern, array[reg]);
    }
  }

  return this;
}});
/*
word data constructor:
  W: word (plural)
  T: type
    1: o, operation name,
    2: f, function name,
    4: v, value, 
    8: m, module name,
    16: a, attribute name, 
    32: i, info,
    64: p, project name
    128: w, app word,
    0: 0, others
  P: from of appearance
    1: setting
    2: dictionary, 
    4: data, 
    8: input (change), 
    16: button/link (click),
    32: other
  L: level
    0, none
    1, label
    2, header
  IN: Include other words key
*/
var _aiWordHandler={
  /************************************************************************************************
  //
  //  o: operation name, 
  //  f: function name, 
  //  v: value, 
  //  m: module name, 
  //  a: attribute name, 
  //  i: info, 
  //  p: project name,
  //  w: app-word
  //  0: others,
  //
  ************************************************************************************************/
  _typeValue:{o:1, f:2, v:4, m:8, a:16, i:32,p:64,w:128},
  _fromValue:{
    _setting:1,
    _dictionary:2,
    _data:4,
    _input:8,
    _button:16,
    _other:32
  },
  _codeMap:{},
  _wordMap:{},
  _pluralMap:{},
  _noTypeWords:[],
  _typeWords:[],
  _getOrgWord:function(w,_inCapital){
    w=_aiWordHandler._pluralMap[w]||w
    if(_inCapital){
      w=_Util._toCapitalWord(w)
    }
    return w;
  },
  _preFix:function(w){
    if(!w){
      return
    }
    w=w.toLowerCase();
    w.split(" ").forEach(function(v){
      v=v.trim();
      if(v){
        var vv=v.plural().toString();
        if(v!=vv){
          _aiWordHandler._pluralMap[v]=vv;
        }
      }
    })
    var v= w.plural().toString()
    if(v!=w){
      _aiWordHandler._pluralMap[v]=w;
    }
    return v;
  },
  /*****************************************************
  //EXTRA: For data/attribute/module-name to retrieve from which module/test
  ******************************************************/
  _registerWord:function(w,_type,_from,_level,_extra){
    if(!w || w.length==1){
      return
    }
    var pw=_aiWordHandler._findWordDefine(w)
    if(pw&&pw.W){
      if(_extra&&_extra.code){
        pw.W.EXTRA=pw.W.EXTRA||[]
        for(var i=0;i<pw.W.EXTRA.length;i++){
          if(pw.W.EXTRA[i].code){
            _extra.code=pw.W.EXTRA[i].code
            return
          }
        }
        pw.W.EXTRA.push(_extra)
        _aiWordHandler._codeMap[_extra.code]={_word:w,_type:_type,_extra:_extra}
      }
      return
    }
    if(_extra&&_extra.code){
      _aiWordHandler._codeMap[_extra.code]={_word:w,_type:_type,_extra:_extra}
    }
    w=_aiWordHandler._preFix(w);
    
    _type=_aiWordHandler._typeValue[_type];
    var o=this._wordMap[w];
    if(!o){
      o={W:w,T:_type,P:_from,L:_level||0,IN:[]};
      if(_extra){
        o.EXTRA=[_extra]
      }
      this._wordMap[w]=o
      if(_type){
        _aiWordHandler._typeWords.push(o);
        //for assign type to no-type-word
        _aiWordHandler._matchInclude(_aiWordHandler._noTypeWords,o,false)
      }else{
        _aiWordHandler._noTypeWords.push(o);
        _aiWordHandler._matchInclude(_aiWordHandler._typeWords,o,true);
        _aiWordHandler._matchInclude(_aiWordHandler._noTypeWords,o,true);
      }
    }else if(_type!=o.T){
      if(!o.T){
        if(_extra){
          o.EXTRA=o.EXTRA||[]
          o.EXTRA.push(_extra)
        }
        _aiWordHandler._noTypeWords.splice(_aiWordHandler._noTypeWords.indexOf(o),1);
        _aiWordHandler._typeWords.push(o);

        _aiWordHandler._matchInclude(_aiWordHandler._noTypeWords,o,false)
      }
      o.T|=_type
    }else if(!o.EXTRA && _extra){
      o.EXTRA=[_extra];
    }
    
    o.P|=_from;
    o.L|=_level;

    return o;
  },
  _getDataByCode:function(c){
    return _aiWordHandler._codeMap[c]
  },
  _findKeyWordInWords:function(w){
    if(!w){
      return
    }
    w=_aiWordHandler._preFix(w);
    
    var o=this._wordMap[w],tw=0;
    if(!o){
      o={W:w,IN:[]};
      _aiWordHandler._matchInclude(_aiWordHandler._typeWords,o,true);
    }
    if(o && !o.WW && o.IN.length){
      var ww=new RegExp(o.IN.toString().replace(/,/g,"|"));
      ww=o.W.split(ww);
      var _best="";
      ww.forEach(function(v){
        v=v.trim();
        v=_dictionaryHandler._removeIgnoreWords(v)
        if(v.length>_best.length){
          _best=v;
        }
      })
      
      o.WW=_best; //set extra value
      o._dicType=o.T||0;
      if(!o._dicType){
        for(var i=0;i<o.IN.length;i++){
          tw=_aiWordHandler._findKeyWordInWords(o.IN[i]);
          if(!o._dicDefine && tw){
            o._dicType|=tw?tw.T||0:0;
            o._dicDefine=tw._dicDefine;
            o.EXTRA=tw.EXTRA
          }else if(tw){
            if(!o._dicDefine){
              if(tw._dicDefine){
                o._dicType|=tw?tw.T||0:0;
                o._dicDefine=tw._dicDefine;
              }else if(tw.EXTRA && !(o._dicType&8 || o._dicType&64) && (tw.T==8 || tw.T==64)){
                o._dicType|=tw?tw.T||0:0;
                o._dicDefine=tw._dicDefine;
                o.EXTRA=tw.EXTRA
              }
            }
          }
          if((!o.EXTRA && !o._dicDefine) || !tw || !(tw.T&tw.T&_aiWordHandler._typeValue.o)){
            if(!o.WW){
              o.WW=o.IN[i]
            }
          }
        }
      }else{
        o._dicDefine=_dictionaryHandler._findWordDefine(o.W);
      }
    }
    if(!o._dicDefine && o.T){
      o._dicDefine=_dictionaryHandler._findWordDefine(o.W)
    }
    return o;
  },
  _findWordDefine:function(w){
    w=_aiWordHandler._wordMap[_aiWordHandler._preFix(w)]
    var ws=[];
    if(w && w.IN.length){
      w.IN.forEach(function(v){
        ws.push(_aiWordHandler._wordMap[v])
      });
    }
    return {W:w,IN:ws};
  },
  _isLookingWord:function(w,_type,_keys){
    if(!w){
      return;
    }
    w=_aiWordHandler._preFix(w);
    if(_type && _type.constructor==Array){
      for(var i=0;i<_type.length;i++){
        var t=this._isLookingWord(w,_type[i],_keys);
        if(t){
          return t
        }
      }
      return 
    }
    var ww=this._wordMap[w];
    if(!ww){
      ww=_aiWordHandler._findKeyWordInWords(w).IN
      if(ww){
        var www=0,_best;
        for(var i=0;i<ww.length;i++){
          if(!_best || _best.length<ww[i].length){
            var v=_aiWordHandler._isLookingWord(ww[i],_type);
            if(v){
              www=v;
            }
          }
        }
        return www;
      }
    }
    w=ww;
    if(w){
      if(!_type){
        return _keys.includes(w.W);
      }
      if(w.T & _aiWordHandler._typeValue[_type]){
        if(!_keys){
          return w;
        }
        var d=_dictionaryHandler._wordMap[_aiWordHandler._preFix(w.W)];
        if(d){
          var ks=d._key;
          if(d._key.constructor==String){
            ks=[d._key]
          }
          for(var i=0;i<ks.length;i++){
            if(_keys.includes(ks[i])){
              return ks[i]
            }
          }
        }
      }
      if(w.IN){
        for(var i=0;i<w.IN.length;i++){
          var t=_aiWordHandler._isLookingWord(w.IN[i],_type,_keys);
          if(t){
            return t;
          }
        }
      }
    }
  },
  _findWordByExtra:function(e){
    var s=""
    for(var k in _aiWordHandler._wordMap){
      var ws=_aiWordHandler._wordMap[k].EXTRA
      if(ws){
        for(var i=0;i<ws.length;i++){
          var w=ws[i]
          if(w.tt==e.tt && w.m==e.m && w.t==e.t){
            s+="|"+_aiWordHandler._getOrgWord(k)
          }else if(w.code==e){
            s+="|"+_aiWordHandler._getOrgWord(k)
            break
          }
        }
      }
    }
    
    return s.substring(1)
  },
  _getMatchWords:function(w){
    var ws=w.split(/[^a-z0-9\u4E00-\u9FCC]/gi)
    //Chinese
    if(ws && BZ._data._curProject.language=="cn"){
      //pick all chinese
      var ss=w.match(/[\u4E00-\u9FCC]/g);
      if(ss && ws && ss.length==ws.length){
        return [w.replace(/\s/g,"")]
      }
    }
    for(var i=0;i<ws.length;i++){
      if(!ws[i]){
        ws.splice(i--,1)
      }
    }
    return ws
  },
  //g: word group (type/notype), 
  //o: new word
  //b: flag, for switch compare between 2 words length
  _matchInclude:function(g,o,b){
    g.forEach(function(v,i){
      if(v.W==o.W){
        return;
      }
      var B=v.W.length<o.W.length;
      if(B==b){
        var ch=o.W,ws=v.W,n,w;
        if(!b){
          ch=v.W;
          ws=o.W;
        }
        ws=_aiWordHandler._getMatchWords(ws)
        if(!ws.length){
          return
        }
        for(var i=0;i<ws.length;i++){
          w=ws[i];
          if(w){
            if(_aiWordHandler._includes(ch,w)){
              ch=_aiWordHandler._replace(ch,w)
            }else{
              return;
            }
          }
        }

        if(b){
          if(v.W){
            o.IN.push(v.W)
          }
        }else{
          if(o.W){
            v.IN.push(o.W)
          }
        }
      }
    })
  },
  _registerFromAction:function(_action){
    var w,hs,e,r={H:""};
    if(e=_action.element){
      if(!_action.css){
        _action.css=_descAnalysis._getAICssData(0,e)
      }
      if(hs=_action.css.HH){
        for(var i=0;i<hs.length;i++){
          w=_descAnalysis._retrieveTextForElementPathItem(e[hs[i].id])
          r.H+="|"+w.replace(/\|/g," ")
          _aiWordHandler._registerWord(w,0,32,2)
        }
      }
      if(_action.css.LL){
        r.L=w=_descAnalysis._retrieveTextForElementPathItem(e[_action.css.LL.id])
        _aiWordHandler._registerWord(w,0,!_action.event?32:_action.event.type=="mouse"?16:8,1);
      }
      if(_action.type==1 && _action.event && _action.event.type=="change"){
        //8: input
        var m=BZ._getCurModule(),t=BZ._getCurTest();
        
        _aiWordHandler._registerWord(_action.event.value,"v",8,0,{m:m.code,t:t.code});
      }
      if(r.H){
        r.H=r.H.substring(1)
      }
      return r
    }
  },
  //Replace word in element path by parameter
  _replaceElementPathInParameter:function(ep,w,p){
    for(var i=ep.length-1;i>=0;i--){
      var v=ep[i]
      if(v.includes && v.includes("("+w+")")){
        ep[i]=v.replace("("+w+")","("+p+")")
        break;
      }else if(v.includes && v.includes('"'+w+'"')){
        ep[i]=v.replace('"'+w+'"','"'+p+'"');
        break;
      }
    }
    return ep;
  },
  _includes:function(w,v){
    if(BZ._data._curProject.language=="cn"){
      return w.includes(v)
    }else{
      return w.match("(^| )"+v+"( |$)")
    }
  },
  _replace:function(w,v){
    if(BZ._data._curProject.language=="cn"){
      return w.replace(w,v)
    }else{
      return w.replace("(^| )"+v+"( |$)")
    }
  },
  _replaceAll:function(w,v){
    var ww=_aiWordHandler._replace(w,v);
    while(ww!=w){
      w=ww;
      ww=_aiWordHandler._replace(w,v);
    }
    return ww;
  },
  _isSamilarWords:function(w,v){
    return w.includes(v) || v.includes(w)
  },
  _analysisElementType:function(_action){
    var c=_action.css,w;
    if(c){
      var hs=c.HH||[];
      for(var i=0;i<hs.length;i++){
        w=_descAnalysis._retrieveTextForElementPathItem(_action.element[hs[i].id])
        hs[i].WT=[]
        _doWord(w,hs[i].WT)
        if(!hs[i].WT.length){
          delete hs[i].WT
        }
      }

      if(c.LL && Object.keys(c.LL).length){
        c.LL.WT=[];
        w=_descAnalysis._retrieveTextForElementPathItem(_action.element[c.LL.id])
        _doWord(w,c.LL.WT)
        _doCss(c.LL.C.css,c.LL.WT)
        _doCss(c.LL.C.subCss,c.LL.WT)
        if(!c.LL.WT.length){
          delete c.LL.WT
        }
      }
    }
    function _doWord(w,ws){
      if(!w){
        return
      }
      var _orgWord=w;
      w=_aiWordHandler._findKeyWordInWords(w);
      var o={}
      if(w._dicDefine){
        o.DD={T:w._dicDefine._type,K:w._dicDefine._key}
      }
      if(w.EXTRA){
        o.EXTRA=w.EXTRA
      }
      if(o.DD || o.EXTRA){
        var os=JSON.stringify(o),_found;
        
        for(var i=0;i<ws.length;i++){
          if(JSON.stringify(ws[i])==os){
            _found=1
            break
          }
        }
        if(!_found){
          ws.push(o)
        }
      }
      if(w.WW && w.WW!=_orgWord){
        _doWord(w.WW,ws)
      }
    }
    function _doCss(cs,ws){
      var ts=[]
      for(var i=0;cs && i<cs.length;i++){
        var cc=cs[i]
        if(cc=_cssHandler._cssMap["."+cc]){
          for(var k in cc){
            k=k.split("/")[0]
            var t=_cssHandler._keyMap[k]._type;
            if(t!="element"){
              _doWord(k,ws)
            }
          }
        }else if(!ws.length){
          cc=_glossaryHandler._splitWord(cs[i])
          cc.forEach(function(v){
            var o=_cssHandler._keyMap[v]
            if(!o || !o._css){
              _doWord(v,ts)
            }
          })
        }
      }
      if(!ws.length && ts.length){
        ts.forEach(function(v){
          ws.push(v)
        })
      }
    }
  },
  _analysisAction:function(v){
    _aiWordHandler._registerFromAction(v)
    _aiWordHandler._analysisElementType(v)
  },
  _analysisTest:function(t){
    _ideActionManagement._findAction(t,v=>{
      _aiWordHandler._analysisAction(v)
    })
  },
  _getRegexByWord:function(w){
    w=_aiWordHandler._findKeyWordInWords(w)._dicDefine
    if(w){
      w=w._key
      if(w.constructor==Array){
        w=w[0]
      }
      w="/BZ-"+w+"/"
    }
    return w||"/[a-z]+/"
  }
};
var _dictionaryHandler={
  _verbs:0,
  _ignores:0,
  _regexMap:{},
  _getRegexValueByKey:function(k){
    if(this._keyMap[k]&&!this._regexMap[k]){
      this._regexMap[k]=new RegExp(this._keyMap[k].toString().replace(/,/g,"|"),"i")
    }
    return this._regexMap[k]
  },
  _buildRegexMap:function(){
    if(!_dictionaryHandler._regexMap){
      Object.keys(_dictionaryHandler._keyMap).forEach(k=>{
        _dictionaryHandler._regexMap[k]=new RegExp(_dictionaryHandler._keyMap[k].toString().replace(/,/g,"|"),"i")
      })
    }
  },
  _isIgnoreWord:function(w){
    var a=_dictionaryHandler._ignores;
    if(!a || !a.length){
      _dictionaryHandler._buildIgnoreSet()
    }
    return _dictionaryHandler._ignores.includes(w.toLowerCase())
  },
  _isVerb:function(w){
    var a=_dictionaryHandler._verbs;
    if(!a || !a.length){
      _dictionaryHandler._buildVerbSet()
    }
    return _dictionaryHandler._verbs.includes(w.toLowerCase())
  },
  _buildIgnoreSet:function(){
    this._ignores=_dictionaryConfig.ignore.split("|");
  },
  _buildVerbSet:function(){
    var ws=[];
    for(var t in _dictionaryConfig){
      if(!["fun","operation"].includes(t)){
        continue;
      }
      _dictionaryConfig[t].forEach(function(o,i){
        ws=ws.concat((o.value||"").toLowerCase().split("|"));
        ws.push(o.key)
      })
    }
    ws.forEach(function(v,n){
      v=v.split(/ |-/g)
      for(var i=0;i<v.length;i++){
        if(_dictionaryHandler._isIgnoreWord(v[i])){
          i--;
          v.splice(i,1)
        }else if(i){
          ws.push(v[i])
        }else{
          ws[n]=v[i]
        }
      }
    })
    this._verbs=ws
  },
  _init:function(){
    if(this._ignores&&this._ignores.length){
      return 1
    }
    this._buildIgnoreSet();
    this._buildVerbSet();
    this._keyMap={};
    this._wordMap={};
    this._wordList=[];

    
    //build type words
    _dictionaryConfig.attribute=_IDE._data._curVersion.setting.attributeMap
    _dictionaryConfig.attribute.forEach(function(v){
      if(v.ex){
        while(v.value.includes(v.ex)){
          v.value=v.value.replace(v.ex,"")
        }
        v.value+="|"+v.ex
        if(v.value.includes("||")){
          v.value=v.value.replace(/[\|]+/g,"|")
        }
      }
    })
    for(var t in _dictionaryConfig){
      if("ignore"==t){
        continue;
      }
      var _err=0
      _dictionaryConfig[t].forEach(function(o,i){
        var ws=(o.value||"").split("|");
        o.key=o.key.toLowerCase();
        if(_dictionaryHandler._keyMap[o.key]){
          _err=1
        }
        _dictionaryHandler._keyMap[o.key]=ws;
        ws.forEach(function(w,i){
          var k=w.plural();
          var x=_dictionaryHandler._wordMap[k];
          if(x){
            if(x._key!=o.key){
              x._key=[x._key,o.key];
            }
            if(!x._type.includes(t)){
              x._type.push(t)
            }
            if(w.replace("-","").includes(o.key)){
              x.regex=o.regex
            }
          }else{
            _dictionaryHandler._wordMap[k]={_type:[t],_key:o.key,regex:o.regex};
            if(w!=k){
              _dictionaryHandler._wordMap[k]._org=w;
            }
          }
          _dictionaryHandler._wordList.push(w);
        })
      })
      if(_err){
        return alert(_bzMessage._root._dictionary._duplicateKey)
      }
    }
    _dictionaryHandler._wordList.sort(function(a,b){return b.length-a.length});
    for(var k in _dictionaryHandler._wordMap){
      //To get first letter 
      //a:attribute, o:operation, f:function, m:module, v: value, i: info
      var t=_dictionaryHandler._wordMap[k]._type;

      t.forEach(function(tt){
        _aiWordHandler._registerWord(k,tt[0],_aiWordHandler._fromValue._dictionary);
      })
    }
    return 1;
  },
  _getFormatByValue:function(w){
    var os=_dictionaryConfig.attribute,v
    for(var i=0;i<os.length;i++){
      v=os[i].regex
      if(w.match(new RegExp(v.substring(1,v.length-1)))){
        return v
      }
    }
  },
  _getWordsByKey:function(k){
    return this._keyMap[k]
  },
  _findWordInType:function(v,t){
    if(!v){
      return;
    }
    v=v.toLowerCase()
    var ws=_dictionaryHandler._wordList,w;
    for(var i=0;i<ws.length;i++){
      w=ws[i];
      var ww=v.match("(^| )"+w+"( |$)");
      
      if(ww){
        if(_dictionaryHandler._wordMap[w.plural()]._type.includes(t)){
          return w;
        }
        var n=v.indexOf(ww[0]);
        var tt=_dictionaryHandler._findWordInType(v.substring(0,n),t);
        if(!tt){
          tt=_dictionaryHandler._findWordInType(v.substring(n+ww[0].length),t);
        }
        if(tt){
          return tt;
        }
        break
      }
    }
  },
  _findWordDefine:function(w){
    w=_aiDataHandler._miniMap[w]||w;
    w=w.plural();
    if(this._wordMap[w]){
      return this._wordMap[w]
    }
    w=_aiWordHandler._preFix(w);
    w=_aiWordHandler._findWordDefine(w)
    if(w.IN){
      for(var i=0;i<w.IN.length;i++){
        var c=w.IN[i];
        c=this._wordMap[c]
        if(c){
          return c
        }
      }
    }
    
  },
  _isCommonFun:function(k){
    return ["add","edit","delete"].includes(k)
  },
  _removeIgnoreWords:function(w){
    if(!this._ignore2){
      var v="";
      if(!window._dictionaryConfig){
        v=_dictionaryHandler._ignores.join("|");
      }else{
        v=_dictionaryConfig.ignore
      }
      if(BZ._data._curProject.language=="cn"){
        this._ignore2=new RegExp(v)
      }else{
        this._ignore2=new RegExp("(^| )("+v+")( |$)")
      }
    }
    var ww;
    if(BZ._data._curProject.language=="cn"){
      ww= w.replace(this._ignore2,"");
    }else{
      ww=w.replace(this._ignore2," ").trim();
    }
    if(ww==w){
      return ww
    }
    return _dictionaryHandler._removeIgnoreWords(ww)
  },
  //ds: options, k: the search key word
  //Ex.: ds=["username","password"],k="name", ---> "username"
  _getSimilarWord:function(ds,k){
    var ks=_Util._clone(_dictionaryHandler._getWordsByKey(k)||[k]);
    ks.forEach(function(v,i){
      ks[i]=_Util._toCompareableWord(v)
    })
    var v=0,vv="";
    for(var i=0;i<ds.length;i++){
      var d=_Util._toCompareableWord(ds[i])
      if(ks.includes(d)){
        return ds[i];
      }else if(_includes(ks,d)){
        if(!v||d.length<v.length){
          v=d
          vv=ds[i]
        }
      }
    }
    return vv
    function _includes(s,v){
      for(var j=0;j<s.length;j++){
        if(v.includes(s[j])){
          return 1
        }
      }
    }
  },
  _getSimilarWordIdx:function(ds,k,_ignoreFormatList){
    var ks=_Util._clone(_dictionaryHandler._getWordsByKey(k)||[k]);
    ks.forEach(function(v,i){
      ks[i]=_Util._toCompareableWord(v)
    })
    var v=0,vv="",_idx;
    for(var i=0;i<ds.length;i++){
      let d=ds[i]
      if(!_ignoreFormatList){
        d=_Util._toCompareableWord(d)
      }
      if(ks.includes(d)){
        return i
      }else if(_includes(ks,d)){
        if(!v||d.length<v.length){
          v=d
          vv=ds[i]
          _idx=i
        }
      }
    }
    return _idx
    function _includes(s,v){
      for(var j=0;j<s.length;j++){
        if(v.includes(s[j])){
          return 1
        }
      }
    }
  },
  _getKeyByMiniMap:function(k){
    
  }
};
var _cssHandler={
  _cssMap:{},
  _maxTextLength:100,
  _findElementKey:function(e){
    let p=_cssHandler._findPath(e)
    return _descAnalysis._retrieveTextForElementPathItem(p)
  },
  _priorityItems:[],
  /*
  _cssMap={
    "input[type=checkbox]":{
      _names:["BUTTON"],
      _items:["INPUT","[type=checkbox]"]
    }
  },
  _nameMap:{
    //item link to _cssMap
    "button":{
      _css:["BUTTON",".btn","INPUT[type=button]","INPUT[type=submit]","INPUT[type=reset]"],
      _key:"XXX"
    }
  },
  _keyMap:{
    "24234234":{
      _name:"button",
      _css:"BUTTON,.btn,INPUT[type=button],INPUT[type=submit],INPUT[type=reset]"
    }
  }
  */
  _init:function(){
    _cssHandler._cssMap={};
    _cssHandler._nameMap={};
    _cssHandler._keyMap={};
    _cssHandler._inputCss="";
    
    var _duplidates={};
    var os=_IDE._data._curVersion.setting.objectLib,_found;
    os.component.forEach(function(o){
      o.items.forEach(function(v){
        for(var i=0;i<os.element.length;i++){
          var vv=os.element[i]
          if(vv.key==v.name){
            var c=(v.toggle||v.panel||[]).join(" ")
            if(!vv.css.includes(c)){
              vv.css+=","+c
            }
            _found=1
            break
          }
        }
        if(!_found&&v.panel){
          os.element.push({key:v.name,value:v.name,css:(v.toggle||v.panel).join(" "),component:1,data:v,hide:1})
        }
      })
    })
    for(var k in os){
      if(k=="component"){
        continue
      }
      var es=os[k]
      for(var i=0;i<es.length;i++){
        var e=es[i];
        if(k=="operation"){
          e.value=_dictionaryHandler._getWordsByKey(e.key).join("/")
        }else if(!e.value){
          e.value=_bzMessage._setting._objectLib._options[k][e.key];
          if(!e.value){
            continue
          }
        }
        var v=e.value.toLowerCase();
        var vs=v.split("/");
        var cs=this._parseGroup(e.css);
        this._keyMap[e.key]={_name:vs,_css:e.css,_type:k};
        
        vs.forEach(function(a){
          var vm=_cssHandler._nameMap[a];
          if(vm){
            _duplidates[a]=_duplidates[a]||[vm._css];
//            _duplidates[a].push(cs);
          }else{
            _cssHandler._nameMap[a]={_css:cs,_key:e.key};
          }
        });
        
        cs.forEach(function(a){
          if(!a){
            return;
          }
          var x=a.match(/^[a-z]+/i);
          if(x){
            x=x[0].toUpperCase()
            a=x+a.substring(x.length);
          }
          a=_cssHandler._parseItems(a);
          
          for(var ii=0;ii<a.length;ii++){
            var vv=_cssHandler._cssMap[a[ii]];
            if(!vv){
              vv=_cssHandler._cssMap[a[ii]]={};
            }
            if(!vv[v]){
              vv[v]={_names:vs,_items:[],_same:cs.length}
            }
            vv[v]._items.push({_item:a,_size:a.length});
          }
        });
      }
    }
    if(Object.keys(_duplidates).length){
      var _msg=_bzMessage._setting._objectLib._duplicateKey+"\n\n";
      for(var k in _duplidates){
        _msg+=k+": "+_duplidates[k].toString().replace(/,/g,", ")+"\n\n";
      }
      return alert(_msg);
    }
    //ignore class
    this._ignoreClasses=_IDE._data._curVersion.setting.content.ignoreClasses.replace(/\s/g,"").replace(/,/g,"|");
    return 1;
  },
  _isDuplicateCssKey:function(k){
    var os=_IDE._data._curVersion.setting.objectLib.element;
    for(var i=0;i<os.length;i++){
      if(os[i].key==k){
        return 1
      }
    }
  },
/*
  _addCss:function(d,v){
    if(d){
      d=new Set(d.split(","))
    }else{
      d=new Set()
    }
    d.add(v)
    return [...d].join(",")
  },
  _removeCss:function(d,v){
    d=new Set(d.split(","))
    d.delete(v)
    return [...d].join(",")
  },
  _replaceCss:function(d,v,nv){
    d=new Set(d.split(","))
    d.delete(v)
    d.add(nv)
    return [...d].join(",")
  },
  */
  _hasWaitingElement:function(){
    var c=_cssHandler._keyMap.waiting
    if(c&&c._css){
      var os=$(c._css).toArray()
      for(var i=0;i<os.length;i++){
        if(!_Util._isHidden(os[i])){
          if(!BZ._isAutoRunning()){
            _bzDomPicker._removeTmpCover()
            setTimeout(function(){
              _bzDomPicker._flashTmpCover(os[i])
            },1)
          }
          return 1
        }
      }
    }
  },
  /**/
  //t: element type, _noText: not include contain css
  _selectForUI:function(t,w,_includesText,_fun){
    BZ._data._uiSwitch._tmpCssOptions=[]
    _Util._confirmMessage({
      _tag:"div",
      _items:[
        {
          _tag:"div",
          _attr:{"class":"input-group"},
          _items:[
            {
              _tag:"input",
              _attr:{
                "class":"form-control bz-definition-css",
                value:function(){
                  return BZ._data._uiSwitch._tmpCssOptions.map((v)=>{return v._key}).join("")||w
                }
              }
            },
            {
              _tag:"div",
              _attr:{"class":"input-group-btn"},
              _items:[
                {
                  _tag:"button",_attr:{"class":"btn btn-icon bz-small-btn bz-dompicker pull-right"},
                  _jqext:{
                    click:function(){
                      _bzDomPicker._pickDetails(0,function(p){
                        if(!_includesText){
                          var v=p.pop()
                          if(!v._css.includes(":Contains")&&!v._css.includes(":endContains")&&!v._css.includes(":near")){
                            p.push(v)
                          }
                        }
                        BZ._data._uiSwitch._tmpCssOptions=p;
                        
                        setTimeout("_Util._resizeModelWindow()",1)
                      })
                    }
                  }
                }
              ]
            }
          ]
        },
        {
          _tag:"label",_attr:{style:"display:table;margin:5px;"},
          _items:[
            {
              _tag:"input",
              _dataModel:"_data._item._key",
              _attr:{type:"checkbox",value:"_data._item._css","class":"bz-select-css"}
            },
            {_text:"_data._item._css"},
          ],
          _dataRepeat:"BZ._data._uiSwitch._tmpCssOptions"
        },
      ]
    },[{
      _title:_bzMessage._common._ok,
      _click:function(c){
        var v=$(".bz-definition-css").val();
        if(!v){
          return alert(_bzMessage._system._error._requiredField,"CSS "+_bzMessage._common._value)
        }
        _fun(v)
        c._ctrl._close()
      }
    }],_Util._formatMessage(_bzMessage._setting._objectLib._identifyCss,[t]));
    
    
    function _getSelectCss(vs){
      var w=""
      for(var i=0;i<vs.length;i++){
        if(vs[i]._key){
          w+=vs[i]._key||""
        }
      }
      return w
    }
  },
/*  */
  _setCurPanel:function(v){
    if(BZ._hasExtension()){
      BZ._setSharedData({"_cssHandler._curPanel":v})
    }else{
      _cssHandler._curPanel=v
    }
  },
  _isNatureCustomizeInput:function(e){
    return (e.tagName=="INPUT"&&(e.type=="text"&&($(e).css("opacity")==0||$(e).css("visibility")=="hidden"))||["submit","button","image"].includes(e.type))
          ||(!_Util._isInContentEditable(e)&&(!_Util._isStdInputElement(e)||$(e).attr("readonly")))
  },
  _getComponeDefinitionSetting:function(_type){
    let _setting=[{_text:"_panel",_value:"panel",_required:1}]
    if(["dropdownInput","menu"].includes(_type)){
      _setting.unshift({_text:"_value",_value:"value",_required:1})
      _setting.unshift({_text:"_toggle",_value:"toggle",_required:1})
    }
    if(["dropdownInput"].includes(_type)){
      _setting.push({_text:"_clear",_value:"clear",_required:0})
    }
    if(["container","popWindow","table","list"].includes(_type)){
      _setting.push(
        {_text:"_objTitle",_value:"title"},
        {_text:"_ctrlPanel",_value:"ctrlPanel"}
      )
    }
    if(_type=="table"){
      _setting.push(
        {_text:"_header",_value:"header"},
        {_text:"_row",_value:"row",_required:1},
        {_text:"_col",_value:"col",_required:1},
        {_text:"_paging",_value:"paging"}
      )
    }else if(["list","navigator","path","menu","tab"].includes(_type)){
      _setting.push({_text:"_item",_value:"item",_required:1})
      if(_type=="tab"){
        _setting.push({_text:"_content",_value:"content",_required:1})
      }
    }
    return _setting
  },
  _getInitCustomizeSetting:function(_type){
    let o={type:_type,steps:[],name:_bzMessage._setting._objectLib._options.component[_type]};
    if(_type=="table"){
      Object.assign(o,{
        row:["tr"],col:["td"],header:["thead"],title:["caption"]
      })
    }else if(["dropdownInput","rangeSlider"].includes(_type)){
      o.input=1
      if(_type=="dropdownInput"){
        o.clear=[".close|.remove|.clear|.clean|.cross"]
        o.format="$1"
      }
    }
    return o;
  },
  _lookLikeInput:function(l,i){
    return !_Util._isHidden(i)&&(_Util._isInputObj(i)||(_isInputSize(i)&&_isInputPos(l,i)))
    function _isInputSize(o){
      o=o.getBoundingClientRect()
      return o.width/o.height>2
    }
    function _isInputPos(l,i){
      l=l.getBoundingClientRect()
      i=i.getBoundingClientRect()
      if(i.left<=l.left+10){
        return i.top>l.top-10&&i.top<l.bottom+30
      }else if(i.left>=l.right-10&&i.left<=l.right+30){
        return i.top>l.top-10&&i.top<l.bottom-10
      }
    }
  },
  _findSamilarElementByStyle:function(o,e){
    let c=e.tagName+" "+e.className.trim();
    c=c.split(/ +/).filter(x=>!x.match(/[0-9]/)).join(".")
    
    return $(o).find().toArray()
  },
  _findNodeByTxt:function(p,v,_removeSign){
    let ws=[],_fun;
    if(_Util._isRegexData(v)){
      _fun=_match
      v=eval(v+`i`)
    }else if(v.includes("|")){
      _fun=_match
      v=eval(`/${v}/i`)
    }else{
      v=v.toLowerCase()
    }
    let _txt=(p.innerText||"").replace(/[ \xa0]+/g," ")
    if(_removeSign){
      _txt=_Util._removeSign(_txt," ")
    }
    if(_fun){
    }else if(_include(_txt,v)){
      _fun=_include
    }else if(_include(_txt,v)){
      _fun=_advInclude
    }else{
      return ws
    }
    
    _doIt(p,v,ws)

    return ws
    
    function _doIt(p,v,ws){
      for(let n of p.childNodes){
        if(n.nodeType==3){
          let w=n.textContent
          
          if(_fun(w,v)){
            ws.push({e:n.parentElement,o:n.parentElement,w:w,n:n,ks:[]})
          }
        }else if(n.nodeType==1&&!["SVG","IMG"].includes(n.tagName)){
          let x=(n.innerText||"").replace(/[ \xa0]+/g," ")
          if(_removeSign){
            x=_Util._removeSign(x," ")
          }
          if(_fun(x,v)){
            if(!_Util._isHidden(n)){
              let ss=[]
              _doIt(n,v,ss)
              if(!ss.length){
                let ks=[]
                _removeTxtNode(n,v,ks)
                ks=ks.filter(y=>_cssHandler._lookLikeInput(n,y))
                ss.push({
                  e:n,w:x,ks:ks,o:n
                })
              }
              ws.push(...ss)
            }
          }
        }
      }
    }
    function _removeTxtNode(n,v,_keepNodes){
      for(let nn of n.childNodes){
        if(nn.nodeType==3){
          let _txt=nn.textContent.trim()
          if(_txt&&v.startsWith(_txt)){
            v=v.substring(_txt.length).trim()
          }
        }else if(nn.nodeType==1){
          if(!v){
            _keepNodes.push(nn)
          }else{
            v=_removeTxtNode(nn,v,_keepNodes)
          }
        }
      }
      return v
    }
    function _include(v1,v2){
      return (v1||"").toLowerCase().includes(v2)
    }
    function _advInclude(v1,v2){
      return _Util._removeSign((v1||"").toLowerCase()," ",0,1).includes(v2)
    }
    function _match(v1,v2){
      return v1.match(v2)
    }
  },
  /**/
  //f:format ($1/$2), s:steps
  _getValiableParameterBySteps:function(f,s){
    if(f){
      f=f.match(/\$[0-9]+/g)
      if(f.length){
        s.forEach(function(v){
          if(v.event && v.event.value){
            var i=f.indexOf(v.event.value)
            if(i>=0){
              f.splice(i,1)
            }
          }else{
            v.element.forEach(function(vv){
              if(vv.match){
                vv=vv.match(/\$[0-9]+/)
                if(vv){
                  vv=vv[0]
                  var i=f.indexOf(vv)
                  if(i>=0){
                    f.splice(i,1)
                  }
                }
              }
            })
          }
        })
        return f[0]
      }
    }
  },
  //split css setting, like: "button,.btn" to ["button",".btn"]  
  _parseGroup:function(_css){
    _css=_css||""
    var _back=0,b=0,v="",vs=[];
    
    for(var i=0;_css&&i<_css.length;i++){
      var c=_css[i];
      
      if(c=="," && !b){
        v=v.trim();
        if(v){
          vs.push(v);
        }
        v="";
      }else{
        v+=c;
      }
      if(!b){
        var bi="\"'([".indexOf(c);
        if(bi>0){
          b="\"')]"[bi];
        }
      }else if(c==b && !_back){
        b=0;
      }else if(c=="\\"){
        _back=!_back;
      }else{
        _back=0;
      }
    }
    v=v.trim();
    if(v){
      vs.push(v)
    }
    return vs;
  },
  //split css like: "button.btn-add" to ["button",".btn-add"]
  _parseItems:function(_css){
    var _back=0,b=[],v="",vs=[];
    for(var i=0;i<_css.length;i++){
      var c=_css[i];
      if(".#[:".includes(c) && !b.length){
        v=v.trim();
        if(v){
          vs.push(v);
        }
        v=""
      }
      v+=c;
      var bi="\"'([{".indexOf(c);
      if(bi>0){
        b.unshift("\"')]}"[bi]);
      }
      if(c==b[0] && !_back){
        b.shift();
      }else if(c=="\\"){
        _back=!_back;
      }else{
        _back=0;
      }
    }
    v=v.trim();
    if(v){
      vs.push(v)
    }
    return vs;
  },
  //split element path from "BZ.TW.document DIV:Contains(lws ok) 0" --> ["BZ.TW.document","DIV:Contains(lws ok)",0]
  _parseElementPath:function(v){
    if(!v){
      return
    }
    v=_Util._parseExpression(v+" ",/ /)
    return v._headers
  },
  //from ["LABEL",":endContains(Name)"] to ["{LABEL}","\"Name\""]
  _cssToDesc:function(p){
    var ss=[],_css=[];

    for(var n=0;n<p.length;n++){
      var c=this._findDesc(p[n]);
      if(!c){
        continue;
      }else if('"'==c[0]){
        var s=_JSHandler._parseCode(c.substring(1,c.length-1));
        if(s.constructor==Array){
          var c=""
          for(var i=0;i<s.length;i++){
            if(s[i].txt){
              c+='"'+s[i].txt+'"'
            }else if(s[i].code){
              c+='('+s[i].code+')'
            }
          }
        }
        ss.push(c)
      }else if('{'==c[0]){
        if(!ss.includes(c)){
          ss.push(c)
        }
      }else if(c){
        var ks=[];
        for(var k in c){
          var cc=c[k];
          for(var m=0;m<p.length;m++){
            var pm=p[m];
            if(pm.match(/:has\(/)){
              pm=pm.substring(5,pm.length-1);
            }
            var _found=0;
            for(var ii=0;ii<cc._items.length;ii++){
              var _items=cc._items[ii];
              var _item=_items._item;
              
              var _idx=_item.indexOf(pm);
              if(_idx>=0){
                _item.splice(_idx,1);
                cc._find=cc._find||0;
                if(!_item.length){
                  if(!ks.includes(cc)){
                    ks.push(cc)
                  }
                  if(cc._find<_items._size){
                    cc._find=_items._size;
                  }
                }
              }
            }
          }
        }
        var k=0;
        for(var m=0;m<ks.length;m++){
          if(k){
            if(k._find<ks[m]._find){
              k=ks[m]
            }else if(k._find==ks[m]._find){
              if(k._names.length>ks[m]._names.length || k._same>ks[m]._same){
                k=ks[m]
              }
            }
          }else{
            k=ks[m]
          }
        }
        if(k){
          if(!ss.includes(k._names[0])){
            ss.push(k._names[0])
          }
        }else{
          ss.push("{"+p[n]+"}")
        }
      }
    }
    return ss;
  },
  /*From 
    Text: ":endContains(Sharing)" to "Sharing"
    Defined object: ".bz-delete" to "delete"
    un-defined object: "div" to {div}
  */
  _findDesc:function(v){
    if(!v){
      return
    }
    var _css=_cssHandler._cssMap[v];
    var _first;
    if(_css){
      return _Util._clone(_css);
    }else if(v[0]==":" && !v.startsWith(":attr(")){
      var si=v.indexOf("(")+1;
      if(si){
        var ei=v.lastIndexOf(")");
        if(ei<0){
          ei=v.length;
        }
        si=v.substring(si,ei);
        if(v.match(/^:has\(/)){
          return this._findDesc(si);
        }else{
          si="\""+si+"\"";
        }
        return si;
      }
    }else if(v.startsWith(":attr(")){
      v=v.match(/\=(\"|\'|)([^\"\'\)]+)/)
      if(v){
        return '"'+v[2]+'"'
      }
    }else if(v.startsWith("[")){
      var si=v.indexOf("=")+2;
      if(si){
        var ei=v.lastIndexOf("\"");
        if(ei>0){
          si="\""+v.substring(si,ei)+"\"";
          return si;
        }
      }
    }else if("#.".includes(v[0]) || v[0].match(/[a-z]/i)){
      return "{"+v+"}"
    }
  },
  _getRootShadowDom:function(e){
    let r=0;
    while(e&&(e.parentNode||(e.host&&e.host.constructor!=String))){
      if(e.host){
        r=e;
      }
      e=e.parentNode||e.host;
    }
    return r;
  },
  _isInShadowDom:function(e){
    e=_cssHandler._getRootShadowDom(e);
    return e&&e.host&&e.host.constructor!=String&&!_Util._isHidden(e.host)
  },
  _getRoot:function(e){
    let d=e.ownerDocument;
    while(e.parentNode){
      e=e.parentNode;
      if(e.host&&e.host.constructor!=String){
        return e
      }
    }
    return d
  },
  _addPanelOnPath:function(d){
    try{
      let ps=_cssHandler._keyMap.panel,
          s=d.oe.bzTmp
          
      ps=ps&&ps._css
      if(ps){
        if(s.constructor==String){
          s=s.split("\n")
        }
        if(s[0]!="BZ.TW.document"){
          s.unshift("BZ.TW.document")
        }
        ps=ps.split(",")
        return ps.find(p=>{
          let os=$(p)
          if(os.find(d.oe).length){
            if(!p.match(/[A-Z]/i)){
              os=os.toArray()
              os.find(o=>{
                if($(o).find(d.oe).length){
                  p=o.tagName+p
                  return 1
                }
              })
            }
            s.splice(1,0,p)
            
            d.oe.bzTmp=s
            return 1
          }
        })
      }
    }catch(e){}
  },
  _isCover:function(c){
    c=c.getBoundingClientRect()
    return c.width>200&&c.height>200&&!c.innerText
  },
  _isCoverOfElement:function(c,e){
    let cr=c.getBoundingClientRect(),
        er=e.getBoundingClientRect()
    if(["checkbox","radio"].includes(e.type)){
      return cr.left<=er.right-10&&cr.right>=er.left+10&&cr.top<=er.bottom-10&&cr.bottom>=er.top+10
    }
    return cr.left<=er.left&&cr.right>=er.right&&cr.top<=er.top&&cr.bottom>=er.bottom
  },
  _findChkRadio:function(e){
    let k="input[type=radio],input[type=checkbox]"
    let o=$(e).find(k)
    if(o.length==1){
      return o[0]
    }
    o=$(e.parentElement).find(k)
    if(o.length==1){
      o=o[0]

      return (_Util._isHidden(o)||_cssHandler._isCoverOfElement(e,o))&&o
    }
    
  },
  _findHoverCssByElement:function(e,_cssOnly){
    if(e.constructor==Array||e.constructor==String){
      e=$util.findDom(e)
    }
    let r=[]
    if(e){
      let s = document.styleSheets;

      for(var i=0; i<s.length; i++) {
        try{
          var rs = (s[i]||{}).cssRules||[];

          for(var j=0; j<rs.length; j++) {
            let v=rs[j].selectorText||""
            if(v.includes(":hover")) {
              let hv=v.split(":hover")
              hv.pop()
              hv=$(hv.join(""))
              if(_cssOnly){
                if(hv.find(e).length||hv.is(e)){
                  r.push({
                    v:v,
                    css:rs[j].cssText
                  })
                }
              }else{
                let os=hv.toArray().forEach(x=>{
                  if(x==e||$(x).find(e).length){
                    r.push({
                      v:v,
                      o:x,
                      css:rs[j].cssText
                    })
                  }
                })
              }
            }
          }
            
        }catch(ex){}
      }
    }
    return r
  },
  _isLeftLabel:function(e){
    let p=e
    while(!p.innerText.trim()&&p.parentElement){
      p=p.parentElement
    }
    p=p.getBoundingClientRect()
    e=e.getBoundingClientRect()
    return e.left>p.left+p.width/2
  },
  _findLabelByInput:function(e,_retrieveElement){
    let _optionWord=""
    if(e.type=="radio"){
      return e.name
    }
    let _left="checkbox"!=e.type||_cssHandler._isLeftLabel(e),_file=e.type=="file",_break

    return _doIt(e.parentElement,e)||_cssHandler._getElementTitle(e)

    function _doIt(p,e){
      if(!p){
        return
      }
      let os=[],_start=_left,os2=[]
      let cs=os;
      for(let o of p.childNodes){
        if(o==e){
          if(_start){
            if(_file){
              cs=os2
            }else{
              break
            }
          }else{
            _start=1
          }
        }else if(_start&&((o.nodeType==1&&!_Util._isHidden(o))||o.nodeType==3)){
          cs.push(o)
        }
      }
      if(_left||_file){
        os.reverse()
      }
      if(os.length||os2.length){
        let w=_findInList(os)||_findInList(os2)||_optionWord
        
        if(w){
          return w
        }else if(_break||p.tagName=="BODY"){
          return
        }else{
          return _doIt(p.parentElement,p)
        }
      }else{
        return _doIt(p.parentElement,p)
      }
    }
    
    function _findInList(os){
      if(os.length){
        let w,oo;
        os.find(x=>{
          if(x.nodeType==3){
            w=_cleanWord(x.textContent||"")
            if(w){
              oo=x
            }
            return w
          }else if(x.nodeType==1){
            // if(_Util._isEmpty(_cssHandler._findAllInputs(x))){
              w=_cleanWord(x.innerText||"")
              if(w){
                if(_Util._isHidden(x)){
                  _optionWord=_optionWord||w
                  return
                }
                oo=x
                if(x.children.length){
                  w=_findTitle(x)||x
                }
              }
              return w
            // }else{
            //   _break=1
            //   return 1
            // }
          }
        })
        return _retrieveElement?oo:w
      }
    }
    
    function _cleanWord(w){
      return _Util._removeSign(w," ",["-"])
    }

    function _findTitle(o){
      let os=o.childNodes,ss=[];
      for(let x of os){
        ss.push(x)
      }
      return _findInList(ss)
    }
  },
  _findPanelPath:function(e,p,os){
    let r="BZ.TW.document",
        v=_findGoodPath(e,e,p,os);
    if(v){
      return [r,v,0]
    }
    let pp=e.parentElement
    while(pp){
      if($(pp).find(os).length==os.length){
        return
      }
      v=_findGoodPath(pp,e,pp.tagName,os,p)
      if(v){
        return [r,v,p,0]
      }
      pp=pp.parentElement
    }

    function _findGoodPath(e,o,p,os,ep){
      let v;
      if(_isGoodValue(e.id)){
        if($("#"+e.id).length==1){
          v= p+"#"+e.id
        }
      }else{
        let cs=(e.className||"").split(/\s+/)
        cs=cs.filter(x=>_isGoodValue(x)&&!_cssHandler._isIgnoreClass(x));
        cs.find(x=>{
          if(ep){
            let oo=_Util._findDoms([r,p+"."+x,ep])||[]
            if(oo[0]==o){
              v=p+"."+x
              return 1
            }
          }else{
            if($("."+x).find(os)[0]==o){
              v=p+"."+x
              return 1
            }
          }
        })
      }
  
  
      return v
  
    }

    function _isGoodValue(v){
      return v&&!v.match(/[0-9]/i)
    }
  },
  _findInputPath:function(e,_scope){
    let _label=_cssHandler._findLabelByInput(e)
    if(_label){
      return _findMethod(e,_label)
    }

    let _inHidden=_Util._isHidden(e)?":hidden":""
    let _type=["checkbox","radio","file"].includes(e.type)?`:attr(type=${e.type})`:""

    if(e.type=="radio"&&e.tagName=="INPUT"){
      if(e.name){
        return _insertScope(["BZ.TW.document","INPUT"+_type+":text("+e.name+")",0],_scope)
      }
    }
    let pe=_findFirstElementWithLabel(e,$util.getElementText(e));
    if(!pe){
      if(e.placeholder){
        return _insertScope(["BZ.TW.document",e.tagName+"[placeholder="+$(e).attr("placeholder")+"]",0],_scope)
      }
      return
    }

    if(e.type=="radio"&&e.tagName=="INPUT"){
      return _findSecondElementWithLabel(pe.p,e,pe.w)
    }
    
    function _findMethod(e,_label){
      let ms=["input","afterEqual","after","Contains","before"],
          _min={},fp;
      ms.find(x=>{
        let _path=["BZ.TW.document",`${e.tagName}:${x}(${_label})`]
        _insertScope(_path,_scope)
        let o=_Util._findDoms(_path)||[]

        if(o[0]==e){
          _path.push(0)
          fp=_path
          return 1
        }else if(o.includes(e)){
          let p=_cssHandler._findPanelPath(e,_path[1],o)
          if(p){
            fp=p
            return 1
          }

          let i=o.indexOf(e)
          if(!_min||i<_min.i){
            _path.push(i)
            _min={i:i,p:_path}
          }
        }
      })
      if(_min){
        fp=fp||_min.p
      }
      return fp
    }

    //return ["BZ.TW.document",e.tagName+_inHidden+_type+":near("+_formatLabel(pe.w)+")",0]

    function _findFirstElementWithLabel(o,pw){
      let p=o,_last=o,_lastWord=(pw||"").trim(),_bkLabel
      while(p.tagName!="BODY"&&p.parentElement){
        _last=p
        p=p.parentElement
        let _innerInputs=_Util._findInputs(p)
        if(_innerInputs.length>1&&_innerInputs.find(x=>x!=o&&!_Util._isHidden(x))){
          if(_bkLabel){
            return _bkLabel
          }
          return
        }
        let cw=$util.getElementText(p)
        if(cw&&cw!=_lastWord){
          let _start=!["radio","checkbox","file"].includes(o.type),
              w=""
          if(_lastWord){
            cw=cw.split(_lastWord)
            if(_start&&cw[0]){
              return {p:p,w:cw[0].trim()}
            }else if(cw[1]){
              return {p:p,w:cw[1].trim()}
            }
          }
          _lastWord=cw
          if(_start){
            let pr=p.getBoundingClientRect()
            let or=o.getBoundingClientRect()
            if(or.top-pr.top<15&&or.left-pr.left<20){
              _bkLabel={p:p,w:cw}
              continue
            }
          }
          for(let x of p.childNodes){
            if(_start){
              if(x==_last){
                if(w.trim()){
                  return {p:p,w:w.trim()}
                }
                break
              }
              
              if(x.nodeType==3){
                w=w.trim()+" "+x.textContent.toString().trim()
              }else if(x.nodeType==1&&x.getBoundingClientRect().width){
                w=w.trim()+" "+$util.getElementText(x)
              }
            }else if(x==_last){
              _start=1
            }
          }
          w=w.trim()
          if(w){
            return {p:p,w:w}
          }
        }
      }
    }

    function _findSecondElementWithLabel(o,e,w){
      let p=o
      while($(p).find("input").length==1&&p.innerText.trim()==w&&p.tagName!="BODY"){
        p=p.parentElement
      }
      if(p.tagName=="BODY"){
        return
      }
      if($(p).find("input").toArray().find(x=>{
        return x.type!="radio"
      })){
        return
      }
      let oo=$(p).find("input[type=radio]")[0]
      if(oo!=e){
        w=_findFirstElementWithLabel(oo)
        if(!w){
          return 
        }
        w=w.w.trim()
      }
      let ww=p.innerText.trim()
      ww=ww.substring(0,ww.indexOf(w))
      while(!ww){
        p=p.parentElement
        if(p.tagName=="BODY"){
          return
        }
        if($(p).find("input").toArray().find(x=>{
          return x.type!="radio"
        })){
          return
        }
        ww=p.innerText.trim()
        ww=ww.substring(0,ww.indexOf(w))
      }

      return ["BZ.TW.document",`INPUT[type=radio]${_inHidden}:after(${ww.trim()})`,0]
    }
    
    function _formatLabel(ww){
      ww=ww.split("\n")
      let wx=""
      ww.forEach(x=>{
        if(x.length>wx.length){
          wx=x
        }
      })
      
      return _Util._toTrimSign(wx,30).replace(/\*+$/,"").trim()
    }

    function _insertScope(p,s){
      if(s){
        p.splice(1,0,s)
      }
      return p
    }
    
  },
  _hasAIFlag:function(e){
    return e.dataset.bz
  },
  _getButtonLabel:function(e){
    let v=_cssHandler._findLabel({e:e,oe:e})
    if(v){
      return v.w
    }
    return _cssHandler._findTitleAttribute(e)
  },
  _getOptionElementByBZFlag:function(e){
    return e.constructor==Array&&e
  },
  _getComPath:function(e,_withAIAnalysis){
    let c=window._comCss
    if(c){
      let p=["BZ.TW.document"]
      if(Object.keys(c).find(x=>{
        if($(x).find(e)[0]){
          let t=(_cssHandler._findLabel({e:e,oe:e})||{w:""}).w||""
          p.push(":"+c[x]+"("+t+")",0)
          return 1
        }
      })){
        if(_withAIAnalysis){
          p={
            W:{HH:[],WW:[]},
            _elementPath:p
          }
        }
        return p
      }
    }
  },
  _getDefinitedPath:function(e,_withAIAnalysis){
    let p=["BZ.TW.document"]
    if(e.bzPath){
      if(e.bzPath.constructor==String){
        p.push(e.bzPath)
      }else{
        if(e.bzPath[0].includes("BZ.TW.")){
          p=e.bzPath
        }else{
          p.push(...e.bzPath)
        }
      }
      if(!$.isNumeric(p[p.length-1])){
        p.push(0)
      }
      // _cssHandler._attachRealTargetElementCss(e,p)
      if(_withAIAnalysis){
        p={
          W:{HH:[],WW:[]},
          _elementPath:p
        }
      }
      return p
    }
    
  },
  _findStdTextElement:function(e,w,_panel){
    // w=_Util._removeSign((w||e.innerText||e.value||"").trim().split("\n")[0]," ")
    let _path,p
    let _data={e:e,oe:e,_headers:[]}
    _cssHandler._findAttributes(_data)
    _data=(_data._result||{})._main
    w=(w||"").trim()
    let ww=w.trim().split("\n")[0]

    if(ww){
      if(ww==w){
        _path=`${e.tagName}:equal(${w})`
      }else{
        _path=`${e.tagName}:Contains(${ww})`
      }
      p=_chkPath(_path,!_data&&_panel)
      if(p){
        return p
      }
    }

    if(_data){
      _data=_data.join("")

      if(ww){
        if(ww==w){
          _path=_data+":equal("+w+")"
        }else{
          _path=_data+`:Contains(${ww})`
        }
      }else{
        _path=_data
      }

      p=_chkPath(_path,_panel)
      if(p){
        return p
      }
    }
    
    if(!_panel){
      let h=_findHeader(e)
      if(h&&h.t){
        return _cssHandler._findStdTextElement(e,w,(h._path||h.e.tagName)+":Contains("+h.t+")")
      }
    }


    function _findHeader(e){
      let p=e.parentElement
      while(p){
        let _found
        for(let o of p.childNodes){
          if(o==e){
            break
          }
          if(o.nodeType==1){
            let w=(o.innerText||"").trim()
            if(w&&w.length<100){
              _found= {oe:p,e:p,t:w,_headers:[]}
            }
          }
        }
        if(_found){
          _cssHandler._findAttributes(_found)
          _found._path=((_found._result||{})._main||[]).join("")
          return _found
        }else{
          p=p.parentElement
        }
      }
    }

    function _chkPath(_path,_final){
      let ee;
      if(_panel){
        ee=$(_panel).find(_path).toArray()
      }else{
        ee=$(_path).toArray()
      }
      ee=ee.filter(x=>!_Util._isHidden(x))
      if(ee.includes(e)){
        let p= _shortPath(ee,e,_path)
        if(p&&$util.findDom(p)==e){
          return p
        }else if(_final){
          return _finalPath([_path,ee.indexOf(e)])
        }
      }
    }


    function _shortPath(ee,e,_path){
      if(ee[0]==e){
        return _finalPath([_path,0])
      }else if(ee._last()==e){
        return _finalPath([_path+":last",0])
      }
    }

    function _finalPath(v){
      let p= ["BZ.TW.document",...v]
      if(_panel){
        p.splice(1,0,_panel)
      }
      return p
    }
  },
  _getTextPath:function(e){
    let t=(e.innerText||"").trim().split("\n")[0]
    if(t){
      let tw=`${e.tagName}:text(${t})`
      let os=$(tw).toArray()
      let i=os.indexOf(e)
      if(i>=0){
        if(i&&i==os.length-1){
          return ["BZ.TW.document",tw+":last",0]
        }
        return ["BZ.TW.document",tw,i]
      }
    }
  },
  //get element path
  //_simple: 1: only level 1, 2: ignore label, 3: only label, 4: class first (for panel)
  //_simple: 1: only level 1, 2: ignore label, 3: only label
  _findPath:function(e,_withAIAnalysis,_simple){
    try{
      _extendJQuery()
      if ($(e).hasClass("BZIgnore") || $(e.ownerDocument).find(".BZIgnore").find(e).length) {
        return;
      }
      if(e.bzShortCut&&e.tagName!="CANVAS"){
        if(_withAIAnalysis){
          return e.bzShortCut
        }
        return e.bzShortCut._elementPath
      }
      let _definitedPath=_cssHandler._getDefinitedPath(e,_withAIAnalysis)
      if(_definitedPath){
        return _definitedPath
      }

      _definitedPath=_cssHandler._getComPath(e,_withAIAnalysis)
      if(_definitedPath){
        return _definitedPath
      }

      e=this._findCellElement(e);

      let _table=_Util._getParentElementByCss("table",e),_curScope
      if(_table){
        if(_table&&_cssHandler._getTableType(_table)=="dataTable"){
          let td=_Util._getParentElementByCss("td,th",e)
          if(td){
            _table=_findRowColPath(td,_table)
            if(_table){
              if(td==e){
                _table=["BZ.TW.document",_table,0]
                e.bzTmp=_table
                if(_withAIAnalysis){
                  return {
                    _elementPath:_table,
                    W:{}
                  }
                }
                return _table
              }else{
                _curScope=_table
              }
            }
          }
        }
      }

      if(e.tagName=="CANVAS"){
      }else if(!_isInput(e)){
        let w=e.innerText||e.value||_cssHandler._getElementTitle(e)

        let _path=_cssHandler._findStdTextElement(e,w,_curScope)
        if(_path){
          if(_withAIAnalysis){
            return {
              W:{HH:[],WW:[]},
              _elementPath:_path
            }
          }else{
            return _path
          }
        }

        // if(_cssHandler._hasAIFlag(e)){
        //   let fe=_cssHandler._findPathByAIFlag(e)
        //   if(fe){
        //     if(_withAIAnalysis){
        //       return {
        //         W:{HH:[],WW:[]},
        //         _elementPath:fe
        //       }
        //     }else{
        //       return fe
        //     }
        //   }
        // }
      }else{
        let _quickPath= _cssHandler._findInputPath(e,_curScope)
        if(_quickPath){
          let _chkInput=_quickPath.find((x,i)=>{
            if(x[0]==":"){
              x=e.tagName+x
              _quickPath[i]=x
            }
            if(x.constructor==String&&x.match(/:input\(/)){
              if(_IDE._data._curAction&&"02".includes(_IDE._data._curAction.type)){
                _quickPath[i]=x.replace(":input(",":data(")
              }
              return 1
            }
          })

          // let _attachFlag=_chkInput?0:_cssHandler._attachRealTargetElementCss(e,_quickPath)
          
          // if(_chkInput||_chkPath(e,_quickPath,_attachFlag)){
          if(_chkInput||_chkPath(e,_quickPath)){
            if(_simple!=3){
              if(_withAIAnalysis){
                return {
                  W:{HH:[],WW:[]},
                  _elementPath:_quickPath
                }
              }else{
                return _quickPath
              }
            }else{
              return _quickPath
            }
          }
        }else if(_simple==3&&_Util._isHidden(e)){
          return
        }
      }
      
      let ep=_cssHandler._getTextPath(e)
      if(ep){
        if(_withAIAnalysis){
          return {
            W:{HH:[],WW:[]},
            _elementPath:ep
          }
        }
        return ep
      }
      if(!_simple&&e.tagName.match(/(DIV|PRE|P)/)&&$(e).find("button,a,input").length){
        _simple=4
      }
      var d={
        e:e,
        oe:e,
        ps:[],
        ee:1,
        _headers:[],
        _stopLabel:_simple==2,
        _labelOnly:_simple==3,
        _classFirst:_simple==4,
        _stopHeader:_cssHandler._curPanel
      },o,bk,_chkPanel;
      if(!e.bzShortCut||e.tagName=="CANVAS"){
        e.bzW=0
        var ee=d.ee;
  //      console.time("_findPath")
        while(d.e.ownerDocument){
          this._checkDescPath(d,_simple||_cssHandler._curPanel);
          if(_simple==1){
            break
          }
          if(_cssHandler._curPanel){
            var _tmp=d.oe.bzTmp
            if(d.ee.length>1){
              _tmp=_Util._clone(_tmp)
            }
            if(_tmp.constructor==String){
              _tmp=_tmp.split("\n")
            }
            _tmp.splice(1,0,_cssHandler._curPanel)
            if(d.ee.length>1){
              var os=_Util._findDoms(_tmp)
              if(os.length==1){
                d.oe.bzTmp=_tmp
                break
              }
            }else{
              d.oe.bzTmp=_tmp
              break
            }
          }else if(d._label&&_simple==3&&(d.oe==d.ee||d.ee.length==1)){
            break
          }else if(d._label&&!_chkPanel&&(_chkPanel=1)&&_cssHandler._addPanelOnPath(d)){
            break
          }else if(!_Util._isEmpty(d._headers)&&!_chkPanel&&(_chkPanel=1)&&_cssHandler._addPanelOnPath(d)){
            break
          }else if(d.ee&&(d.ee==d.oe||d.ee[0]==d.oe)&&(d._label||d._stopLabel)&&(d._stopHeader||!_Util._isEmpty(d._headers))){
            break
          }else if(d._label&&d._labelOnly){
            break
          }else if(d.e!=d.oe){
            var ee=$(d.e).find(d.ee);
            if(!d.e.ownerDocument || d.e==d.e.ownerDocument.body.parentElement){
              bk=d.oe.bzTmp;
              if(!bk){
                return _Util._getElementSimplePath(d.oe);
              }
              if(_Util._isInputObj(d.oe)){
                var s=bk.constructor==String?bk.split("\n"):bk;
                if(s.length==2 && d.e.innerText && ee.length<4){
                  continue;
                }
              }
              _descAnalysis._findElementIdx(d.oe);
              if($util.findDom(d.oe.bzTmp)==d.oe){
                break;
              }else{
                if(bk.constructor==String){
                  bk=bk.split("\n")
                }
                d.oe.bzTmp=bk;
              }
            }
          }
          if(d.e.tagName=="BODY"||(d.e.host&&d.e.host.constructor!=String)){
            break
          }
        }
        if(d.oe.bzTmp){
          if(d.oe.bzTmp.constructor==Array){
            d.oe.bzTmp=d.oe.bzTmp.join("\n")
            if(d.e.host&&d.e.host.constructor!=String){
              let tmp=d.e.bzTmp;
              if(tmp.constructor==Array){
                tmp=tmp.join("\n")
              }
              if(!d.oe.bzTmp.startsWith(tmp)){
                d.oe.bzTmp=tmp+"\n"+d.oe.bzTmp;
              }
            }
          }
          if(!d.oe.bzTmp.startsWith("BZ.TW.document")){
            d.oe.bzTmp="BZ.TW.document\n"+d.oe.bzTmp
          }
          _descAnalysis._findElementIdx(d.oe,_simple)
        }
        
  //      d.oe.bzTmp=this._optimizePath(d.oe.bzTmp,d.oe);
  //      console.timeEnd("_findPath")
      }
      if(d.oe.bzTmp.constructor==String){
        d.oe.bzTmp=d.oe.bzTmp.split("\n")
      }
      let p=_Util._clone(d.oe.bzTmp)
      // if(_cssHandler._attachRealTargetElementCss(d.oe,p)){
      //   if(_chkPath(d.oe,p,1)){
      //     d.oe.bzTmp=p
      //   }
      // }
      if(_withAIAnalysis){
        if(d.oe.bzShortCut){
          return d.oe.bzShortCut
        }
        if(!d.oe.bzW){
          d.oe.bzW=_descAnalysis._getAICssData(d.oe,d.oe.bzTmp,d._label)
        }
        return d.oe.bzShortCut={
          _elementPath:d.oe.bzTmp, 
          W:d.oe.bzW||{}
        }
      }
      if(d.oe.bzShortCut){
        return d.oe.bzShortCut._elementPath
      }
      _Util._setBlankIFramePath(d.oe.bzTmp,d.oe)
      
      return d.oe.bzTmp||_Util._getElementSimplePath(d.oe);
    }catch(exx){
      e.bzTmp=_Util._getElementSimplePath(e)
      return e.bzTmp
    }

    
    // function _chkPath(e,p,_attachFlag){
    //   let fe=$util.findDom(p)
    //   if(_attachFlag){
    //     return fe&&(e==fe||$(e).find(fe)[0])
    //   }else{
    //     return fe==e||(fe&&fe.type=="radio"&&e.type=="radio"&&fe.name==e.name)
    //   }
    // }
    function _chkPath(e,p){
      let fe=$util.findDom(p)
      return fe==e||(fe&&fe.type=="radio"&&e.type=="radio"&&fe.name==e.name)
    }
    
    function _isInput(e){
      let a=_IDE._data._curAction
      if(_Util._isInputObj(e)){
        return 1
      }
      if(a&&!BZ._isRecording()){
        if(a.type==1&&"change,key".includes(a.event.type)){
          return 1
        }else if(a.type==2||(a.type==0&&a.content&&["innerText","value","data"].includes(a.content.type))){
          let ee= _cssHandler._findLabelByInput(e,1)
          return ee.tagName!=e.tagName&&(e.tagName!="A"||!$(ee).find(e.tagName)[0])
        }
      }
    }

    //o:TR cell,t: table (option)
    function _findRowColPath(o,t){
      if(["TD","TH"].includes(o.tagName)){
        let p=o,tr,th,rc,hc,x,y,s,or=o.getBoundingClientRect();
        while(p.parentElement){
          p=p.parentElement
          if(p.tagName=="TR"){
            tr=p
            if(t){
              break
            }
          }else if(p.tagName=="TABLE"){
            t=p
            break
          }
        }
        th=$(t).find("tr:eq(0)")[0]
        rc=$(tr).find("td,th")[0]
        if(!$util.getElementText(th)){
          return
        }
        let trs=th.children
        x=$(tr).find("td,th").toArray().indexOf(o)

        if(x>=0){
          hc=trs[x]
          if(hc){
            if(!$util.getElementText(hc)){
              return
            }
            let rh=hc.getBoundingClientRect()
            if(rh.left-5<=or.left&&rh.right+5>or.right){
              return _getRCValue(rc,hc)
            }else if(rh.left>=or.right-5){
              x--
              s=-1
            }else{
              x++
              s=1
            }
          }else{
            x--
            s=-1
          }
        }

        for(;x<trs.length;x+=s){
          let hc=trs[x]
          if(hc){
            let rh=hc.getBoundingClientRect()
            if(rh.left-5<=or.left&&rh.right+5>or.right){
              return _getRCValue(rc,hc)
            }
          }else if(x<0){
            return
          }
        }
      }
      function _getRCValue(rc,hc){
        return o.tagName+":RowCol("+$util.getElementText(rc)+"|"+$util.getElementText(hc)+")"
      }
    }

  },
  
  /*
  _optimizePath:function(ps,o){
    var ns=[],_found;
    if(ps.constructor==String){
      ps=ps.split("\n");
    }
    
    for(var i=ps.length-1;i>0;i--){
      var p=ps[i];
      if(p!=_cssHandler._curPanel&&p.match && p.match(/[.#]/) && !_found){
        var p1=p.match(/[.#][a-z0-9_-]+/ig)
        
        if(p1){
          var c=p.match(/:[a-z]+\([^)]+\)/gi)
          if(c){
            p1.forEach(function(v){
              var _include=0
              for(var i=0;i<c.length;i++){
                if(c[i].includes(v)){
                  _include=1
                  break
                }
              }
              if(!_include){
                _found=1
                p=p.replace(v,"")
              }
            })
          }else{
            _found=1
            p=p.replace(p1[0],"")
          }
        }
      }
      ns.unshift(p)
    }
    if(_found){
      ns.unshift(ps[0])
      var oo= $util.findDom(ns)
      if(oo==o){
        return _cssHandler._optimizePath(ns,o)
      }
    }
    return ps;
  },
  */
  _isIgnoreClass:function(c){
    return c.match(_cssHandler._ignoreClasses)
  },
  _getFormBtnType:function(b){
    b=["$submit","$cancel","$confirm","$next","$back"].find(x=>{
      return _cssHandler._isBtnByType(b,x)
    })
    return b
  },
  _isBtnByType:function(o,_type){
    let w=o.innerHTML.toLowerCase(),m=_bzMessage._method,s;
    switch(_type){
      case "$submit":
        s=`/${m._submit}|${m._save}|submit|save|store/i`
        break
      case "$cancel":
        s=`/${m._cancel}|${m._close}|close|cancel/i`
        break
      case "$confirm":
        s=`/${m._confirm}|confirm/i`
        break
      case "$next":
        s=`/${m._next}|${m._continue}|next|continue/i`
        break
      case "$back":
        s=`/${m._back}|${m._previous}|back|previous/i`
    }
    
    return w.match(eval(s))
  },
  _findForm:function(_root){
    _root=_root||document.body
    let wr=document.body.getBoundingClientRect();
    let w=wr.width*0.8,t=wr.height*0.4
    let p=$(_root).find("*").toArray().reverse().find(x=>{
      if(x.tagName=="BODY"){
        return 1
      }else if(x.tagName=="DIV"){
        let r=x.getBoundingClientRect();
        if(r.width>=w&&r.top<=t&&r.height>100){
          return _cssHandler._findAllInputs(x).length
        }
      }
    })
    if(!p){
      return _root
    }

    return _cssHandler._getBetterParent(p)

  },
  _getBetterParent:function(p){
    if(p.tagName=="BODY"||_cssHandler._isFixedAbsoluteElement(p)){
      return p
    }
    let r=p.getBoundingClientRect(),
        pr=p
    while(1){
      let pp=p.parentElement
      if(pp){
        let ppr=pp.getBoundingClientRect()
        if(ppr.width-r.width<=40){
          return _cssHandler._getBetterParent(p.parentElement)
        }
      }
      pr=pr.previousElementSibling
      if(!pr){
        return _cssHandler._getBetterParent(p.parentElement)
      }else if(!_Util._isHidden(pr)){
        let rr=pr.getBoundingClientRect()
        if(rr.width>r.width){
          if(rr.width==window.innerWidth){
            return p
          }
        }else if(rr.left<r.left||rr.left>r.right-10){
          return p
        }
      }
    }
  },
  _isFixedAbsoluteElement:function(o){
    return ["fixed","absolute"].includes($(o).css("position"))
  },
  _findCellElement:function(e,_root){
    if(["INPUT","TEXTAREA","SELECT","A","BUTTON","DIV","SPAN"].includes(e.tagName)){
      return e;
    }
    if(e.tagName=="SPAN"){
      return _Util._getParentElementByCss("button,a",e)||e
    }
    try{
      if($(e).is(_IDE._data._curVersion.setting.content.clickableElements)){
        return e
      }
    }catch(ee){}
    var es=$(_root||e.ownerDocument).find("SVG,[contenteditable=true],A,SELECT,"+_cssHandler._keyMap.button._css);
    if(es.is(e)){
      if(e.tagName=="svg"){
        if(!$("button,A").find(e).length){
          return e
        }
        while(!["A","BUTTON"].includes(e.tagName)){
          e=e.parentElement
        }
        return e
      }
      return e
    }else{
      es=es.filter(function(m,ee){
        var r=ee.getBoundingClientRect()
        if(!r.width || !r.height){
          return
        }
        if($(ee).find(e).length){
          if(["SVG","SELECT"].includes(ee.tagName.toUpperCase()) || (ee.innerText && ee.innerText.trim())){
            return ee;
          }else{
            return e;
          }
        }
      });
      if(es.length){
        return es[0]
      }
    }
    return e;
  },
  _isPriorityElementItem:function(v){
    if(v[0]=="["){
      v=v.split("=")[0]
    }
    var os=_cssHandler._priorityItems
    if(!os.length){
      os=_cssHandler._priorityItems=_IDE._data._curVersion.setting.content.priorityElementItems.replace(/[,; ]/g,",").split(",")
      os.forEach((a,i)=>{
        os[i]="^"+a.replace(/\./g,"").replace(/[*]/g,".+")+"$"
      })
    }
    return os.find(o=>{
      return v.match(new RegExp(o))
    })
  },
  //Sing element path description
  _checkDescPath:function(_data,_simple){
    this._findAttributes(_data);
    var o=_data._result,e=_data.e;

    //Clean text when the text to short and appear in multiple elements
    if(e.tagName!="CANVAS"){
      o._text=_Util._toTrimSign(o._text)
    }
    if(o._text && o._text.length==1 && e!=_data.oe && $(e.ownerDocument).find(":endEqual("+o._text+")").length>1){
      if(_data._label==o._text){
        _data._label=""
      }else if(_data._headers.length && _data._headers[_data._headers.length-1]._text==o._text){
        _data._headers.pop()
      }
      o._text="";
    }

    var _priorityItems=o._priorityItems||"", p=_cssHandler._cssToDesc(o._main);
    var cp=[],_css=[],_tag=_cssHandler._nameMap[p[0]];
    if(_tag){
      _tag=_tag._css
    }
    for(var i=1;i<p.length;i++){
      var v=p[i]
      if(v[0]!="{"){
        cp.push({_type:"element",_value:v,_css:_cssHandler._nameMap[v]._css});
      }else{
        v=v.substring(1,v.length-1)
        if(_cssHandler._isPriorityElementItem(v)){
          _priorityItems+=v;
        }else if(!v.match(/[0-9]+/)){
          _css.push({_type:"element",_css:[v]})
        }
      }
    }
    //give an empty value for loop
    _css.unshift(0);
    var _best,pps=[];
    for(var i=0;i<_css.length;i++){
      var c=_css[i];
      
      var _hasText=0;
      if(c){
        pps=pps.concat(cp.concat([]))
        if(_data.ee==1 || (c._css && _data.ee && _data.ee.length>1 && $(c._css[0]).find(_data.ee).length<_data.ee.length)){
          pps.unshift(c)
        }else{
          continue;
        }
      }

      if(!pps.length && !_data.ps.length || _tag){
        pps.push({_type:"element",_value:p[0],_css:_tag||[p[0].substring(1,p[0].length-1)]});
        if(o._text&&_simple!=4){
          _hasText=1;
          pps.unshift({_type:"text",_value:o._text});
        }
      }else if(o._text&&_simple!=4){
        _hasText=1;
        pps.unshift({_type:"text",_value:o._text});
      }
      if(_priorityItems){
        pps.push({_type:"element",_css:[_priorityItems]})
        _priorityItems=0
      }
      if(!pps.length){
        continue;
      }
      if(_data.ee && _data.ee.bzTmp && _data.ee.bzTmp.toString().endsWith(",0")){
        if(!_hasText){
          continue;
        }else{
          if(o._text.match(/^\[.+\|.+\]$/)){
            _data.ee.bzTmp.splice(1,0,_data.e.tagName+":RowCol("+o._text+")");
          }else{
            _data.ee.bzTmp.splice(1,0,_data.e.tagName+":Contains("+o._text+")");
          }
          break;
        }
      }
      pps=pps.concat(_data.ps);
      if(_css.length>1&&!i&&(!o._text||o._text.length<3||$.isNumeric(o._text))){
        continue
      }
      if(_doIt()){
        break
      }
    }
    _doFinal()
    if(_simple!=4&&_data.oe!=_data.ee&&o._text&&_data.oe.tagName!="CANVAS"&&!_cssHandler._isInShadowDom(_data.oe)){
      if(!pps.find(x=>{return x._type=="text"})){
        pps.unshift({_type:"text",_value:o._text});
      }
      _doIt()
      _doFinal()
    }
    if(_data.e.tagName!="BODY"){
      _data.e=_data.e.parentNode;
    }
    
    function _doIt(){
      _descAnalysis._clearTmpPath();
      let _root=_cssHandler._getRoot(e)
      if(!_root.bzTmp){
        _root.bzTmp=_cssHandler._getDocPath(_root);
      }
      var ee=_descAnalysis._findElement(pps,_root,0,_cssHandler._isCheckboxOrRadio(_data.oe),_data.oe);
//    console.log("_findPath --> _descAnalysis._findElement "+_data.oe.bzTmp);
      if(_data.oe.tagName=="BODY"){
        ee=_data.oe;
        ee.bzTmp=[_data.oe.bzTmp[0],"BODY",0]
      }
      if(ee && ee.bzTmp && ee!==_data.oe){
      }else if(ee && !ee.bzTmp && ((ee.is && !ee.is(_data.oe))||(ee.includes && !ee.includes(_data.oe)))){
      }else if(ee && (ee.bzTmp || (ee.length && (!_best || _best.es.length>ee.length)))){
        _best={es:ee,pp:pps};
        if(_best.es.bzTmp){
          if(_cssHandler._inTag(_data.e,"TR")){
            _best.es=[_best.es];
          }
          return 1;
        }
      }
    }
    
    function _doFinal(){
      if(_best && _best.es && (_data.ee==1 || _best.es.bzTmp || _data.ee.length>_best.es.length || (_data.ee.length==_best.es.length && o._text && (o._text==_data._label||(_data._headers.length && o._text==_data._headers[_data._headers.length-1]._text))))){
        _data.ps=_best.pp;
        _data.ee=_best.es;
      }
    }
  },
  _inTag:function(e,t){
    return e && e.parentNode && e.tagName!=="BODY" && (e.parentNode.tagName==t || this._inTag(e.parentNode,t))
  },
  _getDocPath:function(_doc){
    if(_doc==BZ.TW.document){
      return "BZ.TW.document"
    }else if(_doc.host&&_doc.host.constructor!=String){//shadow dom
      let ps="";
      if(_doc.host.bzTmp){
        ps=_doc.host.bzTmp
        if(ps.constructor==String){
          ps=ps.split("\n")
        }
      }else{
        ps=_cssHandler._findPath(_doc.host);
      }
      let id=ps.pop();
      if(!$.isNumeric(id)){
        ps.push(id)
        if(ps.length==1){
          let r=_Util._getElementRoot(_doc.host);
          if(r.bzTmp&&r.bzTmp.constructor==String){
            r.bzTmp=r.bzTmp.split("\n")
          }
          var v=_Util._clone(r.bzTmp);
          v.push(ps[0])
          ps=v
        }
        let os=_Util._findDoms(ps)
        id=os.indexOf(_doc.host)
      }
      let r=ps.shift();
      
      return "BZ.TW.document\n"+ps.join("\n").trim()+":eq("+(id||0)+")"+"\nshadowRoot"
    }
    var fs=$(BZ.TW.document).find('IFRAME');
    for(var i=0;i<fs.length;i++){
      if(fs[i]==_doc.defaultView.frameElement){
        var c=""
        if(!fs[i].src.startsWith("http")){
          c=".body";
        }
        return "$(BZ.TW.document"+c+").find('IFRAME:eq("+i+")')[0].contentDocument";
      }
    }
  },
  _isInputElementPath:function(e){
    for(var i=e.length-1;i<e.length;i--){
      let v=e[i]
      if(v.constructor==String){
        return _Util._isInputTag((v.match(/input/i)||[])[0])
      }
    }
  },
  /*
    To find element all features.
    e: current element
    ie: ignore element, last element parent
    oe: orignal element
  */
  _findAttributes:function(_data){
    var e=_data.e||_data.oe,oe=_data.oe,fs=0,ho=0,_noLabel=!_data._label,_headerLevel=_data._headers.length;
    
    if(oe!=e){
      fs=parseInt($(oe.ownerDocument.body).css("font-size"))
    }else{
      fs=this._getFontSize(e,oe);
    }
    
    var g={_text:""};
    this._findCss(e,g)
    if(oe==e){
      //Old button (input button)
      if(_data._stopLabel){
      }else if(e.tagName=="CANVAS"){
        if(e.bzTxtElement){
          g._text=e.bzTxtElement.t
        }
      }else if(_Util._isInputButton(e)){
        g._text=e.value;
      }else{
        if(!_Util._isInputObj(e)){
          _setHeader(_data,fs,g)
          if(!g._text){
            if(_data.e.tagName=="TD"){
              g._text=this._getRowColDesc(_data.e);
            }
          }
          
          if(!g._text){
            g._text=_cssHandler._filterText(_cssHandler._findInnerWords(_data.e,1)||_cssHandler._findInnerWords(_data.e))
          }
        }
        if(!g._text){
          g._text=this._findTitleAttribute(e)
        }
      }
      if(!_data._headers.length && !_Util._isInputObj(e)){
        _data._label=g._text;
      }else if(g._text && oe.placeholder==g._text){
        if(_cssHandler._isInPlaceholderForm(oe)){
          _data._label=g._text
        }
      }
      //_data.oeCss=_cssHandler._getElementCss(_data.oe)

    }else if(!_data._label && !_data._stopLabel){
      var p=_cssHandler._getParentSelect(e);
      if(!p){
        _setLabel(_data,g);
        if(_data._stopLabel && !g._text){
          if(_data._stopLabel){
            _data._label=_cssHandler._findTitleAttribute(_data.oe)
          }
          _setHeader(_data,fs)
          if(_data._headers[0] && _data._headers[0]._text==_data._label){
            _data._headers.pop()
          }
        }
        if(_data._label && _data.oe.placeholder && _data.oe.placeholder.length<_data._label.length){
          _data._label=_data.oe.placeholder;
          g._text=""
          _data._stopLabel=1
          _data.lCss=0
        }
      }
      _setHeader(_data,fs)
    }else if(e.tagName=="BODY"){
    }else if(_data.e.tagName=="TR" && _data._label && _data._label.match(/^(.+)\|(.+)$/)){
    }else{
      if(_data.e.tagName=="TD"){
        g._text=this._getRowColDesc(_data.e);
//        if(!_data._label && g._text){
      }
      if(g._text){
        _data._label=g._text.match(/^\[(.+)\|(.+)\]$/);
        if(_data._label){
          _data._label=_data._label[1]+"|"+_data._label[2]
        }else{
          _data._label=g._text
        }
        _data._stopHeader=1
      }else{
        if(!_Util._isInputObj(oe)){
          _setHeader(_data,fs,g)
        }
        if(!g._text){
          _setHeader(_data,["TR","TD","TH","LI"].includes(_data.e.tagName) || _data.oe.tagName=="IMG"?0:fs,g)
        }
      }
    }
    _data.ie=e;
    _data._result=g;

    if(_data.oe==_data.e){
      
    }else if(_noLabel && _data._label){
    }else if(_data._stopHeader){
    }else if(_data._headers.length==_headerLevel && _data.e.tagName!="BODY"){
      /*
      if(_data.ee.length){
        let t=_getText(_data)
        if(t){
          _data._result._text=t;
          return
        }
      }
      */
      if(_data.e.parentElement){
        _data.e=_data.e.parentNode;
        return _cssHandler._findAttributes(_data)
      }
    }
    function _setLabel(_data,g){
      var l=_cssHandler._findLabel(_data);
      if(l){
        _data._label=g._text=l.w;
        _data.lCss=_cssHandler._getElementCss(l.e)
      }
    }
    /*
    function _getText(_data){
      if(_data._result._main.length==1){
        let t=_Util._filterTxt(_data.e.innerText.toLowerCase());
        if(t){
          for(var i=0;i<_data.ps.length;i++){
            if(_data.ps[i]._type=="text"&&_data.ps[i]._value==t){
              return
            }
          }
          return t.substring(0,100)
        }
      }
    }
    */
    function _setHeader(_data,fs,g){
      if(_data._stopHeader||(_data._headers&&_data._headers.length)){
        return
      }
      var ho=_cssHandler._findHeader(_data,fs);
      if(ho && ho.t){
        var _css=_cssHandler._getHeaderCss(ho.e[0]||ho.e),_diff;
        
        if(_data._headers.length){
          var _last=_data._headers[_data._headers.length-1];
          for(var k in _last._css){
            if(_css[k]!=_last._css[k] && (!_css[k]||!_last._css[k]||(_last._css[k].toString()!=_css[k].toString()))){
              _diff=1
              break
            }
          }
          if(!_diff){
            for(var k in _css){
              if(_css[k]!=_last._css[k] && (!_css[k]||!_last._css[k]||(_last._css[k].toString()!=_css[k].toString()))){
                _diff=1
                break
              }
            }
          }
          if(!_diff){
            return
          }
        }
        if(g){
          g._text=ho.t;
        }
        _data._headers.push({_text:ho.t,e:ho.e,_css:_css});
      }
    }
  },
  _isInPlaceholderForm:function(e){
    
    e=e.parentNode;
    var os=$(e).find("INPUT")
    if(os.length>1){
      var n=0
      for(var i=0;i<os.length;i++){
        var o=os[i]
        if(!o.placeholder && !["button","image","submit","checkbox","radio","reset"].includes(o.type)){
          return 
        }else if(o.placeholder){
          n++
        }
      }
      if(n>1){
        return 1
      }
    }
    if(!e||e.tagName=="BODY"){
      return
    }
    return _cssHandler._isInPlaceholderForm(e)
  },
  _findInnerWords:function(e,_ignoreIconWord){
    if(_ignoreIconWord){
      if(this._isIcon(e)){
        return ""
      }
    }
    if(["SVG","TEXTAREA","SELECT","IMG"].includes(e.tagName.toUpperCase())){
      return ""
    }
    var es=e.childNodes,w=""
    for(var i=0;i<es.length;i++){
      e=es[i];
      if(e.nodeType==1){
        if(!_Util._isHidden(e)){
          var ww=this._findInnerWords(e,_ignoreIconWord);
          if(ww.trim()){
            w=ww.trim()
            break
          }
        }
      }else if(e.nodeType==3){
        var t=_Util._pickTextFromNode(es,i)
        i=t.i;
        if(t.t.length>w.length){
          w=t.t
        }
      }
    }

    
    return w
  },
  _isList:function(c,_forField){
    var _last,_hasMenu;
    if(c.tagName=="SELECT" || !c.children || !c.children.length){
      return;
    }else if(c.children.length<2){
      return _cssHandler._isList(c.children[0])
    }
    
    if(c.className && c.className.constructor==String){
      var vs=_glossaryHandler._splitWord(c.className);
      if(vs.includes("menu")){
        _hasMenu= 1;
      }
    }
    let dd=new Set(),os=[];
    for(let o of c.children){
      if(_Util._isHidden(o)){
        continue;
      }
      if(!_forField&&["TR","TD"].includes(o.tagName)){
        return;
      }
      var r=o.getBoundingClientRect();
      if("HR"==o.tagName || (r.height<=5 && _hasMenu)){
        continue;
      }
      var cc=[]
      if(o.className && o.className.constructor==String){
        cc=o.className.split(" ").filter(x=>x);
      }
      let w=$(o).find(":endEqual(/.+/)").toArray()
      w=w.map(x=>{
        return {x:x,s:parseInt($(x).css("fontSize"))}
      })
      w.sort((a,b)=>a.s-b.s)
      w=w.pop()
      if(!w){
        return
      }
      if(_last){
        if(_last.t!=o.tagName){
          return;
        }else if(_last.r.left==r.left && Math.abs(_last.r.bottom-r.top)>20){
          return;
        }else if(_last.r.top==r.top && Math.abs(_last.r.right-r.left)>20){
          return;
        }else{
          if(_last.c.length && cc.length){
            var d=_Util._getDiffArray(_last.c,cc);
            d.forEach(x=>{
              dd.add(x)
            })
            if(dd.size>2){
              return;
            }
          }
        }
      }
      _last={r:r,c:cc,t:o.tagName,s:w.s,o:w.x};
      os.push(_last)
    }
    if(os.length>1){
      return os.map(x=>x.o)
    }
  },
  _hasList:function(c){
    if(this._isList(c)){
      return 1
    }
    for(var i=0;i<c.children.length;i++){
      if(this._hasList(c.children[i])){
        return 1;
      }
    }
  },
  //e: element, oe: org element
  _getFontSize:function(e,oe){
    if(["A","BUTTON","INPUT","LABEL"].includes(e.tagName) && e==oe){
      return 0
    }else if(_cssHandler._isIcon(e)){
      return 0;
    }
    if(e.textContent.trim()){
      var w1=parseInt($(e.ownerDocument.body).css("font-weight"));
      var w2=parseInt($(e).css("font-weight"));
      var w3=parseInt($(oe).css("font-weight"));
      var c1=_Util._getBackgroundColor(e);
      var c2=_Util._getBackgroundColor(oe);
      return parseInt($(e).css("font-size"))+(w2>w1 && (w2>w3||c2!=c1)?0.5:0);
    }
    return 0;
  },
  /*
    pe: element,
    fs: min font size
    ie: ignore element
    _bRight: check element right words (checkbox and radio is 1)
  */
  _findHeader:function(_data,fs,_passInput){
    if(_data.e==_data.oe){
      return {}
    }
    var _isInput=_Util._isInputObj(_data.oe)
    let e=_data.ie||_data.oe
    let oer=e.getBoundingClientRect()
    
    for(let o of _data.e.children){
      if(o==e){
        return {}
      }else if(!_Util._isHidden(o)){
        let t=$util.getElementText(o)
        if(t&&t.length<100){
          let r=o.getBoundingClientRect()
          if(r.top<oer.top&&r.left<oer.left){
            return {e:o,t:t}
          }
        }
      }
    }
  },
  _isIcon:function(e){
    return $(e).css("font-family").includes("Material Icons")
  },
  _findLabel:function(_data){
    var e=_data.e,_label,_labelE,_labelElement;
    var r=_data.oe.getBoundingClientRect();
    
    if(_data.oe.id&&!_data.oe.id.match(/[^a-zA-Z0-9:]/)){
      var t=$("[for="+_data.oe.id.replace(/:/g,"\\:")+"]")[0]
      if(t && $(e).find(t).length){
        var w=$(t).text().trim()||_cssHandler._findTitleAttribute(t);
        if(w){
          _data._stopLabel=1
          return {w:w,e:t}
        }
      }else if(t){
        return
      }
    }
    var _bRight=["checkbox","radio"].includes(_data.oe.type);
    if(e.innerText && e.innerText.trim()){
      var _bStart=!_bRight;
      for(var i=0;i<e.childNodes.length;i++){
        var c=e.childNodes[i];
        if(c.nodeType==1 && !$(c).is(":visible")){
          continue
        }
        if(c==_data.ie){
          if(_bStart){
            return _label||_cssHandler._getRightLabel(c)
          }
          _bStart=1
        }else if(_bStart){
          var v="";
          var o=e.childNodes[i-1];
          if(c.nodeType==1 && _Util._isHidden(c)){
            continue;
          }
          _labelE=0
          if(c.nodeType==1 && c.innerText && c.innerText.trim()){
            v=_cssHandler._handleContainText(_cssHandler._findLabelText(c,_bRight,_data.oe));
            _labelE=c
          }else if(c.nodeType==3){
            var t=_Util._pickTextFromNode(e.childNodes,i);
            i=t.i
            v=_cssHandler._handleContainText(t.t);
            _labelE=e
          }
          v=_Util._removeEndSign(v);
          var cc=this._hasInput(c);
          if(!_bRight){
            if(cc){
              _label="";
              _data._stopLabel=1
            }else if(v){
              if(_cssHandler._isLabel(_data.oe,c,_bRight)){
                if(c.nodeType==1&&_data.oe.type!="file"){
                  var rr=c.getBoundingClientRect();
                  if(_label && rr.top<r.top && rr.bottom-rr.height/2<r.top && rr.left-30>r.left){
                    continue
                  }
                }
                _label={w:v,e:_labelE};
              }else{
                _data._stopLabel=1;
              }
            }
          }else{
            if(!cc){
              if(_cssHandler._isLabel(_data.oe,c,_bRight)){
                _label={w:v,e:_labelE};
              }else{
                _data._stopLabel=1;
              }
            }
            break;
          }
        }
      }
    }
    return _label;
  },
  _getRightLabel:function(c){
    let p=c.parentElement
    let o=c.nextElementSibling
    if(p.children.length==2&&o&&_cssHandler._isTextElement(o)){
      let t=_Util._pickTextFromNode([o],0);
      return {w:t.t,e:o}
    }
  },
  _isTextElement:function(c){
    if(!c.children.length){
      return 1
    }else if(c.children.length==1){
      return _cssHandler._isTextElement(c.children[0])
    }
  },
  _isLabel:function(o,c,_bRight){
    if(c.nodeType==1){
      if($(c).find(o).length||o.type=="file"){
        return 1;
      }
      var p=_cssHandler._getParentSelect(o);
      if(p){
        o=p;
      }
      var r1=o.getBoundingClientRect(),r2=c.getBoundingClientRect();

      if(_bRight){
        return r2.left>r1.right && r2.top<r1.bottom && r2.bottom>r1.top
      }else if(r2.right<=r1.left){
        //label left and input right
        return r2.top<r1.bottom && r2.bottom>r1.top;
      }else if(r2.bottom-r1.top<5 && r1.top-r2.bottom<15){
        //label up and input down
        r2=r2.bottom-parseInt($(c).css("padding-bottom"))
        return r1.top-r2<25;
      }else if(r1.left>=r2.left&&r1.right<=r2.right&&r1.top>=r2.top&&r1.bottom<=r2.bottom){
        return 1
      }else{
        return;
      }
    }
    return 1;
  },
  _hasCheckboxOrRadio:function(e){
    if(e.nodeType==1){
      var c=_cssHandler._keyMap.checkbox._css+","+_cssHandler._keyMap.radio._css;
      return $(e).is(c) || $(e).find(c).length;
    }
  },
  _hasInput:function(e){
    if(e.nodeType==1){
      return _cssHandler._findAllInputs(e).length;
    }
  },
  _getInputCss:function(){
    var c=_cssHandler._inputCss;
    if(!c){
      _IDE._data._curVersion.setting.objectLib.element.forEach(function(v){
        if(v.key=="input"){
          c=_cssHandler._inputCss=v.css
        }
      })
    }

    return c
  },
  _retrieveFontInfo:function(e){
    return {
      size:$(e).css("font-size"),
      weight:$(e).css("font-weight"),
      color:$(e).css("color"),
      family:$(e).css("font-family"),
    }
  },
  _getUniqueClass:function(e){
    let cs=[],_primary=[]
    for(var i=0;i<e.classList.length;i++){
      var m=e.classList[i]
      if(_cssHandler._isPriorityElementItem(m)){
        _primary.push(m)
        cs=0
      }else if(!_primary.length){
        var mc=m.match(/[^a-zA-Z-_]/)
        if(!m.match(/[^a-z-_\$]/i)&&!_cssHandler._isIgnoreClass(m)){
          cs.push(m)
        }
      }
    };
    cs=cs||_primary
    cs.sort((a,b)=>{
      return b.length-a.length
    })
    let _best,_bestClass;
    cs.find(x=>{
      let v=$("."+x).length
      if(!_best||_best>v){
        _best=v
        _bestClass=x
      }
      if(v==1){
        return 1
      }
    })
    return _bestClass
  },
  _findCss:function(e,g){
    g._priorityItems=""
    var _list=[e.tagName];
    if("BODY"!=e.tagName){
      if(e.classList){
        let cs=_cssHandler._getUniqueClass(e)
        if(cs){
          _list.push("."+cs);
        }
      }
      if(e.id && e.id.match && !e.id.match(/[0-9]/)){
        _list.push("#"+e.id.replace(/([^a-zA-Z0-9_-])/g,"\\$1"))
      }
      if(_Util._isStdInputElement(e) && e.tagName!="SELECT" && e.type){
        _list.push("[type="+e.type+"]")
      }else if(_Util._isInContentEditable(e)){
        _list.push("[contenteditable=true]")
      }
      
    }
    g._main=_list;
  },
  _findTitleAttribute:function(e){
    var t="";
    for(var i=0;i<e.attributes.length;i++){
      var a=e.attributes[i];
      var _name=a.name;
      var v=a.value.trim();
      if(!v||v=="null"|| _Util._isDynamicValue(v)){
        continue
      }
      if("placeholder"==_name){
        t=v;
        if(_cssHandler._isInPlaceholderForm(e)){
          break
        }
      }else if(_name.match(/title|label/)){
        t=v;
        break
      }else if("alt"==_name){
        t=v;
        if(e.tagName=="IMG"){
          break
        }
      }else if("name"==_name && !t && v && !v.match(/[0-9]/)){
        t=v;
      }else{
        continue;
      }
    }
    
    return t;
  },
  _handleContainText:function(v){
    v=v.trim().split(/[\n\t\r\*$]/);
    var m="";
    for(var i=0;i<v.length;i++){
      var vv=v[i].trim();
      if(vv.length>m.length){
        m=vv;
      }
    }
    
    return m;
  },
  _getPanel:function(oe,e){
    if(oe.tagName=="BODY"){
      return oe;
    }
    if(!e){
      return this._getPanel(oe,oe.parentElement);
    }
    if(e.tagName!="BODY"){
      var p=e.parentElement;
      var _pBGColor=$(p).css("background-color");
      var _eBColor=$(p).css("border-color");
      var _eBWidth=parseInt($(e).css("border-width"))||0;
      var _eBGColor=$(e).css("background-color");
      if((_pBGColor!=_eBGColor && _eBGColor!="rgba(0, 0, 0, 0)") || (_eBWidth && _eBColor!=_eBGColor && _eBColor!="rgba(0, 0, 0, 0)")){
        return e;
      }
      return this._getPanel(oe,p);
    }
    return e
  },
  _findLabelText:function(nd,_first,oe){
    var t="";
    if(!_first){
      var ro=oe.getBoundingClientRect();
      var rn=nd.getBoundingClientRect();
      if(rn.bottom<ro.top){
        _first=true;
      }
    }
    
    for(var i=0;i<nd.childNodes.length;i++){
      var n=nd.childNodes[i];
      if(n.nodeType==3){
        var tt=_Util._pickTextFromNode(nd.childNodes,i)
        i=tt.i
        t=this._filterText(tt.t)||t;
      }else if(n.nodeType==1 && n.innerText && n.innerText.trim()){
        if(!_cssHandler._isButton(n)){
          t=this._findLabelText(n,_first,oe)||t
        }
      }else{
        continue;
      }
      if(_first && t){
        return t;
      }
    }
    return t;
  },
  _getCssByType:function(t){
    var d=this._typeCss
    if(!d){
      d=this._typeCss={}
    }
    if(!d[t]){
      switch(t){
        case "checkbox":
          d[t]="INPUT[type=checkbox]";
          break
        case "radio":
          d[t]="INPUT[type=radio]";
          break
        case "select":
          d[t]="SELECT";
          break
        case "input":
          d[t]="";
      }

      if(t=="input"){
        d[t]=d[t].substring(1)
      }
    }
    return d[t]
  },
  _filterText:function(v){
    var vs=(v||"").trim().split(/[\*\n\[\]\,\(\)\}\{\:\|]/),_max="";
    for(var i=0;i<vs.length;i++){
      v=vs[i].trim()
      if(v.length>_max.length){
        if(v.length>=5){
          return v
        }
        _max=v
      }
    }
    return _max;
  },
  _findSimilar:function(n,c){
    var v={n:_cssHandler._nameMap[n],c:""},vs=[];
    if(v.n && v.n._css.includes(c)){
      v.c=c;
      v.n=n;
      return [v];
    }else if(v.n){
      v.n=n;
      vs=[v];
      v={}
    }
    for(var k in _cssHandler._nameMap){
      var o=_cssHandler._nameMap[k]._css;
      if(o.includes(c)){
        v.n=k;
        v.c=c;
        vs.push(v)
        v={}
      }
    }
    if(vs.length==1 && !vs[0].n){
      vs=[]
    }
    return vs;
  },
  _isButton:function(e){
    var es=$(e.ownerDocument).find(_cssHandler._keyMap.button._css);
    return es.is(e);
  },
  //frame,form,editor,data,dataForm
  _getTableType:function(e){
    let v=_cssHandler._findDefinitedElement(e,"table");
    if(v&&v[0]==e){
      return _cssHandler._hasInput(e)?"editorTable":"dataTable"
    }

    var _buttonCss=_cssHandler._keyMap.button._css,_hasHeader;
    if(!e||!e.tagName=="TABLE"){
      return;
    }
    var _tableRect=e.getBoundingClientRect();
    var _bodyHeight=e.ownerDocument.body.scrollHeight
    if(e.ownerDocument.body.scrollHeight-_tableRect.height<20 && e.ownerDocument.body.scrollWidth-_tableRect.width<20){
      return "frame";
    }
    
    var _form=_data=_editor=0,trs=$(e).find("tr");
    var _lastTr="";
    
    for(var i=0;i<trs.length;i++){
      var tr=trs[i];
      var tds=tr.children;
      var _curTr="";

      if($(tr).text().trim()){
        for(var m=0;m<tds.length;m++){
          var td=tds[m];
          if($(td).find(_buttonCss).length){
            if(_Util._findInputs(td).length){
              _curTr+="i"
            }else{
              _curTr+="b"
            }
          }else if(_Util._findInputs(td).length){
            _curTr+="i"
          }else if(td.tagName=="TH"){
            _curTr+="h"
          }else{
            _curTr+=$(td).text().trim()?"t":"o";
          }
        }
        if(_curTr.length>1){
          var t=_curTr.replace(/h|t/g,"");
          if(!t){
            var hs=_curTr.match(/h/g);
            if(hs && hs.length>2){
              _hasHeader=1
            }
            _data++;
          }else if(_curTr.endsWith("b")){
            var is=_curTr.match(/i/g);
            is=is?is.length:0;
            if(is>1 || (is==1 && !$(tr).find("input[type=check]").length)){
              _editor++;
            }else{
              _data++;
            }
          }else if(_curTr.match(/ht|tt|hh|th/g)){
            _data++;
          }else if(_curTr.match(/^ii+|^hii+|^tii+/)){
            _data++;
            _form++;
          }else if(["hi","ti"].includes(_curTr.substring(0,2))){
            _form++;
          }else if(_curTr.includes("b")){
            if(_curTr!=_lastTr){
              _form++;
            }
          }else if(_lastTr.length!=_curTr.length){
            _form++;
          }
        }
      }else if($(tr).find("input").length>0){
        _form++;
      }
      
      _lastTr=_curTr;
    }
    if(_form>_data){
      return _form>_editor && !_hasHeader?"form":"editorTable"
    }else{
      if(_form>_editor && _data-_form<3){
        return "dataForm"
      }
      return _data>_editor?"dataTable":"editorTable"
    }
  },
  _getEnableTDs:function(tr){
    var tds=[]
    _Util._filterOutHidden(tr.children,tds)
    return tds;
  },
  _getRowColDesc:function(e){
    try{
      var r=e.parentElement;//tr
      var t=r.parentElement.parentElement; //table
      var tt=this._getTableType(t);
      if(!["dataTable","dataForm","editorTable"].includes(tt)){
        return;
      }
      var hs=$(t).find("tr:eq(0) th");
      r=this._getEnableTDs(r)
      if(hs.length<2){
        hs=this._findTableOuterHeader(t,r);
        if(!hs){
          hs=this._getEnableTDs($(t).find("tr:eq(0)")[0]);
        }
      }else{
        hs=this._getEnableTDs(hs[0].parentElement);
      }
      if(hs.length!=r.length){
        if(this._getColCountWidth(hs)!=this._getColCountWidth(r)){
          return
        }
      }
      var h=hs[r.indexOf(e)]
      if($(h).text() && (h.tagName!=e.tagName || parseInt($(h).css("font-size"))>parseInt($(e).css("font-size")) || $(h).css("font-weight")!=$(e).css("font-weight"))){
        var m=0,_best;
        for(var i=0;i<r.length;i++){
          var c=r[i];
          if(c!=e){
            var tx=_cssHandler._filterText($util.getElementText(c));
            if(!tx){
              continue;
            }
            var n=$(t).find(c.tagName+":Contains("+tx+")").length
            if(n && (!m || n<m)){
              _best=tx;
              m=n;
            }
          }else{
            break
          }
        }
        if(_best){
          return "["+_best.trim().replace(/\|/g,"\\|")+"|"+$util.getElementText(h)+"]"
        }
      }
    }catch(ex){}
  },
  _getColCountWidth:function(cs){
    var n=0;
    for(var i=0;i<cs.length;i++){
      var c=cs[i];
      if(c.colspan){
        n+=parseInt(c.colspan)||1
      }else{
        n++;
      }
    }
    return n
  },
  _findTableOuterHeader:function(t,r){
    if(t.parentElement.children.length>1){
      return
    }
    var tp=t.parentElement.getBoundingClientRect()
    var hs=[],_diff=0;
    for(var i=0;i<r.length;i++){
      var d=r[i];
      var dp=d.getBoundingClientRect()
      var h=t.ownerDocument.elementFromPoint((dp.left+dp.right)/2,tp.top-20)
      var hp=h.getBoundingClientRect();
      if(hp.width-dp.width>30){
        return
      }else{
        while(dp.width-hp.width>30){
          h=h.parentElement;
          hp=h.getBoundingClientRect()
        }
        if(hp.tagName=="TD" && hp.parentElement.parentElement.children.length>1){
          return;
        }
        if(Math.abs(dp.width-hp.width)>10){
          _diff++;
        }
        hs.push(h)
      }
    }
    return hs
  },
  _isInput:function(e){
    var b=["INPUT","TEXTAREA","SELECT"].includes(e.tagName) && !["image","button","reset","submit"].includes(e.type)
    return b
  },
  _getInputMsg:function(o,_css){
    let p=o.parentElement,_final=0
    while(p){
      let os=_cssHandler._findAllInputs(p)
      if(_final&&os.length>_final-1){
        return
      }
      
      _final=os.includes(o)?os.length-1:os.length
      
      let _success=_css.success?$(p).find(_css.success):0,
          _error=$(p).find(_css.error),
          _msg={};
      if(_success&&_success[0]){
        _msg._success=_success.toArray()
      }
      
      if(_error[0]){
        _error=_error.toArray();
        for(var i=0;i<_error.length;i++){
          var eo=_error[i]
          if(_Util._isHidden(eo)){
            _error.splice(i--,1)
          }
        }
        if(_error[0]){
          _msg._error=_error
        }
      }
      
      if(_msg._error){
        let _txt=""
        if(!_final){
          for(var i=0;i<_msg._error.length;i++){
            _txt=_getTxt(_msg._error[i],_txt)
          }
        }else{
          for(var i=0;i<_msg._error.length;i++){
            let oo=_findCloserInput(_msg._error[i],os)
            if(oo.includes(o)){
              _txt=_getTxt(_msg._error[i],_txt)
            }
          }
        }
        if(!_txt){
          _txt={}
        }
        return _txt
      }else if(_msg._success){
        return
      }
      p=p.parentElement
    }
    function _getTxt(o,tt){
      var t=$(o).text().trim()||_cssHandler._getElementTitle(o)
      if(t.length>tt.length){
        tt=t
      }
      return tt
    }
    function _findCloserInput(m,os){
      var mr=m.getBoundingClientRect();
      let oo=[]
      for(var n=0;n<os.length;n++){
        let r=os[n].getBoundingClientRect();
        if(mr.bottom>r.top){
          for(var q=0;q<oo.length;q++){
            let rr=oo[q].getBoundingClientRect()
            if(r.top>=rr.bottom){
              oo.splice(q--,1)
            }else if(rr.top>=r.bottom){
              r=0
              break
            }
          }
          if(r){
            oo.push(os[n])
          }
        }
      }
      return oo
    }
  },
  _getActionMsgCss:function(a,_checkType){
    let _css={
      success:a.lineSuccess,
      error:a.lineError||"[class*=error],[class*=fail],[class*=warn]"
    }
    if(_checkType&2){
      _css={
        success:a.finalSuccess,
        error:a.finalError||_css.error
      }
    }
    return _css;
  },
  _isCloserElement:function(o,c){
    var os=$(o.ownerDocument.body).find("*")
    var oi=os.index(o),
        ci=os.index(c),
        or=o.getBoundingClientRect(),
        cr=c.getBoundingClientRect();
    if(ci<oi){
      return _cssHandler._isCloserElement(c,o)
    }
    for(var i=oi+1;i<ci;i++){
      var oo=os[i];
      if(!$(oo).find(c).length){
        oor=oo.getBoundingClientRect()
        if(or.bottom<=oor.top&&oor.bottom<=cr.top&&($util.getElementText(oo)||_Util._isInputObj(oo))){
          return
        }
      }
    }
    return 1
  },
  _isElementReady:function(ts,_fun){
    if(!window.extensionContent){
      bzComm.postToAppExtension({fun:"_isElementReady",scope:"_cssHandler",ps:[ts],insertCallFun:1,return:_fun});
      return
    }
    var rs=[],_withElement=ts._withElement
    ts=ts.ts
    ts.forEach(t=>{
      var s="",_element=t

      t=$util.findDom(t)
      if(!t||_Util._isOpacity(t)){
        t=0
      }else if(t&&t.tagName=="INPUT"){
        if(!["text","number","date"].includes(t.type)||!t.value){
          s="empty"
        }
      }else if(t&&t.tagName=="TEXTAREA"&&!t.value){
        s="empty"
      }else if(t&&t.tagName=="SELECT"){
        s="empty"
      }
      t=t&&!t.disabled&&!$(t).attr("readonly")&&!_Util._isHidden(t)?"enable":!t||_Util._isHidden(t)?"":"disable"
      if(_withElement){
        rs.push({
          _withElement:_withElement,
          _value:t+s
        })
      }else{
        rs.push(t+s)
      }
    })
    _fun(t) 
  },
  _findInputByLabel:function(_panel,_name){
    if(_panel.constructor==Array){
      _panel=$util.findDom(_panel)
    }
    if(!_panel||_Util._isHidden(_panel)){
      return
    }
    _name=_name.replace(/_/g," ")
    
    let os,o,w,e,
        cs=[],
        ns=_name.split("=>")
        ns[1]=ns[1]||ns[0]
    if(cs.find((c,j)=>{
      let cc=[]
      c.toggle.forEach(ci=>{
        cc.push(ci.replace("$header",ns[0]).replace("$label",ns[1]))
      })
      e=$(_panel).find(cc.join(" "))[0]
      if(e){
        cc.unshift("BZ.TW.document")
        cc.push(0)
        e._bzPath=cc
        return e
      }
    })){
      return e
    }
    
    var ls=_IDE._data._curVersion.setting.content.contentAttribute.split("|")
    for(var i=0;i<ls.length;i++){
      var l=ls[i]
      os=$(_panel).find(":attr("+l+"="+_name+")").toArray()
      if(os.length){
        break
      }
    }
    
    if(!os.length){
      os=_Util._getTargetElement($(_panel).find(":endContains("+_name+")"))
    }
    if(!os.length){
      return
    }
    for(var i=0;i<os.length;i++){
      var v=$util.getElementText(os[i])
      if(_name==v){
        o=os[i]
        break
      }else if(!w||w.length>v.length){
        o=os[i]
      }
    }
    e=o
    while(o!=_panel.parentElement){
      os=_cssHandler._findAllInputs(o)
      if(!os.length){
        if(o.tagName=="LABEL"){
          if(o.htmlFor){
            os=$(os).find("#"+o.htmlFor)
            if(os.length){
              return os[0]
            }
          }
        }
        o=o.parentElement
      }else{
        if(os.length==1){
          return os[0]
        }else{
          var oo=$(o).find("*")
          var ei=oo.index(e),_readonly
          for(var i=0;i<os.length;i++){
            if(os[i].readOnly){
              _readonly=os[i]
            }else if(oo.index(os[i])>ei){
              if(!i){
                return os[i]
              }else if(os[i-1].type=="checkbox"){
                return os[i-1]
              }
              return os[i]
            }else if(i==os.length-1){
              return os[i]
            }
          }
          if(_readonly){
            return _readonly
          }
        }
        
        break
      }
    }
    
  },
  _findAllInputs:function(e,_noReadonly,_includeHidden){
    let _body=document.body
    
    e=e||_body
    var cs=_cssHandler._getInputCss();
    
    var vs=_Util._findInputs(e),os=[];
    for(var i=0;i<vs.length;i++){
      var v=vs[i];
      if(($(v).attr("disabled")||$(v).attr("readonly"))&&_noReadonly){
        continue
      }
      if(!_Util._isHidden(v)||(_includeHidden&&["checkbox","radio"].includes(v.type))){
        os.push(v);
      }
    }
    if(!os.length){
      os=$(e).find(cs).toArray()
    }
    if(!os.length){
      if($(e).is(cs)){
        os.push(e)
      }
    }
    return os
  },
  //a: element, e: target css
  _findCloseElement:function(a,e){
    e=e.join(" ")
    while(!$(a).find(e).length&&a.tagName!="BODY"){
      a=a.parentElement
    }
    return $(a).find(e)[0]
  },
  _getOutestCover:function(e){
    let r=e.getBoundingClientRect();
    while(e.tagName!="BODY"){
      let pr=e.parentElement.getBoundingClientRect()
      if(pr.width<=r.width+50&&pr.width>=r.width&&pr.height<=r.height+20&&pr.height>=r.height&&pr.left<r.left+10&&pr.left>=r.left-50){
        e=e.parentElement
      }else{
        return e
      }
    }
  },
  //a:arround element
  //e:target element
  _findCloserElement:function(a,e,_fun){
    var x=$(a).find(e)
    if(x.length){
      return _fun(x[0])
    }
    _domActionTask._mouseoverItems(a,e,_fun)
  },
  _getParentSelect:function(e){
    var _css=_cssHandler._keyMap.dropdownList._css.split(",");
    for(var i=0;i<_css.length;i++){
      var o=$(BZ.TW.document).find(_css[i]);
      if(o.is(e).length ){
        return e;
      }else if(o.find(e).length){
        for(var n=0;n<o.length;n++){
          if($(o[n]).find(e).length){
            return o[n]
          }
        }
      }
    }
  },
  _isSelectOption:function(p,e){
    p=p.getBoundingClientRect();
    e=e.getBoundingClientRect();
    return p.top>=e.bottom || p.bottom<=e.top
  },
  _isDropdownlist:function(e){
    return e.tagName=="SELECT" || this._isLookingForElement(_cssHandler._keyMap.dropdownList._css,e);
  },
  _isCheckboxOrRadio:function(e){
    if(e.tagName=="INPUT" && ["checkbox","radio"].includes(e.type)){
      return 1;
    }
  },
  _getElementScope:function(e,_style){
    if($(e).is(_style)){
      return e
    }
    let r=e.getBoundingClientRect(),p=e,_txt=(e.innerText||"").trim(),pp=e
    while(p=p.parentElement){
      if(["BODY"].includes(p.tagName)){
        return pp
      }
      pp=p
      if(_style){
        if(!$(p).is(_style)){
          e=p
        }else{
          return p
        }
      }else{
        if((p.innerText||"").trim()==_txt||!_txt){
          for(var i=0;i<p.children.length;i++){
            let c=p.children[i]
            if(c!=e){
              c=c.getBoundingClientRect()
              if(c.width&&c.height&&(Math.abs(c.top-r.top)>20||Math.abs(c.bottom-r.bottom)>20)){
                return e
              }
            }
          }
          e=p
          if(!_txt){
            _txt=(p.innerText||"").trim()
          }
        }else{
          break
        }
      }
    }
    return _style?0:e
  },
  //////////////////////////////////////////
  //
  // analysis element css
  //
  //////////////////////////////////////////
  _getElementCss:function(e,_pickSubElement){
    if(!e){
      return
    }
    var c=e.className && e.className.constructor==String?e.className:"";
    c=new Set(c.match(/[^ ]+/g));
    if(e.id && !_Util._isDynamicValue(e.id)){
      c.add("#"+e.id)
    }
    if(!_pickSubElement){
      var cs=[...c];
      c={
        css:_filter(cs),
        eType:_cssHandler._getElementType(e)
      }
      if(!c.eType){
        c.tag=e.tagName
      }
      if(e.children.length==1 || ["A","BUTTON","LABEL","SPAN"].includes(e.tagName) || $(e).is(_IDE._data._curVersion.setting.content.clickableElements)){
        var ss=new Set();
        for(var i=0;i<e.children.length;i++){
          var v=_cssHandler._getElementCss(e.children[i],1);
          ss=new Set([...ss,...v])
        }
        if(ss.size){
          c.subCss=_filter([...ss])
        }
      }
    }else if(e.children.length==1 || ["SPAN","I"].includes(e.tagName)){
      for(var i=0;i<e.children.length;i++){
        var v=_cssHandler._getElementCss(e.children[i],1);
        c=new Set([...c,...v])
      }
    }
    if(c.css){
      _Util._spliceAll(c.css,x=>{
        return _cssHandler._isIgnoreClass(x)
      })
      c.css.sort(function(a,b){
        return b.length-a.length
      })
    }
    return c
    
    function _filter(cs){
      var cc=[]
      for(var i=0;i<cs.length;i++){
        if(cs[i][0]=="#"){
          cc.push(cs[i])
        }else if(!_Util._isDynamicValue(cs[i])){
          cc.push("."+cs[i])
        }
      }
      return cc
    }
  },
  _getElementTitle:function(e){
    var ws=new Set()
    for(var i=0;i<e.attributes.length;i++){
      var a=e.attributes[i]
      
//      if(a.name.toLowerCase().match(/(^|_|-)(title|label|placeholder|alt|name)($|_|-)/)){
      if(a.name.toLowerCase().match(new RegExp("(^|_|-)("+_IDE._data._setting.content.contentAttribute+")($|_|-)"))){
        var v=(a.value||"").trim()
        if(v && !_Util._isDynamicValue(v)){
          ws.add(a.value)
        }
      }
    }
    if(ws.size){
      ws=[...ws]
      ws.sort(function(a,b){return a.length>b.length?1:-1})
      return ws[0]
    }
    return ""
  },
  _getHeaderCss:function(oe){
    var e=oe,ts=[oe.tagName],f=_cssHandler._getFontSize(oe,oe);
    
    while(e.parentElement && (e.parentElement.tagName.match(/h[0-9]/) || e.parentElement.children.length==1)){
      e=e.parentElement
      if(!ts.includes(e.tagName)){
        ts.unshift(e.tagName)
      }
    }
    while(!e.className && e!=oe){
      e=e.children[0]
    }
    e=this._getElementCss(e)
//    e.tag=ts
    e.fontSize=f;
    return e
  },
  _findDefinitedElement:function(e,t){
    var es=_IDE._data._curVersion.setting.objectLib.element
    for(var i=es.length-1;i>=0;i--){
      var ee=es[i];
      if(!t||t==ee.key||(ee.data&&ee.data.type==t)){
        if($(e).is(ee.css)){
          if(t){
            return [e]
          }else{
            return {_elements:[e],_define:ee}
          }
        }else{
          var os=$(e).find(ee.css).toArray();
          for(var n=0;n<os.length;n++){
            if(_Util._isHidden(os[n])){
              os.splice(n,1)
            }
          }
          if(os.length){
            if(t){
              return os
            }else{
              return {_elements:os,_define:ee}
            }
          }
        }
      }
    }
  },
  _getElementDefinition:function(e,t){
    var es=_IDE._data._curVersion.setting.objectLib.element
    for(var i=es.length-1;i>=0;i--){
      if((!t||es[i].data.type==t)&&$(e).is(es[i].css)){
        return es[i]
      }
    }
  },
  _getDefinitionAttrInElement:function(e,t,a){
    var es=_IDE._data._curVersion.setting.objectLib.element
    for(var i=es.length-1;i>=0;i--){
      var o=es[i].data;
      if(o.type==t&&$(e).is(es[i].css)){
        return $(e).find(o[a].join(","))
      }
    }
  },
  _getElementType:function(e){
    e=_cssHandler._getElementDefinition(e)
    return e?e.key:""
  },
  _getInputTypeFromElementPath:function(ps){
    if(ps){
      for(var i=ps.length-1;i>0;i--){
        var p=(ps[i]+"").toLowerCase().replace(/"/g,"'");
        if(p.startsWith("input") && p.includes("[type=checkbox]")){
          return "checkbox"
        }else if(p.startsWith("input") && p.includes("[type=radio]")){
          return "radio"
        }
      }
    }
  },
  _isPanel:function(e){
    let r=e.getBoundingClientRect()
    if(r.width>200&&r.height>=150){
      return e.innerText
    }
  }
};
var _descAnalysis={
  _syntaxMap:0,
  _syntaxKey:0,
  _syntaxList:0,
  _syntaxGroup:0,
  /*
  _contentKey={
    "new":{
      //use _value link with _cssHandler._nameMap
      _value:"new",
      _type:"element",
      _key:"add", 
    }
  }
  */
  _contentKey:0,
  _contentList:0,
  _contentGroup:0,
  _elementMap:0,
  _setting:0,
  _keyboardMap:{
    enter:13,tab:9,space:32,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,home:36,end:35,pageup:33,pagedown:34,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,capslock:20,esc:27,escape:27,insert:45,"delete":46
  },
  _codeToDesc:function(v,_simple){
    if(v){
      if(_simple){
        if(_Util._isFileData(v)){
          v=JSON.parse(v)
          return v[0].name+" ("+Math.ceil(v[0].size/1024)+"K)"
        }
        v=_JSHandler._formatInsertCodeToDisplay(v);
      }
      return '('+v+')';
    }
    return ""
  },
  _getDescOfElement:function(a){
    let w=_descAnalysis._getCurLanguageElement(a.element||a.panel)
    
    w= _descAnalysis._getDescFromPath(w,1)
    if(a.offset){
      w+=" (offset: "+a.offset.X+", "+a.offset.Y+")"
    }
    return w
  },
  _getCurLanguageElement:function(e){
    if(BZ._data._uiSwitch._curAppLanguage){
      let ee=[],
          wi=_IDE._data._setting.appLanguages.indexOf(BZ._data._uiSwitch._curAppLanguage)-1
      
      e.forEach((v,i)=>{
        if(v&&v.constructor==String){
          let w=_descAnalysis._retrieveTextForElementPathItem(v)
          let ww=_appWordHandler._wordMap[w]
          if(ww&&ww[wi]){
            ee.push(_descAnalysis._replaceElementWord(v,w,ww[wi]))
          }else{
            ee.push(v)
          }
        }else{
          ee.push(v)
        }
      })
      return ee
    }
    return e
  },
  //v:element path
  //w:old word
  //ww:new word
  _replaceElementWord:function(v,w,ww){
    let vv=v.split(w)
    if(vv.length>2){
      for(var i=0;i<vv.length-1;i++){
        let t=""
        vv.forEach((x,j)=>{
          t+=x
          if(j==i){
            t+=ww
          }else{
            t+=w
          }
        })
        t+=vv[vv.length-1]
        if(_descAnalysis._retrieveTextForElementPathItem(t)==ww){
          return t
        }
      }
    }else{
      return v.replace(w,ww)
    }
  },
  _getDescFromPath:function(ps,_simple){
    if(!ps){
      return
    }
    var s="",_customizeIdx=0;
    
    if(ps[0]&&ps[0].constructor==String&&!ps[0].includes("BZ.TW")){
      ps=_Util._clone(ps)
      ps.unshift("BZ.TW.document")
    }
    
    for(var i=1;i<ps.length;i++){
      var p1=ps[i];
      if(p1.constructor==String){
        p1=p1.replace(/:eq\([0-9]+\)$/,"")
      }
      if(i==ps.length-1 && $.isNumeric(p1)){
        if(!_simple && p1+""!=="0"){
          s+=" {"+p1+"}";
        }
      }else{
        if(_simple){
          p1=_JSHandler._formatInsertCodeToDisplay(p1)
        }
        var cs=_generateDesc(_cssHandler._cssToDesc(_cssHandler._parseItems(p1)),i==ps.length-1);
        if(_customizeIdx==i){
          cs+=" "+g.name
        }
        if(_simple && cs.match(/\"|\$(parameter|parentModule|test|module|project|loop|data)/)){
          var ss=cs.match(/(\"[^"]+\")( \"[0-9]+\")+/)
          if(ss){
            s=ss[1]
          }else{
            s=cs
          }
        }else if(!_simple || !s){
          s+=cs
        }
      }
    }
    return s.trim();
    
    function _filterForCustomize(k,ps){
      try{
        var ns=_Util._clone(ps),
            _customizeIdx=0
        g[k].forEach(function(v,i){
          for(var j=_customizeIdx;j<ns.length;j++){
            if(ns[j].includes(v)){
              if(i){
                ns.splice(j,1)
                break
              }else{
                ns[j]=ns[j].replace(v,"")
                _customizeIdx=j+1
                break
              }
            }
          }
        })
        if(_customizeIdx){
          _customizeIdx--
        }
        return {
          ns:ns,
          _customizeIdx:_customizeIdx
        }
      }catch(e){}
    }
    
    function _generateDesc(ss,_lastIdx){
      var cs=""
      if(ss[0] && ss[0][0]=="{"){
        if(_lastIdx){
          if(ss.length>2 || (ss.length==2 && ss[1][0]!='"')){
            ss.splice(0,1);
          }else{
            ss.push(ss.shift())
          }
        }else if(ss.length>1){
          ss.splice(0,1);
        }
      }else if(ss.length>1){
        ss.push(ss.shift())
      }
      
      for(var i=0;i<ss.length;i++){
        if(ss[i][0]=='"'){
          ss.unshift(ss.splice(i,1));
        }
      }
      
      var _last=""
      for(var n=0;n<ss.length;n++){
        //Merge two css blocks
        if(_last[0]=="{" && ss[n][0]=="{" && !ss[n][0].match(/^{[0-9]+}$/)){
          cs=s.substring(0,s.length-1)+ss[n].substring(1)
        }else{
          cs+=" "+ss[n];
        }
        _last=ss[n]
      }
      return cs
    }
  },
  _init:function(){
    var es=_bzMessage._syntax;
    if(!this._syntaxList||!this._syntaxList.length){
      this._syntaxList=[];
      this._syntaxKey={};
      this._syntaxGroup={};
      this._syntaxMap={};
      for(var k in es){
        this._syntaxGroup[k]=[]
        this._syntaxMap[k]={}
        for(var kk in es[k]){
          var t=es[k][kk];
          this._addKey(t,kk,k,this._syntaxKey,this._syntaxList,this._syntaxGroup,this._syntaxMap);
        }
      }
      this._syntaxList.sort(function(a,b){
        return a.length<b.length;
      });

      es=_bzMessage._syntaxOption;
      this._syntaxOptionKey={};
      this._syntaxOptionList=[];
      this._syntaxOptionGroup={};
      this._syntaxOptionMap={};
      for(var k in es){
        this._syntaxOptionGroup[k]=[]
        this._syntaxOptionMap[k]={}
        for(var kk in es[k]){
          var t=es[k][kk];
          this._addKey(t,kk,k,this._syntaxOptionKey,this._syntaxOptionList,this._syntaxOptionGroup,this._syntaxOptionMap);
        }
      }
      this._syntaxOptionList.sort(function(a,b){
        return a.length<b.length;
      });
      
    }
    
    this._contentKey={
      "$project":{_value:"$project",_type:"data"},
      "$module":{_value:"$module",_type:"data"},
      "$test":{_value:"$test",_type:"data"},
      "$loop":{_value:"$loop",_type:"data"},
      "$parameter":{_value:"$parameter",_type:"data"},
      "$data":{_value:"$data",_type:"data"},
    };
    this._contentList=["$project","$module","$test","$loop","$parameter","$data"];
    this._contentGroup={data:["$project","$module","$test","$loop","$parameter","$data"]}
    this._contentMap={data:{"$project":["$project"],"$module":["$module"],"$test":["$test"],"$loop":["$loop"],"$parameter":["$parameter"],"$data":["$data"]}}
    es=_bzMessage._syntaxExtra;
    for(var k in es){
      this._contentGroup[k]=[];
      this._contentMap[k]={}
      for(var kk in es[k]){
        var t=es[k][kk];
        this._addKey(t,kk,k,this._contentKey,this._contentList,this._contentGroup,this._contentMap);
      }
    }
    var os=_IDE._data._curVersion.setting.objectLib;
    this._elementMap={};
    this._contentGroup.element=[];
    this._contentMap.element={}
    for(var k in os){
      es=os[k];
      for(var i=0;i<es.length;i++){
        var e=es[i];
        this._elementMap[e.key]=e;
        v=(e.value||_bzMessage._setting._objectLib._options[k][e.key]||"").toLowerCase();
        this._addKey(v,e.key,"element",this._contentKey,this._contentList,this._contentGroup,this._contentMap)
      }
    }

    this._contentList.sort(function(a,b){
      return a.length<b.length;
    });
    
    return 1;
  },
  _clearTmpPath:function(_includeShortCut){
    $(document).find("*").toArray().filter(function(e){
      e.bzTmp=e.bzParent=0;
      
      if(_includeShortCut){
        delete e.bzShortCut;
        delete e.bzQuick
      }
    });
  },
  _addKey:function(v,k,t,_kMap,_kList,_kGroup,_map){
    if(!v){
      return
    }
    var vs=v.split("/");
    _map[t][k]=vs;
    for(var i=0;i<vs.length;i++){
      v=vs[i];
      if(_kMap[v]){
        return 0
      }else{
        _kMap[v]={_value:v,_type:t,_key:k};
        _kGroup[t].push(v);
        
        _kList.push(v);
      }
    }
    return 1;
  },
  _mergeExpr:function(es){
    for(var i=0;i<es.length;i++){
      e=es[i];
      if(e._type=="element" && e._css && e._css[0] && e._css[0][0]==":"){
        for(var n=i+1;n<es.length;n++){
          var ee=es[n];
          if(ee._type=="element"){
            ee._css=this._mergePath(e._css,ee._css);
            es.splice(i--,1);
            break;
          }
        }
      }
    }
  },
  _mergePath:function(ps1,ps2){
    var ps=[];
    for(var i=0;i<ps1.length;i++){
      var p1=ps1[i];
      for(var ii=0;ii<ps2.length;ii++){
        var p2=ps2[ii];
        if(":.#[".includes(p1[0])){
          ps.push(p2+p1)
        }else if(":.#[".includes(p2[0])){
          ps.push(p1+p2);
        }else{
          ps.push(p2);
        }
      }
    }
    return ps;
  },
  _findFinalElement:function(cs,_root){
    if(!cs._element){
      return;
    }
    var e=this._findElement(cs._element,_root,["typing","check","set","uncheck"].includes(cs._action._key),cs._action._key.includes("check")),_first,ee;
    if(e && !e.bzTmp){
      for(var i=0;i<e.length;i++){
        if(!_Util._isHidden(e[i])){
          ee=this._findElementIdx(e[i]);
          if(!cs._action || cs._action._key!="click" || $(ee).css("cursor")=="pointer"){
            return ee;
          }
          if(!_first){
            _first=ee;
          }
        }
      }
      if(_first){
        return _first;
      }
    }
    return e;
  },
  _getAICssData:function(e,_path,_label){
    var d={HH:[]},_tag,_css;
    for(var i=_path.length-1;i>=1;i--){
      var p=_path[i]
      
      if(!$.isNumeric(p)){
        var t=_descAnalysis._retrieveTextForElementPathItem(p);
        if(!e){
          _tag=p.split(/[\:\.\#]/)[0];
          _css=p.split(":")[0].match(/[\.\#][^\.\#]+/g)
          if(_css){
            _css.sort(function(a,b){return b.length-a.length})
          }
        }
        if(_label && _label==t && d.LL){
          d.LL.id=i
        }
        if(!d.LL){
          if(t){
            d.LL={}
          }
          if(d.LL){
            d.LL.id=i;
            if(e){
              d.LL.C=_cssHandler._getElementCss(e)
            }else{
              d.LL.C={
                tag:_tag,
                css:_css
              }
            }
          }
        }else{
          if(t){
            if(e){
              var os=$(":endEqual("+t+")");
              if(os.length==1){
                os=os[0];
                os=_cssHandler._getHeaderCss(os)
                delete os.fontSize
                os.id=i
                d.HH.push(os)
              }
            }else{
              d.HH.push({
                tag:_tag,
                css:_css,
                id:i
              })
            }
          }
        }
      }
    }
    return d;
  },
  /*
  es:element path
  _root: like: BZ.TW.document or iframe
  _bSet: The search is for a set value on an input
  _bLeft: a label is at left of an input
  */
  _findElement:function(es,_root,_bSet,_bLeft,_orgElement){
    var e,_cssIdx,_reTry;
    for(var i=0;i<es.length;i++){
      e=es[i];
      if(!e._type){
        es.splice(i--,1);
      }else if(e._css&&e._css.length>1){
        e._css.forEach(function(v,j){
          es.splice(i,j?0:1,{_type:"element",_css:[v]})
        })
      }
    }
    for(var i=0;i<es.length;i++){
      e=es[i];
      if(e._type=="element" && e._css && e._css[0] && e._css[0].match(/^[0-9]+$/)){
        _cssIdx=parseInt(e._css[0]);
        es.splice(i,1);
      }else if(e._type=="text"){
        e._code=e._value
        e._value=window._JSHandler?_JSHandler._prepareData(e._value):e._value
      }
    }
    
    if(_bSet){
      var _bInput=0;
      for(var i=0;i<es.length;i++){
        e=es[i];
        if(e._type=="element" && ["input","textarea","select","dropdownList","checkbox","radio"].includes(e._key)){
          _bInput=1;
        }
      }
      if(!_bInput){
        _reTry=1
        es.push({_type:"element",_css:["INPUT","SELECT","TEXTAREA","[contenteditable=true]"]})
      }
    }
    
    this._mergeExpr(es);
    var _result={
      _path:[],
      _bLeft:_bLeft,
      _root:_root
    }
    var _limit={
      _path:[],
      _bLeft:_result._bLeft,
      _init:1
    };
    var e=0;
    //final search
    for(var i=es.length-1;i>=0;i--){
      e=es[i];
      
      var _tmpList=this._findElementInArea(e,_result,0,_orgElement);
      if(!_tmpList){
        continue
      }else if($(_tmpList).is(_orgElement) || !_orgElement){
        _result._endList=_tmpList
      }else{
        es.splice(i,1)
        _descAnalysis._clearTmpPath()
        return _descAnalysis._findElement(es,_root,_bSet,_bLeft,_orgElement)
      }
      if(i==es.length-1){
        _result._endList=_result._endList.not(".BZIgnore *");
        //_result._endList=this._removeParentItemFromResult(_result._endList);
        if(_orgElement && !_result._endList.is(_orgElement)){
          _result._endList.push(_orgElement)
        }
      }
      if(_result._endList){
        _descAnalysis._cleanTagName(_result._endList)
        if(i){
          this._cleanRootPath(_result._endList,_result._root)
        }
        if(_limit && _limit._init && ["text","group"].includes(e._type) && _result._endList.length>1 && _result._endList[0]!=_orgElement){
          for(var ii=0;ii<_result._endList.length;ii++){
            _result._endList[ii].bzOldTmp=_result._endList[ii].bzTmp;
            _result._endList[ii].bzTmp=_result._endList[ii].bzTmp.replace(/(\:)(contains|equal)(.+\))/i,"");
          }
          _limit._root=_result._root;
          _limit=this._findElementInArea(e,_limit,1,_orgElement);
          if(_limit){
            if(_limit.length==_result._endList.length){
              var _newList=[]
              for(var ii=0;ii<_result._endList.length;ii++){
                var o=_result._endList[ii];
                
                if(_limit[ii]==_result._endList[ii]){
                  _newList.push(o)
                }else{
                  o.bzTmp=_result._endList[ii].bzOldTmp;
                }
              }
              if(_orgElement && _newList.includes(_orgElement) && _newList.length<_result._endList.length){
                _result._endList=$(_newList)
              }else{
                for(var ii=0;ii<_newList.length;ii++){
                  _newList[ii].bzTmp=_newList[ii].bzOldTmp;
                }
              }
            }else if(i){
              if(_limit.length>_result._endList.length){
                for(var ii=0;ii<_result._endList.length;ii++){
                  _result._endList[ii].bzTmp=_result._endList[ii].bzOldTmp;
                }
              }
              this._cleanRootPath(_limit,_result._root)
            }
            _descAnalysis._cleanTagName(_limit)
          }
        }else if(_limit && _limit._init){
          _limit={_init:1,_endList:[]};
          for(var ii=0;ii<_result._endList.length;ii++){
            _limit._endList.push(_result._endList[ii])
          }
          _limit._endList=$(_limit._endList)
        }
      }else{
        break;
      }
    }
    
    e=_result._endList;
    if(e && e.length==1){
      if(e[0].bzTmp.constructor==String){
        e[0].bzTmp=e[0].bzTmp.split("\n")
      }
      return e[0];//this._findElementIdx(e[0]);
    }else if(e && e.length>1){
      var _list=[]
      if(_limit && !_limit._init){
        if(_limit.is(_orgElement) || !_orgElement){
          for(var i=0;i<e.length;i++){
            if(_limit.is(e[i])){
              _list.push(e[i])
            }
          }
        }
      }
      if(_list.length==1){
        return this._findElementIdx(_list[0]);
      }else if(_list.length){
        e=_list;
      }
      if(_cssIdx!==undefined && e.length>_cssIdx){
        return this._findElementIdx(e[_cssIdx]);
      }else if(_cssIdx!==undefined){
        e=null;
//      }else if(_orgElement){
        /*
        for(var i=0;i<e.length;i++){
          if(e[i]==_orgElement){
            return this._findElementIdx(e[i]);
          }
        }
        */
      }
    }else if(!e&&_reTry){
      es.pop()
      return _descAnalysis._findElement(es,_root,0,_bLeft,_orgElement)
    }
    return e;
  },
  _setSecondText:function(o,e,_path){
    var n;
    var s=o.bzTmp.split("\n");
    o.bzTmp=_path+"\n";
    for(n=0;n<s.length;n++){
      if(!s[n].startsWith("BZ.")){
        if(s[n].match(/\:(contains|Contains|textElement|endContains|afterEqual|after|before|endEqual|equal|RowCol|rowcol)\((.+)\)/)){
          
        }else{
          s[n]+=e
        }
        
        break;
      }
    }
    for(n=0;n<s.length;n++){
      o.bzTmp+=s[n];
      if(n<s.length-1){
        o.bzTmp+="\n";
      }
    }
  },
  _cleanTagName:function(_list){
    if(_list){
      for(var n=0;n<_list.length;n++){
        var v=_list[n], w="";
        if(!v.bzTmp.split){
          continue;
        }
        var ss=v.bzTmp.split("\n");
        if(ss.length>1){
          var s=w=ss[1];
          w=ss[0]+"\n"+w;
          for(var i=2;i<ss.length;i++){
            if(ss[i].match(/[:#.]/) || !s.startsWith(ss[i])){
              w+="\n"+ss[i]
            }
            s=ss[i];
          }
          v.bzTmp=w;
        }
      };
    }
  },
  _cleanRootPath:function(_list,_root){
    if(!_root[0] || !_list){
      _root=$(_root);
    }
    
    _list.each(function(i,a){
      if(!_root.is(a)){
        for(var i=0;i<_root.length;i++){
          if(a.bzTmp.startsWith && a.bzTmp.startsWith(_root[0].bzTmp+"\n")){
            a.bzTmp=a.bzTmp.replace(_root[0].bzTmp+"\n","");
            return;
          }
        }
      }
    });
  },
  _findElementIdx:function(ee,_simple){
    var e=ee;
    if(!e.bzTmp || e.bzTmp.constructor!=String){
      return;
    }
    var os,_root,p=e.bzTmp.split("\n");
    
    try{
      if (p && p.length>0) {
        
        if($.isNumeric(p[p.length-1])){
          p.pop()
        }

        var pp=p.pop();
        var ppp=pp
        if(!e.children.length){
          ppp=pp.replace(/\:contains\(/ig,":endContains(")
        }

        os=_search([].concat(p),ppp,e)
        if((!os.os.is(e)||os._solution)&&pp!=ppp){
          os=_search([].concat(p),pp,e)
        }
        
        var i=os.os.index(e);
        if(i>=0){
          if(i&&_simple!=3){//simple==3 is for label only. not try :last
            if(os.os.length==i+1){
              let _last=os.p.pop()
              if(!_last.endsWith(":last")){
                var oo=_Util._clone(os.p)
                oo.push(_last+":last")
                oo.push(0)
                if($util.findDom(oo)==e){
                  _last+=":last"
                  i=0
                }
              }
              os.p.push(_last)
            }
          }
          
          if(!i&&e.tagName=="CANVAS"&&e.bzTxtElement){
            i=TWHandler._getCanvasTextElementIdx(e,e.bzTxtElement)||0
            // delete e.bzTxtElement
          }
          
          os.p.push(i)
          e.bzTmp=os.p
        }else{
          if(e.bzTmp.constructor==String){
            e.bzTmp=[e.bzTmp.split("\n")[0]]
          }else{
            e.bzTmp=[e.bzTmp[0]]
          }
          e.bzTmp.push(_Util._getQuickPath(e))
        }
        ee.bzTmp=e.bzTmp
        return ee;
        
        function _search(p1,exp,e){
          var p2=[].concat(p1),_solution=0;
          p2.push(exp)
          
          var os=$(_Util._findDoms(p2))
          while(!os.is(e)&&p2.length>2){
            p2.splice(p2.length-2,1)
            os=$(_Util._findDoms(p2))
          }
          if(!os.is(e)){
            p2=p1
//            p2.push(exp)
            p2.push(e.tagName)
            os=$(_Util._findDoms(p2))
            while(!os.is(e)&&p2.length>2){
              _solution=1
              p2.splice(p2.length-2,1)
              os=$(_Util._findDoms(p2))
            }
          }
          return {os:os,p:p2,_solution:_solution}
        }
        
      }
    }catch(ex){
    }
  },
  _filterTextInEndList:function(_result,e,_limit,_orgElement){
    var p,pl;

    if(e._type=="text"){
      pl=p=e._value;
    }else{
      pl==eval(_ideDataHandler._parseToExeCode(e._value));
      p="{{"+e._value+"}}";
    }
    
    if(_result._endList && _result._endList[0]){
      var m=_result._endList[0].bzTmp.match(/\"(.)+\"/);
      if(m && m.includes(pl)){
        return;
      }
      
      var f=":equal("+_cssHandler._handleContainText(pl)+")";
      // if(_orgElement){
        // if(!$(_orgElement).is(f)){
          // f=":Contains("+_cssHandler._handleContainText(pl)+")";
        // }
      // }
      //var f=":Contains("+_cssHandler._handleContainText(pl)+")";
      var ff=_Util._getAttrPath("value",_cssHandler._handleContainText(pl));
      var kp=p,kpl=pl
      var _list=$([]),_lastNot,_startBZ=_result._endList[0]
      _list=_result._endList.filter(ff)
      if(!_list.length){
        _list=_result._endList.filter(f)
      }
      // for(var i=0;i<_result._endList.length;i++){
      //   var e=_result._endList[i];
      //   if(!e.bzTmp || !e.bzTmp.startsWith){
      //     continue
      //   }
      //   if(_lastNot&&_lastNot.find(e).length){
      //     continue
      //   }
      //   var _bInput=_Util._isStdInputElement(e)
      //   if(!_bInput && ($(e).is(f).length || $(e).filter(f).length)){
      //     let vv=_getNewTmp(e,kp,kpl,f)
      //     if(!vv){
      //       return
      //     }
      //     e.bzTmp=vv
      //     _list=_list.add(e)
      //   }else if(_bInput){
      //     if($(e).filter(ff).length){
      //       if(_startBZ){
      //         e.bzTmp+=p==pl?ff:_Util._getAttrPath("value",p)
      //       }else{
      //         if(e.bzTmp.match(/value\*\=/i)){
      //           return 0;
      //         }
      //         e.bzTmp = this._getRootPath(_result._root,e)+"\n"+ e.bzTmp+(p==pl?ff:_Util._getAttrPath("value",p));
      //       }
      //       _list=_list.add(e)
      //     }
      //   }else{
      //     _lastNot=$(e)
      //   }
      // }
      if(!_list.length){
        pl=pl.toLowerCase();
        for(var i=0;i<_result._endList.length;i++){
          var e=_result._endList[i];
          var _title=0;
          for(var a=0;e.attributes && a<e.attributes.length;a++){
            var aa=e.attributes[a];
            var n=aa.name.toLowerCase();
            if(n.match(/title|label/)){
              _title=aa;
            }else if(n.includes("alt")){
              _title=aa;
            }else if(n=="placeholder" || n=="name"){
              _title=aa;
            }else if(n=="value" && _Util._isInputButton(e)){
              _title=aa;
            }
            if(_title){
              var tl=_title.value.toLowerCase();
              if(tl && (tl==pl || (!_limit &&!BZ._isRecording() && tl.includes(pl)&& _Util._includesWord(tl,pl)))){
                c=_Util._getAttrPath(_title.name,p)
                if(e.bzTmp && e.bzTmp.startsWith("BZ.")){
                  e.bzTmp+=c;
                }else if(!e.bzTmp.includes(c)){
                  e.bzTmp=this._getRootPath(_result._root,e)+"\n"+e.bzTmp+c;
                }else{
                  e.bzTmp=this._getRootPath(_result._root,e)+"\n"+e.bzTmp;
                }
                _list=_list.add(e);
                break;
              }
              _title=0;
            }
          }
        }
      }
      if(_list.length && (!_orgElement || _list.is(_orgElement))){
        _result._endList=_list;
        return 1;
      }
    }
    
    // function _getNewTmp(_startBZ,kp,kpl,f){
    //   let _newTmp
    //   if(_startBZ){
    //     if(_startBZ.bzTmp.startsWith("BZ.")){
    //       _newTmp=_startBZ.bzTmp+(kp==kpl?f:":Contains("+kp+")")
    //       _startBZ=1
    //     }else{
    //       if(_startBZ.bzTmp.match(/:contains|:endcontains|:endequal|:equal/i)){
    //         return 0
    //       }else{
    //         _newTmp=_descAnalysis._getRootPath(_result._root,_startBZ)+"\n"+ _startBZ.bzTmp+(kp==kpl?f:":Contains("+kp+")");
    //       }
    //     }
    //   }
    //   return _newTmp
    // }
  },
  _getRootPath:function(_root,e){
    if(_root.bzTmp){
      return _root.bzTmp;
    }
    for(var i=0;i<_root.length;i++){
      var r=_root[i];
      if($(r).find(e) || r==e){
        return r.bzTmp;
      }
    }
  },
  _getTextList:function(_root,e,k,_limit){
    var p,ps,_path,pl;
    if(e._type=="text"){
      pl=p=e._value;
    }else{
      pl=eval(_ideDataHandler._parseToExeCode(e._value));
      p="{{"+e._value+"}}";
    }
    
    var f=":"+k+"("+_cssHandler._handleContainText(pl)+")";
    var cf=e._value==p?f:":"+k+"("+p+")";
    pl=pl.toLowerCase();

    if(!_root[0]){
      _root=[_root];
    }
    //find inner element
    for(var i=0;i<_root.length;i++){
      var pps="",r=_root[i];
      _path=r.bzTmp;
      r=r.body;
      pps=$(r).find(f);
      for(var n=0;n<pps.length;n++){
        _descAnalysis._setBzTmpPath(pps[n],_path,cf,_limit);
      }
      pps=pps.add($(r).find("*").filter(function(m,e){
        if(!pps.is(e)){
          return _descAnalysis._filterAttr(e,_path,p,pl,_limit)
        }
      }));
      if(!ps){
        ps=pps;
      }else{
        ps=ps.add(pps)
      }
    }
    
    //filter self
    if(!ps || !ps.length){
      for(var i=0;i<_root.length;i++){
        _path=_root[i].bzTmp;
        var _body=_root[i].body||_root[i];
        ps=ps.add($(_body).filter(f).filter(function(i,e){
          if(!e.bzTmp){
//            e.bzTmp=e.tagName;
          }
          if(!e.bzTmp.startsWith(_path)){
//            e.bzTmp=_path+"\n"+e.bzTmp;
          }
          
          _descAnalysis._setBzTmpPath(e,_path,cf,_limit);
          /*
          if(e.bzTmp.match(/:Contains\(.+\)$/)){
            e.bzTmp=e.bzTmp.replace(/:Contains\(.+\)$/,f);
          }else{
            e.bzTmp+=f;
          }
          */
          return e;
        }));
        
        ps=ps.add($(_body).filter(function(i,e){
          if(!ps.is(e)){
            return _descAnalysis._filterAttr(e,_path,p,pl,_limit)
          }
        }));
      }
    }
    
    if(ps.length){
      var os=[];
      
      for(var i=0;i<ps.length;i++){
//        if(ps[i].tagName!="OPTION" || (ps[i].parentElement && !["SELECT","OPTGROUP"].includes(ps[i].parentElement.tagName))){
        if(ps[i].tagName!="OPTION"){
          os.push(ps[i])
        }
      }
    }
    return $(os);
  },
  _filterAttr:function(e,_path,p,pl,_limit){
    if(e.bzTmp){
      var s;
      if(e.bzTmp.constructor==String){
        s=e.bzTmp.split("\n");
      }else{
        s=e.bzTmp
      }
      s=s[s.length-1];
      if(s.match(/[^a-z-]/i)){
        return;
      }
    }
    var c=_Util._getAttributeCss(e,pl,p)
    if(c){
      _descAnalysis._setBzTmpPath(e,_path,c);
      return e;
    }
  },
  _setBzTmpPath:function(e,_path,c,_limit){
    c=c.replace(/^[a-z0-9-~+ >]+/i,"");
    if(e.bzTmp && e.bzTmp.constructor==Array){
      var s=""
      for(var i=0;i<e.bzTmp.length;i++){
        s+="\n"+e.bzTmp[i];
      }
      e.bzTmp=s.substring(1)
    }
    if(!e.bzTmp || _limit){
      e.bzTmp=_path+"\n"+e.tagName+c;
    }else if(e.bzTmp==_path || e.bzTmp.includes(_path+"\n")){
      if(!e.bzTmp.replace(_path,"").includes(c)){
        e.bzTmp+=c
      }
    }else if(e.bzTmp.startsWith("BZ.")){
      if(c){
        var s=e.bzTmp.split("\n");
        s=s[s.length-1];
        if(!s.includes(c)){
          e.bzTmp+=c;
        }
      }
    }else if(!e.bzTmp.includes(c)){
      var t=c.match(/\((.+)\)/);
      if(t){
        t=t[1];
        var tt=e.bzTmp.match(/\((.+)\)/);
        if(tt){
          tt=tt[1];
          if(tt.toLowerCase().includes(t.toLowerCase())){
            _descAnalysis._setSecondText(e,":Contains("+t+")",_path);
            return
          }
        }
      }
      
      var cc=e.bzTmp.replace(/^[a-z0-9-~+ >]+/i,"");
      c=e.tagName+c;
      if(!c.includes(cc) && (!c.match(/:contains|:end/)||!cc.match(/:contains|:end/))){
        c+=cc;
      }
      e.bzTmp=_path+"\n"+c;
    }
  },
  _addCssIntoBZTmpPath:function(_path,_css,e){
    if(!_css.startsWith(e.tagName)){
      return _path+e.tagName+_css;
    }else{
      return _path+_css;
    }
  },
  _findInCss:function(_root,_css,_findWay){
    var ppp=$([]),_final=[];
    if(!_root[0]){
      _root=[_root];
    }
    for(var i=0;i<_root.length;i++){
      var r=_root[i];
      var _path=r.bzTmp;
      for(var n=0;n<_css.length;n++){
        var c=_css[n]
        var ps=$(r)[_findWay](c).filter(function(i,p){
          if(!ppp.is(p)){
            if(_findWay=="find"){
              _descAnalysis._setBzTmpPath(p,_path,c);
            }
            return p;
          }
        });
        ppp=ppp.add(ps);
      }
    }
    return ppp;
  },
  _retrieveTextForElementPathItem:function(o,_bInput){
    o=o||"";
    if(!o || $.isNumeric(o)){
      return
    }
    var s=o.constructor==String?o.split("\n"):o;
    for(let n=s.length-1;n>=0;n--){
      if(s[n].constructor==String&&!$.isNumeric(s[n])){
        var ss=s[n].match(/(\:|\[)(near|data|contains|input|panel|text|afterEqual|after|before|Contains|textElement|endContains|endEqual|equal|RowCol|rowcol|name|title|placeholder)(\(\[|\(|\"|\*\=|\=|\[)([^\"\'\]]+)(\)|\"|\])/);
        ss=ss||s[n].match(/(\:|\[)(attr)(\(|\"|\*\=|\=)(.+)(\)|\")/);
        ss=ss||s[n].match(/^(\:)([a-z0-9]+)\((.+)\)$/i);//for com

        if(ss){
          var r=ss[4]||ss[3]
          if(ss[2]=="attr"){
            r=r.split("=")
            if(["value","placeholder","name","title"].includes(r[0])||r[0].includes("label")){
              r=r[1];
              r=r.split(/\)\:[a-zA-Z]+\(/)[0]
              return r
            }
          }else{
            return r
          }
        }else if(!s[n].match(/[a-z]+/i)){
        }else if(s[n].match(/^[a-z\-\_]+$/i)){
          continue
        }else if(_bInput||["INPUT","SELECT","TEXTAREA"].includes(s[n].match(/[a-z]+/i)[0])||s[n].includes("contenteditable=true")){
          continue
        }
        return "";
      }
    }
    
  },
  //Work only for setting event action. the element must have label. The function should be update after ai upgrade. TODO:
  _findLabelFromInputElementPath:function(s){
    s=s.constructor==String?s.split("\n"):s;
    for(n=s.length-1;n>=0;n--){
      if(s[n].constructor==String){
        var ss= s[n].match(/(\:|\[)(contains|Contains|afterEqual|after|before|endContains|endEqual|equal|RowCol|rowcol|name\*\=|title\*\=|placeholder\*\=)(\(|\")(.+)(\)|\")/);
        if(ss){
          return _glossaryHandler._getVariableName(ss[4]);
        }
      }
    }
  },
  _findElementInArea:function(e,_result,_limit,_orgElement){
    var p,_type,_text,r=_result._root,_endList=_result._endList;

    if(["group","text","data"].includes(e._type)){
      _text=1;
      
      if(_endList && _endList.length){
        var t=_descAnalysis._retrieveTextForElementPathItem(_endList[0].bzTmp);
        //TODO: parse e._value from data to value
        if(t && t.toLowerCase().includes(e._value.toLowerCase())){
          p=1
        }
      }

      if(!p && this._filterTextInEndList(_result,e,0,_orgElement)){
        return _result._endList;
      }
      if(e._value.match(/^\[.+|.+\]$/)){
        p=_limit?"rowcol":"RowCol"
      }else if((_orgElement && _Util._isInputObj(_orgElement))||_result._endList && _result._endList[0] && _Util._isInputObj(_result._endList[0])){
        var o=(_orgElement||_result._endList[0]).bzTmp||0
        if(o.constructor==Array){
          o=o[o.length-1]
        }
        if(!o.includes||!o.includes(":near")){
          p="near"
        }else{
          p=_limit?"endEqual":"endContains"
        }
      }else{
        p=_limit?"endEqual":"endContains"
      }
      if(_orgElement&&_orgElement.tagName=="CANVAS"){
        p="textElement"
      }
      _type=p
      if(p=="near"){
        if(_result._endList && _result._endList.length){
          p=this._getTextList(_result._endList,e,p,_limit)
        }else{
          p=this._getTextList(r,e,p,_limit)
        }
        if(p.length && (!_orgElement || p.is(_orgElement))){
          for(var i=0;i<p.length;i++){
            if(!p[i].bzTmp.includes(r.bzTmp)){
              p[i].bzTmp=r.bzTmp+"\n"+p[i].bzTmp;
            }
          }
        }else{
          p=_limit?"endEqual":"endContains"
        }
      }
      if(p.constructor==String){
        p=this._getTextList(r,e,p,_limit)
      }
    }else{
      if(e._extraText){
        p=this._findInCss(this._getTextList(r,e._extraText,_limit?"contains":"Contains",_limit),e._css,"filter");
      }else{
        p=this._findInCss(r,e._css,"find");
        if(!p.length){
          p=this._findInCss(r,e._css,"filter");
        }
      }
    }
    if(_endList){
      var pp=$([]);
      //try to find _endList items in result item inner element
      for(var i=0;i<p.length;i++){
        var _path1=p[i];
        var _path2=p[i]
        _path2=_path1;
        var ps=$(p[i]).find(_endList).filter(function(n,e){
          if(!pp.is(e) && e.bzTmp.startsWith){
            if(!e.bzTmp.startsWith("BZ.")){
              if(e.bzParent==p[i]){
                e.bzTmp=p[i].bzTmp+e.bzTmp.replace(/^[a-z-]*/i,"");
              }else{
                e.bzTmp=p[i].bzTmp+"\n"+e.bzTmp;
              }
            }
            e.bzParent=p[i];
            return e;
          }
        });
        pp=pp.add(ps)
      }
      if(pp.length && _orgElement && pp.is(_orgElement)){
        return pp;
      }else if(pp.length && ["endEqual","endContains","textElement"].includes(_type)){
        return pp;
      }else if(!pp.length){
        pp=$([])
      }
      //try to find _endList items in result list
      for(var i=0;i<p.length;i++){
        var _path1=p[i].bzTmp;
        var _path2=_path1
        var ps=$(p[i]).filter(_endList).filter(function(i,e){
          if(!pp.is(e)){
            return e;
          }
        });
        pp=pp.add(ps)
      }
      if(pp.length && (!_orgElement || pp.is(_orgElement))){
        return pp;
      }else{
        pp=$([])
      }
      
      //header path
      pp=[];
      if(["group","text","data"].includes(e._type)){
        for(var i=0;i<p.length;i++){
          if(p[i].bzTmp.match(/endEqual|endContains/) && !["BUTTON","INPUT"].includes(p[i].tagName)){
            pp.push(p[i])
          }
        }
        p=pp;
      }
      pp=$([]);
      
      var po=p,ps=[];
      for(var i=0;i<p.length;i++){
        var p1=p[i].bzTmp.split("\n");
        var p3=p[i].bzTmp.replace(/\n.+$/,"");
        p1=p1[p1.length-1].replace(/^[a-z-0-9~+ >]+/i,"")
        if(p1.match(/:endContains|:endEqual/)){
          ps.push({e:p[i],o:p[i].parentNode,_parent:p3,_textMark:":Contains("+e._value+")"});
        }
      }
      
      var _remove=0;
      for(var i=0;i<ps.length;i++){
        p=ps[i];
        if(p.o){
          var ppp=$(p.o).find(_endList);
          if(!ppp.length || (_orgElement && !ppp.is(_orgElement))){
            if(_endList.filter(p.o)[0]==p.o){
              if(pp.has(p.o).length){
                if(!p.o.bzTmp.includes(p._parent)){
                  p.o.bzTmp=p._parent+"\n"+p.o.bzTmp+":has("+p._textMark+")";
                }
                pp=pp.add([p.o]);
              }
            }
          }else{
            if(_orgElement){
              ppp=[_orgElement];
            }else if(ppp.length>1 && ps.length==1){
              ppp=this._findNextInPos(po[0],ppp,_result._bLeft)
            }
            if(!ppp[0].bzTmp.startsWith){
              continue
            }else if(ppp[0].bzTmp.startsWith("BZ.")){
              
            }else if(p.o.bzTmp){
              if(p.o==ppp[0].bzParent){
                var s=_Util._insertInString(ppp[0].bzTmp,"\n",p._textMark);
                if(!s){
                  s=ppp[0].bzTmp+p._textMark;
                }
                ppp[0].bzTmp=p._parent+"\n"+s;
              }else if(p.o.bzTmp.endsWith(p._textMark)){
                ppp[0].bzTmp=p.o.bzTmp+"\n"+ppp[0].bzTmp
              }else if(p.o.bzTmp.match(/:contains|:end/i)){
                ppp[0].bzTmp=p.o.tagName+p._textMark+"\n"+ppp[0].bzTmp
              }else{
                ppp[0].bzTmp=p.o.bzTmp+p._textMark+"\n"+ppp[0].bzTmp
              }
              if(p._parent && !ppp[0].bzTmp.startsWith(p._parent)){
                ppp[0].bzTmp=p._parent+"\n"+ppp[0].bzTmp
              }
            }else{
              var s=ppp[0].bzTmp.split("\n");
              var ss=s[0].match(/\{\{(.+)\}\}/);
              if(ss){
                var sss=eval(ss[1])
                ss=s[0].replace(ss[0],sss);
              }else{
                ss=s[0]
              }
              if($(p.o).find($(p.o.ownerDocument).find(ss)).length){
                ppp[0].bzTmp=p._parent+"\n"+p.o.tagName+p._textMark+"\n"+ppp[0].bzTmp
              }else{
                ppp[0].bzTmp=p._parent+"\n"+s[0]+"\n"+p.o.tagName+p._textMark+ppp[0].bzTmp.replace(s[0],"")
              }
            }

            pp=pp.add(ppp);
          }
          
          if(p.o.bzTmp && p.o.bzTmp==p._parent){
            p.o=null;
            _remove++;
          }else{
            p.o=p.o.parentNode;
            if(p.o==p.o.ownerDocument.body.parentNode){
              p.o=null;
              _remove++;
            }
          }
        }
        
        if(_remove==ps.length){
          return pp;
        }else if(i==ps.length-1){
          if(pp.length){
            return pp;
          }
          i=-1;
        }
      }
    }else{
      if(_orgElement&&_orgElement.type!='file'&&!_Util._isHidden(_orgElement)){
        p=p.filter(":visible")
      }
      return p;
    }
  },
  _findNextInPos:function(po,ps,_bLeft){
    po=po.getBoundingClientRect();
    var _closer=0,_result="";
    for(var i=0;i<ps.length;i++){
      var p=ps[i].getBoundingClientRect();
      if(!_bLeft){
        if(p.top>po.top+20 || (p.top>po.top-10 && p.left>po.left)){
          if(!_closer || _closer.top<p.top-10 || _closer.top>p.top || (_closer.top==p.top && _closer.left>p.left)){
            _closer=p
            _result=ps[i];
          }
        }else if(!_closer || _closer.top<p.top || (_closer.top==p.top && _closer.left>p.left)){
          _closer=p;
          _result=ps[i];
        }
      }else{
        if(p.top>po.top-10 && p.left<po.left){
          if(!_closer || _closer.left<p.left){
            _closer=p
            _result=ps[i];
          }
        }else if(!_closer || _closer.top<p.top || (_closer.top==p.top && Math.abs(_closer.left-po.left)>Math.abs(p.left-po.left))){
          _closer=p;
          _result=ps[i];
        }
      }
    }
    return [_result]
  },
  _actionsToDesc:function(t){
    var s=this._getTestDesc(t)

    return s+_scriptActionHandler._doTestActionsToText(t)
  },
  _getTestDesc:function(t,_simple){
    var s="",l=t.loopData,st=_descAnalysis._syntaxMap.test,sl=_descAnalysis._syntaxOptionMap.loop,w;

    if(_simple){
      w=_JSHandler._formatInsertCodeToDisplay(w)
    }

    
    if(l && l.loopValue){
      w=_ideDataHandler._getNamePathFromDataPath(l.loopValue);
      if(w){
        s+=st.loopData[0]+": "+w+" ["+sl.loopStart[0]+"="+l.loopStart;
        if(l.loopEnd){
          s+=", "+sl.loopEnd[0]+"="+l.loopEnd
        }
        if(l.exitLoop){
          s+=", "+sl.exitLoop[0]
        }
        s+="]\n"
      }
    }
    return _compressJSON._unConvert(s);
  }
};
var _aiDataHandler={
  _miniMap:{
    _email:"email",
    _phoneNumber:"phone",
    _address:"address",
    _postCode:"postcode",
    _name:"name",
    _text:"text",
    _number:"number",
    _decimal:"decimal",
    _link:"link"
  },
  _init:function(_fun){
    _aiDataHandler._cleanData([_aiWordHandler,_dictionaryHandler,_cssHandler,_descAnalysis])
    if(_aiDataHandler._checkData()){
      if(BZ._isAutoRunning()&&bzComm._isIDE()){
        let am=_IDE._data._curVersion.modules.filter(m=>_aiGeneratorDataHandler._isAIModule(m)).map(x=>_ideObjHandler._getDataByPath(x.code))
        _aiGenerator._generateAITests(am,function(){
          _fun&&_fun()
        })
      }else{
        _fun&&_fun()
      }
    }
  },
  _checkData:function(){
    if(_dictionaryHandler._init()){
      if(_cssHandler._init()){
        if(_descAnalysis._init()){
          return 1
        }
      }
    }
  },
  _cleanData:function(os){
    os.forEach(function(o){
      for(var k in o){
        if(["_typeValue","_fromValue","_keyboardMap"].includes(k)){
          continue
        }
        if(o[k].constructor==Array){
          o[k]=[]
        }else if(o[k].constructor==Object){
          o[k]={}
        }
      }
    })
  }
};
;
/*
class $$module{
  constructor({code,name,type,data,tests}){
    this.name = 'module';
  }
  getName(){
    return this.name;
  }
}
*/;
const _scriptUtil={
  _prepareActions:function(_actions){
    if(_actions){
      if(_actions.constructor==Function){
        let _size=$script.newList.length
        _actions=_actions()
        if(_size<$script.newList.length){
          _actions=$script.newList.splice(_size)
        }
      }
      if(_actions.constructor!=Array){
        _actions=[_actions]
      }
    }
    
    return _actions||[]
  },
  _setGroupActions:function(_group,_actions){
    _actions.forEach(a=>{
      a.inGroup="on";
      a._group=a._group||_group;

      $script.newList.push(a)
    })
  },
  _getValueFromOptions:function(_options,_key,_default){
    let v=(_options||{})[_key]
    if(v===undefined){
      v=_default
    }
    return v
  }
}



const $script={
  newList:[],
  getElement:function(elementPath){
    return new $$element(elementPath)
  },
  exe:function(actions,_fun){
    if(actions.constructor!=Array){
      actions=[actions]
    }
    let a=actions.shift(),
        t=_IDE._data._setting.advanced[_IDE._data._setting.curEnvironment].stepDelay
    if(a){
      setTimeout(function(){
        _domActionTask._exeAction(a,{},function(r){
          if(r&&(r._type>3||(r._type==1&&(a.refOfError||"").match(/s|w/))||(r._type==2&&(a.refOfFailed||"").match(/s|w/)))){
            $script.exe(actions,_fun)
          }else{
            _fun(r)
          }
        })
      },a.min||t)
    }else if(_fun){
      setTimeout(()=>{
        _fun({_type:4})
      },t)
    }
  },
  playInIFrameIdx:function(idx,actions){
    $script.iframeIdx=idx;
    $script.play(actions)
    delete $script.iframeIdx
  },
  playInPanel:function(element,actions){
    $script.panel=_scriptActionHandler._buildElementPath(element)
    $script.play(actions)
    $script.panel=0
  },
  return:function(){
    return $script.ideScript(function(_callBack){
      _ideTask._data._taskQueue=_ideTask._data._taskQueue.filter(x=>x._funKey!==_ideTask._curExeAction._funKey)
      _callBack&&_callBack()
    })
  },
  break:function(){
    return $script.ideScript(function(){
      let v=_ideTask._curExeAction._groupLevel.find(x=>x.match(/(for|loop|while)/)),
          q=_ideTask._data._taskQueue;
      while(v&&q[0]&&(q[0]._groupLevel||[]).includes(v)){
        q.shift()
      }
      return 1
    })
  },
  hasData:function(element,data){
    return new $$validData(element,data)
  },
  hasText:function(element,text){
    return new $$validInnerText(element,text)
  },
  hasValue:function(element,value){
    return new $$validInputValue(element,value)
  },
  //0: validate
  isExist:function(element){
    return new $$validExist(element)
  },
  isUnexist:function(element){
    return new $$validUnexist(element)
  },
  isEnable:function(element){
    return new $$validEnable(element)
  },
  isDisable:function(element){
    return new $$validDisable(element)
  },
  isChecked:function(element){
    return new $$validChecked(element)
  },
  isUnchecked:function(element){
    return new $$validUnchecked(element)
  },
  validateByScriptInApp:function(script,element){
    return new $$validScriptInApp(script,element)
  },
  validateByScriptInIDE:function(script){
    return new $$validScriptInIDE(script)
  },
  api:function(request){
    return new $$API(request)
  },
  //1: mouse event
  click:function(element){
    return new $$click(element)
  },
  rightclick:function(element){
    return new $$rightclick(element)
  },
  dblclick:function(element){
    return new $$dblclick(element)
  },
  dragdrop:function(element,toElement){
    return new $$dragdrop(element,toElement)
  },
  drag:function(element,moveToX,moveToY){
    return new $$drag(element,moveToX,moveToY)
  },
  mousedown:function(element){
    return new $$mousedown(element)
  },
  mouseup:function(element,x,y){
    return new $$mouseup(element,x,y)
  },
  hover:function(element){
    return new $$hover(element)
  },
  //1: keyboard
  set:function(element,value){
    return new $$set(element,value)
  },
  typing:function(element,value){
    return new $$typing(element,value)
  },
  check:function(element){
    return new $$set(element,"on")
  },
  uncheck:function(element){
    return new $$set(element,false)
  },
  //1: Fill form
  fillform:function(data){
    _scriptActionHandler._buildFormActions(data)
  },
  //2:
  get:function(element,storeData){
    return new $$get(element,storeData)
  },
  exeScriptInIDE:function(script){
    return new $$scriptAction(script).enableRunInIDE()
  },
  exeScriptInAPP:function(script,element){
    return new $$scriptAction(script,element)
  },
  //4:
  callTest:function(test,parameter){
    return new $$plugInTestAction(test,parameter)
  },
  //5:
  comment:function(element,comment){
    return new $$commentAction(element,comment)
  },
  //6:
  visitPage:function(url,hostId,options){
    return new $$loadPageAction(url,hostId,options)
  },
  //7:
  group:function(actions){
    return new $$group(actions)
  },
  given:function(actions){
    return new $$given(actions)
  },
  when:function(actions){
    return new $$when(actions)
  },
  then:function(actions){
    return new $$then(actions)
  },
  if:function(condition,actions){
    return new $$if(condition,actions)
  },
  loop:function(actions){
    return new $$loop(actions)
  },
  while:function(actions){
    new $$loop(actions)
  },
  for:function(express,actions){
    return new $$for(express,actions)
  },
  or:function(actions){
    return new $$or(actions)
  },
  and:function(actions){
    return new $$and(actions)
  },
  getTaskQueue:function(){
    return _ideTask._data._taskQueue
  }
};
const _scriptActionHandler={
  _action:{
    ".":"continue",
    "..":"stop",
    "...":"stop-group",
    "....":"stop-all",
    s:"success",
    w:"warning",
    f:"failed",
    e:"error"
  },
  _validationMap:{
    data:"hasData",
    innerText:"hasText",
    exist:"iseExist",
    unexist:"isUnexist",
    value:"hasValue",
    enable:"isEnable",
    disable:"isDisable",
    checked:"isChecked"
  },
  _doTestActionsToText:function(t){
    let as=[];
    if(t.type=="scenario"){
      s=_bzScenario._actionsToDesc(_IDE._data._curTest)
    }else{
      t.actions.forEach(a=>{
        as.push(_scriptActionHandler._actionToText(a))
      })
      s= as.join("\n")
    }
    return BZ._data._uiSwitch._tmpInTextActions=s
  },
  _doTestActionsToJS:function(t){
    let ss=t.actions.map(a=>{
      let aa=$$action.jsonToObject(a)
      let r=aa.mapToScript()
      return r.replace(/\n/g,"\n  ")
    }).join(",\n  ")
    ss=`[\n  ${ss}\n]`
    BZ._data._uiSwitch._tmpInJSActions= ss
  },
  _scriptToAction:function(s,_fun){
    try{
      s=eval(s)
      _fun(s)
    }catch(ex){
      alert(ex.message)
    }
  },
  _actionToText:function(a){
    let _element=_getElementDesc(),
        _action
        
    return (_getMessage()+" "+(_getOption()||"")).trim()
    function _getMessage(){
      _msg=_bzMessage._script._templates[a.type]
      switch(a.type){
        case 0:
          if(a.method==1){
            return _Util._formatMessage(_msg.script,a.script)
          }else{
            return _Util._formatMessage(_msg[a.content.type],a.script||_element,a.expectation)
          }
        case 1:
          if(a.apiReplaceEvent){
            return "/"+"/API"
          }else{
            let c=_ideActionManagement._getComDataFromElement(a)
            if(c){
              return c.$fun+" "+c.$label+" = "+c.$value
            }
            return _Util._formatMessage(_msg[a.event.action]||_msg[a.event.type]||`${a.event.action}: {0}`,[_element,a.event.value||_getElementDesc(a.event.element)])
          }
        case 2:
        case 8:
        case 9:
          return _Util._formatMessage(_msg,_element)
        case 3:
          return _Util._formatMessage(_msg,_Util._getStringBySize((a.script||"").split("\n").map(x=>x.trim()).join(" ")))
        case 4:
          return _Util._formatMessage(_msg,_ideTestManagement._getStdDescription(a.refOfSuccess))
        case 5:
          return _Util._formatMessage(_msg,a.description)
        case 6:
        case 7:
          return _Util._formatMessage(_msg,a.description)
      }
    }
    
    function _getOption(){
      let _msg=_bzMessage._script._options
      let w=""
      if(a.flag){
        w+=", "+_msg._flag+": "+a.flag
      }
      if(a.min){
        w+=", "+_msg._delay+": "+a.min
      }
      if(a.max){
        w+=", "+_msg._timeout+": "+a.max
      }
      if(a.successGoto){
        w+=", "+_msg._successGotoFlag+": "+a.successGoto
      }
      if(a.failedGoto){
        w+=", "+_msg._failedGotoFlag+": "+a.failedGoto
      }
      if(a.errorGoto){
        w+=", "+_msg._errorGotoFlag+": "+a.errorGoto
      }
      let t=_ideTestManagement._getStdDescription(a.refOfSuccess)
      if(t){
        w+=", "+_msg._successGotoTest.split("|")[0]+": "+t
      }
      t=_ideTestManagement._getStdDescription(a.refOfFailed)
      if(t){
        w+=", "+_msg._failedGotoTest.split("|")[0]+": "+t
      }
      t=_ideTestManagement._getStdDescription(a.refOfError)
      if(t){
        w+=", "+_msg._errorGotoTest.split("|")[0]+": "+t
      }
      if(w){
        return "("+w.substring(2)+")"
      }
    }

    function _getElementDesc(){
      let e=_Util._clone(a.element)
      if(!_Util._isEmpty(e)){
        let w=_descAnalysis._retrieveTextForElementPathItem(e)
        if(!w){
          e.reverse()
          w=e.find(x=>{
            if(!$.isNumeric(x)){
              return 1
            }
          })
        }
        return w
      }
    }
  },
  _buildFormActions:function(d,o){
    o=o||{}
    if(!o.labelMap){
      o.labelMap={}
    }
    if(!o.com){
      o.com={}
    }
    o.labelMap=o.labelMap||{}
    o.ignoreFields=o.ignoreFields||[]
    if(d.constructor==Object){
      let ks=o.order||Object.keys(d),
          pk=_getDataPath()
      d=ks.map(k=>{
        if(o.skipOnEmpty&&!d[k]&&d[k]!==0){
          return
        }else if(o.ignoreFields.includes(k)){
          return
        }
        let v= {
          label:o.labelMap[k]||_Util._idToName(k),
          value:pk?`{{${pk}.${k}}}`:d[k]
        }
        if(o.com[k]){
          v.label=":"+o.com[k]+"("+v.label+")"
        }
        return v
      }).filter(x=>x)
    }
    if(o.panel){
      $script.panel=_scriptActionHandler._buildElementPath(o.panel)
    }
    d.forEach(x=>{
      if(o.clickList){
        o.clickList.find(y=>{
          if(y.preField==x.label){
            $script.click(y.button||y.link||y.text)
          }
        })
      }
      $script.set(x.label,x.value)
    })
    if(o.panel){
      $script.panel=0
    }
    
    function _getDataPath(){
      let _key
      if(d==$parameter){
        _key="$parameter"
      }else if(d==$loop){
        _key="$loop"
      }else if(Object.keys($test||{}).find(k=>{
        if(d==$test[k]){
          _key="$test."+k
          return 1
        }
      })){
      }else if(Object.keys($module||{}).find(k=>{
        if(d==$module[k]){
          _key="$module."+k
          return 1
        }
      })){
      }else if(Object.keys($project||{}).find(k=>{
        if(d==$project[k]){
          _key="$project."+k
          return 1
        }
      })){
      }
      return _key
    }
  },
  _buildElementPath:function(x,_type){
    _type=_type||"text"
    if(x){
      let p=_getPanel()
      if(x.constructor==String){
        x=x.split(">")
        while(x.length>1){
          p.push(`:panel(${x.shift().trim()})`)
        }
        x=x[0].trim()
        let xx=_JSHandler._parseCode(x)
        if(xx.constructor==String){
          xx=[{txt:xx}]
        }
        if(x.match(/^\$(parameter|test|loop|project|module|group|action)(\.|\[|$])/)){
          x=`{{${x}}}`
          x=":"+_type+"("+x+")"
        }else if(!xx.find(y=>{
          if(y.txt){
            return y.txt.match(/([\.\#].+|[\[][^\]]+[\]]|\:[^\(]+\([^\)]+\))/)
          }
        })){
          x=":"+_type+"("+x+")"
        }
        x=[...p,x,0]
      }else if(x.constructor==Array){
        if(!x[0].includes("BZ.TW")){
          x=[...p,...x]
        }
      }
      return x
    }else if(x!==undefined){
      return [..._getRoot(),"BODY",0]
    }

    function _getPanel(){
      let p=$script.panel,
          r=_getRoot()
      if(p){
        if(p.constructor==String){
          p=[r,p]
        }else if(!p[0].includes("BZ.TW")){
          p=[r,...p]
        }
        return p.filter(x=>!$.isNumeric(x))
      }else{
        return [r]
      }
    }

    function _getRoot(){
      if($.isNumeric($script.iframeIdx)){
        return "$(BZ.TW.document).findIframe("+$script.iframeIdx+")"
      }else{
        return "BZ.TW.document"
      }
    }
  },
  _joinScript:function(_list,_inGroup){
    // if(!_inGroup){
    //   _list=_list.map(x=>{
    //     return x.replace(/\n/g,"\n  ")
    //   })
    // }
    return _list.join("\n.")
  },
  _toSimplyElement:function(e){
    if(e&&e.constructor==Array){
      e=[...e]
      if(e[0]=="BZ.TW.document"){
        e.shift()
      }
      if(!$util.parseBoolean(e._last())){
        e.pop()
      }
      if(e.length){
        if(e.length==1){
          return e[0]
        }
        return e
      }else{
        return "BODY"
      }
    }
    return e
  },
  _toSimplyElementInString:function(e){
    return JSON.stringify(_scriptActionHandler._toSimplyElement(e))
  },
  _toFullElement:function(e){
    if(e&&e.constructor==Array){
      e=[...e]
      if(e[0]!="BZ.TW.document"){
        e.unshift("BZ.TW.document")
      }
      if(!$.isNumeric(e._last())){
        e.push(0)
      }
      return e
    }else if(e&&e.constructor==String){
      return ["BZ.TW.document",e,0]
    }
  },
  _formatScript:function(s,_expectReturn){
    if(_Util._isFunction(s)){
      return `${_Util._jsonToStr(s)}`
    }else if(s&&s.constructor!=String){
      s=JSON.stringify(s,0,2)
    }
    if(_expectReturn){
      return `\`${s}\``
    }else{
      return `()=>{\n  ${s.replace(/\n/g,"\n  ")}\n}`
    }
  }
};
class $$Test {
  constructor({code,name,data,loopData,defParameter,type,actions}) {
    this.code = code;
    this.name = name;
    this.dataMap = data;
    this.loopData = {loopValue:loopData};
    this.defParameter = defParameter;
    this.type = type;
    this.actions = actions||[];
  }

  exe($parameter){
    _ideTask._addScriptGenerateAction(this)
  }
};
class $$action{
  constructor(action){
    for(let k in action){
      this[k]=action[k]
    }
  }

  mapToScript(list){
    let d=this
    if(d.min){
      list.push(`wait(${d.min})`)
    }
    if(d.max){
      list.push(`timeout(${d.max})`)
    }

    if(d.autoDelay){
      list.push(`enableAutoDelay()`)
    }

    if(d.refOfSuccess=="../f"&&(d.refOfFailed=="./s"||d.refOfFailed=="./w")){
      list.push(`shouldFail("${d.refOfFailed.split("/").pop()}")`)
    }

    if(d.refOfSuccess=="../f"&&(d.refOfError=="./s"||d.refOfError=="./w")){
      list.push(`shouldError("${d.refOfFailed.split("/").pop()}")`)
    }

    if(d.preScript){
      list.push(`setPreScript(${_scriptActionHandler._formatScript(d.preScript)})`)
    }

    if(d.resultscript){
      list.push(`setEndScript(${_scriptActionHandler._formatScript(d.resultscript)})`)
    }

    if(d.loopData){
      list.push(`setRepeatScript(${_scriptActionHandler._formatScript(d.loopData,1)})`)
    }

    let r=(d.refOfFailed||"").match(/^[.]{3}\/([swfe])$/)
    if(r){
      list.push("breakOnFail('"+r[1]+"')")
    }

    r=(d.refOfError||"").match(/^[.]{3}\/([swfe])$/)
    if(r){
      list.push("breakOnError('"+r[1]+"')")
    }

    r=(d.refOfSuccess||"").match(/^[.]{3}\/([swfr])$/)
    if(r){
      list.push("break('"+r[1]+"')")
    }

    r=(d.refOfSuccess||"").match(/^\.\.\/([sw])$/)
    if(r){
      list.push("stopOnSuccess('"+r[1]+"')")
    }

    if(d.flag){
      list.push(`setFlag("${d.flag}")`)
    }
    if(d.monitorUrl){
      list.push(`setMonitorUrl(${_scriptActionHandler._formatScript(d.monitorUrl)})`)
    }

  }

  static jsonToObject(d){
    switch(parseInt(d.type)){
      case 0:
        return $$validAction.jsonToObject(d)
      case 1:
        if(d.apiReplaceEvent){
          return $$API.jsonToObject(d)
        }
        return $$eventAction.jsonToObject(d)
      case 2:
        return $$get.jsonToObject(d)
      case 3:
        return $$scriptAction.jsonToObject(d)
      case 4:
        return $$plugInTestAction.jsonToObject(d)
      case 5:
        return $$commentAction.jsonToObject(d)
      case 6:
        return $$loadPageAction.jsonToObject(d)
      case 7:
        return $$group.jsonToObject(d)
    }
    if(d.element){
      return new $$elementAction(d.element,d)
    }else if(d.type==4){
      return $$plugInTestAction.jsonToObject(d)
    }
  }

  setMonitorUrl(url){
    this.monitorUrl=url
    return this
  }

  /***********************************************/
  //
  // flow control
  //
  /***********************************************/
  shouldFail(r){
    r=r||"s"
    this.refOfFailed="./"+r
    this.refOfSuccess="../f"
    return this
  }

  shouldError(r){
    r=r||"s"
    this.refOfError="./"+r
    this.refOfSuccess="../f"
    return this
  }

  acceptFail(r){
    r=r||"s"
    this.refOfFailed="./"+r

    return this
  }

  acceptError(r){
    r=r||"s"
    this.refOfError="./"+r

    return this
  }

  break(r){
    r=r||"s"
    this.refOfSuccess=".../"+r
    return this
  }

  breakOnFail(r){
    this.refOfFailed=".../"+(r||"w")
    return this
  }

  breakOnError(r){
    this.refOfError=".../"+(r||"w")
    return this
  }

  stopOnSuccess(r){
    r=r||"s"
    this.refOfSuccess="../"+r
    return this
  }

  // onsuccess(actions){
  //   this.successList=actions

  //   return this
  // }

  // onfail(actions){
  //   this.failedList=actions

  //   return this
  // }

  /***********************************************/
  //
  // Attributes
  //
  /***********************************************/
  timeout(time){
    this.max=time

    return this
  }

  wait(time){
    this.min=time

    return this
  }

  enableAutoDelay(){
    this.autoDelay="on"
    return this
  }

  setPreScript(script){
    this.preScript=script

    return this
  }

  setEndScript(script){
    this.resultscript=script
    return this
  }

  setRepeatScript(script){
    this.loopData=script
    return this
  }

  setDisable(r){
    this.disable=r
    return this
  }

  setFlag(f){
    this.flag=f
    return this
  }
};
class $$element{
  constructor(element){
    this.element = element
  }

  get(storeData){
    return new $$get(this.element,storeData)
  }

  click(){
    return new $$click(this.element)
  }

  rightclick(){
    return new $$rightclick(this.element)
  }

  dblclick(){
    return new $$dblclick(this.element)
  }

  dragdrop(toElement){
    return new $$dragdrop(this.element,toElement)
  }

  drag(from,to){
    return new $$drag(this.element,from,to)
  }

  hover(){
    return new $$hover(this.element)
  }

  mousedown(x,y){
    return new $$mousedown(this.element,x,y)
  }

  mouseup(x,y){
    return new $$mouseup(this.element,x,y)
  }

  isExist(){
    return new $$validExist(this.element)
  }

  validByScript(script){
    return new $$validScript(script,this.element)
  }

  hasData(data){
    return new $$validData(this.element,data)
  }

  hasText(text){
    return new $$validInnerText(this.element,text)
  }

  hasValue(value){
    return new $$validInputValue(this.element,value)
  }

  isUnexist(){
    return new $$validUnexist(this.element)
  }

  isEnable(){
    return new $$validEnable(this.element)
  }

  isDisable(){
    return new $$validDisable(this.element)
  }

  isChecked(){
    return new $$validChecked(this.element)
  }

  isUnChecked(){
    return new $$validChecked(this.element,{expectation:"false"})
  } 
};
class $$elementAction extends $$action{
  constructor(element,options){
    super({
      ...options,
      element:_scriptActionHandler._toFullElement(element)
    })
    this.assignSkipActionElement(this.skipActionElement)
    this.assignFailElement(this.failElement)
  }

  assignSkipActionElement(e){
    this.skipActionElement = _scriptActionHandler._toFullElement(e);
    return this
  }

  assignFailElement(e){
    this.failElement = _scriptActionHandler._toFullElement(e);
    return this
  }

  workOnHidden(){
    this.force = "on";
    return this
  }

  hiddenIsUnexist(){
    this.errOnHidden = "on";
    return this
  }

  noRetry(){
    this.failedReaction="on"
    return this
  }

  supportMutipleElement(){
    this.multipleElement = "on";
    return this
  }

  mapToScript(list){
    super.mapToScript(list)
    let d=this
    if(d.skipActionElement){
      list.push(`assignSkipActionElement(${_scriptActionHandler._toSimplyElementInString(d.skipActionElement)})`)
    }

    if(d.failElement){
      list.push(`assignFailElement(${_scriptActionHandler._toSimplyElementInString(d.failElement)})`)
    }

    if(d.force){
      list.push(`workOnHidden()`)
    }

    if(d.errOnHidden){
      list.push(`hiddenIsUnexist()`)
    }

    if(d.failedReaction){
      list.push(`noRetry()`)
    }

    if(d.multipleElement){
      list.push(`supportMutipleElement()`)
    }

  }

};
class $$API extends $$action{
  constructor(request){
    _Util._cleanJson(request)

    super({
      type:1,
      apiReplaceEvent:1,
      requests:[request]
    })
  }

  downloadFile(){
    this.downloadAsFile = 1;
    return this
  }

  mapToScript(){
    let d=this,
        r=d.requests[0]

    if(r){
      ["headers","query","body","joins"].forEach(k=>{
        if(r[k]&&typeof r[k]=="string"){
          try{
            r[k]=JSON.parse(r[k])
          }catch(e){}
        }
      })
    }
    let list=[`$script.api(${_Util._formatJSONToString(r)})`]
    super.mapToScript(list)
    if(d.downloadAsFile){
      list.push(`downloadFile()`)
    }
    return _scriptActionHandler._joinScript(list);
  }

  static jsonToObject(d){
    return new $$API(d.requests[0])
  }

}

class $$loadTestAction extends $$action{
  constructor(requests,rampUp){
    super({
      type:"a",
      apiReplaceEvent:1,
      requests:requests,
      rampUp:rampUp
    })
  }
}

class $$request{
  constructor(host,url,method,headers,query,data){
    this.host=host
    this.url=url
    this.method=method
    this.headers=headers
    this.query=query
    this.body=data
  }
};
class $$plugInTestAction extends $$action{
  constructor(test,parameter,options){
    super({
      ...options,
      type:4,
      refOfSuccess:test,
      successParameter:parameter
    })
  }

  static jsonToObject(d){
    return new $$plugInTestAction(d.refOfSuccess,d.successParameter,d)
  }

  mapToScript(list){
    let d=this
    let p=d.successParameter
    if(p&&p.constructor!=String){
      p=JSON.stringify(p)
    }else if(p){
      p="`"+p+"`"
    }
    if(p){
      return `$script.callTest("${d.refOfSuccess}",${p})`
    }else{
      return `$script.callTest("${d.refOfSuccess}")`
    }
  }
};
class $$commentAction extends $$elementAction{
  constructor(element,comment,options){
    super(element,{
      ...options,
      type:5,
      description:comment
    })
  }

  enableJudge(){
    this.showJudge=true
    return this
  }

  mapToScript(){
    let d=this,list=[`$script.comment(${_scriptActionHandler._toSimplyElementInString(d.element)}, ${JSON.stringify(d.description||"")})`]
    super.mapToScript(list)
    if(d.showJudge){
      list.push(`enableJudge()`)
    }
    return _scriptActionHandler._joinScript(list);
  }

  static jsonToObject(d){
    return new $$commentAction(d.element,d.description,d)
  }

};
class $$eventAction extends $$elementAction{
  constructor(element,event,options){
    super(element,{
      ...options,
      type:1,
      event:options?{...options.event,...event}:event
    })
  }

  triggerAlert(){
    this.triggerPopup="on";
    this.event.popType = "alert";
    return this
  }

  validateAlertInNextAction(){
    this.event.popFollow = "on";
    return this
  }

  triggerConfirm(returnValue){
    this.triggerPopup="on";
    this.event.popType = "confirm";
    this.event.returnValue=returnValue
    return this
  }

  triggerPrompt(returnValue){
    this.triggerPopup="on";
    this.event.popType = "prompt";
    this.event.returnValue=returnValue
    return this
  }

  triggerBeforeUnload(){
    this.triggerPopup="on";
    this.event.popType = "onbeforeunload";
    return this
  }

  withCtrl(){
    this.event.ctrl = "on";
    return this
  }

  withShift(){
    this.event.shift = "on";
    return this
  }

  withAlt(){
    this.event.alt = "on";
    return this
  }

  comboAction(element,type){
    this.event.repElementMethod = type||"on";
    this.event.responseElement = _scriptActionHandler._toFullElement(element);
    return this
  }

  mapToScript(list){
    let d=this;
    super.mapToScript(list)
    if(d.event.ctrl){
      list.push(`withCtrl()`)
    }

    if(d.event.shift){
      list.push(`withShift()`)
    }

    if(d.event.alt){
      list.push(`withAlt()`)
    }

    if(d.event.popType=="alert"){
      list.push(`triggerAlert()`)
    }

    if(d.event.popType=="confirm"){
      list.push(`triggerConfirm("${d.event.returnValue.replace(/"/g,'\\"')}")`)
    }

    if(d.event.popType=="prompt"){
      list.push(`triggerPrompt("${d.event.returnValue.replace(/"/g,'\\"')}")`)
    }

    if(d.event.popFollow){
      list.push(`validateAlertInNextAction()`)
    }

    if(d.event.repElementMethod){
      list.push(`comboAction(${_scriptActionHandler._toSimplyElementInString(d.event.responseElement)}, "${d.event.repElementMethod}")`)
    }

  }

  static jsonToObject(d){
    if(d.event.type=="mouse"){
      return $$mouse.jsonToObject(d)
    }else if(d.event.type=="change"){
      return new $$set(d.element,d.event.value,d)
    }else if(d.event.type=="key"){
      return new $$typing(d.element,d.event.value,d)
    }
  }

}

class $$mouse extends $$eventAction{
  constructor(element,event,options){
    super(element,{
      type:"mouse",
      ...event
    },
    options)
  }

  retryableOnNextActionFailed(){
    this.retryable = 1;
    return this
  }

  setOffset(x){
    this.offset = x;
    return this
  }

  asDownloadAction(){
    this.event.download = 1;
    return this
  }
  
  mapToScript(list){
    let d=this
    super.mapToScript(list)

    if(d.offset){
      list.push(`setOffset(${_Util._formatJSONToString(d.offset)})`)
    }

    if(d.retryable){
      list.push(`retryableOnNextActionFailed()`)
    }

    if(d.event.download){
      list.push(`asDownloadAction()`)
    }



  }

  static jsonToObject(d){
    if(d.event.action=="click"){
      return new $$click(d.element,d)
    }else if(d.event.action=="rightclick"){
      return new $$rightclick(d.element,d)
    }else if(d.event.action=="dblclick"){
      return new $$dblclick(d.element,d)
    }else if(d.event.action=="dragdrop"){
      return new $$dragdrop(d.element,d.event.element,d)
    }else if(d.event.action=="drag"){
      return new $$drag(d.element,d.event.moveToX,d.event.moveToY,d)
    }else if(d.event.action=="hover"){
      return new $$hover(d.element,d)
    }else if(d.event.action=="mousedown"){
      return new $$mousedown(d.element,d.event.x,d.event.y,d)
    }else if(d.event.action=="mouseup"){
      return new $$mouseup(d.element,d.event.x,d.event.y,d)
    }
  }
}

class $$click extends $$mouse{
  constructor(element,options){
    super(element,{
      action:"click"
    },
    options)
  }

  mapToScript(){
    let d=this,list=[`$script.click(${_scriptActionHandler._toSimplyElementInString(d.element)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}


class $$rightclick extends $$mouse{
  constructor(element,options){
    super(element,{
      action:"rightclick"
    },
    options)
  }

  mapToScript(){
    let d=this,list=[`$script.rightclick(${_scriptActionHandler._toSimplyElementInString(d.element)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$dblclick extends $$mouse{
  constructor(element,options){
    super(element,{
      action:"dblclick"
    },
    options)
  }

  mapToScript(){
    let d=this,list=[`$script.dblclick(${_scriptActionHandler._toSimplyElementInString(d.element)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$dragdrop extends $$mouse{
  constructor(element,toElement,options){
    super(element,{
      action:"dragdrop",
      element:_scriptActionHandler._toFullElement(toElement)
    },{
      ...options
    })
  }

  mapToScript(){
    let d=this,list=[`$script.dragdrop(${_scriptActionHandler._toSimplyElementInString(d.element)},${_scriptActionHandler._toSimplyElementInString(d.event.element)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$drag extends $$mouse{
  constructor(element,moveToX,moveToY,options){
    super(element,{
      action:"drag",
      moveToX:moveToX,
      moveToY:moveToY
    },options)
  }

  mapToScript(){
    let d=this,list=[`$script.drag(${_scriptActionHandler._toSimplyElementInString(d.element)}, ${d.event.moveToX}, ${d.event.moveToY})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$hover extends $$mouse{
  constructor(element,options){
    super(element,{
      action:"hover"
    },
    options)
  }

  mapToScript(){
    let d=this,list=[`$script.hover(${_scriptActionHandler._toSimplyElementInString(d.element)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$mousedown extends $$mouse{
  constructor(element,x,y,options){
    super(element,{
      action:"mousedown",
      x:x,
      y:y
    },
    options)
  }

  mapToScript(){
    let d=this,list=[`$script.mousedown(${_scriptActionHandler._toSimplyElementInString(d.element)},${d.event.x},${d.event.y})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$mouseup extends $$mouse{
  constructor(element,x,y,options){
    super(element,{
      action:"mouseup",
      x:x,
      y:y
    },
    options)
  }

  mapToScript(){
    let d=this,list=[`$script.mouseup(${_scriptActionHandler._toSimplyElementInString(d.element)},${d.event.x},${d.event.y})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$set extends $$eventAction{
  constructor(element,value,options){
    super(element,{
      autoBlur:"on",
      type:"change",
      value:value,
    },
    options)
  }

  enableSupportReadOnly(){
    this.event.supportReadOnly="on"
    return this
  }

  nonJoinAutoOneActionGroup(){
    this.noLightAction="on"
    return this
  }

  assignDisableAISet(){
    this.disableAISet = "on"
    return this
  }

  assignWithSubmit(){
    this.withSubmit = "on"
    return this
  }

  assignWithEnter(){
    this.withEntry = "on"
    return this
  }

  mapToScript(){
    let d=this,list=[`$script.set(${_scriptActionHandler._toSimplyElementInString(d.element)},${JSON.stringify(d.event.value)})`]
    super.mapToScript(list)
    if(d.disableAISet){
      list.push(`assignDisableAISet()`)
    }

    if(d.withSubmit){
      list.push(`assignWithSubmit()`)
    }

    if(d.withEntry){
      list.push(`assignWithEnter()`)
    }

    if(d.noLightAction){
      list.push("nonJoinAutoOneActionGroup()")
    }

    if(d.event.supportReadOnly){
      list.push("enableSupportReadOnly()")
    }

    return _scriptActionHandler._joinScript(list);
  }
}

class $$typing extends $$eventAction{
  constructor(element,value,options){
    super(element,{
      autoBlur:"on",
      type:"key",
      groupKeys:value,
      action:"group",
    },
    options)
  }

  nonJoinAutoOneActionGroup(){
    this.noLightAction=1
    return this
  }

  mapToScript(){
    let d=this,
        list=[`$script.typing(${_scriptActionHandler._toSimplyElementInString(d.element)},${JSON.stringify(d.event.groupKeys)})`];


    if(d.noLightAction){
      list.push("nonJoinAutoOneActionGroup()")
    }
    
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
};
class $$get extends $$elementAction{
  constructor(element,variableName,options){
    super(element,{
      ...options,
      type:2,
      method:0,
      script:(variableName||"$parameter.extractValue")+" = $util.getElementText($element);"
    })
  }

  static jsonToObject(d){
    return new $$get(d.element,"",d)
  }

  mapToScript(){
    let d=this,list=[`$script.get(${_scriptActionHandler._toSimplyElementInString(d.element)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
};
class $$group extends $$action{
  constructor(actions,type,options){
    super({
      ...options,
      type:7,
      actions:actions.map(a=>{
        if(a instanceof $$action){
          return a
        }
        return $$action.jsonToObject(a)
      }),
      groupType:type
    })
  }

  mapToScript(){
    let d=this,
        s= `$script.${d.groupType||"group"}([\n  ${(d.actions||[]).map(a=>a.mapToScript().replace(/\n/g,"\n  ")).join(",\n  ")}\n])`,
        list=[]

    if(d.asOneAction){
      list.push(`enableAsOneAction()`)
    }
    super.mapToScript(list)
    list=list.map(x=>x.replace(/\n/g,"\n  "))
    list.unshift(s)
    return _scriptActionHandler._joinScript(list,1)
  }

  enableAsOneAction(){
    this.asOneAction="on"
    return this
  }

  static jsonToObject(d){
    let as=d.actions.map(a=>{
      let b=$$action.jsonToObject(a)
      if(!b){
        debugger
      }
      return b
    }),
        c=d.conditionAction?$$action.jsonToObject(d.conditionAction):null
    switch(d.groupType){
      case "given":
        return new $$given(as,d)
      case "when":
        return new $$when(as,d)
      case "then":
        return new $$then(as,d)
      case "if":
        return new $$if(c,as,d)
      case "else":
        return new $$else(as,d)
      case "else if":
        return new $$if(c,as,"else if",d)
      case "for":
        return new $$for(d.loopData,as,d)
      case "loop":
        return new $$loop(as,d)
      case "and":
        return new $$and(as,d)
      case "or":
        return new $$or(as,d)
      case "try":
        return new $$try(as,d)
      case "catch":
        return new $$catch(as,d)
      case "finally":
        return new $$finally(as,d)
      default:
        return new $$group(as,"",d)
    }
  }
}

class $$scenarioGroup extends $$group{
  constructor(actions,type){
    super(actions,type);
    (actions||[]).forEach(a=>{
      a.stepKey=a.groupKey=type
    })
  }
}

class $$given extends $$scenarioGroup{
  constructor(actions){
    super(actions,"given")
  }
}

class $$when extends $$scenarioGroup{
  constructor(actions){
    super(actions,"when")
  }
}

class $$then extends $$scenarioGroup{
  constructor(actions){
    super(actions,"then")
  }
}

class $$if extends $$group{
  constructor(conditionAction,actions,type){
    super(actions,type||"if")
    this.conditionAction=conditionAction

    _ideActionData._assignIfCondition(conditionAction)
  }

  else(actions){
    this.elseActions=new $$else(actions)
    return this
  }

  elseIf(condition,actions){
    let g=new $$if(condition,actions,"else if")
    g.elseGroup=1
    this.elseIfs=this.elseIfs||[]
    this.elseIfs.push(g)
    return this
  }

  mapToScript(){
    let d=this,
        condition=d.conditionAction.mapToScript(),
        actions=d.actions.map(a=>a.mapToScript().replace(/\n/g,"\n  ")),
        list=[`$script.if(${condition},[\n  ${actions.join(",\n  ")}\n])`];


    if(d.elseIfs){
      d.elseIfs.forEach(x=>{
        let c=x.conditionAction.mapToScript(),
            as=x.actions.map(a=>a.mapToScript())

        list.push(`elseIf(${c},[\n  ${as.map(a=>a.mapToScript()).join("\n  ")}\n])`)
      })
    }

    if(d.elseActions){
      list.push(`else([\n  ${d.elseActions.map(x=>x.mapToScript()).join("\n  ")}\n])`)
    }

    return _scriptActionHandler._joinScript(list,1)

  }
}

class $$else extends $$group{
  constructor(actions){
    super(actions,"else")
    this.elseGroup=1
  }
}

class $$for extends $$group{
  constructor(express,actions){
    super(actions,"for")
    this.loopData=express
  }

  mapToScript(){
    let d=this,
        actions=d.actions.map(a=>a.mapToScript().replace(/\n/g,"\n  ")),
        list=[`$script.for(${_scriptActionHandler._formatScript(d.loopData,1)},[\n  ${actions.join(",\n  ")}\n])`];


    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list,1)

  }
}

class $$loop extends $$group{
  constructor(actions){
    super(actions,"loop")
    this.loopGroup=1
  }
}

class $$and extends $$group{
  constructor(actions){
    super(actions,"and")
  }

  mapToScript(){
    return super.mapToScript()
  }

}

class $$or extends $$group{
  constructor(actions){
    super(actions,"or")
  }

  mapToScript(){
    return super.mapToScript()
  }
}

class $$try extends $$group{
  constructor(actions){
    super(actions,type||"try")
  }

  catch(expression){
    this.catch= new $$catch(expression)
    return this
  }

  finally(actions){
    this.finally= $$finally(actions)
    return this
  }

}

class $$catch extends $$group{
  constructor(expression,actions){
    super(actions,"catch")
    this.catchExpectation=expression
  }

}

class $$finally extends $$group{
  constructor(actions){
    super(actions,"finally")
  }
};
class $$loadPageAction extends $$action{
  constructor(url,hostId,options){
    hostId=hostId||BZ._getHostIdx(url)||"0"
    let _url=_ideVersionManagement._getHostById(hostId)
    super({
      ...options,
      type:6,
      hostId:hostId,
      loadType:(options?options.loadType:"")||"followSameURL",
      loadURL:url.replace(_url,"")
    })
  }

  setRefreshData(ds){
    this.refreshData=ds
    return this
  }

  enableClearCookie(){
    this.clearCookie="on"
    return this
  }

  enableClearLocalStorage(){
    this.clearLocalStorage="on"
    return this
  }

  mapToScript(){
    let d=this;
    let list= [`$script.visitPage("${d.loadURL}"${d.hostId&&d.hostId!="0"?', '+d.hostId:''})`]

    if(d.loadType!="followSameURL"){
      list.push(`setLoadType("${d.loadType}")`)
    }

    if(d.refreshData){
      list.push("setRefreshData("+JSON.stringify(d.refreshData)+")")
    }
    if(d.clearCookie){
      list.push("enableClearCookie()")
    }
    if(d.clearLocalStorage){
      list.push("enableClearLocalStorage()")
    }
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list)
  }

  static jsonToObject(d){
    return new $$loadPageAction(d.loadURL,d.hostId,d)
  }

};
class $$scriptAction extends $$action{
  constructor(script,element,options){
    super({
      ...options,
      type:3,
      script:script,
      element:_scriptActionHandler._toFullElement(element)
    })
  }

  enableRunInIDE(){
    if(!this.element){
      this.runInIDE=true
    }
    return this
  }

  toRunInAPP(){
    delete this.runInIDE
    return this
  }

  supportMutipleElement(){
    this.multipleElement = 1;
    return this
  }

  mapToScript(){
    let d=this,list

    if(d.runInIDE){
      list=[`$script.exeScriptInIDE(${_scriptActionHandler._formatScript(d.script||"")})`]
    }else{
      let e=this.element||""
      if(e){
        e=', '+_scriptActionHandler._toSimplyElementInString(e)
      }
  
      list=[`$script.exeScriptInAPP(${_scriptActionHandler._formatScript(d.script||"")}${e})`]
    }

    super.mapToScript(list)

    if(d.multipleElement){
      list.push(`supportMutipleElement()`)
    }
    return _scriptActionHandler._joinScript(list);
  }

  static jsonToObject(d){
    return new $$scriptAction(d.script,d.element,d)
  }
};
class $$validAction extends $$action{
  constructor(options){
    super({
      method:0,
      content:{},
      compareMark:"==",
      ...options,
      type:0
    })
  }

  static jsonToObject(d){
    if(d.runInIDE){
      return $$validScriptInIDE.jsonToObject(d)
    }else{
      return $$validActionInAPP.jsonToObject(d)
    }
  }
}

class $$validActionInAPP extends $$elementAction{
  constructor(element,options){
    super(element,{
      content:{},
      compareMark:"==",
      ...options,
      type:0,
      method:0
    })
  }

  static jsonToObject(d){
    if(d.method==1){
      return new $$validScriptInApp(d.script,d.element,d)
    }else if(d.content){
      switch(d.content.type){
        case "data":
          return new $$validData(d.element,d.expectation,d)
        case "innerText":
          return new $$validInnerText(d.element,d.expectation,d)
        case "value":
          return new $$validInputValue(d.element,d.expectation,d)
        case "unexist":
          return new $$validUnexist(d.element,d)
        case "disable":
          return new $$validDisable(d.element,d)
        case "enable":
          return new $$validEnable(d.element,d)
        case "checked":
          return d.expectation=="on"?new $$validChecked(d.element,d):new $$validUnchecked(d.element,d)
        case "exist":
        default:
          d.content.type="exist"
          return new $$validExist(d.element,d)
      }
    }
  }
}

class $$validScriptInApp extends $$validActionInAPP{
  constructor(script,element,options){
    super(element,{
      ...options,
      script:script,
      method:1
    })
  }

  mapToScript(){
    let d=this,e=d.element,
        list=[`$script.validateByScriptInApp(\`${this.script}\`${e?", "+elementAction.toSimplyElementInString(e):""})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$validScriptInIDE extends $$validAction{
  constructor(script,options){
    super({
      ...options,
      method:1,
      script:script,
      runInIDE:1
    })
  }

  mapToScript(){
    let list=[`$script.validateByScriptInIDE(${JSON.stringify(this.script)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }

  static jsonToObject(d){
    return new $$validScriptInIDE(d.script,d)
  }
}

class $$validData extends $$validActionInAPP{
  constructor(element,data,options){
    super(element,{
      ...options,
      content:{type:"data"},
      expectation:data
    })
  }

  mapToScript(){
    let list=[`$script.hasData(${_scriptActionHandler._toSimplyElementInString(this.element)},${JSON.stringify(this.expectation)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$validInnerText extends $$validActionInAPP{
  constructor(element,text,options){
    super(element,{
      ...options,
      content:{type:"innerText"},
      expectation:text
    })
  }

  mapToScript(){
    let list=[`$script.hasText(${_scriptActionHandler._toSimplyElementInString(this.element)},${JSON.stringify(this.expectation)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$validInputValue extends $$validActionInAPP{
  constructor(element,value,options){
    super(element,{
      ...options,
      content:{type:"value"},
      expectation:value
    })
  }

  mapToScript(){
    let list=[`$script.hasValue(${_scriptActionHandler._toSimplyElementInString(this.element)},${JSON.stringify(this.expectation)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$validExist extends $$validActionInAPP{
  constructor(element,options){
    super(element,{
      content:{type:"exist"},
      ...options,
    })
  }

  mapToScript(){
    let list=[`$script.isExist(${_scriptActionHandler._toSimplyElementInString(this.element)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$validUnexist extends $$validActionInAPP{
  constructor(element,options){
    super(element,{
      content:{type:"unexist"},
      ...options,
    })
  }

  mapToScript(){
    let list=[`$script.isUnexist(${_scriptActionHandler._toSimplyElementInString(this.element)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$validEnable extends $$validActionInAPP{
  constructor(element,options){
    super(element,{
      ...options,
      content:{type:"enable"},
      expectation:"true"
    })
  }

  mapToScript(){
    let list=[`$script.isEnable(${_scriptActionHandler._toSimplyElementInString(this.element)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$validDisable extends $$validActionInAPP{
  constructor(element,options){
    super(element,{
      ...options,
      content:{type:"disable"},
      expectation:"true"
    })
  }

  mapToScript(){
    let list=[`$script.isDisable(${_scriptActionHandler._toSimplyElementInString(this.element)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$validChecked extends $$validActionInAPP{
  constructor(element,options){
    super(element,{
      ...options,
      content:{type:"checked"},
      expectation:"on"
    })
  }

  mapToScript(){
    let list=[`$script.isChecked(${_scriptActionHandler._toSimplyElementInString(this.element)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
}

class $$validUnchecked extends $$validActionInAPP{
  constructor(element,options){
    super(element,{
      ...options,
      content:{type:"checked"},
      expectation:""
    })
  }

  mapToScript(){
    let list=[`$script.isUnchecked(${_scriptActionHandler._toSimplyElementInString(this.element)})`]
    super.mapToScript(list)
    return _scriptActionHandler._joinScript(list);
  }
};
window.BZ = {
  ...BZ,
  _userHabit: { toolbarPos: {} },
  TW: window,
  _data: { _status: 0, _uiSwitch: { _testPlay: {} } },
  _focusTW: function () {
    if (!window.name) {
      window.name = "bz-client"
    }
    window.open("", window.name).focus()
  },
  _hasCode: function (v) {
    return v.match(/\$(loop|parameter|parentModule|test|module|project|data|util|script|group|action)/)
  },
  _isCheckout: function () {
    return 1
  },
  _findIframePath: function () {
    var p = parent, w = window, v = "";
    while (p != w) {
      for (var i = 0; i < p.frames.length; i++) {
        if (p.frames[i] == w) {
          if (v) {
            v = "," + v
          }
          v = i + v
          break
        }
      }
      w = p
      p = p.parent
    }
    return v || ""
  },
  _formatInIFramePath: function (e) {
    let v = BZ._findIframePath()
    if (v) {
      e[0] = "$(BZ.TW.document).findIframe(" + v + ")" || ""
    }
  },
  focusIDE: function () {
    bzComm.postToIDE({ fun: "focusIDE", scope: "BZ" })
  },
  _storeUserHabit: function () {
    localStorage.setItem("bz-extension-habit", JSON.stringify(this._userHabit));
  },
  _getCurModule: function () {
    return _IDE._data._curModule;
  },
  _getCurTest: function () {
    return _IDE._data._curTest;
  },
  _getCurAction: function () {
    return _IDE._data._curAction;
  },
  _hasExtension: function () { },
  _isAutoRunning: function () {
    return BZ._data._autoRunning;
  }
};

var _IDE = {
  _modulePathRegex: /(\/(m[0-9]+|bug|com))+/,
  _testPathRegex: /(\/(m[0-9]+|bug|com))+\/t[0-9]+/,
  _testKeyRegex: /(m[0-9]+|com)\.t[0-9]+/,
  _actionPathRegex: /(\/(m[0-9]+|bug|com))+\/(t[0-9]+)\/([0-9\-c]+)/,
  _exePathRegex: /(\/(m[0-9]+|bug|com))+\/t[0-9]+\/([0-9\-c]+|actions|)/,
  _objRegex: /(\/(m[0-9]+|bug|com))+(\/t[0-9]+)*/,
  _insertJSRegex: /((\{\{).*\$(project|module|test|loop|data|group|action|parameter)((\.|\[)[a-zA-Z0-9\u4E00-\u9FCC_\$\'\"\[\]\.]+)*.*(\}\}))/g,
  _insertJSOnlyRegex: /(\$(project|module|test|loop|data|group|action|parameter)((\.|\[|$)[a-zA-Z0-9\u4E00-\u9FCC_\$\'\"\(\)]+(\])*)*)/g,
  _dataRegex: /(\$(project|module|test|loop|data|group|action|parameter)((\.|\['?"?|'?"?\])[a-zA-Z0-9\u4E00-\u9FCC_\$]+)*\s*)/g,
  _dataFunRegex: /(\$(project|module|test|loop|data|group|action|parameter)((\.|\['?"?|'?"?\])[a-zA-Z0-9\u4E00-\u9FCC_\$]+)*\s*(\([^\)]*\))?)/g,
  _data: {
    _curVersion: {},
    _curTest: 0,
    _curModule: 0,
    _setting: {
      appLanguages: [""]
    }
  },
  _getCurEnvironment: function () {
    return _IDE._data._setting.environments[_IDE._data._setting.curEnvironment || 0]
  }
};
var _apiDataHandler = {}
var _cooperatorHandler = {}
var _appWordHandler = { _wordMap: {} }
if (window.name != "bz-master") {
  console.log("")
  $(document.body).keydown(function (e) {
    if(!bzComm._startComm){
      return
    }
    var _keyCode = e.keyCode;
    if (_keyCode == 27 && BZ._isPlaying()) {
      bzComm.postToIDE({ fun: "setStatus", scope: "BZ", ps: ["pause"] })
    }
  });

  window.onhashchange = function () {
    if(!window._startComm){
      return
    }
  }

  $(document.body).on("contextmenu", function (e) {
    if(!window._startComm){
      return
    }
    _Util._copyText(e.target)
  });

  $(document.body).on("mouseover","A", function (e) {
    if(!window._startComm){
      return
    }
    _Util._removeLinkTarget(e.currentTarget)
  });

  if(window.name=="bz-client"){
    TWHandler._setUnload(window);
  }
}


var _identifyIFrameHandler = {
  _setIframePath: function (v) {
    _identifyIFrameHandler._iframePath = v
  },
  _reportIFrame: function (_requestFlag) {
    if (_identifyIFrameHandler._curJudgeIFrameFlag == -1) {
      _identifyIFrameHandler._curJudgeIFrameFlag = 0
      return
    }
    if (window.innerWidth > 10 && window.innerHeight > 10) {
      let fs = []
      $("IFRAME").toArray().forEach(x => {
        x = _identifyIFrameHandler._getIFrameSize(x)
        if (x) {
          fs.push(x)
        }
      })
      let d = {
        _bzIframeId: bzIframeId,
        _path: _identifyIFrameHandler._iframePath,
        fs: fs,
        _requestFlag: _requestFlag,
        _time: Date.now(),
        _curJudgeIFrameFlag: _identifyIFrameHandler._curJudgeIFrameFlag
      }
      if (_identifyIFrameHandler._curJudgeIFrameFlag) {
        _identifyIFrameHandler._curJudgeIFrameFlag = -1
      }
      if (parent != window) {
        d._width = Math.round(window.innerWidth)
        d._height = Math.round(window.innerHeight)
      }
      chrome.runtime.sendMessage({ bz: 1, _scope: "_iframeManagement", _fun: "_registerIframe", _data: d })
    }
  },
  _getIFrameSize: function (x) {
    let r1 = x.getBoundingClientRect()

    if (r1.width > 10 && r1.height > 10 && x.id != "bzInTimeInfo" && !_Util._isBlankIFrame(x)) {
      x.frameBorder = 0
      let r = x.getBoundingClientRect()
      let w = r.width, h = r.height
      if (r.width != r1.width) {
        x.frameBorder = 1
      }
      return {
        _width: Math.round(w),
        _height: Math.round(h),
        id: x.id,
        f: x
      }
    }
  },
  _setJudgeIFrameFlag: function (v) {
    _identifyIFrameHandler._curJudgeIFrameFlag = v
  },
  // _reportIFrameUpdata:function(){
  // // chrome.runtime.sendMessage({bz:1,_scope:"_iframeManagement",_fun:"_updateIFrame"})
  // },
  _setPath: function (v) {
    _identifyIFrameHandler._iframePath = v
  },
  _getBlankIFrameID: function (f) {
    if (f.id) {
      return f.id
    }
    let i = 0;
    if ($("IFRAME").toArray().find(x => {
      try {
        let r = x.getBoundingClientRect()
        if (r.width > 10 && r.height > 10 && _Util._isBlankIFrame(x)) {
          i++
          if (x == f || x.contentWindow == f) {
            f = x
            return 1
          }
        }
      } catch (e) { }
    })) {
      return f.id || (i - 1)
    }
  },
  _showInfo: function () {
    document.body.children[0].innerText = bzIframeId + ":" + _identifyIFrameHandler._iframePath
  },
  _judgeIFrameByChangeSize: function (v) {
    v = v || 0
    let ws = []
    $("IFRAME").toArray().forEach(x => {
      x = _identifyIFrameHandler._getIFrameSize(x)
      if (x) {
        ws.push(x)
      }
    })
    $(document.body).hide()
    ws.forEach(x => {
      x.sw = $(x.f).css("width")
      x.sh = $(x.f).css("height")
    })
    $(document.body).show()
    ws.forEach((x, i) => {
      $(x.f).css({ height: parseInt(x._height) + (i + v) + "px" })
    })
    _identifyIFrameHandler._reportIFrame()
    setTimeout(() => {
      ws.forEach((x, i) => {
        $(x.f).css({ height: x.sh })
      })
    }, 10)
  }
};
//Response on send data from client web page to BZ extension package
var _transferMonitor={
  _config:{ attributes: true, childList: true, characterData: true,subtree:true,attributeOldValue:true,characterDataOldValue:true },
  _docs:[],
  _curMutations:[],
  _infoObserver: new MutationObserver(function(_mutations) {
    _mutations.forEach(function(_mutation) {
      var v=_mutation.addedNodes[0]
      if(v&&v.data){
        v=JSON.parse(v.data)
        _transferMonitor._bzArea.innerHTML=""
        //in extension content.js file
        handleMsg(v)
      }
    });
  }),
  _init:function(){
    var o=$("<div id='bz-area' style='display:none'></div>").insertAfter(document.body)[0]
    _transferMonitor._bzArea=o
    this._infoObserver.observe(o,this._config);
    if(_IDE._data._curVersion.setting.content.completeActionOnRender){
      this._pageObserver.observe(BZ.TW.document.body,this._config);
      _transferMonitor._lastUIUpdate=Date.now()
    }
  },
  _pageObserver:new MutationObserver(function(_mutations) {
    var s=_IDE._data._curVersion.setting.content.ignoreRenderElement||""
    if(s){
      s=$(BZ.TW.document.body).find(s)
      for(var i=0;i<_mutations.length;i++){
        var o=_mutations[i].target
        
        if(!s.is(o)&&!s.find(o)[0]&&o.getBoundingClientRect){
          o=o.getBoundingClientRect()
          if(o.width&&o.height){
            return _transferMonitor._lastUIUpdate=Date.now()
          }
        }
      }
    }else{
      _transferMonitor._lastUIUpdate=Date.now()
    }
  }),
  _getUICompleteTime:function(_fun){
    if(!window.extensionContent){
      if(!_ideTask._appReady){
        return setTimeout(function(){
          _transferMonitor._getUICompleteTime(_fun)
        },10)
      }
      bzComm.postToAppExtension({
        fun:"_getUICompleteTime",
        scope:"_transferMonitor",
        insertCallFun:1,
        return:function(r){
          _fun(r)
        }
      })
    }else{
      _transferMonitor._lastUIUpdate=_transferMonitor._lastUIUpdate||Date.now()
      var t=_transferMonitor._lastUIUpdate
      if(Date.now()-t>500){
        _fun(t)
      }else{
        setTimeout(function(){
          _transferMonitor._getUICompleteTime(_fun)
        },10)
      }
    }
  }
};
var _bzDomPicker={
  _data:(window._CtrlDriver&&_CtrlDriver._buildProxy({_autoRefresh:"on"}))||{_autoRefresh:"on"},
  _pdb:(window._CtrlDriver&&_CtrlDriver._buildProxy({_refreshShowList:1}))||{_refreshShowList:1},
  _textMethods:[
    "",
    ":text",
    ":input",
    ":panel",
    ":after",
    ":afterEqual",
    ":before",
    ":contains",
    ":Contains",
    ":equal",
    ":endEqual",
    ":endContains",
    ":near",
    ":data",
    ":RowCol",
    ":rowcol"
  ],
  _methods:[
    "",
    ":text",
    ":input",
    ":panel",
    ":after",
    ":afterEqual",
    ":before",
    ":near",
    ":RowCol",
    ":rowcol"
  ],
  _preRequire:null,
  _selectedItem:null,
  _selectedCover:null,
  _curDom:null,
  _getTWElementPathByCSS:function(c,_fun,_reTry){
    if(!window.extensionContent){
      bzComm.postToAppExtension({
        fun:"_getTWElementPathByCSS",
        scope:"_bzDomPicker",
        ps:[c],
        insertCallFun:1
      },_fun);
      return
    }
    
    if(window.innerWidth>100&&window.innerHeight>100){
      let cc=c?$util.findDom(["BZ.TW.document",c,0]):0
      if(cc){
        c=_cssHandler._findPath(cc)
      }else{
        c=0
      }
    }else{
      return
    }
    _fun(c);
  },
  _hasChild:function(d){
    let os=d._dom.children;
    if(os&&d==_bzDomPicker._data._focusItem){
      for(let o of os){
        if(_bzDomPicker._data._items.find(x=>o==x._dom)){
          return
        }
      }
      return os.length
    }

  },
  _hasSibling:function(){
    let d=_bzDomPicker._data._items
    d=d[d.length-1]
    return d._dom.parentElement.children.length>1;
  },
  _getDomDesc:function(d){
    d=d||_bzDomPicker._data._focusItem
    let o=d._dom
    if(!o.tagName){
      return o
    }
    let w="<"+o.tagName.toLowerCase()
    if(o.id){
      w+=` id="${o.id}"`
    }
    if(o.classList.length){
      w+=` class="${o.className}"`
    }
    for(let i=0;i<o.attributes.length;i++){
      let a=o.attributes[i],v=a.value
      if(!a.name.match(/^(id|class|style|on.+|bz-.+)$/)&&v){
        w+=` ${a.name}="${v}"`
      }
    }
    w+=">"
    if(w.length>50){
      w=w.substring(0,45)+" ..."
    }
    return w
  },
  _getMethodByText:function(o,w){
    let os=_Util._getTargetElement($(`:endContains(${w})`)),m
    _Util._spliceAll(os,x=>_Util._isHidden(x))
    if(!os.length){
      os=$(`:Contains(${w})`)
      _Util._spliceAll(os,x=>_Util._isHidden(x))
      os=_Util._getCeilDom(os)
    }

    _Util._spliceAll(os,(x,j)=>{
      if($(o).find(x)[0]||o==x){
        m=":Contains"
      }
    })

    if(m&&($util.getElementText(o)==w||!os.length)){
      return m;
    }

    let as=$("*")
    let ss=os.map(x=>as.index(x)),_idx=as.index(o)
    os.sort((a,b)=>{
      return Math.abs(as.index(a)-_idx)-Math.abs(as.index(b)-_idx)
    })
    if(as.index(os[0])>_idx){
      m=":before"
    }else{
      m=":after"
    }
    return m
  },
  _getTextByMethod:function(o,m){
    let _txt=$util.getElementText(o),
        p=o.parentElement
    m=m.replace(":","")
    setTimeout(()=>{
      _bzDomPicker._setValue()
      _bzDomPicker._resetLastIdx()
    },1000)
    switch(m){
      case "near":
		return _Util._findNearTxt(o)
      case "after":
      case "afterEqual":
        while(p){
          let t=$util.getElementText(p),w=""
          if(t!=_txt){
            for(let n of p.childNodes){
              if(n==o){
                break
              }else{
                if(n.nodeType==3){
                  w=n.textContent.trim()||w
                }else if(n.nodeType==1){
                  w=$util.getElementText(n)||w
                }
              }
            }
            w=(w||"").trim()
            if(w){
              return w
            }
          }
          o=p
          p=p.parentElement
        }
      case "before":
        while(p){
          let t=$util.getElementText(p),w="",_start
          if(t!=_txt){
            for(let n of p.childNodes){
              if(n==o){
                _start=1
              }else if(_start){
                if(n.nodeType==3){
                  w=" "+n.textContent
                }else if(n.nodeType==1){
                  w=" "+$util.getElementText(n)
                }
                w=w.trim()
                if(w){
                  return w
                }
              }
            }
          }
          o=p
          p=p.parentElement
        }
      case "contains":
      case "Contains":
      case "equal":
        return _txt.trim().substring(0,30).trim()
      case "endContains":
      case "endEqual":
        for(let x of o.childNodes){
          if(x.nodeType==3&&x.textContent.length){
            return x.textContent
          }
        }
        return ""
      case "rowcol":
      case "RowCol":
        let _area
        if($("td,th").find(o)[0]){
          _area=_Util._getClosestElement(o,o,"table")
        }
        _area=_area||document.body
        let os=$(_area).find(":endContains(*)").toArray()
        while($util.getElementText(o.parentElement)==_txt){
          o=o.parentElement
        }
        let r=o.getBoundingClientRect(),_col,_row
        os.find(x=>{
          if(x==o){
            return 1
          }
          if(!_col||!_row){
            let xr=x.getBoundingClientRect()
            if(!_col){
              if(xr.left>=r.left-10&&xr.right<=r.right+10){
                _col=$util.getElementText(x)
              }
            }else{
              if(xr.top>=r.top-10&&xr.bottom<=r.bottom+10){
                _row=$util.getElementText(x)
                if(_row){
                  return 1
                }
              }
            }
          }
        })
        if(_col&&_row){
          return _row+"|"+_col
        }
        return ""
    }
  },
  _setMousedown:function(o){
    o.onmousedown=function(e){
      if(e&&e.button==2){
        if(this.children.length){
          return
        }
        _bzDomPicker._cancel()
        e.preventDefault();
        e.stopPropagation()
        let _fun=document.body.oncontextmenu
        document.body.oncontextmenu=function(e){
          e.preventDefault();
          e.stopPropagation()
          document.body.oncontextmenu=_fun
          return false
        }
        return false
      }
      if(!BZ._autoRecording){
        _innerWin._data._curDomPath=0
      }
      try{
        var _pos=e?_Util._getMouseXY(e):{x:0,y:0};
        if(e&&e.target.o&&e.target.o.tagName=="CANVAS"){
          e.target.o.bzTxtElement=TWHandler._getCanvasTextElementByMousePos(e.target.o,_pos.x,_pos.y)
          delete e.target.o.bzTmp
        }
      }catch(e){}
      _bzDomPicker._popWin(this._orgDom,_pos)
    }
    o.onkeydown=function(e){
      if(27==e.keyCode){
        _bzDomPicker._endRequire()
      }
    }
    /*
    o.onblur=function(){
      this.focus()
    }
    */
    setTimeout(function(){
      o.focus()
    },1500)
  },
  _scrollSync:function(){
    _bzDomPicker._resetPos($(".BZCover,.ErrBZCover"));

    $(BZ.TW.document).find("IFRAME").each(function(i,o){
      try{
        if(!o.src.startsWith("http")){
          _bzDomPicker._resetPos($(o.contentDocument).find(".BZCover,.ErrBZCover"))
        }
      }catch(e){}
    });
    _bzDomPicker._resetPos($(BZ.TW.document).find(".BZCover,.ErrBZCover"));
  },
  _pickDetails:function(d,_fun){
    if(!_Util._isBZTWOpened()){
      return BZ._launchCurEnvUrl(0,function(){
        _bzDomPicker._pickDetails(d,_fun)
      })
    }
    if(!window.extensionContent){
      bzComm.postToAppExtension({
        fun:"_pickDetails",
        scope:"_bzDomPicker",
        ps:[d],
        insertCallFun:1
      },_fun);
    }else{
      _bzDomPicker._start({_id:"_element",_back:_back,_type:d=="_path"?"":d});
    }
    function _back(_path,_pos,_element){
      var vs;
      //TODO: 2019-05-12
      if(d=="_path"){
        vs=_cssHandler._findPath(_element)
      }else{
        vs=[{_css:_element.tagName}]
        var as=_element.attributes;
        for(var i=0;i<as.length;i++){
          var a=as[i]

          if(a.name=="class"){
            var v=a.value.split(/[ ]+/)
            v.forEach(function(vv){
              if(vv){
                vs.push({_css:"."+vv})
              }
            })
          }else if(a.name=="id"){
            vs.push({_css:"#"+a.value})
          }else{
            vs.push({_css:":attr("+a.name+"="+a.value+")"})
          }
        }
        if(!["SVG","SELECT","TEXTAREA"].includes(_element.tagName)){
          vs.push({_css:":Contains("+_Util._toTrimSign($util.getElementText(_element),100)+")"})
        }
      }
      _fun(d)

      _bzDomPicker._endRequire()
    }
  },
  _pickElement:function(_path,_fun){
    _path=_path||""
    if(!window.extensionContent){
      bzComm.postToAppExtension({
        fun:"_pickElement",
        scope:"_bzDomPicker",
        ps:[_path],
        return:_fun,
        insertCallFun:1
      });
    }else{
      var d={_type:_path};
      if(_path.constructor==Object){
        d=_Util._clone(_path)
        d._type=_path._path
      }
      d._id="_element"
      d._back=_back
      _bzDomPicker._start(d);
    }
    function _back(p,_pos,_element){
      if(_path._fun){
        p={_path:p,_result:window[_path._scope][_path._fun](_element,p)}
      }
      if(_path._requireUrl){
        if(p.constructor==Array){
          p={_path:p}
        }
        p._requireUrl=location.href
      }
      //for force open dom picker
      if(BZ._data._uiSwitch._tmpPath){
        BZ._data._uiSwitch._tmpPath=0
      }
      BZ._formatInIFramePath(p._path||p)
      _fun(p)
      _bzDomPicker._endRequire()
    }
  },
  _start:function(_require){
    if(bzComm._isAppExtension()){
      var w=_bzDomPicker._domPickerWindow;
      if(w&&!w.closed){
        _bzDomPicker._preRequire=_bzDomPicker._curRequire
        w.close();
      }else{
        _bzDomPicker._preRequire=0
      }
      window._infoManagement&&_infoManagement._showImportantInfo(_bzMessage._picker._reminder,0,0,1)

      BZ.TW.focus();

      _bzDomPicker._curRequire=_require;
      BZ._data._domPickerStatus=_require._id;
      let _autoRefresh=_bzDomPicker._data._autoRefresh
      _bzDomPicker._data=_CtrlDriver._buildProxy({_autoRefresh:_autoRefresh});

      _bzDomPicker._removeTmpCover();
      _bzDomPicker._selectedCover=null;
      
      if(_require._type){
        _bzDomPicker._autoMarkSelect(_require);
      }else{
        _bzDomPicker._manualSelect();
      }
      _innerWin._data._pos._inMin=0

    }else{
      if(!_Util._isBZTWOpened()){
        BZ._launchCurEnvUrl(undefined,function(){
          _require._path=_require._type
          _popErr();
        })
        return 
      }else{
        _bzDomPicker._pickElement(_require,_require._back)
      }
    }

    function _popErr(){
      if(_ideTask._appReady){
        setTimeout(()=>{
          _bzDomPicker._pickElement(_require,_require._back)
        },1000)
      }else{
        setTimeout(()=>{
          _popErr()
        },1000)
      }
    }

  },
  _editPath:function(_path,_fun){
    if(!window.extensionContent){
      _bzDomPicker._tmpBackFun=_fun
      bzComm.postToAppExtension({
        fun:"_editPath",
        scope:"_bzDomPicker",
        ps:[_path],
        return:_fun,
        insertCallFun:1
      });
    }else{
      _bzDomPicker._start({
        _id:"_editPath",
        _back:function(){
          BZ._formatInIFramePath(p)
          return p
        },
        _type:_path
      });
    }
  },
  _autoMarkSelect:function(_require){
    var os=null,_type=_require._type;

    //manual re-select on old action
    if($.isArray(_type)){
      os = $util.findDom(_type);
      if(os){
        os=[os];
        BZ._data._uiSwitch._tmpPath=0
      }else{ // for lost old element from page
        _bzDomPicker._popWin()
        BZ._data._uiSwitch._tmpPath=_type
        //_infoManagement._showImportantInfo("The element wasn't found on the current page. Please be sure it is on the page and re-pick it.",0,0,1)
//        this._manualSelect();
        return;
      }
    }else{
      //filter, for form input, or user search dom
      this._data._filter=_require._filter;
      os = $(_type);
    }
    
    if(!os || !os.length){
      _bzDomPicker._domPickerWindow.alert(_Util._formatMessage(_bzMessage._picker._noExpectedType,[_require._filter||_type]));
      
      _bzDomPicker._curRequire._type=_bzDomPicker._preType
      _bzDomPicker._start(_bzDomPicker._curRequire)
      return
    }
    var cs=this._showTmpCover(os);
    if(cs.length==1){
      cs[0].onmousedown();
    }else{
      _bzDomPicker._popWin()

      // this._curRequire._type=null;
    }
  },
  _isActionElementPicking:function(){
    return BZ._data._domPickerStatus=="_actionElementPick";
  },
  _isFormElementPicking:function(){
    return BZ._data._domPickerStatus=="_formElementPick";
  },
  _isDomRootElementPicking:function(){
    return BZ._data._domPickerStatus=="_domRootElementPick";
  },
  _isPicking:function(){
    return Boolean(BZ._data._domPickerStatus);
  },
  _manualSelect:function(){
    this._selectedCover=this._createTmpCover();

    $(this._selectedCover).mouseover(function(e){
      this._startPos = _Util._getMouseXY(e);
    });
    $("body").mouseleave(function(e){
      setTimeout(function(){
        $(_bzDomPicker._selectedCover).hide();
      },100);
    });
    this._selectedCover.onmousemove=function(e){
      clearTimeout(this._removeTimer)
      var ca=_IDE._data._curAction;
      var at=_ideActionData._type;
      if(_bzDomPicker._curRequire && ["_actionElementPick","_element"].includes(_bzDomPicker._curRequire._id) && !ca){
        return _bzDomPicker._removeTmpCover();
//        return _bzDomPicker._endRequire();
      }
      if(this._orgDom && this._orgDom.tagName=="IFRAME"){
        _bzDomPicker._defineDocMouseover();
        return _bzDomPicker._removeTmpCover();
      }
      if(!this._startPos){
        this._startPos = _Util._getMouseXY(e);
      }else{
        var _newPos = _Util._getMouseXY(e);
        var dx=_newPos.x-this._startPos.x;
        var dy=_newPos.y-this._startPos.y;
        if(dx<-2 || dx>2 || dy<-2 || dy>2){
          var o=_Util._getMouseOnChild(this.o,_newPos)
          if(o){
            _bzDomPicker._setTmpCoverPosByDom(o,this)
          }else if(this.o.tagName=="CANVAS"){
            this.o.bzTxtElement=0
            let pp=TWHandler._getCanvasTextElementByMousePos(this.o,_newPos.x,_newPos.y)
            if(pp!=this.o.bzTxtElement){
              this.o.bzTxtElement=pp
              _bzDomPicker._setTmpCoverPosByDom(this.o,this)
            }
          }else{
            this._removeTimer=setTimeout(()=>{
              this.remove()
            },100)
          }
        }
      }
    };
    this._selectedCover.onmouseout=function(e){
      if(this._orgDom && this._orgDom.tagName=="IFRAME"){
        return
      }
      var o=_Util._getMouseOnParent(this.o,_Util._getMouseXY(e))
      if(o!=this.o){
        _bzDomPicker._setTmpCoverPosByDom(o,this)
      }
    }
    this._defineDocMouseover();
  },
  _defineDocMouseover:function(){
    $("body").unbind("mouseover");
    $("body").bind("mouseover",_bzDomPicker._mouseoverEvent);
    if(window.extensionContent){
      $("IFRAME").each(function(i,o){
        if(!o.src.startsWith("http")){
          $(o.contentDocument).find("body").bind("mouseover",_bzDomPicker._mouseoverEvent);
        }
      })
    }
    function _doIt(e){ //document.body.mouseover event
    }
  },
  _mouseoverEvent:function(e){
    var _timeoutHandle=null;
    if(!_bzDomPicker._curRequire){
      return;
    }
    
    window.clearTimeout(_timeoutHandle);

    _timeoutHandle=window.setTimeout(function(){
      var o =_Util._getSouElementFromEvent(e)
      if(o.shadowRoot&&_Util._hasDeepContent(o.shadowRoot)){
        if(!o.shadowRoot._bindPicker){
          o.shadowRoot._bindPicker=1
          var os=$(o.shadowRoot).find("*").not("style,script"),oo;
          os.bind("mouseover",_bzDomPicker._mouseoverEvent)
          for(var i=0;i<os.length;i++){
            if($(os[i]).css("pointer-events")!="none"){
              oo=os[i]
            }
          }
          if(oo){
            _bzDomPicker._mouseoverEvent({target:oo})
          }
        }
        return
      }

      if(o!=_bzDomPicker._selectedCover){
        $(_bzDomPicker._selectedCover).hide();
        if(!$(o).hasClass("BZIgnore") && $(".BZIgnore").find(o).length==0){
          _bzDomPicker._curDom=o;
          _bzDomPicker._setTmpCoverPosByDom(o,_bzDomPicker._selectedCover);
          if(!_innerWin._data._pos._inMin){
            clearTimeout(_bzDomPicker._showPathTimer)
            _bzDomPicker._showPathTimer=setTimeout(function(){_bzDomPicker._showPath(o)},300)
          }
        }
      }
    },100);
  },
  _showPath:function(o){
    if(BZ._autoRecording){
      return
    }
    let vs=_bzDomPicker._getElementOptions(o).map(x=>x._value),
        w=$util.getElementText(o)
    if(w){
      w=": "+w
    }
    vs.unshift(o.tagName+(w||""))
    _innerWin._data._curDomPath=vs
  },
  _endRequire:function(){
    if(BZ._isRecording()){
      setTimeout(function(){
        _bzDomPicker._removeTmpCover();
      },1000);
    }else{
      _bzDomPicker._removeTmpCover();
    }
    _bzDomPicker._curRequire=0

    // if(_bzDomPicker._curRequire){
      // BZ._data._domPickerStatus=_bzDomPicker._curRequire._id;
    // }else{
      // BZ._data._domPickerStatus=null;
    // }
//    BZ._setOperationInfo("");
  },
  _getFinalTargetElement:function(_path,o){
    let p=_Util._clone(_path)
    while(p.length){
      let x=p.pop()
      if(!$.isNumeric(x)){
        x=x.split(/[\:\.\#\[]/)
        if(x[0].toLowerCase()==o.tagName.toLowerCase()){
          return o
        }
        while(o.parentElement){
          if(o.parentElement.tagName.toLowerCase()==x[0].toLowerCase()){
            return o.parentElement
          }
          o=o.parentElement
        }
        break
      }
    }
  },
  _popWin:function(o,_pos){
    if(!this._curRequire){
      return;
    }
    if(o){
      if(o.bzTmp&&o.bzTmp.constructor==String){
        o.bzTmp=0
      }
      var _path
      if(this._curRequire._type && this._curRequire._type.constructor==Array && this._curRequire._type.length){
        if(this._curRequire._type[0].startsWith("BZ.TW.document")){
          _path=_Util._clone(this._curRequire._type);
          var _idx=parseInt(_path[_path.length-1]);
          if(!_idx && _idx!=0){
            _path.push(0);
          }
        }
      }else{
        _path = o.bzTmp||_cssHandler._findPath(o,0,_bzDomPicker._curRequire._simple);
        o=_bzDomPicker._getFinalTargetElement(_path,o)||o
      }
      if(!_path){
        return
      }
      if(!BZ._data._uiSwitch._tmpPath&&!this._isDomRootElementPicking() && this._curRequire._id!="_domRoot" && !this._data._filter && (!this._curRequire._type || this._curRequire._type.constructor!=Array)){
        _bzDomPicker._curRequire._back(_path,_pos,o);
        _bzDomPicker._endRequire();
        BZ.focusIDE()
        return 1
      }
      BZ._data._uiSwitch._tmpPath=BZ._data._uiSwitch._tmpPath||1
      this._data._pos=_pos;
      _bzDomPicker._setNewPath(_path,o);
    }

    this._domPickerWindow =w= _Util._popWin("","_domPicker",null,800,500,_pickerTemplate,_bzMessage._picker._name);
    var d=w.document;
    this._document=d;
    
    if(o){
      this._testPath();
      o=_bzDomPicker._data._items[_bzDomPicker._data._items.length-1]
      _bzDomPicker._setFocusItem(o)
    }
  },
  _setNewPath:function(_path,o){
    _bzDomPicker._curDom=o||_bzDomPicker._curDom;
    this._data._items = this._getAllLayerElements(_bzDomPicker._curDom,_path);
  },
  _getAllLayerElements:function(o,ps){
    var _paths=[];
    var _body=$(eval(ps[0]));
    while(o.parentNode){
      if(o.tagName!="BODY"){
        _paths.unshift({_dom:o,_selected:false,_opened:true,_value:""});
        o=o.parentNode;
      }else{
        _paths.unshift({_dom:ps[0],_selected:true,_opened:false,_value:ps[0]});
        break;
      }
    }
    var _last=1;
    ps=ps.map(x=>x)
    let _idx=ps.pop()
    if(!$.isNumeric(_idx)){
      ps.push(_idx)
    }else{
      this._data._lastIdx=_idx
    }
    for(var i=1;i<ps.length;i++){
      if(i==ps.length-1){
        _paths[_paths.length-1]._selected=true;
        _paths[_paths.length-1]._value=ps[i];
        _paths[_paths.length-1]._opened=false;
        break;
      }
      
      var os=_body.find(_JSHandler._prepareData(ps[i]).trim());
      for(var ii=_last;ii<_paths.length;ii++){
        if(os.is(_paths[ii]._dom)){
          // if(_paths[ii+1]&&(os.is(_paths[ii+1]._dom) && $(_paths[ii+1]._dom).find(_body.find(ps[i+1])).length)){
          //   continue;
          // }
          _paths[ii]._selected=true;
          _paths[ii]._opened=false;
          _paths[ii]._value=ps[i];
          _last=ii+1;
          break;
        }
      }
    }

    _hideItems(_paths)
    return _paths;

    function _hideItems(ps){
      let s=[],_last,_pre
      for(var i=0;i<ps.length;i++){
        if(!ps[i]._selected&&!ps[i]._showHideItem){
          s.push(ps.splice(i--,1)[0])
        }else{
          if(_last&&s.length){
            _last._subHideItems=s
          }
          if(_last){
            _pre=_last
          }
          _last=ps[i]
          s=[]
        }
      }
      if(_pre&&_pre._subHideItems&&_pre._subHideItems.length){
        let i=3,_idx=ps.indexOf(_pre);
        while(i--&&_pre._subHideItems.length){
          ps.splice(_idx+1,0,_pre._subHideItems.pop())
        }
        if(!_pre._subHideItems.length){
          _pre._subHideItems=0
          _pre._showHideItem=1
        }
      }
    }
  },
  _showHiddenSubItems:function(o){
    let _idx=o._idx
    o._item._subHideItems.forEach(function(x){
      _bzDomPicker._data._items.splice(++_idx,0,x)
      x._showHideItem=1
    })
    o._item._subHideItems=null
  },
  _resetLastIdx:function(_force){
    if(!_force&&!_bzDomPicker._data._autoRefresh){
      return
    }
    
    _bzDomPicker._pdb._showSlowInfo=0
    _bzDomPicker._pdb._showResetInfo=1
    // _bzDomPicker._pdb._refreshShowList=0
    clearTimeout(_bzDomPicker._resetListIdxTimer)
    _bzDomPicker._resetListIdxTimer= setTimeout(function(){
      var v="",d=[],_lastDom=null,i;
      for(var i=1;i<_bzDomPicker._data._items.length;i++){
        var o=_bzDomPicker._data._items[i];
        if(o._selected){
          v+=" "+o._value;
          d.push(o._value)
          _lastDom=o._dom;
        }
      }
      _bzDomPicker._data._lastIdx="ERR";
      if(_lastDom){
        d.unshift(_bzDomPicker._data._items[0]._dom)
        var os=_Util._findDoms(d)
        if(os){
          var i=os.index?os.index(_lastDom):os.indexOf(_lastDom);;
          if(i>=0){
            _bzDomPicker._data._lastIdx=i;
          }
        }
      }
      _bzDomPicker._testPath();
       _bzDomPicker._pdb._refreshShowList=1
    },20)
  },
  _createTmpCover:function(_doc,bErr, _multiple){
    var o = null;
    _doc=_doc || document

    this._tmpBox = _doc.createElement("div");

    var s="position:fixed;border:1px solid "+(_innerWin._data._tools._inDark?'#FFF':'#007bff')+";filter:alpha(opacity=20);cursor:pointer;z-index:2147483646;";
    if (!_multiple){
      s+="box-shadow: 2px 2px 9px rgba(255, 255, 255, 1);"
    }
    let _tag=_multiple?"div":"canvas"

    this._tmpBox.innerHTML=`<${_tag} class='${bErr?'Err':''}BZCover BZIgnore' style='${s}background-color:rgb(255,105, 105,0.2);' title='${_bzMessage._method._rightClickToCancel}'></${_tag}>`;

    o=this._tmpBox.childNodes[0];

    $(o).insertAfter(_doc.body);
    _bzDomPicker._setMousedown(o);
    return o;
  },
  _removeTmpCover:function(){
    try{
      $(".BZCover,.ErrBZCover").remove();

      $(BZ.TW.document).find("IFRAME").each(function(i,o){
        try{
          if(!o.src.startsWith("http")){
            $(o.contentDocument).find(".BZCover,.ErrBZCover").remove()
          }
        }catch(e){}
      });
      $(BZ.TW.document).find(".BZCover,.ErrBZCover").remove();
    }catch(e){}
  },
  _resetPos:function(cs){
    for(var i=0;i<cs.length;i++){
      var c=cs[i]
      _bzDomPicker._setTmpCoverPosByDom(c.o,c)
    }
  },
  _setTmpCoverPosByDom:function(o,c){    
    if(!c || !o){
      return;
    }else if(window.name!="bz-master" && BZ.TW && BZ.TW.document && (o==BZ.TW || o==BZ.TW.document)){
      o=BZ.TW.document.body;
    }else if(window.extensionContent && o.tagName=="IFRAME" && o.src.startsWith("http")){
      return;
    }
    if(o.tagName=="IFRAME"){
      return;
    }
    c.o=o;
    c._orgDom=o;
    
    // if(c.tagName=="CANVAS"){
      // if(!["SELECT","BUTTON","A","INPUT","TEXTAREA"].includes(o.tagName)){
      //   $(o).attr("tabindex",0)
      //   o.focus()
      //   o.removeAttribute("tabindex")
      // }
      // o.focus()

    // }
    //$(c).insertAfter(document.body);
    // if(!BZ._isRecording()){
    //   _Util._focusElement(o);
    // }
    o.ownerDocument.body.appendChild(c);
    if(o.tagName=="INPUT"&&o.type=="file"){
      o=o.parentElement
    }
    var xy = _Util._getDomXY(o),w,h;
    c.style.top=xy.y+"px";
    c.style.left=xy.x+"px";
    if(o.offsetWidth===undefined){
      w=o.getBoundingClientRect().width
    }else if(o.offsetWidth>0){
      w=o.offsetWidth
    }else{
      w=(o.getBoundingClientRect().width||10)
    }
    if(o.offsetHeight===undefined){
      h=o.getBoundingClientRect().height
    }else if(o.offsetHeight>0){
      h=o.offsetHeight
    }else{
      h=(o.getBoundingClientRect().height||10)
    }
    if(c.tagName=="CANVAS"){
      c.width=w
      c.height=h
      // c.attributes.tabIndex=100
      // c.focus()
    }else{
      c.style.width=w+"px"
      c.style.height=h+"px"
    }
    if(o.tagName=="CANVAS"&&o.bzTxtElement){
      c.style.top=parseFloat(c.style.top)+o.bzTxtElement.y+"px";
      c.style.left=parseFloat(c.style.left)+o.bzTxtElement.x+"px";
      c.bzTxtElement=o.bzTxtElement
      if(_bzDomPicker._curRequire){
        c.width=o.bzTxtElement.w
        c.height=o.bzTxtElement.h
        o.bzTxtElement=0
      }else{
        c.style.width=o.bzTxtElement.w+"px"
        c.style.height=o.bzTxtElement.h+"px"
      }
      // c.style.marginTop="7px"
    }
    $(c).show();

    clearTimeout(window.bzScrollSetTime)
    window.bzScrollSetTime=setTimeout(function(){
      
      $(window).unbind("scroll")
      $(window).unbind("resize")
      $(window).scroll(_bzDomPicker._scrollSync)
      $(window).resize(_bzDomPicker._scrollSync)
      if(_Util._isBZTWOpened()){
        $(BZ.TW).unbind("scroll")
        $(BZ.TW).unbind("resize")
        $(BZ.TW).scroll(_bzDomPicker._scrollSync)
        $(BZ.TW).resize(_bzDomPicker._scrollSync)
      }
      $(c.ownerDocument).find("*").unbind("scroll")
      $(c.ownerDocument).find("*").scroll(_bzDomPicker._scrollSync)
    },1000);
  },
  _flashMutipleTmpCover:function(_path){
    if(_path.constructor==String){
      _path=["BZ.TW.document",_path]
    }
    if(!window.extensionContent && BZ._hasExtension()){
      return bzComm.postToAppExtension({
        fun:"_flashMutipleTmpCover",
        scope:"_bzDomPicker",
        ps:[_path]
      });
    }
    _bzDomPicker._removeTmpCover();
    let os=_Util._findDoms(_path)
    _bzDomPicker._showTmpCover(os,0,0,1)
  },
  //os: elements, t, flash times, _fun: update cover and element, 
  _showTmpCover:function(os,t,_fun,_keep){
    os=(os||[]).filter(x=>x)

    var _elementPath=0;
    if(!window.extensionContent){
      _elementPath=os[0]
      if(!_elementPath){
        return
      }
      
      os.forEach((o,i)=>{
        if(o.constructor==Array){
          os[i]=_aiPageHandler._updateElementPathByDemoValue(o,0,1)
        }else{
          o.path=o.path||o.element
          os[i].path=_aiPageHandler._updateElementPathByDemoValue(o.path,0,1);
          (os[i].panels||[]).forEach((p,n)=>{
            os[i].panels[n]=_aiPageHandler._updateElementPathByDemoValue(p,0,1)
          })
        }
      })
      if(_elementPath.constructor==Array){
        _elementPath=_elementPath[0]
      }else{
        _elementPath=_elementPath.path[0]
      }
    }
    if(!window.extensionContent){
      os=os.filter(x=>!_ideActionManagement._isInBZComponent(x))
      if(!os.length){
        return
      }
      return bzComm.postToAppExtension({
        fun:"_showTmpCover",
        scope:"_bzDomPicker",
        ps:[os]
      });
    }
    if(!_keep){
      _bzDomPicker._removeTmpCover()
    }
    var cs=[];
    _bzDomPicker._noteInfo=""
    for(var i=0;i<os.length;i++){
      let o=os[i];
      if(o.constructor==Array){
        o=$util.findDom(o)
      }else if(o.constructor==Object&&o.path){
        if(!_Util._isEmpty(o.panels)){
          o=_Util._findDomWithPanels(o.path,o.panels)
        }else{
          o=$util.findDom(o.path)
        }
      }
      if(!o){
        continue
      }
      if(_Util._isHidden(o)){
        if(os.length==1){
          _bzDomPicker._noteInfo=_bzMessage._picker._hiddenElement
        }
        let ro=o.getBoundingClientRect();
        if(!ro.width&&!ro.height){
          continue
        }
      }
      let c=this._createTmpCover(o.ownerDocument, 0, 1);
      $(c).click(function(e){
        if(e.target==this&&!this.children.length){
          _bzDomPicker._removeTmpCover()
        }else if(e.target.innerText){
          _bzDomPicker._copyElementPath(e.target.parentElement._orgDom)
        }
      })
      $(c).mouseover(function(e){
        if(_bzDomPicker._curRequire){
          _bzDomPicker._setMousedown(this)
        }
      })
      this._setTmpCoverPosByDom(o,c);
      if(!t&&_fun){
        _fun(o,c)
      }
      cs.push(c);
    }
    if(t&&!_keep){
      setTimeout(function(){
        _bzDomPicker._removeTmpCover()
        setTimeout(function(){
          _bzDomPicker._showTmpCover(os,t-1,_fun);
        },100)
      },500);
    }
    return cs;
  },
  _copyElementPath:function(o){
    _Util._copyData({
      level:"element",
      items:_cssHandler._findPath(o),
      time:Date.now()
    })
  },
  //d:{_path, offset}
  _showOffset:function(d){
    if(!window.extensionContent){
      d={
        _element:_Util._clone(d._element),
        _offset:d._offset
      }
      _aiPageHandler._updateElementPathByDemoValue(d._element)
      return bzComm.postToAppExtension({
        fun:"_showOffset",
        scope:"_bzDomPicker",
        ps:[d]
      });
    }
    let c=_bzDomPicker._flashTmpCover(d._element,1)
    if(!c){
      return
    }
    let s=_bzDomPicker._createTmpCover(c.ownerDocument);
    let r=c.getBoundingClientRect()
    let p=_bzDomPicker._getOffsetPoint({
      x:r.left,
      y:r.top,
      h:r.height,
      w:r.width
    },d._offset)
    let cp={
      left:p.x-5+"px",
      top:p.y-5+"px",
      width:"11px",
      height:"11px",
      borderRadius:"5px",
      display:"block"
    }
    c.ownerDocument.body.appendChild(s);
    
    $(s).css(cp)
    $(s).click(function(){this.remove()})
  },
  //o: offset
  _getOffsetPoint:function(r,o){
    console.log("set offset: ",r,o)
    
    switch(o.origin){
      case "mc":
        r= {x:r.x+r.w/2,y:r.y+r.h/2}
        break
      case "lt":
        r={x:r.x,y:r.y}
        break
      case "t":
        r={x:r.x+r.w/2,y:r.y}
        break
      case "rt":
        r={x:r.x+r.w,y:r.y}
        break
      case "r":
        r={x:r.x+r.w,y:r.y+r.h/2}
        break
      case "rb":
        r={x:r.x+r.w,y:r.y+r.h}
        break
      case "b":
        r={x:r.x+r.w/2,y:r.y+r.h}
        break
      case "lb":
        r={x:r.x,y:r.y+r.h}
        break
      case "l":
        r={x:r.x,y:r.y+r.h/2}
    }
    return {
      x:parseInt(r.x)+parseInt(o.X),
      y:parseInt(r.y)+parseInt(o.Y)
    }
  },
  _flashTmpCover:function(d,_chkCode){
    if(!d){
      return
    }

    if(bzComm._isIDE()){
      if(d.constructor==Object){
        if(_ideActionManagement._isInBZComponent(d)){
          return
        }
        d={...d}
        if(d.path){
          d.path=_aiPageHandler._updateElementPathByDemoValue([...d.path],0,1)
          d.panels=_aiPageHandler._updateElementPathByDemoValue([...d.panels],0,1)
        }
      }else if(d.constructor==String){
        d=["BZ.TW.document",d]
      }
      bzComm.postToAppExtension({
        fun:"_flashTmpCover",
        scope:"_bzDomPicker",
        ps:[d],
      })
      return
    }

    _bzDomPicker._removeTmpCover();
    var o;
    if(d.constructor==Object&&d.path){
      o=_Util._findDomWithPanels(d.path,d.panels)
    }else if(d.constructor!=Array&&d.element){
      if(d.multipleElement){
        return _bzDomPicker._flashMutipleTmpCover(d.element.filter(x=>!$.isNumeric(x)))
      }else{
        o=_domActionTask._findElement(d)
      }
    }else if(d.constructor==Array){
      o=$util.findDom(d);
    }else{
      o=d;
    }

    if(o){
      var c=this._createTmpCover(o.ownerDocument);
      $(c).click(function(){
        $(this).remove()
      })
      _Util._focusElement(o)

      this._setTmpCoverPosByDom(o,c);

      if(d&&d.event){
        var ctx = c.getContext("2d");
        if(d.event.action=="dragdrop"&&d.event.element&&o.tagName!="CANVAS"){
          let o1=o.getBoundingClientRect()
          let o2=$util.findDom(d.event.element)
          if(o2){
            this._setTmpCoverPosByDom(BZ.TW.document.body,c);
            o2=o2.getBoundingClientRect()
            _Util._drawArrow(ctx,(o1.left+o1.right)/2,(o1.top+o1.bottom)/2,(o2.left+o2.right)/2,(o2.top+o2.bottom)/2)
            return
          }
        }
        if(d.event.action=="drag"){
          d=d.event
          setTimeout(()=>{
            ctx.beginPath();
            let x1=d.x,y1=d.y,
                x2=d.moveToX,y2=d.moveToY;
            
            ctx.arc(x1, y1,5, 0, 2 * Math.PI);
            ctx.fillStyle = "blue";

            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(x2, y2,3,0, 2 * Math.PI);
            ctx.fillStyle = "red";
            ctx.fill();
            ctx.strokeStyle="red"
            _Util._drawArrow(ctx,d.x,d.y,d.moveToX,d.moveToY)
          },10)
        }
      }
      setTimeout(function(){
        if(!_bzDomPicker._domPickerWindow || _bzDomPicker._domPickerWindow.closed){
          if(_bzDomPicker._curRequire){
            $(c).remove();
          }
        }
      },1000);
    }
    return c
  },
  _setErrCoverPosByDom:function(o){
    var c = this._createTmpCover(o.ownerDocument,true);
    this._setTmpCoverPosByDom(o,c);
    return c;
  },
  _pickPath:function(e){
    this._removeTmpCover();
    var _path=this._getFinalPaths();
    _bzDomPicker._curDom=$util.findDom(_path);
    _bzDomPicker._curRequire._back(_path,this._data._pos,_bzDomPicker._curDom);
    _bzDomPicker._endRequire();
    if(this._domPickerWindow){
      this._domPickerWindow.opener.focus();
      this._domPickerWindow.close();
    }else if(e){
      e.target.ownerDocument.defaultView.close()
    }
  },
  _getFinalPaths:function(){    
    var _paths=[];
    for(var i=0;this._data._items&&i<this._data._items.length;i++){
      var v=this._data._items[i];
      if (v._selected&&v._value) {
        _paths.push(v._value);
      }
    }
    if(_paths.length){
      _paths.push(this._data._lastIdx);
    }
    _bzDomPicker._data._fullPath=_paths
    return _paths;
  },
  _testPath:function(_fun){
    try{
      this._removeTmpCover();
      let _path=this._getFinalPaths()

      _bzDomPicker._pdb._showResetInfo=0
      var t=Date.now()
      var o = $util.findDom(_path);
      _bzDomPicker._pdb._showSlowInfo=Date.now()-t+"ms"
    }catch(e){
    }
  },
  _cancel:function(e){
    _bzDomPicker._endRequire()
    _bzDomPicker._domPickerWindow&&_bzDomPicker._domPickerWindow.close()
  },
  _reSelect:function(){
    _bzDomPicker._removeTmpCover();
    var a=this._curRequire,v=this._data._filter;
    _bzDomPicker._preType=a._type
    if(v){
      a._type=`${v},:endContains(${v}),:attr(value=${v})`;
    }else{
      a._type=v
    }
    a._filter=v
    _bzDomPicker._start(a);
  },
  _setFocusItem:function(o){
    _bzDomPicker._data._focusItem=o
    _bzDomPicker._flashTmpCover(o._dom)

    let vs=[],s=[],ss=[]
    o._options=vs
    o._idxOptions=[]
    
    if(o._value){
      let v=o._value.replace(/^[a-z]+/i,"")
      let g="",cs="",lk,_skip
      for(let i=0;i<v.length;i++){
        let c=v[i]
        if(_skip){
          cs+=c
          _skip=0
          continue
        }
        if(c=="\\"){
          cs+=c
          _skip=1
          continue
        }
        if(g.includes(c)){
          if(!v[i+1]||".#".includes(lk)||".#[:".includes(v[i+1])){
            if(")]".includes(g)){
              cs+=c
            }else{
              i--
            }
            s.push(cs)
            g=cs=""
            continue
          }
        }
        if(c==":"){
          if(!g){
            g=")"
            lk=c
          }
        }else if(c=="."){
          if(!g){
            g="#:[."
            lk=c
          }
        }else if(c=="#"){
          if(!g){
            g=".:["
            lk=c
          }
        }else if(c=="["){
          if(!g){
            g="]"
            lk=c
          }
        }
        cs+=c
      }
      if(cs){
        s.push(cs)
      }
    }
    
    let os=$(document.body)
    _bzDomPicker._data._items.find((x,i)=>{
      if(x._selected&&i){
        if(x==o){
          x=x._value.replace(/\:(eq\([0-9]+\)|last|first)$/,"")
          os=os.find(x)
          return 1
        }else{
          os=os.find(x._value)
        }
      }
      if(x==o){
        return 1
      }
    })
    os=os.toArray()
    let xos=[]
    while(os.length){
      let oo=os.shift()
      _Util._spliceAll(os,x=>$(x).find(oo).length)
      xos.push(oo)
    }
    o._idxOptions.push(":eq("+xos.indexOf(o._dom)+")")
    if(xos[0]==o._dom){
      o._idxOptions.push(":first")
    }
    if(xos[xos.length-1]==o._dom){
      o._idxOptions.push(":last")
    }

    s.find((x,j)=>{
      if(x[0]==":"){
        if(!x.match(/^\:(eq|first|last|attr|Attr)\(/)){
          let i=x.indexOf("(")
          if(i>0){
            o._textType=x.substring(0,i)
            o._textValue=x.substring(i+1,x.length-1)
            s.splice(j,1)
            return 1
          }
        }
      }
    })
    s.find((x,i)=>{
      if(o._idxOptions.includes(x)){
        o._index=x
        s.splice(i,1)
        return 1
      }
    })

    o=o._dom
    
    _bzDomPicker._getElementOptions(o,vs)

    s.forEach(x=>{
      if(!vs.find(y=>{
        if(y._value==x){
          y._chk="on"
          return 1
        }
      })){
        ss.push(x)
      }
    })
  },
  _getElementOptions:function(o,vs){
    vs=vs||[]
    if(o.id){
      vs.push({_value:"#"+_Util._toJQueryValue(o.id)})
    }
    
    if(o.classList.length){
      for(let k of o.classList){
        vs.push({_value:"."+_Util._toJQueryValue(k)})
      }
    }
    
    for(let i=0;i<o.attributes.length;i++){
      let a=o.attributes[i]
      if(!a.name.match(/^(id|class|style|on.+|bz-app-touchable)$/)&&a.value){
        vs.push({_value:`:attr(${a.name}=${a.value})`})
      }
    }
    return vs   
  },
  _setValue:function(o){
    o=o||_bzDomPicker._data._focusItem
    let v=o._dom.tagName

    if(o._textType){
      v+=o._textType+"("+o._textValue+")"
    }
    o._options.forEach(x=>{
      if(x._chk){
        v+=x._value
      }
    })
    o._idxOptions.find(x=>{
      if(x._chk){
        v+=x._value
        return 1
      }
    })
    v+=_bzDomPicker._data._focusItem._index||""

    o._value=v
    _bzDomPicker._resetLastIdx()
  },
  _getItemView:function(_button,_dataRepeat){
    return {
      _tag:"pre",
      _attr:{
        style:"white-space: nowrap;word-break: break-all;margin:0;line-height: 20px;",
        class:function(d){
          if(d._item._selected){
            return "bz-ui-switch active"
          }
        }
      },
      _dataRepeat:_dataRepeat,
      _items:[
        //switcher
        {
          _if:function(d){
            return _button&&_bzDomPicker._hasChild(d._item)
          },
          _tag:"button",
          _attr:{
            class:"btn bz-small-btn",
            style:"background: transparent;"
          },
          _text:function(d){
            return d._item._showChildren?'-':'+'
          },
          _jqext:{
            click:function(){
              this._data._item._showChildren=!this._data._item._showChildren
            }
          }
        },
        //node text
        {
          _tag:"span",
          _attr:{
            "class":function(d){
              let c="item";
              if(_bzDomPicker._data._focusItem==d._item){
                c+=" bz-focus-item"
              }else if(d._item._dom.tagName){
                c+=" disabled"
              }

              return c
            },
            style:function(d){
              if(d._item._dom.constructor!=String){
                return "cursor:pointer !important"
              }else{
                return "cursor:default !important"
              }
            }
          },
          _text:function(d){
            return _bzDomPicker._getDomDesc(d._item)
          },
          _jqext:{
            click:function(){
              if(this._data._item._dom.constructor!=String){
                _bzDomPicker._setFocusItem(this._data._item)
              }
            },
            dblclick:function(){
              if(this._data._item._dom.constructor!=String){
                _bzDomPicker._selectItem(this._data._item)
              }
            }
          }
        },
        {
          _if:function(d){
            return d._item._subHideItems
          },
          _tag:"button",
          _attr:{
            style:function(d){
              let c="background:transparent;border: var(--bz-border);width: 30px;white-space: nowrap;border-radius: 5px;padding: 0;height: 10px;color: #999;cursor: pointer;display: block;margin: 2px 18px;"
              c+="margin-left:"+(d._idx+1)*8+"px"
              return c
            },
            title:"_bzMessage._picker._showSubItems"
          },
          _items:[
            {
              _tag:"span",
              _attr:{
                style:"position: relative;top: -13px;font-size: 20px;"
              },
              _text:"..."
            }
          ],
          _jqext:{
            click:function(){
              _bzDomPicker._showHiddenSubItems(this._data)
            }
          }
        }
      ]
    }
  },
  _selectItem:function(o){
    let os=_bzDomPicker._data._items,
        oo=os[os.length-1]
    _bzDomPicker._setFocusItem(o)
    o._selected=true
    if(!os.includes(o)){
      if(oo._siblings&&oo._siblings.includes(o)){
        os.pop()
      }
      os.push(o)
      os.forEach(x=>{
        x._showChildren=0
        x._showSibling=0
      })
    }

    setTimeout(()=>{
      _bzDomPicker._setValue()
    },100)

  },
  _generatePath:function(){
    let p=_bzDomPicker._getFinalPaths(),_best,_suggestion;
    if($.isNumeric(p[p.length-1])||p[p.length-1]=="ERR"){
      p.pop()
    }
    let o=_bzDomPicker._data._focusItem;
    let a=_IDE._data._curAction
    if(a){
      if(a.type==1){
        if(a.event.type=="mouse"){
          _suggestion=":text"
        }else{
          _suggestion=":input"
        }
      }else if(a.type==0||a.type==2){
        if(_cssHandler._isPanel(o._dom)){
          _suggestion=":panel"
        }else{
          _suggestion=":data"
        }
      }
    }
    let _text=o._textValue||_descAnalysis._retrieveTextForElementPathItem(_cssHandler._findPath(o._dom))
    let ms=_Util._clone(_bzDomPicker._textMethods)

    if(_text){
      _findBest(ms,function(){
        if(_best){
          o._textValue=_text;
          o._value=o._dom.tagName+_best.x+"("+_text+")";
          _bzDomPicker._data._focusItem._textType=_best.x
          _bzDomPicker._data._lastIdx=_best._idx
          _bzDomPicker._pdb._showSlowInfo=_best._time+"ms"
          _bzDomPicker._getFinalPaths()
        }
        _bzDomPicker._data._tmpInfo=_bzMessage._common._done
      })
    }


    function _findBest(ms,_fun){
      if(ms.length){
        setTimeout(()=>{
          let x=ms.shift()
          try{
            if(!x||(x==":panel"&&_suggestion!=":panel")){
              return _findBest(ms,_fun)
            }
            _bzDomPicker._data._tmpInfo=x
            p.pop();
            p.push(o._dom.tagName+x+"("+_text+")")
            let _time=Date.now(),
                os=_Util._findDoms(p)||[]
                
            _time=Date.now()-_time
            if(os.toArray){
              os=os.toArray()
            }
            let _idx=os.indexOf(o._dom)
            if(_idx>-1){
              if(!_best){
                _best={
                  _size:os.length,
                  x:x,
                  _idx:_idx,
                  _time:_time
                }
              }else if(_best._idx>_idx||(_best._idx==_idx&&_best._size>os.length)){
                _best._size=os.length
                _best.x=x
                _best._idx=_idx
                _best._time=_time
              }else if(_best._idx==_idx&&_best._time>_time){
                if(_best.x==_suggestion&&_best._time-_time<100){
                  return _findBest(ms,_fun)
                }
                _best._size=os.length
                _best.x=x
                _best._time=_time
              }else if(x==_suggestion){
                if(_best._idx==_idx&&_time-_best._time<100){
                  _best.x=x
                  _best._time=_time
                  _best._size=os.length
                }
              }
            }
          }catch(ex){
            
          }
          return _findBest(ms,_fun)
        },100)
      }else{
        _fun()
      }
    }
  }
};


var _pickerTemplate={
  _if:"_bzDomPicker._pdb._refreshShowList",
  _tag:"div",
  _attr:{
    "class":"dom-picker"
  },
  _items:[
    {
      _if:"_bzDomPicker._noteInfo",
      _tag:"div",
      _attr:{
        class:"bz-dom-picker-noteinfo bz-warning"
      },
      _items:[
        {
          _tag:"span",
          _text:"_bzDomPicker._noteInfo"
        },
        {
          _tag:"button",
          _attr:{
            class:"btn btn-none btn-icon bz-close bz-small-btn bz-left-space-10",
          },
          _jqext:{
            click:function(){
              _bzDomPicker._noteInfo=""
              this.parentElement.remove()
            }
          }
        }
      ]      
    },
    {
      _tag:"div",
      _attr:{
        class:"disable-select",
        style:"display:flex;position:absolute;left:0px;right:0px;top:0px;bottom:90px;"
      },
      _items:[
        //list
        {
          _tag:"div",
          _attr:{
            style:"flex:1;margin-right: 5px;width: 50%;background: var(--editor-background-color);height: 100%;"
          },
          _items:[
            {
              _tag:"ul",
              _attr:{
                style:"font-size:13px;background-color: var(--editor-background-color);margin: 5px;padding:7px;list-style-type:none;height: calc(100% - 25px);overflow: auto;"
              },
              _after:function(o){
                setTimeout(()=>{
                  o.scrollTop=o.scrollHeight
                },100)
              },
              _items:[
                {
                  _tag:"li",
                  _attr:{
                    class:"row",
                    style:function(d){
                      let i=d._idx;
                      if(_bzDomPicker._hasChild(d._item)){
                        i-=1
                      }
                      let c= "text-indent:"+(i*8)+"px;"
                      
                      return c
                    }
                  },
                  _items:[
                    _bzDomPicker._getItemView(1),
                    {
                      _if:function(d){
                        return d._item._showChildren
                      },
                      _tag:"div",
                      _attr:{
                        style:"margin-left:20px;margin-top: 5px;color:#999;"
                      },
                      _items:[
                        _bzDomPicker._getItemView(0,function(d){
                          if(!d._item._children||!d._item._children.length){
                            let os=_CtrlDriver._buildProxy([])
                            d._item._children=os
                            for(let o of d._item._dom.children){
                              os.push({
                                _dom:o,
                                _value:"",
                                _showChildren:false,
                                _selected:false,
                                _children:[]
                              })
                            }
                            if(os.length==1){
                              let oo=_bzDomPicker._data._items[_bzDomPicker._data._items.length-1]
                              oo._showSibling=0
                              oo._showChildren=0
                              _bzDomPicker._data._items.push(os[0])
                              return
                            }
                          }
                          return d._item._children
                        })
                      ]
                    }
                  ],
                  _dataRepeat:"_bzDomPicker._data._items"
                },
                {
                  _if:"_bzDomPicker._hasSibling()",
                  _tag:"div",
                  _attr:{
                    style:"'text-indent:'+(_bzDomPicker._data._items.length*8-8)+'px;color:#999;line-height: 15px;'"
                  },
                  _items:[
                    {
                      _if:"!_bzDomPicker._data._items[_bzDomPicker._data._items.length-1]._showSibling",
                      _tag:"a",
                      _attr:{
                        class:"bz-clickable bz-left-space-10"
                      },
                      _text:"_bzMessage._picker._showSibling",
                      _jqext:{
                        click:function(){
                          _bzDomPicker._data._items[_bzDomPicker._data._items.length-1]._showSibling=1
                        }
                      }
                    },
                    {
                      _if:"_bzDomPicker._data._items[_bzDomPicker._data._items.length-1]._showSibling",
                      _tag:"div",
                      _items:[
                        _bzDomPicker._getItemView(0,function(){
                          let d=_bzDomPicker._data._items[_bzDomPicker._data._items.length-1];
                          if(!d._siblings){
                            let os=_CtrlDriver._buildProxy([])
                            d._siblings=os
                            for(let o of d._dom.parentElement.children){
                              if(o!=d._dom){
                                os.push({
                                  _dom:o,
                                  _value:"",
                                  _showChildren:false,
                                  _selected:false,
                                  _children:[]
                                })
                              }
                            }
                          }
                          return d._siblings
                        })
                      ]
                    }
                  ]
                },
                {
                  _tag:"div",
                  _attr:{
                    style:"height:20px;"
                  }
                },
                //missing element info
                {
                  _if:"!_bzDomPicker._data._items||!_bzDomPicker._data._items.length",
                  _tag:"div",
                  _items:[
                    {
                      _html:function(){
                        return "<pre>"+_Util._formatMessage(_bzMessage._action._notFoundElement,JSON.stringify(BZ._data._uiSwitch._tmpPath))+"\n\n</pre>"
                      }
                    },
                    {
                      _tag:"div",
                      _items:[
                        {
                          _tag:"span",
                          _text:"_bzMessage._method._click"
                        },
                        {
                          _tag:"button",
                          _attr:{"class":"btn btn-none btn-icon bz-dompicker bz-small-btn"},
                          _jqext:{
                            click:function(){
                              _bzDomPicker._data._filter='';
                              _bzDomPicker._reSelect()
                            }
                          }
                        },
                        {
                          _tag:"span",
                          _text:"_bzMessage._action._reselect"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        //Details panel
        {
          _tag:"div",
          _attr:{
            style:"flex:1;font-size:13px;background-color: var(--editor-background-color);overflow:auto;list-style-type:none;width: 50%;"
          },
          _items:[
            {
              _if:"_bzDomPicker._data._focusItem",
              _tag:"div",
              _attr:{
                style:"padding:1rem;height: calc(100% - 2rem);display: flex;flex-direction: column;"
              },
              _update:function(){
                _bzDomPicker._setValue()
              },
              _items:[
                {
                  _tag:"div",
                  _items:[
                    //checkbox
                    {
                      _tag:"label",
                      _attr:{
                        style:"display: flex;margin-left:11px;width: calc(100% - 30px);"
                      },
                      _items:[
                        {
                          _tag:"input",
                          _attr:{
                            type:"checkbox",
                            // value:true,
                            class:function(d){
                              return !d._idx?'pull-left':''
                            }
                          },
                          _jqext:{
                            change:function(){
                              var _this=this;
                              setTimeout(function(){
                                let o=_bzDomPicker._data._focusItem
                                    
                                if(o._selected){
                                  _bzDomPicker._selectItem(o)
                                }else{
                                  o._value="";
                                  _bzDomPicker._resetLastIdx();
                                }
                              },1);
                            }
                          },
                          _dataModel:"_bzDomPicker._data._focusItem._selected"
                        },
                        {
                          _tag:"span",
                          _attr:{
                            class:"bz-nowrap",
                            style:"top: -3px;position: relative;font-family: monospace;"
                          },
                          _items:[
                            {
                              _text:"_bzMessage._action._assignToPath+': '"
                            },
                            {
                              _tag:"b",
                              _text:"_bzDomPicker._getDomDesc()"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      _if:"_bzDomPicker._data._items.includes(_bzDomPicker._data._focusItem)",
                      _tag:"button",
                      _attr:{
                        class:"btn btn-none btn-icon bz-cross bz-small-btn pull-right",
                        style:"margin-top:-15px;"
                      },
                      _jqext:{
                        click:function(){
                          _bzDomPicker._data._items.splice(_bzDomPicker._data._items.indexOf(_bzDomPicker._data._focusItem))
                        }
                      }
                    }
                  ]
                },
                //attributes panel
                {
                  _tag:"fieldset",
                  _attr:{
                    style:"flex:1;overflow:auto;margin: 10px 0;",
                    class:"bz-setting-group"
                  },
                  _items:[
                    {
                      _tag:"legend",
                      _text:"_bzMessage._action._attrList"
                    },
                    {
                      _tag:"div",
                      _attr:{
                        class:"col-xs-12"
                      },
                      _items:[
                        {
                          _tag:"label",
                          _attr:{
                            style:"display:block;",
                            class:"bz-nowrap"
                          },
                          _items:[
                            {
                              _tag:"input",
                              _attr:{
                                disabled:"!_bzDomPicker._data._focusItem._selected",
                                type:"checkbox"
                              },
                              _dataModel:function(d){
                                return "_bzDomPicker._data._focusItem._options["+d._idx+"]._chk"
                              },
                            },
                            {
                              _text:function(d){
                                return d._item._value
                              }
                            }
                          ]
                        }
                      ],
                      _dataRepeat:function(){
                        let o=_bzDomPicker._data._focusItem
                        return o?o._options:[]
                      }
                    }
                  ]
                },
                //text method
                {
                  _if:"_bzDomPicker._data._focusItem._selected",
                  _tag:"div",
                  _attr:{
                    class:"input-group"
                  },
                  _items:[
                    {
                      _tag:"label",
                      _attr:{
                        class:"input-group-addon"
                      },
                      _text:"_bzMessage._common._method"
                    },
                    {
                      _tag:"select",
                      _attr:{
                        class:"form-control"
                      },
                      _dataModel:"_bzDomPicker._data._focusItem._textType",
                      _items:[
                        {
                          _tag:"option",
                          _attr:{
                            value:function(d){
                              return d._item
                            }
                          },
                          _text:function(d){
                            return _bzMessage._picker._textOptions[d._item]
                          },
                          _dataRepeat:function(){
                            let vs=_bzDomPicker._textMethods
                            let o=_bzDomPicker._data._focusItem._dom
                            for(let n of o.childNodes){
                              if(n.nodeType==3&&n.textContent){
                                return vs
                              }
                            }
                            
                            if(o.innerText.trim()){
                              return vs
                            }else{
                              return _bzDomPicker._methods
                            }

                          }
                        }
                      ]
                    }
                  ]
                },
                //text
                {
                  _if:"_bzDomPicker._data._focusItem._selected",
                  _tag:"div",
                  _attr:{
                    class:"input-group"
                  },
                  _items:[
                    {
                      _tag:"label",
                      _attr:{
                        class:"input-group-addon"
                      },
                      _text:"_bzMessage._picker._text"
                    },
                    {
                      _tag:"input",
                      _attr:{
                        class:"form-control",
                        style:"width:100% !important;"
                      },
                      _dataModel:"_bzDomPicker._data._focusItem._textValue"
                    }
                  ]
                },
                //index
                {
                  _if:"_bzDomPicker._data._focusItem._selected",
                  _tag:"div",
                  _attr:{
                    class:"input-group"
                  },
                  _items:[
                    {
                      _tag:"label",
                      _attr:{
                        class:"input-group-addon",
                        style:"min-width:45px",
                      },
                      _text:"_bzMessage._picker._index"
                    },
                    {
                      _tag:"select",
                      _attr:{
                        class:"form-control"
                      },
                      _dataModel:"_bzDomPicker._data._focusItem._index",
                      _items:[
                        {
                          _tag:"option"
                        },
                        {
                          _tag:"option",
                          _attr:{
                            value:function(d){
                              return d._item
                            }
                          },
                          _text:function(d){
                            return d._item
                          },
                          _dataRepeat:"_bzDomPicker._data._focusItem._idxOptions"
                        }
                      ]
                    }
                  ]
                },
                {
                  _if:"_bzDomPicker._data._focusItem._selected",
                  _tag:"div",
                  _items:[
                    {
                      _if:function(){
                        let o=_bzDomPicker._data._focusItem
                        if(o._selected){
                          let os=_bzDomPicker._data._items.filter(x=>x._selected);
                          return os[os.length-1]==o
                        }
                      },
                      _tag:"button",
                      _attr:{
                        class:"btn btn-primary",
                        disabled:"!_bzDomPicker._data._focusItem._selected",
                        style:"margin-top:10px;"
                      },
                      _text:"_bzMessage._picker._generatePath",
                      _jqext:{
                        click:function(){
                          _bzDomPicker._generatePath()
                        }
                      }
                    },
                    {
                      _if:function(){
                        if(_bzDomPicker._data._tmpInfo){
                          setTimeout(()=>{
                            _bzDomPicker._data._tmpInfo=''
                          },2000)
                          return 1
                        }
                      },
                      _tag:"span",
                      _attr:{
                        style:"margin: 14px 20px;position: absolute;font-weight: bold;"
                      },
                      _text:"_bzMessage._cooperation._statusType.testing+': '+ _bzDomPicker._data._tmpInfo"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      _tag:"div",
      _attr:{
        style:"height:80px;position:absolute;left:0px;right:0px;bottom:0;display:flex;"
      },
      _items:[
        {
          _tag:"pre",
          _attr:{
            style:"font-size: 11px;flex:1;line-height: 20px;margin: 0 5px 0 0;overflow:auto;height:100%;"
          },
          _text:function(){
            return (_bzDomPicker._data._fullPath||[]).join('\n')
          }
        },
        {
          _tag:"div",
          _attr:{
            style:"flex:1;margin:0;display:flex;flex-direction:column;"
          },
          _items:[
            {
              _tag:"div",
              _attr:{
                style:"padding: 5px 10px;margin-bottom: 12px;"
              },
              _items:[
                {
                  _tag:"div",
                  _items:[
                    //unique
                    {
                      _if:function(){
                        return !_bzDomPicker._data._tmpInfo&&(!_bzDomPicker._data._lastIdx||_bzDomPicker._data._lastIdx=="0")
                      },
                      _tag:"span",
                      _attr:{
                        class:"pull-left bz-right-space-10"
                      },
                      _items:[
                        {
                          _tag:"div",
                          _attr:{
                            class:"bz-success pull-left",
                            style:"margin-top: 5px;"
                          }
                        },
                        {
                          _tag:"div",
                          _attr:{
                            class:"bz-dom-picker-note"
                          },
                          _text:"_bzMessage._action._unique"
                          
                        }
                      ]
                    },
                    //error
                    {
                      _if:function(){
                        return !_bzDomPicker._data._tmpInfo&&_bzDomPicker._data._lastIdx&&_bzDomPicker._data._lastIdx!="0"
                      },
                      _tag:"span",
                      _attr:{
                        class:"pull-left bz-right-space-10"
                      },
                      _items:[
                        {
                          _tag:"div",
                          _attr:{
                            class:"bz-dom-picker-note",
                            style:function(){
                              if(_bzDomPicker._data._lastIdx=="ERR"){
                                return "background-color:var(--bz-red);color:#FFF;padding:5px;border-radius:var(--bz-border-radius)"
                              }else{
                                return "background-color:var(--bz-yellow);color:#000;padding:5px;border-radius:var(--bz-border-radius)"
                              }
                            }
                          },
                          _text:function(){
                            if(_bzDomPicker._data._lastIdx=="ERR"){
                              setTimeout(()=>{
                                let v=_bzDomPicker._getFinalPaths()
                                v.pop()
                                v=_Util._findDoms(v)
                                v.forEach(x=>{
                                  _bzDomPicker._setErrCoverPosByDom(x)
                                })
                              })
                              return _bzMessage._picker._testFailed
                            }else{
                              return _bzMessage._action._noUnique+' (idx: '+_bzDomPicker._data._lastIdx+')'
                            }
                          }
                        }
                      ]
                    },
                    //speed
                    {
                      _if:"!_bzDomPicker._data._tmpInfo",
                      _tag:"span",
                      _attr:{
                        class:"pull-left bz-right-space-10 bz-dom-picker-note",
                        style:function(d){
                          let c=parseInt(_bzDomPicker._pdb._showSlowInfo)
                          if(c&&c<150){
                            c="background-color:transparent;color:var(--text-color);"
                          }else{
                            c="background-color:var(--bz-yellow);color:#000;padding:5px;border-radius:var(--bz-border-radius);"
                          }
                          return c
                        }
                      },
                      _items:[
                        {
                          _tag:"span",
                          _text:"_bzMessage._action._speed+': '"
                        },
                        {
                          _if:"_bzDomPicker._pdb._showSlowInfo",
                          _tag:"span",
                          _text:"_bzDomPicker._pdb._showSlowInfo"
                        },
                        {
                          _if:"!_bzDomPicker._pdb._showSlowInfo",
                          _tag:"button",
                          _attr:{
                            class:"btn bz-small-btn bz-loading btn-none btn-icon",
                          }
                        }
                      ]
                    }
                  ]
                },
                {
                  _tag:"div",
                  _attr:{
                    class:"pull-right",
                  },
                  _items:[
                    {
                      _tag:"a",
                      _text:"_bzMessage._picker._chkPath",
                      _attr:{
                        class:"bz-clickable pull-right",
                        style:"position: relative;top: 5px;font-size: 11px;"
                      },
                      _jqext:{
                        click:function(){
                          _bzDomPicker._resetLastIdx(1)
                        }
                      }
                    },
                    {
                      _tag:"label",
                      _attr:{
                        class:"pull-right",
                        style:"margin:5px 5px 5px 0px; font-size: 12px;"
                      },
                      _items:[
                        {
                          _tag:"input",
                          _attr:{type:"checkbox"},
                          _dataModel:"_bzDomPicker._data._autoRefresh"
                        },
                        {_text:"_bzMessage._picker._autoRefresh"}
                      ]
                    },
                  ]
                }
              ]
            },
            //buttons-panel
            {
              _tag:"div",
              _attr:{
                style:"flex:1;padding: 0 10px;"
              },
              _items:[
                //dom picker
                {
                  _tag:"button",
                  _attr:{
                    class:"btn btn-secondary btn-icon-text bz-dompicker"
                  },
                  _text:"_bzMessage._action._reselect",
                  _jqext:{
                    click:function(){
                      _bzDomPicker._data._filter='';
                      _bzDomPicker._reSelect()
                    }
                  }
                },
                //save
                {
                  _tag:"button",
                  _attr:{
                    "class":"btn btn-primary pull-right",
                    disabled:"_bzDomPicker._data._lastIdx=='ERR'"
                  },
                  _text:"_bzMessage._method._save",
                  _jqext:{
                    click:function(e){
                      _bzDomPicker._pickPath(e)
                    }
                  }
                },
                //close
                {
                  _tag:"button",
                  _attr:{
                    "style":"margin-right:30px;",
                    "class":"btn btn-secondary pull-right bz-right-space-10"
                  },
                  _text:"_bzMessage._method._close",
                  _jqext:{
                    click:function(e){
                      _bzDomPicker._cancel(e)
                    }
                  }
                }
              ]
            }

          ]
        }
      ]
    },
  ]
};
var _tipHandler={
  _doAfterComment:function(d){
    if(window.extensionContent){
      return bzComm.postToIDE({fun:"_doAfterComment",scope:"_tipHandler",ps:[d]});
    }
    
    if(d>0){
      _ideTask._data._lastResult._type=d;
      BZ._setStatus("play")
      _ideTask._doRefCall(_ideTask._data._lastResult,0,1);
    }else{
      setTimeout(function(){
        _ideTestManagement._play();
      },1);
    }
  },
  _removeAll:function(){
    $(".bz-tip-iframe").remove();
    _bzDomPicker._removeTmpCover();
  },
  _setIdx:function(i){
    _tipHandler._showItem(_tipHandler._list[i],i,_tipHandler._list.length-1);
  },
  _showItems:function(ds){
    _tipHandler._list=ds;
    _tipHandler._showItem(ds[0],0,ds.length-1);
  },
  _resetDesc:function(v){
    try{
      let vs=v.split(/\[[^\]]+\]/),
          vv=v.match(/\[[^\]]+\]/g),
          w=""
      vv=vv.map(x=>{
        return JSON.stringify(JSON.parse(x),0,2)
      })
      vs.forEach((x,i)=>{
        w+=x
        if(vv[i]){
          w+="\n"+vv[i]
        }
        return w
      })
      v=w
    }catch(e){}
    return v
  },
  _showItem:function(a,_idx,_endIdx){
    if(!a.description){
      return
    }
    let pos="position:absolute;top:100px;left:calc(50% - 100px);"
    a.description=_tipHandler._resetDesc(a.description)

    let _bIdx2=_endIdx&&_idx<_endIdx&&`
          <button onclick="bzComm.postToAppExtension({fun:'_doAfterComment',scope:'_tipHandler',ps:[4]})" style="color:#000;font-size:10px;float:left;margin-left:20px;background-color: #CCC;border: 1px solid #FFF;padding:1px 5px;"> &gt; </button>
          <button onclick="bzComm.postToAppExtension({fun:'_doAfterComment',scope:'_tipHandler',ps:[2]})" style="color:#000;font-size:10px;float:left;margin-left:20px;background-color: #CCC;border: 1px solid #FFF;padding:1px 5px;">${_bzMessage._method._fail}</button>
        `;

    let _bIdx1=_idx&&`
          <button onclick="bzComm.postToAppExtension({fun:'_setIdx',scope:'_tipHandler',ps:[${_idx-1}]})" style="color:#000;font-size:10px;float:left;margin-left:20px;background-color: #CCC;border: 1px solid #FFF;padding:1px 5px;"> &lt; </button>
        `;
    if(_bIdx1||_bIdx2){
      _bIdx1=`<div>${_bIdx1||""}${_bIdx2||""}</div>`
    }
    let _bResult=a.showJudge&&`<div>
          <button onclick="bzComm.postToAppExtension({fun:'_doAfterComment',scope:'_tipHandler',ps:[4]})" style="color:#000;font-size:10px;float:left;margin-left:20px;background-color: #CCC;border: 1px solid #FFF;padding:1px 5px;">${_bzMessage._method._pass}</button>
          <button onclick="bzComm.postToAppExtension({fun:'_doAfterComment',scope:'_tipHandler',ps:[2]})" style="color:#000;font-size:10px;float:left;margin-left:20px;background-color: #CCC;border: 1px solid #FFF;padding:1px 5px;">${_bzMessage._method._fail}</button>
        </div>`;

    let os=$(".bz-tip-iframe").remove();
    os=$("<div class='bz-tip-iframe'></div>").appendTo(document.body.parentNode);
    _tipHandler._shadowRoot = os[0].attachShadow({ mode: 'open' });
    _tipHandler._shadowRoot.innerHTML = `<link rel='stylesheet' href='${SERVER_HOST}/ide/css/bzInsert.css'/>
    <link rel='stylesheet' href='${SERVER_HOST}/ide/css/insert.icons.css'/>
    <div class="bz-tip BZIgnore" style="top: 13px; left: 0px;">
    <button class="bz-close BZIgnore" type="button" onclick="$('.bz-tip-iframe').remove();" style="position: absolute;right: 10px;top: 10px;height: 10px;width: 10px;border: 0;background-size: 10px;"></button>
    <textarea style="overflow: auto;" class="helptip BZIgnore" disabled=""></textarea>
    ${_bIdx1||_bResult||""}
    </div>`;
  }
};
var _innerWin={
  _rootWin:window,
  _data:_CtrlDriver._buildProxy({
    _pos:{
      _top:0,
      _left:window.innerWidth/2-100,
      _timeStamp:Date.now(),
      _inMin:0,
      _recordMin:0,
      _playMin:0
    },
    _dataBind:{
      _showDataBind:0
    },
    _tools:{
      _monitorList:[],
      _scope:"body"
    }
  }),
  _setPosition:function(_win){
    if(bzComm._isAppExtension()){
      let pos={top:0,left:0};
      if(BZ._userHabit){
        pos=BZ._userHabit.toolbarPos||pos;
        pos.top=pos.top||0;
        pos.left=pos.left||0;
      }

      $(_win).css({
        top:pos.top,
        left:pos.left,
        position:"fixed",
        "z-index":Number.MAX_SAFE_INTEGER,
        width: 0,
        border: 0,
        height: 0
      });
      bzComm.postToIDE({fun:"_setPosition",scope:"_innerWin",ps:[pos]});
    }else{
      BZ._userHabit.toolbarPos=_win
      BZ._storeUserHabit();
    }
  },
  _getHTML:function(){
    let _host=SERVER_HOST//.replace(/^http(s)?:/,location.protocol);
    return `
    <link rel="stylesheet" type="text/css" href="${_host}/ide/css/bzInsert.css">
    <link rel="stylesheet" type="text/css" href="${_host}/ide/css/insert.icons.css">
    
    <div id="BZ_Win" class="bz-tb-container BZIgnore"
      style="font-size: 13px; font-weight: normal; color: rgb(102, 102, 102);min-width:80px;position: fixed;box-shadow: rgba(0, 0, 0, 0.5) 2px 2px 9px;">
      <div class="bz-main-body">
        <div class="bz-tb-header">
          <div class="bz-btn-tb-icon bz-boozang-logo-small"
            style="width:19px;height:19px;cursor:pointer;float:left;margin:4px;padding:0;border:0;background-position:25px 25px;background-size: 34px !important;margin-bottom:0;"
            onclick="BZ.focusMaster('','bz-master')"></div>
          <div style="flex:1;text-align: center;white-space: nowrap;text-overflow: ellipsis;overflow: hidden;font-size: 11px;">
            <span class="info" style="display: none;">Lost focus</span>
          </div>
          <div class="bz-btn-icon-tn bz-header-right bz-minimize-white" style="height:24px;" onclick="BZ.toolbar.resize(this)"></div>
        </div>
        <div>
          <div class="bz-tb-body">
            <div class="bz-tb-buttons">
              <button class="bz-btn-tb-icon bz-1 bz-record" onclick='BZ.toolbar.exeCmd(this)' title="Record (Insert into selected Test Case)"></button>
              <button class="bz-btn-tb-icon bz-2 bz-play" onclick='BZ.toolbar.exeCmd(this)' title="Play Test Case"></button>
              <button class="bz-btn-tb-icon bz-3 bz-validate" onclick='BZ.toolbar.exeCmd(this)' title="Validation"></button>
              <button class="bz-btn-tb-icon bz-4 bz-comment" onclick='BZ.toolbar.exeCmd(this)' title="Comment"></button>
            </div>
          </div>
          <div class="bz-tb-body">
            <div class="bz-tb-subheader"><a
                style="position:absolute;right:10px;bottom:0;font-size:10pt;text-decoration: underline;color:#66F;"
                href="javascript:" onclick="BZ.toolbar.autoFillForm();">Autofill Forms</a></div>
          </div>
        </div>
      </div>
    </div>`
  },
  _insertCtrls:function(bSwitch,bMax){ //insert controls into customer application window
    if(parent!=window||BZ._isAutoRunning() || !window.extensionContent||_IDE._data._curVersion.shield||_IDE._data._curVersion.freezed){
      return
    }

    var _win=$("#BZ_Win");
    if(!_win.length){
      _win=$(`<div id='BZ_Win' class='BZIgnore' style='position:fixed;z-index:${Number.MAX_SAFE_INTEGER}'></div>`)[0];
      document.body.parentElement.appendChild(_win);
      _innerWin._setPosition(_win);

      _innerWin._shadowRoot = _win.attachShadow({ mode: 'open' });
      _innerWin._shadowRoot.innerHTML = _innerWin._getHTML();

      _win.addEventListener('mousedown', (e) => {
        _win.isDragging = true;
        _win.offsetX = e.clientX - _win.offsetLeft;
        _win.offsetY = e.clientY - _win.offsetTop;

        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
      });

      function onMouseMove(e) {
        if (_win.isDragging) {
          _win.style.left = e.clientX - _win.offsetX + 'px';
          _win.style.top = e.clientY - _win.offsetY + 'px';
        }
      }

      function onMouseUp() {
        _win.isDragging = false;
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
      }
      
    }
  },
  _setToolbarStatus:function(){
    let bs=[1,2,3,4].map(x=>$(_innerWin._shadowRoot).find(".bz-"+x))

    if(BZ._data._checkout){
      bs[0].attr({disabled:false});
      bs[2].attr({disabled:false});
      bs[3].attr({disabled:false});
    }

    switch(BZ._data._status){
      case "play":
        bs[0].addClass("bz-stop").removeClass("bz-record");
        bs[1].addClass("bz-pause").removeClass("bz-play");
        bs[2].attr({disabled:true});
        bs[3].attr({disabled:true});
        break;
      case "pause":
        bs[0].addClass("bz-stop").removeClass("bz-record");
        bs[1].addClass("bz-play").removeClass("bz-pause");
        bs[2].attr({disabled:true});
        bs[3].attr({disabled:true});
        break;
      case "record":
        bs[0].addClass("bz-stop").removeClass("bz-record");
        bs[1].attr({disabled:true});
        bs[2].attr({disabled:false});
        bs[3].attr({disabled:false});
        break;
      default:
        bs[0].addClass("bz-record").removeClass("bz-stop");
        bs[1].addClass("bz-play").removeClass("bz-pause");
        bs[2].attr({disabled:false});
        bs[3].attr({disabled:false});
    }
    if(!BZ._data._checkout){
      bs[0].attr({disabled:true});
      bs[2].attr({disabled:true});
      bs[3].attr({disabled:true});
    }
    if(BZ._data._status=="play"||BZ._data._status=="pause"){
      bs[0].attr({disabled:false});
    }
  },
  resize:function(d){
    let o=$(_innerWin._shadowRoot).find(".bz-header-right")
    if(o.hasClass("bz-minimize-white")){
      o.addClass("bz-plus-white").removeClass("bz-minimize-white");
      $(_innerWin._shadowRoot).find(".bz-tb-body").hide()
    }else{
      o.addClass("bz-minimize-white").removeClass("bz-plus-white");
      $(_innerWin._shadowRoot).find(".bz-tb-body").show()
    }
  }
};
var _ideActionData={
  _typeList:["validate","trigger","extract","js","plug","comment","refresh","group","visit","fillform"],
  _groupType:["","if","else","else if","while","for","or","and"],//,"try","catch","finally"],
  _scenarioType:["given","when","then"],
  _keys:[
    "_validation",
    "_triggerEvent",
    "_extractData",
    "_script",
    "_ref",
    "_comment",
    "_refresh",
    "_group",
    "_visit",
    "_fillForm",
    "_load"
  ],
  _type:{
    _validation:0,
    _triggerEvent:1,
    _extractData:2,
    _script:3,
    _ref:4,
    _comment:5,
    _refresh:6,
    _group:7,
    _visit:8,
    _fillForm:9,
    _load:"a"
  },
  _method:{
    _html:0,
    _script:1,
    _data:2
  },
  _functions:{
    _loadPage:{_code:"var newLink=\"{0}\";\nBZ.TW.location.href=newLink;\n",_parameters:["URL"]},
    _browserBack:{_code:"BZ.TW.history.back();\n"},
    _browserForward:{_code:"BZ.TW.history.forward();\n"},
    _scrollTop:{_code:"$element=$element||BZ.TW.document.documentElement;\n$element.scrollTop=0;\n"},
    _scrollBottom:{_code:"$element=$element||BZ.TW.document.documentElement;\n$element.scrollTop=$element.scrollHeight;\n"},
    _scrollPageDown:{_code:"$element=$element||BZ.TW.document.documentElement;\n$element.scrollBy($element.clientWidth,$element.clientHeight);"},
    _scrollPageUp:{_code:"$element=$element||BZ.TW.document.documentElement;\n$element.scrollBy(-$element.clientWidth,-$element.clientHeight);"},
    _retrieveUrl:{_code:"$test.curUrl=BZ.TW.location.href;"},
    _gotoFlag:{_code:"$util.gotoFlag()"},
    _asyncFun:{_code:"(function(){\n  return function(callFun){\n    setTimeout(()=>{\n      console.log('ok');\n      /"+"/"+_bzMessage._task._callAtEnd+"\n      callFun();\n    },5000)\n  }\n})()"},
    _stdApiResponseScript:{_code:""}
  },
  _failedReaction:{
    _default:0,
    _quick:1,
    _retry:2
  },
  _dataStatus:{
    _notReady:0,
    _warning:1,
    _ok:2
  },
  _dataStructure:{
    _validation:["monitorUrl","noLightAction","loopData","skipActionElement","failElement","cameraId","runInIDE","min","max","method","element","errOnHidden","force","failedReaction","content","compareMark","expectation","md5","refOfSuccess","successParameter","refOfFailed","failedParameter","refOfError","errorParameter","api","script"],
    _triggerEvent:["triggerPopup","disableAISet","retryable","monitorUrl","noLightAction","withSubmit","withEntry","offset","loopData","$label","$header","token","tokenHost","requests","apiReplaceEvent","skipActionElement","failElement","cameraId","min","max","element","errOnHidden","force","failedReaction","event","expectation","md5","refOfSuccess","successParameter","refOfError","errorParameter","refOfFailed","failedParameter"],
    _extractData:["monitorUrl","noLightAction","loopData","skipActionElement","failElement","cameraId","min","max","method","element","errOnHidden","force","multipleElement","failedReaction","content","refOfSuccess","successParameter","refOfError","errorParameter","refOfFailed","failedParameter","api","script","downloadAsFile"],
    _script:["monitorUrl","noLightAction","loopData","failElement","cameraId","runInIDE","min","max","element","errOnHidden","force","multipleElement","failedReaction","script","refOfSuccess","successParameter","refOfFailed","failedParameter","refOfError","errorParameter"],
    _ref:["monitorUrl","postToRemoteData","remoteResponseData","asyncRemote","remoteExe","remoteScope","specifyAppRole","loopData","stepKey","min","max","refOfSuccess","refOfFailed","refOfError","successParameter","reTry"],
    _comment:["monitorUrl","failElement","cameraId","min","max","element","errOnHidden","force","loopData","showJudge","refOfSuccess","successParameter","refOfFailed","failedParameter","img","md5"],
    _refresh:["hostId","loadURL","loadType","monitorUrl","loopData","refreshData","refreshType","min","max","clearCookie","clearLocalStorage","loadURL","refOfSuccess","successParameter","refOfFailed","failedParameter","refOfError","errorParameter"],
    _group:["actions","conditionAction","monitorUrl","max","min","asOneAction","refOfSuccess","refOfFailed","refOfError","loopData","groupType","elseGroup","refOfSuccess","refOfFailed","refOfError"],
    _visit:["monitorUrl","failElement","cameraId","panel","min","max","panelToggle","loopData","toggle","target","script","plugin"],
    _fillForm:["monitorUrl","failElement","cameraId","min","max","data","element","autoNext","loopData","nextBtn","submitBtn","autoSubmit","handleMsg","lineSuccess","lineError","finalSuccess","finalError","refOfSuccess","successParameter","refOfError","errorParameter"],
    _load:["monitorUrl","requests","rampUp","repeatTimes","exeMethod","period"]
  },
  _assignIfCondition:function(a){
    if(!a.refOfError){
      a.refOfError=a.refOfFailed=".../s"
    }
    return a
  }
};

(function(){
  //what is autoDelay? wait all request to complete, even the next action element is ready on page
  for(let k in _ideActionData._dataStructure){
    _ideActionData._dataStructure[k].push("key","autoDelay","preScript","resultscript","disable","description","type","ai","todo","note","flag","successGoto","failedGoto","errorGoto")
  }
  _ideActionData._typeKeys=_Util._swapKeyValue(_ideActionData._type);
})();

var _ideActionOptions={
  _buildData:function(o){
    let oo=o
    o=o._data._item
    let d=o._obj
    if(!d){
      let p=oo.parentElement.parentElement._data._item
      d={...p._obj,...o._value}
    }
    d.key=_aiAPI._newId()
    return _Util._clone(d)
  },
  _startDrag:function(o,e){
    if(o._data._item._obj){
      $(o).removeClass("bz-hover")
    }else{
      $(o.parentElement).css({opacity:0.3})
    }
    _mainMenuHandler._data._curDragItem={d:_ideActionOptions._buildData(o)};
    let d=_mainMenuHandler._data._curDragItem
    d.a=d.d
    d.o=o
  },
  _endDrag:function(){
    let d=_mainMenuHandler._data._curDragItem
    if(d){
      if(d.o._data._item._obj){
        $(d.o).addClass("bz-hover")
      }else{
        $(d.o.parentElement).css({opacity:1})
      }
      _mainMenuHandler._data._curDragItem=0
    }
  },
  _viewDef:{
    _if:function(){
      return _ideTask._data._curTab=='_curTest'&&BZ._userHabit.showActionOptions
    },
    _tag:"div",
    _attr:{
      class:"bz-action-options-box"
    },
    _items:[
      {
        _tag:"button",
        _attr:{
          class:"bz-caret-up bz-none bz-action-options-ctrl",
          enable:1
        },
        _jqext:{
          click:function(){
            let o=$(".bz-action-options")[0]
            o.scrollTop=o.scrollTop-o.clientHeight
          }
        }
      },
      {
        _tag:"div",
        _attr:{
          class:"bz-action-options"
        },
        _items:[
          {
            _tag:"button",
            _attr:{
              draggable:1,
              class:function(d,ct,o,_viewDef){
                let _hover="";
                if(!_viewDef._attr.disabled(d)){
                  _hover="bz-hover"
                }
                return 'btn btn-icon bz-icon-18 '+_hover+" "+(d._item._icon||_ideActionManagement._getIcon(d._item._obj))
              },
              title:"_data._item._title",
              style:"margin:8px auto;",
              disabled:function(d){
                if(BZ._isPlaying()||!BZ._isCheckout()){
                  return 1
                }
                let t=_IDE._data._curTest._data.type
                d=d._item._obj
                if([4,7].includes(d.type)){
                  return
                }
                if(t=='unit'){
                  return d.type=='a'
                }else if(t=="api"){
                  return !d.requests
                }
                return 1
              },
              ondragstart:"this._startDrag=_ideActionOptions._startDrag;_mainMenuHandler._startDrag(this,event)",
              ondragend:"_ideActionOptions._endDrag(this,event)"
            },
            _items:[
              {
                _if:function(d){
                  return d._item._extend
                },
                _tag:"span",
                _attr:{
                  class:"bz-extend-sign"
                }
              },
              {
                _if:"_data._item._extend",
                _tag:"div",
                _attr:{
                  class:"bz-hover-show pop-menu"
                },
                _items:[
                  {
                    _tag:"div",
                    _attr:{
                      class:"pop-menu-item",
                      draggable:1,
                      ondragstart:"this._startDrag=_ideActionOptions._startDrag;_mainMenuHandler._startDrag(this,event)",
                      ondragend:"_ideActionOptions._endDrag(this,event)"
                    },
                    _text:"_data._item._text",
                    _jqext:{
                      click:function(e){
                        e.stopPropagation()
                        let d=_ideActionOptions._buildData(this)
                        let a=_IDE._data._curAction
                        if(a){
                          _ideActionManagement._move([d],a)
                        }else{
                          _IDE._data._curTest._data.actions.push(_Util._clone(d))
                        }
                        if(d.type<3){
                          _ideActionManagement._pickElement(1)
                        }
                      }
                    },
                    _dataRepeat:function(d){
                      d=d._item._extend
                      if(d.constructor==Function){
                        return d()
                      }else{
                        return d
                      }
                    }
                  }
                ]
              }
            ],
            _dataRepeat:function(){
              let m=_bzMessage._action,
                  a=m._actionMenuOptions,
                  b=m._methodDesc,
                  v=m._content,
                  md=_bzMessage._method,
                  ev=_bzMessage._syntax.event,
                  rl=_bzMessage._test._general;
              return [
                {
                  _title:b._refresh,
                  _obj:{type:6,loadType:"followSameURL",hostId:"0"},
                  _extend:[
                    {_text:rl.followSameURL,_value:{loadType:"followSameURL"}},
                    {_text:rl.newpage,_value:{loadType:"newpage"}},
                    {_text:rl.followCheck,_value:{loadType:"followCheck"}},
                    {_text:rl.follow,_value:{loadType:"follow"}},
                  ]
                },
                {
                  _title:a._validation,
                  _obj:{type:0,compareMark:"==",method:0,content:{type:"innerText"}},
                  _extend:[
                    {_text:m._script,_value:{method:1}},
                    {_text:_bzMessage._common._data,_value:{content:{type:"data"}}},
                    {_text:"innerText",_value:{content:{type:"innerText"}}},
                    {_text:v._value,_value:{content:{type:"value"}}},
                    {_text:v._exist,_value:{content:{type:"exist"}}},
                    {_text:v._unExist,_value:{content:{type:"unexist"}}},
                    {_text:v._checked,_value:{content:{type:"checked"}}},
                    {_text:v._disable,_value:{content:{type:"disable"}}},
                    {_text:v._enable,_value:{content:{type:"enable"}}}
                  ]
                },
                {
                  _title:a._mouse,
                  _obj:{type:1,event:{action:"click",type:"mouse"}},
                  _extend:[
                    {_text:ev.click,_value:{event:{action:"click",type:"mouse"}}},
                    {_text:ev.dblclick,_value:{event:{action:"dblclick",type:"mouse"}}},
                    {_text:ev.rightclick,_value:{event:{action:"rightclick",type:"mouse"}}},
                    {_text:ev.hover,_value:{event:{action:"hover",type:"mouse"}}},
                    {_text:ev.drag,_value:{event:{action:"drag",type:"mouse"}}},
                    {_text:ev.dragdrop,_value:{event:{action:"dragdrop",type:"mouse"}}}
                  ]
                },
                {_title:a._keyboard,_obj:{type:1,event:{type:"change"}}},
                {_title:a._extract,_obj:{type:2}},
                {
                  _title:a._script,
                  _obj:{type:3},
                  _extend:[
                    {_text:a._script,_value:{}},
                    {_text:md._takeScreenshot,_value:{script:"$util.attachScreenshotToReport()"}},
                    // {_text:md._break,_value:{script:"$util.break()",runInIDE:"on"}},
                    // {_text:md._continue,_value:{script:"$util.continue()",runInIDE:"on"}},
                    {_text:md._wait,_value:{script:"$util.wait(5000)",runInIDE:"on"}}
                  ]
                },
                {_title:a._plugin,_obj:{type:4}},
                {_title:b._comment,_obj:{type:5}},
                {
                  _title:b._group,
                  _obj:{type:7,actions:[]},
                  _extend:function(){
                    if(_IDE._data._curTest._data.type=="scenario"){
                      vs=_ideActionData._scenarioType
                    }else{
                      vs=_ideActionData._groupType
                    }
                    return vs.map(x=>{
                      let v={groupType:x}
                      if(x.includes("else")){
                        v.elseGroup="on"
                      }
                      return {
                        _text:x||m._general,
                        _value:v
                      }
                    })
                  }
                },
                {
                  _title:a._api,
                  _obj:{
                    type:1,
                    apiReplaceEvent:1,
                    requests:[{
                      method:"GET",
                      url:"/",
                      host:_IDE._getDefaultAPIHostIdx(),
                      contentType:"application/json",
                      responseScript:_ideActionManagement._getStdAPIScript(0,"GET")
                    }]
                  }
                },
                {
                  _title:a._api,
                  _obj:{
                    type:"a",
                    requests:[],
                    rampUp:{
                      users:100,
                      up:120,
                      totalTime:300
                    }
                  }
                },
                {
                  _title:_bzMessage._test._type.com,
                  _icon:"bz-com",
                  _extend:function(){
                    return _ideTestManagement._getComList().map(x=>{return {_text:x.name,_value:{element:["BZ.TW.document",`:${x.name}()`]}}})
                  },
                  _obj:{
                    type:1,
                    event:{type:"change"}
                  }
                }
              ]
            },
            _jqext:{
              mouseover:function(){

                $(this).find(".pop-menu").css({
                  top:$(this).offset().top+$(this).height()-15,
                  "margin-left":4
                })
              },
              click:function(e){
                e.stopPropagation()
                let d=_ideActionOptions._buildData(this)
                _ideActionManagement._move([d],_IDE._data._curAction)
                if(d.type<3){
                  _ideActionManagement._pickElement(1)
                }
              }
            }
          }
        ],
        _after:function(o){
          setTimeout(()=>{
            _ideActionOptions._handleScrollBar()
          })
        },
        _jqext:{
          scroll:function(){
            this._viewDef._after(this)
          }
        }
      },
      {
        _tag:"button",
        _attr:{
          class:"bz-caret-down bz-none bz-action-options-ctrl",
          enable:1
        },
        _jqext:{
          click:function(){
            let o=$(".bz-action-options")[0]
            o.scrollTop=o.scrollTop+o.clientHeight
          }
        }
      }
    ]
  },
  _handleScrollBar:function(){
    let o=$(".bz-action-options")[0]
    if(o){
      if(!o.scrollTop){
        $(o.previousElementSibling).hide()
      }else{
        $(o.previousElementSibling).show()
      }
      if(o.scrollTop+o.clientHeight>=o.scrollHeight){
        $(o.nextElementSibling).hide()
      }else{
        $(o.nextElementSibling).show()
      }
    }
  }
};
var _ideActionManagement={
  _getActionViewDef:function({_dataRepeat}){
    function _getItem(_viewType){
      return {
        _if:"_IDE._data._curTest",
        _tag:"div",
        _attr:{
          class:function(d){
            if(!_IDE._data._curTest){
              return
            }
            d=d._item
            var c="bz-action-group-item-"+(_viewType||0)
            if(d._skipInSuite){
              c+=" bz-skip-in-suite"
            }
  
            if(d.disable){
              c+=" disable-item"
            }
            if(d.type!=7 ||!_ideActionManagement._isOpenGroup(d)){
              c+=" row"
            }
            if((BZ._data._uiSwitch._selectedItems||[]).includes(d)){
              return "row-selected action "+c;
            }else{
              return c;
            }
            return c
          },
          style:function(d,c,o){
            let _idx=d._idx
            d=d._item
            d.element
            d.script
            if(d.event){
              d.event.value
            }
            _IDE._data._curAction
            
            if(_ideActionManagement._isIfGroupCondition(d,_idx)&&o){
              setTimeout(()=>{
                _ideActionManagement._assignActionDescWidth(o,d)
              })
            }
  
          },
          draggable:"BZ._isCheckout()&&!BZ._data._uiSwitch._inHandleSize&&!_ideActionManagement._isIfGroupCondition(_data._item)",
          // droppable:"!!(!BZ._isPlaying()&&BZ._isCheckout())",
          // ondrop:"_mainMenuHandler._drop(this,event)",
          // ondragenter:"_mainMenuHandler._dragenter(this,event)",
          // ondragover:"_mainMenuHandler._dragenter(this,event)",
          // ondragleave:"_mainMenuHandler._dragleave(this,event)",
          // ondragstart:"_mainMenuHandler._startDrag(this,event)",
          // ondragend:"_mainMenuHandler._endDrag(this,event)"
        },
        _after:function(o,d){
          setTimeout(()=>{
            $(o).attr({droppable:BZ._isCheckout()}),
            o.ondrop=function(e){_mainMenuHandler._drop(this,e)},
            o.ondragenter=function(e){_mainMenuHandler._dragenter(this,e)},
            o.ondragover=function(e){_mainMenuHandler._dragenter(this,e)},
            o.ondragleave=function(e){_mainMenuHandler._dragleave(this,e)},
            o.ondragstart=function(e){_mainMenuHandler._startDrag(this,e)},
            o.ondragend=function(e){_mainMenuHandler._endDrag(this,e)}
  
            if(_ideActionManagement._isIfGroupCondition(d._item)){
              _ideActionManagement._assignActionDescWidth(o,d._item)
            }
  
          },10)
        },
        _jqext:{
          click:function(e){
            e.stopPropagation()
            e.preventDefault()
            if($(e.target).hasClass("pop-menu-item")){
              return
            }
            let _this=this._data._item
            if(_this!=_IDE._data._curAction){
              _ideActionManagement._selectAction(_IDE._data._curModule,_IDE._data._curTest,_this,e)
              _aiPageHandler._popActionAISetting(_this,_IDE._data._curTest._data,1)
            }
            if(BZ._data._uiSwitch._selectedItems.length>1){
              return
            }
  
            if(_this.element){
              _ideActionManagement._setCurAction(_this)
              _bzDomPicker._flashTmpCover(_this)
              // if(_this.multipleElement){
              //   _bzDomPicker._flashMutipleTmpCover(_this.element.filter(x=>!$.isNumeric(x)))
              // }else{
              //   _bzDomPicker._flashTmpCover(_this.element)
              // }
            }
    
            setTimeout(function(){
              if(["details","data"].includes(_testTabHandler._data._curTab)){
                _testTabHandler._data._curTab="config"
                if(_this.apiReplaceEvent){
                  _testTabHandler._data._curCfgTab="details"
                }else if(_this.type=='a'){
                  _testTabHandler._data._curCfgTab="batch"
                }else{
                  _testTabHandler._data._curCfgTab="main"
                }
                if(_this.offset){
                  _bzDomPicker._showOffset({_element:_this.element,_offset:_this.offset});
                }else{
                  _bzDomPicker._flashTmpCover(_this.element||_this.panel,1);
                }
                if(_this.type==4&&!_this.refOfSuccess){
                  setTimeout(()=>{
                    $(".bz-select-input").focus();
                    $(".bz-select-input").focus()
                  },100)
                }
              }
            },10)
          },
          dblclick:function(e){
            e.stopPropagation()
            _ideTask._start(this._data._item)
          },
        },
        _items:[
          {
            _tag:"div",
            _attr:{
              class:"row bz-action-group-item-1"
            },
            _items:[
              //index
              {
                _tag:"div",
                _attr:{
                  "class":"bz-action-idx"
                },
                _items:[
                  {
                    _tag:"div",
                    _attr:{
                      disabled:"_data._item.disable&&_data._item.type!=7",
                      class:function(d){
                        d=d._item
                        let t=_IDE._data._curTest
                        if(!t){
                          return
                        }
                        if(d._skipInSuite){
                          return "bz-close-eye"
                        }
                        if(!d.disable&&BZ._userHabit.breakPoints.includes(_ideObjHandler._getKey(_IDE._data._curModule._data,t._data,d))){
                          return "bz-debug-stop"
                        }
                      }
                    },
                    _text:function(d){
                      d=d._item
                      if(d.disable){
                        return '/'+'/'
                      }
                      if(d._skipInSuite){
                        return
                      }
                      if(!_ideActionManagement._isIfGroupCondition(d)){
                        return d._actionIdx.replace(/-/g,".")
                      }
                    }
                  }
                ],
                _jqext:{
                  click:function(){
                    _ideActionManagement._setBreakpoint(this._data._item,_IDE._data._curTest._data)
                  }
                }
              },
              //method 
              {
                _tag:"div",
                _attr:{
                  disabled:"_data._item.disable&&_data._item.type!=7",
                  enable:1,
                  class:function(d){
                    let c="bz-action-method "
                    d=d._item
                    if(d.type==7&&(_IDE._data._curTest._data.type=='scenario'||!d.groupType)){
                      c+="bz-width-24"
                    }
                    return c
                  }
                },
                _items:[
                  //icon
                  {
                    _tag:"a",
                    _attr:{
                      class:function(d){
                        d=d._item;
                        let c='bz-action-list-icon '+_ideActionManagement._getIcon(d);
                        if(d.actions){
                          if(_ideActionManagement._isOpenGroup(d)){
                            c+="-open"
                          }else{
                            c+="-close"
                          }
                        }
                        return c
                      },
                      disabled:"_data._item.disable&&_data._item.type!=7",
                      enable:1
                    }
                  },
                  {
                    _if:"_data._item.type==7&&!['given','when','then'].includes(_data._item.groupType)",
                    _tag:"span",
                    _attr:{
                      class:"bz-group-type bz-left-space-5"
                    },
                    _text:"_data._item.groupType"
                  },
                  {
                    _if:"_data._item.type!=7",
                    _tag:"span",
                    _attr:{
                      class:"'bz-action-desc bz-action-text '+(_data._item.refCom?'bz-clickable':'')"
                    },
                    _text:function(d){
                      d=d._item
  
                      let c=_ideActionManagement._getComDataFromElement(d,1)
                      if(c){
                        c= c.$fun
                      }else{
                        c= _ideActionManagement._getActionMethod(d)
                        if(d.script&&d.runInIDE){
                          c="IDE "+c
                        }
                      }
                      
                      return c
                    },
                    _jqext:{
                      click:function(){
                        if(this._data._item.refCom){
                          BZ._setHash(this._data._item.refCom)
                        }
                      }
                    }
                  }
                ],
                _jqext:{
                  click:function(e){
                    var _this=this
                    if(this._data._item.type==7){
                      _ideActionManagement._switchGroup(this._data._item)
                    }
                  }
                }
              },
              //element, value and ex-condition
              {
                _tag:"div",
                _attr:{
                  class:function(d){
                    let c="bz-nowrap bz-action-main",
                        r=((_IDE._data._curTest._issueMap||{})[d._item._actionIdx]||{})._level
                    if(r==1){
                      c+=" bz-error-action"
                    }else if(r==2){
                      c+=" bz-warn-action"
                    }
                    return c
                  },
                  title:function(d){
                    let r=(_IDE._data._curTest._issueMap||{})[d._item._actionIdx]
                    if(r){
                      return _bzMessage._test._issueOptions[r._reason]
                    }
                  }
                },
                _items:[
                  //Description
                  {
                    _if:"_data._item.type!=7||!(_data._item.groupType||'').includes('if')",
                    _tag:"span",
                    _attr:{
                      "class":"bz-action-desc"
                    },
                    _html:function(d){
                      d=d._item
                      let i=d._actionIdx,_msg

                      if(d.type=="a"){
                        let l=_IDE._data._curTest._curLoadingAPIInfo;
                        if(l&&l[i]){
                          l=l[i]
                          _msg = " 🕑 "+_Util._formatTimeInMinSecond(Date.now()-l._startTime,1)+" (✔️: "+l._success+", ❌: "+l._failed+")"
                        }else{
                          _msg=_ideActionManagement._getAutoDescription(d)
                        }
                      }else if(d.apiReplaceEvent){
                        _msg= _ideActionManagement._getAutoDescription(d,1,_IDE._data._curTest)||_msg[_ideActionManagement._getMissValue(d)]
                      }else if(d.description){
                        _msg= d.description.replace(_ideActionManagement._getActionMethod(d),"")
                      }else if(d.event&&d.event.action=="dragdrop"){
                        _msg=_ideActionManagement._getDragdropDesc(d)
                      }else{
                        _msg= _ideActionManagement._getAutoDescription(d)
                      }
                      _msg=_msg.trim()
                      if(_msg.includes("\n")){
                        _msg=_msg.trim().split("\n")[0]+" ..."
                      }

                      _msg=_msg.replace(/[\<]/g,"&lt;").replace(/[\>]/g,"&gt;")
                      
                      _msg=_msg||(d.type==7?'':_bzMessage._test._issueOptions._missData)
                      if(d.type==7){
                        _msg +=` (${d.actions.length} ${_bzMessage._common._actions})`
                      }
                      if(d.type==4&&d==_IDE._data._curAction){
                        return `<a class='bz-hover-click' onclick="BZ._setHash('${d.refOfSuccess}')">${_msg}</a>`
                      }else{
                        return "<span>"+_msg+"</span>"
                      }
                    }
                  },
                  {
                    _if:"!_data._item.element&&_ideActionManagement._hasElement(_data._item)",
                    _tag:"div",
                    _attr:{
                      class:"bz-action-desc bz-error-action"
                    },
                    _items:[
                      {
                        _if:"!_Util._isBZTWOpened()",
                        _tag:"button",
                        _attr:{
                          class:"btn btn-icon-txt bz-popout btn-secondary btn-warn",
                          style:"padding:3px 10px;border-radius: 10px;line-height:12px;",
                          title:"_bzMessage._method._launchAPP",
                        },
                        _items:[
                          {
                            _tag:"span",
                            _attr:{
                              // class:"bz-clickable",
                              style:"margin-left:3px;top: -1px;position: relative;"
                            },
                            _text:"_bzMessage._method._launchAPP",
                          }
                        ],
                        _jqext:{
                          click:function(){
                            BZ._launchCurEnvUrl()
                          }
                        }
                      },
                      {
                        _if:"_Util._isBZTWOpened()",
                        _tag:"button",
                        _attr:{
                          class:"btn btn-icon-txt bz-dompicker btn-secondary",
                          title:"_bzMessage._picker._selectPath",
                          style:"padding:3px 10px;border-radius: 10px;line-height:12px;",
                        },
                        _items:[
                          {
                            _tag:"span",
                            _attr:{
                              // class:"bz-hover-show",
                              style:"margin-left:3px;top: -1px;position: relative;"
                            },
                            _text:"_bzMessage._picker._selectPath"
                          }
                        ],
                        _jqext:{
                          click:function(){
                            _ideActionManagement._pickElement(1)
                          }
                        }
                      }
                    ]
                  },
                  //Description
                  // {
                  //   _tag:"div",
                  //   _attr:{
                  //     "class":"bz-action-desc"
                  //   },
                  //   _items:[
                  //     {
                  //       _if:"!_data._item.content||_data._item.content.type!='screenshot'||!_data._item.expectation",
                  //       _tag:"span",
                  //       _attr:{
                  //         style:function(a){
                  //           a=a._item
                  //           if(a==_IDE._data._curAction&&a.type==4&&a.refOfSuccess){
                  //             return "text-decoration:underline"
                  //           }else{
                  //             return "text-decoration:unset"
                  //           }
                  //         }
                  //       },
                  //       _items:[
                  //         {
                  //           _if:"_data._item.type!='a'&&!_data._item.apiReplaceEvent",
                  //           _html:function(d){
                  //             d=d._item
                  //             let na=d.conditionAction
                  //             let _msg=""
                  //             if(d.type===undefined){
                  //               return
                  //             }
                  //             if(!d.element&&d.description&&_IDE._data._curTest._data.type!='scenario'){
                  //               _msg=(d.description||"").replace(new RegExp("^"+_ideActionManagement._getActionMethod(d)),"")
                  //             }else if(d.type==6){ //refresh
                  //               _msg=_ideActionManagement._getAutoDescription(d)
                  //             }else if("23".includes(d.type)||(!d.type&&d.method==1)){ //extract, script
                  //               _msg=_ideDataHandler._parseToExeCode(d.script)
                  //             }else{
                  //               _msg=_ideActionManagement._getValueDesc(d,_IDE._data._curTest)||""
                  //               if(_msg.toLowerCase()==d.groupType){
                  //                 return ""
                  //               }else if(d.groupType=="if"||d.groupType=="else if"){
                  //                 if(!na){
                  //                   return `<span class="bz-action-desc bz-error-action">${_bzMessage._action._missConditionAction}</span>`
                  //                 }
                  //               }else if(d.groupType=="for"){
                  //                 if(!d.loopData){
                  //                   return `<span class="bz-action-desc bz-error-action">${_bzMessage._action._missRepeatData}</span>`
                  //                 }else if(!_msg){
                  //                   return d.loopData.trim().substring(0,50)
                  //                 }
                  //               }
                  //             }
                  //             _msg=(_msg||"").toString();
                  //             if(!_msg&&d.type==4&&d.description){
                  //               _msg=d.description
                  //             }else if(!_msg||_msg.trim()=="=="){
                  //               if(d.type!=7){
                  //                 _msg=_bzMessage._action._missData[_ideActionManagement._getMissValue(d)]
                  //               }
                  //             }

                  //             _msg=(_msg||"").replace(/[\<]/g,"&lt;").replace(/[\>]/g,"&gt;")
                  //             if(_IDE._data._curTest._data.type=='scenario'&&d.type==4&&d.refOfSuccess){
                  //               let k=d.refOfSuccess.match(/m[0-9]+\.t[0-9]+/)
                  //               if(k){
                  //                 _msg+=" ["+k[0]+"]"
                  //               }
                  //             }

                  //             let _style=""

                  //             if(d.type==7){
                  //               if(na){
                  //                 _style=" class='bz-group-desc'"
                  //               }
                  //               _msg=(_msg||"")+ ` (${_bzMessage._common._actions}: ${d.actions.length})`
                  //             }
                  //             if(_msg.includes("\n")){
                  //               _msg=_msg.trim().split("\n")[0]+" ..."
                  //             }
                  //             return "<span"+_style+">"+_msg+"</span>"
                  //           }
                  //         }
                  //       ]
                  //     },
                  //     // {
                  //     //   _if:"_data._item.content&&_data._item.content.type=='screenshot'&&_data._item.expectation",
                  //     //   _tag:"div",
                  //     //   _attr:{style:"margin:-7px"},
                  //     //   _items:[
                  //     //     _uiHandler._getScreenshot("_data._item.expectation"),
                  //     //   ]
                  //     // }
                  //   ],
                  //   _jqext:{
                  //     mouseover:function(){
                  //       if(this._data._item.type==_ideActionData._type._script){
                  //         return
                  //       }
                  //       try{
                  //         this.title=_JSHandler._prepareData($(this).text())
                  //         if(this._data._item.note){
                  //           this.title+="\n\n"+_bzMessage._common._note+":\n"+this._data._item.note
                  //         }
                  //         if($(this).hasClass("bz-red-data-point2")){
                  //           this.title=_bzMessage._action._noBestPath+"\n\n"+this.title
                  //         }
                  //         if(this._data._item.type==4){
                            
                  //         }
                  //       }catch(e){}
                  //     },
                  //     click:function(e){
                  //       let a=this._data._item
                  //       if(a==_IDE._data._curAction&&a.type==4&&a.refOfSuccess&&!a.refOfSuccess.includes('{')&&e.target.tagName=="SPAN"){
                  //         BZ._setHash(a.refOfSuccess)
                  //       }
                  //     }
                  //   }
                  // },
                ]
              },
              //conditions/timer/setting menu
              {
                _tag:"div",
                _attr:{
                  "class":function(d){
                    let c='bz-action-ctrl '
                    if(d._item.todo){
                      c+='bz-todo'
                    }else if(d._item.note){
                      c+="bz-todo-note"
                    }
                    return c
                  },
                  "todo-text":function(d){
                    if(d._item.todo){
                      return _bzMessage._action._todo
                    }else if(d._item.note){
                      return _bzMessage._common._note
                    }
                  },
                  title:"_data._item.note"
                },
                _items:[
                  //undo merge
                  {
                    _if:"_IDE._data._curTest._mergeActionMap[_data._item.key]",
                    _tag:"div",
                    _attr:{
                      class:"btn btn-icon bz-undo",
                      style:"margin: auto;height: 100%;",
                      title:"_bzMessage._test._undoMergeToSet"
                    },
                    _jqext:{
                      mousedown:function(e){
                        _ideTestManagement._undoMergeAction(this._data._item)
                      }
                    }
                  },
                  {
                    _if:function(d){
                      d=d._item
                      return !BZ._isPlaying()&&_IDE._data._curAction==d&&d.ai&&!d.ai.match(/no-setting|undefined/)
                    },
                    _tag:"a",
                    _attr:{
                      class:"btn btn-primary",
                      style:"padding: 0 6px 0 4px;border-radius: 5px;font-size: 11px;margin:auto 0;",
                      enable:1
                    },
                    _items:[
                      {
                        _tag:"span",
                        _attr:{
                          class:"bz-settings bz-right-space-5"
                        }
                      },
                      {
                        _tag:"span",
                        _attr:{
                          style:"margin-left: -3px;position: relative;top: -1px;"
                        },
                        _text:"_bzMessage._aiDefinition._aiSetting",
                      }
                    ],
                    _jqext:{
                      click:function(){
                        _aiPageHandler._popActionAISetting(_IDE._data._curAction,_IDE._data._curTest._data,0)
                      }
                    }
                  },
                  //play
                  {
                    _if:"!BZ._data._status&&_IDE._data._curAction==_data._item",
                    _tag:"div",
                    _attr:{
                      "class":"btn btn-condition btn-icon bz-play-blue",
                      title:"_bzMessage._method._playFrom"
                    },
                    _jqext:{
                      mousedown:function(e){
                        e.stopPropagation()
                        _ideTask._playFromAction()
                      }
                    }
                  },
                  //Timer, request, success/error/failed
                  {
                    _tag:"div",
                    _attr:{
                      class:function(d){
                        var k;
                        if(d._item._type=="timer"){
                          k=_ideActionManagement._getWaitIcon(d._supData._item,1)
                        }else if(d._item._type=="flag"){
                          k="bz-flag"
                          if(d._supData._item.flag){
                            k+=" bz-pressed-icon"
                          }else{
                            if(_IDE._data._curAction!=d._supData._item){
                              return
                            }
                            k+=" bz-grey"
                          }
                        }else if(!d._supData._item._actionIdx.includes("c")){
                          k="bz-decision";
                          d=d._supData._item
                          if(!(d.refOfError||d.refOfSuccess||d.refOfFailed)){
                            k+=" bz-grey"
                          }else{
                            k+=" bz-active-color"
                          }
                        }
                        return "btn btn-icon btn-condition "+k;
                      },
                      title:function(d){
                        if(d._item._type=='timer'){
                          return _ideActionManagement._getTimerDesc(d._supData._item)
                        }else if(d._item._type=="condition"){
                          return _bzMessage._action._setCondition
                        }else if(d._item._type=="flag"){
                          return d._supData._item.flag||_bzMessage._action._setFlag
                        }
                      }
                    },
                    _jqext:{
                      click:function(e){
                        _testTabHandler._data._curTab="config"
                        let t=this._data._item._type
                        if(t=="flag"){
                          return _ideActionManagement._setActionItemForm("_showFlagForm",".bz-flag-form",this._data._item!=_IDE._data._curAction,50)
                        }else if(t=="timer"){
                          return _ideActionManagement._setActionItemForm("_showTimeForm",".bz-time-form",this._data._item!=_IDE._data._curAction,80)
                        }else{
                          setTimeout(()=>{
                            _testTabHandler._data._curCfgTab=t
                          },100)
                        }
                        if(this._data._supData._item==_IDE._data._curAction){
                          e.stopPropagation()
                        }else{
                          
                        }
                      }
                    },
                    _dataRepeat:function(d){
                      if(BZ._data._status){
                        return
                      }
                      d=d._item;
                      var vs=[]
                      // if(d.apiReplaceEvent){
                        // return vs
                      // }
                      if(d.type==7){
                        return [{_type:"flag"}]
                      }
                      if(d.type!=4&&!d._actionIdx.includes("c")&&!d.type!=7&&(_ideActionManagement._hasCondition(d)||_IDE._data._curAction==d)){
                        vs=[{_type:"condition"}]
                      }
                      if(d.min||d.max||(_IDE._data._curAction==d&&"0123467".includes(d.type))){
                        vs.push({_type:"timer"})
                      }
                      if(_IDE._data._curAction==d||d.flag){
                        vs.push({_type:"flag"})
                      }
                      return vs
                    }
                  },
                  {
                    _if:function(d){
                      d=d._item
                      return d.type==4&&d.refOfSuccess&&!d.refOfSuccess.includes('{')
                    },
                    _tag:"a",
                    _attr:{
                      class:function(d){
                        d=_ideObjHandler._getDataByItem(d._item.refOfSuccess)
                        if(d){
                          return "bz-"+d._data.type
                        }
                        return "bz-disable"
                      },
                      style:"margin:auto 10px;"
                    },
                    _jqext:{
                      click:function(e){
                        e.stopPropagation()
                        BZ._setHash(this._data._item.refOfSuccess)
                      },
                      mouseover:function(){
                        this.title=_ideObjHandler._getObjStdDesc(this._data._item.refOfSuccess)
                      }
                    }
                  },
                  _ideActionManagement._getTmpSolutionAction(),
                  //camera/screenshot
                  {
                    _if:"_ideActionManagement._hasElement(_data._item)&&_ideActionManagement._hasStoreScreenshot(_data._item)",
                    _tag:"div",
                    _attr:{
                      class:"btn btn-icon bz-camera-icon btn-condition",
                      title:"_bzMessage._method._checkScreenshot"
                    },
                    _endItem:1,
                    _jqext:{
                      mousedown:function(e){
                        _ideActionManagement._showActionScreenshot(this._data._item,"_old")
                      }
                    }
                  },
                  //camera/screenshot
                  {
                    _if:"_ideActionManagement._hasElement(_data._item)&&_ideActionManagement._hasNewScreenshot(_data._item)",
                    _tag:"div",
                    _attr:{
                      class:"btn btn-icon bz-camera-icon bz-active-color btn-condition",
                      title:"_bzMessage._method._checkNewScreenshot"
                    },
                    _endItem:1,
                    _jqext:{
                      mousedown:function(e){
                        _ideActionManagement._showActionScreenshot(this._data._item,"_new")
                      }
                    }
                  },
                  {
                    _if:function(d){
                      if(d._item._actionIdx.includes("c")||_IDE._data._setting.debugOneAction||_IDE._data._setting.content.disableAutoOneAction||d._item.disable||BZ._isPlaying()){
                        return
                      }
                      if(d._item.type==7&&d._item.asOneAction){
                        return 1
                      }
                      let g=d._supData._item,b;
                      if(!g){
                        g=_IDE._data._curTest._data
                      }
                      b=g.actions[g.actions.indexOf(d._item)+1]
                      return _ideTask._isLightableAction(d._item,b,g)
                    },
                    _tag:"span",
                    _endItem:1,
                    _attr:{
                      class:"btn btn-icon btn-condition bz-flash",
                      style:"top: 0;",
                      title: "_bzMessage._setting._preferences._actionFlash"
                    },
                  },
                  {
                    _if:function(d){
                      var dd=_IDE._data._curTest._result[d._item._actionIdx]
  
                      return dd&&dd._orgType!==undefined&& dd._orgType!=dd._type&&d._item.type!=4
                    },
                    _tag:"span",
                    _endItem:1,
                    _attr:{
                      "class":function(d){
                        var r=_IDE._data._curTest._result[d._item._actionIdx];
                        var c="btn btn-icon btn-condition "
                        var _rdm=_taskInfo._type;
                        if(!r){
                          return "";
                        }
                        return c+"bz-"+_ideTask._getResultIconByType(r._orgType);
                      }
                    }
                  },
                  {
                    _if:function(d){
                      var dd=_IDE._data._curTest._result[d._item._actionIdx]
                      return dd&&dd._orgType!==undefined&&dd._orgType!=dd._type&&d._item.type!=4
                    },
                    _tag:"span",
                    _endItem:1,
                    _attr:{
                      "class":"btn btn-icon btn-condition bz-assign",
                      style:"position: relative;top: 2px;",
                    }
                  },
                  {
                    _tag:"span",
                    _endItem:1,
                    _attr:{
                      class:function(d){
                        var r=_IDE._data._curTest._result[d._item._actionIdx];
                        var c="btn btn-icon btn-condition "
                        var _rdm=_taskInfo._type;
                        if(!r){
                          return "";
                        }
                        if(_ideActionManagement._isSkippedResult(r)){
                          c+="bz-info"
                        }else{
                          c+="bz-"+(_ideTask._getResultIconByType(r._type)||(BZ._isPlaying()?"small-loading":""))
                        }
  
                        return c
                      },
                      title:function(d){
                        let t=_IDE._data._curTest;
                        if(!t){
                          return
                        }
  
                        var c="",
                            _rdm=_taskInfo._type,
                            r=t._result[d._item._actionIdx];
                        if(!r){
                          return "";
                        }
                        if(_ideActionManagement._isSkippedResult(r)){
                          c="_skipped";
                        }else if(r._type==_rdm._success){
                          c="_success";
                        }else if(r._type==_rdm._warning){
                          c="_warning";
                        }else if(r._type==_rdm._failed){
                          c="_failed";
                        }else if(r._type==_rdm._crash){
                          c="_crash";
                        }else{
                          c="_error";
                        }
                        return _bzMessage._common[c]+(r._msg?": "+(r._poorPerformance?r._msg+" ("+r._fTime+")":r._msg):"");
                      }
                    },
                    _jqext:{
                      click:function(){
                        let t=_IDE._data._curTest;
                        var r=t._result[this._data._item._actionIdx]
                        if(r&&r._msgMd5){
                          _rootCauseManagement._popItem({
                            errHash:r._msgMd5,
                            errDesc:r._msg.replace(new RegExp("\\[.+"+r._msgMd5+"\\]"),"").trim(),
                            scope:_IDE._getShortcutKey(".")+"."+(this._data._idx+1),
                            type:"unknow"
                          })
                        }
                      }
                    }
                  }
                ],
                _jqext:{
                  click:function(e){
                    if(e.target==this){
                      let r=this.getBoundingClientRect(),v=10
                      if($(".bz-small-table").find(this)[0]){
                        v=5
                      }
                      if(e.clientY>r.top+v&&e.clientY<r.bottom-v&&e.clientX<r.right-10&&e.clientX>r.right-50){
                        _ideActionManagement._setActionItemForm("_showNoteForm",".bz-note-form",this._data._item!=_IDE._data._curAction,350)
                        if(_IDE._data._curAction==this._data._item){
                          e.stopPropagation()
                        }
                      }
                    }
                  }
                }
              },
            ]
          }
        ]
      }
    }

    let _main=_getItem(),
        _condition=_getItem("c"),
        _actions=_getItem()
    
    _main._dataRepeat=_dataRepeat

    _condition._dataRepeat=function(d){
      if(d._item.conditionAction){
        return [d._item.conditionAction]
      }
    }
    _actions._dataRepeat="_data._item.actions"

    _main._items.push(_condition,{
      _if:"_data._item.type==7&&_ideActionManagement._isOpenGroup(_data._item)",
      _tag:"div",
      _attr:{
        "class":"bz-group-actions"
      },
      _items:function(d){
        return [_ideActionManagement._getActionViewDef({_dataRepeat:"_data._item.actions"})]
      }
    })
    
    
    return _main
  },
  _isOpenGroup:function(a){
    t=_IDE._data._curTest
    _ideTestManagement._initOpenGroup(t)

    a=a&&a._actionIdx
    let b=(_IDE._data._curAction||{})._actionIdx||""
    if(t&&t._openGroups[a]){
      return 1
    }
    if(b!=a&&b.startsWith(a)&&t){
      t._openGroups[a]=1
      return 1
    }
  },
  _isEmptyTest:function(t){
    t=t||_IDE._data._curTest
    
    t=t._data||t
    return _Util._isEmpty(t.actions)
  },
  _isIfGroupCondition:function(a,t){
    t=_ideActionManagement._findGroupAction(a,t)
    return t&&t.conditionAction==a
  },
  _findGroupAction:function(a,t){
    let tt= _ideActionManagement._getCurGroup(a,t)
    return tt==t?0:tt
  },
  _inGroupAction:function(a,t){
    a=a||_IDE._data._curAction
    if(!a._actionIdx){
      _ideTestManagement._refreshActionIdx(t)
    }
    return a._actionIdx.includes("-")
  },
  _inTest:function(t,a){
    if(a._actionIdx){
      return _ideActionManagement._findActionByPath(t,a._actionIdx)==a
    }else if(t._idxMap){
      return
    }else{
      _ideTestManagement._refreshActionIdx(t)
      return _ideActionManagement._inTest(t,a)
    }
  },
  _insert:function(a,ns,t,_after){
    if(ns.constructor!=Array){
      ns=[ns]
    }
    t=t||_IDE._data._curTest
    t=t._data||t
    _find(t.actions,a)

    function _find(as,a){
      return as.find((x,i)=>{
        if(x==a){
          if(a.actions&&!_after){
            a.actions.splice(0,0,...ns)
          }else{
            as.splice(i+1,0,...ns)
          }
          return 1
        }else if(x.actions){
          if(x.conditionAction==a){
            x.conditionAction=a
            x.actions.unshift(...ns)
            return 1
          }
          return _find(x.actions,a)
        }
      })
    }
  },
  _replace:function(a,ns,t){
    if(ns.constructor!=Array){
      ns=[ns]
    }
    t=t||_IDE._data._curTest
    t=t._data||t
    _find(t.actions,a)

    function _find(as,a){
      return as.find((x,i)=>{
        if(x==a){
          as.splice(i,1,...ns)
          return 1
        }else if(x.actions){
          if(x.conditionAction==a){
            x.conditionAction=as[0]
            return 1
          }
          return _find(x.actions,a)
        }
      })
    }
  },
  _surfByKeyboard:function(k){
    var a=_IDE._data._curAction,aa,t=_IDE._data._curTest
    if(k==38){
      aa=_getPreAction()
      if(!aa&&!a){
        aa=t._data.actions._last()
      }
    }else if(k==37){
      aa=_ideActionManagement._closeGroup(a)
      if(!aa){
        return
      }
    }else if(k==39){
      aa=_ideActionManagement._openGroup(a)
      if(!aa){
        return
      }
    }else if(k==40){
      aa=_getNextAction()
      if(!aa&&!a){
        aa=t._data.actions[0]
      }
    }
    BZ._setHash(_IDE._data._curModule,t,_ideActionManagement._getCurIdx(aa))

    function _getPreAction(t,a){
      t=t||_IDE._data._curTest
      t=t._data||t
      a=a||_IDE._data._curAction
      return _find(t.actions,a)
  
      function _find(as,a){
        for(var i=0;i<as.length;i++){
          let aa=as[i]
          if(aa==a){
            return  as[i-1]||1
          }else if(aa.actions){
            if(aa.conditionAction==a){
              return aa
            }
            var r=_find(aa.actions,a)
            if(r){
              return r==1?aa:r
            }
          }
        }
      }
    }
    function _getNextAction(t,a){
      t=t||_IDE._data._curTest
      t=t._data||t
      a=a||_IDE._data._curAction
      return _find(t.actions,a)
  
      function _find(as,a){
        for(var i=0;i<as.length;i++){
          let aa=as[i]
          if(aa==a){
            return  as[i+1]||1
          }else if(aa.actions){
            if(aa.conditionAction==a){
              return aa.actions[0]||1
            }
            var r=_find(aa.actions,a)
            if(r){
              return r==1?as[i+1]||1:r
            }
          }
        }
      }
    }  
  },
  _getCurIdx:function(a,t){
    a=a||_IDE._data._curAction
    if(!a._actionIdx){
      _ideTestManagement._refreshActionIdx(t)
    }
    return a._actionIdx
  },
  _findAction:function(t,_fun,p){
    t=t||_IDE._data._curTest
    t=t._data||t
    p=p||"";
    let r;
    
    (t.actions||[]).find((x,i)=>{
      let ii=i+1+"",
          pp=p?p+"-"+ii:ii
      if(_fun(x,i,pp,t.actions,t)){
        return r=x
      }else if(x.actions){
        if(x.conditionAction){
          if(_fun(x.conditionAction,"c",pp+"-c",x,x)){
            r=x.conditionAction
            return 1
          }
        }
        return r= _ideActionManagement._findAction(x,_fun,pp)
      }
    })
    return r
  },
  _findAll:function(t,_fun,p,rs){
    t=t._data||t
    p=p||"";
    rs=rs||[]
    
    Object.keys(t.actions||[]).forEach((k,i)=>{
      let x=t.actions[k],ii=i+1+""
      let pp=p?p+"-"+ii:ii
      if(_fun(x,i,pp,t.actions,t)){
        rs.push(x)
      }
      if(x.actions){
        if(x.conditionAction){
          if(_fun(x.conditionAction,"c",pp+"-c",x,x)){
            rs.push(x.conditionAction)
          }
        }
        _ideActionManagement._findAction(x,_fun,pp,rs)
      }
    })
    return rs
  },
  _findActionByPath:function(t,p,_ignoreMissAction){
    if(p=="actions"){
      return
    }
    t=_ideObjHandler._getDataByItem(t||_IDE._data._curTest)
    if(t){
      if(window.extensionContent){
        return _find(t._data.actions,p)
      }else if(!t._idxMap){
        _ideTestManagement._refreshActionIdx(t)
      }
      return t._idxMap[p]||(_ignoreMissAction&&_find(t._data.actions,p))
    }

    function _find(as,p){
      for(var i=0;i<as.length;i++){
        let a=as[i]
        if(a._actionIdx==p){
          return a
        }else if(a.actions){
          if(a.conditionAction&&a.conditionAction._actionIdx==p){
            return a.conditionAction
          }
          let r=_find(a.actions,p)
          if(r){
            return r
          }else if(_ignoreMissAction){
            return a
          }
        }
      }
    }
  },
  _getCurGroup:function(a,t){
    a=a||_IDE._data._curAction
    t=t||_IDE._data._curTest
    if(t&&a){
      t=_ideObjHandler._getDataByItem(t)
      if(t){
        if(!t._idxMap){
          _ideTestManagement._refreshActionIdx(t)
        }
        let p=a._actionIdx
        if(p){
          p=p.split("-")
          p.pop()
          p=p.join("-")
          if(p){
            return t._idxMap[p]
          }else{
            return t._data
          }
        }
      }
    }
  },
  _switchGroup:function(a){
    let g=_IDE._data._curTest._openGroups
    if(!a.actions){
      a=_ideActionManagement._getCurGroup(a)
      if(!a||a.code){
        return
      }
    }
    a=a._actionIdx
    if(g[a]){
      g[a]=0
      delete g[a]
    }else{
      g[a]=1
    }
  },
  _openGroup:function(a){
    if(!a.actions){
      a=_ideActionManagement._getCurGroup(a)
      if(!a||a.code){
        return
      }
    }
    let gs=_IDE._data._curTest._openGroups
    if(gs[a._actionIdx]){
      return a.conditionAction||a.actions[0]
    }else{
      gs[a._actionIdx]=1
    }
  },
  _closeGroup:function(a){
    if(!a.actions){
      a=_ideActionManagement._getCurGroup(a)
    }
    let gs=_IDE._data._curTest._openGroups
    while(a&&!gs[a._actionIdx]){
      a=_ideActionManagement._getCurGroup(a)
    }
    if(a){
      _CtrlDriver._cleanData(gs,a._actionIdx)
      return a
    }
  },
  _getScreenshotPathByName:function(n){
    return SERVER_HOST+"/screenshot/"+pId+"/"+n+".jpg"
  },
  _hasStoreScreenshot:function(a){
    a=a||_IDE._data._curAction
    if(!a.cameraId&&a.ai){
      let o=_aiPageHandler._getAIObjByAction(a)
      if(o){
        a.cameraId=o.cameraId
      }
    }
    return a.cameraId
  },
  _hasNewScreenshot:function(a){
    let t=_IDE._data._curTest
    if(t){
      a=a||_IDE._data._curAction
      let r=t._result
      if(r){
        return (r[_ideActionManagement._getCurIdx(a)]||{})._img
      }
    }else if(_ideTask._data._lastResult){
      return _ideTask._data._lastResult._data.ai==a.ai&&_ideTask._data._lastResult._img
    }
  },
  _removeNewScreenshot:function(a){
    a=a||_IDE._data._curAction
    let r=_IDE._data._curTest&&_IDE._data._curTest._result
    if(r){
      delete _CtrlDriver._cleanData(r[_ideActionManagement._getCurIdx(a)]||{},"_img")
    }else if(_ideTask._data._lastResult){
      _CtrlDriver._cleanData(_ideTask._data._lastResult,"_img")
    }
  },
  _hasScreenshot:function(a){
    return _ideActionManagement._hasStoreScreenshot(a)||_ideActionManagement._hasNewScreenshot(a)
  },
  _hasMultipleNewScreenshot:function(){
    let r=_IDE._data._curTest&&_IDE._data._curTest._result
    if(r){
      return Object.values(r).filter(v=>v._img).length>1
    }
  },
  _takeScreenshot:function(a,_fun){
    if(!_ideTask._isExeInApp(a)){
      return
    }
    let s=BZ._userHabit,
    bv=s.takeScreenshot;

    s.takeScreenshot=1

    _ideTask._start({
      type:0,
      element:a.element||a.path,
      content:{
        type:"exist"
      },
      _actionIdx:a._actionIdx
    },function(){
      let r=_ideTask._data._lastResult
      if(r){
        let v=r._canvas||r._img
        if(v){
          delete r._canvas
          delete r._img
          _screenshotManagement._save([{
            md5:_calcMD5(v),
            value:v
          }],function(ds){
            ds=ds[0]._id
            a.cameraId=ds
            if(a.ai){
              let o=_ideActionManagement._getAIItemAndModuleByAIAction(a)
              if(o){
                o.v.cameraId=ds
                _ideModuleManagement._save(_ideObjHandler._getDataByPath(o.m))
              }
            }else if(a.code){
              _ideModuleManagement._save()
            }else{
              _ideTestManagement._save()
            }
            let t=_IDE._data._curTest
            if(t&&t._result){
              let _idx=_ideActionManagement._getCurIdx(a)
              t._result[_idx]._img=0
            }
            _fun&&_fun()
          })
        }
      }

      s.takeScreenshot=bv
    })
  },
  _showActionScreenshot:function(a,_key){
    a=a||_IDE._data._curAction
    BZ._data._uiSwitch._showScreenshotType=_key
    if(_ideActionManagement._screenshotPopWin&&!_ideActionManagement._screenshotPopWin.closed){
      _ideActionManagement._screenshotPopWin.close()
    }

    _ideActionManagement._screenshotPopWin=_Util._popWin("","_actionScreenshot",0,0,0,{
      _tag:"div",
      _attr:{
        class:"bz-v-panel",
        style:"width:100%;height:100%;"
      },
      _items:[
        {
          _tag:"div",
          _attr:{
            style:"display:flex;padding:10px;width: 100%;background-color: var(--background-color-layer1) !important;"
          },
          _items:[
            //delete
            {
              _if:function(){
                return _ideActionManagement._hasStoreScreenshot(_IDE._data._curAction||a)
              },
              _tag:"button",
              _attr:{
                class:"btn btn-warn bz-space-5",
                enable:1,
                disabled:"!BZ._isCheckout(0,1)"
              },
              _items:[
                {
                  _tag:"span",
                  _attr:{
                    class:"bz-delete bz-right-space-5"
                  }
                },
                {
                  _tag:"span",
                  _text:"_bzMessage._method._delete"
                }
              ],
              _jqext:{
                click:function(){
                  if(_IDE._data._curTest){
                    _Util._confirmMessage(_bzMessage._test._deleteScreenshotDesc,[
                      {
                        _title:_bzMessage._method._deleteAll,
                        _class:"btn-warn",
                        _click:function(c){
                          _delete(_ideActionManagement._findAll(_IDE._data._curTest,v=>v.cameraId).filter(v=>v).map(x=>x.cameraId),c)
                        }
                      },
                      {
                        _title:_bzMessage._method._delete,
                        _class:"btn-warn",
                        _click:function(c){
                          _delete([(_IDE._data._curAction||a).cameraId],c)
                        }
                      }
                    ])
                  }else{
                    _delete([(_IDE._data._curAction||a).cameraId])
                  }
                  function _delete(ds,c){
                    _screenshotManagement._remove(ds,function(vs){
                      let ms=new Set()
                      if(_IDE._data._curTest){
                        _ideActionManagement._findAction(_IDE._data._curTest,v=>{
                          if(vs.includes(v.cameraId)){
                            if(v.ai){
                              _handleAIData(v,ms,function(vv){
                                _CtrlDriver._cleanData(vv,"cameraId")
                              })
                            }
                            _CtrlDriver._cleanData(v,"cameraId")
                          }
                        })
                      }else if(a){
                        _handleAIData(a,ms,function(vv){
                          _CtrlDriver._cleanData(vv,"cameraId")
                        })
                      }
                      ms=[...ms]
                      if(ms.length){
                        _ideModuleManagement._batchUpdate(ms.map(x=>_ideObjHandler._getDataByPath(x)))
                      }else{
                        _ideTestManagement._save()
                      }

                      c&&c._ctrl._close()
                    })
                  }
                }
              }
            },
            //save
            {
              _if:function(){
                return _ideActionManagement._hasNewScreenshot(_IDE._data._curAction||a)
              },
              _tag:"button",
              _attr:{
                class:"btn btn-primary bz-space-5",
                enable:1,
                disabled:"!BZ._isCheckout(0,1)"
              },
              _items:[
                {
                  _tag:"span",
                  _attr:{
                    class:"bz-save bz-right-space-5"
                  }
                },
                {
                  _tag:"span",
                  _text:"_bzMessage._method._save"
                }
              ],
              _jqext:{
                click:function(){
                  let d=_IDE._data._curAction||a;
                  if(_ideActionManagement._hasMultipleNewScreenshot()){
                    _Util._confirmMessage(_bzMessage._test._saveScreenshotDesc,[
                      {
                        _title:_bzMessage._method._saveAll,
                        _click:function(c){
                          _save(_ideActionManagement._findAll(_IDE._data._curTest,a=>a),c)
                        }
                      },
                      {
                        _title:_bzMessage._method._save,
                        _class:"btn-primary",
                        _click:function(c){
                          _save([d],c)
                        }
                      }
                    ])
                  }else{
                    _save([d])
                  }

                  function _save(ds,c){
                    ds=ds.map(x=>_buildData(x)).filter(x=>x)
                    _screenshotManagement._save(ds.map(x=>x.d),function(rs){
                      let _store,ms=new Set();
                      ds.forEach(x=>{
                        rs.find((y,i)=>{
                          if(y._id==x._id||y.md5==x.d.md5){
                            if(x.a.ai){
                              _handleAIData(x.a,ms,function(vv){
                                _CtrlDriver._cleanData(vv,"cameraId")
                                vv.cameraId=x.a.cameraId=y._id
                              })
                            }else{
                              x.a.cameraId=y._id
                            }

                            rs.splice(i,1)
                            _store=1
                            _ideActionManagement._removeNewScreenshot(x.a)
                            return 1
                          }
                        })
                      })

                      if(_store){
                        ms=[...ms]
                        if(ms.length){
                          _ideModuleManagement._batchUpdate(ms.map(x=>_ideObjHandler._getDataByPath(x)))
                        }else{
                          _ideTestManagement._save()
                        }
                      }

                      c&&c._ctrl._close()
                    })
                  }

                  function _buildData(v){
                    let d=_ideActionManagement._hasNewScreenshot(v)
                    if(d){
                      return {
                        a:v,
                        d:{
                          _id:v.cameraId,
                          md5:_calcMD5(d),
                          value:d
                        }
                      }
                    }
                  }
                }
              }
            },
            {
              _if:function(){
                let d=_IDE._data._curAction||a;
                return _ideActionManagement._hasStoreScreenshot(d)&&_ideActionManagement._hasNewScreenshot(d)
              },
              _tag:"div",
              _attr:{
                class:"bz-switcher-bar"
              },
              _items:[
                {
                  _tag:"button",
                  _attr:{
                    enable:1,
                    class:function(d){
                      let c="bz-switcher-item "
                      if(BZ._data._uiSwitch._showScreenshotType==d._item){
                        return c+"btn btn-select"
                      }else{
                        return c+"btn btn-unselect"
                      }
                    }
                  },
                  _text:"_bzMessage._common[_data._item]",
                  _dataRepeat:["_old","_new"],
                  _jqext:{
                    click:function(){
                      BZ._data._uiSwitch._showScreenshotType=BZ._data._uiSwitch._showScreenshotType=="_new"?"_old":"_new"
                    }
                  }
                }
              ]
            },
            //take image button
            {
              _if:function(){
                return !_ideActionManagement._hasScreenshot(_IDE._data._curAction||a)
              },
              _after:function(o){
                let w=o.ownerDocument.defaultView
                w.resizeTo(200,130)
              },
              _tag:"button",
              _attr:{
                class:"btn btn-secondary bz-space-5",
                enable:1
              },
              _items:[
                {
                  _tag:"span",
                  _attr:{
                    class:"bz-camera bz-right-space-5"
                  }
                },
                {
                  _tag:"span",
                  _text:"_bzMessage._method._takeScreenshot"
                }
              ],
              _jqext:{
                click:function(){
                  _ideActionManagement._takeScreenshot(_IDE._data._curAction||a)
                }
              }
            },
          ]
        },
        //image
        {
          _if:function(){
            if(_IDE._data._curTest){
              let d=_IDE._data._curAction||a;
              return d&&_ideActionManagement._hasScreenshot(d)
            }
          },
          _tag:"div",
          _attr:{
            style:"height: calc(100% - 80px);margin:auto;padding:10px;text-align: center;background: var(--bz-grey);"
          },
          _items:[
            {
              _tag:"img",
              _attr:{
                src:function(dd,c,o){
                  let d=(_IDE._data._curAction||a)
                  let v=_ideActionManagement._hasNewScreenshot(d),
                  id=d.cameraId;

                  if(v&&(BZ._data._uiSwitch._showScreenshotType=="_new"||!id)){
                    BZ._data._uiSwitch._curScreenshot=v
                  }else if(id){
                    _screenshotManagement._get(id,function(d){
                      BZ._data._uiSwitch._curScreenshot=d.value
                    })
                  }
                  return BZ._data._uiSwitch._curScreenshot
                },
                style:"max-width: 100%;max-height: 100%;"
              },
              _after:function(o){
                _IDE._layout(0,o.ownerDocument.defaultView)
              }
            }
          ]
        }
      ]
    },_bzMessage._common._screenshot)


    if(_ideActionManagement._screenshotPopWin&&!_ideActionManagement._screenshotPopWin.closed){
      _IDE._layout(0,_ideActionManagement._screenshotPopWin)
    }

    function _handleAIData(v,ms,_fun){
      let m=_ideActionManagement._getAIItemAndModuleByAIAction(v)
      if(m){
        ms.add(m.m)
        _fun(m.v)
      }else{
        if(v.cameraId){
          ms.add(_IDE._data._curModule._data.code)
          _fun(v)
        }
      }
    }
  },
  _getAIItemAndModuleByAIAction:function(a){
    let vv=_aiPageHandler._getAIObjByAction(a),m
    if(vv){
      a.ai.split(",").find(x=>{
        x=x.split(":")
        if(x[0]=="module"){
          m=x[1]
          return 1
        }
      })
      return {m:m,v:vv}
    }

  },
  _getSearchData:function(a){
    let w=""
    for(let k in a){
      if(k=="key"||k=="_actionIdx"){
        continue
      }
      let v=a[k]
      if(v){
        if(k=="failedReaction"){
          w+=" "+_bzMessage._action._failedReaction
        }else if(k=="noLightAction"){
          w+=" "+_bzMessage._action._noLightAction
        }else if(k=="errOnHidden"){
          w+=" "+_bzMessage._action._markErrorOnHidden
        }else if(k=="force"){
          w+=" "+_bzMessage._action._allowExeOnHiddenElement
        }else if(k=="runInIDE"){
          w+=" ide runInIDE"
        }else if(k=="autoDelay"){
          w+=" "+_bzMessage._action._autoDelay
        }else if(k=="retryable"){
          w+=" "+_bzMessage._action._retryable
        }else if(k=="type"){
          w+=" "+_bzMessage._action._type[_ideActionData._keys[v]]
        }else if(k=="requests"){
          a.requests.forEach(r=>{
            w+=" "+r.url+" "+r.method+" "+(r.query||"").toString()+" "+(r.body||"").toString
          })
        }else{
          if(k=="script"){
            w+=" script"
          }else if(k=="loopData"){
            w+=" "+_bzMessage._api._loopScript
          }else if(k=="resultscript"){
            w+=" "+_bzMessage._api._responseScript
          }else if(k=="preScript"){
            w+=" "+_bzMessage._api._preScript
          }else if(k=="event"){
            if(v.download){
              w+=" "+_bzMessage._method._download
            }
            if(v.repElementMethod){
              w+=" "+_bzMessage._action._repElementMethod
              w+=" "+_bzMessage._action._repElementOptions[v.repElementMethod]
            }
          }
          w+=" "+_valToString(v)
        }
      }
    }

    return w

    function _valToString(v){
      if(!v){
        return JSON.stringify(v)+""
      }else if(v.constructor==Function){
        return v.toString()
      }else if(v.constructor==Array){
        return v.map(x=>_valToString(x)).join(" ")
      }else if(v.constructor==Object){
        return Object.values(v).filter(x=>x).map(x=>_valToString(x)).join(" ")
      }
      return v
    }
  },
  _getMouseTypeViewDef:function(a){
    return _stdComponent._getSelectViewDef({
      _if:function(ae,c,o){
        if(a.constructor==String){
          eval("ae="+a)
        }
        if(ae.event){
          if(ae.event.button==2){
            ae.event.action="rightclick"
          }else if(ae.event.action=="rightclick"){
            ae.event.button=2
          }
          return 1
        }
      },
      _data:a,
      _label:"_bzMessage._common._event",
      _disabled:"!BZ._isCheckout(0,1)",
      _dataModel:a.constructor==String?a+".event.action":"_data.event.action",
      _dataRepeat:[
        {_value:"click",_text:"_click"},
        {_value:"rightclick",_text:"_rightClick"},
        {_value:"dblclick",_text:"_dblclick"},
        {_value:"dragdrop",_text:"_dragDrop"},
        {_value:"drag",_text:"_drag"},
        {_value:"hover",_text:"_hover"},
        {_value:"mousedown"},
        {_value:"mouseup"},
        {_value:"mousemove"},
        {_value:"mouseover"},
        {_value:"mouseout"}/*,{_value:"DOMMouseScroll"}*/
      ],
      _text:function(d){
        let w=_bzMessage._action._methodDesc._trigger[d._item._text]||d._item._value;
        w=w.toLowerCase()
        if(d._supData.event.download){
          w+=" ("+_bzMessage._method._download.toLowerCase()+")"
        }
        return w
      },
      _value:"_data._item._value",
      _jqext:{
        change:function(){
          let d=this._data.event
          delete d.button
          if(this.value=="dragdrop"){
            _CtrlDriver._updateObj(d,"repElementMethod")
          }else if(this.value=="rightclick"){
            d.button=2
          }
        }
      },
      _boxStyle:function(d){
        let c="flex:1;display:flex;"
        if(d.event.repElementMethod){
          c+="position: relative;right: -2px;margin-left: -1px;"
        }else{
          
        }
        return c
      }
    })
  },
  _getTimerDesc:function(a){
    a=a||_IDE._data._curAction,s=""
    if(a.min||a.max){
      if(a.min){
        s=_bzMessage._action._delay+": "+a.min+"ms\n"
      }
      if(a.max){
        s+=_bzMessage._api._timeout+": "+a.max+"ms"
      }
      return s.trim()
    }else{
      return _bzMessage._action._setTimer
    }
  },
  _setActionItemForm:function(k,_form,_force,h){
    if(!BZ._data._uiSwitch[k]||_force){
      $(document.body).click()
      setTimeout(()=>{
        let os=$(".bz-action-list").children().toArray()
        os.find(o=>{
          if(o._data._item==_IDE._data._curAction){
            BZ._setTmpUISwitch(k,[o,_form.substring(1)])
            setTimeout(()=>{
              let f=$(_form)[0]
              o=o.getBoundingClientRect()
              let v=o.bottom-20
              if(window.innerHeight-v<h){
                v=o.top-h
              }

              $(f).css({
                top:v+"px",
                display:"block"
              }).find("input:eq(0)").focus()
            },100)
            return 1
          }
        })
      },10)
    }
  },
  _getFlagDesc:function(){
    let f=_IDE._data._curAction.flag
    if(f){
      return _bzMessage._common._flag+": "+f
    }else{
      return _bzMessage._action._setFlag
    }
  },
  _showRefMenu:function(d,e){
    d=d._data._item
    
    if(d.type==4&&!d.refOfSuccess){
      setTimeout(()=>{
        $(".bz-select-input").focus();
        $(".bz-select-input").focus()
      },100)
    }
    if(_IDE._data._curAction==d){
      e.stopPropagation()
    }
  },
  _setSubMenuPos:function(k){
    let c=$(".bz-action-menu")[0].getBoundingClientRect()
    c=`margin-left:${c.left+c.width*1.5}px;`
    return c+`top:${$(".pop-menu-item ."+k)[0].getBoundingClientRect().top-13}px`

  },
  _isHideElementTdInList:function(d){
    return ('467'.includes(d.type)||("02".includes(d.type)&&d.method==2)||((d.type==3||(!d.type&&d.method==1))&&(!d.element||!d.element.length)))
  },
  //a: action
  //k: refOfSuccess/refOfFailed/refOfError
  //t: test case key,
  //w: way, .,..,...,....
  //r: result: s,w,f,e
  //l: loop number
  _setCondition:function(a,k,t,w,r,l){
    let v=a[k]||""
    let tt=t===undefined?v.match(_IDE._testKeyRegex)||v.match(_IDE._insertJSRegex)||"":"",
        ww=!w?v.match(/(^|\/)(\.+)($|\/)/):"",
        rr=!r?v.match(/(^|\/)(c|s|f|e|w)($|\/)/):"",
        ll=l===undefined?v.match(/(^|\/)([0-9]+)($|\/)/):""
    if(tt&&tt.constructor==Array){
      tt=tt[0]
    }
    ww&&(ww=ww[2])
    rr&&(rr=rr[2])
    ll&&(ll=ll[2])
    w=w||ww||""
    r=r||rr||"";
    l=l||parseInt(ll)||""
    switch(k){
      case "refOfSuccess":
        if(w=="."){
          w=""
        }else{
          delete a.successGoto
        }
        if(r=="s"){
          r=""
        }
        break
      case "refOfFailed":
        if(w!="."){
          delete a.failedGoto
        }
        if(r=="f"){
          r=""
        }
        break
      case "refOfError":
        if(w==".."){
          w=""
        }
        if(w!="."){
          delete a.errorGoto
        }
        if(r=="e"){
          r=""
        }
    }
    t=t||tt||"";
    t&&(t+="/")
    w&&(w+="/")
    r&&(r+="/")
    l&&(l+="/")
    a[k]=t+w+r+l
  },
  _getTestFromRef:function(v){
    return (v||"").replace(/([\/]|^)[sfew]($|[\/])/g,"/")
            .replace(/([\/]|^)[\.]+($|[\/])/g,"/")
            .replace(/([\/]|^)[0-9]+($|[\/])/g,"/")
            .replace(/[\/]+/,"")
  },
  _batchUpdateRef:function(_curAction,t,m,_value,_hideProcess,_fun){
    let _oldValue=((_curAction.refOfSuccess||"").match(_IDE._testKeyRegex)||[])[0],
        _txt=_curAction.description
    let _valTest,_refTest;
    _curAction.refOfSuccess=_curAction.refOfSuccess||""
    _value=_value||""
    if(_oldValue==_value){
      return
    }
    if(_oldValue){
      _curAction.refOfSuccess=_curAction.refOfSuccess.replace(_oldValue,_value)
    }else{
      _curAction.refOfSuccess+="/"+_value+"/"
    }
    _curAction.refOfSuccess=_curAction.refOfSuccess.replace(/[\/]+/g,"/").replace(/^[\/]$/,"")
    _ideTestManagement._save(t,m)
//_ideActionManagement._getRefDesc(_curAction,"refOfSuccess"),
    if(_txt&&_value){
      _valTest=_ideObjHandler._getDataByPath(_value)
      if(_valTest&&_oldValue){
        _refTest=_ideObjHandler._getDataByPath(_oldValue)
      }
    }else{
      return
    }
    $("._updateTestOneByOne").find("btn-cancel").click()
    BZ._data._uiSwitch._showBatchUpdateTests=[]

    _Util._confirmMessage({
      _tag:"div",
      _attr:{"class":"_updateTestOneByOne"},
      _items:[
        {
          _if:"!BZ._data._uiSwitch._showBatchUpdateTests.length",
          _tag:"div",
          _text:function(){
            if(_refTest){
              return _Util._formatMessage(
                _bzMessage._test._batchUpdateTest,
                [_txt,_refTest._data.name,_valTest._data.name]
              )
            }else{
              return _Util._formatMessage(
                _bzMessage._test._batchNewTest,
                [_txt,_valTest._data.name]
              )
            }
          }
        },
        {
          _if:"BZ._data._uiSwitch._showBatchUpdateTests.length",
          _tag:"div",
          _items:[
            {
              _tag:"div",
              _text:function(){
                if(BZ._data._uiSwitch._showBatchUpdateTests.length){
                  return _bzMessage._system._info._updateList
                }else{
                  return _bzMessage._system._info._updating
                }
              }
            },
            {
              _tag:"div",
              _items:[
                {
                  _tag:"a",
                  _attr:{"class":"bz-nowrap-item"},
                  _jqext:{
                    click:function(){
                      let d=this._data._item
                      BZ._setHash(d.m.code+"."+d.t.code)
                    }
                  },
                  _text:function(d){
                    let i=d._idx+1
                    d=d._item
                    return i+". ["+d.m.code+"."+d.t.code+"] "+ BZ._groupWords([d.m.name,d.t.name])
                  }
                }
              ],
              _dataRepeat:"BZ._data._uiSwitch._showBatchUpdateTests"
            }
          ]
        }
      ]
    },[{
      _title:_bzMessage._method._yes,
      _class:"btn-primary bz-ok",
      _click:function(c){
        if(_hideProcess){
          c._ctrl._close()
        }
        _ideVersionManagement._loadAllData(function(){
          _ideVersionManagement._updateTestOneByOne(function(t,m,_fun){
            if(t.type=="scenario"){
              let _update=0
              if(!_oldValue){
                _ideActionManagement._findAction(t,a=>{
                  if(a.type==4&&!a.refOfSuccess){
                    if(a.description==_txt){
                      a.refOfSuccess=_value
                      _update=1
                    }
                  }
                })
              }else{
                _ideActionManagement._findAction(t,a=>{
                  if(a.type==4&&a.refOfSuccess){
                    let mm=a.refOfSuccess.match(_IDE._testKeyRegex)||[]
                    if(mm[0]==_oldValue&&a.description==_txt){
                      a.refOfSuccess=a.refOfSuccess.replace(_oldValue,_value)
                      _update=1
                    }
                  }
                })
              }
              if(_update){
                BZ._data._uiSwitch._showBatchUpdateTests.push({t:t,m:m})
                _Util._resizeModelWindow()
                return _ideTestManagement._save(t,m,function(){
                  _fun&&_fun()
                })
              }
            }
            _fun&&_fun()
          },function(){
            if(!BZ._data._uiSwitch._showBatchUpdateTests.length){
              c._ctrl._close()
            }
          })
        })

        $(".bz-ok").remove()
        $(".btn-cancel").text(_bzMessage._method._close)
      }
    }])
  },
  _formatRefreshData:function(v){
    return (v||"").split(",").map(a=>{return a.trim()}).join(",")
  },
  _isAdvAction:function(a){
    if(a.event){
      a=a.event
      return a.element||a.repElementMethod||a.action!="click"
    }
  },
  _setStepKey:function(a,t){
    _ideActionManagement._findAction(t,(x,i,p,as,pa)=>{
      if(x==a){
        if(!i){
          a.stepKey=pa.groupType
        }else{
          a.stepKey="and"
        }
      }
    })
  },
  _getStdAPIScript:function(m,_type){
    m=_aiGeneratorDataHandler._getModuleObject(m);
    let fk=_aiGeneratorDataHandler._getBestKeyFieldName(m)||"",c;
    if(fk){
      fk=', \"'+fk+'"'
    }
    m=m._data
    m=m.alias||m.code
    if(_type=="POST"||_type=="GET"){
      c=`      $aiAPI.addData(v);\n`
    }else if(_type=="DELETE"){
      c=`    $aiAPI.deleteData($project.${_aiGeneratorDataHandler._getCurModuleDataName(m)},"${m}"${fk});\n`
    }else{
      c=`      $aiAPI.updateData(v,"${m}"${fk});\n`
    }
    if(_type=="DELETE"){
      return "(function(){\n"
            +"  let success = $result.status && $result.status < 400;\n"
            +"  if(success){\n"
            +c
            +"  }\n"
            +"  return success;\n"
            +"})()";
    }else{
      return "(function(){\n"
            +"  let success = $result.status && $result.status < 400;\n"
            +"  if(success){\n"
            +"    let v = $result.responseText;\n"
            +"    try{\n"
            +"      v=JSON.parse(v);\n"
            +c
            +"    }catch(e){}\n"
            +"  }\n"
            +"  return success;\n"
            +"})()";
    }
  },
  _getCurRefKey:function(t){
    if(_IDE._data._curAction.type==4){
      t="success"
    }
    if(t){
      t=t.toLowerCase()+'Parameter'
    }else{
      t="parameter"
    }
    return t
  },
  _getIframeIdxByElementPath:function(e){
    if(e){
      e=(e[0]||"").match(/findIframe\(([0-9]+)\)/)||[]
      return e[1]||0
    }else{
      return 0
    }
  },
  _showAPISetting:function(_curParameterKey){
    let s=BZ._data._uiSwitch,v,w;
    setTimeout(()=>{
      let d=s._apiRequest=_IDE._data._curAction.requests[_curParameterKey]
      if(!d){
        return
      }
      _testTabHandler._data._curCfgTab="details"
      
      s._apiTab=s._apiTab||"_try"

      s._apiAuth=_aiAuthHandler._data[_aiAuthHandler._getCurHostIdx()]
      if(s._apiAuth.token&&s._apiAuth.token.constructor==String){
        s._tokenTest=_ideObjHandler._getDataByPath(s._apiAuth.module,s._apiAuth.token)
      }else if(s._apiAuth.token){
        s._tokenTest=s._apiAuth.token
      }
      
      v=w=d.data||""
      if(v&&v.match&&!_Util._hasCode(v)&&(!d.contentType||d.contentType.toLowerCase().includes("json"))){
        v=_Util._parameterToObj(v)
        v=_Util._strToJson(v)
        if(v.constructor==Object){
          v=JSON.stringify(v,0,2)
        }
      }
      // d._tmpParameter=v
      d.data=v

      var h=_Util._parseJSONWithRefDataToObj(d.headers)
      
      if(d.autoToken){
        var ks=_aiAuthHandler._getHostTokenNames(_aiAuthHandler._getCurHostIdx());
        if(ks){
          let token=_aiAuthHandler._data[d.host].tokenValue||{}

          ks.forEach(k=>{
            let tk=token[k]||BZ._bzTokenData
            if(!h.find(x=>{
              if(x._key==k){
                x._value=JSON.stringify(tk)
                return 1
              }
            })){
              h.push({
                _key:k,
                _value:JSON.stringify(tk)
              })
            }
          })
        }
      }
      h.find((x,i)=>{
        if(x._key=="Content-Type"){
          eval("d.contentType="+x._value)
          // h.splice(i,1)
          return 1
        }
      })

      d.headers=_Util._refDataToJSON(h)
    },10)
  },
  _showRefreshAdvSetting:function(a){
    let r= BZ._data._uiSwitch._showAdvRefresh==a||a.clearCookie||a.clearLocalStorage||!_Util._isEmpty(a.refreshData)
    if(r){
      BZ._data._uiSwitch._showAdvRefresh=a
      return r
    }
  },
  _getWaitIcon:function(v,b){
    if(!v){
      return ""
    }
    var k = v.min?"bz-timer-min bz-pressed-icon":v.max?"bz-timer-max bz-pressed-icon":"bz-timer bz-grey";
    var _curAdvanced=_ideTestManagement._getSysSetting()._curAdvanced;
    var _pTimer=parseInt(_curAdvanced.performanceReminder)
    
    if(parseInt(v.min||0)>parseInt(v.max||0)){
      v=v.min
    }else{
      v=v.max
    }
    v=v||0
    if(v>_pTimer+10000){
      k+=" bz-red-data-point"+(b||"")
    }else if(v-1000>_pTimer){
      k+=" bz-blue-data-point"+(b||"")
    }
    return k
  },
  _disbandGroup:function(a){
    let g=_ideActionManagement._getCurGroup(a)
    let i=g.actions.indexOf(a)
    g.actions.splice(i,1)
    if(a.conditionAction){
      g.actions.splice(i++,0,a.conditionAction)
    }
    g.actions.splice(i,0,...a.actions)
    _ideTestManagement._save()
  },
  _newGroup:function(vs){
    BZ._data._uiSwitch._newGroup={_validationType:1}
    _Util._confirmMessage({
      _tag:"div",
      _data:BZ._data._uiSwitch._newGroup,
      _items:[
        {
          _tag:"div",
          _attr:{
            "class":"input-group"
          },
          _items:[
            {
              _tag:"label",
              _attr:{
                "class":"input-group-addon"
              },
              _text:"_bzMessage._common._description"
            },
            {
              _tag:"input",
              _attr:{
                "class":"form-control"
              },
              _dataModel:"_data._name"
            }
          ],
        },
        {
          _tag:"div",
          _items:[
            {
              _tag:"div",
              _attr:{
                "class":"bz-space-10"
              },
              _items:[
                {
                  _tag:"label",
                  _items:[
                    {
                      _tag:"input",
                      _attr:{
                        type:"radio",
                        value:"_data._idx?_data._item:''",
                        onclick:"_Util._resizeModelWindow()"
                      },
                      _dataModel:"_data._supData._type"
                    },
                    {
                      _html:"'<span>'+_Util._formatMessage(_bzMessage._action._asGroup,['<b>'+(_data._item||_bzMessage._action._general)+'</b>'])+'</span>'"
                    }
                  ]
                }
              ]
            },
            {
              _if:"_data._item=='switch'&&_data._item==_data._supData._type",
              _tag:"div",
              _attr:{
                style:"margin:10px 0;",
                "class":"input-group"
              },
              _items:[
                {
                  _tag:"label",
                  _attr:{
                    "class":"input-group-addon required"
                  },
                  _text:"_bzMessage._common._flag"
                },
                {
                  _tag:"input",
                  _attr:{
                    "class":"form-control",required:1
                  },
                  _focus:1,
                  _dataModel:"BZ._data._uiSwitch._newGroup._flag"
                }
              ]
            },
            _bzJSEditor._buildJSEditor({
              _if:"_data._item=='for'&&_data._item==_data._supData._type",
              _model:"BZ._data._uiSwitch._newGroup._script",
              _style: "height:100px;margin-bottom:10px;",
              _label:"",
              _noBtn:1,
              _noUpdate:1
            }),
            {
              _if:"_data._item==_data._supData._type",
              _tag:"div",
              _attr:{
                "class":"col-xs-12 bz-note-text",
                style:"margin:0 0 10px 0"
              },
              _text:"_bzMessage._action._groupOptions[_data._item]"
            }
          ],
          _dataRepeat:_ideActionData._groupType
        }
      ]
    },[
      {
        _title:_bzMessage._common._ok,
        _click:function(dlg){
          let g=BZ._data._uiSwitch._newGroup
          if(g._type=="switch"&&!g._flag){
            return alert(_Util._formatMessage(_bzMessage._system._error._requiredField,[_bzMessage._common._flag]))
          }
          
          _doIt(g)
          dlg._ctrl._close();
        }
      }
    ],_bzMessage._method._newGroup);
    function _doIt(g){
      var a=_CtrlDriver._buildProxy({
        type:_ideActionData._type._group,
        description:g._name,
        flag:g._flag,
        asOneAction:g._asOneAction,
        groupType:g._type,
        actions:[]
      });

      if(g._type=="else"||g._type=="else if"){
        a.elseGroup="on"
      }

      if(g._type=="while"){
        a.refOfFailed=a.refOfError="./"
      }else if(g._type=="for"){
        a.loopData=g._script
      }

      vs=vs||[]
      _ideActionManagement._sortSelectItems(vs)
      let ca=_IDE._data._curAction||vs[0]
      if(ca){
        _ideActionManagement._insert(ca,[a])
      }else{
        _IDE._data._curTest._data.actions.push(a)
      }
      _ideTestManagement._removeActions(_IDE._data._curTest,vs)
      a.actions=vs

      if((g._type=="if"||g._type=="else if")&&g._validationType){
        a.conditionAction={refOfFailed:".../w/",refOfError:".../w/"}
      }

      _ideActionManagement._setCurAction(a.conditionAction||a)

      _ideTestManagement._save()
    }
  },
  _newGroupTest:function(vs){
    _ideActionManagement._sortSelectItems(vs);
    BZ._data._uiSwitch._newGroupTest={
      _module:_IDE._data._curModule._data.code
    }
    _Util._confirmMessage({
      _tag:"div",
      _items:[
        {
          _tag:"div",
          _attr:{"class":"input-group"},
          _items:[
            {
              _tag:"label",
              _attr:{"class":"input-group-addon"},
              _text:"_bzMessage._common._module"
            },
            {
              _tag:"select",
              _attr:{"class":"form-control"},
              _dataModel:"BZ._data._uiSwitch._newGroupTest._module",
              _items:[
                {
                  _tag:"option",
                  _attr:{value:"_data._item._code"},
                  _text:"_data._item._name",
                  _dataRepeat:"_ideObjHandler._treeList"
                }
              ]
            }
          ]
        },
        {
          _tag:"div",
          _attr:{"class":"input-group"},
          _items:[
            {
              _tag:"label",
              _attr:{"class":"input-group-addon"},
              _text:"_bzMessage._common._name"
            },
            {
              _tag:"input",
              _attr:{"class":"form-control"},
              _dataModel:"BZ._data._uiSwitch._newGroupTest._name"
            }
          ]
        }
      ]
    },[
      {
        _title:_bzMessage._common._ok,
        _click:function(dlg){
          let m=BZ._data._uiSwitch._newGroupTest
          if(!m._name){
            return alert(_Util._formatMessage(_bzMessage._system._error._requiredField,[_bzMessage._common._name]))
          }
          _doIt(m._module,m._name)
          dlg._ctrl._close();
        }
      }
    ],_bzMessage._method._newGroupTest,400);
    function _doIt(m,n){
      let _hash=location.hash,t=_IDE._data._curTest
      m=_ideObjHandler._getDataByPath(m)._data;
      _ideTestManagement._save({
        name:n,
        type:"unit",
        actions:vs
      },m,function(v){
        BZ._setHash(_hash,undefined,undefined,function(){
          if(t==_IDE._data._curTest){
            var a=_CtrlDriver._buildProxy({type:_ideActionData._type._ref,refOfSuccess:m.code+"."+v._data.code+"/"});
            _ideActionManagement._insert(vs[0],[a])
            _ideTestManagement._removeActions(t,vs)

            _ideTestManagement._save()
            return 1
          }
        })
      })
    }
  },
  _sortSelectItems:function(vs){
    vs.sort((a,b)=>{
      a=a._actionIdx.split("-")
      b=b._actionIdx.split("-")
      let r;
      a.find((x,i)=>{
        r=x-b[i]
        return r
      })
      return r
    })
  },
  _selectActionType:function(a){
    let aa={}
    _Util._confirmMessage({
      _tag:"div",
      _data:aa,
      _items:[
        {
          _tag:"div",
          _attr:{
            class:"bz-space-10"
          },
          _text:"_bzMessage._method._selectActionType"
        },
        _stdComponent._getSelectViewDef({
          _label:"_bzMessage._common._type",
          _dataModel:"_data.type",
          _dataRepeat:["_validation","_extract","_mouse","_keyboard","_script","_plugin","_api"],
          _value:"_data._item",
          _text:"_bzMessage._action._actionMenuOptions[_data._item]",
        })
      ]
    },[{
      _title:_bzMessage._common._ok,
      _click:function(dlg){
        if(!aa.type){
          return alert(_bzMessage._system._error._requiredField)
        }
        if(aa.type=="_validation"){
          a.type=0
          a.method=0
          a.compareMark="=="
          a.content={type:"innerText"}
        }else if(aa.type=="_extract"){
          a.type=2
          a.method=0
        }else if(aa.type=="_mouse"){
          a.type=1
          a.method=0
          a.event={type:"mouse",action:"click"}
        }else if(aa.type=="_keyboard"){
          a.type=1
          a.method=0
          a.event={type:"change",autoBlur:"on"}
        }else if(aa.type=="_script"){
          a.runInIDE="on"
          a.type=3
          a.method=0
        }else if(aa.type=="_plugin"){
          a.type=4
        }else if(aa.type=="_api"){
          a.type=1
          a.method=0
          a.apiReplaceEvent="on"
          a.requests=[{
            method: "GET",
            url: "/",
            host: 1,
            contentType: "application/json",
            responseScript: "(function(){\n  let success = $result.status && $result.status < 400;\n  if(success){\n    let v = $result.responseText;\n    try{\n      v=JSON.parse(v);\n      $aiAPI.addData(v);\n    }catch(e){}\n  }\n  return success;\n})()",
            data: "",
            headers: "{}"
          }]
        }
        
        dlg._ctrl._close()
        _ideTestManagement._save()
      }
    }],_bzMessage._method._selectActionType)
  },
  _isGroupable:function(vs,_group){
    var r;
    _ideActionManagement._sortSelectItems(vs)
    _ideActionManagement._findAction(_IDE._data._curTest,(x,i,p,as)=>{
      if(x==vs[0]){
        if(as.constructor==Array){
          r=!vs.find(y=>!as.includes(y))
        }
        return 1
      }
    })
    return r
  },
  _setCurAction:function(a){
    BZ._data._uiSwitch._apiRequest=0
    if(!BZ._isPlaying()){
      let o=_IDE._data._curAction
      if(o){
        BZ._data._uiSwitch._curActionDataList=_debugDataHandler._retrieveBindDataFromAction(o)
      }
      if(window._testTabHandler&&o&&a&&a.type==3&&o.type!=3){
        _testTabHandler._data._keepActionTab=a||0
        _IDE._data._curAction=0
        return setTimeout(()=>{
          _testTabHandler._data._keepActionTab=0
          _doIt()
        })
      }
    }
    _doIt()
    function _doIt(){
      _IDE._data._curAction=a||null;
      BZ._data._uiSwitch._selectedItems=[];
      
      if(a){
        let ss=[a];
        if(a&&a.type===undefined){
          _ideActionManagement._selectActionType(a)
        }else if(a.type==7&&(a.groupType=="if"||a.groupType=="else if")){
          if(!a.conditionAction){
            a.conditionAction={}
            a=a.conditionAction
            ss=[a]
            _IDE._data._curAction=a
            _ideActionManagement._selectActionType(a)
          }
        }
        BZ._data._uiSwitch._selectedItems=ss
      }
      
      BZ._setSharedData({"_IDE._data._curAction":a});
    }
  },
  //mouse click on row of list or action card
  _selectAction:function(m,t,a,event){
    var ss=BZ._data._uiSwitch._selectedItems;
    var as=t._data.actions;
    _Util._selectInRows(a,event,ss,as)

    if(ss.length==1){
      if(_gitHandler._inCompare()){
        _IDE._data._curAction=a
      }else{
        BZ._setHash(a);
      }
    }
  },
  _getIcon:function(o){
    if(o.apiReplaceEvent&&o.requests){
      return "bz-icon bz-api"
    }
    var v='bz-icon'
    if(o.type=="a"){
      v+=" bz-batch-api"
    }else if(o.type==4&&_ideObjHandler._getDataByPath(o.refOfSuccess)==_IDE._data._curTest){
      v+=' bz-plug-self'
    }else if(o.type==6){
      v+=' bz-'+(o.loadType||"newpage")
    }else{
      v+=' bz-'+_ideActionData._typeList[o.type];
    }
    let c=_ideActionManagement._getComDataFromElement(o,1)
    if(c){
      v="bz-com"
    }else if(o.type==_ideActionData._type._triggerEvent){
      if(o.event.type=="mouse"){
        if(o.event.download){
          v="bz-download"
        }else{
          v="bz-mouse"
        }
      }else{
        v="bz-keyboard"
      }
      v="bz-icon "+v
    }else if("02".includes(o.type)){
      if(o.method==1){
        v+="-js"
      }else if(o.method==2){
        v+="-api"
      }
    }
    return v;
  },
  _setBreakpoint:function(a,t){
    var ds=BZ._userHabit.breakPoints.map(x=>x),
        c=_IDE._data._curModule._data.code+"."+t.code+"."+_ideActionManagement._getCurIdx(a,t)
    var _idx=ds.indexOf(c)
    if(_idx>=0){
      ds.splice(_idx,1);
    }else{
      ds.push(c);
    }
    BZ._userHabit.breakPoints=ds
    BZ._storeUserHabit()
  },
  _switchContentType:function(o){
    _IDE._data._curAction.expectation=''
    setTimeout(function(){
      _ideActionManagement._quickUpdateExpectation();
    },1);    
  },
  _refreshDetail:function(){
    var v=_IDE._data._curAction;
    if(v){
      _IDE._data._curAction=0;
      setTimeout(function(){
        _IDE._data._curAction=v;
      },100);
    }
  },
  _detailsPos:{
    _left:"390px",
    _top:"270px"
  },
  _removeFromGroup:function(as){
    as.forEach(function(a){
      let ks=["refOfSuccess","refOfFailed","refOfError"]
      ks.forEach(k=>{
        let v=a[k]
        if(v&&v.match(/(^|\/)\.\.\.(\/|$)/)){
          v=v.replace("...","").replace("/"+"/","/").replace(/^\/$/,"")
          a[k]=v
        }
      })
    })
  },
  _deleteItems:function(_list){
    let t=_IDE._data._curTest,_curIdx=_ideActionManagement._getCurIdx()
    _list=_list||BZ._data._uiSwitch._selectedItems;
    _list.forEach(function(o){
      _ideActionManagement._findAction(t,(a,i,p,as)=>{
        if(a==o){
          if(p.includes("c")){
            as.conditionAction={}
          }else{
            as.splice(as.indexOf(a),1);
          }
          return 1
        }
      })
    })
    _ideTestManagement._refreshActionIdx(t)
    BZ._setHash(_ideActionManagement._findActionByPath(t,_curIdx)||t);
    t._result={}
    _ideTestManagement._save()
  },
  _getNewValidationAction:function(_type){
    var d={
      compareMark: "==",
      type:_type?_type:_ideActionData._type._validation,
      method:_ideActionData._method._html
    };
    this._buildDefaultData(d);
    return d;
  },
  _buildDefaultData:function(d,_type){
    var t=_ideActionData._type;
    if(!_type){
      _type=d.type;
    }
    if (t._validation==_type || t._extractData==_type){
      if(!d.method){
        d.method=_ideActionData._method._html;
      }
      if(t._validation==_type && d.method==_ideActionData._method._html && (!d.content || (d.content.type=="JSON" || !d.content.type))){
        d.content={type:"innerText"};
        d.compareMark= "==";
        delete d.content.filter;
      }else if(d.method==_ideActionData._method._data && (!d.api || !d.content || (d.content.type && d.content.type!="JSON"))){
        d.api={httpMethod:"GET",httpURL:_ideTestManagement._getCurDefaultRoot(undefined,1)};
        d.content={type:""};
      }
      if(t._extractData==_type&&d.method==_ideActionData._method._data){
        d.script="$test.tmpValue=$result.data"
      }
      
    }else if (_type==t._triggerEvent) {
      if(!d.event){
        d.event={
          type:"mouse",
          action:"click",
          button:1,
          x:0,
          y:0
        }
      }else if(d.event.type=="mouse"){
        d.event.action="click"
        d.event.button=1;
        if(!d.x){
          d.x=0;
        }
        if(!d.y){
          d.y=0;
        }
      }else if(d.event.type=="key"){
        d.event.action="group"
      }
    }else if(_type==t._comment){
      d.showJudge=0;
    }
    if(_type!=d.type){
      d.type=_type;
    }
  },
  _stopAdding:function(_type){
    if(_IDE._data._curAction.type==_type&&!_IDE._data._curAction.element){
      _ideActionManagement._deleteItems(BZ._data._uiSwitch._selectedItems)
    }
    if(!window.extensionContent){
      bzComm.postToAppExtension({
        fun:"_endRequire",
        scope:"_bzDomPicker"
      });
    }else{
      _bzDomPicker._endRequire()
    }
  },
  _newItem:function(_type,_noAddToTest,_noPicker){
    var _curTest=_IDE._data._curTest
    if(!BZ._isPlaying()){
      _curTest._result={};
    }
    var a=_CtrlDriver._buildProxy(this._getNewValidationAction(_type));
    if(_type==0){
      a.refOfFailed=_IDE._data._setting.content.defFailResponse+"/"
      if(BZ._isRecording()){
        BZ._setSharedData({"$parameter":$parameter})
      }
    }
    if(_type==8){
      a.target="A"
      a.panel=["BZ.TW.document","BODY",0]
    }else if(_type==3){
      a.runInIDE="on"
    }else if(_type=="a"){
      a.requests=[]
      a.rampUp={
        users:100,
        up:120,
        totalTime:300
      }
      a.id=_aiAPI._newId()
    }else if(_type==5){
      a.description=_bzMessage._action._defComment;
    }
    if(!_noAddToTest){
      let ca=_IDE._data._curAction
      if(ca){
        _ideActionManagement._insert(ca,[a])
      }else{
        _ideActionManagement._addItem(a);
      }
      if(_type==4&&_curTest._data.type=="scenario"){
        _ideActionManagement._setStepKey(a,_curTest._data)
      }
      var t=_ideActionData._type;
      if(!_noPicker && "0125".includes(_type)){
        setTimeout(function(){
          _IDE._data._curAction=a
          //auto-dom-picker
          _ideActionManagement._pickElement(1);
        },100);
      //  BZ._setOperationInfo(_bzMessage._system._operation._selectElement);
      }else if(_bzDomPicker._isActionElementPicking()){
        _bzDomPicker._endRequire();
      }
    }
    return a;
  },
  _newPlug:function(a){
    var n=this._newItem(_ideActionData._type._ref);
    a+="/";
    if(a==_IDE._data._curModule._data.code+"."+_IDE._data._curTest._data.code){
      a+="1"
    }
    n.refOfSuccess=a;
  },
  _updateAction:function(b){
    if(b._inUpload){
      return
    }
    // if(_ideActionManagement._updateAutoFillAction(b)){
    //   return
    // }
    var a=_IDE._data._curAction;
    if(!a){
      return
    }
    // if(a.element && a.element[0] && a.element[0]!==b.element[0]){
      // return;
    // }
    a.element=b.element;
    a.panel=b.panel
    if(a.event){
      a.event.element=b.event.element
    }
    if(a.type==_ideActionData._type._triggerEvent){
      if(b.event.value){
        if(b.event.value && b.event.value.match(/^\{\{(.)+\}\}$/)){
          _ideActionManagement._buildInputBindData(a,b.event.value,b.event.tmpValue,b.replace);
        }else{
          a.event.value=b.event.value;
        }
      }
    }else if(a.type==_ideActionData._type._validation){
      a.expectation=b.expectation?b.expectation.trim():"";
      a.content.type=b.content.type
    }else if(a.type==_ideActionData._type._extractData && !a.script){
      a.script=b.script;
    }
    if(b.img){
      a.img=a.tmpImg=b.img;
    }
    if(BZ._isRecording()){
      BZ._setStatus("");
      setTimeout("BZ._setStatus('record')",100);
      return
    }
    _ideTestManagement._save()
  },
  //trigger by handleMsg
  _updateFillFormData:function(a){
    let d=0,nd;
    if(a.data){
      try{
        let d;
        d=eval("d="+a.data)
      }catch(e){}
    }
    
    if(d){
      if(_ideActionManagement._isSimpleData(d)){
        if(a.handleMsg){
          nd=_ideActionManagement._switchFillformDataToChkData(d)
        }
      }else if(!a.handleMsg){
        nd=_ideActionManagement._switchFillformDataToChkData(d)
      }
      if(nd){
        return _Util._confirmMessage({
          _tag:"div",
          _items:[
            {
              _tag:"h4",_text:_bzMessage._action._updateFillFormData
            },
            {
              _tag:"div",_attr:{"class":"col-xs-6"},
              _items:[
                {
                  _tag:"label",_text:"_bzMessage._common[_data._item._text]"
                },
                {
                  _tag:"textarea",_attr:{"class":"form-control"},
                  _text:"JSON.stringify(_data._item._data)"
                },
              ],
              _dataRepeat:[
                {_text:"_from",_data:d},
                {_text:"_toData",_data:nd}
              ]
            }
          ]
        },[
          {
            _title:_bzMessage._common._ok,
            _click:function(dlg){
              a.data=JSON.stringify(nd)
              dlg._ctrl._close();
            }
          }
        ])
      }
    }
  },
  _isSimpleData:function(d){
    for(var k in d){
      if(d[k].constructor==Object){
        return 
      }
    }
    return 1
  },
  _switchFillformDataToChkData:function(d){
    let nd={}
    for(var k in d){
      nd[k]=d[k].success||d[k]
    }
    return nd
  },
  _switchFillformDataToSimpleData:function(d){
    let nd={}
    for(var k in d){
      nd[k]={success:d[k],error:[]}
    }
    return nd
  },
  //_switchToSetValue
  _mergeToSetAction:function(d){
    if(BZ._isRecording()&&_ideRecorder._exFun){
      return _ideRecorder._exFun(d)
    }
    let as=d._actions
    _ideActionManagement._findAction(_IDE._data._curTest,(a,i,p,tas,pa)=>{
      if(a._mergeId==as[0]._action._mergeId){
        a.event={
          type:"change",
          value:d._data._name||d._data._value,
          key:_aiAPI._newId()
          // fromPanel:d.fromPanel
        }
        _IDE._data._curTest._mergeActionMap=_IDE._data._curTest._mergeActionMap||{}
        _IDE._data._curTest._mergeActionMap[a.key]=[...as]

        a.element=d._data._inputPath||a.element
        if(d._data._name){
          _aiDataUpdateHandler.bindAndGenerateData(d._data._name,d._data._value)
        }
        BZ._setHash(a)
        while(as.length){
          let y=as.shift()
          for(var j=i+1;j<tas.length;j++){
            let e=tas[j]
            if(e&&e._mergeId&&e._mergeId==y._action._mergeId){
              tas.splice(j,1)
              i=j-1
              break
            }
          }
        }

        return 1
      }
    })
  },
  //Customize input,//_switchToSetValue
  _changeToSetAction:function(ca,a){
    if(a.event&&a.event._customize&&a.event._customize._end){
      a=a.event._customize;
      var vs=[a],i,to;
      var ds=_ideActionManagement._getCurGroup(a)
      let _idx=g.actions.indexOf(ca)
      for(i=_idx;i>=0;i--){
        to=ds[i]
        if(to.event &&to.event._customize){
          vs.unshift(to.event._customize)
        }
        if(vs[0]&&vs[0]._head&&vs[0]._name==a._name){
          break
        }
      }
      if(i<0){
        return
      }
      to.event.type="change"
      to.event.action=0
      delete to.event.action
      if(a._fullValue&&a._fullValue.match(/\$[0-9]+/)){
        vs.reverse()
      }else{
        to.event.value=a._fullValue||a._value
      }
      if(_innerWin._data._dataBind._showDataBind){
        to.event.tmpValue=to.event.value
        to.event.value="{{$parameter"

        to.event._customize.$label=_glossaryHandler._getVariableName(to.event._customize.$label)
        to.event._customize.$header=_glossaryHandler._getVariableName(to.event._customize.$header)
        to.event.value+="."+ (to.event._customize.$label||to.event._customize.$header||_glossaryHandler._getVariableName(_descAnalysis._retrieveTextForElementPathItem(to.element)))+"}}"
        _ideActionManagement._buildInputBindData(to,to.event.value,to.event.tmpValue);
      }
      ds.splice(i+1,_idx-i)
      BZ._data._uiSwitch._selectedItems=[to]
      let _toggleBk=to.event._customize._toggleBk&&to.event._customize._toggleBk.pop()
      let _valueBk=to.event._customize._valueBk&&to.event._customize._valueBk.pop()

      if(_valueBk&&_toggleBk&&_valueBk!=_toggleBk){
        for(var i=to.element.length-1;i>=0;i--){
          let ev=to.element[i]
          if(ev==_toggleBk){
            break
          }else if(ev!=_toggleBk&&ev==_valueBk){
            to.element[i]=_toggleBk
            break
          }
        }
      }
      to.customize=a._name
      to.$label=to.event._customize.$label
      to.$header=to.event._customize.$header

      to.event._customize=0
       _ideActionManagement._setCurAction(to)
      return 1
    }
  },
  _addItem:function(a){
    a.key=a.key||_aiAPI._newId();
    a=_CtrlDriver._buildProxy(a);
    if(a._inUpload){
      setTimeout(()=>{
        delete a._inUpload
        if(a._uploadFile){
          _uploadHandler._askHandleFile(a)
        }
      },200)
    }
    let ca=_IDE._data._curAction,_idx;
    if(_ideRecorder._isWithEntryAction(a)){
      return
    }
    if(a.event&&a.event.action=="click"){
      if(Date.now()-(_domRecorder._lastClickFileInput||0)<200){
        return
      }
      _domRecorder._lastNewActionTime={
        a:a,
        t:Date.now()
      }
    }
    if(a.type==7){
      return _ideActionManagement._newGroup()
    }
    if(_ideRecorder._addActionFun){
      return _ideRecorder._addActionFun(a)
    }
    // if(_ideActionManagement._updateAutoFillAction(a)){
    //   return
    // }
    if(ca && ca.element && a.element && ca.element.toString()==a.element.toString() && a.type==_ideActionData._type._triggerEvent && a.type==ca.type && a.event.type==ca.event.type && a.event.type=="change"){
      ca.event.value=a.event.value;
      return
    }

    //Set enter point on empty of action list
    var t=_IDE._data._curTest._data;
    var ds=t.actions
    
    var _curSelect = _IDE._data._curAction;

    if(_curSelect&&_ideActionManagement._changeToSetAction(_curSelect,a)){
      return
    }
    if(ds.length==1&&ds[0]&&ds[0].type==6&&!ds[0].loadURL){
      ds[0].loadURL=a._tmpUrl.replace(_ideVersionManagement._getHostById(ds[0].hostId),"")
      ds.push(a)
    }else if(!_curSelect){
      ds.push(a)
    }else if(_curSelect.type==7&&_Util._isEmpty(_curSelect.actions)){
      _curSelect.actions.unshift(a)
      _ideActionManagement._openGroup(_curSelect)
    }else{
      _ideActionManagement._insert(_curSelect,[a],t,1)
    }
    delete a._tmpUrl;

    _ideTestManagement._refreshActionIdx(t)
    BZ._setHash(a)

    

    _ideRecorder._addLastRecordedAction(a)
    return a;
  },
  _isInBZComponent:function(a){
    let cs=_ideObjHandler._getDataByPath("com")
    if(cs){
      cs=cs._data.tests
      return (a.path||a.element||[]).find(x=>{
        return cs.find(y=>{
          return (x.toString()).includes(":"+y.name)
        })
      })
    }

  },
  _buildInputBindData:function(a,_value,_tmpValue,_replace){
    try{
      _aiDataUpdateHandler.bindAndGenerateData(_value,_tmpValue,_replace,function(v){
        a.event.value="{{"+v+"}}";
      })
    }catch(e){}
  },
  _cleanTmpData:function(d){
    var ds=_ideActionData._dataStructure[_ideActionData._keys[d.type]];
    if(!ds){
      return;
    }
    for(var k in d){
      if(ds.indexOf(k)<0){
        delete d[k];
      }
    }
    if(d.type==_ideActionData._type._validation){
      if(d.method==_ideActionData._method._html){
        delete d.script;
        delete d.api;
        if(["exist","unexist"].includes(d.content.type)){
          delete d.md5
        }
      }else if(d.method==_ideActionData._method._script){
        delete d.api;
        delete d.content;
      }else if(d.method==_ideActionData._method._data){
        delete d.script;
        delete d.element;
        delete d.errOnHidden;
        delete d.force;
        delete d.failedReaction;
      }
    }else if(d.type==_ideActionData._type._triggerEvent&&!d.apiReplaceEvent){
      if(!d.event.popType){
        delete d.expectation;
      }
      delete d.event._customize
      if(d.event.type!="mouse"){
        delete d.event.x;
        delete d.event.y;
        delete d.event.button;
        delete d.event.download
      }
      if(d.event.type!="key"){
        delete d.event.keyCode;
        delete d.event.charCode;

        if(d.event.type!="change"){
          delete d.event.value;
        }
      }
      if(["focus","blur","change"].indexOf(d.event.type)>=0){
        delete d.event.action;
        delete d.event.button;
        delete d.event.ctrl;
        delete d.event.alt;
        delete d.event.shift;
      }
    }else if(d.type==_ideActionData._type._extractData){
      if(d.method==_ideActionData._method._html){
        delete d.api;
      }else if(d.method==_ideActionData._method._data){
        delete d.element;
        delete d.errOnHidden;
        delete d.force;
        delete d.failedReaction;
      }
    }
    if(d.type!=_ideActionData._type._validation){
      delete d.content;
    }

    if (d.expectation) {
      delete d.md5;
      if (d.content&&d.content.type!="data"&&d.expectation.length>200) {
        d.md5=_calcMD5(d.expectation);
        var ws=d.expectation.split("\n");
        var fws="";
        for(var i=0;i<ws.length;i++){
          fws+=ws[i].trim();
        }
        if(fws.length>5120){
          delete d.expectation;
        }
      }
    }else if(d.img){
      d.md5=_calcMD5(d.img);
    }
  },
  //as:actions, t: test case object
  _storeAISetting:function(as,t){
    as.forEach((a,i)=>{
      if(a.ai&&"01".includes(a.type)){
        let o=_aiPageHandler._getAIObjByAction(a)
        if(o){
          _addData(o,a,"refOfSuccess")
          _addData(o,a,"refOfFailed")
          _addData(o,a,"refOfError")
          _addData(o,a,"successParameter")
          _addData(o,a,"failedParameter")
          _addData(o,a,"errorParameter")
          _addData(o,a,"noLightAction")
          _addData(o,a,"failedReaction")
          _addData(o,a,"errOnHidden")
          _addData(o,a,"force")
          _addData(o,a,"repElementMethod")
          _addData(o,a,"supportReadOnly")
          _addData(o,a,"skipActionElement")
          _addData(o,a,"failElement")
          // _addData(o,a,"finalElement")
          _addData(o,a,"offset")
          _addData(o,a,"monitorUrl")
          _addData(o,a,"event")
          _addData(o,a,"withEntry")
          _addData(o,a,"withSubmit")
        }
      }
    });
    
    function _addData(o,a,k){
      if(a[k]||(k=="failedReaction"&&a[k]!==undefined)){
        if(k=="event"){
          if(!a.event||!_isUpdateEvent(a.event)){
            if(o.advanced){
              delete o.advanced.event
            }
            return
          }
        }
        o[k]=a[k]
      }else{
        o[k]=0
        delete o[k]
      }
    }
    
    function _isUpdateEvent(e){
      for(let kk in e){
        if(kk=="autoBlur"){
          if(!e[kk]){
            return 1
          }
        }else if(kk=="type"){
          if(!["mouse","change"].includes(e[kk])){
            return 1
          }
        }else if(kk=="action"){
          if(e.action!="click"){
            return 1
          }
        }else if(!_Util._isEmpty(e[kk])){
          return 1
        }
      }
    }
  },
  _cleanByStdAction:function(d,s){
    for(var k in s){
      if(d[k]!==undefined){
        if(s[k].constructor==Object){
          _ideActionManagement._cleanByStdAction(d[k],s[k])
            
          if(!Object.keys(d[k]).length){
            delete d[k]
          }
        }else if(s[k].constructor==Array){
          if(d[k].join(",")==s[k].join(",")){
            delete d[k]
          }
        }else if(d[k]==s[k]&&k!="ai"){
          delete d[k]
        }
      }
    }
    if(Object.keys(d).length==1&&d.ai){
      delete d.ai
    }
  },
  _checkFileSize:function(v){
    if(v.length-1600>1024*1024*2){
      return alert(_bzMessage._system._error._fileSizeIssue)
    }
    return 1;
  },
  _takeMD5Resource:function(t,a,_purpose,_md5Type,fun){
    if(a[_purpose] || !a[_md5Type]){
      if(fun){
        return fun();
      }
    }
    var _url="/api/projects/"+BZ._data._curProject.code+"/docs/"+(t.doc._id||t.doc)+"/md5/"+a[_md5Type];
    _requestHandler._callService({
      _data:{
        method:"GET",
        url:_url
      },
      _success:function(d){
        d=d.result
        if (!d.message) {
          if(a.type==5){
            a.tmpImg=d
          }else{
            a[_purpose]=d;
            if(_purpose=="_camera"){
              a._oldImg=1
            }
          }
          if(fun){
            fun();
          }
        }else{
          BZ._sysAlert(d.message);
        }
      },
      _failed:function(r){
        if(r.result){
          if(r.result.message!="_NoResource"||a.type!=_ideActionData._type._comment){
            _Util._alertMessage(r.result.message);
            a[_md5Type]=0
          }
        }
        fun&&fun()
      }
    });
  },
  _isSkippedResult:function(r){
    return r._bzSkip||(r._data.type==4&&!r._data.refOfSuccess)
  },
  _paste:function(){
    let c=_IDE._data._clipData,
        _inCut=c.inCut,
        _items=c._cutSource||c.items,
        os=BZ._data._uiSwitch._selectedItems||[],
        o=os[os.length-1]
        
    c.inCut=c._cutSource=0
    return _ideActionManagement._move(_Util._clone(_items),o)
  },
  _move:function(_items,a){
    let ft=_IDE._data._curTest,g
    if(ft){
      ft._result={}
      let as=a?a.actions||_ideActionManagement._getCurGroup(a,ft).actions:ft._data.actions;
      if(_items.includes(a)){
        g=_ideActionManagement._getCurGroup(a,ft)
      }
      _ideTestManagement._removeActions(ft,_items)
      _items=_items.map(x=>_CtrlDriver._buildProxy(x))
      if(g&&!g.code){
        _ideActionManagement._insert(g,_items,ft,1)
      }else if(!a){
        as.unshift(..._items)
      }else if(_items.length==1&&_ideActionManagement._isIfGroupCondition(a,ft)){
        a=_ideActionManagement._getCurGroup(a,ft)
        a.conditionAction=_items[0]
      }else if(as.includes(a)){
        _ideActionManagement._insert(a,_items,{actions:as},1)
      }else if(as==a.actions){
        if(a.code){
          as.push(..._items)
        }else if(g){
          _ideActionManagement._insert(g,_items,ft,1)
        }else{
          as.unshift(..._items)
        }
      }else{
        as.unshift(..._items)
      }

      _ideTestManagement._save(ft,ft._parent,function(){
        _ideActionManagement._setCurAction(_items[0])
        BZ._data._uiSwitch._selectedItems=_items
      })
    }
  },
  _pickElement:function(_pick,fun){
    if(!window.extensionContent){
      if(!_Util._isBZTWOpened()){
        return BZ._launchCurEnvUrl(undefined,()=>{
          _ideActionManagement._pickElement(_pick,fun)
        })
      }
      bzComm.postToAppExtension({
        fun:"_pickElement",
        scope:"_ideActionManagement",
        ps:[_pick||{element:_IDE._data._curAction.element}],
        insertCallFun:1,
        return:function(e){
          _IDE._data._curAction.element=e
          _ideTestManagement._save()
        }
      })
    }else if(_IDE._data._curAction){
      _descAnalysis._clearTmpPath(1);
      _bzDomPicker._start({_id:"_actionElementPick",_back:_back,_type:_IDE._data._curAction&&_pick!=1?_IDE._data._curAction.panel||_IDE._data._curAction.element:null});
    }else{
      return
    }
    function _back(_path,_pos,_element){
      var e=$util.findDom(_path),
          _curAction=_IDE._data._curAction;
      if(_curAction.type==8){
        _curAction.panel=_path;
      }else{
        _curAction.element=_path;
        _ideDataBind._bindDataOnElement(_curAction,"element");
      }
      
      if(_curAction.type==_ideActionData._type._triggerEvent&&_pos){
        _curAction.event.x=_pos.x;
        _curAction.event.y=_pos.y;
      }
      _curAction.failedReaction=0;
      if(_curAction.type==_ideActionData._type._validation){
        var s=BZ._data._status;
        BZ._data._status=""
        setTimeout(function(){
          BZ._data._status=s;
        },500)
        return _domActionTask._exeAction(_curAction,{_force:1,_taskQueue:[]},function(){
          _IDE._data._curAction=_curAction
          if(_curAction.content){
            if(_curAction.content.type=="data"){
              var s=_ideDataBind._bindValidationData(e);
              if(s){
                _curAction.expectation=s;
              }
            }else if(_curAction.content.type=="innerText"){
              var v=_ideDataBind._insertCode(_curAction.expectation);
              if(v){
                _curAction.expectation=v;
              }
            }
          }
          _sendData(_curAction)
        })
      }else if(_curAction.type==_ideActionData._type._extractData){
        if(!_curAction.script && e){
          var a=_curAction;
          let v=_glossaryHandler._getVariableName(_descAnalysis._retrieveTextForElementPathItem(a.element))||"tmpValue"
          a.script="$parameter."+v+" = $util.getElementText($element);"
        }
      }else if(_curAction.type==_ideActionData._type._comment){
        var a=_curAction
        _element.bzTmp=_path
        return _screenshotHandler._getScreenshot(_element,0,function(c){
          _IDE._data._curAction=a;
          a.img=c
          _domActionTask._doComment(a,true);
          _sendData(a)
        })
      }
      
      _sendData(_IDE._data._curAction)
    }
    
    function _sendData(a){
      if(window.extensionContent){
        BZ._formatInIFramePath(a.panel||a.element)
        $(".BZIgnore .bz-tb-buttons .bz-active").removeClass("bz-active")

        fun(a.element)
      }else{
        _ideTestManagement._save()
      }
    }
  },
  _getDescExtra:function(d,_simple){
    if(_simple){
      return ""
    }
    var k="";
    if(d.event.ctrl){
      k+="+ctrl"
    }
    if(d.event.alt){
      k+="+alt"
    }
    if(d.event.shift){
      k+="+shift"
    }
    if(d.event.type=="mouse"){
      if(d.event.download){
        k+=","+_descAnalysis._syntaxOptionKey.download._value
      }
      if(d.event.button==2){
        k+="+"+_bzMessage._action._right
      }else if(d.event.button==1){
        k+="+"+_bzMessage._action._left
      }
      if(parseFloat(d.event.x)>=0){
        k+=",x="+d.event.x
      }
      if(parseFloat(d.event.y)>=0){
        k+=",y="+d.event.y
      }
    }else if(d.event.type=="key"){
      if(d.event.keyCode){
        if(d.event.charCode){
          k+="+"+String.fromCharCode(d.event.charCode)
        }else{
          var mp=_descAnalysis._keyboardMap;
          for(var v in mp){
            if(mp[v]==d.event.keyCode){
              k+="+"+v.toUpperCase();
              break
            }
          }
        }
      }
    }
    if(k){
      return "["+k.substring(1)+"]"
    }
    return ""
  },
  _getValidateDesc:function(d){
    if(d.method==2){
      let a=d.api
      let _host=BZ._curEnv.items[a.host],_url=a.httpURL;
      if(_host){
        _host=_host.host
        _url=_Util._mergeURL(_host,_url)
      }
      if(_url){
        _url= a.httpMethod+ " "+_url+" == "+d.expectation
        if(_url.length>100){
          _url=_url.substring(0,100)+" ..."
        }
        return _url
      }
    }else if(d.content){
      let w=_bzMessage._action._content,
          dd=(d.expectation||_bzMessage._method._not)
      switch(d.content.type){
        case "exist":return w._exist;
        case "unexist":return w._unExist;
        case "data":return d.expectation;
        case "disable":return w._disable+" ("+dd+")";
        case "checked":return w._checked+" ("+dd+")";
        case "enable":return w._enable+" ("+dd+")";
      }
      return this._getExpectationDesc(d,1)
    }
  },
  _getExpectationDesc:function(d,_simple){
    var s="";
    if(!["exist","unexist"].includes(d.content.type)){
      s=" "+d.compareMark;
      if(d.expectation){
        var v=d.expectation;
        if([Object,Array].includes(v.constructor)){
          d.expectation=v=JSON.stringify(v,0,2)
        }
        if(d.content.type=="data"){
          v="{{"+v.trim()+"}}"
        }
        if(_simple){
          s+=" "+_JSHandler._formatInsertCodeToDisplay(v)
        }else{
          if(v.includes("\n")){
            s+=" (\n"+v+"\n)";
          }else{
            s+=" ("+v+")";
          }
        }
      }else if(d.md5){
        s+=" ("+"MD5:"+d.md5+")";
      }
    }
    return s;
  },
  _getAPIOption:function(d){
    var r=_bzMessage._syntaxOption.response;
    var s=r.httpMethod+": "+d.api.httpMethod+"\n";
    var _ignore="";
    
    if(d.api.httpHeaders){
      s+="headers: "+d.api.httpHeaders+"\n"
    }
    if(d.api.httpMethod.toLowerCase()!="get" && d.api.httpData){
      s+=r.httpData+": "+d.api.httpData+"\n";
    }else if(d.api.httpMethod.toLowerCase()=="get"){
      if(d.api.downloadAsFile && d.type==_ideActionData._type._extractData){
        s+=_bzMessage._syntaxOption.response.downloadAsFile
      }
    }
    if(d.content && d.content.type){
      s+=_bzMessage._syntaxOption.response.type+": JSON\n";
      
      ["type","jsonKey","jsonValue"].forEach(function(v,i){
        if(d.content.ignore[v]){
          s+=_bzMessage._syntaxOption.response[v]+": "+d.content.ignore[v]+"\n"
        }
      });
      
      ["status","data","nullValue","emptyValue"].forEach(function(v,i){
        if(d.content.ignore.attrs[v]){
          _ignore+=","+_bzMessage._syntaxOption.response[v]
        }
      });
      if(_ignore){
        s+=_bzMessage._syntaxOption.response.ignore+": "+_ignore.substring(1);
      }
    }
    s=s.trim();
    if(s.includes("\n")){
      s="[\n"+s+"\n]";
    }else{
      s="["+s+"]"
    }
    return s;
  },
  _getConditionOptions:function(a){
    var vs=[{_type:"loopdata"},{_type:"resultscript"},{_type:"Success"},{_type:"Failed"},{_type:"Error"},{_type:"note"}];
    var t=a.type;
    //group,plug/comment
    if(t==5){
      if(!a.showJudge){
        vs.forEach(function(v){
          v._disabled=1
        })
      }else{
        vs[2]._disabled=1
      }
    }else if(t==7){
    }else if(t==4){
      //vs[2]._disabled=1
    //Not script and refresh
    }else if(t && ![1,3,6].includes(t)){
      vs[2]._disabled=1
    }
    return vs
  },
  _getTabOptions:function(aa){
    var a=_ideActionManagement._getConditionOptions(aa)
    for(var i=0;i<a.length;i++){
      if(a[i]._disabled){
        a.splice(i--,1)
      }else{
        a[i]=a[i]._type
      }
    }
    return a
  },
  _gotoRefTest:function(v){
    v=v.match(_IDE._testKeyRegex)
    if(v){
      v=v[0].replace(".","/")
      BZ._setHash(v)
    }
  },
  // _getUIDescription:function(i,a,_inHtml){
    // var w;
    // if(a.description){
      // w=a.description;
    // }else{
      // w=_ideActionManagement._getAutoDescription(a,1);
      // try{
        // if(a.type==4&&_IDE._data._curTest&&_IDE._data._curTest._data.type=="scenario"){
          // w="["+a.refOfSuccess.match(_IDE._testKeyRegex)[0]+"] "+w
        // }
      // }catch(e){}
    // }
    // w=w.replace(/</g,"&lt;").replace(/>/g,"&gt;")
    // w=i+", "+w.trim()
    // var ws=w.split(/\([^\)\}]+\)|\{\{[^\}]+\}\}/g);
    // var ms=w.match(/\([^\)\}]+\)|\{\{[^\}]+\}\}/g);
    // var ww=""
    // if(ms && ms.constructor==Array){
      // for(var i=0;i<ms.length;i++){
        // ww+=ws[i]
        // if(_Util._hasCode(ms[i])){
          // ww+="<span class='param'><i>"+ms[i]+"</i></span>"
        // }else{
          // ww+=ms[i]
        // }
      // }
      // ww+=ws[i]
    // }else if(ms){
      // ww=ws[0]+ms+ws[1]
    // }else{
      // ww=w
    // }
    // if(a.type==_ideActionData._type._ref && a.refOfSuccess && _IDE._data._curAction==a){
      // var v=a.refOfSuccess.match(/(^|\/)(m|\{)([^\/]+)([0-9]|\})($|\/)/);
      // if(v){
        // v=v[2]+v[3]+v[4]
        // if(v[0]=="m"){
          // if(_inHtml){
            // return "<a style='text-decoration:underline;' href='javascript:_ideActionManagement._gotoRefTest(\""+a.refOfSuccess+"\")'>"+ww+"</a>"
          // }
        // }else{
          // ww=_JSHandler._formatInsertCodeToDisplay(ww)
        // }
      // }
    // }
    // if(a.event && a.event.download && _inHtml){
      // ww=ww.replace("[","<b>[<span class='bz-action-ref bz-cloud-download'>").replace("]","</span>]</b>")
    // }
    // if(_inHtml){
      // ww="<span>"+ww+"</span>";
    // }
    // return ww
  // },
  //
  _getFinalDisplayDesc:function(a,t){
    var v=a.description
    if(!v && a.type!=_ideActionData._type._comment){
      v= _ideActionManagement._getAutoDescription(a,1,t);
    }
    return (v||"").replace("\n"," ").trim();
  },
  _hasCondition:function(a){
    let dr=_IDE._data._setting.content.defFailResponse||".."
    return _chkItem(a.type==4?(a.refOfSuccess||"").replace(/m[0-9]+[.]t[0-9]+/,""):a.refOfSuccess,1)||_chkItem(a.refOfFailed,2)||_chkItem(a.refOfError,3)

    function _chkItem(r,_type){
      if(r){
        if(r.match(/(^|\/)(m[0-9]+\.t[0-9]+|\{\{.+\}\}|[wc]|\.\.\.)(\/|$)/)){
          return 1
        }else if(_type==1){
          return r.match(/[ef]|\.\./)
        }else if(_type==3){
          return r.match(/[sf]|(\/|^)\.(\/|$)/)
        }else if(_type==2){
          if(r.match(/[se]|(\/|^)\.(\/|$)/)){
            return 1
          }
          if(dr=="."){
            return r.includes("..")
          }else{
            return !r.includes("..")
          }
        }
      }
    }
  },
  _getValueDesc:function(a,_test){
    switch(a.type){
      case 0:return this._getValidateDesc(a);
      case 1:
        let _msg=_descAnalysis._codeToDesc((a.event&&a.event.value)||(a.event&&a.event.keyCode&&_bzMessage._common._key+": "+a.event.keyName)||"",1);
        if(a.withEntry){
          _msg +=" + "+_bzMessage._common._enter
        }else if(a.withSubmit){
          _msg +=" + "+_bzMessage._method._submit
        }
        return _msg
      case 2:case 3: return a.script;
      case 4: return this._refTestPathToDisplay(a,0,_test);
      case 5:case 6:return a.description||a.url||"";
      case 7:return (a.description||"");
      case 9: return a.data?a.data.map(a=>{return a.key}).join(", "):""
    }
  },
  _loadDataForLoadTest:function(){
    let _timer;
    _ideVersionManagement._loadAllData(function(){
      _ideTestManagement._inBatchCreate=1
      _IDE._data._curVersion.modules.forEach(m=>{
        m.tests.forEach(t=>{
          if(t.type=="api"){
            let _update=0,ai=_aiGeneratorDataHandler._isAIGenerateTest(t,m)
            if(ai&&(_ideActionManagement._isEmptyTest(t)||_Util._isEmpty(t.actions[0]))){
              _aiGenerator._generateAIActions(t,m)
            }
            _ideActionManagement._findAction(t,function(a,i,p){
              if(a.apiReplaceEvent){
                if(!a.id){
                  a.id=p+10
                  _update=1
                }
              }
            })
            if(_update){
              _ideTestManagement._save(t,m,function(){
                clearTimeout(_timer)
                _timer=setTimeout(()=>{
                  _ideTestManagement._inBatchCreate=0
                },1000)
              })
            }
          }
        })
      })
      BZ._data._uiSwitch._showBatchList=1
    })
  },
  _getActionMethod:function(a){
    let w=_bzMessage._action._methodDesc
    let _key=_ideActionData._keys[a.type]
    if(a.type=="a"){
      return _bzMessage._action._methodDesc._load
    }else if(a.apiReplaceEvent){
      return "API"
    }
    switch(a.type){
      case 0: return a.method==2?w._validateResponse:a.method==1?w._validateJS:w._validateContent;
      case 1: 
        w=w._trigger
        a=a.event
        if(a.type=='change'){
          if(["radio","checkbox"].includes(_cssHandler._getInputTypeFromElementPath(a.element))){
            if(!a.event.value){
              w=w._uncheck
            }else{
              w=w._check
            }
          }else{
            w=w._change
          }
        }else if(a.type=="key"){
          w=w._typing
        }else if(a.type=="mouse"){
          if(a.action=="click"){
            if(a.download){
              w=_bzMessage._method._download
            }else if(a.button==2){
              w=w._rightClick
            }else{
              w=w._click
            }
          }else if(a.action=="dblclick"){
            w=w._dblclick
          }else if(a.action=="hover"){
            w=w._hover
          }else{
            w=_Util._toCapitalWord(a.action)
          }
        }
        return w
      case 2: return a.method==2?w._extractResponse:w._extractData;
    }
    return w[_key]
  },
  _getAutoDescription:function(d,_simple,_test){
    var t=_ideActionData._type;
    var _fType=d.type;
    var _script="";
    var _title="";
    var _desc=_bzMessage._action._description;
    var es=d.element||d.panel;
    if(d.type=="a"){
      return _Util._formatMessage(_bzMessage._action._description._load,d.requests.length+"")
    }

    if(d.requests&&d.requests.length&&d.apiReplaceEvent){
      var _method=d.requests[0].method||BZ._curEnv.items[d.requests[0].host||0].host
      return _method+": "+d.requests[0].url
    }
    if(d.description||d.type==t._group){
      return d.description||""
    }
    
    if (![t._ref,t._refresh].includes(d.type) && (![t._validation,t._extractData].includes(d.type) || d.method!=2) && es && es.length) {
      _title=_descAnalysis._getDescOfElement(d);

      if(_fType==t._validation){
        if(d.method==1 || d.method==2){
          
        }else{
          _title=_Util._formatMessage(_desc._validateContent,["["+d.content.type+"]",_title]);
          _title+=this._getExpectationDesc(d,_simple);
        }
      }else if(_fType==t._triggerEvent){
        var et=d.event.type;
        var ea=d.event.action;
        if(et=="change"){
          if(["radio","checkbox"].includes(_cssHandler._getInputTypeFromElementPath(es))){
            if(!d.event.value){
              _title=_Util._formatMessage(_desc._trigger._uncheck,[_title]);
            }else{
              _title=_Util._formatMessage(_desc._trigger._check,[_title]);
            }
          }else{
            _title+=" = "+_descAnalysis._codeToDesc(d.event.value,_simple);
            _title=_Util._formatMessage(_desc._trigger._change,[_title]);
          }
          if(d.withEntry){
            _title+=" + "+_bzMessage._common._enter
          }else if(d.withSubmit){
            _title+=" + "+_bzMessage._method._submit
          }
        }else if(ea=="dblclick"){
          _title=_Util._formatMessage(_desc._trigger._dblclick,[_title]);
        }else if(et=="mouse"){
          if(["group","click"].includes(ea)){
            if(d.event.button==2){
              _title=_Util._formatMessage(_desc._trigger._rightClick,[_title]);
            }else{
              if(d.event.download){
                _title="["+_descAnalysis._syntaxOptionMap.mouse.download[0]+"] "+_title
              }
              _title=_Util._formatMessage(_desc._trigger._click,[_title]);
            }
          }else if(ea=="rightclick"){
            _title=_Util._formatMessage(_desc._trigger._rightClick,[_title]);
          }else if(ea=="hover"){
            _title=_Util._formatMessage(_desc._trigger._hover,[_title]);
          }else if(ea=="drag"){
            _title=_Util._formatMessage(_desc._trigger._drag,[_title]);
          }else if(ea.startsWith("mouse") || ea=="dragdrop"){
            _title=ea+" "+_ideActionManagement._getDragdropDesc(d)
          }
        }else if(et=="key"){
          if(ea=="group"){
            if(d.event.value){
              _title+=" = "+_descAnalysis._codeToDesc(d.event.value,_simple);
              _title=_desc._trigger._typing+" "+_title;
            }else{
              _title="keygroup"+this._getDescExtra(d)+" "+_title;
            }
          }else{
            _title="key"+ea+this._getDescExtra(d)+" "+_title;
          }
        }
      }else if(_fType==t._comment){
        _title=_Util._formatMessage(_desc._comment,[_title,d.description]);
      }else if(_fType==t._visit){
        _title=_desc._visit+_title
      }else if(d.type==t._fillForm){
        _title=_getFillFormItemNameList(_title,d)
      }
    }else if (_fType==t._ref) {
      _title=this._refTestPathToDisplay(d,0,_test);
    // }else if(d.type==t._group){
    //   _title=_desc._group+(d.description?'"'+d.description+'"':"");
    }else if(d.type==t._refresh){
      if(d.refreshType){
        _title=d.refreshData?d.refreshData.join(", "):"";
        _title=_Util._formatMessage(_desc._refreshData,[_title]);
      }else{
        _title="";
        if(d.clearCookie){
          _title+=", cookie"
        }
        if(d.clearLocalStorage){
          _title+=", localstorage"
        }
        if(d.loadURL){
          _title+=", "+d.loadURL
        }
        if(_title){
          _title="["+_title.substring(2)+"]";
        }
        
        _title=_Util._formatMessage(_desc._refresh,[_title]);
      }
    //validation data/api
    }else if(d.type==t._validation && d.method==_ideActionData._method._data){
      var o=this._getAPIOption(d);
      _title=_Util._formatMessage(_desc._validateResponse,[d.api.httpURL||"",o]);
      _title+=this._getExpectationDesc(d);
    }else if(d.type==t._fillForm){
      _title=_getFillFormItemNameList(_title,d)
    }
    if(d.script){
      _script=d.script.toString()
      if(_simple){
        if(_script.includes("\n") || d.script.length>60){
          _script="{{...}}"
        }else{
          _script="{{"+_ideDataHandler._parseToExeCode(_script)+"}}"
        }
      }else{
        if(_script.includes("\n")){
          _script="{{\n"+d.script+"\n}}";
        }else{
          _script="{{"+d.script+"}}"
        }
      }
      if(_fType==t._script){
        _title=_desc._exeScript+" "+_title+" "+_script;
      }else if(_fType==t._extractData){
        if(d.method==_ideActionData._method._data){
          var o=this._getAPIOption(d);
          _title=_Util._formatMessage(_desc._extractResponse,[d.api.httpURL,o])
                +" "+_script;
        }else{
          _title=_desc._extractData+_title+" "+_script;
        }
      }else{
        _title=_Util._formatMessage(_desc._validateContent,["",_title])+_script;
      }
    }else if(d.method=="data"){
      _title="[\n"+2+":]"
    }
    
    if(_title){
      _title=_title[0].toUpperCase()+_title.substring(1);
    }
    if(!_simple && d.type!=_ideActionData._type._ref){
      ["Success","Failed","Error"].forEach(function(v){
        if(d["refOf"+v]){
          _title+="\n  "+_bzMessage._syntax.advance["refOf"+v].split("/")[0]+":"+_ideActionManagement._refTestPathToDisplay(d,v,_test)
        }
      })
    }
    _title= "\n"+_JSHandler._formatInsertCodeToDisplay(_compressJSON._unConvert(_title));
    return _title
    
    function _getFillFormItemNameList(_title,d){
      /*
      var _data=d.data;
      try{
        eval("_data="+d.data)
      }catch(e){}
      return _Util._formatMessage(_desc._fillForm,[(_title||"")+"\n("+Object.keys(_data||{}).join(", ")+")"]);
      */
      return _Util._formatMessage(_desc._fillForm,[_title||""]);
    }
  },
  _getDragdropDesc:function(d){
    let to="[x = "+d.event.x+", y = "+d.event.y+"]"
    let _from=_descAnalysis._getDescOfElement(d)
    if(d.event.element){
      to=_descAnalysis._getDescOfElement(d.event)
    }
    return _Util._formatMessage(_bzMessage._syntaxOption.mouse.dragdrop,[_from,to])
  },
  _getRefDesc:function(a,k){
    var v=a?(a[k]||"").match(_IDE._testKeyRegex):""
    if(v){
      v=v[0]
      var vv=_ideObjHandler._getDataByPath(v);
      if(vv){
        return _compressJSON._unConvert(_ideTestManagement._getPathNameByPath(v)||_JSHandler._formatInsertCodeToDisplay(v))
      }
    }else if(a&&a[k]){
      v=a[k].match(/\{\{(.+)\}\}/)
      if(v){
        return _JSHandler._formatInsertCodeToDisplay(v[0])
      }
    }
  },
  _getBatchRequestDesc:function(d){
    d=_ideActionManagement._getBatchRequestRefData(d)
    if(d){
      return `[${d.m._data.code}.${d.t._data.code}] `+_ideActionManagement._getAutoDescription(d.a,1)
    }
  },
  _getActionUrlIdxByBatchRequest:function(d){
    d=_ideActionManagement._getBatchRequestRefData(d.action)
    if(d){
      return d.m._data.code+"/"+d.t._data.code+"/"+_ideActionManagement._getCurIdx(d.a,d.t)
    }
  },
  _getBatchRequestRefData:function(d,_fun){
    if(d){
      d=d.split(".")
      let m=_ideObjHandler._getDataByPath(d[0])
      let t=_ideObjHandler._getDataByPath(d[0],d[1]),a
      if(t){
        if(d[2]==1){
          a=t._data.actions[1]
          if(_Util._isEmpty(a)){
            _aiGenerator._generateAITest(t,m)
          }
        }
        let rd={t:t,m:m}
        if(_ideActionManagement._isEmptyTest(t)){
          _ideModuleManagement._loadItem(m,function(){
            rd.a=_ideActionManagement._findAction(t,a=>a.id==d[2])
            _fun&&_fun(rd.a&&rd)
          })
          if(!_fun){
            return rd
          }
        }else{
          rd.a=_ideActionManagement._findAction(t,a=>a.id==d[2])
          if(rd.a){
            if(_fun){
              return _fun(rd)
            }
            return rd
          }
        }
      }
    }
  },
  _showBatchRequestScript:function(dd,_forceKey){
    let d=dd._item,_idx=dd._idx,_save,s;
    let o=_ideActionManagement._getBatchRequestRefData(d.action)
    let r=o.a.requests[0]
    if(_forceKey=="preScript"){
      let s=_buildRequestPreScript(o)
      if(s!=d.preScript){
        d.preScript=s
        _save=1
      }
    }else if(_forceKey=="endScript"){
      s=_buildRequestEndScript(o)
      if(d.endScript!=s){
        d.endScript=s
        _save=1
      }
    }else if(!d.preScript&&!d.endScript){
      d.preScript=_buildRequestPreScript(o)
      d.endScript=_buildRequestEndScript(o)
      _save=1
    }
    if(_save){
      if(_forceKey){
        _CtrlDriver._refreshData(d,"_open")
      }
      _ideTestManagement._save()
    }
    function _buildRequestPreScript(o){
      let s=`(()=>{\n${_bzMessage._api._prepareParameter}\n{0}\n})();`,ss=""
      if(o){
        let p=_Util._strToJson(o.t._data.defParameter)||{};
        ss=_debugDataHandler._retrieveDataFromRequest(o.a.requests[0])
        ss=ss.map(xx=>{
          let v;
          if(!_idx){
            let x=xx.split(".")
            x=x[1]||x[0]
            v=p[x]
            return `${xx} = ${(JSON.stringify(v,0,2)+"").split("\n").join("\n  ")};`
          }else{
            v=xx.replace("$parameter","$result")
            return `${xx} = ${v};`
          }
        }).join("\n  ")
        return _Util._formatMessage(s,"  "+ss)
      }
    }

    function _buildRequestEndScript(o){
      if(r.method!="DELETE"){
        return `(()=>{\n${_bzMessage._api._batchRequestEndScriptDesc}\n  $parameter.$result[$result.idx] = $result.responseJSON;\n  return $result.status && $result.status < 400;\n})()`
      }else{
        return "(()=>{\n  return $result.status && $result.status < 400;\n})()"
      }
    }
  },
  //a:action, v: success,failed,error
  _refTestPathToDisplay:function(a,v,t){
    v=v||"Success"
    let ps=a["refOf"+v]
    if (!ps) {
      return _bzMessage._system._error._noImplement+" - "+(a.description||"");
    }
    let _parameter=a[v.toLowerCase()+"Parameter"]
    ps=ps.split("/");
    var _names=[];
    var r=_bzMessage._syntaxOption.process,_ref="";
    for(var i=0;i<ps.length;i++){
      var p=ps[i];
      _names[i]="";
      if(!p){
      }else if(p=="BZ-Refresh"){
        _names[i]=r._refresh.split("/")[0];
      }else if(p=="...."){
        _names[i]=r._stop.split("/")[0];
      }else if(p=="..."){
        _names[i]=r._breakGroup.split("/")[0];
      }else if(p==".."){
        _names[i]=r._break.split("/")[0];
      }else if(p=="."){
        _names[i]=r._continue.split("/")[0];
      }else if($.isNumeric(p)){
      }else if("cefws".includes(p)){
        _names[i]=_bzMessage._syntaxOption.result[_taskInfo._valueMap[p]].split("/")[0]
      }else if("cm{".includes(p[0])){
        var s=p
        if(p[0]=="m"||p[0]=="c"){
          var d=_ideObjHandler._getDataByPath(p)
          if(d&&a.stepKey){
            return _bzScenario._getActionDescOfRefLinkTest(a,t)
          }else{
            s=_ideTestManagement._getPathNameByPath(p);
          }
          if(!s){
            s="("+_bzMessage._system._error._refError+")"
            if(_IDE._data._curTest&&_IDE._data._curTest._data._tmpData){
              (_mergeHandler._data._mergeList||[]).find(x=>{
                if(x._from&&x._module.code+"."+x._from.code==p){
                  if(x._chk){
                    s="("+_bzMessage._system._info._readyCommit+")"
                  }else{
                    s="("+_bzMessage._system._info._missingInCommit+")"
                  }
                  return 1
                }
              });
              (_commitHandler._data._curData||{list:[]}).list.find(x=>{
                if(x.m+"."+x.t==p){
                  s="("+_bzMessage._system._info._readyRequest+")"
                  return 1
                }
              })
            }
          }
          s= "["+p+"] "+s;
        }else if(p[0]=="{"){
          s=_JSHandler._formatInsertCodeToDisplay(p)
        }
        _ref=_bzMessage._syntax.action.plug.split("/")[0]+": "+s;
        _ref=_Util._toCapitalWord(_ref)
      }
    }
    p="";
    for(var i=0;i<_names.length;i++){
      if(_names[i]){
        p+=", "+_names[i];
      }
    }
    if(p){
      p=p.substring(2);
    }
    if(_ref){
      return _ref
    }
    if(_parameter){
      p+=" ($parameter = "+_parameter+")"
    }
    if(p[0]==","){
      p=p.substring(1).trim()
    }
    return p;
  },
  _setAdvancedOptions:function(){
    let a=_IDE._data._curAction,
    _advOptions=[]
    if(_ideActionManagement._hasElement(a)){
      _advOptions=["_skipMark","_failMark"]
      if(a.type==1&&a.event.type=='change'){
        // _advOptions.push("_auxiliaryRecognition")
      }else if(a.type==1&&a.event.type=='mouse'){
        _advOptions.push("_offset")
      }
    }
    _advOptions.push("_monitorUrl")
    BZ._data._uiSwitch._actionAdvTab=_advOptions.find(x=>{
      if(x=="_skipMark"&&a.skipActionElement){
        return 1
      }else if(x=="_failMark"&&a.failElement){
        return 1
      // }else if(x=="_finalElement"&&a.finalElement){
      //   return 1
      }else if(x=="_offset"&&(a.offset||(a.event&&a.event.offset))){
        return 1
      }else if(x=="_monitorUrl"&&a.monitorUrl){
        return 1
      // }else if(a.event&&x=="_auxiliaryRecognition"){
      //   return a.event.fromPanel||a.event.fromPanel||a.event.fromPanel
      }
    })||_advOptions[0]


    _Util._confirmMessage({
      _tag:"div",
      _update:function(){
        _ideTestManagement._save()
        _Util._resizeModelWindow()
      },
      _attr:{
        "class":"bz-h-h-tabs bz-std-tabs",
        style:"margin-top:10px;"
      },
      _items:[
        {
          _tag:"div",
          _attr:{"class":"bz-h-h-tab-items"},
          _items:[
            //tabs
            {
              _tag:"div",
              _attr:{
                "class":function(d){
                  let c="bz-h-h-tab-item "+(d._item==BZ._data._uiSwitch._actionAdvTab?'white-active':'')
                  if(d._item=="_skipMark"&&a.skipActionElement){
                  }else if(d._item=="_failMark"&&a.failElement){
                  // }else if(d._item=="_finalElement"&&a.finalElement){
                  // }else if(d._item=="_auxiliaryRecognition"&&(a.event&&(a.event.fromPanel||a.event.valueStyle||a.event.selectStyle))){
                  }else if(d._item=="_offset"&&(a.offset||(a.event&&a.event.offset))){
                  }else if(d._item=="_monitorUrl"&&a.monitorUrl){
                  }else{
                    return c
                  }
                  return c+" bz-tab-point-blue"
                }
              },
              _text:"_bzMessage._action[_data._item]",
              _dataRepeat:function(){
                return _advOptions
              },
              _jqext:{
                click:function(){
                  BZ._data._uiSwitch._actionAdvTab=this._data._item
                  _Util._resizeModelWindow()
                }
              }
            }
          ]
        },
        {
          _tag:"div",
          _attr:{
            class:"bz-h-h-tab-content",
            style:"padding: 10px;width: calc(100% - 22px);"
          },
          _items:[
            //Skip
            {
              _if:"BZ._data._uiSwitch._actionAdvTab=='_skipMark'",
              _tag:"div",
              _items:function(){
                return [
                  _uiHandler._getElementPath("_IDE._data._curAction.skipActionElement",function(){
                    _bzDomPicker._pickElement(_IDE._data._curAction.skipActionElement,function(v){
                      _IDE._data._curAction.skipActionElement=v
                      _ideTestManagement._save()
                      _Util._resizeModelWindow()
                    })
                  },_bzMessage._action._skipActionElement,0,0,0,0,0,0,function(){
                  return !BZ._isCheckout(0,1)
                })
                ]
              }
            },
            //Failed element
            {
              _if:"BZ._data._uiSwitch._actionAdvTab=='_failMark'",
              _tag:"div",
              _items:[_uiHandler._getElementPath("_IDE._data._curAction.failElement",function(){
                _bzDomPicker._pickElement(_IDE._data._curAction.failElement,function(v){
                  _IDE._data._curAction.failElement=v
                  _ideTestManagement._save()
                  _Util._resizeModelWindow()
                })
              },_bzMessage._action._failElement,0,0,0,0,0,0,function(){
                  return !BZ._isCheckout(0,1)
                })]
            },
            //Final element
            // {
            //   _if:"BZ._data._uiSwitch._actionAdvTab=='_finalElement'",
            //   _tag:"div",
            //   _attr:{
            //     style:"height:200px;"
            //   },
            //   _items:function(){
            //     return [
            //       _bzJSEditor._buildJSEditor({
            //         _model:"_IDE._data._curAction.finalElement",
            //         _style:"height:100%;",
            //         _noBtn:1,
            //         _label:"",
            //         _disabled:"!BZ._isCheckout(0,1)"
            //       })
            //     ]
            //   }
            // },
            //offset
            {
              _if:"BZ._data._uiSwitch._actionAdvTab=='_offset'",
              _tag:"div",
              _attr:{
                style:"margin-top:10px;"
              },
              _items:[
                //Offset on element
                {
                  _tag:"label",
                  _items:[
                    {
                      _tag:"input",
                      _attr:{
                        type:"checkbox",
                        checked:"_IDE._data._curAction.offset",
                        disabled:"!BZ._isCheckout(0,1)"
                      },
                      _jqext:{
                        click:function(){
                          let a=_IDE._data._curAction
                          if(this.checked){
                            if(!a.offset){
                              a.offset={X:0,Y:0,origin:"mc"}
                            }
                          }else{
                            a.offset=0
                            delete a.offset
                          }
                          _ideTestManagement._save()
                          _Util._resizeModelWindow()
                        }
                      }
                    },
                    {
                      _text:"_bzMessage._action._asOffsetAction"
                    }
                  ]
                },
                {
                  _if:"_IDE._data._curAction.offset",
                  _tag:"div",
                  _attr:{
                    "class":"col-xs-12",
                    style:"display:flex;"
                  },
                  _items:[
                    {
                      _tag:"div",
                      _attr:{
                        "class":"input-group",
                        style:"flex:2"
                      },
                      _items:[
                        {
                          _tag:"label",
                          _attr:{
                            "class":"input-group-addon"
                          },
                          _text:"_bzMessage._action._origin"
                        },
                        {
                          _tag:"select",
                          _attr:{
                            "class":"form-control"
                          },
                          _dataModel:"_IDE._data._curAction.offset.origin",
                          _items:[
                            {
                              _tag:"option",
                              _attr:{
                                value:"_data._key"
                              },
                              _text:"_data._item",
                              _dataRepeat:_bzMessage._action._originOptions
                            }
                          ],
                          _jqext:{
                            change:function(){
                              $(this).focus()
                            },
                            focus:function(){
                              _bzDomPicker._showOffset({_element:_IDE._data._curAction.element,_offset:_IDE._data._curAction.offset});
                            }
                          }
                        }
                      ]
                    },
                    {
                      _tag:"div",
                      _attr:{
                        "class":"input-group",
                        style:"flex:1"
                      },
                      _items:[
                        {
                          _tag:"label",
                          _attr:{
                            "class":"input-group-addon input-group-org-addon"
                          },
                          _text:"_data._item"
                        },
                        {
                          _tag:"input",
                          _updateEvent:"blur",
                          _attr:{
                            type:"number",
                            "class":"form-control"
                          },
                          _dataModel:"_IDE._data._curAction.offset[_data._item]",
                          _jqext:{
                            change:function(){
                              $(this).focus()
                            },
                            focus:function(){
                              _IDE._data._curAction.offset[this._data._item]=this.value
                              _bzDomPicker._showOffset({_element:_IDE._data._curAction.element,_offset:_IDE._data._curAction.offset});
                            }
                          }
                        }
                      ],
                      _dataRepeat:["X","Y"]
                    }
                  ]
                }
              ]
            },
            {
              _if:"BZ._data._uiSwitch._actionAdvTab=='_offset'",
              _tag:"div",
              _attr:{
                style:"margin-top:10px;"
              },
              _items:[
                //Offset on target element
                {
                  _if:"_IDE._data._curAction.event.element",
                  _tag:"label",
                  _items:[
                    {
                      _tag:"input",
                      _attr:{
                        type:"checkbox",
                        checked:"_IDE._data._curAction.event.offset",
                        disabled:"!BZ._isCheckout(0,1)"
                      },
                      _jqext:{
                        click:function(){
                          let a=_IDE._data._curAction.event
                          if(this.checked){
                            if(!a.offset){
                              a.offset={X:0,Y:0,origin:"mc"}
                            }
                          }else{
                            a.offset=0
                            delete a.offset
                          }
                          _ideTestManagement._save()
                          _Util._resizeModelWindow()
                        }
                      }
                    },
                    {
                      _text:"_bzMessage._action._asOffsetTargetElement"
                    }
                  ]
                },
                {
                  _if:"_IDE._data._curAction.event.offset",
                  _tag:"div",
                  _attr:{
                    "class":"col-xs-12",
                    style:"display:flex;"
                  },
                  _items:[
                    {
                      _tag:"div",
                      _attr:{
                        "class":"input-group",
                        style:"flex:2"
                      },
                      _items:[
                        {
                          _tag:"label",
                          _attr:{
                            "class":"input-group-addon"
                          },
                          _text:"_bzMessage._action._origin"
                        },
                        {
                          _tag:"select",
                          _attr:{
                            "class":"form-control"
                          },
                          _dataModel:"_IDE._data._curAction.event.offset.origin",
                          _items:[
                            {
                              _tag:"option",
                              _attr:{
                                value:"_data._key"
                              },
                              _text:"_data._item",
                              _dataRepeat:_bzMessage._action._originOptions
                            }
                          ],
                          _jqext:{
                            change:function(){
                              $(this).focus()
                            },
                            focus:function(){
                              _bzDomPicker._showOffset({_element:_IDE._data._curAction.event.element,_offset:_IDE._data._curAction.event.offset});
                            }
                          }
                        }
                      ]
                    },
                    {
                      _tag:"div",
                      _attr:{
                        "class":"input-group",
                        style:"flex:1"
                      },
                      _items:[
                        {
                          _tag:"label",
                          _attr:{
                            "class":"input-group-addon input-group-org-addon"
                          },
                          _text:"_data._item"
                        },
                        {
                          _tag:"input",
                          _updateEvent:"blur",
                          _attr:{
                            type:"number",
                            "class":"form-control"
                          },
                          _dataModel:"_IDE._data._curAction.event.offset[_data._item]",
                          _jqext:{
                            change:function(){
                              $(this).focus()
                            },
                            focus:function(){
                              _IDE._data._curAction.event.offset[this._data._item]=this.value
                              _bzDomPicker._showOffset({_element:_IDE._data._curAction.event.element,_offset:_IDE._data._curAction.event.offset});
                            }
                          }
                        }
                      ],
                      _dataRepeat:["X","Y"]
                    }
                  ]
                }
              ]
            },
            //monitorUrl
            {
              _if:"BZ._data._uiSwitch._actionAdvTab=='_monitorUrl'",
              _tag:"div",
              _items:[
                {
                  _tag:"div",
                  _attr:{
                    style:"padding:5px;"
                  },
                  _items:[
                    {
                      _tag:"label",
                      _items:[
                        {
                          _tag:"input",
                          _attr:{
                            type:"checkbox",
                            checked:"_IDE._data._curAction.monitorUrl",
                            disabled:"!BZ._isCheckout(0,1)"
                          },
                          _jqext:{
                            click:function(){
                              let a=_IDE._data._curAction
                              if(a.monitorUrl){
                                a.monitorUrl=""
                              }else{
                                a.monitorUrl=`function(url){\n  if(url.includes("${_bzMessage._action._monitorUrlValue}")){\n    $util.openApp(url);\n    return 1;\n  }\n}`
                              }
                              _ideTestManagement._save(0,0,function(){
                                _Util._resizeModelWindow()
                              })
                            }
                          }
                        },
                        {
                          _text:"_bzMessage._action._enableMonitorUrl"
                        }
                      ]
                    }
                  ]
                },
                {
                  _if:"_IDE._data._curAction.monitorUrl",
                  _tag:"div",
                  _attr:{
                    style:"height:200px;"
                  },
                  _items:function(){
                    return [
                      _bzJSEditor._buildJSEditor({
                        _model:"_IDE._data._curAction.monitorUrl",
                        _style:"height:100%;",
                        _noBtn:1,
                        _label:"",
                        _disabled:"!BZ._isCheckout(0,1)"
                      })
                    ]
                  }
                }
              ]
            },
            {
              _tag:"div",
              _attr:{
                style:"padding:5px 10px;"
              },
              _items:[
                _uiHandler._getToggle({
                  _dataModel:"BZ._data._uiSwitch._showAdvHelp",
                  _text:[_bzMessage._help._learn,_bzMessage._help._hideLearn]
                }),
              ]
            },
            {
              _if:"BZ._data._uiSwitch._showAdvHelp",
              _tag:"div",
              _attr:{
                class:"bz-note-text"
              },
              _text:function(){
                let v=BZ._data._uiSwitch._actionAdvTab;
                if(v=="_skipMark"){
                  v="_skipActionDesc"
                }else if(v=="_failMark"){
                  v="_failElementDesc"
                // }else if(v=="_finalElement"){
                //   v="_finalElementDesc"
                }else if(v=="_offset"){
                  v="_offsetDesc"
                // }else if(v=="_auxiliaryRecognition"){
                //   v="_auxiliaryRecognitionDesc"
                }else if(v=="_monitorUrl"){
                  v="_monitorUrlDesc"
                }
                return _bzMessage._action[v]
              }
            }
          ]
        }
      ]
    },[],_bzMessage._common._advanced,600)
    setTimeout(()=>{
      _Util._resizeModelWindow()
    },100)
  },
  _hasOption:function(a){
    let e=a.event
    return a.min||a.max||a.retryable||a.autoDelay||a.errOnHidden||a.force||a.failedReaction||a.noLightAction||a.disableAISet||a.multipleElement||(e&&(e.supportReadOnly||e.download||e.repElementMethod))
  },
  _getRecommendValueByData:function(d){
    let vs=new Set(),m=_IDE._data._curModule
    try{
      let v=eval(d)
      _addValue(v)
    }catch(ex){}
    d=d.split(".")
    if(d[0]=="$parameter"&&_aiGeneratorDataHandler._isAIModule()){
      m=m._data
    }else if(d[0]=="$project"){
      m=_ideModuleManagement._getItemByCurDataName(d[1])
    }

    d=d[2]||d[1]

    d&&m&&m.definition&&m.definition.fields.forEach(x=>{
      if(x.data==d){
        _addValue(x.demoValue)
        _addValue(x.inputFormat)

        if(_Util._isRegexData(x.inputFormat)){
          _addValue($util.generateDataByRegex(x.inputFormat));
        }
      }
    })
    if(!vs.size){
      return ["N/A"]
    }

    return [...vs]

    function _addValue(v){
      vs.add(v)
      // let v2=JSON.stringify(v)||"undefined"
      // if(v2!=v){
      //   vs.add(v2)
      // }
    }
  },
  _getRecommendDataByValue:function(v){
    let vs=v.split(/[\s-_.,:\/\(\)\[\]\{\}0-9\&]+/).map(x=>x.toLowerCase()),
        vv=[],rs=[],
        m=_IDE._data._curModule

    if(!m||!vs.length){
      return
    }

    m=m._data

    if(_aiGeneratorDataHandler._isAIModule()){
      _IDE._data._curVersion.modules.forEach(x=>{
        let xx=x.name.toLowerCase(),
            xs=xx.plural(),
            a=(x.alias||"").toLowerCase(),
            as=a.plural();
  
        if(vs.includes(xx)||vs.includes(xs)||vs.includes(a)||vs.includes(as)){
          _addItemByModule(x)
        }
      })
  

      m.definition.fields.filter(x=>{
        let f=x.inputFormat
        if(f&&!x.module){
          if(f==v||x.demoValue==v){
            return 1
          }else if(_Util._isRegexData(f)){
            try{
              return eval(`v.match(${f})`)
            }catch(ex){}
          }
        }
      }).forEach(x=>{
        rs.push("$parameter."+x.data)
      })
      if(!rs.length){
        m.definition.fields.forEach(x=>{
          if($.isNumeric(v)){
            if(x.type=="number"){
              rs.push("$parameter."+x.data)
            }
          }else{
            if(x.module){
              _addItemByModule(_ideObjHandler._getDataByPath(x.module))
            }else if(x.type!="number"){
              rs.push("$parameter."+x.data)
            }
          }
        })
      }
    }else if(_IDE._data._curTest){
      let ds=["$parameter","$test","$module","$project","$loop"]
      ds.forEach(x=>{
        let d=window[x]
        if(d){
          _findValue(d,v,x)
        }
      })
      if(!rs.length){
        ds.forEach(x=>{
          let d=window[x]
          _findPath(d,v,x)
        })
      }
    }
    if(_Util._isEmpty(rs)){
      rs=["N/A"]
    }
    return rs

    function _findValue(d,v,p){
      if(d){
        if(d==v){
          rs.push(p)
        }else if(d.constructor==Object){
          Object.keys(d).forEach(xx=>{
            if(xx!="_tmpIdx"){
              if(_Util._isDotableKey(xx)){
                _findValue(d[xx],v,p+"."+xx)
              }else{
                _findValue(d[xx],v,p+"['"+xx+"']")
              }
            }
          })
        }
      }
    }


    function _findPath(d,v,p){
      if(d){
        if($.isNumeric(d)&&$.isNumeric(v)){
          rs.push(p)
        }else if(d.constructor==String&&!$.isNumeric(v)){
          rs.push(p)
        }else if(d.constructor==Object){
          Object.keys(d).forEach(xx=>{
            if(xx!="_tmpIdx"){
              if(_Util._isDotableKey(xx)){
                _findPath(d[xx],v,p+"."+xx)
              }else{
                _findPath(d[xx],v,p+"['"+xx+"']")
              }
            }
          })
        }
      }
    }
    function _addItemByModule(x){
      if(_aiGeneratorDataHandler._isAIModule(x)){
        if(x!=m){
          m.definition.fields.forEach(x=>{
            if(x.module==x.code){
              rs.push("$parameter."+x.data)
            }
          })
        }
        _addItemByField(x)
      }
    }

    function _addItemByField(x){
      let fs=_aiGeneratorDataHandler._getLabelFields(x,1)
      let ck=_aiGeneratorDataHandler._getCurModuleDataName(x)
      fs.forEach(x=>{
        if(x==m){
          rs.push("$parameter."+x.data)
        }else{
          rs.push("$project."+ck+"."+x.data)
        }
      })
    }
  },
  _getActionOptions:function(d){
    
    let ak="_IDE._data._curAction."
    let v=[]

    if(d.apiReplaceEvent){
      if(d.requests&&d.requests[0]&&d.requests[0].method){
        return [{
          k:"BZ._data._uiSwitch._apiRequest.asStdFun",
          t:_bzMessage._model._api.asStdFun[d.requests[0].method],
          _extra:{
            _if:function(){
              return BZ._data._uiSwitch._apiRequest.asStdFun&&BZ._data._uiSwitch._apiRequest.method=='GET'
            },
            t:_bzMessage._api._setInitParameter+' ...',
            f:function(){
              _ideTestManagement._setInitParameter(BZ._data._uiSwitch._apiRequest)
            }
          }
        }]
      }
      return []
    }
    if("456789a".includes(d.type)||d.runInIDE){
      return v
    }

    v.push({
      k:ak+"autoDelay",
      t:"_autoDelay"
    })

    if(!_IDE._data._setting.content.hiddenAsUnexist){
      v.push({
        k:ak+"errOnHidden",
        t:"_markErrorOnHidden"
      })
    }else{
      v.push({k:ak+"force",t:"_allowExeOnHiddenElement"})
    }
    v.push({
      k:ak+"failedReaction",
      t:"_failedReaction"
    })
    if(d.type==1){
      if(d.event&&d.event.type=="change"){
        v.push({
          k:ak+"disableAISet",
          t:"_disableAISet"
        },{
          k:ak+"event.supportReadOnly",
          t:"_supportReadonlySet"
        },{
          k:ak+"noLightAction",
          t:"_noLightAction"
        })
      }else{
        v.push({
          k:ak+"retryable",
          t:"_retryable"
        },{
          k:ak+"event.download",
          t:"_downloadAction"
        },{
          k:ak+"event.repElementMethod",
          t:"_useComboAction",
          _extra:{
            _if:function(){
              return _IDE._data._curAction.event.repElementMethod
            },
            t:_bzMessage._action._chkDetailsInOverview,
            f:function(){
              _testTabHandler._data._curCfgTab='details'
            }
          }
        })
      }
      v.push({
        k:ak+"triggerPopup",
        t:"_triggerPopup",
        _extraCombo:{
          _if:function(){
            return _IDE._data._curAction.triggerPopup
          },
          _tag:"div",
          _attr:{
            style:"max-width:400px;"
          },
          _items:[
            {
              _if:"!_IDE._data._curAction.event.alerts",
              _tag:"div",
              _items:[
                {
                  _tag:"div",
                  _attr:{
                    style:"display:flex;"
                  },
                  _items:[
                    {
                      _tag:"div",_attr:{"class":"input-group",style:"flex:1;"},
                      _items:[
                        {
                          _tag:"label",
                          _attr:{"class":"input-group-addon"},
                          _text:"_bzMessage._action._popType"
                        },
                        {
                          _tag:"select",
                          _focus:1,
                          _attr:{
                            "disabled":"!BZ._isCheckout()",
                            "class":"form-control",
                          },
                          _dataModel:"_IDE._data._curAction.event.popType",
                          _items:[
                            {
                             _tag:"option",
                              _attr:{
                                value:"_data._item"
                              },
                              _text:"_data._item",
                              _dataRepeat:["","alert","confirm","prompt","onbeforeunload"]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      _if:function(){
                        let a=_IDE._data._curAction
                        return ['confirm','prompt'].includes(a&&a.event.popType)
                      },
                      _tag:"div",
                      _attr:{
                        style:"flex:1"
                      },
                      _items:[_actionCompareViewDef]
                    }
                  ]
                },
                //return value
                {
                  _if:function(){
                    let a=_IDE._data._curAction
                    return ['confirm','prompt'].includes(a&&a.event.popType)
                  },
                  _tag:"div",_attr:{"class":"input-group"},
                  _items:[
                    {
                      _tag:"label",
                      _attr:{"class":"input-group-addon"},
                      _text:"_bzMessage._action._returnValue"
                    },
                    {
                      _tag:"input",
                      _attr:{
                        "disabled":"!BZ._isCheckout()",
                        type:"text",
                        "class":"form-control"
                      },
                      _dataModel:"_IDE._data._curAction.event.returnValue"
                    }
                  ]
                },
                {
                  _if:"_IDE._data._curAction.event.popType",
                  _tag:"label",
                  _attr:{
                    "disabled":"!BZ._isCheckout()",
                    style:"margin-top: 10px;display: block;"
                  },
                  _items:[
                    {
                      _tag:"input",
                      _attr:{
                        type:"checkbox"
                      },
                      _dataModel:"_IDE._data._curAction.event.popFollow"
                    },
                    {
                      _text:_bzMessage._action._popFollow
                    }
                  ]
                }
              ]
            },
            //For multiple alerts
            {
              _if:"_IDE._data._curAction.event.alerts",
              _tag:"div",
              _items:[
                {
                  _tag:"div",
                  _attr:{"class":"bz-prompt-item"},
                  _dataRepeat:"_IDE._data._curAction.event.alerts",
                  _items:[
                    {
                      _tag:"a",
                      _text:"_data._item.popType+': '+(_data._item.expectation||'')+', '+_data._item.returnValue",
                      _jqext:{
                        click:function(){
                          _domRecorder._showSetAlert(this._data._item)
                        }
                      }
                    },
                    {
                      _tag:"button",
                      _attr:{
                        "class":"btn bz-small-btn bz-delete pull-right",
                        style:"position:absolute"
                      },
                      _jqext:{
                        click:function(){
                          _IDE._data._curAction.event.alerts.splice(this._data._idx,1)
                          if(!_IDE._data._curAction.event.alerts.length){
                            delete _IDE._data._curAction.event.alerts
                          }
                        }
                      }
                    }
                  ]
                }
              ]
            }
          ]
        }
      })
    }else if(d.type==2&&d.element){
      v.push({
        k:ak+"multipleElement",
        t:"_markMultipleElement"
      })
    }

    return v
  },
  _getExActionViewDef:function(_if){
    return {
      _if:_if,
      _tag:"div",
      _attr:{
        style:function(d,c,o){
          return "flex:1;display:block;margin:0;"
        },
        "class":"col-xs-12 bz-action-in-details"
      },
      _after:function(o){
        setTimeout(()=>{
          if(!o.innerText){
            o.style.display="none"
          }
        },10)
      },
      _items:[
        //loopData($action,$group)
        {
          _if:"_data._item.loopData",
          _tag:"div",
          _attr:{"class":"bz-pre-box","type-label":"_Util._formatMessage(_bzMessage._action._preScript,_data._item.type==7?'$group':'$action')"},
          _items:[
            {
              _tag:"pre",
              _attr:{"class":"bz-pre"},
              _text:"_data._item.loopData"
            }
          ],
          _jqext:{
            click:function(e){
              let _this=this
              setTimeout(()=>{
                 _testTabHandler._openTab("script",_this,e)
                 BZ._data._uiSwitch._showActionNote='_loopData'
              },100)
            }
          }
        },
        //Script
        {
          _if:"_data._item.script",
          _tag:"div",
          _attr:{"class":"bz-pre-box","type-label":"_bzMessage._action._script"},
          _items:[
            {
              _tag:"pre",
              _attr:{"class":"bz-pre"},
              _text:"_ideDataHandler._parseToExeCode(_data._item.script)"
            }
          ],
          _jqext:{
            click:function(e){
              _testTabHandler._openTab("main",this,e)
            }
          }
        },
        //Result Script
        {
          _if:"_data._item.resultscript",
          _tag:"div",
          _attr:{"class":"bz-pre-box","type-label":"_bzMessage._test._tab.resultscript"},
          _items:[
            {
              _tag:"pre",
              _attr:{"class":"bz-pre"},
              _text:"_ideDataHandler._parseToExeCode(_data._item.resultscript)"
            }
          ],
          _jqext:{
            click:function(e){
              _testTabHandler._openTab("script",this,e)
            }
          }
        },
        //Conditions
        {
          _tag:"div",
          _after:function(o){
            setTimeout(()=>{
              if(!o.children.length){
                o.remove()
              }
            },10)
          },
          _jqext:{
            click:function(e){
              _testTabHandler._openTab("condition",this,e)
            }
          },
          _items:[
            {
              _if:function(d){
                return d._supData._item[d._item.toLowerCase()+"Parameter"]||d._supData._item[d._item.toLowerCase()+"Goto"]||d._supData._item['refOf'+d._item]&&(d._item!="Success"||d._supData._item.type!=4||(d._supData._item.refOfSuccess&&d._supData._item.refOfSuccess.match(/(^|\/)([swfec])(\/|$)/)))
              },
              _tag:"div",
              _attr:{
                style:"margin:5px 0 0 0;"
              },
              _items:[
                {
                  _tag:"div",
                  _attr:{"class":"bz-flex-all"},
                  _after:function(o){
                    setTimeout(()=>{
                      if(!o.children.length){
                        $(o).hide()
                      }
                    },10)
                  },
                  _items:[
                    {
                      _if:function(d){
                        let s=d._supData._item.refOfSuccess
                        return d._item!='Success'||d._supData._item.type!=4||(s&&s.match(/(^|\/)([swfec])(\/|$)/))||(d._supData._item.successGoto)
                      },
                      _tag:"span",
                      _after:function(o){
                        $(o.parentElement).show()
                      },
                      _items:[
                        {
                          _tag:"span",
                          _text:"_bzMessage._test._tab[_data._item.toLowerCase()]+': '"
                        },
                        //report result
                        {
                          _tag:"span",
                          _items:[
                            {
                              _tag:"span",
                              _attr:{
                                "class":function(d){
                                  return "bz-"+d._item.toLowerCase()+"";
                                }
                              }
                            },
                            {
                              _if:function(d){
                                let p=d._supData._item["refOf"+d._item]
                                p=p.match(/(^|\/)[sfecw](\/|$)/)
                                if(p){
                                  return !p[0].includes(d._item[0].toLowerCase())
                                }
                              },
                              _tag:"span",
                              _attr:{
                                "class":"bz-assign"
                              }
                            },
                            {
                              _if:function(d){
                                let p=d._supData._item["refOf"+d._item]
                                p=p.match(/(^|\/)[sfecw](\/|$)/)
                                if(p){
                                  return !p[0].includes(d._item[0].toLowerCase())
                                }
                              },
                              _tag:"span",
                              _attr:{
                                "class":function(d){
                                  let p=d._supData._item["refOf"+d._item].match(/(^|\/)[sfecw](\/|$)/)
                                  if(p){
                                    p=p[0].replace(/[\/]/g,"")
                                    switch(p){
                                      case "s":p="success";break;
                                      case "f":p="failed";break;
                                      case "e":p="error";break;
                                      case "w":p="warning";break;
                                      case "c":p="crash";break;
                                    }
                                    return "bz-"+p
                                  }
                                }
                              }
                            },
                          ]
                        }
                      ]
                    },
                    {
                      _if:"(_data._item!='Success'||_data._supData._item.type!=4)&&(_data._supData._item['refOf'+_data._item].match(/[\{m]/))",
                      _tag:"span",
                      _items:[
                        {
                          _tag:"span",
                          _attr:{
                            "class":"bz-assign"
                          }
                        },
                        {
                          _if:"_data._supData._item['refOf'+_data._item].match(/[m]/)",
                          _tag:"span",
                          _attr:{
                            "class":function(d){
                              let c="bz-assign "
                              let t=d._supData._item['refOf'+d._item]
                              t=_ideObjHandler._getDataByPath(t)
                              if(t){
                                c+="bz-"+t._data.type
                              }
                              return c
                            }
                          }
                        },
                      ]
                    },
                    {
                      _if:"(_data._item!='Success'||_data._supData._item.type!=4)&&(_data._supData._item['refOf'+_data._item].match(/[\{m]/))",
                      _tag:"a",
                      _attr:{
                        style:"'text-decoration: underline;overflow: hidden;white-space: nowrap;flex-shrink:200;direction:'+(_data._supData._item['refOf'+_data._item].match(/[\{]/)?'ltr':'rtl')"
                      },
                      _text:function(d){
                        return _ideActionManagement._getRefDesc(d._supData._item,"refOf"+d._item)||""
                      },
                      _jqext:{
                        click:function(){
                          let d=this._data
                          d=_ideObjHandler._getDataByPath(d._supData._item["refOf"+d._item])
                          BZ._setHash(d)
                        }
                      }
                    },
                    {
                      _if:function(d){
                        return d._supData._item["refOf"+d._item].match(/(^|\/)[\.]+(\/|$)/)
                      },
                      _tag:"span",
                      _attr:{
                        "class":"bz-assign "
                      }
                    },
                    {
                      _if:function(d){
                        return d._supData._item["refOf"+d._item].match(/(^|\/)[\.]+(\/|$)/)
                      },
                      _tag:"span",
                      _attr:{
                        "class":"_data._supData._item['refOf'+_data._item].includes('..')?'bz-break-test-box':'bz-next-action-box'"
                      }
                    },
                    {
                      _if:function(d){
                        return d._supData._item["refOf"+d._item].match(/(^|\/)[\.]+(\/|$)/)
                      },
                      _tag:"span",
                      _attr:{
                        style:"overflow: hidden;white-space: nowrap;direction: rtl;flex-shrink:200;margin-left:5px;"
                      },
                      _text:function(d){
                        d=d._supData._item["refOf"+d._item].match(/(^|\/)[\.]+(\/|$)/)
                        d=d[0].replace(/[\/]/g,"")
                        return _bzMessage._ref[d]
                      }
                    },
                    {
                      _if:function(d){
                        return d._supData._item[d._item.toLowerCase()+"Goto"]
                      },
                      _tag:"span",
                      _attr:{
                        style:"overflow: hidden;white-space: nowrap;",
                      },
                      _items:[
                        {
                          _tag:"span",
                          _attr:{
                            "class":"bz-assign"
                          }
                        },
                        {
                          _tag:"button",
                          _attr:{
                            "class":"bz-flag btn btn-icon"
                          }
                        },
                        {
                          _text:function(d){
                            return d._supData._item[d._item.toLowerCase()+"Goto"]
                          }
                        }
                      ]
                    }
                  ]
                },
                {
                  _if:function(d){
                    return d._supData._item[d._item.toLowerCase()+'Parameter']
                  },
                  _tag:"div",
                  _attr:{"class":"bz-pre-box","type-label":"_bzMessage._common._parameter"},
                  _after:function(o){
                    setTimeout(()=>{
                      if($(o.previousSibling).css("display")=="none"){
                        $(o).css({"margin-top":0})
                      }
                      $(".row-selected").click()
                    },10)
                  },
                  _items:[
                    {
                      _tag:"pre",
                      _attr:{"class":"bz-pre"},
                      _text:function(d){
                        d=d._supData._item[d._item.toLowerCase()+'Parameter']
                        if(d&&[Object,Array].includes(d.constructor)){
                          d=JSON.stringify(d,0,2)
                        }
                        return d
                      }
                    }
                  ]
                }
              ]
            }
          ],
          _dataRepeat:function(){
            let vs=["Success","Failed","Error"]
            let t=_IDE._data._curTest
            if(!t){
              t=BZ._data._uiSwitch._curGuiTest.t
            }else{
              t=t._data
            }
            if(t.type=="int"){
              vs=["Success"]
            }
            return vs
          }
        }
      ]
    }
  },
  _exeCurTask:function(a,_fun){
    _ideTask._start(a,_fun)
  },
  _getTmpSolutionAction:function(){
    return {
      _if:function(d){
        let r=_IDE._data._curTest._result[d._item._actionIdx]
        if(r&&r._data){
          return !BZ._isPlaying()&&r._tmpRefTest
        }
      },
      _tag:"button",
      _attr:{
        class:"btn-primary",
        style:"padding:0 10px;border-radius:10px;height:21px;margin:auto;"
      },
      _text:"_bzMessage._task._solutionTest",
      _jqext:{
        click:function(){
          BZ._setHash(this._viewDef._if(this._data))
        }
      }
    }
  },
  _updateActionCommentDesc:function(a){
    if(window.extensionContent){
      bzComm.postToIDE({fun:"_updateActionCommentDesc",scope:"_ideActionManagement",ps:[a]});
    }else if(_IDE._data._curAction.type==_ideActionData._type._comment){
      _IDE._data._curAction.description=a.description;
      _ideTestManagement._save()
    }
  },
  _quickUpdateExpectation:function(a){
    if(!a){
      a=_IDE._data._curAction;
    }
    if(a.method==_ideActionData._method._html){
      if(BZ._hasExtension()){
        _ideComm._updateExpectation(a)
      }else{
        _domActionTask._exeAction(a,{_force:1,_taskQueue:[]},function(){
          if(window.extensionContent){
            BZ._formatInIFramePath(a.element)
            chrome.runtime.sendMessage({_updateAction:a});
          }
        })
      }
    }else if(a.method==_ideActionData._method._data && a.api.httpMethod=="GET"){
      _ideTask._start(a);
    }
  },
  _getMissElement:function(d){
    if(_ideActionManagement._hasElement(d)){
      d=d.panel||d.element
      if(!d||!d.length){
        return "_element"
      }
      d=d[d.length-1]
      if(d!=0&&$.isNumeric(d)){
        return "_warn"
      }
    }
  },
  _getMissValue:function(d){
    if(d.apiReplaceEvent){
      return (!d.requests||!d.requests.length)&&"_requests"
    }
    //script
    if((!d.type && d.method==_ideActionData._method._script)||("23".includes(d.type))){
      return !d.script&&"_script";
    }
    //plugin
    if(d.type==4){
      var c=d.refOfSuccess&&d.refOfSuccess.match(_IDE._testKeyRegex)
      return (!c||!_ideObjHandler._getDataByPath(c[0]))&&(!d.refOfSuccess||!d.refOfSuccess.match(/\{\{.+\}\}/))
    }else if("02".includes(d.type)&&d.method==_ideActionData._method._data){
      if(!d.api||(!d.api.host&&(!d.api.httpURL||d.api.httpURL=="/"))){
        return "_url"
      }
    }
    
    if(!d.type){
      return (d.content &&["data"].includes(d.content.type)&&!d.expectation&&!d.md5)&&"_expectation"
    }else if(d.type==5&&!d.description){
      return "_description"
    }else if(d.type==9&&!d.data){
      return "_data"
    }
  },
  _getMissSetting:function(d){
    return _ideActionManagement._getMissElement(d)||_ideActionManagement._getMissValue(d)
  },
  _getDataStatus:function(d){
    var _msg=_ideActionManagement._getMissSetting(d);
    if(!_msg){
      return _ideActionData._dataStatus._ok;
    }else if(_msg=="_warn"){
      return _ideActionData._dataStatus._warning;
    }else{
      return _ideActionData._dataStatus._notReady;
    }
  },
  _hasElement:function(d){
    var tt=_ideActionData._type;
    return !d.apiReplaceEvent
           &&(((d.type==tt._validation ||d.type==tt._extractData) && d.method==_ideActionData._method._html)
           || d.type==tt._triggerEvent 
           || d.type==tt._comment
           || d.type==tt._visit
           || d.type==tt._fillForm);
  },
  _updateCurElementOnEditPath:function(_key,_this,_data){
    let g=_this._data._group(),
        _idx=_this._data._idx,_lastIdx
    let v=g[_idx]||"",
        dv=_this._viewDef._dataModel()
    dv=dv.replace(/\[[0-9]+\]$/,"")
    if(v){
      let ws=_ideActionManagement._splitElementBySpace(v)
      g.splice(_idx,1,...ws)
      _idx=""
      for(var i=g.length-1;i>=0;i--){
        let x=g[i]
        if($.isNumeric(x)){
          g.splice(i,1)
          _lastIdx=x
        }else if(x==""){
          g.splice(i,1)
        }else if(_idx===""){
          _idx=_lastIdx||0
        }
      }
      g.push(_idx||0)
    }else{
      g.splice(_idx,1)
    }
    _this._data._item=g[_this._data._idx]
      
    eval(dv+"=g")
    return _this._data._item

  },
  _splitElementBySpace:function(v){
    let km={
      '[':']',
      '{':'}',
      '(':')'
    },k,s="",w=[]
    
    for(let i=0;i<v.length;i++){
      let c=v[i]
      if(k==c){
        k=""
        s+=c
      }else if(c==" "&&!k){
        if(s){
          w.push(s)
        }
        s=""
      }else{
        k=k||km[c]
        s+=c
      }
    }
    if(s){
      w.push(s)
    }
    return w
  },
  _isSimplyRefData:function(v){
    return v&&v.constructor==String&&v.match(/^(\$project|\$module|\$test|\$loop|\$parameter)/)
  },
  _assignActionDescWidth:function(o,d){
    // let w=o.innerText
    // w=_Util._getListSum($(o).find(".bz-action-desc>*").toArray().map(x=>x.getBoundingClientRect().width))
    // // w=Math.max(,w.length*5.7)
    // w+=$(o).find(".bz-action-idx")[0].getBoundingClientRect().width
    // w+=$(o).find(".bz-action-method")[0].getBoundingClientRect().width
    // if(d==_IDE._data._curAction){
    //   w+=90
    // }else if(d.min||d.max){
    //   w+=70
    // }else{
    //   w+=50
    // }
    // $(o).css({width:w})
    // return w;
    let w=_Util._getElementBestWidth(o.children[0])
    // for(let e of o.children){
    //   w+=_Util._getElementBestWidth(e)
    // }
    $(o).css({width:w})
    return w
  },
  _initMapParameterData:function(_curParameter,_doMap){
    //Get Ref-Test Parameters
    let p=_curParameter.split(".").pop().replace("Parameter","")
    p=_IDE._data._curAction["refOf"+p[0].toUpperCase()+p.substring(1)]
    p=p&&p.match(_IDE._testKeyRegex)
    if(p){
      p=p[0]
      p=_ideObjHandler._getDataByPath(p)
      if(p){
        p=_ideTestManagement._getRefDefParameterViewData(p._data.defParameter,p)
        for(var k in p){
          p[k]={_orgDefValue:p[k]}
        }
      }
    }
    
    if(!p){
      return
    }
    let vs={}
    let pp=_ideTestManagement._getFinalParameterData(_IDE._data._curTest._data.defParameter)
    pp=[{_path:"$parameter",_data:pp}]
    if($loop){
      pp.push({_path:"$loop",_data:$loop})
    }

    pp.forEach(v=>{
      if(v._data){
        if(v._data.constructor==Object){
          for(var k in v._data){
            vs[v._path+"."+k]=v._data[k]
          }
        }else{
          vs[v._path]=v._data
        }
      }
    })

    BZ._data._uiSwitch._mapRefParameterOptions=[]
    let _curData=_ideTestManagement._getDefParameterViewData(_curParameter)
    if(_ideActionManagement._isSimplyRefData(_curData)){
      try{
        var d=eval(_curData)
        _pickMapValue(p,d,vs,_curData)
      }catch(e){}
    }else if(_curData&&!_Util._isEmpty(_curData)){
      if(_curData&&_curData.constructor==Object){
        _pickMapValue(p,_curData,vs)
      }else{
        let vv=_Util._parseJSONWithRefDataToObj(_curData)
        vv.forEach(v=>{
          let k=v._key,x=v._value
          if(p[k]){
            p[k]._chk="on"
            p[k]._mapName=x.replace(/(^\"|\"$)/g,"")
            if(!vs[x]){
              vs[x]={_staticValue:1}
            }
          }
        })
      }
    }
    if(_doMap){
      if($loop){
        _pickMapValue(p,$loop,vs,"$loop")
      }else if($parameter){
        _pickMapValue(p,$parameter,vs,"$parameter")
      }
    }
    
    for(let k in vs){
      BZ._data._uiSwitch._mapRefParameterOptions.push({
        _name:k,
        _staticValue:vs[k]._staticValue,
        _value:!vs[k]._staticValue&&!vs[k]._new&&vs[k],
        _new:vs[k]._new||!vs[k]
      })
    }

    return p
    
    function _pickMapValue(p,o,vs,_rootPath){
      let ok=_Util._getDataKeyMap(o),
          pk=_Util._getDataKeyMap(p)
      
      for(let kk in ok){
        let k=pk[kk]
        if(k){
          p[k]._chk="on"
          if(!p[k]._mapName){
            if(_rootPath){
              p[k]._mapName=_rootPath+"."+ok[kk]
            }else if(v){
              p[k]._mapName=o[k]
            }
          }
        }
      }
    }
    
  },
  _isComAction:function(a){
    return (a.path||a.element||[]).find(x=>{
      if(x&&x.constructor==String){
        return x.match(/^\:([a-z0-9]+)(\((.*)\))?$/is)
      }
    })
  },
  _getComDataFromElement:function(a,_shortcut){
    if(a.refCom&&Date.now()-a.refComParameter._time<1000){
      return a.refComParameter
    }
    if(!_Util._isEmpty(a.element)){
      let cm=_ideObjHandler._getDataByPath("com")||{_data:{tests:[]}}
      cm=cm._data
      a.element.find(x=>{
        if(x&&x.constructor==String){
          x=x.match(/^\:([a-z0-9]+)(\((.*)\))?$/is)
          if(x){
            return cm.tests.find(t=>{
              let k="com."+t.code
              if(t.name==x[1]){
                a.refCom=k
                a.refComParameter={
                  _time:Date.now(),
                  $fun:x[1],
                  $document:a.element[0].includes("BZ.TW.document")?a.element[0]:"BZ.TW.document",
                  $label:x[3],
                  $value:a.event?a.event.value:(a.expectation||{})
                }
                return 1
              }
            })
          }
        }
      })
      return a.refComParameter
    }
  },
  _getTypingOptionsViewDef:function(dd){
    return [
      //event type (key, change), button, ctrl,alt,shift
      {
        _tag:"div",
        _attr:{"class":"input-group",style:"display:flex;"},
        _items:[
          {
            _tag:"label",
            _attr:{"class":"input-group-addon"},
            _text:"_bzMessage._common._method",
          },
          //Event type
          {
            _tag:"select",
            _attr:{
              "class":"form-control",
              style:"flex:1"
            },
            _items:[
              {
                _tag:"option",
                _text:"_data._item",
                _dataRepeat:[
                  "change",
                  "change + blur",
                  "change + enter",
                  "change + enter + blur",
                  "key",
                  "change + submit"
                ],
                _attr:{
                  selected:function(d){
                    let a=eval(dd)
                    let k=a.event.type=="change",
                        b=a.event.autoBlur,
                        e=a.withEntry
                    switch(d._idx){
                      case 0:
                        return k&&!b&&!e
                      case 1:
                        return k&&b&&!e
                      case 2:
                        return k&&!b&&e
                      case 3:
                        return k&&b&&e
                      case 4:
                        return !k
                      case 5:
                        return k&&a.withSubmit
                    }
                  }
                }
              }
            ],
            _jqext:{
              change:function(){
                let a=eval(dd)
                let _event=a.event
                _event.download=0
                if(this.value=="key"){
                  _event.action="group"
                  _event.value=""
                  _event.type="key"
                }else{
                  delete _event.action
                  _event.type="change"
                  delete a.withSubmit
                  if(this.selectedIndex==5){
                    a.withSubmit=1
                    delete a.withEntry
                  }else if(this.selectedIndex>1){
                    a.withEntry=1
                  }else{
                    delete a.withEntry
                  }
                  if("13".includes(this.selectedIndex)){
                    _event.autoBlur=1
                  }else{
                    delete _event.autoBlur
                  }
                }
                _CtrlDriver._triggerUpdateData(this)
              }
            }
          },
          //keyboard key
          {
            _if:dd+".event.type=='key'",
            _tag:"select",
            _attr:{
              value:"_data._item",
              style:"flex:1;border:var(--bz-border);border-left:0;",
              "class":"form-control",
            },
            _dataModel:dd+".event.action",
            _items:[
              {
                _tag:"option",
                _attr:{
                  value:"_data._item._value"
                },
                _text:function(d){
                  return d._item._text?d._item._text:d._item._value;
                },
                _dataRepeat:[{
                  _value:"group",
                  _text:_bzMessage._action._keyGroup
                },{
                  _value:"down",
                  _text:"keydown"
                },{
                  _value:"press",
                  _text:"keypress"
                },{
                  _value:"up",
                  _text:"keyup"
                }]
              }
            ]
          }
        ]
      },
      //keyExtra (ctrl/alt/shift/keyCode/char)
      {
        _if:dd+".event.type=='key'&&"+dd+".event.action!='group'",//&&_IDE._data._curAction.event.action!="group"
        _tag:"div",
        _attr:{
          style:"display:flex;"
        },
        _items:[
          {
            _tag:"div",
            _attr:{style:"display:flex;flex:1;border: 1px solid var(--input-border-color);height:25px;","class":"input-group"},
            _items:[
              {
                _tag:"label",
                _attr:{
                  style:"flex:1;padding:5px;"
                },
                _items:[
                  {
                    _tag:"input",
                    _attr:{
                      type:"checkbox",
                      value:"_data._item",
                    },
                    _dataModel:dd+".event[_data._item]"
                  },
                  {
                    _text:"_data._item"
                  }
                ],
                _dataRepeat:["ctrl","alt","shift"]
              }
            ]
          },
          {
            _tag:"div",
            _attr:{style:"flex:1;display:flex;margin-top:1px;"},
            _items:[
              {
                _tag:"div",
                _attr:{
                  "class":"input-group",
                  style:"flex:1;"
                },
                _items:[
                  {
                    _tag:"label",
                    _attr:{"class":"input-group-addon input-group-org-addon"},
                    _text:"_data._key"
                  },
                  {
                    _tag:"input",
                    _attr:{
                      "class":"form-control"
                    },
                    _dataModel:dd+".event[_data._item]",
                    _jqext:{
                      keydown:function(e){
                        let d=eval(dd).event;
                        var k=_Util._checkKeycode(e);
                        d.charCode=0;
                        d.keyName=e.key.trim()||"Space"
                        var _this=this;
                        setTimeout(function(){
                          $(_this).blur();
                          d.keyCode=k;
                        },100);
                      },
                      keypress:function(e){
                        let d=eval(dd).event
                        d.charCode=_Util._checkCharcode(e);
                        return false;
                      }
                    }
                  }
                ],
                _dataRepeat:{key:"keyCode",char:"charCode"}
              }
            ]
          }
        ]
      }
    ]
  }
};
var _ideDataBind={
  _data:(window._CtrlDriver&&_CtrlDriver._buildProxy({_suggestList:[],_key:"",_scope:"$parameter"}))||{_suggestList:[],_key:"",_scope:"$parameter"},
  value:0,
  _buildDefParameter:function(df,d){
    d=_Util._strToJson(d);
    if(!_Util._isEmpty(d)){
      let ks=Object.keys(df)
      if(d.constructor==Array){
        d.forEach(x=>{
          if(x.constructor==Object){
            _ideDataBind._buildDefParameter(df,x)
          }
        })
        return d
      }
      for(let k in d){
        if(!ks.includes(k)){
          df[k]=d[k]
        }
        let kk=_glossaryHandler._getVariableName(k)
        if(kk==k){
          d[k]=`{{$parameter.${k}}}`
        }else{
          d[k]=`{{$parameter["${k}"]}}`
        }
      }
    }
    return d
  },
  _buildParameterOptions:function(){
    return ["$parameter"]
  },
  _filter:function(e){
    if(BZ._autoRecording){
      return
    }
    if(e==BZ.TW.document.body){
      if(_ideDataBind._curInput){
        _ideDataBind._curInput.focus()
      }
      return
    }
    _ideDataBind._curInput=e;
    if(_ideDataBind._curInput){
      this._data._filterWord=_ideDataBind._curInput.value||""
    }else{
      this._data._filterWord="";
    }
  },
  _getBindData:function(e,_chkExistDataOnly,_getPath){
    if(_Util._isHidden(e)&&(e.tagName!="INPUT"||!["checkbox","radio"].includes(e.type))){
      return
    }
    var ds=_cssHandler._findInputPath(e)||_cssHandler._findPath(e),_name;
    if(!ds){
      return;
    }
    _name=_descAnalysis._retrieveTextForElementPathItem(ds)
    if(!_name){
      if(e.type=="file"){
        _name=_bzMessage._common._file.toLowerCase()
      }else{
        return _ideDataBind._generateData(e);
      }
    }
    _ideDataBind._data._tmpName=_glossaryHandler._getVariableName(_name);
    
    var o=$parameter||{},p,vs;

    if(!_getPath&&(!_innerWin._data._dataBind._showDataBind||!_IDE._data._curTest||!BZ._isRecording())){
      return _ideDataBind._generateData(e,_name)
    }else{
      if(s=="$parameter"&&BZ._isPlaying()){
        return `$parameter.${_name}`
      }else{
        p=_ideDataBind._getBindDataName(o, _name,s,e,ds,_chkExistDataOnly)
      }
      if(p && p._path){
        return p._path;
      }
    }
  },
  _getBindDataName:function(o,n,_path,e,_elementPath,_chkExistDataOnly){
    var _best,p,_key=_ideDataBind._data._key,v;

    if(["$test","$module","$project"].includes(_path)&&_key){
      _path+="."+_key
      
      if(!o[_key]){
        o[_key]={}
      }else if(o[_key].constructor!=Object){
        return alert(_Util._formatMessage(_bzMessage._dataBind._keyExist,[_key]))
      }
      o=o[_key]
    }
    _best=_ideDataBind._getMatchData(o,n,_path,_chkExistDataOnly)
    if(_best){
      try{
        eval("v="+_best._path)
        if(v=="on"&&e&&e.type!="checkbox"){
          _best=0
        }else if(e&&e.tagName=="SELECT"){
          let _found
          for(var i=0;i<e.options.length;i++){
            if(e.options[i].text==v){
              _found=1
              break
            }
          }
          if(!_found){
            _best=0
          }
        }
      }catch(ex){}
    }
    if(!_best){
      _best={}
    }
    if(_best._path){
      if(_ideDataBind._registered(_best._path,_elementPath)==1){
        _best._path=0
      }
    }
    if(_chkExistDataOnly){
      return _best
    }
    if(!_best._path&&!_path.startsWith("$loop")&&(!_ideDataBind._autoFillTime||_ideDataBind._emptyScopeData)){
      _best._path=_path+"."+_ideDataBind._data._tmpName

      v=_ideDataBind._generateData(e,n)
      if(_key&&["$test","$module","$project"].includes(_path)){
        if(!o[_key]){
          o[_key]={}
        }
        o=o[_key]
      }
      o[_ideDataBind._data._tmpName]=v
    }
    return _best;
  },
  //o: data map, like: {first_name:"ws",last_name:"li"}
  //n:name, like: first name
  //ns: name words in array, like: ["first","name"]
  //_path: data path, like: $test or $test.data
  _getMatchData:function(o,n,_path){
    n=_glossaryHandler._removeIgnore(n)
    var _best,p,ns=_glossaryHandler._splitWord(n);
    
    for(var k in o){
      var v=o[k];
      if(v===null||v===undefined){
        v=""
      }
      if(v.constructor==Object){
        p=_ideDataBind._getMatchData(v,n,_path+"."+k);
      }else if(v.constructor!=Array){
        p=_glossaryHandler._getSimilarityRate(n,k,ns)
      }else{
        continue;
      }
      
      if(!_best || (p && p._size && ((p._type <_best._type) || (p._type==_best._type && p._size>_best._size)))){
        _best=p;
        
        if(!p._path && p._size){
          
          var _bind=p._type==1||p._size>n.length/2;
          if(!_bind){
            var ks=_glossaryHandler._splitWord(k);
            _bind=1
            for(var i=0;i<ks.length;i++){
              if(!ns.includes(ks[i].toLowerCase())){
                _bind=0
                break;
              }
            }
          }
          if(_bind){
            if(p._type==1||k.length<=n.length+3){
              p._path=_path?_path+"."+k:k;
            }
          }
        }
      }
    }
    return _best
  },
  _generateData:function(e,n){
    var v=_aiPageHandler._getFormat("text","string")
    if(v._head){
      return "*"
    }else if(e.tagName=="INPUT"){
      if(v.constructor!=String){
        return ""
      }
    }
    if(e.tagName=="SELECT"){
      // v=_aiFlagHandler._getErgodicValue(e)
      // if(v!==undefined){
      //   return v
      // }
      if(e.selectedOptions&&e.selectedOptions[0]&&e.selectedOptions[0].value&&!["0","none"].includes(e.selectedOptions[0].value)){
        v=e.selectedOptions[0].text
      }else{
        for(var i=0;i<e.options.length;i++){
          if(e.options[i].value&&!["0","none"].includes(e.options[i].value)){
            v=e.options[i].text
            break
          }
        }
      }
    }else if(e.type=="checkbox"){
      v="on"
    }else if(e.type=="radio"){
      return e.value
    }else if(!_Util._isInContentEditable(e)&&!_Util._isStdInputElement(e)){
      // let ev= _aiFlagHandler._getErgodicValue(e)
      // return ev||""
      return ""
    }else{
      if(e.value){
        v=e.value
      }else if(e.type=="file"){
        let f=_Util._getAcceptFileType(e)
        if(!_domRecorder._uploadFileTypes.includes(f)){
          f="png"
        }
        v="example."+f
      }else{
        if(e.type=="number"){
          v="/{random:1-10}/"
        }else if(n){
        }else{
          return _aiPageHandler._getFormat("text","string")
        }
        v=$util.generateWordsByRegex(v,n)
      }
    }
    return v
  },
  _insertBindInfo:function(e,w){
    w=_Util._formatMessage(_bzMessage._dataBind._bindDataInfo,[w])
    var r=e.getBoundingClientRect()
    var o=$("<div style='background-color:#FFF;padding:5px;font-size:13px;z-index:10000000000000000;border:1px solid #999;border-radius:5px;position:fixed;left:"+r.left+"px;top:"+(r.top-25)+"px;'>"+w+"</div>").insertAfter(BZ.TW.document.body)
    setTimeout(function(){
      o.remove()
    },3000)
  },
  //c: code
  _registerData:function(c,p){
    _ideDataBind._dataMap=_ideDataBind._dataMap||{}
    if(_ideDataBind._dataMap._test!=_IDE._data._curTest._data.code){
      _ideDataBind._dataMap._test=_IDE._data._curTest._data.code
      _ideDataBind._dataMap._data={}
    }
    _ideDataBind._dataMap._data[c]=p
  },
  //return 0: not register yet, 1: registered by other element, 2: registered by the element
  _registered:function(c,p){
    if(_ideDataBind._dataMap&&_ideDataBind._dataMap._test==_IDE._data._curTest._data.code){
      var o=_ideDataBind._dataMap._data[c];
      return !o?0:o==p?2:1
    }
  },
  _bindDataOnElement:function(a,_field){
    if(BZ._autoRecording||!_IDE._data._curTest){
      return
    }
    if(_field=="element"){
      _field=a.element
    }else{
      _field=a.event.target
    }
    if(_field && _innerWin._data._dataBind._showDataBind&&_IDE._data._curTest){
      
      for(var ii=0;ii<_field.length;ii++){
        var v=_field[ii];
        
        if(!v||!v.match){
          return;
        }
        var vv=v.match(/\:(near|text|input|data|panel|contains|Contains|textElement|afterEqual|after|before|endContains|endEqual|equal|RowCol|rowcol)\((.+)\)/);
        if(vv){
          var vvv=_ideDataBind._insertCode(vv[2]);
          if(vvv){
            v=v.substring(0,vv.index)+":"+vv[1]+"("+vvv+")"+v.substring(vv.index+vv[0].length);
            _field[ii]=v;
            continue;
          }
        }else{
          //vv=v.match(/\[(title|placeholder|name|label)([\*\=\"\']+)(.+)[\"\']+/);
          vv=v.match(new RegExp("\\[("+_IDE._data._curVersion.setting.content.contentAttribute+")([\\*\\=\\\"\\']+)(.+)[\\\"\\']+"));
          if(vv){
            var vvv=_ideDataBind._insertCode(vv[3]);
            if(vvv){
              v=v.substring(0,vv.index)+"["+vv[1]+vv[2]+vvv+vv[4];
              _field[ii]=v;
              continue;
            }
          }else{
            if(!vv && (!_field[ii+1] || !_field[ii+1].match)){
              vv=v.match(/#([^.\[:]*)/);
              if(vv){
                var vvv=_ideDataBind._insertCode(vv[1]);
                if(vvv){
                  v=v.substring(0,vv.index)+"#"+vvv+v.substring(vv.index+v[0].length);
                  _field[ii]=v;
                  continue;
                }
              }
            }
          }
        }
      }
    }
  },
  _bindValidationData:function(e,s){
    s=s||"";
    if(curUser._curProject.setting.autoDataBind||(_innerWin._data._dataBind._showDataBind&&_IDE._data._curTest)){
      for(var i=0;i<e.childNodes.length;i++){
        var n=e.childNodes[i];
        if(n.nodeType==3){
          var t=_Util._pickTextFromNode(e.childNodes,i);
          i=t.i
          n=_ideDataBind._findDataPath(t.t);
          if(n && !s.includes(n)){
            s+=n
          }
        }else if(n.nodeType==1){
          s=_ideDataBind._bindValidationData(n,s);
        }
      }
      var vs=$(e).find("INPUT,SELECT,TEXTAREA")
      for(var i=0;i<vs.length;i++){
        v=vs[i];
        if(!["checkbox","radio"].includes(v.type) || v.checked){
          n=_ideDataBind._findDataPath(v.value);
          if(n && !s.includes(n)){
            s+=n
          }
        }
      }
    }
    
    return s;
  },
  _insertCode:function(w){
    var o=$parameter||{};
    var vv=_doIt(w,o,"$parameter");
    if(vv!=w){
      return vv
    }

    function _doIt(ww,v,p){
      var rp="";
      if(!ww||!v||((v+"").length<3&&!ww.split(/ |\|/).includes(v))){
        return ""
      }else if(v==ww){
        rp= "{{"+p+"}}";
      }else if(v.constructor==Object){
        for(var k in v){
          var pp=_doIt(ww,v[k], p+"."+k);

          var _idx=pp.lastIndexOf("}}")
          if(_idx && ww!=pp){
            rp+=pp.substring(0,_idx+2);
            ww=pp.substring(_idx+2)
          }
        }
        if(rp){
          rp+=ww
        }
      }else if(v && ![Array,Function].includes(v.constructor)){
        try{
          rp=_Util._replaceWord(ww,v,"{{"+p+"}}")
        }catch(e){
        }
      }
      return rp||ww
    }
  },
  //w: word
  _findDataPath:function(w){
    let o=$parameter||{};
    var vv=_doIt(w,o,"$parameter");
    if(vv){
      return vv
    }
    function _doIt(w,v,p){
      var cs=""
      if(!w||!v){
        return
      }
      if(v.constructor!=Object && w.includes(v)){
        return p;
      }else if(v.constructor==Object){
        for(var k in v){
          if(k&&(v[k]||v[k]===0)){
            if(v[k].constructor==Array&&!v[k].length){
              continue
            }
            var pp=_doIt(w,v[k], p+"."+k);
            if(pp){
              cs+=pp+"\n";
            }
          }
        }
        return cs
      }
    }
  },  
  _bindEvent:function(_code,_value,_afterAutoFill){
    var e=_ideDataBind._curInput,_orgCode=_code,n,_sendAction;
    var d=_cssHandler._findPath(e,1);

    if(_code){
      if(_ideDataBind._data._replaceKeyByParameter && _ideDataBind._data._key){
        _code=_code.replace("[$parameter]","."+_ideDataBind._data._key)
      }
      _ideDataBind._insertBindInfo(e,_code)
      n="{{"+_code+"}}";
    }else if(_value==e.value&&e.tagName=="INPUT"){
      _sendAction=1
    }
    var a={
      element:d._elementPath,
      css:d.W,
      event:{type:_Util._isInContentEditable(e)?"blur":"change",autoBlur:"on",value:_value},
      type:1,
      bindData:""
    };
    if(e._requestErgodicList){
      a._requestErgodicDom=e
    }
    if(_value&&_value.length>2&&_code){
      _ideDataBind._registerData(_code,d._elementPath);
    }
    if(_domRecorder._lastAction && ["change","key"].includes(_domRecorder._lastAction.event.type) && _domRecorder._lastElement==e){
      _domRecorder._lastBindElement=0
      if(window.extensionContent){
        _domRecorder._lastAction.event.value=n||_value;
        _domRecorder._lastAction.event.tmpValue=_value;
        _domRecorder._lastAction.replace=_ideDataBind._data._replaceKeyByParameter;
        BZ._formatInIFramePath(_domRecorder._lastAction.element)
        chrome.runtime.sendMessage({_updateAction:_domRecorder._lastAction});
        var $d=_code.startsWith("$test")?$test:_code.startsWith("$module")?$module:_code.startsWith("$project")?$project:$parameter||{};
        _code=_code.split(".");
        if(_code.length>1 && _code.length<4){
          if(_code.length==3){
            if(!$d[_code[1]]){
              $d[_code[1]]={}
            }
            $d=$d[_code[1]];
          }
          $d[_code[_code.length-1]]=_value;
        }

        if(_code.length>2){
          _ideDataBind._data._key=_code[1]
        }
      }else{
        _ideActionManagement._buildInputBindData(_domRecorder._lastAction,n,_value,_ideDataBind._data._replaceKeyByParameter)
      }
      setTimeout(function(){
        e.bzReady=1
      },10)
      _domRecorder._lastAction=0
      _domActionTask._curValueDataBind=0;
      // _ideDataBind._hideMe(e)
      if(_afterAutoFill){
        setTimeout(function(){
          _afterAutoFill()
        },1000)
      }
      return 
    }else if(_domRecorder._lastBindElement==e){
      if(!_domRecorder._lastBindElement2){
        _domRecorder._lastBindElement2=e
        a.event.type="key"
        a.event.action="group"
        a.event.value=_value
      }else{
        _domRecorder._lastBindElement2=0
        return alert(_bzMessage._dataBind._bindFailed)
      }
    }

    _domRecorder._lastAction=0
    _domRecorder._lastElement=0
    if(_Util._isInContentEditable(e)||(e.type=='checkbox'&&((e.checked&&_value&&_value!="off")||(!e.checked&&(_value=="off"&&!_value))))){
      var ppp={
        _element: e,
        _type: 1,
        _paths: d._elementPath,
        _orgPath:d,
        css:d.W,
        _action: "change",
        _value: n||_value,
        _time: Date.now(),
        _tmpUrl: location.href
      }
      _domRecorder._addData(ppp);
      if(e.type!="checkbox"){
        e.innerHTML=_value
      }
      _domActionTask._curValueDataBind=0;
      if(_afterAutoFill){
        setTimeout(function(){
          _afterAutoFill()
        },1000)
      }
      return
    }else{
      _domActionTask._curValueDataBind=n;
      var _noTrigger=0

      return _domActionTask._trigger(a,function(r){
        if(r._customizeInputAction){
          if(_code){
            eval(_code+"=r._customizeInputAction._value",{},"set",_code,r._customizeInputAction._value)
            _code="{{"+_code+"}}"
            r._customizeInputAction._orgPath.event.value=_code
          }
          _domRecorder._addData(r._customizeInputAction);
          if(_code){
            _aiDataUpdateHandler.bindAndGenerateData(_code,r._customizeInputAction._value)
          }
          if(_afterAutoFill){
            setTimeout(function(){
              _afterAutoFill(r)
            },500)
          }
        }else if(_code){
          if(e.tagName=="INPUT"&&["checkbox","radio"].includes(e.type)){
            a.event.value=_code="{{"+_code+"}}"
            if(!window.extensionContent){
              _ideActionManagement._addItem(a);
            }else{
              //Call background to set back recording action
              _domRecorder._sendData(a)
            }
            _aiDataUpdateHandler.bindAndGenerateData(_code,_value)
            // setTimeout(function(){
              // _ideDataBind._hideMe(e)
            // },100)
            if(_afterAutoFill){
              setTimeout(function(){
                _afterAutoFill(r)
              },1000)
            }
            return
          }
          _domRecorder._lastBindElement=e
          _ideDataBind._bindEvent(_orgCode,_value,_afterAutoFill)
        }else if(_afterAutoFill){
          if(_sendAction){
            if(!window.extensionContent){
              _ideActionManagement._addItem(a);
            }else{
              //Call background to set back recording action
              _domRecorder._sendData(a)
            }
          }
          setTimeout(function(){
            _afterAutoFill(r)
          },e.tagName=="SELECT"||["checkbox","radio"].includes(e.type)?200:100)
        }
        
      });
    }
  },
  _autoFill:function(){
    if(!_innerWin._data._dataBind._showDataBind||!_IDE._data._curTest){
      return _ideDataBind._autoFillContinue()
    }else{
      _ideDataBind._emptyScopeData=1;
      _ideDataBind._doFillForm();
    }
  },
  _autoFillContinue:function(){
    _bzDomPicker._removeTmpCover()
    _ideDataBind._doFillForm()
  },
  _doFillForm:function(t,_scope,_noBindData,_fun){
    const _time=_ideDataBind._autoFillTime=t||Date.now();
    var _last=0,bzTmp2,
        vs=[],ls;
    let _allNew=[],
        _lastEnableList,
        _lastDisabledList

    let _observer=_buildObserver(_scope),_dependences=[];

    _doBind()

    function _doBind(_waiting){
      if(TWHandler.BZ_sent){
        return setTimeout(function(){
          _doBind(_waiting)
        },100)
      }
      if(_last){
        if(!_last.bzReady){
          return setTimeout(function(){_doBind(_waiting)},100)
        }
      }
      // _ideDataBind._hideMe()
      // _aiFlagHandler._assignFlagByScript()

      let ns=_cssHandler._findAllInputs(_scope),o=0,i;
      
      // if(_fun){
      //   ns.forEach(x=>{
      //     _aiFlagHandler._setFieldInfo(x)
      //   })
      // }
      o=ns.find(x=>{
        if(x.bzFillTime!=_time){
          if(x._failedTime&&x._failedTime>_time){
            x.bzFillTime=_time
            return
          }
          x.bzFillTime=0
          
          // if(!_aiFlagHandler._hasNextErgodicValue(x)){
            x.bzFillTime=_time;
            if(vs.includes(x)){
              return
            }
            if(_isNew(x)){
              let v=vs.find(v=>{
                return _Util._isSameElement(v,x)
              })
              if(v){
                if(v==_last){
                  _last=x
                }
                vs.push(x)
                return 
              }
            }
          // }
          return !(_Util._isHidden(x)||$(x).attr("readonly")||$(x).attr("disabled"))
        }
      })

      if(_last){
        _handleDependences(_last,o,ls,vs,ns)
      }
      ls=ns

      if(o){
        if(_last){
          _last.bzReady=0
        }
        
        _last=o;
        
        var p=_ideDataBind._getBindData(o),v;
        if(p!==undefined){
          try{
            _ideDataBind._curInput=o;
            bzTmp2=o.bzTmp
            o._setValues=o._setValues||new Set()

            o._setValues.add(_Util._getInputValue(o))
            o.bzReady=1
            vs.push(o);
            if(!_innerWin._data._dataBind._showDataBind||!_IDE._data._curTest||!BZ._isRecording()){
              v=p
              _ideDataBind._bindEvent(0,v,function(r){
                if(v=="/{random}/"&&o._ergodicValueList){
                  o._value=o._ergodicValueList[o._ergodicIdx]
                }else{
                  o._value=v
                }
                o._value=v
                if(r&&r._type!=4){
                  o._failedTime=Date.now()
                }
                _doBind(o)
              });
            }else{
              v=eval(p);
              if(!v&&o.type=='radio'){
                o.bzReady=1
                return _doBind(o)
              }
              _ideDataBind._bindEvent(p,v,function(){
                setTimeout(()=>{
                  _doBind(o)
                },200)
              });
            }
            return
          }catch(e){}
        }else{
          o.bzReady=1
        }
        _doBind(o)
      }else{
        _ideDataBind._autoFillTime=0;
        _end()
        if(_fun){
          return 
        }

        if(vs.length){
          if(_last){
            _last.bzReady=0
          }
          _bzDomPicker._showTmpCover(vs,2);
          _ideDataBind._emptyScopeData=0
          setTimeout(function(){
            _bzDomPicker._removeTmpCover();
            vs.length=0
          },2000)
          if(window.extensionContent){
            chrome.runtime.sendMessage({bz:1,_fun:"_setInAutoFill",_scope:"_ideTestManagement",_data:1});
          }else{
            _ideTestManagement._setInAutoFill(1)
          }
        }else{
          alert(_bzMessage._dataBind._noData)
        }
        // _ideDataBind._hideMe()
      }
    }
    
    function _isNew(o){
      return _allNew.find(x=>{
        return x==o||$(x).find(o)[0]
      })
    }
    //ls: last input list,
    //vs: already did list
    //ns: current input list
    function _handleDependences(e,o,ls,vs,ns){
      let d={
        _oprElement:e,
        _value:_getValue(),
        _newElements:o?ns.filter(x=>!_existInList(ls,x)&&!_existInList(vs,x)):[],
        _removed:ls.filter(x=>!_existInList(ns,x)&&x!=e),
        _removedDependency:_last?{
          _field:_last,
          _values:_last._setValues?[..._last._setValues]:[]
        }:{}
      },_enableList=[],_disableList=[]

      d._newElements=d._newElements.filter(x=>!x.disabled);

      ns.forEach(x=>{
        if(x.disabled||x.readonly){
          _disableList.push(x)
        }else{
          _enableList.push(x)
        }
      });
      if(_lastEnableList){
        _enableList.forEach(x=>{
          if(!_lastEnableList.includes(x)){
            if(ls.includes(x)&&!d._newElements.includes(x)){
              d._newElements.push(x)
            }
          }
        });
        _disableList.forEach(x=>{
          if(!_lastDisabledList.includes(x)&&!d._removed.includes(x)){
            d._removed.push(x)
          }
        })
      }

      _lastEnableList=_enableList
      _lastDisabledList=_disableList

      _dependences.push(d)
      function _getValue(){
        if(e.tagName=="INPUT"&&e.type=="checkbox"){
          return e.checked
        }
        return e._value
      }
    }
    
    function _existInList(_list, v){
      return _list.find(x=>x==v||(x.bzShortCut&&v.bzShortCut&&x.bzShortCut._key==v.bzShortCut._key))
    }
    
    function _end(){
      _observer.disconnect();
      _fun&&_fun(_dependences)
    }
    
    function _buildObserver(_scope){
      let _observer=new MutationObserver(function(_mutations) {
        _mutations.forEach(m=>{
          let a=m.addedNodes[0]
          if(a&&a.nodeType==1){
            _allNew.push(a)
          }
        })
      })
      
      _observer.observe(BZ.TW.document.body,{
        childList:true,
        subtree:true,
        characterData: true,
        attributes:true,
        attributeFilter: ['style','class'],
        attributeOldValue:true
      });
      return _observer
    }
  }
};